{
  "$schema": "http://json.schemastore.org/sarif-1.0.0",
  "version": "1.0.0",
  "runs": [
    {
      "tool": {
        "name": "Semmle",
        "version": "1.15.2"
      },
      "files": {
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/prerequisites/Web.config": {
          "mimeType": "text/xml",
          "contents": "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0NCiAgRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gaG93IHRvIGNvbmZpZ3VyZSB5b3VyIEFTUC5ORVQgYXBwbGljYXRpb24sIHBsZWFzZSB2aXNpdA0KICBodHRwOi8vZ28ubWljcm9zb2Z0LmNvbS9md2xpbmsvP0xpbmtJZD0xNjk0MzMNCiAgLS0+DQo8Y29uZmlndXJhdGlvbj4NCiAgPHN5c3RlbS53ZWJTZXJ2ZXI+DQogICAgPG1vZHVsZXM+DQogICAgICA8YWRkIG5hbWU9IldlYkFwcGxpY2F0aW9uMSIgdHlwZT0iQmFzaWNBdXRoTW9kdWxlIi8+DQogICAgPC9tb2R1bGVzPg0KICA8L3N5c3RlbS53ZWJTZXJ2ZXI+DQogIDxzeXN0ZW0ud2ViPg0KICAgIDxjdXN0b21FcnJvcnMgbW9kZT0iT2ZmIiAvPg0KICA8L3N5c3RlbS53ZWI+DQo8L2NvbmZpZ3VyYXRpb24+DQo="
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/DefaultCredentialsTest.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbDsNCnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7DQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KDQpuYW1lc3BhY2UgU3lzdGVtLk5ldC5IdHRwLkZ1bmN0aW9uYWwuVGVzdHMNCnsNCiAgICB1c2luZyBDb25maWd1cmF0aW9uID0gU3lzdGVtLk5ldC5UZXN0LkNvbW1vbi5Db25maWd1cmF0aW9uOw0KDQogICAgLy8gVE9ETzogIzIzODMgLSBDb25zb2xpZGF0ZSB0aGUgdXNlIG9mIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBzZXR0aW5ncyB0byBDb21tb24vdGVzdHMuDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXAsICJkb3RuZXQvY29yZWZ4ICMyMDAxMCIpXQ0KICAgIFtQbGF0Zm9ybVNwZWNpZmljKFRlc3RQbGF0Zm9ybXMuV2luZG93cyldDQogICAgcHVibGljIGFic3RyYWN0IGNsYXNzIERlZmF1bHRDcmVkZW50aWFsc1Rlc3QgOiBIdHRwQ2xpZW50VGVzdEJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgc3RhdGljIGJvb2wgRG9tYWluSm9pbmVkVGVzdHNFbmFibGVkID0+ICFzdHJpbmcuSXNOdWxsT3JFbXB0eShDb25maWd1cmF0aW9uLkh0dHAuRG9tYWluSm9pbmVkSHR0cEhvc3QpOw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIGJvb2wgRG9tYWluUHJveHlUZXN0c0VuYWJsZWQgPT4gIXN0cmluZy5Jc051bGxPckVtcHR5KENvbmZpZ3VyYXRpb24uSHR0cC5Eb21haW5Kb2luZWRQcm94eUhvc3QpOw0KDQogICAgICAgIC8vIEVuYWJsZSB0aGlzIHRvIHRlc3QgYWdhaW5zdCBsb2NhbCBIdHRwTGlzdGVuZXIgb3ZlciBsb29wYmFjaw0KICAgICAgICAvLyBOb3RlIHRoaXMgZG9lc24ndCB3b3JrIGFzIGV4cGVjdGVkIHdpdGggV2luSHR0cEhhbmRsZXIsIGJlY2F1c2UgV2luSHR0cEhhbmRsZXIgd2lsbCBhbHdheXMgYXV0aGVudGljYXRlIHRoZSANCiAgICAgICAgLy8gY3VycmVudCB1c2VyIGFnYWluc3QgYSBsb29wYmFjayBzZXJ2ZXIgdXNpbmcgTlRMTSBvciBOZWdvdGlhdGUuDQogICAgICAgIHByaXZhdGUgc3RhdGljIGJvb2wgTG9jYWxIdHRwTGlzdGVuZXJUZXN0c0VuYWJsZWQgPSBmYWxzZTsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgU2VydmVyQXV0aGVudGljYXRpb25UZXN0c0VuYWJsZWQgPT4gKExvY2FsSHR0cExpc3RlbmVyVGVzdHNFbmFibGVkIHx8IERvbWFpbkpvaW5lZFRlc3RzRW5hYmxlZCk7DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIHNfc3BlY2lmaWNVc2VyTmFtZSA9IENvbmZpZ3VyYXRpb24uU2VjdXJpdHkuQWN0aXZlRGlyZWN0b3J5VXNlck5hbWU7DQogICAgICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBzX3NwZWNpZmljUGFzc3dvcmQgPSBDb25maWd1cmF0aW9uLlNlY3VyaXR5LkFjdGl2ZURpcmVjdG9yeVVzZXJQYXNzd29yZDsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIHNfc3BlY2lmaWNEb21haW4gPSBDb25maWd1cmF0aW9uLlNlY3VyaXR5LkFjdGl2ZURpcmVjdG9yeU5hbWU7DQogICAgICAgIHByaXZhdGUgcmVhZG9ubHkgTmV0d29ya0NyZWRlbnRpYWwgX3NwZWNpZmljQ3JlZGVudGlhbCA9DQogICAgICAgICAgICBuZXcgTmV0d29ya0NyZWRlbnRpYWwoc19zcGVjaWZpY1VzZXJOYW1lLCBzX3NwZWNpZmljUGFzc3dvcmQsIHNfc3BlY2lmaWNEb21haW4pOw0KICAgICAgICBwcml2YXRlIHN0YXRpYyBVcmkgc19hdXRoZW50aWNhdGVkU2VydmVyID0gRG9tYWluSm9pbmVkVGVzdHNFbmFibGVkID8gDQogICAgICAgICAgICBuZXcgVXJpKCQiaHR0cDovL3tDb25maWd1cmF0aW9uLkh0dHAuRG9tYWluSm9pbmVkSHR0cEhvc3R9L3Rlc3QvYXV0aC9uZWdvdGlhdGUvc2hvd2lkZW50aXR5LmFzaHgiKSA6IG51bGw7DQoNCiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KDQogICAgICAgIHB1YmxpYyBEZWZhdWx0Q3JlZGVudGlhbHNUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbQ29uZGl0aW9uYWxUaGVvcnkobmFtZW9mKFNlcnZlckF1dGhlbnRpY2F0aW9uVGVzdHNFbmFibGVkKSldDQogICAgICAgIFtNZW1iZXJEYXRhKG5hbWVvZihBdXRoZW50aWNhdGVkU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBVc2VEZWZhdWx0Q3JlZGVudGlhbHNfRGVmYXVsdFZhbHVlX1VuYXV0aG9yaXplZChzdHJpbmcgdXJpLCBib29sIHVzZVByb3h5KQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuVXNlUHJveHkgPSB1c2VQcm94eTsNCg0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVyaSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLlVuYXV0aG9yaXplZCwgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0NvbmRpdGlvbmFsVGhlb3J5KG5hbWVvZihTZXJ2ZXJBdXRoZW50aWNhdGlvblRlc3RzRW5hYmxlZCkpXQ0KICAgICAgICBbTWVtYmVyRGF0YShuYW1lb2YoQXV0aGVudGljYXRlZFNlcnZlcnMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgVXNlRGVmYXVsdENyZWRlbnRpYWxzX1NldEZhbHNlX1VuYXV0aG9yaXplZChzdHJpbmcgdXJpLCBib29sIHVzZVByb3h5KQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuVXNlUHJveHkgPSB1c2VQcm94eTsNCiAgICAgICAgICAgIGhhbmRsZXIuVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gZmFsc2U7DQoNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmkpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5VbmF1dGhvcml6ZWQsIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtDb25kaXRpb25hbFRoZW9yeShuYW1lb2YoU2VydmVyQXV0aGVudGljYXRpb25UZXN0c0VuYWJsZWQpKV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKEF1dGhlbnRpY2F0ZWRTZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFVzZURlZmF1bHRDcmVkZW50aWFsc19TZXRUcnVlX0Nvbm5lY3RBc0N1cnJlbnRJZGVudGl0eShzdHJpbmcgdXJpLCBib29sIHVzZVByb3h5KQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuVXNlUHJveHkgPSB1c2VQcm94eTsNCiAgICAgICAgICAgIGhhbmRsZXIuVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gdHJ1ZTsNCg0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVyaSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCg0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUJvZHkgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgV2luZG93c0lkZW50aXR5IGN1cnJlbnRJZGVudGl0eSA9IFdpbmRvd3NJZGVudGl0eS5HZXRDdXJyZW50KCk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoImN1cnJlbnRJZGVudGl0eT17MH0iLCBjdXJyZW50SWRlbnRpdHkuTmFtZSk7DQogICAgICAgICAgICAgICAgVmVyaWZ5QXV0aGVudGljYXRpb24ocmVzcG9uc2VCb2R5LCB0cnVlLCBjdXJyZW50SWRlbnRpdHkuTmFtZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0NvbmRpdGlvbmFsVGhlb3J5KG5hbWVvZihTZXJ2ZXJBdXRoZW50aWNhdGlvblRlc3RzRW5hYmxlZCkpXQ0KICAgICAgICBbTWVtYmVyRGF0YShuYW1lb2YoQXV0aGVudGljYXRlZFNlcnZlcnMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgQ3JlZGVudGlhbHNfU2V0VG9XcmFwcGVkRGVmYXVsdENyZWRlbnRpYWxfQ29ubmVjdEFzQ3VycmVudElkZW50aXR5KHN0cmluZyB1cmksIGJvb2wgdXNlUHJveHkpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5Vc2VQcm94eSA9IHVzZVByb3h5Ow0KICAgICAgICAgICAgaGFuZGxlci5DcmVkZW50aWFscyA9IG5ldyBDcmVkZW50aWFsV3JhcHBlcg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIElubmVyQ3JlZGVudGlhbHMgPSBDcmVkZW50aWFsQ2FjaGUuRGVmYXVsdENyZWRlbnRpYWxzDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KDQogICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlQm9keSA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICBXaW5kb3dzSWRlbnRpdHkgY3VycmVudElkZW50aXR5ID0gV2luZG93c0lkZW50aXR5LkdldEN1cnJlbnQoKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiY3VycmVudElkZW50aXR5PXswfSIsIGN1cnJlbnRJZGVudGl0eS5OYW1lKTsNCiAgICAgICAgICAgICAgICBWZXJpZnlBdXRoZW50aWNhdGlvbihyZXNwb25zZUJvZHksIHRydWUsIGN1cnJlbnRJZGVudGl0eS5OYW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbQ29uZGl0aW9uYWxUaGVvcnkobmFtZW9mKFNlcnZlckF1dGhlbnRpY2F0aW9uVGVzdHNFbmFibGVkKSldDQogICAgICAgIFtNZW1iZXJEYXRhKG5hbWVvZihBdXRoZW50aWNhdGVkU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBDcmVkZW50aWFsc19TZXRUb0JhZENyZWRlbnRpYWxfVW5hdXRob3JpemVkKHN0cmluZyB1cmksIGJvb2wgdXNlUHJveHkpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5Vc2VQcm94eSA9IHVzZVByb3h5Ow0KICAgICAgICAgICAgaGFuZGxlci5DcmVkZW50aWFscyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbCgibm90YXJlYWx1c2VyIiwgIjEyMzQ1NiIpOw0KDQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbQWN0aXZlSXNzdWUoMTAwNDEpXQ0KICAgICAgICBbQ29uZGl0aW9uYWxUaGVvcnkobmFtZW9mKERvbWFpbkpvaW5lZFRlc3RzRW5hYmxlZCkpXQ0KICAgICAgICBbSW5saW5lRGF0YShmYWxzZSldDQogICAgICAgIFtJbmxpbmVEYXRhKHRydWUpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBDcmVkZW50aWFsc19TZXRUb1NwZWNpZmljQ3JlZGVudGlhbF9Db25uZWN0QXNTcGVjaWZpY0lkZW50aXR5KGJvb2wgdXNlUHJveHkpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5Vc2VQcm94eSA9IHVzZVByb3h5Ow0KICAgICAgICAgICAgaGFuZGxlci5Vc2VEZWZhdWx0Q3JlZGVudGlhbHMgPSBmYWxzZTsNCiAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBfc3BlY2lmaWNDcmVkZW50aWFsOw0KDQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmMoc19hdXRoZW50aWNhdGVkU2VydmVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUJvZHkgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgVmVyaWZ5QXV0aGVudGljYXRpb24ocmVzcG9uc2VCb2R5LCB0cnVlLCBzX3NwZWNpZmljRG9tYWluICsgIlxcIiArIHNfc3BlY2lmaWNVc2VyTmFtZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0FjdGl2ZUlzc3VlKDEwMDQxKV0NCiAgICAgICAgW0NvbmRpdGlvbmFsRmFjdChuYW1lb2YoRG9tYWluUHJveHlUZXN0c0VuYWJsZWQpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJveHlfVXNlQXV0aGVudGljYXRlZFByb3h5V2l0aE5vQ3JlZGVudGlhbHNfUHJveHlBdXRoZW50aWNhdGlvblJlcXVpcmVkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLlByb3h5ID0gbmV3IEF1dGhlbnRpY2F0ZWRQcm94eShudWxsKTsNCg0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuUHJveHlBdXRoZW50aWNhdGlvblJlcXVpcmVkLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbQWN0aXZlSXNzdWUoMTAwNDEpXQ0KICAgICAgICBbQ29uZGl0aW9uYWxGYWN0KG5hbWVvZihEb21haW5Qcm94eVRlc3RzRW5hYmxlZCkpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQcm94eV9Vc2VBdXRoZW50aWNhdGVkUHJveHlXaXRoRGVmYXVsdENyZWRlbnRpYWxzX09LKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLlByb3h5ID0gbmV3IEF1dGhlbnRpY2F0ZWRQcm94eShDcmVkZW50aWFsQ2FjaGUuRGVmYXVsdENyZWRlbnRpYWxzKTsNCg0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0NvbmRpdGlvbmFsRmFjdChuYW1lb2YoRG9tYWluUHJveHlUZXN0c0VuYWJsZWQpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJveHlfVXNlQXV0aGVudGljYXRlZFByb3h5V2l0aFdyYXBwZWREZWZhdWx0Q3JlZGVudGlhbHNfT0soKQ0KICAgICAgICB7DQogICAgICAgICAgICBJQ3JlZGVudGlhbHMgd3JhcHBlZENyZWRzID0gbmV3IENyZWRlbnRpYWxXcmFwcGVyDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSW5uZXJDcmVkZW50aWFscyA9IENyZWRlbnRpYWxDYWNoZS5EZWZhdWx0Q3JlZGVudGlhbHMNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5Qcm94eSA9IG5ldyBBdXRoZW50aWNhdGVkUHJveHkod3JhcHBlZENyZWRzKTsNCg0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBJRW51bWVyYWJsZTxvYmplY3RbXT4gQXV0aGVudGljYXRlZFNlcnZlcnMoKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBOb3RlIHRoYXQgbG9jYWxob3N0IHdpbGwgbm90IGFjdHVhbGx5IHVzZSB0aGUgcHJveHksIGJ1dCB0aGVyZSdzIG5vIGhhcm0gaW4gdGVzdGluZyBpdC4NCiAgICAgICAgICAgIGZvcmVhY2ggKGJvb2wgYiBpbiBuZXcgYm9vbFtdIHsgdHJ1ZSwgZmFsc2UgfSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoTG9jYWxIdHRwTGlzdGVuZXJUZXN0c0VuYWJsZWQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgSHR0cExpc3RlbmVyQXV0aGVudGljYXRlZExvb3BiYWNrU2VydmVyLk50bG1Pbmx5LlVyaSwgYiB9Ow0KICAgICAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgSHR0cExpc3RlbmVyQXV0aGVudGljYXRlZExvb3BiYWNrU2VydmVyLk5lZ290aWF0ZU9ubHkuVXJpLCBiIH07DQogICAgICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyBIdHRwTGlzdGVuZXJBdXRoZW50aWNhdGVkTG9vcGJhY2tTZXJ2ZXIuTmVnb3RpYXRlQW5kTnRsbS5VcmksIGIgfTsNCiAgICAgICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7IEh0dHBMaXN0ZW5lckF1dGhlbnRpY2F0ZWRMb29wYmFja1NlcnZlci5CYXNpY0FuZE50bG0uVXJpLCBiIH07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eShDb25maWd1cmF0aW9uLkh0dHAuRG9tYWluSm9pbmVkSHR0cEhvc3QpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICQiaHR0cDovL3tDb25maWd1cmF0aW9uLkh0dHAuRG9tYWluSm9pbmVkSHR0cEhvc3R9L3Rlc3QvYXV0aC9uZWdvdGlhdGUvc2hvd2lkZW50aXR5LmFzaHgiLCBiIH07DQogICAgICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAkImh0dHA6Ly97Q29uZmlndXJhdGlvbi5IdHRwLkRvbWFpbkpvaW5lZEh0dHBIb3N0fS90ZXN0L2F1dGgvbXVsdGlwbGVzY2hlbWVzL3Nob3dpZGVudGl0eS5hc2h4IiwgYiB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBWZXJpZnlBdXRoZW50aWNhdGlvbihzdHJpbmcgcmVzcG9uc2UsIGJvb2wgYXV0aGVudGljYXRlZCwgc3RyaW5nIHVzZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIENvbnZlcnQgYWxsIHN0cmluZ3MgdG8gbG93ZXJjYXNlIHRvIGNvbXBhcmUuIFdpbmRvd3MgdHJlYXRzIGRvbWFpbiBhbmQgdXNlcm5hbWUgYXMgY2FzZS1pbnNlbnNpdGl2ZS4NCiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVzcG9uc2UuVG9Mb3dlcigpOw0KICAgICAgICAgICAgdXNlciA9IHVzZXIuVG9Mb3dlcigpOw0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUocmVzcG9uc2UpOw0KDQogICAgICAgICAgICBpZiAoIWF1dGhlbnRpY2F0ZWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoDQogICAgICAgICAgICAgICAgICAgIFRlc3RIZWxwZXIuSnNvbk1lc3NhZ2VDb250YWluc0tleVZhbHVlKHJlc3BvbnNlLCAiYXV0aGVudGljYXRlZCIsICJmYWxzZSIpLA0KICAgICAgICAgICAgICAgICAgICAiYXV0aGVudGljYXRlZCA9PSBmYWxzZSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKA0KICAgICAgICAgICAgICAgICAgICBUZXN0SGVscGVyLkpzb25NZXNzYWdlQ29udGFpbnNLZXlWYWx1ZShyZXNwb25zZSwgImF1dGhlbnRpY2F0ZWQiLCAidHJ1ZSIpLA0KICAgICAgICAgICAgICAgICAgICAiYXV0aGVudGljYXRlZCA9PSB0cnVlIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoDQogICAgICAgICAgICAgICAgICAgIFRlc3RIZWxwZXIuSnNvbk1lc3NhZ2VDb250YWluc0tleVZhbHVlKHJlc3BvbnNlLCAidXNlciIsIHVzZXIpLA0KICAgICAgICAgICAgICAgICAgICAkInVzZXIgPT0ge3VzZXJ9Iik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGNsYXNzIENyZWRlbnRpYWxXcmFwcGVyIDogSUNyZWRlbnRpYWxzDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBJQ3JlZGVudGlhbHMgSW5uZXJDcmVkZW50aWFscyB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBOZXR3b3JrQ3JlZGVudGlhbCBHZXRDcmVkZW50aWFsKFVyaSB1cmksIFN0cmluZyBhdXRoVHlwZSkgPT4gDQogICAgICAgICAgICAgICAgSW5uZXJDcmVkZW50aWFscz8uR2V0Q3JlZGVudGlhbCh1cmksIGF1dGhUeXBlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgY2xhc3MgQXV0aGVudGljYXRlZFByb3h5IDogSVdlYlByb3h5DQogICAgICAgIHsNCiAgICAgICAgICAgIElDcmVkZW50aWFscyBfY3JlZGVudGlhbHM7DQogICAgICAgICAgICBVcmkgX3Byb3h5VXJpOw0KDQogICAgICAgICAgICBwdWJsaWMgQXV0aGVudGljYXRlZFByb3h5KElDcmVkZW50aWFscyBjcmVkZW50aWFscykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfY3JlZGVudGlhbHMgPSBjcmVkZW50aWFsczsNCg0KICAgICAgICAgICAgICAgIHN0cmluZyBob3N0ID0gQ29uZmlndXJhdGlvbi5IdHRwLkRvbWFpbkpvaW5lZFByb3h5SG9zdDsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2Uoc3RyaW5nLklzTnVsbE9yRW1wdHkoaG9zdCksICJEb21haW5Kb2luZWRQcm94eUhvc3QgbXVzdCBzcGVjaWZ5IHByb3h5IGhvc3RuYW1lIik7DQoNCiAgICAgICAgICAgICAgICBzdHJpbmcgcG9ydFN0cmluZyA9IENvbmZpZ3VyYXRpb24uSHR0cC5Eb21haW5Kb2luZWRQcm94eVBvcnQ7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKHN0cmluZy5Jc051bGxPckVtcHR5KHBvcnRTdHJpbmcpLCAiRG9tYWluSm9pbmVkUHJveHlQb3J0IG11c3Qgc3BlY2lmeSBwcm94eSBwb3J0IG51bWJlciIpOw0KDQogICAgICAgICAgICAgICAgaW50IHBvcnQ7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaW50LlRyeVBhcnNlKHBvcnRTdHJpbmcsIG91dCBwb3J0KSwgIkRvbWFpbkpvaW5lZFByb3h5UG9ydCBtdXN0IGJlIGEgdmFsaWQgcG9ydCBudW1iZXIiKTsNCg0KICAgICAgICAgICAgICAgIF9wcm94eVVyaSA9IG5ldyBVcmkoc3RyaW5nLkZvcm1hdCgiaHR0cDovL3swfTp7MX0iLCBob3N0LCBwb3J0KSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBJQ3JlZGVudGlhbHMgQ3JlZGVudGlhbHMNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBnZXQNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY3JlZGVudGlhbHM7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgc2V0DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBVcmkgR2V0UHJveHkoVXJpIGRlc3RpbmF0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfcHJveHlVcmk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBib29sIElzQnlwYXNzZWQoVXJpIGhvc3QpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzZWFsZWQgY2xhc3MgSHR0cExpc3RlbmVyQXV0aGVudGljYXRlZExvb3BiYWNrU2VydmVyDQogICAgICAgIHsNCiAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgSHR0cExpc3RlbmVyIF9saXN0ZW5lcjsNCiAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgc3RyaW5nIF91cmk7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgSHR0cExpc3RlbmVyQXV0aGVudGljYXRlZExvb3BiYWNrU2VydmVyIE50bG1Pbmx5ID0gbmV3IEh0dHBMaXN0ZW5lckF1dGhlbnRpY2F0ZWRMb29wYmFja1NlcnZlcigiaHR0cDovL2xvY2FsaG9zdDo4MDgwLyIsIEF1dGhlbnRpY2F0aW9uU2NoZW1lcy5OdGxtKTsNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgSHR0cExpc3RlbmVyQXV0aGVudGljYXRlZExvb3BiYWNrU2VydmVyIE5lZ290aWF0ZU9ubHkgPSBuZXcgSHR0cExpc3RlbmVyQXV0aGVudGljYXRlZExvb3BiYWNrU2VydmVyKCJodHRwOi8vbG9jYWxob3N0OjgwODEvIiwgQXV0aGVudGljYXRpb25TY2hlbWVzLk5lZ290aWF0ZSk7DQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEh0dHBMaXN0ZW5lckF1dGhlbnRpY2F0ZWRMb29wYmFja1NlcnZlciBOZWdvdGlhdGVBbmROdGxtID0gbmV3IEh0dHBMaXN0ZW5lckF1dGhlbnRpY2F0ZWRMb29wYmFja1NlcnZlcigiaHR0cDovL2xvY2FsaG9zdDo4MDgyLyIsIEF1dGhlbnRpY2F0aW9uU2NoZW1lcy5OZWdvdGlhdGUgfCBBdXRoZW50aWNhdGlvblNjaGVtZXMuTnRsbSk7DQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEh0dHBMaXN0ZW5lckF1dGhlbnRpY2F0ZWRMb29wYmFja1NlcnZlciBCYXNpY0FuZE50bG0gPSBuZXcgSHR0cExpc3RlbmVyQXV0aGVudGljYXRlZExvb3BiYWNrU2VydmVyKCJodHRwOi8vbG9jYWxob3N0OjgwODMvIiwgQXV0aGVudGljYXRpb25TY2hlbWVzLkJhc2ljIHwgQXV0aGVudGljYXRpb25TY2hlbWVzLk50bG0pOw0KDQogICAgICAgICAgICAvLyBEb24ndCBjb25zdHJ1Y3QgZGlyZWN0bHksIHVzZSBpbnN0YW5jZXMgYWJvdmUNCiAgICAgICAgICAgIHByaXZhdGUgSHR0cExpc3RlbmVyQXV0aGVudGljYXRlZExvb3BiYWNrU2VydmVyKHN0cmluZyB1cmksIEF1dGhlbnRpY2F0aW9uU2NoZW1lcyBhdXRoZW50aWNhdGlvblNjaGVtZXMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3VyaSA9IHVyaTsNCg0KICAgICAgICAgICAgICAgIF9saXN0ZW5lciA9IG5ldyBIdHRwTGlzdGVuZXIoKTsNCiAgICAgICAgICAgICAgICBfbGlzdGVuZXIuUHJlZml4ZXMuQWRkKHVyaSk7DQogICAgICAgICAgICAgICAgX2xpc3RlbmVyLkF1dGhlbnRpY2F0aW9uU2NoZW1lcyA9IGF1dGhlbnRpY2F0aW9uU2NoZW1lczsNCiAgICAgICAgICAgICAgICBfbGlzdGVuZXIuU3RhcnQoKTsNCg0KICAgICAgICAgICAgICAgIFRhc2suUnVuKCgpID0+IFByb2Nlc3NSZXF1ZXN0cygpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBVcmkgPT4gX3VyaTsNCg0KICAgICAgICAgICAgcHJpdmF0ZSBhc3luYyB2b2lkIFByb2Nlc3NSZXF1ZXN0cygpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IGF3YWl0IF9saXN0ZW5lci5HZXRDb250ZXh0QXN5bmMoKTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIGEgcmVzcG9uc2UgaW4gdGhlIEpTT04gZm9ybWF0IHRoYXQgdGhlIGNsaWVudCBleHBlY3RzDQogICAgICAgICAgICAgICAgICAgIHN0cmluZyB1c2VybmFtZSA9IGNvbnRleHQuVXNlci5JZGVudGl0eS5OYW1lOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb250ZXh0LlJlc3BvbnNlLk91dHB1dFN0cmVhbS5Xcml0ZUFzeW5jKFN5c3RlbS5UZXh0LkVuY29kaW5nLlVURjguR2V0Qnl0ZXMoJCJ7e1wiYXV0aGVudGljYXRlZFwiOiBcInRydWVcIiwgXCJ1c2VyXCI6IFwie3VzZXJuYW1lfVwiIH19IikpOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuUmVzcG9uc2UuQ2xvc2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQo="
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLk5ldC5UZXN0LkNvbW1vbjsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsNCg0KdXNpbmcgWHVuaXQ7DQoNCm5hbWVzcGFjZSBTeXN0ZW0uTmV0Lkh0dHAuRnVuY3Rpb25hbC5UZXN0cw0Kew0KICAgIHB1YmxpYyBhYnN0cmFjdCBjbGFzcyBIdHRwQ2xpZW50SGFuZGxlcl9BdXRoZW50aWNhdGlvbl9UZXN0IDogSHR0cENsaWVudFRlc3RCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBVc2VybmFtZSA9ICJ0ZXN0dXNlcm5hbWUiOw0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBQYXNzd29yZCA9ICJ0ZXN0cGFzc3dvcmQiOw0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBEb21haW4gPSAidGVzdGRvbWFpbiI7DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTmV0d29ya0NyZWRlbnRpYWwgc19jcmVkZW50aWFscyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbChVc2VybmFtZSwgUGFzc3dvcmQsIERvbWFpbik7DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRnVuYzxIdHRwQ2xpZW50SGFuZGxlciwgVXJpLCBIdHRwU3RhdHVzQ29kZSwgSUNyZWRlbnRpYWxzLCBUYXNrPiBzX2NyZWF0ZUFuZFZhbGlkYXRlUmVxdWVzdCA9IGFzeW5jIChoYW5kbGVyLCB1cmwsIGV4cGVjdGVkU3RhdHVzQ29kZSwgY3JlZGVudGlhbHMpID0+DQogICAgICAgIHsNCiAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBjcmVkZW50aWFsczsNCg0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmwpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChleHBlY3RlZFN0YXR1c0NvZGUsIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtNZW1iZXJEYXRhKG5hbWVvZihBdXRoZW50aWNhdGlvbl9UZXN0RGF0YSkpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBIdHRwQ2xpZW50SGFuZGxlcl9BdXRoZW50aWNhdGlvbl9TdWNjZWVkcyhzdHJpbmcgYXV0aGVudGljYXRlSGVhZGVyLCBib29sIHJlc3VsdCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFBsYXRmb3JtRGV0ZWN0aW9uLklzV2luZG93c05hbm9TZXJ2ZXIgfHwgKElzQ3VybEhhbmRsZXIgJiYgYXV0aGVudGljYXRlSGVhZGVyLlRvTG93ZXJJbnZhcmlhbnQoKS5Db250YWlucygiZGlnZXN0IikpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFRPRE86ICMyODA2NTogRml4IGZhaWxpbmcgYXV0aGVudGljYXRpb24gdGVzdCBjYXNlcyBvbiBkaWZmZXJlbnQgaHR0cGNsaWVudGhhbmRsZXJzLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBuZXcgTG9vcGJhY2tTZXJ2ZXIuT3B0aW9ucyB7IERvbWFpbiA9IERvbWFpbiwgVXNlcm5hbWUgPSBVc2VybmFtZSwgUGFzc3dvcmQgPSBQYXNzd29yZCB9Ow0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBzZXJ2ZXJBdXRoZW50aWNhdGVIZWFkZXIgPSAkIldXVy1BdXRoZW50aWNhdGU6IHthdXRoZW50aWNhdGVIZWFkZXJ9XHJcbiI7DQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICAgICAgVGFzayBzZXJ2ZXJUYXNrID0gcmVzdWx0ID8NCiAgICAgICAgICAgICAgICAgICAgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25QZXJmb3JtQXV0aGVudGljYXRpb25BbmRDbG9zZUFzeW5jKHNlcnZlckF1dGhlbnRpY2F0ZUhlYWRlcikgOg0KICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCBzZXJ2ZXJBdXRoZW50aWNhdGVIZWFkZXIpOw0KDQogICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWRXaXRoVGltZW91dChUZXN0SGVscGVyLlBhc3NpbmdUZXN0VGltZW91dE1pbGxpc2Vjb25kcywNCiAgICAgICAgICAgICAgICAgICAgc19jcmVhdGVBbmRWYWxpZGF0ZVJlcXVlc3QoaGFuZGxlciwgdXJsLCByZXN1bHQgPyBIdHRwU3RhdHVzQ29kZS5PSyA6IEh0dHBTdGF0dXNDb2RlLlVuYXV0aG9yaXplZCwgc19jcmVkZW50aWFscyksIHNlcnZlclRhc2spOw0KICAgICAgICAgICAgfSwgb3B0aW9ucyk7DQogICAgICAgIH0NCg0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSgiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsbzFcIlxyXG5XV1ctQXV0aGVudGljYXRlOiBCYXNpYyByZWFsbT1cImhlbGxvMlwiXHJcbiIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbldXVy1BdXRoZW50aWNhdGU6IEJhc2ljIHJlYWxtPVwiaGVsbG9cIlxyXG4iKV0NCiAgICAgICAgW0lubGluZURhdGEoIldXVy1BdXRoZW50aWNhdGU6IERpZ2VzdCByZWFsbT1cImhlbGxvXCIsIG5vbmNlPVwiaGVsbG9cIiwgYWxnb3JpdGhtPU1ENVxyXG5XV1ctQXV0aGVudGljYXRlOiBEaWdlc3QgcmVhbG09XCJoZWxsb1wiLCBub25jZT1cImhlbGxvXCIsIGFsZ29yaXRobT1NRDVcclxuIildDQogICAgICAgIFtJbmxpbmVEYXRhKCJXV1ctQXV0aGVudGljYXRlOiBEaWdlc3QgcmVhbG09XCJoZWxsbzFcIiwgbm9uY2U9XCJoZWxsb1wiLCBhbGdvcml0aG09TUQ1XHJcbldXVy1BdXRoZW50aWNhdGU6IERpZ2VzdCByZWFsbT1cImhlbGxvXCIsIG5vbmNlPVwiaGVsbG9cIiwgYWxnb3JpdGhtPU1ENVxyXG4iKV0NCiAgICAgICAgcHVibGljIGFzeW5jIHZvaWQgSHR0cENsaWVudEhhbmRsZXJfTXVsdGlwbGVBdXRoZW50aWNhdGVIZWFkZXJzX1dpdGhTYW1lQXV0aF9TdWNjZWVkcyhzdHJpbmcgYXV0aGVudGljYXRlSGVhZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNXaW5IdHRwSGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBUT0RPOiAjMjgwNjU6IEZpeCBmYWlsaW5nIGF1dGhlbnRpY2F0aW9uIHRlc3QgY2FzZXMgb24gZGlmZmVyZW50IGh0dHBjbGllbnRoYW5kbGVycy4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGF3YWl0IEh0dHBDbGllbnRIYW5kbGVyX011bHRpcGxlQXV0aGVudGljYXRlSGVhZGVyc19TdWNjZWVkcyhhdXRoZW50aWNhdGVIZWFkZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoIldXVy1BdXRoZW50aWNhdGU6IEJhc2ljIHJlYWxtPVwiaGVsbG9cIlxyXG5XV1ctQXV0aGVudGljYXRlOiBEaWdlc3QgcmVhbG09XCJoZWxsb1wiLCBub25jZT1cImhlbGxvXCIsIGFsZ29yaXRobT1NRDVcclxuIildDQogICAgICAgIFtJbmxpbmVEYXRhKCJXV1ctQXV0aGVudGljYXRlOiBEaWdlc3QgcmVhbG09XCJoZWxsb1wiLCBub25jZT1cImhlbGxvXCIsIGFsZ29yaXRobT1NRDVcclxuV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbiIpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBIdHRwQ2xpZW50SGFuZGxlcl9NdWx0aXBsZUF1dGhlbnRpY2F0ZUhlYWRlcnNfU3VjY2VlZHMoc3RyaW5nIGF1dGhlbnRpY2F0ZUhlYWRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFBsYXRmb3JtRGV0ZWN0aW9uLklzV2luZG93c05hbm9TZXJ2ZXIgfHwgKElzQ3VybEhhbmRsZXIgJiYgYXV0aGVudGljYXRlSGVhZGVyLkNvbnRhaW5zKCJEaWdlc3QiKSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVE9ETzogIzI4MDY1OiBGaXggZmFpbGluZyBhdXRoZW50aWNhdGlvbiB0ZXN0IGNhc2VzIG9uIGRpZmZlcmVudCBodHRwY2xpZW50aGFuZGxlcnMuDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IG5ldyBMb29wYmFja1NlcnZlci5PcHRpb25zIHsgRG9tYWluID0gRG9tYWluLCBVc2VybmFtZSA9IFVzZXJuYW1lLCBQYXNzd29yZCA9IFBhc3N3b3JkIH07DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICAgICAgVGFzayBzZXJ2ZXJUYXNrID0gc2VydmVyLkFjY2VwdENvbm5lY3Rpb25QZXJmb3JtQXV0aGVudGljYXRpb25BbmRDbG9zZUFzeW5jKGF1dGhlbnRpY2F0ZUhlYWRlcik7DQogICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQoc19jcmVhdGVBbmRWYWxpZGF0ZVJlcXVlc3QoaGFuZGxlciwgdXJsLCBIdHRwU3RhdHVzQ29kZS5PSywgc19jcmVkZW50aWFscyksIHNlcnZlclRhc2spOw0KICAgICAgICAgICAgfSwgb3B0aW9ucyk7DQogICAgICAgIH0NCg0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSgiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbldXVy1BdXRoZW50aWNhdGU6IE5UTE1cclxuIiwgIkJhc2ljIiwgIk5lZ290aWF0ZSIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbldXVy1BdXRoZW50aWNhdGU6IERpZ2VzdCByZWFsbT1cImhlbGxvXCIsIG5vbmNlPVwiaGVsbG9cIiwgYWxnb3JpdGhtPU1ENVxyXG5XV1ctQXV0aGVudGljYXRlOiBOVExNXHJcbiIsICJEaWdlc3QiLCAiTmVnb3RpYXRlIildDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEh0dHBDbGllbnRIYW5kbGVyX011bHRpcGxlQXV0aGVudGljYXRlSGVhZGVyc19QaWNrc1N1cHBvcnRlZChzdHJpbmcgYXV0aGVudGljYXRlSGVhZGVyLCBzdHJpbmcgc3VwcG9ydGVkQXV0aCwgc3RyaW5nIHVuc3VwcG9ydGVkQXV0aCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFBsYXRmb3JtRGV0ZWN0aW9uLklzV2luZG93c05hbm9TZXJ2ZXIgfHwgKElzQ3VybEhhbmRsZXIgJiYgYXV0aGVudGljYXRlSGVhZGVyLkNvbnRhaW5zKCJEaWdlc3QiKSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVE9ETzogIzI4MDY1OiBGaXggZmFpbGluZyBhdXRoZW50aWNhdGlvbiB0ZXN0IGNhc2VzIG9uIGRpZmZlcmVudCBodHRwY2xpZW50aGFuZGxlcnMuDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IG5ldyBMb29wYmFja1NlcnZlci5PcHRpb25zIHsgRG9tYWluID0gRG9tYWluLCBVc2VybmFtZSA9IFVzZXJuYW1lLCBQYXNzd29yZCA9IFBhc3N3b3JkIH07DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5Vc2VEZWZhdWx0Q3JlZGVudGlhbHMgPSBmYWxzZTsNCg0KICAgICAgICAgICAgICAgIHZhciBjcmVkZW50aWFscyA9IG5ldyBDcmVkZW50aWFsQ2FjaGUoKTsNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscy5BZGQodXJsLCBzdXBwb3J0ZWRBdXRoLCBuZXcgTmV0d29ya0NyZWRlbnRpYWwoVXNlcm5hbWUsIFBhc3N3b3JkLCBEb21haW4pKTsNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscy5BZGQodXJsLCB1bnN1cHBvcnRlZEF1dGgsIG5ldyBOZXR3b3JrQ3JlZGVudGlhbChVc2VybmFtZSwgUGFzc3dvcmQsIERvbWFpbikpOw0KDQogICAgICAgICAgICAgICAgVGFzayBzZXJ2ZXJUYXNrID0gc2VydmVyLkFjY2VwdENvbm5lY3Rpb25QZXJmb3JtQXV0aGVudGljYXRpb25BbmRDbG9zZUFzeW5jKGF1dGhlbnRpY2F0ZUhlYWRlcik7DQogICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQoc19jcmVhdGVBbmRWYWxpZGF0ZVJlcXVlc3QoaGFuZGxlciwgdXJsLCBIdHRwU3RhdHVzQ29kZS5PSywgY3JlZGVudGlhbHMpLCBzZXJ2ZXJUYXNrKTsNCiAgICAgICAgICAgIH0sIG9wdGlvbnMpOw0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoIldXVy1BdXRoZW50aWNhdGU6IEJhc2ljIHJlYWxtPVwiaGVsbG9cIlxyXG4iKV0NCiAgICAgICAgW0lubGluZURhdGEoIldXVy1BdXRoZW50aWNhdGU6IERpZ2VzdCByZWFsbT1cImhlbGxvXCIsIG5vbmNlPVwidGVzdG5vbmNlXCJcclxuIildDQogICAgICAgIHB1YmxpYyBhc3luYyB2b2lkIEh0dHBDbGllbnRIYW5kbGVyX0luY29ycmVjdENyZWRlbnRpYWxzX0ZhaWxzKHN0cmluZyBhdXRoZW50aWNhdGVIZWFkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBvcHRpb25zID0gbmV3IExvb3BiYWNrU2VydmVyLk9wdGlvbnMgeyBEb21haW4gPSBEb21haW4sIFVzZXJuYW1lID0gVXNlcm5hbWUsIFBhc3N3b3JkID0gUGFzc3dvcmQgfTsNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgICAgICBUYXNrIHNlcnZlclRhc2sgPSBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblBlcmZvcm1BdXRoZW50aWNhdGlvbkFuZENsb3NlQXN5bmMoYXV0aGVudGljYXRlSGVhZGVyKTsNCiAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChzX2NyZWF0ZUFuZFZhbGlkYXRlUmVxdWVzdChoYW5kbGVyLCB1cmwsIEh0dHBTdGF0dXNDb2RlLlVuYXV0aG9yaXplZCwgbmV3IE5ldHdvcmtDcmVkZW50aWFsKCJ3cm9uZ3VzZXIiLCAid3JvbmdwYXNzd29yZCIpKSwgc2VydmVyVGFzayk7DQogICAgICAgICAgICB9LCBvcHRpb25zKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgSUVudW1lcmFibGU8b2JqZWN0W10+IEF1dGhlbnRpY2F0aW9uX1Rlc3REYXRhKCkNCiAgICAgICAgew0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJCYXNpYyByZWFsbT1cInRlc3RyZWFsbVwiIiwgdHJ1ZSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJCYXNpYyAiLCB0cnVlIH07DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgIkJhc2ljIHJlYWxtPXdpdGhvdXRxdW90ZXMiLCB0cnVlIH07DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgImJhc2ljICIsIHRydWUgfTsNCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiYkFzaUMgIiwgdHJ1ZSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJiYXNpYyIsIHRydWUgfTsNCg0KICAgICAgICAgICAgLy8gQWRkIGRpZ2VzdCB0ZXN0cyBmYWlsIG9uIEN1cmxIYW5kbGVyLg0KICAgICAgICAgICAgLy8gVE9ETzogIzI4MDY1OiBGaXggZmFpbGluZyBhdXRoZW50aWNhdGlvbiB0ZXN0IGNhc2VzIG9uIGRpZmZlcmVudCBodHRwY2xpZW50aGFuZGxlcnMuDQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgIkRpZ2VzdCByZWFsbT1cInRlc3RyZWFsbVwiIG5vbmNlPVwidGVzdG5vbmNlXCIiLCBmYWxzZSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICQiRGlnZXN0IHJlYWxtPVwidGVzdHJlYWxtXCIsIG5vbmNlPVwie0NvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcygkIntEYXRlVGltZU9mZnNldC5VdGNOb3d9OlhNaDt6KyQ1fGBpNkh4fX1cIiwgcW9wPWF1dGgtaW50LCBhbGdvcml0aG09TUQ1IikpfVwiIiwgdHJ1ZSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJEaWdlc3QgcmVhbG09XCJhcGlAZXhhbXBsZS5vcmdcIiwgcW9wPVwiYXV0aFwiLCBhbGdvcml0aG09TUQ1LXNlc3MsIG5vbmNlPVwiNVRzUVdMVmRnQmRtclEwWHN4YkRPRFYrNTdRZEZSMzRJOUhBYkMvUlZ2a0tcIiwgIiArDQogICAgICAgICAgICAgICAgICAgICJvcGFxdWU9XCJIUlBDc3NLSlNHakNya3pEZzhPaHdwekNpR1BDaFhZandySTJRbVhEbnNPU1wiLCBjaGFyc2V0PVVURi04LCB1c2VyaGFzaD10cnVlIiwgdHJ1ZSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJkSWdFc1QgcmVhbG09XCJhcGlAZXhhbXBsZS5vcmdcIiwgcW9wPVwiYXV0aFwiLCBhbGdvcml0aG09TUQ1LXNlc3MsIG5vbmNlPVwiNVRzUVdMVmRnQmRtclEwWHN4YkRPRFYrNTdRZEZSMzRJOUhBYkMvUlZ2a0tcIiwgIiArDQogICAgICAgICAgICAgICAgICAgICJvcGFxdWU9XCJIUlBDc3NLSlNHakNya3pEZzhPaHdwekNpR1BDaFhZandySTJRbVhEbnNPU1wiLCBjaGFyc2V0PVVURi04LCB1c2VyaGFzaD10cnVlIiwgdHJ1ZSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICQiQmFzaWMgcmVhbG09XCJ0ZXN0cmVhbG1cIiwgIiArDQogICAgICAgICAgICAgICAgICAgICQiRGlnZXN0IHJlYWxtPVwidGVzdHJlYWxtXCIsIG5vbmNlPVwie0NvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcygkIntEYXRlVGltZU9mZnNldC5VdGNOb3d9OlhNaDt6KyQ1fGBpNkh4fX0iKSl9XCIsIGFsZ29yaXRobT1NRDUiLCB0cnVlIH07DQoNCiAgICAgICAgICAgIGlmIChQbGF0Zm9ybURldGVjdGlvbi5Jc05ldENvcmUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVE9ETzogIzI4MDYwOiBGaXggZmFpbGluZyBhdXRoZW50aWNhdGlvbiB0ZXN0IGNhc2VzIG9uIEZyYW1ld29yayBydW4uDQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJEaWdlc3QgcmVhbG09XCJ0ZXN0cmVhbG0xXCIsIG5vbmNlPVwidGVzdG5vbmNlMVwiIERpZ2VzdCByZWFsbT1cInRlc3RyZWFsbTJcIiwgbm9uY2U9XCJ0ZXN0bm9uY2UyXCIiLCBmYWxzZSB9Ow0KICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiQmFzaWMgc29tZXRoaW5nLCBEaWdlc3Qgc29tZXRoaW5nIiwgZmFsc2UgfTsNCiAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgJCJEaWdlc3QgcmVhbG09XCJ0ZXN0cmVhbG1cIiwgbm9uY2U9XCJ0ZXN0bm9uY2VcIiwgYWxnb3JpdGhtPU1ENSAiICsNCiAgICAgICAgICAgICAgICAgICAgJCJCYXNpYyByZWFsbT1cInRlc3RyZWFsbVwiIiwgZmFsc2UgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKG51bGwpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiQmFzaWMiKV0NCiAgICAgICAgW0lubGluZURhdGEoIkRpZ2VzdCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiTlRMTSIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiS2VyYmVyb3MiKV0NCiAgICAgICAgW0lubGluZURhdGEoIk5lZ290aWF0ZSIpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQcmVBdXRoZW50aWNhdGVfTm9QcmV2aW91c0F1dGhlbnRpY2F0ZWRSZXF1ZXN0c19Ob0NyZWRlbnRpYWxzU2VudChzdHJpbmcgY3JlZENhY2hlU2NoZW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNDdXJsSGFuZGxlciAmJiBjcmVkQ2FjaGVTY2hlbWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBXaGVuIHByb3ZpZGVkIHdpdGggYSBjcmVkZW50aWFsIHRoYXQgdGFyZ2V0cyBqdXN0IG9uZSBhdXRoIHNjaGVtZSwNCiAgICAgICAgICAgICAgICAvLyBsaWJjdXJsIHdpbGwgb2Z0ZW4gcHJvYWN0aXZlbHkgc2VuZCBhbiBhdXRoIGhlYWRlci4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnN0IGludCBOdW1SZXF1ZXN0cyA9IDM7DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVDbGllbnRBbmRTZXJ2ZXJBc3luYyhhc3luYyB1cmkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNsaWVudC5EZWZhdWx0UmVxdWVzdEhlYWRlcnMuQ29ubmVjdGlvbkNsb3NlID0gdHJ1ZTsgLy8gZm9yIHNpbXBsaWNpdHkgb2Ygbm90IG5lZWRpbmcgdG8ga25vdyBldmVyeSBoYW5kbGVyJ3MgcG9vbGluZyBwb2xpY3kNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5QcmVBdXRoZW50aWNhdGUgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGNyZWRDYWNoZVNjaGVtZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBudWxsOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBzX2NyZWRlbnRpYWxzOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjYyA9IG5ldyBDcmVkZW50aWFsQ2FjaGUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5BZGQodXJpLCBjcmVkQ2FjaGVTY2hlbWUsIHNfY3JlZGVudGlhbHMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBjYzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgTnVtUmVxdWVzdHM7IGkrKykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJoZWxsbyB3b3JsZCIsIGF3YWl0IGNsaWVudC5HZXRTdHJpbmdBc3luYyh1cmkpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBhc3luYyBzZXJ2ZXIgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IE51bVJlcXVlc3RzOyBpKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhjb250ZW50OiAiaGVsbG8gd29ybGQiKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkFsbChoZWFkZXJzLCBoZWFkZXIgPT4gQXNzZXJ0LkRvZXNOb3RDb250YWluKCJBdXRob3JpemF0aW9uIiwgaGVhZGVyKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YShudWxsLCAiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbiIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiQmFzaWMiLCAiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbiIpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQcmVBdXRoZW50aWNhdGVfRmlyc3RSZXF1ZXN0Tm9IZWFkZXJBbmRBdXRoZW50aWNhdGVzX1NlY29uZFJlcXVlc3RQcmVhdXRoZW50aWNhdGVzKHN0cmluZyBjcmVkQ2FjaGVTY2hlbWUsIHN0cmluZyBhdXRoUmVzcG9uc2UpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChJc0N1cmxIYW5kbGVyICYmIGNyZWRDYWNoZVNjaGVtZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFdoZW4gcHJvdmlkZWQgd2l0aCBhIGNyZWRlbnRpYWwgdGhhdCB0YXJnZXRzIGp1c3Qgb25lIGF1dGggc2NoZW1lLA0KICAgICAgICAgICAgICAgIC8vIGxpYmN1cmwgd2lsbCBvZnRlbiBwcm9hY3RpdmVseSBzZW5kIGFuIGF1dGggaGVhZGVyLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlQ2xpZW50QW5kU2VydmVyQXN5bmMoYXN5bmMgdXJpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjbGllbnQuRGVmYXVsdFJlcXVlc3RIZWFkZXJzLkNvbm5lY3Rpb25DbG9zZSA9IHRydWU7IC8vIGZvciBzaW1wbGljaXR5IG9mIG5vdCBuZWVkaW5nIHRvIGtub3cgZXZlcnkgaGFuZGxlcidzIHBvb2xpbmcgcG9saWN5DQogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuUHJlQXV0aGVudGljYXRlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjcmVkQ2FjaGVTY2hlbWUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgbnVsbDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLkNyZWRlbnRpYWxzID0gc19jcmVkZW50aWFsczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2MgPSBuZXcgQ3JlZGVudGlhbENhY2hlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2MuQWRkKHVyaSwgY3JlZENhY2hlU2NoZW1lLCBzX2NyZWRlbnRpYWxzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLkNyZWRlbnRpYWxzID0gY2M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoImhlbGxvIHdvcmxkIiwgYXdhaXQgY2xpZW50LkdldFN0cmluZ0FzeW5jKHVyaSkpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoImhlbGxvIHdvcmxkIiwgYXdhaXQgY2xpZW50LkdldFN0cmluZ0FzeW5jKHVyaSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBhc3luYyBzZXJ2ZXIgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhIdHRwU3RhdHVzQ29kZS5VbmF1dGhvcml6ZWQsIGF1dGhSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkFsbChoZWFkZXJzLCBoZWFkZXIgPT4gQXNzZXJ0LkRvZXNOb3RDb250YWluKCJBdXRob3JpemF0aW9uIiwgaGVhZGVyKSk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDI7IGkrKykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoY29udGVudDogImhlbGxvIHdvcmxkIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhoZWFkZXJzLCBoZWFkZXIgPT4gaGVhZGVyLkNvbnRhaW5zKCJBdXRob3JpemF0aW9uIikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gSW5saW5lRGF0YXMgZm9yIGFsbCB2YWx1ZXMgdGhhdCBwYXNzIG9uIFdpbkh0dHBIYW5kbGVyLCB3aGljaCBpcyB0aGUgbW9zdCByZXN0cmljdGl2ZS4NCiAgICAgICAgLy8gVXNlcyBudW1lcmljYWwgdmFsdWVzIGZvciB2YWx1ZXMgbmFtZWQgaW4gLk5FVCBDb3JlIGFuZCBub3QgaW4gLk5FVCBGcmFtZXdvcmsuDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLk9LKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuQ3JlYXRlZCldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLkFjY2VwdGVkKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuTm9uQXV0aG9yaXRhdGl2ZUluZm9ybWF0aW9uKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuTm9Db250ZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuUmVzZXRDb250ZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuUGFydGlhbENvbnRlbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgoSHR0cFN0YXR1c0NvZGUpMjA3KV0gLy8gTXVsdGlTdGF0dXMNCiAgICAgICAgW0lubGluZURhdGEoKEh0dHBTdGF0dXNDb2RlKTIwOCldIC8vIEFscmVhZHlSZXBvcnRlZA0KICAgICAgICBbSW5saW5lRGF0YSgoSHR0cFN0YXR1c0NvZGUpMjI2KV0gLy8gSU1Vc2VkDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLkFtYmlndW91cyldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLkFtYmlndW91cyldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLk5vdE1vZGlmaWVkKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuVXNlUHJveHkpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5VbnVzZWQpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5CYWRSZXF1ZXN0KV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuUGF5bWVudFJlcXVpcmVkKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuRm9yYmlkZGVuKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuTm90Rm91bmQpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5NZXRob2ROb3RBbGxvd2VkKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuTm90QWNjZXB0YWJsZSldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLlJlcXVlc3RUaW1lb3V0KV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuQ29uZmxpY3QpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5Hb25lKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuTGVuZ3RoUmVxdWlyZWQpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5QcmVjb25kaXRpb25GYWlsZWQpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5SZXF1ZXN0RW50aXR5VG9vTGFyZ2UpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5SZXF1ZXN0VXJpVG9vTG9uZyldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLlVuc3VwcG9ydGVkTWVkaWFUeXBlKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuUmVxdWVzdGVkUmFuZ2VOb3RTYXRpc2ZpYWJsZSldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLkV4cGVjdGF0aW9uRmFpbGVkKV0NCiAgICAgICAgW0lubGluZURhdGEoKEh0dHBTdGF0dXNDb2RlKTQyMSldIC8vIE1pc2RpcmVjdGVkUmVxdWVzdA0KICAgICAgICBbSW5saW5lRGF0YSgoSHR0cFN0YXR1c0NvZGUpNDIyKV0gLy8gVW5wcm9jZXNzYWJsZUVudGl0eQ0KICAgICAgICBbSW5saW5lRGF0YSgoSHR0cFN0YXR1c0NvZGUpNDIzKV0gLy8gTG9ja2VkDQogICAgICAgIFtJbmxpbmVEYXRhKChIdHRwU3RhdHVzQ29kZSk0MjQpXSAvLyBGYWlsZWREZXBlbmRlbmN5DQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLlVwZ3JhZGVSZXF1aXJlZCldDQogICAgICAgIFtJbmxpbmVEYXRhKChIdHRwU3RhdHVzQ29kZSk0MjgpXSAvLyBQcmVjb25kaXRpb25SZXF1aXJlZA0KICAgICAgICBbSW5saW5lRGF0YSgoSHR0cFN0YXR1c0NvZGUpNDI5KV0gLy8gVG9vTWFueVJlcXVlc3RzDQogICAgICAgIFtJbmxpbmVEYXRhKChIdHRwU3RhdHVzQ29kZSk0MzEpXSAvLyBSZXF1ZXN0SGVhZGVyRmllbGRzVG9vTGFyZ2UNCiAgICAgICAgW0lubGluZURhdGEoKEh0dHBTdGF0dXNDb2RlKTQ1MSldIC8vIFVuYXZhaWxhYmxlRm9yTGVnYWxSZWFzb25zDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLkludGVybmFsU2VydmVyRXJyb3IpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5Ob3RJbXBsZW1lbnRlZCldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLkJhZEdhdGV3YXkpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5TZXJ2aWNlVW5hdmFpbGFibGUpXQ0KICAgICAgICBbSW5saW5lRGF0YShIdHRwU3RhdHVzQ29kZS5HYXRld2F5VGltZW91dCldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLkh0dHBWZXJzaW9uTm90U3VwcG9ydGVkKV0NCiAgICAgICAgW0lubGluZURhdGEoKEh0dHBTdGF0dXNDb2RlKTUwNildIC8vIFZhcmlhbnRBbHNvTmVnb3RpYXRlcw0KICAgICAgICBbSW5saW5lRGF0YSgoSHR0cFN0YXR1c0NvZGUpNTA3KV0gLy8gSW5zdWZmaWNpZW50U3RvcmFnZQ0KICAgICAgICBbSW5saW5lRGF0YSgoSHR0cFN0YXR1c0NvZGUpNTA4KV0gLy8gTG9vcERldGVjdGVkDQogICAgICAgIFtJbmxpbmVEYXRhKChIdHRwU3RhdHVzQ29kZSk1MTApXSAvLyBOb3RFeHRlbmRlZA0KICAgICAgICBbSW5saW5lRGF0YSgoSHR0cFN0YXR1c0NvZGUpNTExKV0gLy8gTmV0d29ya0F1dGhlbnRpY2F0aW9uUmVxdWlyZWQNCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJlQXV0aGVudGljYXRlX0ZpcnN0UmVxdWVzdE5vSGVhZGVyX1NlY29uZFJlcXVlc3RWYXJpb3VzU3RhdHVzQ29kZXNfVGhpcmRSZXF1ZXN0UHJlYXV0aGVudGljYXRlcyhIdHRwU3RhdHVzQ29kZSBzdGF0dXNDb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBjb25zdCBzdHJpbmcgQXV0aFJlc3BvbnNlID0gIldXVy1BdXRoZW50aWNhdGU6IEJhc2ljIHJlYWxtPVwiaGVsbG9cIlxyXG4iOw0KDQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVDbGllbnRBbmRTZXJ2ZXJBc3luYyhhc3luYyB1cmkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNsaWVudC5EZWZhdWx0UmVxdWVzdEhlYWRlcnMuQ29ubmVjdGlvbkNsb3NlID0gdHJ1ZTsgLy8gZm9yIHNpbXBsaWNpdHkgb2Ygbm90IG5lZWRpbmcgdG8ga25vdyBldmVyeSBoYW5kbGVyJ3MgcG9vbGluZyBwb2xpY3kNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5QcmVBdXRoZW50aWNhdGUgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLkNyZWRlbnRpYWxzID0gc19jcmVkZW50aWFsczsNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LkRlZmF1bHRSZXF1ZXN0SGVhZGVycy5FeHBlY3RDb250aW51ZSA9IGZhbHNlOw0KDQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3AgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJpKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHN0YXR1c0NvZGUsIHJlc3AuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJoZWxsbyB3b3JsZCIsIGF3YWl0IGNsaWVudC5HZXRTdHJpbmdBc3luYyh1cmkpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYXN5bmMgc2VydmVyID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGhlYWRlcnMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCBBdXRoUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5BbGwoaGVhZGVycywgaGVhZGVyID0+IEFzc2VydC5Eb2VzTm90Q29udGFpbigiQXV0aG9yaXphdGlvbiIsIGhlYWRlcikpOw0KDQogICAgICAgICAgICAgICAgaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhzdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoaGVhZGVycywgaGVhZGVyID0+IGhlYWRlci5Db250YWlucygiQXV0aG9yaXphdGlvbiIpKTsNCg0KICAgICAgICAgICAgICAgIGhlYWRlcnMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuT0ssIGNvbnRlbnQ6ICJoZWxsbyB3b3JsZCIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhoZWFkZXJzLCBoZWFkZXIgPT4gaGVhZGVyLkNvbnRhaW5zKCJBdXRob3JpemF0aW9uIikpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSgiL3NvbWV0aGluZy9oZWxsby5odG1sIiwgIi9zb21ldGhpbmcvaGVsbG8uaHRtbCIsIHRydWUpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiL3NvbWV0aGluZy9oZWxsby5odG1sIiwgIi9zb21ldGhpbmcvd29ybGQuaHRtbCIsIHRydWUpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiL3NvbWV0aGluZy9oZWxsby5odG1sIiwgIi9zb21ldGhpbmcvIiwgdHJ1ZSldDQogICAgICAgIFtJbmxpbmVEYXRhKCIvc29tZXRoaW5nL2hlbGxvLmh0bWwiLCAiLyIsIGZhbHNlKV0NCiAgICAgICAgW0lubGluZURhdGEoIi9zb21ldGhpbmcvaGVsbG8uaHRtbCIsICIvaGVsbG8uaHRtbCIsIGZhbHNlKV0NCiAgICAgICAgW0lubGluZURhdGEoIi9zb21ldGhpbmcvaGVsbG8uaHRtbCIsICIvd29ybGQuaHRtbCIsIGZhbHNlKV0NCiAgICAgICAgW0lubGluZURhdGEoIi9zb21ldGhpbmcvaGVsbG8uaHRtbCIsICIvYW5vdGhlci8iLCBmYWxzZSldDQogICAgICAgIFtJbmxpbmVEYXRhKCIvc29tZXRoaW5nL2hlbGxvLmh0bWwiLCAiL2Fub3RoZXIvaGVsbG8uaHRtbCIsIGZhbHNlKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJlQXV0aGVudGljYXRlX0F1dGhlbnRpY2F0ZWRVcmxfVGhlblRyeURpZmZlcmVudFVybF9TZW5kc0F1dGhIZWFkZXJPbmx5SWZQcmVmaXhNYXRjaGVzKA0KICAgICAgICAgICAgc3RyaW5nIG9yaWdpbmFsUmVsYXRpdmVVcmksIHN0cmluZyBzZWNvbmRSZWxhdGl2ZVVyaSwgYm9vbCBleHBlY3RlZEF1dGhIZWFkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGNvbnN0IHN0cmluZyBBdXRoUmVzcG9uc2UgPSAiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbiI7DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LkRlZmF1bHRSZXF1ZXN0SGVhZGVycy5Db25uZWN0aW9uQ2xvc2UgPSB0cnVlOyAvLyBmb3Igc2ltcGxpY2l0eSBvZiBub3QgbmVlZGluZyB0byBrbm93IGV2ZXJ5IGhhbmRsZXIncyBwb29saW5nIHBvbGljeQ0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLlByZUF1dGhlbnRpY2F0ZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBzX2NyZWRlbnRpYWxzOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiaGVsbG8gd29ybGQgMSIsIGF3YWl0IGNsaWVudC5HZXRTdHJpbmdBc3luYyhuZXcgVXJpKHVyaSwgb3JpZ2luYWxSZWxhdGl2ZVVyaSkpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJoZWxsbyB3b3JsZCAyIiwgYXdhaXQgY2xpZW50LkdldFN0cmluZ0FzeW5jKG5ldyBVcmkodXJpLCBzZWNvbmRSZWxhdGl2ZVVyaSkpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYXN5bmMgc2VydmVyID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGhlYWRlcnMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCBBdXRoUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5BbGwoaGVhZGVycywgaGVhZGVyID0+IEFzc2VydC5Eb2VzTm90Q29udGFpbigiQXV0aG9yaXphdGlvbiIsIGhlYWRlcikpOw0KDQogICAgICAgICAgICAgICAgaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhjb250ZW50OiAiaGVsbG8gd29ybGQgMSIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhoZWFkZXJzLCBoZWFkZXIgPT4gaGVhZGVyLkNvbnRhaW5zKCJBdXRob3JpemF0aW9uIikpOw0KDQogICAgICAgICAgICAgICAgaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhjb250ZW50OiAiaGVsbG8gd29ybGQgMiIpOw0KICAgICAgICAgICAgICAgIGlmIChleHBlY3RlZEF1dGhIZWFkZXIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoaGVhZGVycywgaGVhZGVyID0+IGhlYWRlci5Db250YWlucygiQXV0aG9yaXphdGlvbiIpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkFsbChoZWFkZXJzLCBoZWFkZXIgPT4gQXNzZXJ0LkRvZXNOb3RDb250YWluKCJBdXRob3JpemF0aW9uIiwgaGVhZGVyKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJlQXV0aGVudGljYXRlX1N1Y2Nlc3NmdWxCYXNpY0J1dFRoZW5GYWlsc19Eb2VzbnRMb29wSW5maW5pdGVseSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LkRlZmF1bHRSZXF1ZXN0SGVhZGVycy5Db25uZWN0aW9uQ2xvc2UgPSB0cnVlOyAvLyBmb3Igc2ltcGxpY2l0eSBvZiBub3QgbmVlZGluZyB0byBrbm93IGV2ZXJ5IGhhbmRsZXIncyBwb29saW5nIHBvbGljeQ0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLlByZUF1dGhlbnRpY2F0ZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBzX2NyZWRlbnRpYWxzOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IHR3byByZXF1ZXN0czogaW5pdGlhbGx5IHdpdGhvdXQgYXV0aCBoZWFkZXIsIHRoZW4gd2l0aA0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoImhlbGxvIHdvcmxkIiwgYXdhaXQgY2xpZW50LkdldFN0cmluZ0FzeW5jKHVyaSkpOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIEF0dGVtcHQgcHJlYXV0aCwgYW5kIHdoZW4gdGhhdCBmYWlscywgZ2l2ZSB1cC4NCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcCA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmkpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCByZXNwLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGFzeW5jIHNlcnZlciA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIEZpcnN0IHJlcXVlc3QsIG5vIGF1dGggaGVhZGVyLCBjaGFsbGVuZ2UgQmFzaWMNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gaGVhZGVycyA9IGhlYWRlcnMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCAiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbiIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5BbGwoaGVhZGVycywgaGVhZGVyID0+IEFzc2VydC5Eb2VzTm90Q29udGFpbigiQXV0aG9yaXphdGlvbiIsIGhlYWRlcikpOw0KDQogICAgICAgICAgICAgICAgLy8gU2Vjb25kIHJlcXVlc3QsIGNvbnRhaW5zIEJhc2ljIGF1dGggaGVhZGVyDQogICAgICAgICAgICAgICAgaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhjb250ZW50OiAiaGVsbG8gd29ybGQiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoaGVhZGVycywgaGVhZGVyID0+IGhlYWRlci5Db250YWlucygiQXV0aG9yaXphdGlvbiIpKTsNCg0KICAgICAgICAgICAgICAgIC8vIFRoaXJkIHJlcXVlc3QsIGNvbnRhaW5zIEJhc2ljIGF1dGggaGVhZGVyIGJ1dCBjaGFsbGVuZ2VzIGFueXdheQ0KICAgICAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzID0gYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKEh0dHBTdGF0dXNDb2RlLlVuYXV0aG9yaXplZCwgIldXVy1BdXRoZW50aWNhdGU6IEJhc2ljIHJlYWxtPVwiaGVsbG9cIlxyXG4iKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoaGVhZGVycywgaGVhZGVyID0+IGhlYWRlci5Db250YWlucygiQXV0aG9yaXphdGlvbiIpKTsNCg0KICAgICAgICAgICAgICAgIGlmIChJc05ldGZ4SGFuZGxlcikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIEZvciBzb21lIHJlYXNvbiwgbmV0ZnggdHJpZXMgb25lIG1vcmUgdGltZS4NCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCAiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbiIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoaGVhZGVycywgaGVhZGVyID0+IGhlYWRlci5Db250YWlucygiQXV0aG9yaXphdGlvbiIpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQcmVBdXRoZW50aWNhdGVfU3VjY2Vzc2Z1bEJhc2ljX1RoZW5EaWdlc3RDaGFsbGVuZ2VkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzV2luSHR0cEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gV2luSHR0cEhhbmRsZXIgZmFpbHMgd2l0aCBVbmF1dGhvcml6ZWQgYWZ0ZXIgdGhlIGJhc2ljIHByZWF1dGggZmFpbHMuDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoSXNDdXJsSGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBXaGVuIHByb3ZpZGVkIHdpdGggYSBjcmVkZW50aWFsIHRoYXQgdGFyZ2V0cyBqdXN0IG9uZSBhdXRoIHNjaGVtZSwNCiAgICAgICAgICAgICAgICAvLyBsaWJjdXJsIHdpbGwgb2Z0ZW4gcHJvYWN0aXZlbHkgc2VuZCBhbiBhdXRoIGhlYWRlci4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LkRlZmF1bHRSZXF1ZXN0SGVhZGVycy5Db25uZWN0aW9uQ2xvc2UgPSB0cnVlOyAvLyBmb3Igc2ltcGxpY2l0eSBvZiBub3QgbmVlZGluZyB0byBrbm93IGV2ZXJ5IGhhbmRsZXIncyBwb29saW5nIHBvbGljeQ0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLlByZUF1dGhlbnRpY2F0ZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBzX2NyZWRlbnRpYWxzOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiaGVsbG8gd29ybGQiLCBhd2FpdCBjbGllbnQuR2V0U3RyaW5nQXN5bmModXJpKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiaGVsbG8gd29ybGQiLCBhd2FpdCBjbGllbnQuR2V0U3RyaW5nQXN5bmModXJpKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGFzeW5jIHNlcnZlciA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIEZpcnN0IHJlcXVlc3QsIG5vIGF1dGggaGVhZGVyLCBjaGFsbGVuZ2UgQmFzaWMNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gaGVhZGVycyA9IGhlYWRlcnMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCAiV1dXLUF1dGhlbnRpY2F0ZTogQmFzaWMgcmVhbG09XCJoZWxsb1wiXHJcbiIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5BbGwoaGVhZGVycywgaGVhZGVyID0+IEFzc2VydC5Eb2VzTm90Q29udGFpbigiQXV0aG9yaXphdGlvbiIsIGhlYWRlcikpOw0KDQogICAgICAgICAgICAgICAgLy8gU2Vjb25kIHJlcXVlc3QsIGNvbnRhaW5zIEJhc2ljIGF1dGggaGVhZGVyLCBzdWNjZXNzDQogICAgICAgICAgICAgICAgaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhjb250ZW50OiAiaGVsbG8gd29ybGQiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoaGVhZGVycywgaGVhZGVyID0+IGhlYWRlci5Db250YWlucygiQXV0aG9yaXphdGlvbiIpKTsNCg0KICAgICAgICAgICAgICAgIC8vIFRoaXJkIHJlcXVlc3QsIGNvbnRhaW5zIEJhc2ljIGF1dGggaGVhZGVyLCBjaGFsbGVuZ2UgZGlnZXN0DQogICAgICAgICAgICAgICAgaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhIdHRwU3RhdHVzQ29kZS5VbmF1dGhvcml6ZWQsICJXV1ctQXV0aGVudGljYXRlOiBEaWdlc3QgcmVhbG09XCJoZWxsb1wiLCBub25jZT1cInRlc3Rub25jZVwiXHJcbiIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhoZWFkZXJzLCBoZWFkZXIgPT4gaGVhZGVyLkNvbnRhaW5zKCJBdXRob3JpemF0aW9uOiBCYXNpYyIpKTsNCg0KICAgICAgICAgICAgICAgIC8vIEZvdXJ0aCByZXF1ZXN0LCBjb250YWlucyBEaWdlc3QgYXV0aCBoZWFkZXIsIHN1Y2Nlc3MNCiAgICAgICAgICAgICAgICBoZWFkZXJzID0gYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKGNvbnRlbnQ6ICJoZWxsbyB3b3JsZCIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhoZWFkZXJzLCBoZWFkZXIgPT4gaGVhZGVyLkNvbnRhaW5zKCJBdXRob3JpemF0aW9uOiBEaWdlc3QiKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KdXNpbmcgU3lzdGVtLk5ldC5UZXN0LkNvbW1vbjsNCnVzaW5nIFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlczsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsNCnVzaW5nIFh1bml0Ow0KDQpuYW1lc3BhY2UgU3lzdGVtLk5ldC5IdHRwLkZ1bmN0aW9uYWwuVGVzdHMNCnsNCiAgICB1c2luZyBDb25maWd1cmF0aW9uID0gU3lzdGVtLk5ldC5UZXN0LkNvbW1vbi5Db25maWd1cmF0aW9uOw0KDQogICAgcHVibGljIGFic3RyYWN0IGNsYXNzIEh0dHBDbGllbnRIYW5kbGVyX0RlZmF1bHRQcm94eUNyZWRlbnRpYWxzX1Rlc3QgOiBIdHRwQ2xpZW50VGVzdEJhc2UNCiAgICB7DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBEZWZhdWx0X0dldF9OdWxsKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKGhhbmRsZXIuRGVmYXVsdFByb3h5Q3JlZGVudGlhbHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFNldEdldF9Sb3VuZHRyaXBzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBjcmVkcyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbCgidXNlcm5hbWUiLCAicGFzc3dvcmQiLCAiZG9tYWluIik7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkRlZmF1bHRQcm94eUNyZWRlbnRpYWxzID0gbnVsbDsNCiAgICAgICAgICAgICAgICBBc3NlcnQuTnVsbChoYW5kbGVyLkRlZmF1bHRQcm94eUNyZWRlbnRpYWxzKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuRGVmYXVsdFByb3h5Q3JlZGVudGlhbHMgPSBjcmVkczsNCiAgICAgICAgICAgICAgICBBc3NlcnQuU2FtZShjcmVkcywgaGFuZGxlci5EZWZhdWx0UHJveHlDcmVkZW50aWFscyk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkRlZmF1bHRQcm94eUNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHRDcmVkZW50aWFsczsNCiAgICAgICAgICAgICAgICBBc3NlcnQuU2FtZShDcmVkZW50aWFsQ2FjaGUuRGVmYXVsdENyZWRlbnRpYWxzLCBoYW5kbGVyLkRlZmF1bHRQcm94eUNyZWRlbnRpYWxzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtBY3RpdmVJc3N1ZSgyMzcwMiwgVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrKV0NCiAgICAgICAgW0FjdGl2ZUlzc3VlKDIwMDEwLCBUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXApXQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJveHlFeHBsaWNpdGx5UHJvdmlkZWRfRGVmYXVsdENyZWRlbnRpYWxzX0lnbm9yZWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgZXhwbGljaXRQcm94eUNyZWRzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKCJyaWdodHVzZXJuYW1lIiwgInJpZ2h0cGFzc3dvcmQiKTsNCiAgICAgICAgICAgIHZhciBkZWZhdWx0U3lzdGVtUHJveHlDcmVkcyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbCgid3Jvbmd1c2VybmFtZSIsICJ3cm9uZ3Bhc3N3b3JkIik7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0Q3JlZHMgPSAiQmFzaWMgIiArIENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoU3lzdGVtLlRleHQuRW5jb2RpbmcuVVRGOC5HZXRCeXRlcygkIntleHBsaWNpdFByb3h5Q3JlZHMuVXNlck5hbWV9OntleHBsaWNpdFByb3h5Q3JlZHMuUGFzc3dvcmR9IikpOw0KDQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAocHJveHlTZXJ2ZXIsIHByb3h5VXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5Qcm94eSA9IG5ldyBVc2VTcGVjaWZpZWRVcmlXZWJQcm94eShwcm94eVVybCwgZXhwbGljaXRQcm94eUNyZWRzKTsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5EZWZhdWx0UHJveHlDcmVkZW50aWFscyA9IGRlZmF1bHRTeXN0ZW1Qcm94eUNyZWRzOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIFVSTCBkb2VzIG5vdCBtYXR0ZXIuIFdlIHdpbGwgZ2V0IHJlc3BvbnNlIGZyb20gInByb3h5IiBjb2RlIGJlbGxvdy4NCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiByZXNwb25zZVRhc2sgPSBjbGllbnQuR2V0QXN5bmMoImh0dHA6Ly9ub3RhdHJlYWxzZXJ2ZXIuY29tLyIpOw0KDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHByb3h5U2VydmVyLkFjY2VwdENvbm5lY3Rpb25Bc3luYyhhc3luYyBjb25uZWN0aW9uID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBoZWFkZXJzID0gYXdhaXQgY29ubmVjdGlvbi5SZWFkUmVxdWVzdEhlYWRlckFzeW5jKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghSXNDdXJsSGFuZGxlcikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXJsIHNlbmRzIEJhc2ljIGF1dGggd2l0aG91dCBhc2tpbmcsIG90aGVyIGhhbmRsZXJzIHdhaXQgZm9yIDQwNy4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlNlbmRSZXNwb25zZUFzeW5jKEh0dHBTdGF0dXNDb2RlLlByb3h5QXV0aGVudGljYXRpb25SZXF1aXJlZCwgIlByb3h5LUF1dGhlbnRpY2F0ZTogQmFzaWNcclxuIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IGF3YWl0IGNvbm5lY3Rpb24uUmVhZFJlcXVlc3RIZWFkZXJBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBWZXJpZnkgdGhhdCB3ZSBnb3QgZXhwbGljaXRQcm94eUNyZWRzLg0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGV4cGVjdENyZWRzLCBMb29wYmFja1NlcnZlci5HZXRSZXF1ZXN0SGVhZGVyVmFsdWUoaGVhZGVycywgIlByb3h5LUF1dGhvcml6YXRpb24iKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2sgc2VydmVyVGFzayA9IGNvbm5lY3Rpb24uU2VuZFJlc3BvbnNlQXN5bmMoSHR0cFN0YXR1c0NvZGUuT0spOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChzZXJ2ZXJUYXNrLCByZXNwb25zZVRhc2spOw0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IHJlc3BvbnNlVGFzay5SZXN1bHQ7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChyZXNwb25zZS5TdGF0dXNDb2RlLCBIdHRwU3RhdHVzQ29kZS5PSyk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YShmYWxzZSldDQogICAgICAgIFtJbmxpbmVEYXRhKHRydWUpXQ0KICAgICAgICBbQWN0aXZlSXNzdWUoMjU2NDAsIFRlc3RQbGF0Zm9ybXMuV2luZG93cyldIC8vIFRPRE8gSXQgc2hvdWxkIGJlIGVuYWJsZWQgZm9yIFNvY2tldHNIdHRwSGFuZGxlciBvbiBhbGwgcGxhdGZvcm1zDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFByb3h5U2V0VmlhRW52aXJvbm1lbnRWYXJpYWJsZV9EZWZhdWx0UHJveHlDcmVkZW50aWFsc1VzZWQoYm9vbCB1c2VQcm94eSkNCiAgICAgICAgew0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIEV4cGVjdGVkVXNlcm5hbWUgPSAicmlnaHR1c2VybmFtZSI7DQogICAgICAgICAgICBjb25zdCBzdHJpbmcgRXhwZWN0ZWRQYXNzd29yZCA9ICJyaWdodHBhc3N3b3JkIjsNCiAgICAgICAgICAgIExvb3BiYWNrU2VydmVyLk9wdGlvbnMgb3B0aW9ucyA9IG5ldyBMb29wYmFja1NlcnZlci5PcHRpb25zIHsgSXNQcm94eSA9IHRydWUsIFVzZXJuYW1lID0gRXhwZWN0ZWRVc2VybmFtZSwgUGFzc3dvcmQgPSBFeHBlY3RlZFBhc3N3b3JkIH07DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChwcm94eVNlcnZlciwgcHJveHlVcmkpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gbGliY3VybCB3aWxsIHJlYWQgYSBkZWZhdWx0IHByb3h5IGZyb20gdGhlIGh0dHBfcHJveHkgZW52aXJvbm1lbnQgdmFyaWFibGUuICBFbnN1cmUgdGhhdCB3aGVuIGl0IGRvZXMsDQogICAgICAgICAgICAgICAgLy8gb3VyIGRlZmF1bHQgcHJveHkgY3JlZGVudGlhbHMgYXJlIHVzZWQuICBUbyBhdm9pZCBtZXNzaW5nIHVwIGFueXRoaW5nIGVsc2UgaW4gdGhpcyBwcm9jZXNzLCB3ZSBydW4gdGhlDQogICAgICAgICAgICAgICAgLy8gdGVzdCBpbiBhbm90aGVyIHByb2Nlc3MuDQogICAgICAgICAgICAgICAgdmFyIHBzaSA9IG5ldyBQcm9jZXNzU3RhcnRJbmZvKCk7DQogICAgICAgICAgICAgICAgVGFzazxMaXN0PHN0cmluZz4+IHByb3h5VGFzayA9IG51bGw7DQoNCiAgICAgICAgICAgICAgICBpZiAodXNlUHJveHkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBwcm94eVRhc2sgPSBwcm94eVNlcnZlci5BY2NlcHRDb25uZWN0aW9uUGVyZm9ybUF1dGhlbnRpY2F0aW9uQW5kQ2xvc2VBc3luYygiUHJveHktQXV0aGVudGljYXRlOiBCYXNpYyByZWFsbT1cIk5ldENvcmVcIlxyXG4iKTsNCiAgICAgICAgICAgICAgICAgICAgcHNpLkVudmlyb25tZW50LkFkZCgiaHR0cF9wcm94eSIsICQiaHR0cDovL3twcm94eVVyaS5Ib3N0fTp7cHJveHlVcmkuUG9ydH0iKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBSZW1vdGVJbnZva2UoYXN5bmMgKHVzZVByb3h5U3RyaW5nLCB1c2VTb2NrZXRzSHR0cEhhbmRsZXJTdHJpbmcpID0+DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKHVzZVNvY2tldHNIdHRwSGFuZGxlclN0cmluZykpDQogICAgICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjcmVkcyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbChFeHBlY3RlZFVzZXJuYW1lLCBFeHBlY3RlZFBhc3N3b3JkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuRGVmYXVsdFByb3h5Q3JlZGVudGlhbHMgPSBjcmVkczsNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuVXNlUHJveHkgPSBib29sLlBhcnNlKHVzZVByb3h5U3RyaW5nKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyhDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3JyZWN0bmVzcyBvZiB1c2VyIGFuZCBwYXNzd29yZCBpcyBkb25lIGluIHNlcnZlciBwYXJ0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUocmVzcG9uc2UuU3RhdHVzQ29kZSA9PSAgSHR0cFN0YXR1c0NvZGUuT0spOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBTdWNjZXNzRXhpdENvZGU7DQogICAgICAgICAgICAgICAgfSwgdXNlUHJveHkuVG9TdHJpbmcoKSwgVXNlU29ja2V0c0h0dHBIYW5kbGVyLlRvU3RyaW5nKCksIG5ldyBSZW1vdGVJbnZva2VPcHRpb25zIHsgU3RhcnRJbmZvID0gcHNpIH0pLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICBpZiAodXNlUHJveHkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBwcm94eVRhc2s7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgb3B0aW9ucyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBUaGUgcHVycG9zZSBvZiB0aGlzIHRlc3QgaXMgbWFpbmx5IHRvIHZhbGlkYXRlIHRoZSAuTkVUIEZyYW1ld29yayBPT0IgU3lzdGVtLk5ldC5IdHRwIGltcGxlbWVudGF0aW9uDQogICAgICAgIC8vIHNpbmNlIGl0IGhhcyBhbiB1bmRlcmx5aW5nIGRlcGVuZGVuY3kgdG8gV2ViUmVxdWVzdC4gV2hpbGUgLk5FVCBDb3JlIGltcGxlbWVudGF0aW9ucyBvZiBTeXN0ZW0uTmV0Lkh0dHANCiAgICAgICAgLy8gYXJlIG5vdCB1c2luZyBhbnkgV2ViUmVxdWVzdCBjb2RlLCB0aGUgdGVzdCBpcyBzdGlsbCB1c2VmdWwgdG8gdmFsaWRhdGUgY29ycmVjdG5lc3MuDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJveHlOb3RFeHBsaWNpdGx5UHJvdmlkZWRfRGVmYXVsdENyZWRlbnRpYWxzU2V0X0RlZmF1bHRXZWJQcm94eVNldFRvTnVsbF9TdWNjZXNzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHkgPSBudWxsOw0KDQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGhhbmRsZXIuRGVmYXVsdFByb3h5Q3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoIlVzZXJuYW1lTm90VXNlZCIsICJQYXNzd29yZE5vdFVzZWQiKTsNCiAgICAgICAgICAgICAgICBIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyKTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChyZXNwb25zZS5TdGF0dXNDb2RlLCBIdHRwU3RhdHVzQ29kZS5PSyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQo="
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.ServerCertificates.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uTmV0LlNlY3VyaXR5Ow0KdXNpbmcgU3lzdGVtLk5ldC5UZXN0LkNvbW1vbjsNCnVzaW5nIFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlczsNCnVzaW5nIFN5c3RlbS5TZWN1cml0eS5BdXRoZW50aWNhdGlvbi5FeHRlbmRlZFByb3RlY3Rpb247DQp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Llg1MDlDZXJ0aWZpY2F0ZXM7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOw0KdXNpbmcgWHVuaXQ7DQoNCm5hbWVzcGFjZSBTeXN0ZW0uTmV0Lkh0dHAuRnVuY3Rpb25hbC5UZXN0cw0Kew0KICAgIHVzaW5nIENvbmZpZ3VyYXRpb24gPSBTeXN0ZW0uTmV0LlRlc3QuQ29tbW9uLkNvbmZpZ3VyYXRpb247DQoNCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgIi5ORVQgRnJhbWV3b3JrIHRocm93cyBQTlNFIGZvciBTZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFjayIpXQ0KICAgIHB1YmxpYyBhYnN0cmFjdCBwYXJ0aWFsIGNsYXNzIEh0dHBDbGllbnRIYW5kbGVyX1NlcnZlckNlcnRpZmljYXRlc19UZXN0IDogSHR0cENsaWVudFRlc3RCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIHN0YXRpYyBib29sIENsaWVudFN1cHBvcnRzREhFQ2lwaGVyU3VpdGVzID0+ICghUGxhdGZvcm1EZXRlY3Rpb24uSXNXaW5kb3dzIHx8IFBsYXRmb3JtRGV0ZWN0aW9uLklzV2luZG93czEwVmVyc2lvbjE2MDdPckdyZWF0ZXIpOw0KICAgICAgICBwcml2YXRlIGJvb2wgQmFja2VuZFN1cHBvcnRzQ3VzdG9tQ2VydGlmaWNhdGVIYW5kbGluZ0FuZENsaWVudFN1cHBvcnRzREhFQ2lwaGVyU3VpdGVzID0+DQogICAgICAgICAgICAoQmFja2VuZFN1cHBvcnRzQ3VzdG9tQ2VydGlmaWNhdGVIYW5kbGluZyAmJiBDbGllbnRTdXBwb3J0c0RIRUNpcGhlclN1aXRlcyk7DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoflRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCldDQogICAgICAgIHB1YmxpYyB2b2lkIEN0b3JfRXhwZWN0ZWREZWZhdWx0UHJvcGVydHlWYWx1ZXNfVWFwUGxhdGZvcm0oKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk51bGwoaGFuZGxlci5TZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaGFuZGxlci5DaGVja0NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuVWFwKV0NCiAgICAgICAgcHVibGljIHZvaWQgQ3Rvcl9FeHBlY3RlZERlZmF1bHRWYWx1ZXNfTm90VWFwUGxhdGZvcm0oKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk51bGwoaGFuZGxlci5TZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKGhhbmRsZXIuQ2hlY2tDZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBTZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFja19TZXRHZXRfUm91bmR0cmlwcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuTnVsbChoYW5kbGVyLlNlcnZlckNlcnRpZmljYXRlQ3VzdG9tVmFsaWRhdGlvbkNhbGxiYWNrKTsNCg0KICAgICAgICAgICAgICAgIEZ1bmM8SHR0cFJlcXVlc3RNZXNzYWdlLCBYNTA5Q2VydGlmaWNhdGUyLCBYNTA5Q2hhaW4sIFNzbFBvbGljeUVycm9ycywgYm9vbD4gY2FsbGJhY2sxID0gKHJlcSwgY2VydCwgY2hhaW4sIHBvbGljeSkgPT4gdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCJjYWxsYmFjazEiKTsNCiAgICAgICAgICAgICAgICBGdW5jPEh0dHBSZXF1ZXN0TWVzc2FnZSwgWDUwOUNlcnRpZmljYXRlMiwgWDUwOUNoYWluLCBTc2xQb2xpY3lFcnJvcnMsIGJvb2w+IGNhbGxiYWNrMiA9IChyZXEsIGNlcnQsIGNoYWluLCBwb2xpY3kpID0+IHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigiY2FsbGJhY2syIik7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlNlcnZlckNlcnRpZmljYXRlQ3VzdG9tVmFsaWRhdGlvbkNhbGxiYWNrID0gY2FsbGJhY2sxOw0KICAgICAgICAgICAgICAgIEFzc2VydC5TYW1lKGNhbGxiYWNrMSwgaGFuZGxlci5TZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFjayk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlNlcnZlckNlcnRpZmljYXRlQ3VzdG9tVmFsaWRhdGlvbkNhbGxiYWNrID0gY2FsbGJhY2syOw0KICAgICAgICAgICAgICAgIEFzc2VydC5TYW1lKGNhbGxiYWNrMiwgaGFuZGxlci5TZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFjayk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlNlcnZlckNlcnRpZmljYXRlQ3VzdG9tVmFsaWRhdGlvbkNhbGxiYWNrID0gbnVsbDsNCiAgICAgICAgICAgICAgICBBc3NlcnQuTnVsbChoYW5kbGVyLlNlcnZlckNlcnRpZmljYXRlQ3VzdG9tVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgTm9DYWxsYmFja19WYWxpZENlcnRpZmljYXRlX1N1Y2Nlc3NBbmRFeHBlY3RlZFByb3BlcnR5QmVoYXZpb3IoKQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmMoQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZVJlbW90ZUVjaG9TZXJ2ZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCgpID0+IGhhbmRsZXIuU2VydmVyQ2VydGlmaWNhdGVDdXN0b21WYWxpZGF0aW9uQ2FsbGJhY2sgPSBudWxsKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCgpID0+IGhhbmRsZXIuQ2hlY2tDZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0ID0gZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXAsICJVQVAgd29uJ3Qgc2VuZCByZXF1ZXN0cyB0aHJvdWdoIGEgY3VzdG9tIHByb3h5IildDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgVXNlQ2FsbGJhY2tfSGF2ZUNyZWRzQW5kVXNlQXV0aGVudGljYXRlZEN1c3RvbVByb3h5QW5kUG9zdFRvU2VjdXJlU2VydmVyX1N1Y2Nlc3MoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIUJhY2tlbmRTdXBwb3J0c0N1c3RvbUNlcnRpZmljYXRlSGFuZGxpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoSXNXaW5IdHRwSGFuZGxlciAmJiBQbGF0Zm9ybURldGVjdGlvbi5Jc1dpbmRvd3M3KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIElzc3VlICMyNzYxMg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIGNvbnRlbnQgPSAiVGhpcyBpcyBhIHRlc3QiOw0KDQogICAgICAgICAgICBpbnQgcG9ydDsNCiAgICAgICAgICAgIFRhc2s8TG9vcGJhY2tHZXRSZXF1ZXN0SHR0cFByb3h5LlByb3h5UmVzdWx0PiBwcm94eVRhc2sgPSBMb29wYmFja0dldFJlcXVlc3RIdHRwUHJveHkuU3RhcnRBc3luYygNCiAgICAgICAgICAgICAgICBvdXQgcG9ydCwNCiAgICAgICAgICAgICAgICByZXF1aXJlQXV0aDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBleHBlY3RDcmVkczogdHJ1ZSk7DQogICAgICAgICAgICBVcmkgcHJveHlVcmwgPSBuZXcgVXJpKCQiaHR0cDovL2xvY2FsaG9zdDp7cG9ydH0iKTsNCg0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLlByb3h5ID0gbmV3IFVzZVNwZWNpZmllZFVyaVdlYlByb3h5KHByb3h5VXJsLCBuZXcgTmV0d29ya0NyZWRlbnRpYWwoInJpZ2h0dXNlcm5hbWUiLCAicmlnaHRwYXNzd29yZCIpKTsNCiAgICAgICAgICAgIGhhbmRsZXIuU2VydmVyQ2VydGlmaWNhdGVDdXN0b21WYWxpZGF0aW9uQ2FsbGJhY2sgPSBkZWxlZ2F0ZSB7IHJldHVybiB0cnVlOyB9Ow0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlBvc3RBc3luYygNCiAgICAgICAgICAgICAgICAgICAgQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZVJlbW90ZUVjaG9TZXJ2ZXIsDQogICAgICAgICAgICAgICAgICAgIG5ldyBTdHJpbmdDb250ZW50KGNvbnRlbnQpKTsNCg0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQoNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgIFRlc3RIZWxwZXIuVmVyaWZ5UmVzcG9uc2VCb2R5KA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvbnRlbnQsDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLkNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1LA0KICAgICAgICAgICAgICAgICAgICBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgY29udGVudCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIERvbid0IGF3YWl0IHByb3h5VGFzayB1bnRpbCB0aGUgSHR0cENsaWVudCBpcyBjbG9zZWQsIG90aGVyd2lzZSBpdCB3aWxsIHdhaXQgZm9yIGNvbm5lY3Rpb24gdGltZW91dC4NCiAgICAgICAgICAgIGF3YWl0IHByb3h5VGFzazsNCiAgICAgICAgfQ0KDQogICAgICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuVWFwLCAiVUFQIHdvbid0IHNlbmQgcmVxdWVzdHMgdGhyb3VnaCBhIGN1c3RvbSBwcm94eSIpXQ0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFVzZUNhbGxiYWNrX0hhdmVOb0NyZWRzQW5kVXNlQXV0aGVudGljYXRlZEN1c3RvbVByb3h5QW5kUG9zdFRvU2VjdXJlU2VydmVyX1Byb3h5QXV0aGVudGljYXRpb25SZXF1aXJlZFN0YXR1c0NvZGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIUJhY2tlbmRTdXBwb3J0c0N1c3RvbUNlcnRpZmljYXRlSGFuZGxpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpbnQgcG9ydDsNCiAgICAgICAgICAgIFRhc2s8TG9vcGJhY2tHZXRSZXF1ZXN0SHR0cFByb3h5LlByb3h5UmVzdWx0PiBwcm94eVRhc2sgPSBMb29wYmFja0dldFJlcXVlc3RIdHRwUHJveHkuU3RhcnRBc3luYygNCiAgICAgICAgICAgICAgICBvdXQgcG9ydCwNCiAgICAgICAgICAgICAgICByZXF1aXJlQXV0aDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBleHBlY3RDcmVkczogZmFsc2UpOw0KICAgICAgICAgICAgVXJpIHByb3h5VXJsID0gbmV3IFVyaSgkImh0dHA6Ly9sb2NhbGhvc3Q6e3BvcnR9Iik7DQoNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5Qcm94eSA9IG5ldyBVc2VTcGVjaWZpZWRVcmlXZWJQcm94eShwcm94eVVybCwgbnVsbCk7DQogICAgICAgICAgICBoYW5kbGVyLlNlcnZlckNlcnRpZmljYXRlQ3VzdG9tVmFsaWRhdGlvbkNhbGxiYWNrID0gZGVsZWdhdGUgeyByZXR1cm4gdHJ1ZTsgfTsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiByZXNwb25zZVRhc2sgPSBjbGllbnQuUG9zdEFzeW5jKA0KICAgICAgICAgICAgICAgICAgICBDb25maWd1cmF0aW9uLkh0dHAuU2VjdXJlUmVtb3RlRWNob1NlcnZlciwNCiAgICAgICAgICAgICAgICAgICAgbmV3IFN0cmluZ0NvbnRlbnQoIlRoaXMgaXMgYSB0ZXN0IikpOw0KICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKHByb3h5VGFzaywgcmVzcG9uc2VUYXNrKTsNCiAgICAgICAgICAgICAgICB1c2luZyAocmVzcG9uc2VUYXNrLlJlc3VsdCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5Qcm94eUF1dGhlbnRpY2F0aW9uUmVxdWlyZWQsIHJlc3BvbnNlVGFzay5SZXN1bHQuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFVzZUNhbGxiYWNrX05vdFNlY3VyZUNvbm5lY3Rpb25fQ2FsbGJhY2tOb3RDYWxsZWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIUJhY2tlbmRTdXBwb3J0c0N1c3RvbUNlcnRpZmljYXRlSGFuZGxpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoJCJTa2lwcGluZyB7bmFtZW9mKFVzZUNhbGxiYWNrX05vdFNlY3VyZUNvbm5lY3Rpb25fQ2FsbGJhY2tOb3RDYWxsZWQpfSgpIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYm9vbCBjYWxsYmFja0NhbGxlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuU2VydmVyQ2VydGlmaWNhdGVDdXN0b21WYWxpZGF0aW9uQ2FsbGJhY2sgPSBkZWxlZ2F0ZSB7IGNhbGxiYWNrQ2FsbGVkID0gdHJ1ZTsgcmV0dXJuIHRydWU7IH07DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyhDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShjYWxsYmFja0NhbGxlZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIElFbnVtZXJhYmxlPG9iamVjdFtdPiBVc2VDYWxsYmFja19WYWxpZENlcnRpZmljYXRlX0V4cGVjdGVkVmFsdWVzRHVyaW5nQ2FsbGJhY2tfVXJscygpDQogICAgICAgIHsNCiAgICAgICAgICAgIGZvcmVhY2ggKGJvb2wgY2hlY2tSZXZvY2F0aW9uIGluIG5ld1tdIHsgdHJ1ZSwgZmFsc2UgfSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZVJlbW90ZUVjaG9TZXJ2ZXIsIGNoZWNrUmV2b2NhdGlvbiB9Ow0KICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10gew0KICAgICAgICAgICAgICAgICAgICBDb25maWd1cmF0aW9uLkh0dHAuUmVkaXJlY3RVcmlGb3JEZXN0aW5hdGlvblVyaSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3VyZTp0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTozMDIsDQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblVyaTpDb25maWd1cmF0aW9uLkh0dHAuU2VjdXJlUmVtb3RlRWNob1NlcnZlciwNCiAgICAgICAgICAgICAgICAgICAgICAgIGhvcHM6MSksDQogICAgICAgICAgICAgICAgICAgIGNoZWNrUmV2b2NhdGlvbiB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtNZW1iZXJEYXRhKG5hbWVvZihVc2VDYWxsYmFja19WYWxpZENlcnRpZmljYXRlX0V4cGVjdGVkVmFsdWVzRHVyaW5nQ2FsbGJhY2tfVXJscykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBVc2VDYWxsYmFja19WYWxpZENlcnRpZmljYXRlX0V4cGVjdGVkVmFsdWVzRHVyaW5nQ2FsbGJhY2soVXJpIHVybCwgYm9vbCBjaGVja1Jldm9jYXRpb24pDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghQmFja2VuZFN1cHBvcnRzQ3VzdG9tQ2VydGlmaWNhdGVIYW5kbGluZykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgkIlNraXBwaW5nIHtuYW1lb2YoVXNlQ2FsbGJhY2tfVmFsaWRDZXJ0aWZpY2F0ZV9FeHBlY3RlZFZhbHVlc0R1cmluZ0NhbGxiYWNrKX0oe3VybH0sIHtjaGVja1Jldm9jYXRpb259KSIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJvb2wgY2FsbGJhY2tDYWxsZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkNoZWNrQ2VydGlmaWNhdGVSZXZvY2F0aW9uTGlzdCA9IGNoZWNrUmV2b2NhdGlvbjsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlNlcnZlckNlcnRpZmljYXRlQ3VzdG9tVmFsaWRhdGlvbkNhbGxiYWNrID0gKHJlcXVlc3QsIGNlcnQsIGNoYWluLCBlcnJvcnMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tDYWxsZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuTm90TnVsbChyZXF1ZXN0KTsNCg0KICAgICAgICAgICAgICAgICAgICBYNTA5Q2hhaW5TdGF0dXNGbGFncyBmbGFncyA9IGNoYWluLkNoYWluU3RhdHVzLkFnZ3JlZ2F0ZShYNTA5Q2hhaW5TdGF0dXNGbGFncy5Ob0Vycm9yLCAoY3VyLCBzdGF0dXMpID0+IGN1ciB8IHN0YXR1cy5TdGF0dXMpOw0KICAgICAgICAgICAgICAgICAgICBib29sIGlnbm9yZUVycm9ycyA9IC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9kb3RuZXQvY29yZWZ4L2lzc3Vlcy8yMTkyMiNpc3N1ZWNvbW1lbnQtMzE1NTU1MjM3DQogICAgICAgICAgICAgICAgICAgICAgICBSdW50aW1lSW5mb3JtYXRpb24uSXNPU1BsYXRmb3JtKE9TUGxhdGZvcm0uT1NYKSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tSZXZvY2F0aW9uICYmDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnMgPT0gU3NsUG9saWN5RXJyb3JzLlJlbW90ZUNlcnRpZmljYXRlQ2hhaW5FcnJvcnMgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzID09IFg1MDlDaGFpblN0YXR1c0ZsYWdzLlJldm9jYXRpb25TdGF0dXNVbmtub3duOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShpZ25vcmVFcnJvcnMgfHwgZXJyb3JzID09IFNzbFBvbGljeUVycm9ycy5Ob25lLCAkIkV4cGVjdGVkIHtTc2xQb2xpY3lFcnJvcnMuTm9uZX0sIGdvdCB7ZXJyb3JzfSB3aXRoIGNoYWluIHN0YXR1cyB7ZmxhZ3N9Iik7DQoNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoY2hhaW4uQ2hhaW5FbGVtZW50cy5Db3VudCA+IDApOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuTm90RW1wdHkoY2VydC5TdWJqZWN0KTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBVV1AgYWx3YXlzIHVzZXMgQ2hlY2tDZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0PXRydWUgcmVnYXJkbGVzcyBvZiBzZXR0aW5nIHRoZSBwcm9wZXJ0eSBhbmQNCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGdldHRlciBhbHdheXMgcmV0dXJucyB0cnVlLiBTbywgZm9yIHRoaXMgbmV4dCBBc3NlcnQsIGl0IGlzIGJldHRlciB0byBnZXQgdGhlIHByb3BlcnR5DQogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIGJhY2sgZnJvbSB0aGUgaGFuZGxlciBpbnN0ZWFkIG9mIHVzaW5nIHRoZSBwYXJhbWV0ZXIgdmFsdWUgb2YgdGhlIHRlc3QuDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuQ2hlY2tDZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0ID8gWDUwOVJldm9jYXRpb25Nb2RlLk9ubGluZSA6IFg1MDlSZXZvY2F0aW9uTW9kZS5Ob0NoZWNrLA0KICAgICAgICAgICAgICAgICAgICAgICAgY2hhaW4uQ2hhaW5Qb2xpY3kuUmV2b2NhdGlvbk1vZGUpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJsKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoY2FsbGJhY2tDYWxsZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBVc2VDYWxsYmFja19DYWxsYmFja1JldHVybnNGYWlsdXJlX1Rocm93c0V4Y2VwdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghQmFja2VuZFN1cHBvcnRzQ3VzdG9tQ2VydGlmaWNhdGVIYW5kbGluZykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgkIlNraXBwaW5nIHtuYW1lb2YoVXNlQ2FsbGJhY2tfQ2FsbGJhY2tSZXR1cm5zRmFpbHVyZV9UaHJvd3NFeGNlcHRpb24pfSgpIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaGFuZGxlci5TZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFjayA9IGRlbGVnYXRlIHsgcmV0dXJuIGZhbHNlOyB9Ow0KICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxIdHRwUmVxdWVzdEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50LkdldEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5TZWN1cmVSZW1vdGVFY2hvU2VydmVyKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFVzZUNhbGxiYWNrX0NhbGxiYWNrVGhyb3dzRXhjZXB0aW9uX0V4Y2VwdGlvblByb3BhZ2F0ZXNBc0Jhc2VFeGNlcHRpb24oKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIUJhY2tlbmRTdXBwb3J0c0N1c3RvbUNlcnRpZmljYXRlSGFuZGxpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoJCJTa2lwcGluZyB7bmFtZW9mKFVzZUNhbGxiYWNrX0NhbGxiYWNrVGhyb3dzRXhjZXB0aW9uX0V4Y2VwdGlvblByb3BhZ2F0ZXNBc0Jhc2VFeGNlcHRpb24pfSgpIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIGUgPSBuZXcgRGl2aWRlQnlaZXJvRXhjZXB0aW9uKCk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5TZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFjayA9IGRlbGVnYXRlIHsgdGhyb3cgZTsgfTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBIdHRwUmVxdWVzdEV4Y2VwdGlvbiBleCA9IGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxIdHRwUmVxdWVzdEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50LkdldEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5TZWN1cmVSZW1vdGVFY2hvU2VydmVyKSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlNhbWUoZSwgZXguR2V0QmFzZUV4Y2VwdGlvbigpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgb2JqZWN0W11bXSBDZXJ0aWZpY2F0ZVZhbGlkYXRpb25TZXJ2ZXJzID0gDQogICAgICAgIHsNCiAgICAgICAgICAgIG5ldyBvYmplY3RbXSB7IENvbmZpZ3VyYXRpb24uSHR0cC5FeHBpcmVkQ2VydFJlbW90ZVNlcnZlciB9LA0KICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgQ29uZmlndXJhdGlvbi5IdHRwLlNlbGZTaWduZWRDZXJ0UmVtb3RlU2VydmVyIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyBDb25maWd1cmF0aW9uLkh0dHAuV3JvbmdIb3N0TmFtZUNlcnRSZW1vdGVTZXJ2ZXIgfSwNCiAgICAgICAgfTsNCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0NvbmRpdGlvbmFsVGhlb3J5KG5hbWVvZihDbGllbnRTdXBwb3J0c0RIRUNpcGhlclN1aXRlcykpXQ0KICAgICAgICBbTWVtYmVyRGF0YShuYW1lb2YoQ2VydGlmaWNhdGVWYWxpZGF0aW9uU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBOb0NhbGxiYWNrX0JhZENlcnRpZmljYXRlX1Rocm93c0V4Y2VwdGlvbihzdHJpbmcgdXJsKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEh0dHBSZXF1ZXN0RXhjZXB0aW9uPigoKSA9PiBjbGllbnQuR2V0QXN5bmModXJsKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCwgIlVBUCBkb2Vzbid0IGFsbG93IHJldm9jYXRpb24gY2hlY2tpbmcgdG8gYmUgdHVybmVkIG9mZiIpXQ0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0NvbmRpdGlvbmFsRmFjdChuYW1lb2YoQ2xpZW50U3VwcG9ydHNESEVDaXBoZXJTdWl0ZXMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgTm9DYWxsYmFja19SZXZva2VkQ2VydGlmaWNhdGVfTm9SZXZvY2F0aW9uQ2hlY2tpbmdfU3VjY2VlZHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBPbiBtYWNPUyAobGliY3VybCtkYXJ3aW5zc2wpIHdlIGNhbm5vdCB0dXJuIHJldm9jYXRpb24gb2ZmLg0KICAgICAgICAgICAgLy8gQnV0IHdlIGFsc28gY2FuJ3QgcmVhbGlzdGljYWxseSBzYXkgdGhhdCB0aGUgZGVmYXVsdCB2YWx1ZSBmb3INCiAgICAgICAgICAgIC8vIENoZWNrQ2VydGlmaWNhdGVSZXZvY2F0aW9uTGlzdCB0aHJvd3MgaW4gdGhlIGdlbmVyYWwgY2FzZS4NCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyhDb25maWd1cmF0aW9uLkh0dHAuUmV2b2tlZENlcnRSZW1vdGVTZXJ2ZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoSHR0cFJlcXVlc3RFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKFVzZVNvY2tldHNIdHRwSGFuZGxlciB8fCAhU2hvdWxkU3VwcHJlc3NSZXZvY2F0aW9uRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgTm9DYWxsYmFja19SZXZva2VkQ2VydGlmaWNhdGVfUmV2b2NhdGlvbkNoZWNraW5nX0ZhaWxzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFCYWNrZW5kU3VwcG9ydHNDdXN0b21DZXJ0aWZpY2F0ZUhhbmRsaW5nKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCQiU2tpcHBpbmcge25hbWVvZihOb0NhbGxiYWNrX1Jldm9rZWRDZXJ0aWZpY2F0ZV9SZXZvY2F0aW9uQ2hlY2tpbmdfRmFpbHMpfSgpIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuQ2hlY2tDZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0ID0gdHJ1ZTsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEh0dHBSZXF1ZXN0RXhjZXB0aW9uPigoKSA9PiBjbGllbnQuR2V0QXN5bmMoQ29uZmlndXJhdGlvbi5IdHRwLlJldm9rZWRDZXJ0UmVtb3RlU2VydmVyKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IG9iamVjdFtdW10gQ2VydGlmaWNhdGVWYWxpZGF0aW9uU2VydmVyc0FuZEV4cGVjdGVkUG9saWNpZXMgPQ0KICAgICAgICB7DQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyBDb25maWd1cmF0aW9uLkh0dHAuRXhwaXJlZENlcnRSZW1vdGVTZXJ2ZXIsIFNzbFBvbGljeUVycm9ycy5SZW1vdGVDZXJ0aWZpY2F0ZUNoYWluRXJyb3JzIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyBDb25maWd1cmF0aW9uLkh0dHAuU2VsZlNpZ25lZENlcnRSZW1vdGVTZXJ2ZXIsIFNzbFBvbGljeUVycm9ycy5SZW1vdGVDZXJ0aWZpY2F0ZUNoYWluRXJyb3JzIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyBDb25maWd1cmF0aW9uLkh0dHAuV3JvbmdIb3N0TmFtZUNlcnRSZW1vdGVTZXJ2ZXIgLCBTc2xQb2xpY3lFcnJvcnMuUmVtb3RlQ2VydGlmaWNhdGVOYW1lTWlzbWF0Y2h9LA0KICAgICAgICB9Ow0KDQogICAgICAgIHByaXZhdGUgYXN5bmMgVGFzayBVc2VDYWxsYmFja19CYWRDZXJ0aWZpY2F0ZV9FeHBlY3RlZFBvbGljeUVycm9yc19IZWxwZXIoc3RyaW5nIHVybCwgYm9vbCB1c2VTb2NrZXRzSHR0cEhhbmRsZXIsIFNzbFBvbGljeUVycm9ycyBleHBlY3RlZEVycm9ycykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFCYWNrZW5kU3VwcG9ydHNDdXN0b21DZXJ0aWZpY2F0ZUhhbmRsaW5nKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCQiU2tpcHBpbmcge25hbWVvZihVc2VDYWxsYmFja19CYWRDZXJ0aWZpY2F0ZV9FeHBlY3RlZFBvbGljeUVycm9ycyl9KHt1cmx9LCB7ZXhwZWN0ZWRFcnJvcnN9KSIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKHVzZVNvY2tldHNIdHRwSGFuZGxlcik7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJvb2wgY2FsbGJhY2tDYWxsZWQgPSBmYWxzZTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuU2VydmVyQ2VydGlmaWNhdGVDdXN0b21WYWxpZGF0aW9uQ2FsbGJhY2sgPSAocmVxdWVzdCwgY2VydCwgY2hhaW4sIGVycm9ycykgPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrQ2FsbGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwocmVxdWVzdCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKGNlcnQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuTm90TnVsbChjaGFpbik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChleHBlY3RlZEVycm9ycywgZXJyb3JzKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVybCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGNhbGxiYWNrQ2FsbGVkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbTWVtYmVyRGF0YShuYW1lb2YoQ2VydGlmaWNhdGVWYWxpZGF0aW9uU2VydmVyc0FuZEV4cGVjdGVkUG9saWNpZXMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgVXNlQ2FsbGJhY2tfQmFkQ2VydGlmaWNhdGVfRXhwZWN0ZWRQb2xpY3lFcnJvcnMoc3RyaW5nIHVybCwgU3NsUG9saWN5RXJyb3JzIGV4cGVjdGVkRXJyb3JzKQ0KICAgICAgICB7DQogICAgICAgICAgICBjb25zdCBpbnQgU0VDX0VfQlVGRkVSX1RPT19TTUFMTCA9IHVuY2hlY2tlZCgoaW50KTB4ODAwOTAzMjEpOw0KDQogICAgICAgICAgICBpZiAoIUJhY2tlbmRTdXBwb3J0c0N1c3RvbUNlcnRpZmljYXRlSGFuZGxpbmdBbmRDbGllbnRTdXBwb3J0c0RIRUNpcGhlclN1aXRlcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChQbGF0Zm9ybURldGVjdGlvbi5Jc1VhcCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIFVBUCBIVFRQIHN0YWNrIGNhY2hlcyBjb25uZWN0aW9ucyBwZXItcHJvY2Vzcy4gVGhpcyBjYXVzZXMgaW50ZXJmZXJlbmNlIHdoZW4gdGhlc2UgdGVzdHMgcnVuIGluDQogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzYW1lIHByb2Nlc3MgYXMgdGhlIG90aGVyIHRlc3RzLiBFYWNoIHRlc3QgbmVlZHMgdG8gYmUgaXNvbGF0ZWQgdG8gaXRzIG93biBwcm9jZXNzLg0KICAgICAgICAgICAgICAgICAgICAvLyBTZWUgZGljdXNzaW9uOiBodHRwczovL2dpdGh1Yi5jb20vZG90bmV0L2NvcmVmeC9pc3N1ZXMvMjE5NDUNCiAgICAgICAgICAgICAgICAgICAgUmVtb3RlSW52b2tlKChyZW1vdGVVcmwsIHJlbW90ZUV4cGVjdGVkRXJyb3JzLCB1c2VTb2NrZXRzSHR0cEhhbmRsZXJTdHJpbmcpID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZUNhbGxiYWNrX0JhZENlcnRpZmljYXRlX0V4cGVjdGVkUG9saWN5RXJyb3JzX0hlbHBlcigNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdGVVcmwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbC5QYXJzZSh1c2VTb2NrZXRzSHR0cEhhbmRsZXJTdHJpbmcpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIChTc2xQb2xpY3lFcnJvcnMpRW51bS5QYXJzZSh0eXBlb2YoU3NsUG9saWN5RXJyb3JzKSwgcmVtb3RlRXhwZWN0ZWRFcnJvcnMpKS5XYWl0KCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTdWNjZXNzRXhpdENvZGU7DQogICAgICAgICAgICAgICAgICAgIH0sIHVybCwgZXhwZWN0ZWRFcnJvcnMuVG9TdHJpbmcoKSwgVXNlU29ja2V0c0h0dHBIYW5kbGVyLlRvU3RyaW5nKCkpLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVXNlQ2FsbGJhY2tfQmFkQ2VydGlmaWNhdGVfRXhwZWN0ZWRQb2xpY3lFcnJvcnNfSGVscGVyKHVybCwgVXNlU29ja2V0c0h0dHBIYW5kbGVyLCBleHBlY3RlZEVycm9ycyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEh0dHBSZXF1ZXN0RXhjZXB0aW9uIGUpIHdoZW4gKGUuSW5uZXJFeGNlcHRpb24/LkdldFR5cGUoKS5OYW1lID09ICJXaW5IdHRwRXhjZXB0aW9uIiAmJg0KICAgICAgICAgICAgICAgIGUuSW5uZXJFeGNlcHRpb24uSFJlc3VsdCA9PSBTRUNfRV9CVUZGRVJfVE9PX1NNQUxMICYmDQogICAgICAgICAgICAgICAgIVBsYXRmb3JtRGV0ZWN0aW9uLklzV2luZG93czEwVmVyc2lvbjE2MDdPckdyZWF0ZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVGVzdGluZyBvbiBvbGQgV2luZG93cyB2ZXJzaW9ucyBjYW4gaGl0IGh0dHBzOi8vZ2l0aHViLmNvbS9kb3RuZXQvY29yZWZ4L2lzc3Vlcy83ODEyDQogICAgICAgICAgICAgICAgLy8gSWdub3JlIFNFQ19FX0JVRkZFUl9UT09fU01BTEwgZXJyb3Igb24gc3VjaCBjYXNlcy4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgU1NMQmFja2VuZE5vdFN1cHBvcnRlZF9DYWxsYmFja19UaHJvd3NQbGF0Zm9ybU5vdFN1cHBvcnRlZEV4Y2VwdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChCYWNrZW5kU3VwcG9ydHNDdXN0b21DZXJ0aWZpY2F0ZUhhbmRsaW5nKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLlNlcnZlckNlcnRpZmljYXRlQ3VzdG9tVmFsaWRhdGlvbkNhbGxiYWNrID0gZGVsZWdhdGUgeyByZXR1cm4gdHJ1ZTsgfTsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPFBsYXRmb3JtTm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiBjbGllbnQuR2V0QXN5bmMoQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZVJlbW90ZUVjaG9TZXJ2ZXIpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgLy8gRm9yIG1hY09TIHRoZSAiY3VzdG9tIGhhbmRsaW5nIiBtZWFucyB0aGF0IHJldm9jYXRpb24gY2FuJ3QgYmUgKmRpc2FibGVkKi4gU28gdGhpcyB0ZXN0IGRvZXMgbm90IGFwcGx5Lg0KICAgICAgICBbUGxhdGZvcm1TcGVjaWZpYyh+VGVzdFBsYXRmb3Jtcy5PU1gpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTU0xCYWNrZW5kTm90U3VwcG9ydGVkX1Jldm9jYXRpb25fVGhyb3dzUGxhdGZvcm1Ob3RTdXBwb3J0ZWRFeGNlcHRpb24oKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoQmFja2VuZFN1cHBvcnRzQ3VzdG9tQ2VydGlmaWNhdGVIYW5kbGluZykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5DaGVja0NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3QgPSB0cnVlOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBBc3NlcnQuVGhyb3dzQXN5bmM8UGxhdGZvcm1Ob3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IGNsaWVudC5HZXRBc3luYyhDb25maWd1cmF0aW9uLkh0dHAuU2VjdXJlUmVtb3RlRWNob1NlcnZlcikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtQbGF0Zm9ybVNwZWNpZmljKFRlc3RQbGF0Zm9ybXMuV2luZG93cyldIC8vIENvcHlUb0FzeW5jKFN0cmVhbSwgVHJhbnNwb3J0Q29udGV4dCkgaXNuJ3QgdXNlZCBvbiB1bml4DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0QXN5bmNfUG9zdF9DaGFubmVsQmluZGluZ19Db25maWd1cmVkQ29ycmVjdGx5KCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBuZXcgQ2hhbm5lbEJpbmRpbmdBd2FyZUNvbnRlbnQoIlRlc3QgY29udGVzdCIpOw0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuUG9zdEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5TZWN1cmVSZW1vdGVFY2hvU2VydmVyLCBjb250ZW50KSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSBzdGF0dXMuDQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCg0KICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRlIHRoZSBDaGFubmVsQmluZGluZyBvYmplY3QgZXhpc3RzLg0KICAgICAgICAgICAgICAgIENoYW5uZWxCaW5kaW5nIGNoYW5uZWxCaW5kaW5nID0gY29udGVudC5DaGFubmVsQmluZGluZzsNCiAgICAgICAgICAgICAgICBpZiAoUGxhdGZvcm1EZXRlY3Rpb24uSXNVYXApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBVQVAgY3VycmVudGx5IGRvZXNuJ3QgZXhwb3NlIGNoYW5uZWwgYmluZGluZyBpbmZvcm1hdGlvbi4NCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0Lk51bGwoY2hhbm5lbEJpbmRpbmcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuTm90TnVsbChjaGFubmVsQmluZGluZyk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gVmFsaWRhdGUgdGhlIENoYW5uZWxCaW5kaW5nJ3MgdmFsaWRpdHkuDQogICAgICAgICAgICAgICAgICAgIGlmIChCYWNrZW5kU3VwcG9ydHNDdXN0b21DZXJ0aWZpY2F0ZUhhbmRsaW5nKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UoY2hhbm5lbEJpbmRpbmcuSXNJbnZhbGlkLCAiRXhwZWN0ZWQgdmFsaWQgYmluZGluZyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0Lk5vdEVxdWFsKEludFB0ci5aZXJvLCBjaGFubmVsQmluZGluZy5EYW5nZXJvdXNHZXRIYW5kbGUoKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRlIHRoZSBDaGFubmVsQmluZGluZydzIGRlc2NyaXB0aW9uLg0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGNoYW5uZWxCaW5kaW5nRGVzY3JpcHRpb24gPSBjaGFubmVsQmluZGluZy5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwoY2hhbm5lbEJpbmRpbmdEZXNjcmlwdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuTm90RW1wdHkoY2hhbm5lbEJpbmRpbmdEZXNjcmlwdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZSgoY2hhbm5lbEJpbmRpbmdEZXNjcmlwdGlvbi5MZW5ndGggKyAxKSAlIDMgPT0gMCwgJCJVbmV4cGVjdGVkIGxlbmd0aCB7Y2hhbm5lbEJpbmRpbmdEZXNjcmlwdGlvbi5MZW5ndGh9Iik7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoYW5uZWxCaW5kaW5nRGVzY3JpcHRpb24uTGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhciBjID0gY2hhbm5lbEJpbmRpbmdEZXNjcmlwdGlvbltpXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSAlIDMgPT0gMikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgnICcsIGMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZSgoYyA+PSAnMCcgJiYgYyA8PSAnOScpIHx8IChjID49ICdBJyAmJiBjIDw9ICdGJyksICQiRXhwZWN0ZWQgaGV4LCBnb3Qge2N9Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQmFja2VuZCBkb2Vzbid0IHN1cHBvcnQgZ2V0dGluZyB0aGUgZGV0YWlscyB0byBjcmVhdGUgdGhlIENCVC4NCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGNoYW5uZWxCaW5kaW5nLklzSW52YWxpZCwgIkV4cGVjdGVkIGludmFsaWQgYmluZGluZyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEludFB0ci5aZXJvLCBjaGFubmVsQmluZGluZy5EYW5nZXJvdXNHZXRIYW5kbGUoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuTnVsbChjaGFubmVsQmluZGluZy5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uTmV0Lkh0dHAuSGVhZGVyczsNCnVzaW5nIFN5c3RlbS5OZXQuU29ja2V0czsNCnVzaW5nIFN5c3RlbS5OZXQuVGVzdC5Db21tb247DQp1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7DQp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQXV0aGVudGljYXRpb247DQp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Ow0KdXNpbmcgU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5YNTA5Q2VydGlmaWNhdGVzOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsNCg0KdXNpbmcgWHVuaXQ7DQp1c2luZyBYdW5pdC5BYnN0cmFjdGlvbnM7DQoNCm5hbWVzcGFjZSBTeXN0ZW0uTmV0Lkh0dHAuRnVuY3Rpb25hbC5UZXN0cw0Kew0KICAgIHVzaW5nIENvbmZpZ3VyYXRpb24gPSBTeXN0ZW0uTmV0LlRlc3QuQ29tbW9uLkNvbmZpZ3VyYXRpb247DQoNCiAgICAvLyBOb3RlOiAgRGlzcG9zaW5nIHRoZSBIdHRwQ2xpZW50IG9iamVjdCBhdXRvbWF0aWNhbGx5IGRpc3Bvc2VzIHRoZSBoYW5kbGVyIHdpdGhpbi4gU28sIGl0IGlzIG5vdCBuZWNlc3NhcnkNCiAgICAvLyB0byBzZXBhcmF0ZWx5IERpc3Bvc2UgKG9yIGhhdmUgYSAndXNpbmcnIHN0YXRlbWVudCkgZm9yIHRoZSBoYW5kbGVyLg0KICAgIHB1YmxpYyBhYnN0cmFjdCBjbGFzcyBIdHRwQ2xpZW50SGFuZGxlclRlc3QgOiBIdHRwQ2xpZW50VGVzdEJhc2UNCiAgICB7DQogICAgICAgIHJlYWRvbmx5IElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIEV4cGVjdGVkQ29udGVudCA9ICJUZXN0IGNvbnRlbnQiOw0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBVc2VybmFtZSA9ICJ0ZXN0dXNlciI7DQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIFBhc3N3b3JkID0gInBhc3N3b3JkIjsNCg0KICAgICAgICBwcml2YXRlIHJlYWRvbmx5IE5ldHdvcmtDcmVkZW50aWFsIF9jcmVkZW50aWFsID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKFVzZXJuYW1lLCBQYXNzd29yZCk7DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyByZWFkb25seSBvYmplY3RbXVtdIEVjaG9TZXJ2ZXJzID0gQ29uZmlndXJhdGlvbi5IdHRwLkVjaG9TZXJ2ZXJzOw0KICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IG9iamVjdFtdW10gVmVyaWZ5VXBsb2FkU2VydmVycyA9IENvbmZpZ3VyYXRpb24uSHR0cC5WZXJpZnlVcGxvYWRTZXJ2ZXJzOw0KICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IG9iamVjdFtdW10gQ29tcHJlc3NlZFNlcnZlcnMgPSBDb25maWd1cmF0aW9uLkh0dHAuQ29tcHJlc3NlZFNlcnZlcnM7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgb2JqZWN0W11bXSBIZWFkZXJWYWx1ZUFuZFVyaXMgPSB7DQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAiWC1DdXN0b21IZWFkZXIiLCAieC12YWx1ZSIsIENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAiWC1DdXN0b21IZWFkZXIiLCAieC12YWx1ZSIsIENvbmZpZ3VyYXRpb24uSHR0cC5SZWRpcmVjdFVyaUZvckRlc3RpbmF0aW9uVXJpKA0KICAgICAgICAgICAgICAgIHNlY3VyZTpmYWxzZSwNCiAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOjMwMiwNCiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblVyaTpDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlciwNCiAgICAgICAgICAgICAgICBob3BzOjEpIH0sDQogICAgICAgIH07DQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgb2JqZWN0W11bXSBIZWFkZXJXaXRoRW1wdHlWYWx1ZUFuZFVyaXMgPSB7DQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAiWC1DdXN0LUhlYWRlci1Ob1ZhbHVlIiwgIiIgLCBDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlciB9LA0KICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgIlgtQ3VzdC1IZWFkZXItTm9WYWx1ZSIsICIiICwgQ29uZmlndXJhdGlvbi5IdHRwLlJlZGlyZWN0VXJpRm9yRGVzdGluYXRpb25VcmkoDQogICAgICAgICAgICAgICAgc2VjdXJlOmZhbHNlLA0KICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6MzAyLA0KICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uVXJpOkNvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyLA0KICAgICAgICAgICAgICAgIGhvcHM6MSkgfSwNCiAgICAgICAgfTsNCiAgICAgICAgcHVibGljIHN0YXRpYyByZWFkb25seSBvYmplY3RbXVtdIEh0dHAyU2VydmVycyA9IENvbmZpZ3VyYXRpb24uSHR0cC5IdHRwMlNlcnZlcnM7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgb2JqZWN0W11bXSBIdHRwMk5vUHVzaFNlcnZlcnMgPSBDb25maWd1cmF0aW9uLkh0dHAuSHR0cDJOb1B1c2hTZXJ2ZXJzOw0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgb2JqZWN0W11bXSBSZWRpcmVjdFN0YXR1c0NvZGVzID0gew0KICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgMzAwIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDEgfSwNCiAgICAgICAgICAgIG5ldyBvYmplY3RbXSB7IDMwMiB9LA0KICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgMzAzIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDcgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgb2JqZWN0W11bXSBSZWRpcmVjdFN0YXR1c0NvZGVzT2xkTWV0aG9kc05ld01ldGhvZHMgPSB7DQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDAsICJHRVQiLCAiR0VUIiB9LA0KICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgMzAwLCAiUE9TVCIsICJHRVQiIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDAsICJIRUFEIiwgIkhFQUQiIH0sDQoNCiAgICAgICAgICAgIG5ldyBvYmplY3RbXSB7IDMwMSwgIkdFVCIsICJHRVQiIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDEsICJQT1NUIiwgIkdFVCIgfSwNCiAgICAgICAgICAgIG5ldyBvYmplY3RbXSB7IDMwMSwgIkhFQUQiLCAiSEVBRCIgfSwNCg0KICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgMzAyLCAiR0VUIiwgIkdFVCIgfSwNCiAgICAgICAgICAgIG5ldyBvYmplY3RbXSB7IDMwMiwgIlBPU1QiLCAiR0VUIiB9LA0KICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgMzAyLCAiSEVBRCIsICJIRUFEIiB9LA0KDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDMsICJHRVQiLCAiR0VUIiB9LA0KICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgMzAzLCAiUE9TVCIsICJHRVQiIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDMsICJIRUFEIiwgIkhFQUQiIH0sDQoNCiAgICAgICAgICAgIG5ldyBvYmplY3RbXSB7IDMwNywgIkdFVCIsICJHRVQiIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDcsICJQT1NUIiwgIlBPU1QiIH0sDQogICAgICAgICAgICBuZXcgb2JqZWN0W10geyAzMDcsICJIRUFEIiwgIkhFQUQiIH0sDQogICAgICAgIH07DQoNCiAgICAgICAgLy8gU3RhbmRhcmQgSFRUUCBtZXRob2RzIGRlZmluZWQgaW4gUkZDNzIzMTogaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNzIzMSNzZWN0aW9uLTQuMw0KICAgICAgICAvLyAgICAgIkdFVCIsICJIRUFEIiwgIlBPU1QiLCAiUFVUIiwgIkRFTEVURSIsICJPUFRJT05TIiwgIlRSQUNFIg0KICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IElFbnVtZXJhYmxlPG9iamVjdFtdPiBIdHRwTWV0aG9kcyA9DQogICAgICAgICAgICBHZXRNZXRob2RzKCJHRVQiLCAiSEVBRCIsICJQT1NUIiwgIlBVVCIsICJERUxFVEUiLCAiT1BUSU9OUyIsICJUUkFDRSIsICJDVVNUT00xIik7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgSUVudW1lcmFibGU8b2JqZWN0W10+IEh0dHBNZXRob2RzVGhhdEFsbG93Q29udGVudCA9DQogICAgICAgICAgICBHZXRNZXRob2RzKCJHRVQiLCAiUE9TVCIsICJQVVQiLCAiREVMRVRFIiwgIk9QVElPTlMiLCAiQ1VTVE9NMSIpOw0KICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IElFbnVtZXJhYmxlPG9iamVjdFtdPiBIdHRwTWV0aG9kc1RoYXREb250QWxsb3dDb250ZW50ID0NCiAgICAgICAgICAgIEdldE1ldGhvZHMoIkhFQUQiLCAiVFJBQ0UiKTsNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBib29sIElzV2luZG93czEwVmVyc2lvbjE2MDdPckdyZWF0ZXIgPT4gUGxhdGZvcm1EZXRlY3Rpb24uSXNXaW5kb3dzMTBWZXJzaW9uMTYwN09yR3JlYXRlcjsNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBJRW51bWVyYWJsZTxvYmplY3RbXT4gR2V0TWV0aG9kcyhwYXJhbXMgc3RyaW5nW10gbWV0aG9kcykNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIG1ldGhvZCBpbiBtZXRob2RzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKGJvb2wgc2VjdXJlIGluIG5ld1tdIHsgdHJ1ZSwgZmFsc2UgfSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyBtZXRob2QsIHNlY3VyZSB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBIdHRwQ2xpZW50SGFuZGxlclRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICAgICAgaWYgKFBsYXRmb3JtRGV0ZWN0aW9uLklzRnVsbEZyYW1ld29yaykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBPbiAuTkVUIEZyYW1ld29yaywgdGhlIGRlZmF1bHQgbGltaXQgZm9yIGNvbm5lY3Rpb25zL3NlcnZlciBpcyB2ZXJ5IGxvdyAoMikuIA0KICAgICAgICAgICAgICAgIC8vIE9uIC5ORVQgQ29yZSwgdGhlIGRlZmF1bHQgbGltaXQgaXMgaGlnaGVyLiBTaW5jZSB0aGVzZSB0ZXN0cyBydW4gaW4gcGFyYWxsZWwsDQogICAgICAgICAgICAgICAgLy8gdGhlIGxpbWl0IG5lZWRzIHRvIGJlIGluY3JlYXNlZCB0byBhdm9pZCB0aW1lb3V0cyB3aGVuIHJ1bm5pbmcgdGhlIHRlc3RzLg0KICAgICAgICAgICAgICAgIFN5c3RlbS5OZXQuU2VydmljZVBvaW50TWFuYWdlci5EZWZhdWx0Q29ubmVjdGlvbkxpbWl0ID0gaW50Lk1heFZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIEN0b3JfRXhwZWN0ZWREZWZhdWx0UHJvcGVydHlWYWx1ZXNfQ29tbW9uUGxhdGZvcm0oKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gU2FtZSBhcyAuTkVUIEZyYW1ld29yayAoRGVza3RvcCkuDQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKERlY29tcHJlc3Npb25NZXRob2RzLk5vbmUsIGhhbmRsZXIuQXV0b21hdGljRGVjb21wcmVzc2lvbik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKENsaWVudENlcnRpZmljYXRlT3B0aW9uLk1hbnVhbCwgaGFuZGxlci5DbGllbnRDZXJ0aWZpY2F0ZU9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIENvb2tpZUNvbnRhaW5lciBjb29raWVzID0gaGFuZGxlci5Db29raWVDb250YWluZXI7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwoY29va2llcyk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDAsIGNvb2tpZXMuQ291bnQpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKGhhbmRsZXIuQ3JlZGVudGlhbHMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCg1MCwgaGFuZGxlci5NYXhBdXRvbWF0aWNSZWRpcmVjdGlvbnMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKGhhbmRsZXIuUHJvcGVydGllcyk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKG51bGwsIGhhbmRsZXIuUHJveHkpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGhhbmRsZXIuU3VwcG9ydHNBdXRvbWF0aWNEZWNvbXByZXNzaW9uKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShoYW5kbGVyLlVzZUNvb2tpZXMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShoYW5kbGVyLlVzZURlZmF1bHRDcmVkZW50aWFscyk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaGFuZGxlci5Vc2VQcm94eSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCldDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBDdG9yX0V4cGVjdGVkRGVmYXVsdFByb3BlcnR5VmFsdWVzX05vdFVhcFBsYXRmb3JtKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFNhbWUgYXMgLk5FVCBGcmFtZXdvcmsgKERlc2t0b3ApLg0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCg2NCwgaGFuZGxlci5NYXhSZXNwb25zZUhlYWRlcnNMZW5ndGgpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShoYW5kbGVyLlByZUF1dGhlbnRpY2F0ZSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaGFuZGxlci5TdXBwb3J0c1Byb3h5KTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShoYW5kbGVyLlN1cHBvcnRzUmVkaXJlY3RDb25maWd1cmF0aW9uKTsNCg0KICAgICAgICAgICAgICAgIC8vIENoYW5nZXMgZnJvbSAuTkVUIEZyYW1ld29yayAoRGVza3RvcCkuDQogICAgICAgICAgICAgICAgaWYgKCFQbGF0Zm9ybURldGVjdGlvbi5Jc0Z1bGxGcmFtZXdvcmspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UoaGFuZGxlci5DaGVja0NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3QpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgaGFuZGxlci5NYXhSZXF1ZXN0Q29udGVudEJ1ZmZlclNpemUpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoU3NsUHJvdG9jb2xzLk5vbmUsIGhhbmRsZXIuU3NsUHJvdG9jb2xzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbQ29uZGl0aW9uYWxGYWN0KHR5cGVvZihQbGF0Zm9ybURldGVjdGlvbiksIG5hbWVvZihQbGF0Zm9ybURldGVjdGlvbi5Jc1VhcCkpXQ0KICAgICAgICBwdWJsaWMgdm9pZCBDdG9yX0V4cGVjdGVkRGVmYXVsdFByb3BlcnR5VmFsdWVzX1VhcFBsYXRmb3JtKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGhhbmRsZXIuQ2hlY2tDZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0KTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgaGFuZGxlci5NYXhSZXF1ZXN0Q29udGVudEJ1ZmZlclNpemUpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgtMSwgaGFuZGxlci5NYXhSZXNwb25zZUhlYWRlcnNMZW5ndGgpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGhhbmRsZXIuUHJlQXV0aGVudGljYXRlKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoU3NsUHJvdG9jb2xzLk5vbmUsIGhhbmRsZXIuU3NsUHJvdG9jb2xzKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UoaGFuZGxlci5TdXBwb3J0c1Byb3h5KTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UoaGFuZGxlci5TdXBwb3J0c1JlZGlyZWN0Q29uZmlndXJhdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgQ3JlZGVudGlhbHNfU2V0R2V0X1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIGNyZWRzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKCJ1c2VybmFtZSIsICJwYXNzd29yZCIsICJkb21haW4iKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBudWxsOw0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKGhhbmRsZXIuQ3JlZGVudGlhbHMpOw0KDQogICAgICAgICAgICAgICAgaGFuZGxlci5DcmVkZW50aWFscyA9IGNyZWRzOw0KICAgICAgICAgICAgICAgIEFzc2VydC5TYW1lKGNyZWRzLCBoYW5kbGVyLkNyZWRlbnRpYWxzKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBDcmVkZW50aWFsQ2FjaGUuRGVmYXVsdENyZWRlbnRpYWxzOw0KICAgICAgICAgICAgICAgIEFzc2VydC5TYW1lKENyZWRlbnRpYWxDYWNoZS5EZWZhdWx0Q3JlZGVudGlhbHMsIGhhbmRsZXIuQ3JlZGVudGlhbHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoLTEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgwKV0NCiAgICAgICAgcHVibGljIHZvaWQgTWF4QXV0b21hdGljUmVkaXJlY3Rpb25zX0ludmFsaWRWYWx1ZV9UaHJvd3MoaW50IHJlZGlyZWN0cykNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiBoYW5kbGVyLk1heEF1dG9tYXRpY1JlZGlyZWN0aW9ucyA9IHJlZGlyZWN0cyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSgtMSldDQogICAgICAgIFtJbmxpbmVEYXRhKChsb25nKWludC5NYXhWYWx1ZSArIChsb25nKTEpXQ0KICAgICAgICBwdWJsaWMgdm9pZCBNYXhSZXF1ZXN0Q29udGVudEJ1ZmZlclNpemVfU2V0SW52YWxpZFZhbHVlX1Rocm93c0FyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbihsb25nIHZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCgpID0+IGhhbmRsZXIuTWF4UmVxdWVzdENvbnRlbnRCdWZmZXJTaXplID0gdmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXAsICJVQVAgd2lsbCBzZW5kIGRlZmF1bHQgY3JlZGVudGlhbHMgYmFzZWQgb24gb3RoZXIgY3JpdGVyaWEuIildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKGZhbHNlKV0NCiAgICAgICAgW0lubGluZURhdGEodHJ1ZSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFVzZURlZmF1bHRDcmVkZW50aWFsc19TZXRUb0ZhbHNlQW5kU2VydmVyTmVlZHNBdXRoX1N0YXR1c0NvZGVVbmF1dGhvcml6ZWQoYm9vbCB1c2VQcm94eSkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLlVzZVByb3h5ID0gdXNlUHJveHk7DQogICAgICAgICAgICBoYW5kbGVyLlVzZURlZmF1bHRDcmVkZW50aWFscyA9IGZhbHNlOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLk5lZ290aWF0ZUF1dGhVcmlGb3JEZWZhdWx0Q3JlZHMoc2VjdXJlOiBmYWxzZSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlVyaTogezB9IiwgdXJpKTsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLlVuYXV0aG9yaXplZCwgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0NCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoUmVkaXJlY3RTdGF0dXNDb2RlcykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBEZWZhdWx0SGVhZGVyc19TZXRDcmVkZW50aWFsc19DbGVhcmVkT25SZWRpcmVjdChpbnQgc3RhdHVzQ29kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBjcmVkZW50aWFsU3RyaW5nID0gX2NyZWRlbnRpYWwuVXNlck5hbWUgKyAiOiIgKyBfY3JlZGVudGlhbC5QYXNzd29yZDsNCiAgICAgICAgICAgICAgICBjbGllbnQuRGVmYXVsdFJlcXVlc3RIZWFkZXJzLkF1dGhvcml6YXRpb24gPSBuZXcgQXV0aGVudGljYXRpb25IZWFkZXJWYWx1ZSgiQmFzaWMiLCBjcmVkZW50aWFsU3RyaW5nKTsNCiAgICAgICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLlJlZGlyZWN0VXJpRm9yRGVzdGluYXRpb25VcmkoDQogICAgICAgICAgICAgICAgICAgIHNlY3VyZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHN0YXR1c0NvZGUsDQogICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uVXJpOiBDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlciwNCiAgICAgICAgICAgICAgICAgICAgaG9wczogMSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlVyaTogezB9IiwgdXJpKTsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlVGV4dCA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUocmVzcG9uc2VUZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKFRlc3RIZWxwZXIuSnNvbk1lc3NhZ2VDb250YWluc0tleShyZXNwb25zZVRleHQsICJBdXRob3JpemF0aW9uIikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBQcm9wZXJ0aWVzX0dldF9Db3VudElzWmVybygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJRGljdGlvbmFyeTxTdHJpbmcsIG9iamVjdD4gZGljdCA9IGhhbmRsZXIuUHJvcGVydGllczsNCiAgICAgICAgICAgICAgICBBc3NlcnQuU2FtZShkaWN0LCBoYW5kbGVyLlByb3BlcnRpZXMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCBkaWN0LkNvdW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBQcm9wZXJ0aWVzX0FkZEl0ZW1Ub0RpY3Rpb25hcnlfSXRlbVByZXNlbnQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSURpY3Rpb25hcnk8U3RyaW5nLCBvYmplY3Q+IGRpY3QgPSBoYW5kbGVyLlByb3BlcnRpZXM7DQoNCiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG5ldyBPYmplY3QoKTsNCiAgICAgICAgICAgICAgICBkaWN0LkFkZCgiaXRlbSIsIGl0ZW0pOw0KDQogICAgICAgICAgICAgICAgb2JqZWN0IHZhbHVlOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGRpY3QuVHJ5R2V0VmFsdWUoIml0ZW0iLCBvdXQgdmFsdWUpKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoaXRlbSwgdmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKEVjaG9TZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRBc3luY19TaW1wbGVHZXRfU3VjY2VzcyhVcmkgcmVtb3RlU2VydmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyhyZW1vdGVTZXJ2ZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUocmVzcG9uc2VDb250ZW50KTsNCiAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlc3BvbnNlQm9keSgNCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDb250ZW50LA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5Db250ZW50LkhlYWRlcnMuQ29udGVudE1ENSwNCiAgICAgICAgICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKGZhbHNlKV0NCiAgICAgICAgW0lubGluZURhdGEodHJ1ZSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRBc3luY19HZXRXaXRoVmFsaWRIb3N0SGVhZGVyX1N1Y2Nlc3MoYm9vbCB3aXRoUG9ydCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIG0gPSBuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuR2V0LCBDb25maWd1cmF0aW9uLkh0dHAuU2VjdXJlUmVtb3RlRWNob1NlcnZlcik7DQogICAgICAgICAgICBtLkhlYWRlcnMuSG9zdCA9IHdpdGhQb3J0ID8gQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZUhvc3QgKyAiOjEyMyIgOiBDb25maWd1cmF0aW9uLkh0dHAuU2VjdXJlSG9zdDsNCg0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuU2VuZEFzeW5jKG0pKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUocmVzcG9uc2VDb250ZW50KTsNCiAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlc3BvbnNlQm9keSgNCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDb250ZW50LA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5Db250ZW50LkhlYWRlcnMuQ29udGVudE1ENSwNCiAgICAgICAgICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTZW5kQXN5bmNfR2V0V2l0aEludmFsaWRIb3N0SGVhZGVyX1Rocm93c0V4Y2VwdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChQbGF0Zm9ybURldGVjdGlvbi5Jc05ldENvcmUgJiYgIVVzZVNvY2tldHNIdHRwSGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBbQWN0aXZlSXNzdWUoMjQ4NjIpXQ0KICAgICAgICAgICAgICAgIC8vIFdpbkh0dHBIYW5kbGVyIGFuZCBDdXJsSGFuZGxlciBkbyBub3QgdXNlIHRoZSBIb3N0IGhlYWRlciB0byBpbmZsdWVuY2UgdGhlIFNTTCBhdXRoLg0KICAgICAgICAgICAgICAgIC8vIC5ORVQgRnJhbWV3b3JrIGFuZCBTb2NrZXRzSHR0cEhhbmRsZXIgZG8uDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgbSA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UoSHR0cE1ldGhvZC5HZXQsIENvbmZpZ3VyYXRpb24uSHR0cC5TZWN1cmVSZW1vdGVFY2hvU2VydmVyKTsNCiAgICAgICAgICAgIG0uSGVhZGVycy5Ib3N0ID0gImhvc3RoZWFkZXJ0aGF0ZG9lc25vdG1hdGNoIjsNCg0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxIdHRwUmVxdWVzdEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50LlNlbmRBc3luYyhtKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbQWN0aXZlSXNzdWUoMjIxNTgsIFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCldDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbQ29uZGl0aW9uYWxGYWN0KHR5cGVvZihQbGF0Zm9ybURldGVjdGlvbiksIG5hbWVvZihQbGF0Zm9ybURldGVjdGlvbi5Jc05vdFdpbmRvd3NTdWJzeXN0ZW1Gb3JMaW51eCkpXSAvLyBUT0RPOiBtYWtlIHVuY29uZGl0aW9uYWwgYWZ0ZXIgIzI2ODEzIGFuZCAjMjY0NzYgYXJlIGZpeGVkDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX0lQdjZMaW5rTG9jYWxBZGRyZXNzVXJpX1N1Y2Nlc3MoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBuZXcgTG9vcGJhY2tTZXJ2ZXIuT3B0aW9ucyB7IEFkZHJlc3MgPSBUZXN0SGVscGVyLkdldElQdjZMaW5rTG9jYWxBZGRyZXNzKCkgfTsNCiAgICAgICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSh1cmwuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKA0KICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKCksDQogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnQuR2V0QXN5bmModXJsKSk7DQogICAgICAgICAgICAgICAgfSwgb3B0aW9ucyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKEdldEFzeW5jX0lQQmFzZWRVcmlfU3VjY2Vzc19NZW1iZXJEYXRhKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX0lQQmFzZWRVcmlfU3VjY2VzcyhJUEFkZHJlc3MgYWRkcmVzcykNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gbmV3IExvb3BiYWNrU2VydmVyLk9wdGlvbnMgeyBBZGRyZXNzID0gYWRkcmVzcyB9Ow0KICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHVybC5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQoDQogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudC5HZXRBc3luYyh1cmwpKTsNCiAgICAgICAgICAgICAgICB9LCBvcHRpb25zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgSUVudW1lcmFibGU8b2JqZWN0W10+IEdldEFzeW5jX0lQQmFzZWRVcmlfU3VjY2Vzc19NZW1iZXJEYXRhKCkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFkZHIgaW4gbmV3W10geyBJUEFkZHJlc3MuTG9vcGJhY2ssIElQQWRkcmVzcy5JUHY2TG9vcGJhY2sgfSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoYWRkciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7IGFkZHIgfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRBc3luY19NdWx0aXBsZVJlcXVlc3RzUmV1c2luZ1NhbWVDbGllbnRfU3VjY2VzcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDM7IGkrKykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfUmVzcG9uc2VDb250ZW50QWZ0ZXJDbGllbnRBbmRIYW5kbGVyRGlzcG9zZV9TdWNjZXNzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmMoQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZVJlbW90ZUVjaG9TZXJ2ZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNsaWVudC5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwocmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUocmVzcG9uc2VDb250ZW50KTsNCiAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlc3BvbnNlQm9keShyZXNwb25zZUNvbnRlbnQsIHJlc3BvbnNlLkNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1LCBmYWxzZSwgbnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRBc3luY19DYW5jZWxfQ2FuY2VsbGF0aW9uVG9rZW5Qcm9wYWdhdGVzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIGN0cyA9IG5ldyBDYW5jZWxsYXRpb25Ub2tlblNvdXJjZSgpOw0KICAgICAgICAgICAgY3RzLkNhbmNlbCgpOw0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLlBvc3QsIENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyKTsNCiAgICAgICAgICAgICAgICBUYXNrQ2FuY2VsZWRFeGNlcHRpb24gZXggPSBhd2FpdCBBc3NlcnQuVGhyb3dzQXN5bmM8VGFza0NhbmNlbGVkRXhjZXB0aW9uPigoKSA9Pg0KICAgICAgICAgICAgICAgICAgICBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QsIGN0cy5Ub2tlbikpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGN0cy5Ub2tlbi5Jc0NhbmNlbGxhdGlvblJlcXVlc3RlZCwgImN0cyB0b2tlbiBJc0NhbmNlbGxhdGlvblJlcXVlc3RlZCIpOw0KICAgICAgICAgICAgICAgIGlmICghUGxhdGZvcm1EZXRlY3Rpb24uSXNGdWxsRnJhbWV3b3JrKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gLk5FVCBGcmFtZXdvcmsgaGFzIGJ1ZyB3aGVyZSBpdCBkb2Vzbid0IHByb3BhZ2F0ZSB0b2tlbiBpbmZvcm1hdGlvbi4NCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZXguQ2FuY2VsbGF0aW9uVG9rZW4uSXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQsICJleGNlcHRpb24gdG9rZW4gSXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoQ29tcHJlc3NlZFNlcnZlcnMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfU2V0QXV0b21hdGljRGVjb21wcmVzc2lvbl9Db250ZW50RGVjb21wcmVzc2VkKFVyaSBzZXJ2ZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5BdXRvbWF0aWNEZWNvbXByZXNzaW9uID0gRGVjb21wcmVzc2lvbk1ldGhvZHMuR1ppcCB8IERlY29tcHJlc3Npb25NZXRob2RzLkRlZmxhdGU7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHNlcnZlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2VDb250ZW50ID0gYXdhaXQgcmVzcG9uc2UuQ29udGVudC5SZWFkQXNTdHJpbmdBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShyZXNwb25zZUNvbnRlbnQpOw0KICAgICAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlc3BvbnNlQm9keSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29udGVudCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLkNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1LA0KICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBudWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoQ29tcHJlc3NlZFNlcnZlcnMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfU2V0QXV0b21hdGljRGVjb21wcmVzc2lvbl9IZWFkZXJzUmVtb3ZlZChVcmkgc2VydmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuQXV0b21hdGljRGVjb21wcmVzc2lvbiA9IERlY29tcHJlc3Npb25NZXRob2RzLkdaaXAgfCBEZWNvbXByZXNzaW9uTWV0aG9kcy5EZWZsYXRlOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHNlcnZlciwgSHR0cENvbXBsZXRpb25PcHRpb24uUmVzcG9uc2VIZWFkZXJzUmVhZCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShyZXNwb25zZS5Db250ZW50LkhlYWRlcnMuQ29udGFpbnMoIkNvbnRlbnQtRW5jb2RpbmciKSwgIkNvbnRlbnQtRW5jb2RpbmcgdW5leHBlY3RlZGx5IGZvdW5kIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKHJlc3BvbnNlLkNvbnRlbnQuSGVhZGVycy5Db250YWlucygiQ29udGVudC1MZW5ndGgiKSwgIkNvbnRlbnQtTGVuZ3RoIHVuZXhwZWN0ZWRseSBmb3VuZCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19TZXJ2ZXJOZWVkc0Jhc2ljQXV0aEFuZFNldERlZmF1bHRDcmVkZW50aWFsc19TdGF0dXNDb2RlVW5hdXRob3JpemVkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHRDcmVkZW50aWFsczsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVXJpIHVyaSA9IENvbmZpZ3VyYXRpb24uSHR0cC5CYXNpY0F1dGhVcmlGb3JDcmVkcyhzZWN1cmU6IGZhbHNlLCB1c2VyTmFtZTogVXNlcm5hbWUsIHBhc3N3b3JkOiBQYXNzd29yZCk7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJpKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5VbmF1dGhvcml6ZWQsIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfU2VydmVyTmVlZHNBdXRoQW5kU2V0Q3JlZGVudGlhbF9TdGF0dXNDb2RlT0soKQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBfY3JlZGVudGlhbDsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVXJpIHVyaSA9IENvbmZpZ3VyYXRpb24uSHR0cC5CYXNpY0F1dGhVcmlGb3JDcmVkcyhzZWN1cmU6IGZhbHNlLCB1c2VyTmFtZTogVXNlcm5hbWUsIHBhc3N3b3JkOiBQYXNzd29yZCk7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJpKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBHZXRBc3luY19TZXJ2ZXJOZWVkc0F1dGhBbmROb0NyZWRlbnRpYWxfU3RhdHVzQ29kZVVuYXV0aG9yaXplZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIFVBUCBIVFRQIHN0YWNrIGNhY2hlcyBjb25uZWN0aW9ucyBwZXItcHJvY2Vzcy4gVGhpcyBjYXVzZXMgaW50ZXJmZXJlbmNlIHdoZW4gdGhlc2UgdGVzdHMgcnVuIGluDQogICAgICAgICAgICAvLyB0aGUgc2FtZSBwcm9jZXNzIGFzIHRoZSBvdGhlciB0ZXN0cy4gRWFjaCB0ZXN0IG5lZWRzIHRvIGJlIGlzb2xhdGVkIHRvIGl0cyBvd24gcHJvY2Vzcy4NCiAgICAgICAgICAgIC8vIFNlZSBkaWN1c3Npb246IGh0dHBzOi8vZ2l0aHViLmNvbS9kb3RuZXQvY29yZWZ4L2lzc3Vlcy8yMTk0NQ0KICAgICAgICAgICAgUmVtb3RlSW52b2tlKGFzeW5jIHVzZVNvY2tldHNIdHRwSGFuZGxlclN0cmluZyA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCh1c2VTb2NrZXRzSHR0cEhhbmRsZXJTdHJpbmcpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVXJpIHVyaSA9IENvbmZpZ3VyYXRpb24uSHR0cC5CYXNpY0F1dGhVcmlGb3JDcmVkcyhzZWN1cmU6IGZhbHNlLCB1c2VyTmFtZTogVXNlcm5hbWUsIHBhc3N3b3JkOiBQYXNzd29yZCk7DQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVyaSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5VbmF1dGhvcml6ZWQsIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN1Y2Nlc3NFeGl0Q29kZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIuVG9TdHJpbmcoKSkuRGlzcG9zZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKCJXV1ctQXV0aGVudGljYXRlOiBDdXN0b21BdXRoXHJcbiIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiIildIC8vIFJGQzcyMzUgcmVxdWlyZXMgc2VydmVycyB0byBzZW5kIHRoaXMgaGVhZGVyIHdpdGggNDAxIGJ1dCBzb21lIHNlcnZlcnMgZG9uJ3QuDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX1NlcnZlck5lZWRzTm9uU3RhbmRhcmRBdXRoQW5kU2V0Q3JlZGVudGlhbF9TdGF0dXNDb2RlVW5hdXRob3JpemVkKHN0cmluZyBhdXRoSGVhZGVycykNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoInVudXNlZCIsICJ1bnVzZWQiKTsNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXRSZXNwb25zZVRhc2sgPSBjbGllbnQuR2V0QXN5bmModXJsKTsNCiAgICAgICAgICAgICAgICAgICAgVGFzazxMaXN0PHN0cmluZz4+IHNlcnZlclRhc2sgPSBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkKTsNCg0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChnZXRSZXNwb25zZVRhc2ssIHNlcnZlclRhc2spOw0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGdldFJlc3BvbnNlVGFzaykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLlVuYXV0aG9yaXplZCwgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihSZWRpcmVjdFN0YXR1c0NvZGVzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX0FsbG93QXV0b1JlZGlyZWN0RmFsc2VfUmVkaXJlY3RGcm9tSHR0cFRvSHR0cF9TdGF0dXNDb2RlUmVkaXJlY3QoaW50IHN0YXR1c0NvZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCA9IGZhbHNlOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLlJlZGlyZWN0VXJpRm9yRGVzdGluYXRpb25VcmkoDQogICAgICAgICAgICAgICAgICAgIHNlY3VyZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHN0YXR1c0NvZGUsDQogICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uVXJpOiBDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlciwNCiAgICAgICAgICAgICAgICAgICAgaG9wczogMSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlVyaTogezB9IiwgdXJpKTsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHN0YXR1c0NvZGUsIChpbnQpcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCh1cmksIHJlc3BvbnNlLlJlcXVlc3RNZXNzYWdlLlJlcXVlc3RVcmkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKFJlZGlyZWN0U3RhdHVzQ29kZXNPbGRNZXRob2RzTmV3TWV0aG9kcykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBBbGxvd0F1dG9SZWRpcmVjdF9UcnVlX1ZhbGlkYXRlTmV3TWV0aG9kVXNlZE9uUmVkaXJlY3Rpb24oDQogICAgICAgICAgICBpbnQgc3RhdHVzQ29kZSwgc3RyaW5nIG9sZE1ldGhvZCwgc3RyaW5nIG5ld01ldGhvZCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzQ3VybEhhbmRsZXIgJiYgc3RhdHVzQ29kZSA9PSAzMDAgJiYgb2xkTWV0aG9kID09ICJQT1NUIikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBLbm93biBiZWhhdmlvcjogY3VybCBkb2VzIG5vdCBjaGFuZ2UgbWV0aG9kIHRvICJHRVQiDQogICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2RvdG5ldC9jb3JlZngvaXNzdWVzLzI2NDM0DQogICAgICAgICAgICAgICAgbmV3TWV0aG9kID0gIlBPU1QiOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKG9yaWdTZXJ2ZXIsIG9yaWdVcmwpID0+DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UobmV3IEh0dHBNZXRob2Qob2xkTWV0aG9kKSwgb3JpZ1VybCk7DQoNCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXRSZXNwb25zZVRhc2sgPSBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QpOw0KDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChyZWRpclNlcnZlciwgcmVkaXJVcmwpID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9yaWdpbmFsIFVSTCB3aWxsIHJlZGlyZWN0IHRvIGEgZGlmZmVyZW50IFVSTA0KICAgICAgICAgICAgICAgICAgICAgICAgVGFzazxMaXN0PHN0cmluZz4+IHNlcnZlclRhc2sgPSBvcmlnU2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKChIdHRwU3RhdHVzQ29kZSlzdGF0dXNDb2RlLCAkIkxvY2F0aW9uOiB7cmVkaXJVcmx9XHJcbiIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLldoZW5BbnkoZ2V0UmVzcG9uc2VUYXNrLCBzZXJ2ZXJUYXNrKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShnZXRSZXNwb25zZVRhc2suSXNDb21wbGV0ZWQsICQie2dldFJlc3BvbnNlVGFzay5TdGF0dXN9OiB7Z2V0UmVzcG9uc2VUYXNrLkV4Y2VwdGlvbn0iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlclRhc2s7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZGlyZWN0ZWQgVVJMIGFuc3dlcnMgd2l0aCBzdWNjZXNzDQogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJUYXNrID0gcmVkaXJTZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKGdldFJlc3BvbnNlVGFzaywgc2VydmVyVGFzayk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZWNlaXZlZFJlcXVlc3QgPSBhd2FpdCBzZXJ2ZXJUYXNrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBzdGF0dXNMaW5lUGFydHMgPSByZWNlaXZlZFJlcXVlc3RbMF0uU3BsaXQoJyAnKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBnZXRSZXNwb25zZVRhc2spDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDIwMCwgKGludClyZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwobmV3TWV0aG9kLCBzdGF0dXNMaW5lUGFydHNbMF0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKDMwMCldDQogICAgICAgIFtJbmxpbmVEYXRhKDMwMSldDQogICAgICAgIFtJbmxpbmVEYXRhKDMwMildDQogICAgICAgIFtJbmxpbmVEYXRhKDMwMyldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEFsbG93QXV0b1JlZGlyZWN0X1RydWVfUG9zdFRvR2V0RG9lc05vdFNlbmRURShpbnQgc3RhdHVzQ29kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzQ3VybEhhbmRsZXIgJiYgc3RhdHVzQ29kZSA9PSAzMDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gSVNTVUUgIzI2NDM0Og0KICAgICAgICAgICAgICAgIC8vIEN1cmxIYW5kbGVyIGRvZXNuJ3QgY2hhbmdlIFBPU1QgdG8gR0VUIGZvciAzMDAgcmVzcG9uc2UgKHNlZSBhYm92ZSB0ZXN0KS4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChJc1dpbkh0dHBIYW5kbGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIElTU1VFICMyNzQ0MDoNCiAgICAgICAgICAgICAgICAvLyBUaGlzIHRlc3Qgb2NjYXNpb25hbGx5IGZhaWxzIG9uIFdpbkh0dHBIYW5kbGVyLg0KICAgICAgICAgICAgICAgIC8vIExpa2VseSB0aGlzIGlzIGR1ZSB0byB0aGUgd2F5IHRoZSBsb29wYmFjayBzZXJ2ZXIgaXMgc2VuZGluZyB0aGUgcmVzcG9uc2UgYmVmb3JlIHJlYWRpbmcgdGhlIGVudGlyZSByZXF1ZXN0Lg0KICAgICAgICAgICAgICAgIC8vIFdlIHNob3VsZCBjaGFuZ2UgdGhlIHNlcnZlciBiZWhhdmlvciBoZXJlLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChvcmlnU2VydmVyLCBvcmlnVXJsKSA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuUG9zdCwgb3JpZ1VybCk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuQ29udGVudCA9IG5ldyBTdHJpbmdDb250ZW50KEV4cGVjdGVkQ29udGVudCk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5UcmFuc2ZlckVuY29kaW5nQ2h1bmtlZCA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXRSZXNwb25zZVRhc2sgPSBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QpOw0KDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChyZWRpclNlcnZlciwgcmVkaXJVcmwpID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9yaWdpbmFsIFVSTCB3aWxsIHJlZGlyZWN0IHRvIGEgZGlmZmVyZW50IFVSTA0KICAgICAgICAgICAgICAgICAgICAgICAgVGFzayBzZXJ2ZXJUYXNrID0gb3JpZ1NlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbiA9Pg0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlbmQgQ29ubmVjdGlvbjogY2xvc2Ugc28gdGhlIGNsaWVudCB3aWxsIGNsb3NlIGNvbm5lY3Rpb24gYWZ0ZXIgcmVxdWVzdCBpcyBzZW50LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1lYW5pbmcgd2UgY2FuIGp1c3QgcmVhZCB0byB0aGUgZW5kIHRvIGdldCB0aGUgY29udGVudA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uUmVhZFJlcXVlc3RIZWFkZXJBbmRTZW5kUmVzcG9uc2VBc3luYygoSHR0cFN0YXR1c0NvZGUpc3RhdHVzQ29kZSwgJCJMb2NhdGlvbjoge3JlZGlyVXJsfVxyXG5Db25uZWN0aW9uOiBjbG9zZVxyXG4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLlNvY2tldC5TaHV0ZG93bihTb2NrZXRTaHV0ZG93bi5TZW5kKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlJlYWRlci5SZWFkVG9FbmRBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRhc2suV2hlbkFueShnZXRSZXNwb25zZVRhc2ssIHNlcnZlclRhc2spOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKGdldFJlc3BvbnNlVGFzay5Jc0NvbXBsZXRlZCwgJCJ7Z2V0UmVzcG9uc2VUYXNrLlN0YXR1c306IHtnZXRSZXNwb25zZVRhc2suRXhjZXB0aW9ufSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VydmVyVGFzazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVkaXJlY3RlZCBVUkwgYW5zd2VycyB3aXRoIHN1Y2Nlc3MNCiAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZWNlaXZlZFJlcXVlc3QgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlY2VpdmVkQ29udGVudCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgICAgICBUYXNrIHNlcnZlclRhc2syID0gcmVkaXJTZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24gPT4NCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIENvbm5lY3Rpb246IGNsb3NlIHNvIHRoZSBjbGllbnQgd2lsbCBjbG9zZSBjb25uZWN0aW9uIGFmdGVyIHJlcXVlc3QgaXMgc2VudCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtZWFuaW5nIHdlIGNhbiBqdXN0IHJlYWQgdG8gdGhlIGVuZCB0byBnZXQgdGhlIGNvbnRlbnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlZFJlcXVlc3QgPSBhd2FpdCBjb25uZWN0aW9uLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZFJlc3BvbnNlQXN5bmMoYWRkaXRpb25hbEhlYWRlcnM6ICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLlNvY2tldC5TaHV0ZG93bihTb2NrZXRTaHV0ZG93bi5TZW5kKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlZENvbnRlbnQgPSBhd2FpdCBjb25uZWN0aW9uLlJlYWRlci5SZWFkVG9FbmRBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKGdldFJlc3BvbnNlVGFzaywgc2VydmVyVGFzazIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBzdGF0dXNMaW5lUGFydHMgPSByZWNlaXZlZFJlcXVlc3RbMF0uU3BsaXQoJyAnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiR0VUIiwgc3RhdHVzTGluZVBhcnRzWzBdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5Eb2VzTm90Q29udGFpbihyZWNlaXZlZFJlcXVlc3QsIGxpbmUgPT4gbGluZS5TdGFydHNXaXRoKCJUcmFuc2Zlci1FbmNvZGluZyIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5Eb2VzTm90Q29udGFpbihyZWNlaXZlZFJlcXVlc3QsIGxpbmUgPT4gbGluZS5TdGFydHNXaXRoKCJDb250ZW50LUxlbmd0aCIpKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBnZXRSZXNwb25zZVRhc2spDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDIwMCwgKGludClyZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoUmVkaXJlY3RTdGF0dXNDb2RlcykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19BbGxvd0F1dG9SZWRpcmVjdFRydWVfUmVkaXJlY3RGcm9tSHR0cFRvSHR0cF9TdGF0dXNDb2RlT0soaW50IHN0YXR1c0NvZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCA9IHRydWU7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFVyaSB1cmkgPSBDb25maWd1cmF0aW9uLkh0dHAuUmVkaXJlY3RVcmlGb3JEZXN0aW5hdGlvblVyaSgNCiAgICAgICAgICAgICAgICAgICAgc2VjdXJlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZSwNCiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25Vcmk6IENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyLA0KICAgICAgICAgICAgICAgICAgICBob3BzOiAxKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiVXJpOiB7MH0iLCB1cmkpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVyaSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIsIHJlc3BvbnNlLlJlcXVlc3RNZXNzYWdlLlJlcXVlc3RVcmkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfQWxsb3dBdXRvUmVkaXJlY3RUcnVlX1JlZGlyZWN0RnJvbUh0dHBUb0h0dHBzX1N0YXR1c0NvZGVPSygpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCA9IHRydWU7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFVyaSB1cmkgPSBDb25maWd1cmF0aW9uLkh0dHAuUmVkaXJlY3RVcmlGb3JEZXN0aW5hdGlvblVyaSgNCiAgICAgICAgICAgICAgICAgICAgc2VjdXJlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMzAyLA0KICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblVyaTogQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZVJlbW90ZUVjaG9TZXJ2ZXIsDQogICAgICAgICAgICAgICAgICAgIGhvcHM6IDEpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJVcmk6IHswfSIsIHVyaSk7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJpKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChDb25maWd1cmF0aW9uLkh0dHAuU2VjdXJlUmVtb3RlRWNob1NlcnZlciwgcmVzcG9uc2UuUmVxdWVzdE1lc3NhZ2UuUmVxdWVzdFVyaSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICIuTkVUIEZyYW1ld29yayBhbGxvd3MgSFRUUFMgdG8gSFRUUCByZWRpcmVjdGlvbiIpXQ0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX0FsbG93QXV0b1JlZGlyZWN0VHJ1ZV9SZWRpcmVjdEZyb21IdHRwc1RvSHR0cF9TdGF0dXNDb2RlUmVkaXJlY3QoKQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuQWxsb3dBdXRvUmVkaXJlY3QgPSB0cnVlOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLlJlZGlyZWN0VXJpRm9yRGVzdGluYXRpb25VcmkoDQogICAgICAgICAgICAgICAgICAgIHNlY3VyZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMzAyLA0KICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblVyaTogQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIsDQogICAgICAgICAgICAgICAgICAgIGhvcHM6IDEpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJVcmk6IHswfSIsIHVyaSk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLlJlZGlyZWN0LCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHVyaSwgcmVzcG9uc2UuUmVxdWVzdE1lc3NhZ2UuUmVxdWVzdFVyaSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX0FsbG93QXV0b1JlZGlyZWN0VHJ1ZV9SZWRpcmVjdFdpdGhvdXRMb2NhdGlvbl9SZXR1cm5zT3JpZ2luYWxSZXNwb25zZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIFtBY3RpdmVJc3N1ZSgyNDgxOSwgVGVzdFBsYXRmb3Jtcy5XaW5kb3dzKV0NCiAgICAgICAgICAgIGlmIChQbGF0Zm9ybURldGVjdGlvbi5Jc1dpbmRvd3MgJiYgUGxhdGZvcm1EZXRlY3Rpb24uSXNOZXRDb3JlICYmICFVc2VTb2NrZXRzSHR0cEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuQWxsb3dBdXRvUmVkaXJlY3QgPSB0cnVlOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFRhc2sgPSBjbGllbnQuR2V0QXN5bmModXJsKTsNCiAgICAgICAgICAgICAgICAgICAgVGFzazxMaXN0PHN0cmluZz4+IHNlcnZlclRhc2sgPSBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuRm91bmQpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChnZXRUYXNrLCBzZXJ2ZXJUYXNrKTsNCg0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGdldFRhc2spDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgzMDIsIChpbnQpcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfQWxsb3dBdXRvUmVkaXJlY3RUcnVlX1JlZGlyZWN0VG9VcmlXaXRoUGFyYW1zX1JlcXVlc3RNc2dVcmlTZXQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuQWxsb3dBdXRvUmVkaXJlY3QgPSB0cnVlOw0KICAgICAgICAgICAgVXJpIHRhcmdldFVyaSA9IENvbmZpZ3VyYXRpb24uSHR0cC5CYXNpY0F1dGhVcmlGb3JDcmVkcyhzZWN1cmU6IGZhbHNlLCB1c2VyTmFtZTogVXNlcm5hbWUsIHBhc3N3b3JkOiBQYXNzd29yZCk7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFVyaSB1cmkgPSBDb25maWd1cmF0aW9uLkh0dHAuUmVkaXJlY3RVcmlGb3JEZXN0aW5hdGlvblVyaSgNCiAgICAgICAgICAgICAgICAgICAgc2VjdXJlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMzAyLA0KICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblVyaTogdGFyZ2V0VXJpLA0KICAgICAgICAgICAgICAgICAgICBob3BzOiAxKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiVXJpOiB7MH0iLCB1cmkpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVyaSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHRhcmdldFVyaSwgcmVzcG9uc2UuUmVxdWVzdE1lc3NhZ2UuUmVxdWVzdFVyaSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXAsICJOb3QgY3VycmVudGx5IHN1cHBvcnRlZCBvbiBVQVAiKV0NCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKDMsIDIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgzLCAzKV0NCiAgICAgICAgW0lubGluZURhdGEoMywgNCldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX01heEF1dG9tYXRpY1JlZGlyZWN0aW9uc05TZXJ2ZXJIb3BzX1Rocm93c0lmVG9vTWFueShpbnQgbWF4SG9wcywgaW50IGhvcHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChJc1dpbkh0dHBIYW5kbGVyICYmICFQbGF0Zm9ybURldGVjdGlvbi5Jc1dpbmRvd3MxMFZlcnNpb24xNzAzT3JHcmVhdGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFNraXAgdGhpcyB0ZXN0IGlmIHVzaW5nIFdpbkh0dHBIYW5kbGVyIGJ1dCBvbiBhIHJlbGVhc2UgcHJpb3IgdG8gV2luZG93cyAxMCBDcmVhdG9ycyBVcGRhdGUuDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlNraXBwaW5nIHRlc3QgZHVlIHRvIFdpbmRvd3MgMTAgdmVyc2lvbiBwcmlvciB0byBWZXJzaW9uIDE3MDMuIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoUGxhdGZvcm1EZXRlY3Rpb24uSXNGdWxsRnJhbWV3b3JrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFNraXAgdGhpcyB0ZXN0IGlmIHJ1bm5pbmcgb24gLk5FVCBGcmFtZXdvcmsuIEV4Y2VlZGluZyBtYXggcmVkaXJlY3Rpb25zIHdpbGwgbm90IHRocm93DQogICAgICAgICAgICAgICAgLy8gZXhjZXB0aW9uLiBJbnN0ZWFkLCBpdCBzaW1wbHkgcmV0dXJucyB0aGUgM3h4IHJlc3BvbnNlLg0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJTa2lwcGluZyB0ZXN0IG9uIC5ORVQgRnJhbWV3b3JrIGR1ZSB0byBiZWhhdmlvciBkaWZmZXJlbmNlLiIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLk1heEF1dG9tYXRpY1JlZGlyZWN0aW9ucyA9IG1heEhvcHM7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gdCA9IGNsaWVudC5HZXRBc3luYyhDb25maWd1cmF0aW9uLkh0dHAuUmVkaXJlY3RVcmlGb3JEZXN0aW5hdGlvblVyaSgNCiAgICAgICAgICAgICAgICAgICAgc2VjdXJlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMzAyLA0KICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblVyaTogQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIsDQogICAgICAgICAgICAgICAgICAgIGhvcHM6IGhvcHMpKTsNCg0KICAgICAgICAgICAgICAgIGlmIChob3BzIDw9IG1heEhvcHMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IHQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIsIHJlc3BvbnNlLlJlcXVlc3RNZXNzYWdlLlJlcXVlc3RVcmkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChVc2VTb2NrZXRzSHR0cEhhbmRsZXIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgdCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuUmVkaXJlY3QsIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEh0dHBSZXF1ZXN0RXhjZXB0aW9uPigoKSA9PiB0KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfQWxsb3dBdXRvUmVkaXJlY3RUcnVlX1JlZGlyZWN0V2l0aFJlbGF0aXZlTG9jYXRpb24oKQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuQWxsb3dBdXRvUmVkaXJlY3QgPSB0cnVlOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLlJlZGlyZWN0VXJpRm9yRGVzdGluYXRpb25VcmkoDQogICAgICAgICAgICAgICAgICAgIHNlY3VyZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDMwMiwNCiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25Vcmk6IENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyLA0KICAgICAgICAgICAgICAgICAgICBob3BzOiAxLA0KICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZTogdHJ1ZSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlVyaTogezB9IiwgdXJpKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVyaSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIsIHJlc3BvbnNlLlJlcXVlc3RNZXNzYWdlLlJlcXVlc3RVcmkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSgyMDApXQ0KICAgICAgICBbSW5saW5lRGF0YSgyMDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSg0MDApXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19BbGxvd0F1dG9SZWRpcmVjdFRydWVfTm9uUmVkaXJlY3RTdGF0dXNDb2RlX0xvY2F0aW9uSGVhZGVyX05vUmVkaXJlY3QoaW50IHN0YXR1c0NvZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCA9IHRydWU7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChvcmlnU2VydmVyLCBvcmlnVXJsKSA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHJlZGlyZWN0U2VydmVyLCByZWRpcmVjdFVybCkgPT4NCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXRSZXNwb25zZVRhc2sgPSBjbGllbnQuR2V0QXN5bmMob3JpZ1VybCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2sgcmVkaXJlY3RUYXNrID0gcmVkaXJlY3RTZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UmVzcG9uc2VUYXNrLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdTZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoKEh0dHBTdGF0dXNDb2RlKXN0YXR1c0NvZGUsICQiTG9jYXRpb246IHtyZWRpcmVjdFVybH1cclxuIikpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGdldFJlc3BvbnNlVGFzaykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoc3RhdHVzQ29kZSwgKGludClyZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwob3JpZ1VybCwgcmVzcG9uc2UuUmVxdWVzdE1lc3NhZ2UuUmVxdWVzdFVyaSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKHJlZGlyZWN0VGFzay5Jc0NvbXBsZXRlZCwgIlNob3VsZCBub3QgaGF2ZSByZWRpcmVjdGVkIHRvIExvY2F0aW9uIik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKCIjb3JpZ0ZyYWdtZW50IiwgIiIsICIjb3JpZ0ZyYWdtZW50IiwgZmFsc2UpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiI29yaWdGcmFnbWVudCIsICIiLCAiI29yaWdGcmFnbWVudCIsIHRydWUpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiIiwgIiNyZWRpckZyYWdtZW50IiwgIiNyZWRpckZyYWdtZW50IiwgZmFsc2UpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiIiwgIiNyZWRpckZyYWdtZW50IiwgIiNyZWRpckZyYWdtZW50IiwgdHJ1ZSldDQogICAgICAgIFtJbmxpbmVEYXRhKCIjb3JpZ0ZyYWdtZW50IiwgIiNyZWRpckZyYWdtZW50IiwgIiNyZWRpckZyYWdtZW50IiwgZmFsc2UpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiI29yaWdGcmFnbWVudCIsICIjcmVkaXJGcmFnbWVudCIsICIjcmVkaXJGcmFnbWVudCIsIHRydWUpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19BbGxvd0F1dG9SZWRpcmVjdFRydWVfUmV0YWluc09yaWdpbmFsRnJhZ21lbnRJZkFwcHJvcHJpYXRlKA0KICAgICAgICAgICAgc3RyaW5nIG9yaWdGcmFnbWVudCwgc3RyaW5nIHJlZGlyRnJhZ21lbnQsIHN0cmluZyBleHBlY3RlZEZyYWdtZW50LCBib29sIHVzZVJlbGF0aXZlUmVkaXJlY3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChJc0N1cmxIYW5kbGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFN0YXJ0aW5nIHdpdGggbGliY3VybCA3LjIwLCAiZnJhZ21lbnQgcGFydCBvZiBVUkxzIGFyZSBubyBsb25nZXIgc2VudCB0byB0aGUgc2VydmVyIi4NCiAgICAgICAgICAgICAgICAvLyBTbyBDdXJsSGFuZGxlciBkb2Vzbid0IHNlbmQgZnJhZ21lbnRzLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKElzTmV0ZnhIYW5kbGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFNpbWlsYXJseSwgbmV0ZnggZG9lc24ndCBzZW5kIGZyYWdtZW50cyBhdCBhbGwuDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoSXNXaW5IdHRwSGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBBY2NvcmRpbmcgdG8gaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzcyMzEjc2VjdGlvbi03LjEuMiwNCiAgICAgICAgICAgICAgICAvLyAiSWYgdGhlIExvY2F0aW9uIHZhbHVlIHByb3ZpZGVkIGluIGEgM3h4IChSZWRpcmVjdGlvbikgcmVzcG9uc2UgZG9lcw0KICAgICAgICAgICAgICAgIC8vICBub3QgaGF2ZSBhIGZyYWdtZW50IGNvbXBvbmVudCwgYSB1c2VyIGFnZW50IE1VU1QgcHJvY2VzcyB0aGUNCiAgICAgICAgICAgICAgICAvLyAgcmVkaXJlY3Rpb24gYXMgaWYgdGhlIHZhbHVlIGluaGVyaXRzIHRoZSBmcmFnbWVudCBjb21wb25lbnQgb2YgdGhlDQogICAgICAgICAgICAgICAgLy8gIFVSSSByZWZlcmVuY2UgdXNlZCB0byBnZW5lcmF0ZSB0aGUgcmVxdWVzdCB0YXJnZXQoaS5lLiwgdGhlDQogICAgICAgICAgICAgICAgLy8gIHJlZGlyZWN0aW9uIGluaGVyaXRzIHRoZSBvcmlnaW5hbCByZWZlcmVuY2UncyBmcmFnbWVudCwgaWYgYW55KS4iDQogICAgICAgICAgICAgICAgLy8gV0lOSFRUUCBpcyBub3QgZG9pbmcgdGhpcywgYW5kIHRodXMgbmVpdGhlciBpcyBXaW5IdHRwSGFuZGxlci4NCiAgICAgICAgICAgICAgICAvLyBJdCBhbHNvIHNvbWV0aW1lcyBkb2Vzbid0IGluY2x1ZGUgdGhlIGZyYWdtZW50cyBmb3IgcmVkaXJlY3RzDQogICAgICAgICAgICAgICAgLy8gZXZlbiBpbiBvdGhlciBjYXNlcy4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCA9IHRydWU7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChvcmlnU2VydmVyLCBvcmlnVXJsKSA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgb3JpZ1VybCA9IG5ldyBVcmlCdWlsZGVyKG9yaWdVcmwpIHsgRnJhZ21lbnQgPSBvcmlnRnJhZ21lbnQgfS5Vcmk7DQogICAgICAgICAgICAgICAgICAgIFVyaSByZWRpcmVjdFVybCA9IG5ldyBVcmlCdWlsZGVyKG9yaWdVcmwpIHsgRnJhZ21lbnQgPSByZWRpckZyYWdtZW50IH0uVXJpOw0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlUmVsYXRpdmVSZWRpcmVjdCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RVcmwgPSBuZXcgVXJpKHJlZGlyZWN0VXJsLkdldENvbXBvbmVudHMoVXJpQ29tcG9uZW50cy5QYXRoQW5kUXVlcnkgfCBVcmlDb21wb25lbnRzLkZyYWdtZW50LCBVcmlGb3JtYXQuU2FmZVVuZXNjYXBlZCksIFVyaUtpbmQuUmVsYXRpdmUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIFVyaSBleHBlY3RlZFVybCA9IG5ldyBVcmlCdWlsZGVyKG9yaWdVcmwpIHsgRnJhZ21lbnQgPSBleHBlY3RlZEZyYWdtZW50IH0uVXJpOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgYW5kIHJlY2VpdmUgdGhlIGZpcnN0IHJlcXVlc3QgdGhhdCdsbCBiZSByZWRpcmVjdGVkLg0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFJlc3BvbnNlID0gY2xpZW50LkdldEFzeW5jKG9yaWdVcmwpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrIGZpcnN0UmVxdWVzdCA9IG9yaWdTZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuRm91bmQsICQiTG9jYXRpb246IHtyZWRpcmVjdFVybH1cclxuIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChmaXJzdFJlcXVlc3QsIGF3YWl0IFRhc2suV2hlbkFueShmaXJzdFJlcXVlc3QsIGdldFJlc3BvbnNlKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gUmVjZWl2ZSB0aGUgc2Vjb25kIHJlcXVlc3QuDQogICAgICAgICAgICAgICAgICAgIFRhc2s8TGlzdDxzdHJpbmc+PiBzZWNvbmRSZXF1ZXN0ID0gb3JpZ1NlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChzZWNvbmRSZXF1ZXN0LCBnZXRSZXNwb25zZSk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBzZXJ2ZXIgcmVjZWl2ZWQgdGhlIHNlY29uZCByZXF1ZXN0IGZvciB0aGUgcmlnaHQgVXJpLg0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuTm90RW1wdHkoc2Vjb25kUmVxdWVzdC5SZXN1bHQpOw0KICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBzdGF0dXNMaW5lUGFydHMgPSBzZWNvbmRSZXF1ZXN0LlJlc3VsdFswXS5TcGxpdCgnICcpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMywgc3RhdHVzTGluZVBhcnRzLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChleHBlY3RlZFVybC5HZXRDb21wb25lbnRzKFVyaUNvbXBvbmVudHMuUGF0aEFuZFF1ZXJ5IHwgVXJpQ29tcG9uZW50cy5GcmFnbWVudCwgVXJpRm9ybWF0LlNhZmVVbmVzY2FwZWQpLCBzdGF0dXNMaW5lUGFydHNbMV0pOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgcmVxdWVzdCBtZXNzYWdlIHdhcyB1cGRhdGVkIHdpdGggdGhlIGNvcnJlY3QgcmVkaXJlY3RlZCBsb2NhdGlvbi4NCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBnZXRSZXNwb25zZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDIwMCwgKGludClyZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChleHBlY3RlZFVybC5Ub1N0cmluZygpLCByZXNwb25zZS5SZXF1ZXN0TWVzc2FnZS5SZXF1ZXN0VXJpLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgW091dGVyTG9vcF0gLy8gVGVzdCB1c2VzIGF6dXJlIGVuZHBvaW50Lg0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19DcmVkZW50aWFsSXNOZXR3b3JrQ3JlZGVudGlhbFVyaVJlZGlyZWN0X1N0YXR1c0NvZGVVbmF1dGhvcml6ZWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBfY3JlZGVudGlhbDsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVXJpIHJlZGlyZWN0VXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLlJlZGlyZWN0VXJpRm9yQ3JlZHMoDQogICAgICAgICAgICAgICAgICAgIHNlY3VyZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDMwMiwNCiAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IFVzZXJuYW1lLA0KICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogUGFzc3dvcmQpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHVuQXV0aFJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHJlZGlyZWN0VXJpKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5VbmF1dGhvcml6ZWQsIHVuQXV0aFJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUZXN0IHVzZXMgYXp1cmUgZW5kcG9pbnQuDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEh0dHBDbGllbnRIYW5kbGVyX0NyZWRlbnRpYWxJc05vdENyZWRlbnRpYWxDYWNoZUFmdGVyUmVkaXJlY3RfU3RhdHVzQ29kZU9LKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLkNyZWRlbnRpYWxzID0gX2NyZWRlbnRpYWw7DQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFVyaSByZWRpcmVjdFVyaSA9IENvbmZpZ3VyYXRpb24uSHR0cC5SZWRpcmVjdFVyaUZvckNyZWRzKA0KICAgICAgICAgICAgICAgICAgICBzZWN1cmU6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiAzMDIsDQogICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBVc2VybmFtZSwNCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IFBhc3N3b3JkKTsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSB1bkF1dGhSZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyhyZWRpcmVjdFVyaSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLCB1bkF1dGhSZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIHNhbWUgaGFuZGxlciB0byBwZXJmb3JtIGdldCByZXF1ZXN0LCBhdXRoZW50aWNhdGlvbiBzaG91bGQgc3VjY2VlZCBhZnRlciByZWRpcmVjdC4NCiAgICAgICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLkJhc2ljQXV0aFVyaUZvckNyZWRzKHNlY3VyZTogdHJ1ZSwgdXNlck5hbWU6IFVzZXJuYW1lLCBwYXNzd29yZDogUGFzc3dvcmQpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIGF1dGhSZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCBhdXRoUmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKFJlZGlyZWN0U3RhdHVzQ29kZXMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfQ3JlZGVudGlhbElzQ3JlZGVudGlhbENhY2hlVXJpUmVkaXJlY3RfU3RhdHVzQ29kZU9LKGludCBzdGF0dXNDb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLkJhc2ljQXV0aFVyaUZvckNyZWRzKHNlY3VyZTogZmFsc2UsIHVzZXJOYW1lOiBVc2VybmFtZSwgcGFzc3dvcmQ6IFBhc3N3b3JkKTsNCiAgICAgICAgICAgIFVyaSByZWRpcmVjdFVyaSA9IENvbmZpZ3VyYXRpb24uSHR0cC5SZWRpcmVjdFVyaUZvckNyZWRzKA0KICAgICAgICAgICAgICAgIHNlY3VyZTogZmFsc2UsDQogICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZSwNCiAgICAgICAgICAgICAgICB1c2VyTmFtZTogVXNlcm5hbWUsDQogICAgICAgICAgICAgICAgcGFzc3dvcmQ6IFBhc3N3b3JkKTsNCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHVyaS5BYnNvbHV0ZVVyaSk7DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShyZWRpcmVjdFVyaS5BYnNvbHV0ZVVyaSk7DQogICAgICAgICAgICB2YXIgY3JlZGVudGlhbENhY2hlID0gbmV3IENyZWRlbnRpYWxDYWNoZSgpOw0KICAgICAgICAgICAgY3JlZGVudGlhbENhY2hlLkFkZCh1cmksICJCYXNpYyIsIF9jcmVkZW50aWFsKTsNCg0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBpZiAoUGxhdGZvcm1EZXRlY3Rpb24uSXNVYXApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVUFQIGRvZXMgbm90IHN1cHBvcnQgQ3JlZGVudGlhbENhY2hlIGZvciBDcmVkZW50aWFscy4NCiAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPFBsYXRmb3JtTm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiBoYW5kbGVyLkNyZWRlbnRpYWxzID0gY3JlZGVudGlhbENhY2hlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkNyZWRlbnRpYWxzID0gY3JlZGVudGlhbENhY2hlOw0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyhyZWRpcmVjdFVyaSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwodXJpLCByZXNwb25zZS5SZXF1ZXN0TWVzc2FnZS5SZXF1ZXN0VXJpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtNZW1iZXJEYXRhKG5hbWVvZihIZWFkZXJXaXRoRW1wdHlWYWx1ZUFuZFVyaXMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfUmVxdWVzdEhlYWRlcnNBZGRDdXN0b21IZWFkZXJzX0hlYWRlckFuZEVtcHR5VmFsdWVTZW50KHN0cmluZyBuYW1lLCBzdHJpbmcgdmFsdWUsIFVyaSB1cmkpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChJc1dpbkh0dHBIYW5kbGVyICYmICFQbGF0Zm9ybURldGVjdGlvbi5Jc1dpbmRvd3MxMFZlcnNpb24xNzA5T3JHcmVhdGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCQibmFtZT17bmFtZX0sIHZhbHVlPXt2YWx1ZX0iKTsNCiAgICAgICAgICAgICAgICBjbGllbnQuRGVmYXVsdFJlcXVlc3RIZWFkZXJzLkFkZChuYW1lLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgaHR0cFJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVyaSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIGh0dHBSZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlVGV4dCA9IGF3YWl0IGh0dHBSZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHJlc3BvbnNlVGV4dCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKFRlc3RIZWxwZXIuSnNvbk1lc3NhZ2VDb250YWluc0tleVZhbHVlKHJlc3BvbnNlVGV4dCwgbmFtZSwgdmFsdWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoSGVhZGVyVmFsdWVBbmRVcmlzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX1JlcXVlc3RIZWFkZXJzQWRkQ3VzdG9tSGVhZGVyc19IZWFkZXJBbmRWYWx1ZVNlbnQoc3RyaW5nIG5hbWUsIHN0cmluZyB2YWx1ZSwgVXJpIHVyaSkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCQibmFtZT17bmFtZX0sIHZhbHVlPXt2YWx1ZX0iKTsNCiAgICAgICAgICAgICAgICBjbGllbnQuRGVmYXVsdFJlcXVlc3RIZWFkZXJzLkFkZChuYW1lLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgaHR0cFJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKHVyaSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIGh0dHBSZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlVGV4dCA9IGF3YWl0IGh0dHBSZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHJlc3BvbnNlVGV4dCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKFRlc3RIZWxwZXIuSnNvbk1lc3NhZ2VDb250YWluc0tleVZhbHVlKHJlc3BvbnNlVGV4dCwgbmFtZSwgdmFsdWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSgiOiIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiXHgxMjM0OiBceDU2NzgiKV0NCiAgICAgICAgW0lubGluZURhdGEoIm5vY29sb24iKV0NCiAgICAgICAgW0lubGluZURhdGEoIm5vIGNvbG9uIildDQogICAgICAgIFtJbmxpbmVEYXRhKCJDb250ZW50LUxlbmd0aCAgICAgICIpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19JbnZhbGlkSGVhZGVyTmFtZVZhbHVlX1Rocm93c0h0dHBSZXF1ZXN0RXhjZXB0aW9uKHN0cmluZyBpbnZhbGlkSGVhZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNDdXJsSGFuZGxlciAmJiBpbnZhbGlkSGVhZGVyLkNvbnRhaW5zKCc6JykpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gSXNzdWUgIzI3MTcyDQogICAgICAgICAgICAgICAgLy8gQ3VybEhhbmRsZXIgYWxsb3dzIHRoZXNlIGhlYWRlcnMgYXMgbG9uZyBhcyB0aGV5IGhhdmUgYSBjb2xvbi4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEh0dHBSZXF1ZXN0RXhjZXB0aW9uPigoKSA9PiBjbGllbnQuR2V0U3RyaW5nQXN5bmModXJpKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgc2VydmVyID0+IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZEN1c3RvbVJlc3BvbnNlQW5kQ2xvc2VBc3luYygkIkhUVFAvMS4xIDIwMCBPS1xyXG57aW52YWxpZEhlYWRlcn1cclxuQ29udGVudC1MZW5ndGg6IDExXHJcblxyXG5oZWxsbyB3b3JsZCIpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0QXN5bmNfTWFueURpZmZlcmVudFJlcXVlc3RIZWFkZXJzX1NlbnRDb3JyZWN0bHkoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNXaW5IdHRwSGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBJc3N1ZSAjMjcxNzENCiAgICAgICAgICAgICAgICAvLyBGYWlscyBjb25zaXN0ZW50bHkgd2l0aDoNCiAgICAgICAgICAgICAgICAvLyBTeXN0ZW0uSW52YWxpZENhc3RFeGNlcHRpb246ICJVbmFibGUgdG8gY2FzdCBvYmplY3Qgb2YgdHlwZSAnU3lzdGVtLk9iamVjdFtdJyB0byB0eXBlICdTeXN0ZW0uTmV0Lkh0dHAuV2luSHR0cFJlcXVlc3RTdGF0ZSciDQogICAgICAgICAgICAgICAgLy8gVGhpcyBhcHBlYXJzIHRvIGJlIGR1ZSB0byBhZGRpbmcgdGhlIEV4cGVjdDogMTAwLWNvbnRpbnVlIGhlYWRlciwgd2hpY2ggY2F1c2VzIHdpbmh0dHANCiAgICAgICAgICAgICAgICAvLyB0byBmYWlsIHdpdGggYSAiVGhlIHBhcmFtZXRlciBpcyBpbmNvcnJlY3QiIGVycm9yLCB3aGljaCBpbiB0dXJuIGNhdXNlcyB0aGUgcmVxdWVzdCB0bw0KICAgICAgICAgICAgICAgIC8vIGJlIHRvcm4gZG93biwgYW5kIGluIGRvaW5nIHNvLCB3ZSB0aGlzIHRoaXMgZHVyaW5nIGRpc3Bvc2FsIG9mIHRoZSBTYWZlV2luSHR0cEhhbmRsZS4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFVzaW5nIGV4YW1wbGVzIGZyb20gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9IVFRQX2hlYWRlcl9maWVsZHMjUmVxdWVzdF9maWVsZHMNCiAgICAgICAgICAgIC8vIEV4ZXJjaXNlcyBhbGwgZXhwb3NlZCByZXF1ZXN0LkhlYWRlcnMgYW5kIHJlcXVlc3QuQ29udGVudC5IZWFkZXJzIHN0cm9uZ2x5LXR5cGVkIHByb3BlcnRpZXMNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGNvbnRlbnRBcnJheSA9IEVuY29kaW5nLkFTQ0lJLkdldEJ5dGVzKCJoZWxsbyB3b3JsZCIpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UoSHR0cE1ldGhvZC5Qb3N0LCB1cmkpIHsgQ29udGVudCA9IG5ldyBCeXRlQXJyYXlDb250ZW50KGNvbnRlbnRBcnJheSkgfTsNCg0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWNjZXB0LkFkZChuZXcgTWVkaWFUeXBlV2l0aFF1YWxpdHlIZWFkZXJWYWx1ZSgidGV4dC9wbGFpbiIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFjY2VwdENoYXJzZXQuQWRkKG5ldyBTdHJpbmdXaXRoUXVhbGl0eUhlYWRlclZhbHVlKCJ1dGYtOCIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFjY2VwdEVuY29kaW5nLkFkZChuZXcgU3RyaW5nV2l0aFF1YWxpdHlIZWFkZXJWYWx1ZSgiZ3ppcCIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFjY2VwdEVuY29kaW5nLkFkZChuZXcgU3RyaW5nV2l0aFF1YWxpdHlIZWFkZXJWYWx1ZSgiZGVmbGF0ZSIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFjY2VwdExhbmd1YWdlLkFkZChuZXcgU3RyaW5nV2l0aFF1YWxpdHlIZWFkZXJWYWx1ZSgiZW4tVVMiKSk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIkFjY2VwdC1EYXRldGltZSIsICJUaHUsIDMxIE1heSAyMDA3IDIwOjM1OjAwIEdNVCIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWRkKCJBY2Nlc3MtQ29udHJvbC1SZXF1ZXN0LU1ldGhvZCIsICJHRVQiKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFkZCgiQWNjZXNzLUNvbnRyb2wtUmVxdWVzdC1IZWFkZXJzIiwgIkdFVCIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQXV0aG9yaXphdGlvbiA9IG5ldyBBdXRoZW50aWNhdGlvbkhlYWRlclZhbHVlKCJCYXNpYyIsICJRV3hoWkdScGJqcHZjR1Z1SUhObGMyRnRaUT09Iik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5DYWNoZUNvbnRyb2wgPSBuZXcgQ2FjaGVDb250cm9sSGVhZGVyVmFsdWUoKSB7IE5vQ2FjaGUgPSB0cnVlIH07DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5Db25uZWN0aW9uLkFkZCgiY2xvc2UiKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFkZCgiQ29va2llIiwgIiRWZXJzaW9uPTE7IFNraW49bmV3Iik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRMZW5ndGggPSBjb250ZW50QXJyYXkuTGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1ID0gTUQ1LkNyZWF0ZSgpLkNvbXB1dGVIYXNoKGNvbnRlbnRBcnJheSk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRUeXBlID0gbmV3IE1lZGlhVHlwZUhlYWRlclZhbHVlKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkRhdGUgPSBEYXRlVGltZU9mZnNldC5QYXJzZSgiVHVlLCAxNSBOb3YgMTk5NCAwODoxMjozMSBHTVQiKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkV4cGVjdC5BZGQobmV3IE5hbWVWYWx1ZVdpdGhQYXJhbWV0ZXJzSGVhZGVyVmFsdWUoIjEwMC1jb250aW51ZSIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFkZCgiRm9yd2FyZGVkIiwgImZvcj0xOTIuMC4yLjYwO3Byb3RvPWh0dHA7Ynk9MjAzLjAuMTEzLjQzIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIkZyb20iLCAiVXNlciBOYW1lIDx1c2VyQGV4YW1wbGUuY29tPiIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuSG9zdCA9ICJlbi53aWtpcGVkaWEub3JnOjgwODAiOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuSWZNYXRjaC5BZGQobmV3IEVudGl0eVRhZ0hlYWRlclZhbHVlKCJcIjM3MDYwY2Q4YzI4NGQ4YWY3YWQzMDgyZjIwOTU4MmRcIiIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLklmTW9kaWZpZWRTaW5jZSA9IERhdGVUaW1lT2Zmc2V0LlBhcnNlKCJTYXQsIDI5IE9jdCAxOTk0IDE5OjQzOjMxIEdNVCIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuSWZOb25lTWF0Y2guQWRkKG5ldyBFbnRpdHlUYWdIZWFkZXJWYWx1ZSgiXCI3MzcwNjBjZDhjMjg0ZDhhZjdhZDMwODJmMjA5NTgyZFwiIikpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuSWZSYW5nZSA9IG5ldyBSYW5nZUNvbmRpdGlvbkhlYWRlclZhbHVlKERhdGVUaW1lT2Zmc2V0LlBhcnNlKCJXZWQsIDIxIE9jdCAyMDE1IDA3OjI4OjAwIEdNVCIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLklmVW5tb2RpZmllZFNpbmNlID0gRGF0ZVRpbWVPZmZzZXQuUGFyc2UoIlNhdCwgMjkgT2N0IDE5OTQgMTk6NDM6MzEgR01UIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5NYXhGb3J3YXJkcyA9IDEwOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWRkKCJPcmlnaW4iLCAiaHR0cDovL3d3dy5leGFtcGxlLXNvY2lhbC1uZXR3b3JrLmNvbSIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuUHJhZ21hLkFkZChuZXcgTmFtZVZhbHVlSGVhZGVyVmFsdWUoIm5vLWNhY2hlIikpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuUHJveHlBdXRob3JpemF0aW9uID0gbmV3IEF1dGhlbnRpY2F0aW9uSGVhZGVyVmFsdWUoIkJhc2ljIiwgIlFXeGhaR1JwYmpwdmNHVnVJSE5sYzJGdFpRPT0iKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLlJhbmdlID0gbmV3IFJhbmdlSGVhZGVyVmFsdWUoNTAwLCA5OTkpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuUmVmZXJyZXIgPSBuZXcgVXJpKCJodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL01haW5fUGFnZSIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuVEUuQWRkKG5ldyBUcmFuc2ZlckNvZGluZ1dpdGhRdWFsaXR5SGVhZGVyVmFsdWUoInRyYWlsZXJzIikpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuVEUuQWRkKG5ldyBUcmFuc2ZlckNvZGluZ1dpdGhRdWFsaXR5SGVhZGVyVmFsdWUoImRlZmxhdGUiKSk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5UcmFpbGVyLkFkZCgiTXlUcmFpbGVyIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5UcmFuc2ZlckVuY29kaW5nLkFkZChuZXcgVHJhbnNmZXJDb2RpbmdIZWFkZXJWYWx1ZSgiY2h1bmtlZCIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLlVzZXJBZ2VudC5BZGQobmV3IFByb2R1Y3RJbmZvSGVhZGVyVmFsdWUobmV3IFByb2R1Y3RIZWFkZXJWYWx1ZSgiTW96aWxsYSIsICI1LjAiKSkpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuVXBncmFkZS5BZGQobmV3IFByb2R1Y3RIZWFkZXJWYWx1ZSgiSFRUUFMiLCAiMS4zIikpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuVXBncmFkZS5BZGQobmV3IFByb2R1Y3RIZWFkZXJWYWx1ZSgiSVJDIiwgIjYuOSIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLlVwZ3JhZGUuQWRkKG5ldyBQcm9kdWN0SGVhZGVyVmFsdWUoIlJUQSIsICJ4MTEiKSk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5VcGdyYWRlLkFkZChuZXcgUHJvZHVjdEhlYWRlclZhbHVlKCJ3ZWJzb2NrZXQiKSk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5WaWEuQWRkKG5ldyBWaWFIZWFkZXJWYWx1ZSgiMS4wIiwgImZyZWQiKSk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5WaWEuQWRkKG5ldyBWaWFIZWFkZXJWYWx1ZSgiMS4xIiwgImV4YW1wbGUuY29tIiwgbnVsbCwgIihBcGFjaGUvMS4xKSIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLldhcm5pbmcuQWRkKG5ldyBXYXJuaW5nSGVhZGVyVmFsdWUoMTk5LCAiLSIsICJcIk1pc2NlbGxhbmVvdXMgd2FybmluZ1wiIikpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWRkKCJYLVJlcXVlc3RlZC1XaXRoIiwgIlhNTEh0dHBSZXF1ZXN0Iik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIkROVCIsICIxIChEbyBOb3QgVHJhY2sgRW5hYmxlZCkiKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFkZCgiWC1Gb3J3YXJkZWQtRm9yIiwgImNsaWVudDEiKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkFkZCgiWC1Gb3J3YXJkZWQtRm9yIiwgInByb3h5MSIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWRkKCJYLUZvcndhcmRlZC1Gb3IiLCAicHJveHkyIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIlgtRm9yd2FyZGVkLUhvc3QiLCAiZW4ud2lraXBlZGlhLm9yZzo4MDgwIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIlgtRm9yd2FyZGVkLVByb3RvIiwgImh0dHBzIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIkZyb250LUVuZC1IdHRwcyIsICJodHRwcyIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWRkKCJYLUh0dHAtTWV0aG9kLU92ZXJyaWRlIiwgIkRFTEVURSIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWRkKCJYLUFUVC1EZXZpY2VJZCIsICJHVC1QNzMyMC9QNzMyMFhYTFBHIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIlgtV2FwLVByb2ZpbGUiLCAiaHR0cDovL3dhcC5zYW1zdW5nbW9iaWxlLmNvbS91YXByb2YvU0dILUk3NzcueG1sIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIlByb3h5LUNvbm5lY3Rpb24iLCAia2VlcC1hbGl2ZSIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWRkKCJYLVVJREgiLCAiLi4uIik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIlgtQ3NyZi1Ub2tlbiIsICJpOFhOakM0YjhLVm9rNHV3NVJmdFIzOFdncDJCRndxbCIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuQWRkKCJYLVJlcXVlc3QtSUQiLCAiZjA1OGViZDYtMDJmNy00ZDNmLTk0MmUtOTA0MzQ0ZThjZGU1Iik7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5BZGQoIlgtUmVxdWVzdC1JRCIsICJmMDU4ZWJkNi0wMmY3LTRkM2YtOTQyZS05MDQzNDRlOGNkZTUiKTsNCg0KICAgICAgICAgICAgICAgICAgICAoYXdhaXQgY2xpZW50LlNlbmRBc3luYyhyZXF1ZXN0LCBIdHRwQ29tcGxldGlvbk9wdGlvbi5SZXNwb25zZUhlYWRlcnNSZWFkKSkuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIGFzeW5jIHNlcnZlciA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbiA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlcnNTZXQgPSBuZXcgSGFzaFNldDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBsaW5lOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIXN0cmluZy5Jc051bGxPckVtcHR5KGxpbmUgPSBhd2FpdCBjb25uZWN0aW9uLlJlYWRlci5SZWFkTGluZUFzeW5jKCkpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShoZWFkZXJzU2V0LkFkZChsaW5lKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLldyaXRlci5Xcml0ZUFzeW5jKCQiSFRUUC8xLjEgMjAwIE9LXHJcbkRhdGU6IHtEYXRlVGltZU9mZnNldC5VdGNOb3c6Un1cclxuQ29ubmVjdGlvbjogY2xvc2VcclxuQ29udGVudC1MZW5ndGg6IDBcclxuXHJcbiIpOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYXdhaXQgY29ubmVjdGlvbi5Tb2NrZXQuUmVjZWl2ZUFzeW5jKG5ldyBBcnJheVNlZ21lbnQ8Ynl0ZT4obmV3IGJ5dGVbMTAwMF0pLCBTb2NrZXRGbGFncy5Ob25lKSA+IDApOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQWNjZXB0LUNoYXJzZXQ6IHV0Zi04IiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQWNjZXB0LUxhbmd1YWdlOiBlbi1VUyIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIkFjY2VwdC1EYXRldGltZTogVGh1LCAzMSBNYXkgMjAwNyAyMDozNTowMCBHTVQiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJBY2Nlc3MtQ29udHJvbC1SZXF1ZXN0LU1ldGhvZDogR0VUIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQWNjZXNzLUNvbnRyb2wtUmVxdWVzdC1IZWFkZXJzOiBHRVQiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJBdXRob3JpemF0aW9uOiBCYXNpYyBRV3hoWkdScGJqcHZjR1Z1SUhObGMyRnRaUT09IiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQ2FjaGUtQ29udHJvbDogbm8tY2FjaGUiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJDb25uZWN0aW9uOiBjbG9zZSIsIGhlYWRlcnNTZXQsIFN0cmluZ0NvbXBhcmVyLk9yZGluYWxJZ25vcmVDYXNlKTsgLy8gTmV0RnhIYW5kbGVyIHVzZXMgIkNsb3NlIiB2cyAiY2xvc2UiDQogICAgICAgICAgICAgICAgICAgIGlmICghSXNOZXRmeEhhbmRsZXIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQ29va2llOiAkVmVyc2lvbj0xOyBTa2luPW5ldyIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiRGF0ZTogVHVlLCAxNSBOb3YgMTk5NCAwODoxMjozMSBHTVQiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJFeHBlY3Q6IDEwMC1jb250aW51ZSIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIkZvcndhcmRlZDogZm9yPTE5Mi4wLjIuNjA7cHJvdG89aHR0cDtieT0yMDMuMC4xMTMuNDMiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJGcm9tOiBVc2VyIE5hbWUgPHVzZXJAZXhhbXBsZS5jb20+IiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiSG9zdDogZW4ud2lraXBlZGlhLm9yZzo4MDgwIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiSWYtTWF0Y2g6IFwiMzcwNjBjZDhjMjg0ZDhhZjdhZDMwODJmMjA5NTgyZFwiIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiSWYtTW9kaWZpZWQtU2luY2U6IFNhdCwgMjkgT2N0IDE5OTQgMTk6NDM6MzEgR01UIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiSWYtTm9uZS1NYXRjaDogXCI3MzcwNjBjZDhjMjg0ZDhhZjdhZDMwODJmMjA5NTgyZFwiIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiSWYtUmFuZ2U6IFdlZCwgMjEgT2N0IDIwMTUgMDc6Mjg6MDAgR01UIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiSWYtVW5tb2RpZmllZC1TaW5jZTogU2F0LCAyOSBPY3QgMTk5NCAxOTo0MzozMSBHTVQiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJNYXgtRm9yd2FyZHM6IDEwIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiT3JpZ2luOiBodHRwOi8vd3d3LmV4YW1wbGUtc29jaWFsLW5ldHdvcmsuY29tIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiUHJhZ21hOiBuby1jYWNoZSIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlByb3h5LUF1dGhvcml6YXRpb246IEJhc2ljIFFXeGhaR1JwYmpwdmNHVnVJSE5sYzJGdFpRPT0iLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJSYW5nZTogYnl0ZXM9NTAwLTk5OSIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlJlZmVyZXI6IGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTWFpbl9QYWdlIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiVEU6IHRyYWlsZXJzLCBkZWZsYXRlIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiVHJhaWxlcjogTXlUcmFpbGVyIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWQiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlVwZ3JhZGU6IEhUVFBTLzEuMywgSVJDLzYuOSwgUlRBL3gxMSwgd2Vic29ja2V0IiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiVmlhOiAxLjAgZnJlZCwgMS4xIGV4YW1wbGUuY29tIChBcGFjaGUvMS4xKSIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIldhcm5pbmc6IDE5OSAtIFwiTWlzY2VsbGFuZW91cyB3YXJuaW5nXCIiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJYLVJlcXVlc3RlZC1XaXRoOiBYTUxIdHRwUmVxdWVzdCIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIkROVDogMSAoRG8gTm90IFRyYWNrIEVuYWJsZWQpIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiWC1Gb3J3YXJkZWQtRm9yOiBjbGllbnQxLCBwcm94eTEsIHByb3h5MiIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlgtRm9yd2FyZGVkLUhvc3Q6IGVuLndpa2lwZWRpYS5vcmc6ODA4MCIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlgtRm9yd2FyZGVkLVByb3RvOiBodHRwcyIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIkZyb250LUVuZC1IdHRwczogaHR0cHMiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJYLUh0dHAtTWV0aG9kLU92ZXJyaWRlOiBERUxFVEUiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJYLUFUVC1EZXZpY2VJZDogR1QtUDczMjAvUDczMjBYWExQRyIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlgtV2FwLVByb2ZpbGU6IGh0dHA6Ly93YXAuc2Ftc3VuZ21vYmlsZS5jb20vdWFwcm9mL1NHSC1JNzc3LnhtbCIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIUlzTmV0ZnhIYW5kbGVyKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlByb3h5LUNvbm5lY3Rpb246IGtlZXAtYWxpdmUiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlgtVUlESDogLi4uIiwgaGVhZGVyc1NldCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiWC1Dc3JmLVRva2VuOiBpOFhOakM0YjhLVm9rNHV3NVJmdFIzOFdncDJCRndxbCIsIGhlYWRlcnNTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIlgtUmVxdWVzdC1JRDogZjA1OGViZDYtMDJmNy00ZDNmLTk0MmUtOTA0MzQ0ZThjZGU1LCBmMDU4ZWJkNi0wMmY3LTRkM2YtOTQyZS05MDQzNDRlOGNkZTUiLCBoZWFkZXJzU2V0KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBJRW51bWVyYWJsZTxvYmplY3RbXT4gR2V0QXN5bmNfTWFueURpZmZlcmVudFJlc3BvbnNlSGVhZGVyc19QYXJzZWRDb3JyZWN0bHlfTWVtYmVyRGF0YSgpID0+DQogICAgICAgICAgICBmcm9tIG5ld2xpbmUgaW4gbmV3W10geyAiXG4iLCAiXHJcbiIgfQ0KICAgICAgICAgICAgZnJvbSBmb2xkIGluIG5ld1tdIHsgIiIsIG5ld2xpbmUgKyAiICIsIG5ld2xpbmUgKyAiXHQiLCBuZXdsaW5lICsgIiAgICAiIH0NCiAgICAgICAgICAgIGZyb20gZHJpYmJsZSBpbiBuZXdbXSB7IGZhbHNlLCB0cnVlIH0NCiAgICAgICAgICAgIHNlbGVjdCBuZXcgb2JqZWN0W10geyBuZXdsaW5lLCBmb2xkLCBkcmliYmxlIH07DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKEdldEFzeW5jX01hbnlEaWZmZXJlbnRSZXNwb25zZUhlYWRlcnNfUGFyc2VkQ29ycmVjdGx5X01lbWJlckRhdGEpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfTWFueURpZmZlcmVudFJlc3BvbnNlSGVhZGVyc19QYXJzZWRDb3JyZWN0bHkoc3RyaW5nIG5ld2xpbmUsIHN0cmluZyBmb2xkLCBib29sIGRyaWJibGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChJc0N1cmxIYW5kbGVyICYmICFzdHJpbmcuSXNOdWxsT3JFbXB0eShmb2xkKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBDdXJsSGFuZGxlciBkb2Vzbid0IGN1cnJlbnRseSBzdXBwb3J0IGZvbGRlZCBoZWFkZXJzLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKElzTmV0ZnhIYW5kbGVyICYmIG5ld2xpbmUgPT0gIlxuIikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBOZXRGeEhhbmRsZXIgZG9lc24ndCBhbGxvdyBMRi1vbmx5IGxpbmUgZW5kaW5ncy4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFVzaW5nIGV4YW1wbGVzIGZyb20gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9IVFRQX2hlYWRlcl9maWVsZHMjUmVzcG9uc2VfZmllbGRzDQogICAgICAgICAgICAvLyBFeGVyY2lzZXMgYWxsIGV4cG9zZWQgcmVzcG9uc2UuSGVhZGVycyBhbmQgcmVzcG9uc2UuQ29udGVudC5IZWFkZXJzIHN0cm9uZ2x5LXR5cGVkIHByb3BlcnRpZXMNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3AgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJpKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiMS4xIiwgcmVzcC5WZXJzaW9uLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3AuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiKiIsIHJlc3AuSGVhZGVycy5HZXRWYWx1ZXMoIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbiIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJ0ZXh0L2V4YW1wbGU7Y2hhcnNldD11dGYtOCIsIHJlc3AuSGVhZGVycy5HZXRWYWx1ZXMoIkFjY2VwdC1QYXRjaCIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJieXRlcyIsIHJlc3AuSGVhZGVycy5BY2NlcHRSYW5nZXMpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZVNwYW4uRnJvbVNlY29uZHMoMTIpLCByZXNwLkhlYWRlcnMuQWdlLkdldFZhbHVlT3JEZWZhdWx0KCkpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIkdFVCIsIHJlc3AuQ29udGVudC5IZWFkZXJzLkFsbG93KTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJIRUFEIiwgcmVzcC5Db250ZW50LkhlYWRlcnMuQWxsb3cpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoImh0dHAvMS4xPVwiaHR0cDIuZXhhbXBsZS5jb206ODAwMVwiOyBtYT03MjAwIiwgcmVzcC5IZWFkZXJzLkdldFZhbHVlcygiQWx0LVN2YyIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFRpbWVTcGFuLkZyb21TZWNvbmRzKDM2MDApLCByZXNwLkhlYWRlcnMuQ2FjaGVDb250cm9sLk1heEFnZS5HZXRWYWx1ZU9yRGVmYXVsdCgpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJjbG9zZSIsIHJlc3AuSGVhZGVycy5Db25uZWN0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUocmVzcC5IZWFkZXJzLkNvbm5lY3Rpb25DbG9zZS5HZXRWYWx1ZU9yRGVmYXVsdCgpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJhdHRhY2htZW50IiwgcmVzcC5Db250ZW50LkhlYWRlcnMuQ29udGVudERpc3Bvc2l0aW9uLkRpc3Bvc2l0aW9uVHlwZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiXCJmbmFtZS5leHRcIiIsIHJlc3AuQ29udGVudC5IZWFkZXJzLkNvbnRlbnREaXNwb3NpdGlvbi5GaWxlTmFtZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiZ3ppcCIsIHJlc3AuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiZGEiLCByZXNwLkNvbnRlbnQuSGVhZGVycy5Db250ZW50TGFuZ3VhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwobmV3IFVyaSgiL2luZGV4Lmh0bSIsIFVyaUtpbmQuUmVsYXRpdmUpLCByZXNwLkNvbnRlbnQuSGVhZGVycy5Db250ZW50TG9jYXRpb24pOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKCJRMmhsWTJzZ1NXNTBaV2R5YVhSNUlRPT0iKSwgcmVzcC5Db250ZW50LkhlYWRlcnMuQ29udGVudE1ENSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiYnl0ZXMiLCByZXNwLkNvbnRlbnQuSGVhZGVycy5Db250ZW50UmFuZ2UuVW5pdCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgyMTAxMCwgcmVzcC5Db250ZW50LkhlYWRlcnMuQ29udGVudFJhbmdlLkZyb20uR2V0VmFsdWVPckRlZmF1bHQoKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCg0NzAyMSwgcmVzcC5Db250ZW50LkhlYWRlcnMuQ29udGVudFJhbmdlLlRvLkdldFZhbHVlT3JEZWZhdWx0KCkpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoNDcwMjIsIHJlc3AuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRSYW5nZS5MZW5ndGguR2V0VmFsdWVPckRlZmF1bHQoKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgidGV4dC9odG1sIiwgcmVzcC5Db250ZW50LkhlYWRlcnMuQ29udGVudFR5cGUuTWVkaWFUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJ1dGYtOCIsIHJlc3AuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRUeXBlLkNoYXJTZXQpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoRGF0ZVRpbWVPZmZzZXQuUGFyc2UoIlR1ZSwgMTUgTm92IDE5OTQgMDg6MTI6MzEgR01UIiksIHJlc3AuSGVhZGVycy5EYXRlLkdldFZhbHVlT3JEZWZhdWx0KCkpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoIlwiNzM3MDYwY2Q4YzI4NGQ4YWY3YWQzMDgyZjIwOTU4MmRcIiIsIHJlc3AuSGVhZGVycy5FVGFnLlRhZyk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChEYXRlVGltZU9mZnNldC5QYXJzZSgiVGh1LCAwMSBEZWMgMTk5NCAxNjowMDowMCBHTVQiKSwgcmVzcC5Db250ZW50LkhlYWRlcnMuRXhwaXJlcy5HZXRWYWx1ZU9yRGVmYXVsdCgpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKERhdGVUaW1lT2Zmc2V0LlBhcnNlKCJUdWUsIDE1IE5vdiAxOTk0IDEyOjQ1OjI2IEdNVCIpLCByZXNwLkNvbnRlbnQuSGVhZGVycy5MYXN0TW9kaWZpZWQuR2V0VmFsdWVPckRlZmF1bHQoKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiPC9mZWVkPjsgcmVsPVwiYWx0ZXJuYXRlXCIiLCByZXNwLkhlYWRlcnMuR2V0VmFsdWVzKCJMaW5rIikpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwobmV3IFVyaSgiaHR0cDovL3d3dy53My5vcmcvcHViL1dXVy9QZW9wbGUuaHRtbCIpLCByZXNwLkhlYWRlcnMuTG9jYXRpb24pOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIkNQPVwiVGhpcyBpcyBub3QgYSBQM1AgcG9saWN5IVwiIiwgcmVzcC5IZWFkZXJzLkdldFZhbHVlcygiUDNQIikpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMobmV3IE5hbWVWYWx1ZUhlYWRlclZhbHVlKCJuby1jYWNoZSIpLCByZXNwLkhlYWRlcnMuUHJhZ21hKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKG5ldyBBdXRoZW50aWNhdGlvbkhlYWRlclZhbHVlKCJiYXNpYyIpLCByZXNwLkhlYWRlcnMuUHJveHlBdXRoZW50aWNhdGUpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIm1heC1hZ2U9MjU5MjAwMDsgcGluLXNoYTI1Nj1cIkU5Q1o5SU5EYmQrMmVSUW96WXFxYlEyeVhMVktCOSt4Y3ByTUYrNDRVMWc9XCIiLCByZXNwLkhlYWRlcnMuR2V0VmFsdWVzKCJQdWJsaWMtS2V5LVBpbnMiKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChUaW1lU3Bhbi5Gcm9tU2Vjb25kcygxMjApLCByZXNwLkhlYWRlcnMuUmV0cnlBZnRlci5EZWx0YS5HZXRWYWx1ZU9yRGVmYXVsdCgpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKG5ldyBQcm9kdWN0SW5mb0hlYWRlclZhbHVlKCJBcGFjaGUiLCAiMi40LjEiKSwgcmVzcC5IZWFkZXJzLlNlcnZlcik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiVXNlcklEPUpvaG5Eb2U7IE1heC1BZ2U9MzYwMDsgVmVyc2lvbj0xIiwgcmVzcC5IZWFkZXJzLkdldFZhbHVlcygiU2V0LUNvb2tpZSIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJtYXgtYWdlPTE2MDcwNDAwOyBpbmNsdWRlU3ViRG9tYWlucyIsIHJlc3AuSGVhZGVycy5HZXRWYWx1ZXMoIlN0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHkiKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiTWF4LUZvcndhcmRzIiwgcmVzcC5IZWFkZXJzLlRyYWlsZXIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIj8iLCByZXNwLkhlYWRlcnMuR2V0VmFsdWVzKCJUayIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKG5ldyBQcm9kdWN0SGVhZGVyVmFsdWUoIkhUVFBTIiwgIjEuMyIpLCByZXNwLkhlYWRlcnMuVXBncmFkZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhuZXcgUHJvZHVjdEhlYWRlclZhbHVlKCJJUkMiLCAiNi45IiksIHJlc3AuSGVhZGVycy5VcGdyYWRlKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKG5ldyBQcm9kdWN0SGVhZGVyVmFsdWUoIndlYnNvY2tldCIpLCByZXNwLkhlYWRlcnMuVXBncmFkZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQWNjZXB0LUxhbmd1YWdlIiwgcmVzcC5IZWFkZXJzLlZhcnkpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMobmV3IFZpYUhlYWRlclZhbHVlKCIxLjAiLCAiZnJlZCIpLCByZXNwLkhlYWRlcnMuVmlhKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKG5ldyBWaWFIZWFkZXJWYWx1ZSgiMS4xIiwgImV4YW1wbGUuY29tIiwgbnVsbCwgIihBcGFjaGUvMS4xKSIpLCByZXNwLkhlYWRlcnMuVmlhKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKG5ldyBXYXJuaW5nSGVhZGVyVmFsdWUoMTk5LCAiLSIsICJcIk1pc2NlbGxhbmVvdXMgd2FybmluZ1wiIiwgRGF0ZVRpbWVPZmZzZXQuUGFyc2UoIldlZCwgMjEgT2N0IDIwMTUgMDc6Mjg6MDAgR01UIikpLCByZXNwLkhlYWRlcnMuV2FybmluZyk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhuZXcgQXV0aGVudGljYXRpb25IZWFkZXJWYWx1ZSgiQmFzaWMiKSwgcmVzcC5IZWFkZXJzLld3d0F1dGhlbnRpY2F0ZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiZGVueSIsIHJlc3AuSGVhZGVycy5HZXRWYWx1ZXMoIlgtRnJhbWUtT3B0aW9ucyIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJkZWZhdWx0LXNyYyAnc2VsZiciLCByZXNwLkhlYWRlcnMuR2V0VmFsdWVzKCJYLVdlYktpdC1DU1AiKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiNTsgdXJsPWh0dHA6Ly93d3cudzMub3JnL3B1Yi9XV1cvUGVvcGxlLmh0bWwiLCByZXNwLkhlYWRlcnMuR2V0VmFsdWVzKCJSZWZyZXNoIikpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIjIwMCBPSyIsIHJlc3AuSGVhZGVycy5HZXRWYWx1ZXMoIlN0YXR1cyIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCI8b3JpZ2luPlssIDxvcmlnaW4+XSoiLCByZXNwLkhlYWRlcnMuR2V0VmFsdWVzKCJUaW1pbmctQWxsb3ctT3JpZ2luIikpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIjQyLjY2NiIsIHJlc3AuSGVhZGVycy5HZXRWYWx1ZXMoIlgtQ29udGVudC1EdXJhdGlvbiIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJub3NuaWZmIiwgcmVzcC5IZWFkZXJzLkdldFZhbHVlcygiWC1Db250ZW50LVR5cGUtT3B0aW9ucyIpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJQSFAvNS40LjAiLCByZXNwLkhlYWRlcnMuR2V0VmFsdWVzKCJYLVBvd2VyZWQtQnkiKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiZjA1OGViZDYtMDJmNy00ZDNmLTk0MmUtOTA0MzQ0ZThjZGU1IiwgcmVzcC5IZWFkZXJzLkdldFZhbHVlcygiWC1SZXF1ZXN0LUlEIikpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIklFPUVtdWxhdGVJRTciLCByZXNwLkhlYWRlcnMuR2V0VmFsdWVzKCJYLVVBLUNvbXBhdGlibGUiKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiMTsgbW9kZT1ibG9jayIsIHJlc3AuSGVhZGVycy5HZXRWYWx1ZXMoIlgtWFNTLVByb3RlY3Rpb24iKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgc2VydmVyID0+IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZEN1c3RvbVJlc3BvbnNlQW5kQ2xvc2VBc3luYygNCiAgICAgICAgICAgICAgICAkIkhUVFAvMS4xIDIwMCBPS3tuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luOntmb2xkfSAqe25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJBY2NlcHQtUGF0Y2g6e2ZvbGR9IHRleHQvZXhhbXBsZTtjaGFyc2V0PXV0Zi04e25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJBY2NlcHQtUmFuZ2VzOntmb2xkfSBieXRlc3tuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiQWdlOiB7Zm9sZH0xMntuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiQWxsb3c6IHtmb2xkfUdFVCwgSEVBRHtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiQWx0LVN2Yzp7Zm9sZH0gaHR0cC8xLjE9XCJodHRwMi5leGFtcGxlLmNvbTo4MDAxXCI7IG1hPTcyMDB7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIkNhY2hlLUNvbnRyb2w6IHtmb2xkfW1heC1hZ2U9MzYwMHtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiQ29ubmVjdGlvbjp7Zm9sZH0gY2xvc2V7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIkNvbnRlbnQtRGlzcG9zaXRpb246IHtmb2xkfWF0dGFjaG1lbnQ7e2ZvbGR9IGZpbGVuYW1lPVwiZm5hbWUuZXh0XCJ7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIkNvbnRlbnQtRW5jb2Rpbmc6IHtmb2xkfWd6aXB7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIkNvbnRlbnQtTGFuZ3VhZ2U6e2ZvbGR9IGRhe25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJDb250ZW50LUxvY2F0aW9uOiB7Zm9sZH0vaW5kZXguaHRte25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJDb250ZW50LU1ENTp7Zm9sZH0gUTJobFkyc2dTVzUwWldkeWFYUjVJUT09e25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJDb250ZW50LVJhbmdlOiB7Zm9sZH1ieXRlcyB7Zm9sZH0yMTAxMC00NzAyMS80NzAyMntuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiQ29udGVudC1UeXBlOiB0ZXh0L2h0bWw7e2ZvbGR9IGNoYXJzZXQ9dXRmLTh7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIkRhdGU6IFR1ZSwgMTUgTm92IDE5OTR7Zm9sZH0gMDg6MTI6MzEgR01Ue25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJFVGFnOiB7Zm9sZH1cIjczNzA2MGNkOGMyODRkOGFmN2FkMzA4MmYyMDk1ODJkXCJ7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIkV4cGlyZXM6IFRodSx7Zm9sZH0gMDEgRGVjIDE5OTQgMTY6MDA6MDAgR01Ue25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJMYXN0LU1vZGlmaWVkOntmb2xkfSBUdWUsIDE1IE5vdiAxOTk0IDEyOjQ1OjI2IEdNVHtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiTGluazp7Zm9sZH0gPC9mZWVkPjsgcmVsPVwiYWx0ZXJuYXRlXCJ7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIkxvY2F0aW9uOntmb2xkfSBodHRwOi8vd3d3LnczLm9yZy9wdWIvV1dXL1Blb3BsZS5odG1se25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJQM1A6IHtmb2xkfUNQPVwiVGhpcyBpcyBub3QgYSBQM1AgcG9saWN5IVwie25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJQcmFnbWE6IHtmb2xkfW5vLWNhY2hle25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJQcm94eS1BdXRoZW50aWNhdGU6e2ZvbGR9IEJhc2lje25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJQdWJsaWMtS2V5LVBpbnM6e2ZvbGR9IG1heC1hZ2U9MjU5MjAwMDsgcGluLXNoYTI1Nj1cIkU5Q1o5SU5EYmQrMmVSUW96WXFxYlEyeVhMVktCOSt4Y3ByTUYrNDRVMWc9XCJ7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIlJldHJ5LUFmdGVyOiB7Zm9sZH0xMjB7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIlNlcnZlcjoge2ZvbGR9QXBhY2hlLzIuNC4xe2ZvbGR9IChVbml4KXtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiU2V0LUNvb2tpZToge2ZvbGR9VXNlcklEPUpvaG5Eb2U7IE1heC1BZ2U9MzYwMDsgVmVyc2lvbj0xe25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5OiB7Zm9sZH1tYXgtYWdlPTE2MDcwNDAwOyBpbmNsdWRlU3ViRG9tYWluc3tuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiVHJhaWxlcjoge2ZvbGR9TWF4LUZvcndhcmRze25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJUazoge2ZvbGR9P3tuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiVXBncmFkZTogSFRUUFMvMS4zLHtmb2xkfSBJUkMvNi45LHtmb2xkfSBSVEEveDExLCB7Zm9sZH13ZWJzb2NrZXR7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIlZhcnk6e2ZvbGR9IEFjY2VwdC1MYW5ndWFnZXtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiVmlhOntmb2xkfSAxLjAgZnJlZCwgMS4xIGV4YW1wbGUuY29te2ZvbGR9IChBcGFjaGUvMS4xKXtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiV2FybmluZzp7Zm9sZH0gMTk5IC0gXCJNaXNjZWxsYW5lb3VzIHdhcm5pbmdcIiBcIldlZCwgMjEgT2N0IDIwMTUgMDc6Mjg6MDAgR01UXCJ7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIldXVy1BdXRoZW50aWNhdGU6IHtmb2xkfUJhc2lje25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJYLUZyYW1lLU9wdGlvbnM6IHtmb2xkfWRlbnl7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIlgtV2ViS2l0LUNTUDogZGVmYXVsdC1zcmMgJ3NlbGYne25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJSZWZyZXNoOiB7Zm9sZH01OyB1cmw9aHR0cDovL3d3dy53My5vcmcvcHViL1dXVy9QZW9wbGUuaHRtbHtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiU3RhdHVzOiB7Zm9sZH0yMDAgT0t7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIlRpbWluZy1BbGxvdy1PcmlnaW46IHtmb2xkfTxvcmlnaW4+WywgPG9yaWdpbj5dKntuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiVXBncmFkZS1JbnNlY3VyZS1SZXF1ZXN0czp7Zm9sZH0gMXtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiWC1Db250ZW50LUR1cmF0aW9uOntmb2xkfSA0Mi42NjZ7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIlgtQ29udGVudC1UeXBlLU9wdGlvbnM6IHtmb2xkfW5vc25pZmZ7bmV3bGluZX0iICsNCiAgICAgICAgICAgICAgICAkIlgtUG93ZXJlZC1CeToge2ZvbGR9UEhQLzUuNC4we25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJYLVJlcXVlc3QtSUQ6e2ZvbGR9IGYwNThlYmQ2LTAyZjctNGQzZi05NDJlLTkwNDM0NGU4Y2RlNXtuZXdsaW5lfSIgKw0KICAgICAgICAgICAgICAgICQiWC1VQS1Db21wYXRpYmxlOiB7Zm9sZH1JRT1FbXVsYXRlSUU3e25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJYLVhTUy1Qcm90ZWN0aW9uOntmb2xkfSAxOyBtb2RlPWJsb2Nre25ld2xpbmV9IiArDQogICAgICAgICAgICAgICAgJCJ7bmV3bGluZX0iKSwNCiAgICAgICAgICAgICAgICBkcmliYmxlID8gbmV3IExvb3BiYWNrU2VydmVyLk9wdGlvbnMgeyBTdHJlYW1XcmFwcGVyID0gcyA9PiBuZXcgRHJpYmJsZVN0cmVhbShzKSB9IDogbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoZmFsc2UpXQ0KICAgICAgICBbSW5saW5lRGF0YSh0cnVlKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfVHJhaWxpbmdIZWFkZXJzX0lnbm9yZWQoYm9vbCBpbmNsdWRlVHJhaWxlckhlYWRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzQ3VybEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gQWN0aXZlSXNzdWUgIzE3MTc0OiBDdXJsSGFuZGxlciBoYXMgYSBwcm9ibGVtIGhlcmUNCiAgICAgICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY3VybC9jdXJsL2lzc3Vlcy8xMzU0DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFJlc3BvbnNlVGFzayA9IGNsaWVudC5HZXRBc3luYyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZCgNCiAgICAgICAgICAgICAgICAgICAgICAgIGdldFJlc3BvbnNlVGFzaywNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZEN1c3RvbVJlc3BvbnNlQW5kQ2xvc2VBc3luYygNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiSFRUUC8xLjEgMjAwIE9LXHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZFxyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW5jbHVkZVRyYWlsZXJIZWFkZXIgPyAiVHJhaWxlcjogTXlDb29sVHJhaWxlckhlYWRlclxyXG4iIDogIiIpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICI0XHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkYXRhXHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICIwXHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJNeUNvb2xUcmFpbGVySGVhZGVyOiBhbWF6aW5ndHJhaWxlclxyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXHJcbiIpKTsNCg0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGdldFJlc3BvbnNlVGFzaykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlVHJhaWxlckhlYWRlcikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIk15Q29vbFRyYWlsZXJIZWFkZXIiLCByZXNwb25zZS5IZWFkZXJzLkdldFZhbHVlcygiVHJhaWxlciIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShyZXNwb25zZS5IZWFkZXJzLkNvbnRhaW5zKCJNeUNvb2xUcmFpbGVySGVhZGVyIiksICJUcmFpbGVyIHNob3VsZCBoYXZlIGJlZW4gaWdub3JlZCIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiZGF0YSIsIGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkRvZXNOb3RDb250YWluKCJNeUNvb2xUcmFpbGVySGVhZGVyIiwgZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRG9lc05vdENvbnRhaW4oImFtYXppbmd0cmFpbGVyIiwgZGF0YSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfTm9uVHJhZGl0aW9uYWxDaHVua1NpemVzX0FjY2VwdGVkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXRSZXNwb25zZVRhc2sgPSBjbGllbnQuR2V0QXN5bmModXJsKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQoDQogICAgICAgICAgICAgICAgICAgICAgICBnZXRSZXNwb25zZVRhc2ssDQogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRDdXN0b21SZXNwb25zZUFuZENsb3NlQXN5bmMoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkhUVFAvMS4xIDIwMCBPS1xyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWRcclxuIiArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiNCAgICBcclxuIiArIC8vIHdoaXRlc3BhY2UgYWZ0ZXIgc2l6ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkYXRhXHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICI1O3NvbWVrZXk9c29tZXZhbHVlXHJcbiIgKyAvLyBjaHVuayBleHRlbnNpb24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaGVsbG9cclxuIiArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjdcdCA7Y2h1bmtleHRlbnNpb25cclxuIiArIC8vIHRhYnMvc3BhY2VzIHRoZW4gY2h1bmsgZXh0ZW5zaW9uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5ldGNvcmVcclxuIiArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjBcclxuIiArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxyXG4iKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBnZXRSZXNwb25zZVRhc2spDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiZGF0YSIsIGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJoZWxsbyIsIGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJuZXRjb3JlIiwgZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRG9lc05vdENvbnRhaW4oInNvbWVrZXkiLCBkYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5Eb2VzTm90Q29udGFpbigic29tZXZhbHVlIiwgZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRG9lc05vdENvbnRhaW4oImNodW5rZXh0ZW5zaW9uIiwgZGF0YSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSgiIildIC8vIG1pc3Npbmcgc2l6ZQ0KICAgICAgICBbSW5saW5lRGF0YSgiICAgICIpXSAvLyBtaXNzaW5nIHNpemUNCiAgICAgICAgW0lubGluZURhdGEoIjEwMDAwMDAwMDAwMDAwMDAwIildIC8vIG92ZXJmbG93aW5nIHNpemUNCiAgICAgICAgW0lubGluZURhdGEoInh5eiIpXSAvLyBub24taGV4DQogICAgICAgIFtJbmxpbmVEYXRhKCI3Z2liYmVyaXNoIildIC8vIHZhbGlkIHNpemUgdGhlbiBnaWJiZXJpc2gNCiAgICAgICAgW0lubGluZURhdGEoIjdcdlxmIildIC8vIHVuYWNjZXB0YWJsZSB3aGl0ZXNwYWNlDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX0ludmFsaWRDaHVua1NpemVfVGhyb3dzSHR0cFJlcXVlc3RFeGNlcHRpb24oc3RyaW5nIGNodW5rU2l6ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzQ3VybEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gbGliY3VybCBhbGxvd3MgYW55IGFyYml0cmFyeSBjaGFyYWN0ZXJzIGFmdGVyIHRoZSBoZXggdmFsdWUNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcGFydGlhbFJlc3BvbnNlID0gIkhUVFAvMS4xIDIwMCBPS1xyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICJUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZFxyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICJcclxuIiArDQogICAgICAgICAgICAgICAgICAgICAgICAkIntjaHVua1NpemV9XHJcbiI7DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRjcyA9IG5ldyBUYXNrQ29tcGxldGlvblNvdXJjZTxib29sPigpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrIHNlcnZlclRhc2sgPSBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24gPT4NCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZEN1c3RvbVJlc3BvbnNlQXN5bmMocGFydGlhbFJlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0Y3MuVGFzazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxIdHRwUmVxdWVzdEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50LkdldEFzeW5jKHVybCkpOw0KICAgICAgICAgICAgICAgICAgICB0Y3MuU2V0UmVzdWx0KHRydWUpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZXJ2ZXJUYXNrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfSW52YWxpZENodW5rVGVybWluYXRvcl9UaHJvd3NIdHRwUmVxdWVzdEV4Y2VwdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVybCA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxIdHRwUmVxdWVzdEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50LkdldEFzeW5jKHVybCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIHNlcnZlciA9PiBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRDdXN0b21SZXNwb25zZUFuZENsb3NlQXN5bmMoDQogICAgICAgICAgICAgICAgIkhUVFAvMS4xIDIwMCBPS1xyXG4iICsNCiAgICAgICAgICAgICAgICAiVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWRcclxuIiArDQogICAgICAgICAgICAgICAgIlxyXG4iICsNCiAgICAgICAgICAgICAgICAiNVxyXG4iICsNCiAgICAgICAgICAgICAgICAiaGVsbG8iICsgLy8gbWlzc2luZyBcclxuIHRlcm1pbmF0b3INCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyI1XHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIndvcmxkIiArIC8vIG1pc3NpbmcgXHJcbiB0ZXJtaW5hdG9yDQogICAgICAgICAgICAgICAgIjBcclxuIiArDQogICAgICAgICAgICAgICAgIlxyXG4iKSk7DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX0luZmluaXRlQ2h1bmtTaXplX1Rocm93c0h0dHBSZXF1ZXN0RXhjZXB0aW9uKCkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNsaWVudC5UaW1lb3V0ID0gVGltZW91dC5JbmZpbml0ZVRpbWVTcGFuOw0KDQogICAgICAgICAgICAgICAgICAgIHZhciBjdHMgPSBuZXcgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UoKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRjcyA9IG5ldyBUYXNrQ29tcGxldGlvblNvdXJjZTxib29sPigpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrIHNlcnZlclRhc2sgPSBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24gPT4NCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5SZWFkUmVxdWVzdEhlYWRlckFuZFNlbmRDdXN0b21SZXNwb25zZUFzeW5jKCJIVFRQLzEuMSAyMDAgT0tcclxuVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWRcclxuXHJcbiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyaXRlciB3cml0ZXIgPSBjb25uZWN0aW9uLldyaXRlcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICghY3RzLklzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKSAvLyBpbmZpbml0ZSB0byBtYWtlIHN1cmUgaW1wbGVtZW50YXRpb24gZG9lc24ndCBPT00NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHdyaXRlci5Xcml0ZUFzeW5jKG5ldyBzdHJpbmcoJyAnLCAxMDAwMCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRlbGF5KDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBBc3NlcnQuVGhyb3dzQXN5bmM8SHR0cFJlcXVlc3RFeGNlcHRpb24+KCgpID0+IGNsaWVudC5HZXRBc3luYyh1cmwpKTsNCiAgICAgICAgICAgICAgICAgICAgY3RzLkNhbmNlbCgpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZXJ2ZXJUYXNrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRBc3luY19UcmFuc2ZlckVuY29kaW5nU2V0QnV0Tm9SZXF1ZXN0Q29udGVudF9UaHJvd3MoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNOZXRmeEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gbm8gZXhjZXB0aW9uIHRocm93bg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIHJlcSA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UoSHR0cE1ldGhvZC5Qb3N0LCAiaHR0cDovL2JpbmcuY29tIik7DQogICAgICAgICAgICByZXEuSGVhZGVycy5UcmFuc2ZlckVuY29kaW5nQ2h1bmtlZCA9IHRydWU7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEh0dHBSZXF1ZXN0RXhjZXB0aW9uIGVycm9yID0gYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEh0dHBSZXF1ZXN0RXhjZXB0aW9uPigoKSA9PiBjLlNlbmRBc3luYyhyZXEpKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuSXNUeXBlPEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KGVycm9yLklubmVyRXhjZXB0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfUmVzcG9uc2VIZWFkZXJzUmVhZF9SZWFkRnJvbUVhY2hJdGVyYXRpdmVseURvZXNudERlYWRsb2NrKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbnN0IGludCBOdW1HZXRzID0gNTsNCiAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+W10gcmVzcG9uc2VUYXNrcyA9IChmcm9tIF8gaW4gRW51bWVyYWJsZS5SYW5nZSgwLCBOdW1HZXRzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdCBjbGllbnQuR2V0QXN5bmMoQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIsIEh0dHBDb21wbGV0aW9uT3B0aW9uLlJlc3BvbnNlSGVhZGVyc1JlYWQpKS5Ub0FycmF5KCk7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IHJlc3BvbnNlVGFza3MuTGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIC8vIHJlYWQgYmFja3dhcmRzIHRvIGluY3JlYXNlIGxpa2VsaWhvb2QgdGhhdCB3ZSB3YWl0IG9uIGEgZGlmZmVyZW50IHRhc2sgdGhhbiBoYXMgZGF0YSBhdmFpbGFibGUNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgcmVzcG9uc2VUYXNrc1tpXSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlQ29udGVudCA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHJlc3BvbnNlQ29udGVudCk7DQogICAgICAgICAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlc3BvbnNlQm9keSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvbnRlbnQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRNRDUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRBc3luY19IdHRwUmVxdWVzdE1zZ1Jlc3BvbnNlSGVhZGVyc1JlYWRfU3RhdHVzQ29kZU9LKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cFJlcXVlc3RNZXNzYWdlIHJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuR2V0LCBDb25maWd1cmF0aW9uLkh0dHAuU2VjdXJlUmVtb3RlRWNob1NlcnZlcik7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QsIEh0dHBDb21wbGV0aW9uT3B0aW9uLlJlc3BvbnNlSGVhZGVyc1JlYWQpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlQ29udGVudCA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUocmVzcG9uc2VDb250ZW50KTsNCiAgICAgICAgICAgICAgICAgICAgVGVzdEhlbHBlci5WZXJpZnlSZXNwb25zZUJvZHkoDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvbnRlbnQsDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5Db250ZW50LkhlYWRlcnMuQ29udGVudE1ENSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJuZXRmeCdzIENvbm5lY3RTdHJlYW0uUmVhZEFzeW5jIHRyaWVzIHRvIHJlYWQgYmV5b25kIGRhdGEgYWxyZWFkeSBidWZmZXJlZCwgY2F1c2luZyBoYW5ncyAjMTg4NjQiKV0NCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTZW5kQXN5bmNfUmVhZEZyb21TbG93U3RyZWFtaW5nU2VydmVyX1BhcnRpYWxEYXRhUmV0dXJuZWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXRSZXNwb25zZSA9IGNsaWVudC5HZXRBc3luYyh1cmwsIEh0dHBDb21wbGV0aW9uT3B0aW9uLlJlc3BvbnNlSGVhZGVyc1JlYWQpOw0KDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbiA9Pg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZEN1c3RvbVJlc3BvbnNlQXN5bmMoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkhUVFAvMS4xIDIwMCBPS1xyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkIkRhdGU6IHtEYXRlVGltZU9mZnNldC5VdGNOb3c6Un1cclxuIiArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtTGVuZ3RoOiAxNjAwMFxyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsZXNzIHRoYW4gMTYwMDAgYnl0ZXMiKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBnZXRSZXNwb25zZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVmZmVyID0gbmV3IGJ5dGVbODAwMF07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmcgKFN0cmVhbSBjbGllbnRTdHJlYW0gPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmVhbUFzeW5jKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgYnl0ZXNSZWFkID0gYXdhaXQgY2xpZW50U3RyZWFtLlJlYWRBc3luYyhidWZmZXIsIDAsIGJ1ZmZlci5MZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgkIkJ5dGVzIHJlYWQgZnJvbSBzdHJlYW06IHtieXRlc1JlYWR9Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGJ5dGVzUmVhZCA8IGJ1ZmZlci5MZW5ndGgsICJieXRlc1JlYWQgc2hvdWxkIGJlIGxlc3MgdGhhbiBidWZmZXIuTGVuZ3RoIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKHRydWUpXQ0KICAgICAgICBbSW5saW5lRGF0YShmYWxzZSldDQogICAgICAgIFtJbmxpbmVEYXRhKG51bGwpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBSZWFkQXNTdHJlYW1Bc3luY19IYW5kbGVyUHJvZHVjZXNXZWxsQmVoYXZlZFJlc3BvbnNlU3RyZWFtKGJvb2w/IGNodW5rZWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLkdldCwgdXJpKTsNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwTWVzc2FnZUludm9rZXIoQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkpDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QsIENhbmNlbGxhdGlvblRva2VuLk5vbmUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKFN0cmVhbSByZXNwb25zZVN0cmVhbSA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyZWFtQXN5bmMoKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlNhbWUocmVzcG9uc2VTdHJlYW0sIGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyZWFtQXN5bmMoKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvb2xlYW4gcHJvcGVydGllcyByZXR1cm5pbmcgY29ycmVjdCB2YWx1ZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKHJlc3BvbnNlU3RyZWFtLkNhblJlYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKHJlc3BvbnNlU3RyZWFtLkNhbldyaXRlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShyZXNwb25zZVN0cmVhbS5DYW5TZWVrKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90IHN1cHBvcnRlZCBvcGVyYXRpb25zDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE5vdFN1cHBvcnRlZEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uQmVnaW5Xcml0ZShuZXcgYnl0ZVsxXSwgMCwgMSwgbnVsbCwgbnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE5vdFN1cHBvcnRlZEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uUG9zaXRpb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlBvc2l0aW9uID0gMCk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE5vdFN1cHBvcnRlZEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uU2VlaygwLCBTZWVrT3JpZ2luLkJlZ2luKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE5vdFN1cHBvcnRlZEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uU2V0TGVuZ3RoKDApKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8Tm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5Xcml0ZShuZXcgYnl0ZVsxXSwgMCwgMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLldyaXRlKG5ldyBTcGFuPGJ5dGU+KG5ldyBieXRlWzFdKSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHsgcmVzcG9uc2VTdHJlYW0uV3JpdGVBc3luYyhuZXcgTWVtb3J5PGJ5dGU+KG5ldyBieXRlWzFdKSk7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHsgcmVzcG9uc2VTdHJlYW0uV3JpdGVBc3luYyhuZXcgYnl0ZVsxXSwgMCwgMSk7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLldyaXRlQnl0ZSgxKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEludmFsaWQgYXJndW1lbnRzDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm9uV3JpdGFibGVTdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKG5ldyBieXRlWzFdLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlzcG9zZWRTdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwb3NlZFN0cmVhbS5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uQ29weVRvKG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5Db3B5VG8oU3RyZWFtLk51bGwsIDApKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnROdWxsRXhjZXB0aW9uPigoKSA9PiB7IHJlc3BvbnNlU3RyZWFtLkNvcHlUb0FzeW5jKG51bGwsIDEwMCwgZGVmYXVsdCk7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCgpID0+IHsgcmVzcG9uc2VTdHJlYW0uQ29weVRvQXN5bmMoU3RyZWFtLk51bGwsIDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiB7IHJlc3BvbnNlU3RyZWFtLkNvcHlUb0FzeW5jKFN0cmVhbS5OdWxsLCAtMSwgZGVmYXVsdCk7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHsgcmVzcG9uc2VTdHJlYW0uQ29weVRvQXN5bmMobm9uV3JpdGFibGVTdHJlYW0sIDEwMCwgZGVmYXVsdCk7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxPYmplY3REaXNwb3NlZEV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5Db3B5VG9Bc3luYyhkaXNwb3NlZFN0cmVhbSwgMTAwLCBkZWZhdWx0KTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uUmVhZChudWxsLCAwLCAxMDApKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5SZWFkKG5ldyBieXRlWzFdLCAtMSwgMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93c0FueTxBcmd1bWVudEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uUmVhZChuZXcgYnl0ZVsxXSwgMiwgMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlJlYWQobmV3IGJ5dGVbMV0sIDAsIC0xKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PEFyZ3VtZW50RXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5SZWFkKG5ldyBieXRlWzFdLCAwLCAyKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uQmVnaW5SZWFkKG51bGwsIDAsIDEwMCwgbnVsbCwgbnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkJlZ2luUmVhZChuZXcgYnl0ZVsxXSwgLTEsIDEsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3NBbnk8QXJndW1lbnRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkJlZ2luUmVhZChuZXcgYnl0ZVsxXSwgMiwgMSwgbnVsbCwgbnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkJlZ2luUmVhZChuZXcgYnl0ZVsxXSwgMCwgLTEsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3NBbnk8QXJndW1lbnRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkJlZ2luUmVhZChuZXcgYnl0ZVsxXSwgMCwgMiwgbnVsbCwgbnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkVuZFJlYWQobnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKElzTmV0ZnhIYW5kbGVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFyZ3VtZW50IGV4Y2VwdGlvbnMgb24gbmV0ZnggYXJlIHRocm93biBvdXQgb2YgdGhlc2UgYXN5bmNocm9ub3VzbHkgcmF0aGVyIHRoYW4gc3luY2hyb25vdXNseQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlJlYWRBc3luYyhudWxsLCAwLCAxMDAsIGRlZmF1bHQpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBBc3NlcnQuVGhyb3dzQXN5bmM8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMobmV3IGJ5dGVbMV0sIC0xLCAxLCBkZWZhdWx0KSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uUmVhZEFzeW5jKG5ldyBieXRlWzFdLCAyLCAxLCBkZWZhdWx0KSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uUmVhZEFzeW5jKG5ldyBieXRlWzFdLCAwLCAtMSwgZGVmYXVsdCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlJlYWRBc3luYyhuZXcgYnl0ZVsxXSwgMCwgMiwgZGVmYXVsdCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnROdWxsRXhjZXB0aW9uPigoKSA9PiB7IHJlc3BvbnNlU3RyZWFtLlJlYWRBc3luYyhudWxsLCAwLCAxMDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMobmV3IGJ5dGVbMV0sIC0xLCAxLCBkZWZhdWx0KTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93c0FueTxBcmd1bWVudEV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMobmV3IGJ5dGVbMV0sIDIsIDEsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMobmV3IGJ5dGVbMV0sIDAsIC0xLCBkZWZhdWx0KTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93c0FueTxBcmd1bWVudEV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMobmV3IGJ5dGVbMV0sIDAsIDIsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFyaW91cyBmb3JtcyBvZiByZWFkaW5nDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVmZmVyID0gbmV3IGJ5dGVbMV07DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgnaCcsIHJlc3BvbnNlU3RyZWFtLlJlYWRCeXRlKCkpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMSwgYXdhaXQgVGFzay5GYWN0b3J5LkZyb21Bc3luYyhyZXNwb25zZVN0cmVhbS5CZWdpblJlYWQsIHJlc3BvbnNlU3RyZWFtLkVuZFJlYWQsIGJ1ZmZlciwgMCwgMSwgbnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKChieXRlKSdlJywgYnVmZmVyWzBdKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIGF3YWl0IHJlc3BvbnNlU3RyZWFtLlJlYWRBc3luYyhuZXcgTWVtb3J5PGJ5dGU+KGJ1ZmZlcikpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgoYnl0ZSknbCcsIGJ1ZmZlclswXSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCBhd2FpdCByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMoYnVmZmVyLCAwLCAxKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoKGJ5dGUpJ2wnLCBidWZmZXJbMF0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMSwgcmVzcG9uc2VTdHJlYW0uUmVhZChuZXcgU3BhbjxieXRlPihidWZmZXIpKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoKGJ5dGUpJ28nLCBidWZmZXJbMF0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMSwgcmVzcG9uc2VTdHJlYW0uUmVhZChidWZmZXIsIDAsIDEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgoYnl0ZSknICcsIGJ1ZmZlclswXSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghSXNOZXRmeEhhbmRsZXIpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9pbmcgYW55IG9mIHRoZXNlIDAtYnl0ZSByZWFkcyBjYXVzZXMgdGhlIGNvbm5lY3Rpb24gdG8gZmFpbC4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgYXdhaXQgVGFzay5GYWN0b3J5LkZyb21Bc3luYyhyZXNwb25zZVN0cmVhbS5CZWdpblJlYWQsIHJlc3BvbnNlU3RyZWFtLkVuZFJlYWQsIEFycmF5LkVtcHR5PGJ5dGU+KCksIDAsIDAsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgYXdhaXQgcmVzcG9uc2VTdHJlYW0uUmVhZEFzeW5jKE1lbW9yeTxieXRlPi5FbXB0eSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCBhd2FpdCByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMoQXJyYXkuRW1wdHk8Ynl0ZT4oKSwgMCwgMCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCByZXNwb25zZVN0cmVhbS5SZWFkKFNwYW48Ynl0ZT4uRW1wdHkpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgcmVzcG9uc2VTdHJlYW0uUmVhZChBcnJheS5FbXB0eTxieXRlPigpLCAwLCAwKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFuZCBjb3B5aW5nDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXMgPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByZXNwb25zZVN0cmVhbS5Db3B5VG9Bc3luYyhtcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoIndvcmxkIiwgRW5jb2RpbmcuQVNDSUkuR2V0U3RyaW5nKG1zLlRvQXJyYXkoKSkpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIGFuZCBjb3B5IGFnYWluIG9uY2Ugd2UndmUgZXhoYXVzdGVkIGFsbCBkYXRhDQogICAgICAgICAgICAgICAgICAgICAgICBtcyA9IG5ldyBNZW1vcnlTdHJlYW0oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHJlc3BvbnNlU3RyZWFtLkNvcHlUb0FzeW5jKG1zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlU3RyZWFtLkNvcHlUbyhtcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgbXMuTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgtMSwgcmVzcG9uc2VTdHJlYW0uUmVhZEJ5dGUoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgcmVzcG9uc2VTdHJlYW0uUmVhZChidWZmZXIsIDAsIDEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCByZXNwb25zZVN0cmVhbS5SZWFkKG5ldyBTcGFuPGJ5dGU+KGJ1ZmZlcikpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCBhd2FpdCByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMoYnVmZmVyLCAwLCAxKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgYXdhaXQgcmVzcG9uc2VTdHJlYW0uUmVhZEFzeW5jKG5ldyBNZW1vcnk8Ynl0ZT4oYnVmZmVyKSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDAsIGF3YWl0IFRhc2suRmFjdG9yeS5Gcm9tQXN5bmMocmVzcG9uc2VTdHJlYW0uQmVnaW5SZWFkLCByZXNwb25zZVN0cmVhbS5FbmRSZWFkLCBidWZmZXIsIDAsIDEsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIGFzeW5jIHNlcnZlciA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbiA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5SZWFkUmVxdWVzdEhlYWRlckFzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uV3JpdGVyLldyaXRlQXN5bmMoIkhUVFAvMS4xIDIwMCBPS1xyXG4iKTsNCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjaHVua2VkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHRydWU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5Xcml0ZXIuV3JpdGVBc3luYygiVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWRcclxuXHJcbjNcclxuaGVsXHJcbjhcclxubG8gd29ybGRcclxuMFxyXG5cclxuIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZmFsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5Xcml0ZXIuV3JpdGVBc3luYygiQ29udGVudC1MZW5ndGg6IDExXHJcblxyXG5oZWxsbyB3b3JsZCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIG51bGw6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5Xcml0ZXIuV3JpdGVBc3luYygiXHJcbmhlbGxvIHdvcmxkIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFJlYWRBc1N0cmVhbUFzeW5jX0VtcHR5UmVzcG9uc2VCb2R5X0hhbmRsZXJQcm9kdWNlc1dlbGxCZWhhdmVkUmVzcG9uc2VTdHJlYW0oKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVDbGllbnRBbmRTZXJ2ZXJBc3luYyhhc3luYyB1cmkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwTWVzc2FnZUludm9rZXIoQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UoSHR0cE1ldGhvZC5HZXQsIHVyaSk7DQoNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QsIENhbmNlbGxhdGlvblRva2VuLk5vbmUpKQ0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoU3RyZWFtIHJlc3BvbnNlU3RyZWFtID0gYXdhaXQgcmVzcG9uc2UuQ29udGVudC5SZWFkQXNTdHJlYW1Bc3luYygpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBCb29sZWFuIHByb3BlcnRpZXMgcmV0dXJuaW5nIGNvcnJlY3QgdmFsdWVzDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShyZXNwb25zZVN0cmVhbS5DYW5SZWFkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShyZXNwb25zZVN0cmVhbS5DYW5Xcml0ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UocmVzcG9uc2VTdHJlYW0uQ2FuU2Vlayk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdCBzdXBwb3J0ZWQgb3BlcmF0aW9ucw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkJlZ2luV3JpdGUobmV3IGJ5dGVbMV0sIDAsIDEsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8Tm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5MZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlBvc2l0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8Tm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5Qb3NpdGlvbiA9IDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlNlZWsoMCwgU2Vla09yaWdpbi5CZWdpbikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlNldExlbmd0aCgwKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE5vdFN1cHBvcnRlZEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uV3JpdGUobmV3IGJ5dGVbMV0sIDAsIDEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8Tm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5Xcml0ZShuZXcgU3BhbjxieXRlPihuZXcgYnl0ZVsxXSkpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KGFzeW5jICgpID0+IGF3YWl0IHJlc3BvbnNlU3RyZWFtLldyaXRlQXN5bmMobmV3IE1lbW9yeTxieXRlPihuZXcgYnl0ZVsxXSkpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KGFzeW5jICgpID0+IGF3YWl0IHJlc3BvbnNlU3RyZWFtLldyaXRlQXN5bmMobmV3IGJ5dGVbMV0sIDAsIDEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8Tm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5Xcml0ZUJ5dGUoMSkpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnZhbGlkIGFyZ3VtZW50cw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vbldyaXRhYmxlU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbShuZXcgYnl0ZVsxXSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3Bvc2VkU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzcG9zZWRTdHJlYW0uRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkNvcHlUbyhudWxsKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uQ29weVRvKFN0cmVhbS5OdWxsLCAwKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5Db3B5VG9Bc3luYyhudWxsLCAxMDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiB7IHJlc3BvbnNlU3RyZWFtLkNvcHlUb0FzeW5jKFN0cmVhbS5OdWxsLCAwLCBkZWZhdWx0KTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5Db3B5VG9Bc3luYyhTdHJlYW0uTnVsbCwgLTEsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8Tm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiB7IHJlc3BvbnNlU3RyZWFtLkNvcHlUb0FzeW5jKG5vbldyaXRhYmxlU3RyZWFtLCAxMDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8T2JqZWN0RGlzcG9zZWRFeGNlcHRpb24+KCgpID0+IHsgcmVzcG9uc2VTdHJlYW0uQ29weVRvQXN5bmMoZGlzcG9zZWRTdHJlYW0sIDEwMCwgZGVmYXVsdCk7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlJlYWQobnVsbCwgMCwgMTAwKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uUmVhZChuZXcgYnl0ZVsxXSwgLTEsIDEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3NBbnk8QXJndW1lbnRFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLlJlYWQobmV3IGJ5dGVbMV0sIDIsIDEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5SZWFkKG5ldyBieXRlWzFdLCAwLCAtMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93c0FueTxBcmd1bWVudEV4Y2VwdGlvbj4oKCkgPT4gcmVzcG9uc2VTdHJlYW0uUmVhZChuZXcgYnl0ZVsxXSwgMCwgMikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+IHJlc3BvbnNlU3RyZWFtLkJlZ2luUmVhZChudWxsLCAwLCAxMDAsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5CZWdpblJlYWQobmV3IGJ5dGVbMV0sIC0xLCAxLCBudWxsLCBudWxsKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PEFyZ3VtZW50RXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5CZWdpblJlYWQobmV3IGJ5dGVbMV0sIDIsIDEsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5CZWdpblJlYWQobmV3IGJ5dGVbMV0sIDAsIC0xLCBudWxsLCBudWxsKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PEFyZ3VtZW50RXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5CZWdpblJlYWQobmV3IGJ5dGVbMV0sIDAsIDIsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnROdWxsRXhjZXB0aW9uPigoKSA9PiByZXNwb25zZVN0cmVhbS5FbmRSZWFkKG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghSXNOZXRmeEhhbmRsZXIpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG5ldGZ4IGhhbmRsZXIgZG9lc24ndCB2YWxpZGF0ZSB0aGVzZSBhcmd1bWVudHMuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+IHsgcmVzcG9uc2VTdHJlYW0uQ29weVRvKG51bGwpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5Db3B5VG9Bc3luYyhudWxsLCAxMDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5Db3B5VG9Bc3luYyhudWxsLCAxMDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5SZWFkKG51bGwsIDAsIDEwMCk7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnROdWxsRXhjZXB0aW9uPigoKSA9PiB7IHJlc3BvbnNlU3RyZWFtLlJlYWRBc3luYyhudWxsLCAwLCAxMDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4geyByZXNwb25zZVN0cmVhbS5CZWdpblJlYWQobnVsbCwgMCwgMTAwLCBudWxsLCBudWxsKTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVtcHR5IHJlYWRzDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVmZmVyID0gbmV3IGJ5dGVbMV07DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoLTEsIHJlc3BvbnNlU3RyZWFtLlJlYWRCeXRlKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDAsIGF3YWl0IFRhc2suRmFjdG9yeS5Gcm9tQXN5bmMocmVzcG9uc2VTdHJlYW0uQmVnaW5SZWFkLCByZXNwb25zZVN0cmVhbS5FbmRSZWFkLCBidWZmZXIsIDAsIDEsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCBhd2FpdCByZXNwb25zZVN0cmVhbS5SZWFkQXN5bmMobmV3IE1lbW9yeTxieXRlPihidWZmZXIpKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgYXdhaXQgcmVzcG9uc2VTdHJlYW0uUmVhZEFzeW5jKGJ1ZmZlciwgMCwgMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDAsIHJlc3BvbnNlU3RyZWFtLlJlYWQobmV3IFNwYW48Ynl0ZT4oYnVmZmVyKSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDAsIHJlc3BvbnNlU3RyZWFtLlJlYWQoYnVmZmVyLCAwLCAxKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVtcHR5IGNvcGllcw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1zID0gbmV3IE1lbW9yeVN0cmVhbSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVzcG9uc2VTdHJlYW0uQ29weVRvQXN5bmMobXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDAsIG1zLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVN0cmVhbS5Db3B5VG8obXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDAsIG1zLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2VydmVyID0+IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgRGlzcG9zZV9EaXNwb3NpbmdIYW5kbGVyQ2FuY2Vsc0FjdGl2ZU9wZXJhdGlvbnNXaXRob3V0UmVzcG9uc2VzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFVzZVNvY2tldHNIdHRwSGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBUT0RPICMyMzEzMTogVGhlIFNvY2tldHNIdHRwSGFuZGxlciBpc24ndCBjb3JyZWN0bHkgaGFuZGxpbmcgZGlzcG9zYWwgb2YgdGhlIGhhbmRsZXIuDQogICAgICAgICAgICAgICAgLy8gSXQgc2hvdWxkIGNhdXNlIHRoZSBvdXRzdGFuZGluZyByZXF1ZXN0cyB0byBiZSBjYW5jZWxlZCB3aXRoIE9wZXJhdGlvbkNhbmNlbGVkRXhjZXB0aW9ucywNCiAgICAgICAgICAgICAgICAvLyB3aGVyZWFzIGN1cnJlbnRseSBpdCdzIHJlc3VsdGluZyBpbiBPYmplY3REaXNwb3NlZEV4Y2VwdGlvbnMuDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyMSwgdXJsMSkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyMiwgdXJsMikgPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIzLCB1cmwzKSA9Pg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5ibG9ja1NlcnZlcnMgPSBuZXcgVGFza0NvbXBsZXRpb25Tb3VyY2U8Ym9vbD4oVGFza0NvbnRpbnVhdGlvbk9wdGlvbnMuUnVuQ29udGludWF0aW9uc0FzeW5jaHJvbm91c2x5KTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmlyc3Qgc2VydmVyIGNvbm5lY3RzIGJ1dCBkb2Vzbid0IHNlbmQgYW55IHJlc3BvbnNlIHlldA0KICAgICAgICAgICAgICAgICAgICAgICAgVGFzayBzZXJ2ZXJUYXNrMSA9IHNlcnZlcjEuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24xID0+DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdW5ibG9ja1NlcnZlcnMuVGFzazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZWNvbmQgc2VydmVyIGNvbm5lY3RzIGFuZCBzZW5kcyBzb21lIGJ1dCBub3QgYWxsIGhlYWRlcnMNCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2sgc2VydmVyVGFzazIgPSBzZXJ2ZXIyLkFjY2VwdENvbm5lY3Rpb25Bc3luYyhhc3luYyBjb25uZWN0aW9uMiA9Pg0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24yLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZEN1c3RvbVJlc3BvbnNlQXN5bmMoJCJIVFRQLzEuMSAyMDAgT0tcclxuIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdW5ibG9ja1NlcnZlcnMuVGFzazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlyZCBzZXJ2ZXIgY29ubmVjdHMgYW5kIHNlbmRzIGFsbCBoZWFkZXJzIGFuZCBzb21lIGJ1dCBub3QgYWxsIG9mIHRoZSBib2R5DQogICAgICAgICAgICAgICAgICAgICAgICBUYXNrIHNlcnZlclRhc2szID0gc2VydmVyMy5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbjMgPT4NCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uMy5SZWFkUmVxdWVzdEhlYWRlckFuZFNlbmRDdXN0b21SZXNwb25zZUFzeW5jKCQiSFRUUC8xLjEgMjAwIE9LXHJcbkRhdGU6IHtEYXRlVGltZU9mZnNldC5VdGNOb3c6Un1cclxuQ29udGVudC1MZW5ndGg6IDIwXHJcblxyXG4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uMy5Xcml0ZXIuV3JpdGVBc3luYygiMTIzNDU2Nzg5MCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHVuYmxvY2tTZXJ2ZXJzLlRhc2s7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbjMuV3JpdGVyLldyaXRlQXN5bmMoIjEyMzQ1Njc4OTAiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uMy5Tb2NrZXQuU2h1dGRvd24oU29ja2V0U2h1dGRvd24uU2VuZCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSB0aHJlZSByZXF1ZXN0cw0KICAgICAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXQxLCBnZXQyOw0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZTM7DQogICAgICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0MSA9IGNsaWVudC5HZXRBc3luYyh1cmwxLCBIdHRwQ29tcGxldGlvbk9wdGlvbi5SZXNwb25zZUhlYWRlcnNSZWFkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXQyID0gY2xpZW50LkdldEFzeW5jKHVybDIsIEh0dHBDb21wbGV0aW9uT3B0aW9uLlJlc3BvbnNlSGVhZGVyc1JlYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlMyA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmwzLCBIdHRwQ29tcGxldGlvbk9wdGlvbi5SZXNwb25zZUhlYWRlcnNSZWFkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gLy8gRGlzcG9zZSB0aGUgaGFuZGxlciB3aGlsZSByZXF1ZXN0cyBhcmUgc3RpbGwgb3V0c3RhbmRpbmcNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVxdWVzdHMgMSBhbmQgMiBzaG91bGQgYmUgY2FuY2VsZWQgYXMgd2UgaGF2ZW4ndCBmaW5pc2hlZCByZWNlaXZpbmcgdGhlaXIgaGVhZGVycw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPFRhc2tDYW5jZWxlZEV4Y2VwdGlvbj4oKCkgPT4gZ2V0MSk7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBBc3NlcnQuVGhyb3dzQXN5bmM8VGFza0NhbmNlbGVkRXhjZXB0aW9uPigoKSA9PiBnZXQyKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVxdWVzdCAzIHNob3VsZCBzdGlsbCBiZSBhY3RpdmUsIGFuZCB3ZSBzaG91bGQgYmUgYWJsZSB0byByZWNlaXZlIGFsbCBvZiB0aGUgZGF0YS4NCiAgICAgICAgICAgICAgICAgICAgICAgIHVuYmxvY2tTZXJ2ZXJzLlNldFJlc3VsdCh0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nIChyZXNwb25zZTMpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCIxMjM0NTY3ODkwMTIzNDU2Nzg5MCIsIGF3YWl0IHJlc3BvbnNlMy5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKDk5KV0NCiAgICAgICAgW0lubGluZURhdGEoMTAwMCldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX1N0YXR1c0NvZGVPdXRPZlJhbmdlX0V4cGVjdGVkRXhjZXB0aW9uKGludCBzdGF0dXNDb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoUGxhdGZvcm1EZXRlY3Rpb24uSXNVYXAgJiYgc3RhdHVzQ29kZSA9PSA5OSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBVQVAgcGxhdGZvcm0gYWxsb3dzIHRoaXMgc3RhdHVzIGNvZGUgZHVlIHRvIGhpc3RvcmljYWwgcmVhc29ucy4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFJlc3BvbnNlVGFzayA9IGNsaWVudC5HZXRBc3luYyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRDdXN0b21SZXNwb25zZUFuZENsb3NlQXN5bmMoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCJIVFRQLzEuMSB7c3RhdHVzQ29kZX1cclxuIiArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCJEYXRlOiB7RGF0ZVRpbWVPZmZzZXQuVXRjTm93OlJ9XHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcclxuIik7DQoNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEh0dHBSZXF1ZXN0RXhjZXB0aW9uPigoKSA9PiBnZXRSZXNwb25zZVRhc2spOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgI3JlZ2lvbiBQb3N0IE1ldGhvZHMgVGVzdHMNCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoVmVyaWZ5VXBsb2FkU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0QXN5bmNfQ2FsbE1ldGhvZFR3aWNlX1N0cmluZ0NvbnRlbnQoVXJpIHJlbW90ZVNlcnZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBkYXRhID0gIlRlc3QgU3RyaW5nIjsNCiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IG5ldyBTdHJpbmdDb250ZW50KGRhdGEsIEVuY29kaW5nLlVURjgpOw0KICAgICAgICAgICAgICAgIGNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1ID0gVGVzdEhlbHBlci5Db21wdXRlTUQ1SGFzaChkYXRhKTsNCiAgICAgICAgICAgICAgICBIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlOw0KICAgICAgICAgICAgICAgIHVzaW5nIChyZXNwb25zZSA9IGF3YWl0IGNsaWVudC5Qb3N0QXN5bmMocmVtb3RlU2VydmVyLCBjb250ZW50KSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gUmVwZWF0IGNhbGwuDQogICAgICAgICAgICAgICAgY29udGVudCA9IG5ldyBTdHJpbmdDb250ZW50KGRhdGEsIEVuY29kaW5nLlVURjgpOw0KICAgICAgICAgICAgICAgIGNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1ID0gVGVzdEhlbHBlci5Db21wdXRlTUQ1SGFzaChkYXRhKTsNCiAgICAgICAgICAgICAgICB1c2luZyAocmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuUG9zdEFzeW5jKHJlbW90ZVNlcnZlciwgY29udGVudCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihWZXJpZnlVcGxvYWRTZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RBc3luY19DYWxsTWV0aG9kX1VuaWNvZGVTdHJpbmdDb250ZW50KFVyaSByZW1vdGVTZXJ2ZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgZGF0YSA9ICJcdWI0ZjFcdWZmYzdcdTRlODJcdTY3YWI0XHVjNmQ0XHVkMWEwXHVjNjk0XHVjNzdjXHVmZmRhM1x1MzE1NVx1YzIxOFx1ZmZkYiI7DQogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBuZXcgU3RyaW5nQ29udGVudChkYXRhLCBFbmNvZGluZy5VVEY4KTsNCiAgICAgICAgICAgICAgICBjb250ZW50LkhlYWRlcnMuQ29udGVudE1ENSA9IFRlc3RIZWxwZXIuQ29tcHV0ZU1ENUhhc2goZGF0YSk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5Qb3N0QXN5bmMocmVtb3RlU2VydmVyLCBjb250ZW50KSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKFZlcmlmeVVwbG9hZFNlcnZlcnNTdHJlYW1zQW5kRXhwZWN0ZWREYXRhKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RBc3luY19DYWxsTWV0aG9kX1N0cmVhbUNvbnRlbnQoVXJpIHJlbW90ZVNlcnZlciwgSHR0cENvbnRlbnQgY29udGVudCwgYnl0ZVtdIGV4cGVjdGVkRGF0YSkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1ID0gVGVzdEhlbHBlci5Db21wdXRlTUQ1SGFzaChleHBlY3RlZERhdGEpOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuUG9zdEFzeW5jKHJlbW90ZVNlcnZlciwgY29udGVudCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc2VhbGVkIGNsYXNzIFN0cmVhbUNvbnRlbnRXaXRoU3luY0FzeW5jQ29weSA6IFN0cmVhbUNvbnRlbnQNCiAgICAgICAgew0KICAgICAgICAgICAgcHJpdmF0ZSByZWFkb25seSBTdHJlYW0gX3N0cmVhbTsNCiAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYm9vbCBfc3luY0NvcHk7DQoNCiAgICAgICAgICAgIHB1YmxpYyBTdHJlYW1Db250ZW50V2l0aFN5bmNBc3luY0NvcHkoU3RyZWFtIHN0cmVhbSwgYm9vbCBzeW5jQ29weSkgOiBiYXNlKHN0cmVhbSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfc3RyZWFtID0gc3RyZWFtOw0KICAgICAgICAgICAgICAgIF9zeW5jQ29weSA9IHN5bmNDb3B5Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgVGFzayBTZXJpYWxpemVUb1N0cmVhbUFzeW5jKFN0cmVhbSBzdHJlYW0sIFRyYW5zcG9ydENvbnRleHQgY29udGV4dCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX3N5bmNDb3B5KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9zdHJlYW0uQ29weVRvKHN0cmVhbSwgMTI4KTsgLy8gYXJiaXRyYXJ5IHNpemUgbGlrZWx5IHRvIHJlcXVpcmUgbXVsdGlwbGUgcmVhZC93cml0ZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUYXNrLkNvbXBsZXRlZFRhc2s7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleGMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUYXNrLkZyb21FeGNlcHRpb24oZXhjKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiBiYXNlLlNlcmlhbGl6ZVRvU3RyZWFtQXN5bmMoc3RyZWFtLCBjb250ZXh0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgSUVudW1lcmFibGU8b2JqZWN0W10+IFZlcmlmeVVwbG9hZFNlcnZlcnNTdHJlYW1zQW5kRXhwZWN0ZWREYXRhDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKG9iamVjdFtdIHNlcnZlckFyciBpbiBWZXJpZnlVcGxvYWRTZXJ2ZXJzKSAvLyB0YXJnZXQgc2VydmVyDQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKGJvb2wgc3luY0NvcHkgaW4gbmV3W10geyB0cnVlLCBmYWxzZSB9KSAvLyBmb3JjZSB0aGUgY29udGVudCBjb3B5IHRvIGhhcHBlbiB2aWEgUmVhZC9Xcml0ZSBvciBSZWFkQXN5bmMvV3JpdGVBc3luYw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBVcmkgc2VydmVyID0gKFVyaSlzZXJ2ZXJBcnJbMF07DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBkYXRhID0gbmV3IGJ5dGVbMTIzNF07DQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmFuZG9tKDQyKS5OZXh0Qnl0ZXMoZGF0YSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEEgTWVtb3J5U3RyZWFtDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lbVN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oZGF0YSwgd3JpdGFibGU6IGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgc2VydmVyLCBuZXcgU3RyZWFtQ29udGVudFdpdGhTeW5jQXN5bmNDb3B5KG1lbVN0cmVhbSwgc3luY0NvcHk6IHN5bmNDb3B5KSwgZGF0YSB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBBIG11bHRpcGFydCBjb250ZW50IHRoYXQgcHJvdmlkZXMgaXRzIG93biBzdHJlYW0gZnJvbSBDcmVhdGVDb250ZW50UmVhZFN0cmVhbUFzeW5jDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1jID0gbmV3IE11bHRpcGFydENvbnRlbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYy5BZGQobmV3IEJ5dGVBcnJheUNvbnRlbnQoZGF0YSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZW1TdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWMuQ29weVRvQXN5bmMobWVtU3RyZWFtKS5HZXRBd2FpdGVyKCkuR2V0UmVzdWx0KCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7IHNlcnZlciwgbWMsIG1lbVN0cmVhbS5Ub0FycmF5KCkgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQSBzdHJlYW0gdGhhdCBwcm92aWRlcyB0aGUgZGF0YSBzeW5jaHJvbm91c2x5IGFuZCBoYXMgYSBrbm93biBsZW5ndGgNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgd3JhcHBlZE1lbVN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oZGF0YSwgd3JpdGFibGU6IGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3luY0tub3duTGVuZ3RoU3RyZWFtID0gbmV3IERlbGVnYXRlU3RyZWFtKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5SZWFkRnVuYzogKCkgPT4gd3JhcHBlZE1lbVN0cmVhbS5DYW5SZWFkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5TZWVrRnVuYzogKCkgPT4gd3JhcHBlZE1lbVN0cmVhbS5DYW5TZWVrLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGhGdW5jOiAoKSA9PiB3cmFwcGVkTWVtU3RyZWFtLkxlbmd0aCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25HZXRGdW5jOiAoKSA9PiB3cmFwcGVkTWVtU3RyZWFtLlBvc2l0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblNldEZ1bmM6IHAgPT4gd3JhcHBlZE1lbVN0cmVhbS5Qb3NpdGlvbiA9IHAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRGdW5jOiAoYnVmZmVyLCBvZmZzZXQsIGNvdW50KSA9PiB3cmFwcGVkTWVtU3RyZWFtLlJlYWQoYnVmZmVyLCBvZmZzZXQsIGNvdW50KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZEFzeW5jRnVuYzogKGJ1ZmZlciwgb2Zmc2V0LCBjb3VudCwgdG9rZW4pID0+IHdyYXBwZWRNZW1TdHJlYW0uUmVhZEFzeW5jKGJ1ZmZlciwgb2Zmc2V0LCBjb3VudCwgdG9rZW4pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgc2VydmVyLCBuZXcgU3RyZWFtQ29udGVudFdpdGhTeW5jQXN5bmNDb3B5KHN5bmNLbm93bkxlbmd0aFN0cmVhbSwgc3luY0NvcHk6IHN5bmNDb3B5KSwgZGF0YSB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBBIHN0cmVhbSB0aGF0IHByb3ZpZGVzIHRoZSBkYXRhIHN5bmNocm9ub3VzbHkgYW5kIGhhcyBhbiB1bmtub3duIGxlbmd0aA0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBzeW5jVW5rbm93bkxlbmd0aFN0cmVhbU9mZnNldCA9IDA7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGdW5jPGJ5dGVbXSwgaW50LCBpbnQsIGludD4gcmVhZEZ1bmMgPSAoYnVmZmVyLCBvZmZzZXQsIGNvdW50KSA9Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGJ5dGVzUmVtYWluaW5nID0gZGF0YS5MZW5ndGggLSBzeW5jVW5rbm93bkxlbmd0aFN0cmVhbU9mZnNldDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGJ5dGVzVG9Db3B5ID0gTWF0aC5NaW4oYnl0ZXNSZW1haW5pbmcsIGNvdW50KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXkuQ29weShkYXRhLCBzeW5jVW5rbm93bkxlbmd0aFN0cmVhbU9mZnNldCwgYnVmZmVyLCBvZmZzZXQsIGJ5dGVzVG9Db3B5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3luY1Vua25vd25MZW5ndGhTdHJlYW1PZmZzZXQgKz0gYnl0ZXNUb0NvcHk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBieXRlc1RvQ29weTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN5bmNVbmtub3duTGVuZ3RoU3RyZWFtID0gbmV3IERlbGVnYXRlU3RyZWFtKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5SZWFkRnVuYzogKCkgPT4gdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuU2Vla0Z1bmM6ICgpID0+IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkRnVuYzogcmVhZEZ1bmMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRBc3luY0Z1bmM6IChidWZmZXIsIG9mZnNldCwgY291bnQsIHRva2VuKSA9PiBUYXNrLkZyb21SZXN1bHQocmVhZEZ1bmMoYnVmZmVyLCBvZmZzZXQsIGNvdW50KSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyBzZXJ2ZXIsIG5ldyBTdHJlYW1Db250ZW50V2l0aFN5bmNBc3luY0NvcHkoc3luY1Vua25vd25MZW5ndGhTdHJlYW0sIHN5bmNDb3B5OiBzeW5jQ29weSksIGRhdGEgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQSBzdHJlYW0gdGhhdCBwcm92aWRlcyB0aGUgZGF0YSBhc3luY2hyb25vdXNseQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBhc3luY1N0cmVhbU9mZnNldCA9IDAsIG1heERhdGFQZXJSZWFkID0gMTAwOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuYzxieXRlW10sIGludCwgaW50LCBpbnQ+IHJlYWRGdW5jID0gKGJ1ZmZlciwgb2Zmc2V0LCBjb3VudCkgPT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBieXRlc1JlbWFpbmluZyA9IGRhdGEuTGVuZ3RoIC0gYXN5bmNTdHJlYW1PZmZzZXQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBieXRlc1RvQ29weSA9IE1hdGguTWluKGJ5dGVzUmVtYWluaW5nLCBNYXRoLk1pbihtYXhEYXRhUGVyUmVhZCwgY291bnQpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXkuQ29weShkYXRhLCBhc3luY1N0cmVhbU9mZnNldCwgYnVmZmVyLCBvZmZzZXQsIGJ5dGVzVG9Db3B5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmNTdHJlYW1PZmZzZXQgKz0gYnl0ZXNUb0NvcHk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBieXRlc1RvQ29weTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jU3RyZWFtID0gbmV3IERlbGVnYXRlU3RyZWFtKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5SZWFkRnVuYzogKCkgPT4gdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuU2Vla0Z1bmM6ICgpID0+IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkRnVuYzogcmVhZEZ1bmMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRBc3luY0Z1bmM6IGFzeW5jIChidWZmZXIsIG9mZnNldCwgY291bnQsIHRva2VuKSA9Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRlbGF5KDEpLkNvbmZpZ3VyZUF3YWl0KGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWFkRnVuYyhidWZmZXIsIG9mZnNldCwgY291bnQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgc2VydmVyLCBuZXcgU3RyZWFtQ29udGVudFdpdGhTeW5jQXN5bmNDb3B5KGFzeW5jU3RyZWFtLCBzeW5jQ29weTogc3luY0NvcHkpLCBkYXRhIH07DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByb3ZpZGluZyBkYXRhIGZyb20gYSBGb3JtVXJsRW5jb2RlZENvbnRlbnQncyBzdHJlYW0NCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybUNvbnRlbnQgPSBuZXcgRm9ybVVybEVuY29kZWRDb250ZW50KG5ld1tdIHsgbmV3IEtleVZhbHVlUGFpcjxzdHJpbmcsIHN0cmluZz4oImtleSIsICJ2YWwiKSB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgc2VydmVyLCBmb3JtQ29udGVudCwgRW5jb2RpbmcuR2V0RW5jb2RpbmcoImlzby04ODU5LTEiKS5HZXRCeXRlcygia2V5PXZhbCIpIH07DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihFY2hvU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0QXN5bmNfQ2FsbE1ldGhvZF9OdWxsQ29udGVudChVcmkgcmVtb3RlU2VydmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuUG9zdEFzeW5jKHJlbW90ZVNlcnZlciwgbnVsbCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KDQogICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHJlc3BvbnNlQ29udGVudCk7DQogICAgICAgICAgICAgICAgICAgIFRlc3RIZWxwZXIuVmVyaWZ5UmVzcG9uc2VCb2R5KA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDb250ZW50LA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRNRDUsDQogICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZy5FbXB0eSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKEVjaG9TZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RBc3luY19DYWxsTWV0aG9kX0VtcHR5Q29udGVudChVcmkgcmVtb3RlU2VydmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBuZXcgU3RyaW5nQ29udGVudChzdHJpbmcuRW1wdHkpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlBvc3RBc3luYyhyZW1vdGVTZXJ2ZXIsIGNvbnRlbnQpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCg0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2VDb250ZW50ID0gYXdhaXQgcmVzcG9uc2UuQ29udGVudC5SZWFkQXNTdHJpbmdBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShyZXNwb25zZUNvbnRlbnQpOw0KICAgICAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlc3BvbnNlQm9keSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29udGVudCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLkNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1LA0KICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcuRW1wdHkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YShmYWxzZSwgIjEuMCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSh0cnVlLCAiMS4wIildDQogICAgICAgIFtJbmxpbmVEYXRhKG51bGwsICIxLjAiKV0NCiAgICAgICAgW0lubGluZURhdGEoZmFsc2UsICIxLjEiKV0NCiAgICAgICAgW0lubGluZURhdGEodHJ1ZSwgIjEuMSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShudWxsLCAiMS4xIildDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RBc3luY19FeHBlY3RDb250aW51ZV9TdWNjZXNzKGJvb2w/IGV4cGVjdENvbnRpbnVlLCBzdHJpbmcgdmVyc2lvbikNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXEgPSBuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuUG9zdCwgQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBDb250ZW50ID0gbmV3IFN0cmluZ0NvbnRlbnQoIlRlc3QgU3RyaW5nIiwgRW5jb2RpbmcuVVRGOCkNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIHJlcS5IZWFkZXJzLkV4cGVjdENvbnRpbnVlID0gZXhwZWN0Q29udGludWU7DQogICAgICAgICAgICAgICAgcmVxLlZlcnNpb24gPSBuZXcgVmVyc2lvbih2ZXJzaW9uKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlNlbmRBc3luYyhyZXEpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKFVzZVNvY2tldHNIdHRwSGFuZGxlcikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nIEV4cGVjdGVkUmVxSGVhZGVyID0gIlwiRXhwZWN0XCI6IFwiMTAwLWNvbnRpbnVlXCIiOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4cGVjdENvbnRpbnVlID09IHRydWUgJiYgdmVyc2lvbiA9PSAiMS4xIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoRXhwZWN0ZWRSZXFIZWFkZXIsIGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkRvZXNOb3RDb250YWluKEV4cGVjdGVkUmVxSGVhZGVyLCBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoZmFsc2UpXQ0KICAgICAgICBbSW5saW5lRGF0YSh0cnVlKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUG9zdEFzeW5jX1Rocm93RnJvbUNvbnRlbnRDb3B5X1JlcXVlc3RGYWlscyhib29sIHN5bmNGYWlsdXJlKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmkpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVGFzayByZXNwb25zZVRhc2sgPSBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24gPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciBidWZmZXIgPSBuZXcgYnl0ZVsxMDAwXTsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGF3YWl0IGNvbm5lY3Rpb24uU29ja2V0LlJlY2VpdmVBc3luYyhuZXcgQXJyYXlTZWdtZW50PGJ5dGU+KGJ1ZmZlciwgMCwgYnVmZmVyLkxlbmd0aCksIFNvY2tldEZsYWdzLk5vbmUpICE9IDApOw0KICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBFeGNlcHRpb24gZXJyb3IgPSBuZXcgRm9ybWF0RXhjZXB0aW9uKCk7DQogICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gbmV3IFN0cmVhbUNvbnRlbnQobmV3IERlbGVnYXRlU3RyZWFtKA0KICAgICAgICAgICAgICAgICAgICAgICAgY2FuU2Vla0Z1bmM6ICgpID0+IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGhGdW5jOiAoKSA9PiAxMjM0NTY3OCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uR2V0RnVuYzogKCkgPT4gMCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhblJlYWRGdW5jOiAoKSA9PiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZEFzeW5jRnVuYzogKGJ1ZmZlciwgb2Zmc2V0LCBjb3VudCwgY2FuY2VsbGF0aW9uVG9rZW4pID0+IHN5bmNGYWlsdXJlID8gdGhyb3cgZXJyb3IgOiBUYXNrLkRlbGF5KDEpLkNvbnRpbnVlV2l0aDxpbnQ+KF8gPT4gdGhyb3cgZXJyb3IpKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKFBsYXRmb3JtRGV0ZWN0aW9uLklzVWFwKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBIdHRwUmVxdWVzdEV4Y2VwdGlvbiByZXF1ZXN0RXhjZXB0aW9uID0gYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEh0dHBSZXF1ZXN0RXhjZXB0aW9uPigoKSA9PiBjbGllbnQuUG9zdEFzeW5jKHVyaSwgY29udGVudCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlNhbWUoZXJyb3IsIHJlcXVlc3RFeGNlcHRpb24uSW5uZXJFeGNlcHRpb24pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlNhbWUoZXJyb3IsIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxGb3JtYXRFeGNlcHRpb24+KCgpID0+IGNsaWVudC5Qb3N0QXN5bmModXJpLCBjb250ZW50KSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoZmFsc2UpXQ0KICAgICAgICBbSW5saW5lRGF0YSh0cnVlKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUG9zdEFzeW5jX1JlZGlyZWN0X1Jlc3VsdGluZ0dldEZvcm1hdHRlZENvcnJlY3RseShib29sIHNlY3VyZSkNCiAgICAgICAgew0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIENvbnRlbnRTdHJpbmcgPSAiVGhpcyBpcyB0aGUgY29udGVudCBzdHJpbmcuIjsNCiAgICAgICAgICAgIHZhciBjb250ZW50ID0gbmV3IFN0cmluZ0NvbnRlbnQoQ29udGVudFN0cmluZyk7DQogICAgICAgICAgICBVcmkgcmVkaXJlY3RVcmkgPSBDb25maWd1cmF0aW9uLkh0dHAuUmVkaXJlY3RVcmlGb3JEZXN0aW5hdGlvblVyaSgNCiAgICAgICAgICAgICAgICBzZWN1cmUsDQogICAgICAgICAgICAgICAgMzAyLA0KICAgICAgICAgICAgICAgIHNlY3VyZSA/IENvbmZpZ3VyYXRpb24uSHR0cC5TZWN1cmVSZW1vdGVFY2hvU2VydmVyIDogQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIsDQogICAgICAgICAgICAgICAgMSk7DQoNCiAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlBvc3RBc3luYyhyZWRpcmVjdFVyaSwgY29udGVudCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2VDb250ZW50ID0gYXdhaXQgcmVzcG9uc2UuQ29udGVudC5SZWFkQXNTdHJpbmdBc3luYygpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Eb2VzTm90Q29udGFpbihDb250ZW50U3RyaW5nLCByZXNwb25zZUNvbnRlbnQpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Eb2VzTm90Q29udGFpbigiQ29udGVudC1MZW5ndGgiLCByZXNwb25zZUNvbnRlbnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0FjdGl2ZUlzc3VlKDIzNzY4KV0NCiAgICAgICAgW0FjdGl2ZUlzc3VlKDIyMTkxLCBUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXApXQ0KICAgICAgICBbT3V0ZXJMb29wXSAvLyB0YWtlcyBzZXZlcmFsIHNlY29uZHMNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RBc3luY19SZWRpcmVjdFdpdGgzMDdfTGFyZ2VQYXlsb2FkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgUG9zdEFzeW5jX1JlZGlyZWN0X0xhcmdlUGF5bG9hZF9IZWxwZXIoMzA3LCB0cnVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIHRha2VzIHNldmVyYWwgc2Vjb25kcw0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUG9zdEFzeW5jX1JlZGlyZWN0V2l0aDMwMl9MYXJnZVBheWxvYWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBQb3N0QXN5bmNfUmVkaXJlY3RfTGFyZ2VQYXlsb2FkX0hlbHBlcigzMDIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RBc3luY19SZWRpcmVjdF9MYXJnZVBheWxvYWRfSGVscGVyKGludCBzdGF0dXNDb2RlLCBib29sIGV4cGVjdFJlZGlyZWN0VG9Qb3N0KQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGZzID0gbmV3IEZpbGVTdHJlYW0oUGF0aC5Db21iaW5lKFBhdGguR2V0VGVtcFBhdGgoKSwgUGF0aC5HZXRUZW1wRmlsZU5hbWUoKSksIEZpbGVNb2RlLkNyZWF0ZSwgRmlsZUFjY2Vzcy5SZWFkV3JpdGUsIEZpbGVTaGFyZS5Ob25lLCAweDEwMDAsIEZpbGVPcHRpb25zLkRlbGV0ZU9uQ2xvc2UpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBjb250ZW50U3RyaW5nID0gc3RyaW5nLkpvaW4oIiIsIEVudW1lcmFibGUuUmVwZWF0KCJDb250ZW50IiwgMTAwMDAwKSk7DQogICAgICAgICAgICAgICAgYnl0ZVtdIGNvbnRlbnRCeXRlcyA9IEVuY29kaW5nLlVURjMyLkdldEJ5dGVzKGNvbnRlbnRTdHJpbmcpOw0KICAgICAgICAgICAgICAgIGZzLldyaXRlKGNvbnRlbnRCeXRlcywgMCwgY29udGVudEJ5dGVzLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgZnMuRmx1c2goZmx1c2hUb0Rpc2s6IHRydWUpOw0KICAgICAgICAgICAgICAgIGZzLlBvc2l0aW9uID0gMDsNCg0KICAgICAgICAgICAgICAgIFVyaSByZWRpcmVjdFVyaSA9IENvbmZpZ3VyYXRpb24uSHR0cC5SZWRpcmVjdFVyaUZvckRlc3RpbmF0aW9uVXJpKGZhbHNlLCBzdGF0dXNDb2RlLCBDb25maWd1cmF0aW9uLkh0dHAuU2VjdXJlUmVtb3RlRWNob1NlcnZlciwgMSk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuUG9zdEFzeW5jKHJlZGlyZWN0VXJpLCBuZXcgU3RyZWFtQ29udGVudChmcykpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGV4cGVjdFJlZGlyZWN0VG9Qb3N0KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuSW5SYW5nZShyZXNwb25zZS5Db250ZW50LkhlYWRlcnMuQ29udGVudExlbmd0aC5HZXRWYWx1ZU9yRGVmYXVsdCgpLCBjb250ZW50Qnl0ZXMuTGVuZ3RoLCBpbnQuTWF4VmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKEVjaG9TZXJ2ZXJzKSldIC8vIE5PVEU6IHdpbGwgbm90IHdvcmsgZm9yIGluLWJveCBTeXN0ZW0uTmV0Lkh0dHAuZGxsIGR1ZSB0byBkaXNwb3NhbCBvZiByZXF1ZXN0IGNvbnRlbnQNCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUG9zdEFzeW5jX1JldXNlUmVxdWVzdENvbnRlbnRfU3VjY2VzcyhVcmkgcmVtb3RlU2VydmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBjb25zdCBzdHJpbmcgQ29udGVudFN0cmluZyA9ICJUaGlzIGlzIHRoZSBjb250ZW50IHN0cmluZy4iOw0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gbmV3IFN0cmluZ0NvbnRlbnQoQ29udGVudFN0cmluZyk7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAyOyBpKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5Qb3N0QXN5bmMocmVtb3RlU2VydmVyLCBjb250ZW50KSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhDb250ZW50U3RyaW5nLCBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKEh0dHBTdGF0dXNDb2RlLk1ldGhvZE5vdEFsbG93ZWQsICJDdXN0b20gZGVzY3JpcHRpb24iKV0NCiAgICAgICAgW0lubGluZURhdGEoSHR0cFN0YXR1c0NvZGUuTWV0aG9kTm90QWxsb3dlZCwgIiIpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19DYWxsTWV0aG9kX0V4cGVjdGVkU3RhdHVzTGluZShIdHRwU3RhdHVzQ29kZSBzdGF0dXNDb2RlLCBzdHJpbmcgcmVhc29uUGhyYXNlKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmMoQ29uZmlndXJhdGlvbi5IdHRwLlN0YXR1c0NvZGVVcmkoDQogICAgICAgICAgICAgICAgICAgIGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAoaW50KXN0YXR1c0NvZGUsDQogICAgICAgICAgICAgICAgICAgIHJlYXNvblBocmFzZSkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHN0YXR1c0NvZGUsIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwocmVhc29uUGhyYXNlLCByZXNwb25zZS5SZWFzb25QaHJhc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgICNlbmRyZWdpb24NCg0KICAgICAgICAjcmVnaW9uIFZhcmlvdXMgSFRUUCBNZXRob2QgVGVzdHMNCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoSHR0cE1ldGhvZHMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgU2VuZEFzeW5jX1NlbmRSZXF1ZXN0VXNpbmdNZXRob2RUb0VjaG9TZXJ2ZXJXaXRoTm9Db250ZW50X01ldGhvZENvcnJlY3RseVNlbnQoDQogICAgICAgICAgICBzdHJpbmcgbWV0aG9kLA0KICAgICAgICAgICAgYm9vbCBzZWN1cmVTZXJ2ZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UoDQogICAgICAgICAgICAgICAgICAgIG5ldyBIdHRwTWV0aG9kKG1ldGhvZCksDQogICAgICAgICAgICAgICAgICAgIHNlY3VyZVNlcnZlciA/IENvbmZpZ3VyYXRpb24uSHR0cC5TZWN1cmVSZW1vdGVFY2hvU2VydmVyIDogQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIpOw0KDQogICAgICAgICAgICAgICAgaWYgKFBsYXRmb3JtRGV0ZWN0aW9uLklzVWFwICYmIG1ldGhvZCA9PSAiVFJBQ0UiKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgSHR0cFJlcXVlc3RFeGNlcHRpb24gZXggPSBhd2FpdCBBc3NlcnQuVGhyb3dzQXN5bmM8SHR0cFJlcXVlc3RFeGNlcHRpb24+KCgpID0+IGNsaWVudC5TZW5kQXN5bmMocmVxdWVzdCkpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuSXNUeXBlPFBsYXRmb3JtTm90U3VwcG9ydGVkRXhjZXB0aW9uPihleC5Jbm5lckV4Y2VwdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlNlbmRBc3luYyhyZXF1ZXN0KSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RIZWxwZXIuVmVyaWZ5UmVxdWVzdE1ldGhvZChyZXNwb25zZSwgbWV0aG9kKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihIdHRwTWV0aG9kc1RoYXRBbGxvd0NvbnRlbnQpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgU2VuZEFzeW5jX1NlbmRSZXF1ZXN0VXNpbmdNZXRob2RUb0VjaG9TZXJ2ZXJXaXRoQ29udGVudF9TdWNjZXNzKA0KICAgICAgICAgICAgc3RyaW5nIG1ldGhvZCwNCiAgICAgICAgICAgIGJvb2wgc2VjdXJlU2VydmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoUGxhdGZvcm1EZXRlY3Rpb24uSXNGdWxsRnJhbWV3b3JrICYmIG1ldGhvZCA9PSAiR0VUIikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyAuTkVUIEZyYW1ld29yayBkb2Vzbid0IGFsbG93IGEgY29udGVudCBib2R5IHdpdGggdGhpcyBIVFRQIHZlcmIuDQogICAgICAgICAgICAgICAgLy8gSXQgd2lsbCB0aHJvdyBhIFN5c3RlbS5OZXQuUHJvdG9jb2xWaW9sYXRpb24gZXhjZXB0aW9uLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZSgNCiAgICAgICAgICAgICAgICAgICAgbmV3IEh0dHBNZXRob2QobWV0aG9kKSwNCiAgICAgICAgICAgICAgICAgICAgc2VjdXJlU2VydmVyID8gQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZVJlbW90ZUVjaG9TZXJ2ZXIgOiBDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlcik7DQogICAgICAgICAgICAgICAgcmVxdWVzdC5Db250ZW50ID0gbmV3IFN0cmluZ0NvbnRlbnQoRXhwZWN0ZWRDb250ZW50KTsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5TZW5kQXN5bmMocmVxdWVzdCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlcXVlc3RNZXRob2QocmVzcG9uc2UsIG1ldGhvZCk7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHJlc3BvbnNlQ29udGVudCk7DQoNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCQiXCJDb250ZW50LUxlbmd0aFwiOiBcIntyZXF1ZXN0LkNvbnRlbnQuSGVhZGVycy5Db250ZW50TGVuZ3RoLlZhbHVlfVwiIiwgcmVzcG9uc2VDb250ZW50KTsNCiAgICAgICAgICAgICAgICAgICAgVGVzdEhlbHBlci5WZXJpZnlSZXNwb25zZUJvZHkoDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvbnRlbnQsDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5Db250ZW50LkhlYWRlcnMuQ29udGVudE1ENSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgRXhwZWN0ZWRDb250ZW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbQWN0aXZlSXNzdWUoMjAwMTAsIFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCldIC8vIFRlc3QgaGFuZ3MuIEJ1dCB0aGlzIHRlc3Qgc2VlbXMgaW52YWxpZC4gQW4gSHR0cFJlcXVlc3RNZXNzYWdlIGNhbiBvbmx5IGJlIHNlbnQgb25jZS4NCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKCIxMjM0NTY3ODkxMCIsIDApXQ0KICAgICAgICBbSW5saW5lRGF0YSgiMTIzNDU2Nzg5MTAiLCA1KV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgU2VuZEFzeW5jX1NlbmRTYW1lUmVxdWVzdE11bHRpcGxlVGltZXNEaXJlY3RseU9uSGFuZGxlcl9TdWNjZXNzKHN0cmluZyBzdHJpbmdDb250ZW50LCBpbnQgc3RhcnRpbmdQb3NpdGlvbikNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IEh0dHBNZXNzYWdlSW52b2tlcihDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBieXRlW10gYnl0ZUNvbnRlbnQgPSBFbmNvZGluZy5BU0NJSS5HZXRCeXRlcyhzdHJpbmdDb250ZW50KTsNCiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IG5ldyBNZW1vcnlTdHJlYW0oKTsNCiAgICAgICAgICAgICAgICBjb250ZW50LldyaXRlKGJ5dGVDb250ZW50LCAwLCBieXRlQ29udGVudC5MZW5ndGgpOw0KICAgICAgICAgICAgICAgIGNvbnRlbnQuUG9zaXRpb24gPSBzdGFydGluZ1Bvc2l0aW9uOw0KICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLlBvc3QsIENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyKSB7IENvbnRlbnQgPSBuZXcgU3RyZWFtQ29udGVudChjb250ZW50KSB9Ow0KDQogICAgICAgICAgICAgICAgZm9yIChpbnQgaXRlciA9IDA7IGl0ZXIgPCAyOyBpdGVyKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGhhbmRsZXIuU2VuZEFzeW5jKHJlcXVlc3QsIENhbmNlbGxhdGlvblRva2VuLk5vbmUpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2VDb250ZW50ID0gYXdhaXQgcmVzcG9uc2UuQ29udGVudC5SZWFkQXNTdHJpbmdBc3luYygpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoJCJcIkNvbnRlbnQtTGVuZ3RoXCI6IFwie3JlcXVlc3QuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRMZW5ndGguVmFsdWV9XCIiLCByZXNwb25zZUNvbnRlbnQpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoc3RyaW5nQ29udGVudC5TdWJzdHJpbmcoc3RhcnRpbmdQb3NpdGlvbiksIHJlc3BvbnNlQ29udGVudCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnRpbmdQb3NpdGlvbiAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5Eb2VzTm90Q29udGFpbihzdHJpbmdDb250ZW50LlN1YnN0cmluZygwLCBzdGFydGluZ1Bvc2l0aW9uKSwgcmVzcG9uc2VDb250ZW50KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihIdHRwTWV0aG9kc1RoYXREb250QWxsb3dDb250ZW50KSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRBc3luY19TZW5kUmVxdWVzdFVzaW5nTm9Cb2R5TWV0aG9kVG9FY2hvU2VydmVyV2l0aENvbnRlbnRfTm9Cb2R5U2VudCgNCiAgICAgICAgICAgIHN0cmluZyBtZXRob2QsDQogICAgICAgICAgICBib29sIHNlY3VyZVNlcnZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFBsYXRmb3JtRGV0ZWN0aW9uLklzRnVsbEZyYW1ld29yayAmJiBtZXRob2QgPT0gIkhFQUQiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIC5ORVQgRnJhbWV3b3JrIGRvZXNuJ3QgYWxsb3cgYSBjb250ZW50IGJvZHkgd2l0aCB0aGlzIEhUVFAgdmVyYi4NCiAgICAgICAgICAgICAgICAvLyBJdCB3aWxsIHRocm93IGEgU3lzdGVtLk5ldC5Qcm90b2NvbFZpb2xhdGlvbiBleGNlcHRpb24uDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoUGxhdGZvcm1EZXRlY3Rpb24uSXNVYXAgJiYgbWV0aG9kID09ICJUUkFDRSIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVUFQIHBsYXRmb3JtIGRvZXNuJ3QgYWxsb3cgYSBjb250ZW50IGJvZHkgd2l0aCB0aGlzIEhUVFAgdmVyYi4NCiAgICAgICAgICAgICAgICAvLyBJdCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbiBIdHRwUmVxdWVzdEV4Y2VwdGlvbi9DT01FeGNlcHRpb24NCiAgICAgICAgICAgICAgICAvLyB3aXRoICJUaGUgcmVxdWVzdGVkIG9wZXJhdGlvbiBpcyBpbnZhbGlkIiBtZXNzYWdlLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZSgNCiAgICAgICAgICAgICAgICAgICAgbmV3IEh0dHBNZXRob2QobWV0aG9kKSwNCiAgICAgICAgICAgICAgICAgICAgc2VjdXJlU2VydmVyID8gQ29uZmlndXJhdGlvbi5IdHRwLlNlY3VyZVJlbW90ZUVjaG9TZXJ2ZXIgOiBDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlcikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENvbnRlbnQgPSBuZXcgU3RyaW5nQ29udGVudChFeHBlY3RlZENvbnRlbnQpDQogICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlNlbmRBc3luYyhyZXF1ZXN0KSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChtZXRob2QgPT0gIlRSQUNFIiAmJiAoUnVudGltZUluZm9ybWF0aW9uLklzT1NQbGF0Zm9ybShPU1BsYXRmb3JtLldpbmRvd3MpIHx8IFVzZVNvY2tldHNIdHRwSGFuZGxlcikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC5ORVQgRnJhbWV3b3JrIGFsc28gYWxsb3dzIHRoZSBIdHRwV2ViUmVxdWVzdCBhbmQgSHR0cENsaWVudCBBUElzIHRvIHNlbmQgYSByZXF1ZXN0IHVzaW5nICdUUkFDRScgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyB2ZXJiIGFuZCBhIHJlcXVlc3QgYm9keS4gVGhlIHVzdWFsIHJlc3BvbnNlIGZyb20gYSBzZXJ2ZXIgaXMgIjQwMCBCYWQgUmVxdWVzdCIuDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZWUgaGVyZSBmb3IgbW9yZSBpbmZvOiBodHRwczovL2dpdGh1Yi5jb20vZG90bmV0L2NvcmVmeC9pc3N1ZXMvOTAyMw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLkJhZFJlcXVlc3QsIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RIZWxwZXIuVmVyaWZ5UmVxdWVzdE1ldGhvZChyZXNwb25zZSwgbWV0aG9kKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UocmVzcG9uc2VDb250ZW50LkNvbnRhaW5zKEV4cGVjdGVkQ29udGVudCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICNlbmRyZWdpb24NCg0KICAgICAgICAjcmVnaW9uIFZlcnNpb24gdGVzdHMNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXAsICJVQVAgZG9lcyBub3QgYWxsb3cgSFRUUC8xLjAgcmVxdWVzdHMuIildDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgU2VuZEFzeW5jX1JlcXVlc3RWZXJzaW9uMTBfU2VydmVyUmVjZWl2ZXNWZXJzaW9uMTBSZXF1ZXN0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgVmVyc2lvbiByZWNlaXZlZFJlcXVlc3RWZXJzaW9uID0gYXdhaXQgU2VuZFJlcXVlc3RBbmRHZXRSZXF1ZXN0VmVyc2lvbkFzeW5jKG5ldyBWZXJzaW9uKDEsIDApKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChuZXcgVmVyc2lvbigxLCAwKSwgcmVjZWl2ZWRSZXF1ZXN0VmVyc2lvbik7DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRBc3luY19SZXF1ZXN0VmVyc2lvbjExX1NlcnZlclJlY2VpdmVzVmVyc2lvbjExUmVxdWVzdCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFZlcnNpb24gcmVjZWl2ZWRSZXF1ZXN0VmVyc2lvbiA9IGF3YWl0IFNlbmRSZXF1ZXN0QW5kR2V0UmVxdWVzdFZlcnNpb25Bc3luYyhuZXcgVmVyc2lvbigxLCAxKSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwobmV3IFZlcnNpb24oMSwgMSksIHJlY2VpdmVkUmVxdWVzdFZlcnNpb24pOw0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJUaHJvd3MgZXhjZXB0aW9uIHNlbmRpbmcgcmVxdWVzdCB1c2luZyBWZXJzaW9uKDAsMCkiKV0NCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTZW5kQXN5bmNfUmVxdWVzdFZlcnNpb25Ob3RTcGVjaWZpZWRfU2VydmVyUmVjZWl2ZXNWZXJzaW9uMTFSZXF1ZXN0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gU29ja2V0c0h0dHBIYW5kbGVyIHRyZWF0cyAwLjAgYXMgYSBiYWQgdmVyc2lvbiwgYW5kIHRocm93cy4NCiAgICAgICAgICAgIGlmIChVc2VTb2NrZXRzSHR0cEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCB2YWx1ZSBmb3IgSHR0cFJlcXVlc3RNZXNzYWdlLlZlcnNpb24gaXMgVmVyc2lvbigxLDEpLg0KICAgICAgICAgICAgLy8gU28sIHdlIG5lZWQgdG8gc2V0IHNvbWV0aGluZyBkaWZmZXJlbnQgKDAsMCksIHRvIHRlc3QgdGhlICJ1bmtub3duIiB2ZXJzaW9uLg0KICAgICAgICAgICAgVmVyc2lvbiByZWNlaXZlZFJlcXVlc3RWZXJzaW9uID0gYXdhaXQgU2VuZFJlcXVlc3RBbmRHZXRSZXF1ZXN0VmVyc2lvbkFzeW5jKG5ldyBWZXJzaW9uKDAsIDApKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChuZXcgVmVyc2lvbigxLCAxKSwgcmVjZWl2ZWRSZXF1ZXN0VmVyc2lvbik7DQogICAgICAgIH0NCg0KICAgICAgICBbQWN0aXZlSXNzdWUoMjMwMzcsIFRlc3RQbGF0Zm9ybXMuQW55VW5peCldDQogICAgICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiU3BlY2lmeWluZyBWZXJzaW9uKDIsMCkgdGhyb3dzIGV4Y2VwdGlvbiBvbiBuZXRmeCIpXQ0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKEh0dHAyU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTZW5kQXN5bmNfUmVxdWVzdFZlcnNpb24yMF9SZXNwb25zZVZlcnNpb24yMElmSHR0cDJTdXBwb3J0ZWQoVXJpIHNlcnZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFBsYXRmb3JtRGV0ZWN0aW9uLklzV2luZG93cyAmJiAhUGxhdGZvcm1EZXRlY3Rpb24uSXNXaW5kb3dzMTBWZXJzaW9uMTcwM09yR3JlYXRlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBTa2lwIHRoaXMgdGVzdCBpZiBydW5uaW5nIG9uIFdpbmRvd3MgYnV0IG9uIGEgcmVsZWFzZSBwcmlvciB0byBXaW5kb3dzIDEwIENyZWF0b3JzIFVwZGF0ZS4NCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiU2tpcHBpbmcgdGVzdCBkdWUgdG8gV2luZG93cyAxMCB2ZXJzaW9uIHByaW9yIHRvIFZlcnNpb24gMTcwMy4iKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoVXNlU29ja2V0c0h0dHBIYW5kbGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFRPRE8gIzIzMTM0OiBTb2NrZXRzSHR0cEhhbmRsZXIgZG9lc24ndCB5ZXQgc3VwcG9ydCBIVFRQLzIuDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBXZSBkb24ndCBjdXJyZW50bHkgaGF2ZSBhIGdvb2Qgd2F5IHRvIHRlc3Qgd2hldGhlciBIVFRQLzIgaXMgc3VwcG9ydGVkIHdpdGhvdXQNCiAgICAgICAgICAgIC8vIHVzaW5nIHRoZSBzYW1lIG1lY2hhbmlzbSB3ZSdyZSB0cnlpbmcgdG8gdGVzdCwgc28gZm9yIG5vdyB3ZSBhbGxvdyBib3RoIDIuMCBhbmQgMS4xIHJlc3BvbnNlcy4NCiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLkdldCwgc2VydmVyKTsNCiAgICAgICAgICAgIHJlcXVlc3QuVmVyc2lvbiA9IG5ldyBWZXJzaW9uKDIsIDApOw0KDQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIsIGZhbHNlKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBJdCBpcyBnZW5lcmFsbHkgZXhwZWN0ZWQgdGhhdCB0aGUgdGVzdCBob3N0cyB3aWxsIGJlIHRydXN0ZWQsIHNvIHdlIGRvbid0IHJlZ2lzdGVyIGEgdmFsaWRhdGlvbg0KICAgICAgICAgICAgICAgIC8vIGNhbGxiYWNrIGluIHRoZSB1c3VhbCBjYXNlLg0KICAgICAgICAgICAgICAgIC8vIA0KICAgICAgICAgICAgICAgIC8vIEhvd2V2ZXIsIG9uIG91ciBEZWJpYW4gOCB0ZXN0IG1hY2hpbmVzLCBhIGNvbWJpbmF0aW9uIG9mIGEgc2VydmVyIHNpZGUgVExTIGNoYWluLA0KICAgICAgICAgICAgICAgIC8vIHRoZSBjbGllbnQgY2hhaW4gcHJvY2Vzc29yLCBhbmQgdGhlIGRpc3RyaWJ1dGlvbidzIENBIGJ1bmRsZSByZXN1bHRzIGluIGFuIGluY29tcGxldGUvdW50cnVzdGVkDQogICAgICAgICAgICAgICAgLy8gY2VydGlmaWNhdGUgY2hhaW4uIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZG90bmV0L2NvcmVmeC9pc3N1ZXMvOTI0NCBmb3IgbW9yZSBkZXRhaWxzLg0KICAgICAgICAgICAgICAgIGlmIChQbGF0Zm9ybURldGVjdGlvbi5Jc0RlYmlhbjgpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBGdW5jPEh0dHBSZXF1ZXN0TWVzc2FnZSwgWDUwOUNlcnRpZmljYXRlMiwgWDUwOUNoYWluLCBTc2xQb2xpY3lFcnJvcnMsIGJvb2w+DQogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuU2VydmVyQ2VydGlmaWNhdGVDdXN0b21WYWxpZGF0aW9uQ2FsbGJhY2sgPSAobXNnLCBjZXJ0LCBjaGFpbiwgZXJyb3JzKSA9Pg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuSW5SYW5nZShjaGFpbi5DaGFpblN0YXR1cy5MZW5ndGgsIDAsIDEpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hhaW4uQ2hhaW5TdGF0dXMuTGVuZ3RoID4gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoWDUwOUNoYWluU3RhdHVzRmxhZ3MuUGFydGlhbENoYWluLCBjaGFpbi5DaGFpblN0YXR1c1swXS5TdGF0dXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5TZW5kQXN5bmMocmVxdWVzdCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLlZlcnNpb24gPT0gbmV3IFZlcnNpb24oMiwgMCkgfHwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLlZlcnNpb24gPT0gbmV3IFZlcnNpb24oMSwgMSksDQogICAgICAgICAgICAgICAgICAgICAgICAiUmVzcG9uc2UgdmVyc2lvbiAiICsgcmVzcG9uc2UuVmVyc2lvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJTcGVjaWZ5aW5nIFZlcnNpb24oMiwwKSB0aHJvd3MgZXhjZXB0aW9uIG9uIG5ldGZ4IildDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTZW5kQXN5bmNfUmVxdWVzdFZlcnNpb24yMF9IdHRwTm90SHR0cHNfTm9VcGdyYWRlUmVxdWVzdCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIChhd2FpdCBjbGllbnQuU2VuZEFzeW5jKG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UoSHR0cE1ldGhvZC5HZXQsIHVyaSkgeyBWZXJzaW9uID0gbmV3IFZlcnNpb24oMiwgMCkgfSkpLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCBhc3luYyBzZXJ2ZXIgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gaGVhZGVycyA9IGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5BbGwoaGVhZGVycywgaGVhZGVyID0+IEFzc2VydC5Eb2VzTm90Q29udGFpbigiVXBncmFkZSIsIGhlYWRlciwgU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsSWdub3JlQ2FzZSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgIlNwZWNpZnlpbmcgVmVyc2lvbigyLDApIHRocm93cyBleGNlcHRpb24gb24gbmV0ZngiKV0NCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtDb25kaXRpb25hbFRoZW9yeShuYW1lb2YoSXNXaW5kb3dzMTBWZXJzaW9uMTYwN09yR3JlYXRlcikpLCBNZW1iZXJEYXRhKG5hbWVvZihIdHRwMk5vUHVzaFNlcnZlcnMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgU2VuZEFzeW5jX1JlcXVlc3RWZXJzaW9uMjBfUmVzcG9uc2VWZXJzaW9uMjAoVXJpIHNlcnZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFVzZVNvY2tldHNIdHRwSGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBUT0RPICMyMzEzNDogU29ja2V0c0h0dHBIYW5kbGVyIGRvZXNuJ3QgeWV0IHN1cHBvcnQgSFRUUC8yLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoc2VydmVyLkFic29sdXRlVXJpLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuR2V0LCBzZXJ2ZXIpOw0KICAgICAgICAgICAgcmVxdWVzdC5WZXJzaW9uID0gbmV3IFZlcnNpb24oMiwgMCk7DQoNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5TZW5kQXN5bmMocmVxdWVzdCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwobmV3IFZlcnNpb24oMiwgMCksIHJlc3BvbnNlLlZlcnNpb24pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYXN5bmMgVGFzazxWZXJzaW9uPiBTZW5kUmVxdWVzdEFuZEdldFJlcXVlc3RWZXJzaW9uQXN5bmMoVmVyc2lvbiByZXF1ZXN0VmVyc2lvbikNCiAgICAgICAgew0KICAgICAgICAgICAgVmVyc2lvbiByZWNlaXZlZFJlcXVlc3RWZXJzaW9uID0gbnVsbDsNCg0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLkdldCwgdXJsKTsNCiAgICAgICAgICAgICAgICByZXF1ZXN0LlZlcnNpb24gPSByZXF1ZXN0VmVyc2lvbjsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gZ2V0UmVzcG9uc2UgPSBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrPExpc3Q8c3RyaW5nPj4gc2VydmVyVGFzayA9IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChnZXRSZXNwb25zZSwgc2VydmVyVGFzayk7DQoNCiAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHJlY2VpdmVkUmVxdWVzdCA9IGF3YWl0IHNlcnZlclRhc2s7DQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgZ2V0UmVzcG9uc2UpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgc3RhdHVzTGluZSA9IHJlY2VpdmVkUmVxdWVzdFswXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1c0xpbmUuQ29udGFpbnMoIi8xLjAiKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWRSZXF1ZXN0VmVyc2lvbiA9IG5ldyBWZXJzaW9uKDEsIDApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHN0YXR1c0xpbmUuQ29udGFpbnMoIi8xLjEiKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWRSZXF1ZXN0VmVyc2lvbiA9IG5ldyBWZXJzaW9uKDEsIDEpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UsICJJbnZhbGlkIEhUVFAgcmVxdWVzdCB2ZXJzaW9uIik7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICByZXR1cm4gcmVjZWl2ZWRSZXF1ZXN0VmVyc2lvbjsNCiAgICAgICAgfQ0KICAgICAgICAjZW5kcmVnaW9uDQoNCiAgICAgICAgI3JlZ2lvbiBQcm94eSB0ZXN0cw0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCwgIlVBUCBkb2VzIG5vdCBzdXBwb3J0IGN1c3RvbSBwcm94aWVzLiIpXQ0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKENyZWRlbnRpYWxzRm9yUHJveHlSZmNDb21wbGlhbnQpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJveHlfQnlwYXNzRmFsc2VfR2V0UmVxdWVzdEdvZXNUaHJvdWdoQ3VzdG9tUHJveHlfUmZjQ29tcGxpYW50KElDcmVkZW50aWFscyBjcmVkcywgYm9vbCB3cmFwQ3JlZHNJbkNhY2hlKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBQcm94eV9CeXBhc3NGYWxzZV9HZXRSZXF1ZXN0R29lc1Rocm91Z2hDdXN0b21Qcm94eV9JbXBsZW1lbnRhdGlvbihjcmVkcywgd3JhcENyZWRzSW5DYWNoZSk7DQogICAgICAgIH0NCg0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCwgIlVBUCBkb2VzIG5vdCBzdXBwb3J0IGN1c3RvbSBwcm94aWVzLiIpXQ0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKENyZWRlbnRpYWxzRm9yUHJveHlOb25SZmNDb21wbGlhbnQpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJveHlfQnlwYXNzRmFsc2VfR2V0UmVxdWVzdEdvZXNUaHJvdWdoQ3VzdG9tUHJveHlfTm9uUmZjQ29tcGxpYW50KElDcmVkZW50aWFscyBjcmVkcywgYm9vbCB3cmFwQ3JlZHNJbkNhY2hlKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBQcm94eV9CeXBhc3NGYWxzZV9HZXRSZXF1ZXN0R29lc1Rocm91Z2hDdXN0b21Qcm94eV9JbXBsZW1lbnRhdGlvbihjcmVkcywgd3JhcENyZWRzSW5DYWNoZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGFzeW5jIFRhc2sgUHJveHlfQnlwYXNzRmFsc2VfR2V0UmVxdWVzdEdvZXNUaHJvdWdoQ3VzdG9tUHJveHlfSW1wbGVtZW50YXRpb24oSUNyZWRlbnRpYWxzIGNyZWRzLCBib29sIHdyYXBDcmVkc0luQ2FjaGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGludCBwb3J0Ow0KICAgICAgICAgICAgVGFzazxMb29wYmFja0dldFJlcXVlc3RIdHRwUHJveHkuUHJveHlSZXN1bHQ+IHByb3h5VGFzayA9IExvb3BiYWNrR2V0UmVxdWVzdEh0dHBQcm94eS5TdGFydEFzeW5jKA0KICAgICAgICAgICAgICAgIG91dCBwb3J0LA0KICAgICAgICAgICAgICAgIHJlcXVpcmVBdXRoOiBjcmVkcyAhPSBudWxsICYmIGNyZWRzICE9IENyZWRlbnRpYWxDYWNoZS5EZWZhdWx0Q3JlZGVudGlhbHMsDQogICAgICAgICAgICAgICAgZXhwZWN0Q3JlZHM6IHRydWUpOw0KICAgICAgICAgICAgVXJpIHByb3h5VXJsID0gbmV3IFVyaSgkImh0dHA6Ly9sb2NhbGhvc3Q6e3BvcnR9Iik7DQoNCiAgICAgICAgICAgIGNvbnN0IHN0cmluZyBCYXNpY0F1dGggPSAiQmFzaWMiOw0KICAgICAgICAgICAgaWYgKHdyYXBDcmVkc0luQ2FjaGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LklzQXNzaWduYWJsZUZyb208TmV0d29ya0NyZWRlbnRpYWw+KGNyZWRzKTsNCiAgICAgICAgICAgICAgICB2YXIgY2FjaGUgPSBuZXcgQ3JlZGVudGlhbENhY2hlKCk7DQogICAgICAgICAgICAgICAgY2FjaGUuQWRkKHByb3h5VXJsLCBCYXNpY0F1dGgsIChOZXR3b3JrQ3JlZGVudGlhbCljcmVkcyk7DQogICAgICAgICAgICAgICAgY3JlZHMgPSBjYWNoZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlByb3h5ID0gbmV3IFVzZVNwZWNpZmllZFVyaVdlYlByb3h5KHByb3h5VXJsLCBjcmVkcyk7DQoNCiAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IHJlc3BvbnNlVGFzayA9IGNsaWVudC5HZXRBc3luYyhDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlcik7DQogICAgICAgICAgICAgICAgVGFzazxzdHJpbmc+IHJlc3BvbnNlU3RyaW5nVGFzayA9IHJlc3BvbnNlVGFzay5Db250aW51ZVdpdGgodCA9PiB0LlJlc3VsdC5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCksIFRhc2tTY2hlZHVsZXIuRGVmYXVsdCkuVW53cmFwKCk7DQogICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQocHJveHlUYXNrLCByZXNwb25zZVRhc2ssIHJlc3BvbnNlU3RyaW5nVGFzayk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAocmVzcG9uc2VUYXNrLlJlc3VsdCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFRlc3RIZWxwZXIuVmVyaWZ5UmVzcG9uc2VCb2R5KHJlc3BvbnNlU3RyaW5nVGFzay5SZXN1bHQsIHJlc3BvbnNlVGFzay5SZXN1bHQuQ29udGVudC5IZWFkZXJzLkNvbnRlbnRNRDUsIGZhbHNlLCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEVuY29kaW5nLkFTQ0lJLkdldFN0cmluZyhwcm94eVRhc2suUmVzdWx0LlJlc3BvbnNlQ29udGVudCksIHJlc3BvbnNlU3RyaW5nVGFzay5SZXN1bHQpOw0KDQogICAgICAgICAgICAgICAgICAgIE5ldHdvcmtDcmVkZW50aWFsIG5jID0gY3JlZHM/LkdldENyZWRlbnRpYWwocHJveHlVcmwsIEJhc2ljQXV0aCk7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZEF1dGggPQ0KICAgICAgICAgICAgICAgICAgICAgICAgbmMgPT0gbnVsbCB8fCBuYyA9PSBDcmVkZW50aWFsQ2FjaGUuRGVmYXVsdENyZWRlbnRpYWxzID8gbnVsbCA6DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcuSXNOdWxsT3JFbXB0eShuYy5Eb21haW4pID8gJCJ7bmMuVXNlck5hbWV9OntuYy5QYXNzd29yZH0iIDoNCiAgICAgICAgICAgICAgICAgICAgICAgICQie25jLkRvbWFpbn1cXHtuYy5Vc2VyTmFtZX06e25jLlBhc3N3b3JkfSI7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChleHBlY3RlZEF1dGgsIHByb3h5VGFzay5SZXN1bHQuQXV0aGVudGljYXRpb25IZWFkZXJWYWx1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXAsICJVQVAgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gcHJveGllcy4iKV0NCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtNZW1iZXJEYXRhKG5hbWVvZihCeXBhc3NlZFByb3hpZXMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUHJveHlfQnlwYXNzVHJ1ZV9HZXRSZXF1ZXN0RG9lc250R29lc1Rocm91Z2hDdXN0b21Qcm94eShJV2ViUHJveHkgcHJveHkpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgaGFuZGxlci5Qcm94eSA9IHByb3h5Ow0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LkdldEFzeW5jKENvbmZpZ3VyYXRpb24uSHR0cC5SZW1vdGVFY2hvU2VydmVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlc3BvbnNlQm9keSgNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVzcG9uc2UuQ29udGVudC5SZWFkQXNTdHJpbmdBc3luYygpLA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5Db250ZW50LkhlYWRlcnMuQ29udGVudE1ENSwNCiAgICAgICAgICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5VYXAsICJVQVAgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gcHJveGllcy4iKV0NCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQcm94eV9IYXZlTm9DcmVkc0FuZFVzZUF1dGhlbnRpY2F0ZWRDdXN0b21Qcm94eV9Qcm94eUF1dGhlbnRpY2F0aW9uUmVxdWlyZWRTdGF0dXNDb2RlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaW50IHBvcnQ7DQogICAgICAgICAgICBUYXNrPExvb3BiYWNrR2V0UmVxdWVzdEh0dHBQcm94eS5Qcm94eVJlc3VsdD4gcHJveHlUYXNrID0gTG9vcGJhY2tHZXRSZXF1ZXN0SHR0cFByb3h5LlN0YXJ0QXN5bmMoDQogICAgICAgICAgICAgICAgb3V0IHBvcnQsDQogICAgICAgICAgICAgICAgcmVxdWlyZUF1dGg6IHRydWUsDQogICAgICAgICAgICAgICAgZXhwZWN0Q3JlZHM6IGZhbHNlKTsNCiAgICAgICAgICAgIFVyaSBwcm94eVVybCA9IG5ldyBVcmkoJCJodHRwOi8vbG9jYWxob3N0Ontwb3J0fSIpOw0KDQogICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgIGhhbmRsZXIuUHJveHkgPSBuZXcgVXNlU3BlY2lmaWVkVXJpV2ViUHJveHkocHJveHlVcmwsIG51bGwpOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IHJlc3BvbnNlVGFzayA9IGNsaWVudC5HZXRBc3luYyhDb25maWd1cmF0aW9uLkh0dHAuUmVtb3RlRWNob1NlcnZlcik7DQogICAgICAgICAgICAgICAgYXdhaXQgKG5ldyBUYXNrW10geyBwcm94eVRhc2ssIHJlc3BvbnNlVGFzayB9KS5XaGVuQWxsT3JBbnlGYWlsZWQoKTsNCiAgICAgICAgICAgICAgICB1c2luZyAocmVzcG9uc2VUYXNrLlJlc3VsdCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5Qcm94eUF1dGhlbnRpY2F0aW9uUmVxdWlyZWQsIHJlc3BvbnNlVGFzay5SZXN1bHQuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFByb3h5X1NzbFByb3h5VW5zdXBwb3J0ZWRfVGhyb3dzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlByb3h5ID0gbmV3IFdlYlByb3h5KCJodHRwczovLyIgKyBHdWlkLk5ld0d1aWQoKS5Ub1N0cmluZygiTiIpKTsNCg0KICAgICAgICAgICAgICAgIFR5cGUgZXhwZWN0ZWRUeXBlID0gSXNOZXRmeEhhbmRsZXIgfHwgVXNlU29ja2V0c0h0dHBIYW5kbGVyID8NCiAgICAgICAgICAgICAgICAgICAgdHlwZW9mKE5vdFN1cHBvcnRlZEV4Y2VwdGlvbikgOg0KICAgICAgICAgICAgICAgICAgICB0eXBlb2YoSHR0cFJlcXVlc3RFeGNlcHRpb24pOw0KDQogICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jKGV4cGVjdGVkVHlwZSwgKCkgPT4gY2xpZW50LkdldEFzeW5jKCJodHRwOi8vIiArIEd1aWQuTmV3R3VpZCgpLlRvU3RyaW5nKCJOIikpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuVWFwLCAiVUFQIGRvZXMgbm90IHN1cHBvcnQgY3VzdG9tIHByb3hpZXMuIildDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQcm94eV9Vc2VTZWN1cmVQcm94eVR1bm5lbF9TdWNjZXNzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzV2luSHR0cEhhbmRsZXIgfHwgSXNOZXRmeEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gSXNzdWUgIzI3NzQ2OiBXaW5IdHRwSGFuZGxlciBhbmQgbmV0ZnggaGFuZyBvbiB0aGlzIHRlc3QNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIExvb3BiYWNrU2VydmVyLk9wdGlvbnMgb3B0aW9ucyA9IG5ldyBMb29wYmFja1NlcnZlci5PcHRpb25zIHsgVXNlU3NsID0gdHJ1ZSB9Ow0KDQogICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBuZXcgVGNwTGlzdGVuZXIoSVBBZGRyZXNzLkxvb3BiYWNrLCAwKTsNCiAgICAgICAgICAgIGxpc3RlbmVyLlN0YXJ0KCk7DQogICAgICAgICAgICB2YXIgZXAgPSAoSVBFbmRQb2ludClsaXN0ZW5lci5TZXJ2ZXIuTG9jYWxFbmRQb2ludDsNCiAgICAgICAgICAgIFVyaSBwcm94eVVybCA9IG5ldyBVcmkoJCJodHRwOi8ve2VwLkFkZHJlc3N9OntlcC5Qb3J0fS8iKTsNCiAgICAgICAgICAgIC8vVE9ETyA6IHJlZmFjdG9yIG9uY2UgTG9vcGJhY2tHZXRSZXF1ZXN0SHR0cFByb3h5IGlzIG1lcmdlZCB3aXRoIExvcHBiYWNrU2VydmVyDQogICAgICAgICAgICBUYXNrIHByb3h5ID0gTG9vcGJhY2tHZXRSZXF1ZXN0SHR0cFByb3h5LlN0YXJ0QXN5bmMobGlzdGVuZXIsIGZhbHNlLCBmYWxzZSk7DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBUYXNrIHNlcnZlclRhc2sgPSBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24gPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uUmVhZFJlcXVlc3RIZWFkZXJBbmRTZW5kUmVzcG9uc2VBc3luYyhjb250ZW50OiAiT0tcclxuIik7DQogICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCkpew0KICAgICAgICAgICAgICAgICAgICAvLyBQb2ludCBoYW5kbGVyIGF0IG91dCBsb29wYmFjayBwcm94eQ0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLlByb3h5ID0gbmV3IFVzZVNwZWNpZmllZFVyaVdlYlByb3h5KHByb3h5VXJsLCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5TZXJ2ZXJDZXJ0aWZpY2F0ZUN1c3RvbVZhbGlkYXRpb25DYWxsYmFjayA9IFRlc3RIZWxwZXIuQWxsb3dBbGxDZXJ0aWZpY2F0ZXM7DQoNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKHJlc3BvbnNlLlN0YXR1c0NvZGUgPT0gIEh0dHBTdGF0dXNDb2RlLk9LKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgYXdhaXQgc2VydmVyVGFzazsNCiAgICAgICAgICAgIH0sIG9wdGlvbnMpOw0KICAgICAgICAgICAgYXdhaXQgcHJveHk7DQogICAgICAgIH0NCg0KICAgICAgICBbQWN0aXZlSXNzdWUoMjM3MDIsIFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yayldDQogICAgICAgIFtBY3RpdmVJc3N1ZSgyMDAxMCwgVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuVWFwKV0NCiAgICAgICAgW0NvbmRpdGlvbmFsRmFjdCh0eXBlb2YoUGxhdGZvcm1EZXRlY3Rpb24pLCBuYW1lb2YoUGxhdGZvcm1EZXRlY3Rpb24uSXNOb3RXaW5kb3dzTmFub1NlcnZlcikpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQcm94eUF1dGhfRGlnZXN0X1N1Y2NlZWRzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzQ3VybEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gSXNzdWUgIzI3ODcwIGN1cmwgSHR0cEhhbmRsZXIgY2FuIG9ubHkgZG8gYmFzaWMgYXV0aCB0byBwcm94eQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIGV4cGVjdGVkVXNlcm5hbWUgPSAidGVzdHVzZXJuYW1lIjsNCiAgICAgICAgICAgIGNvbnN0IHN0cmluZyBleHBlY3RlZFBhc3N3b3JkID0gInRlc3RwYXNzd29yZCI7DQogICAgICAgICAgICBjb25zdCBzdHJpbmcgYXV0aEhlYWRlciA9ICJQcm94eS1BdXRoZW50aWNhdGU6IERpZ2VzdCByZWFsbT1cIk5ldENvcmVcIiwgbm9uY2U9XCJQd09uV2dBQUFBQUFqbmJXNDM4QUFKU1FpMWtBQUFBQVwiLCBxb3A9XCJhdXRoXCIsIHN0YWxlPWZhbHNlXHJcbiI7DQogICAgICAgICAgICBMb29wYmFja1NlcnZlci5PcHRpb25zIG9wdGlvbnMgPSBuZXcgTG9vcGJhY2tTZXJ2ZXIuT3B0aW9ucyB7IElzUHJveHkgPSB0cnVlLCBVc2VybmFtZSA9IGV4cGVjdGVkVXNlcm5hbWUsIFBhc3N3b3JkID0gZXhwZWN0ZWRQYXNzd29yZCB9Ow0KICAgICAgICAgICAgdmFyIHByb3h5Q3JlZHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoZXhwZWN0ZWRVc2VybmFtZSwgZXhwZWN0ZWRQYXNzd29yZCk7DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChwcm94eVNlcnZlciwgcHJveHlVcmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLlByb3h5ID0gbmV3IFVzZVNwZWNpZmllZFVyaVdlYlByb3h5KHByb3h5VXJsLCBwcm94eUNyZWRzKTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBVUkwgZG9lcyBub3QgbWF0dGVyLiBXZSB3aWxsIGdldCByZXNwb25zZSBmcm9tICJwcm94eSIgY29kZSBiZWxsb3cuDQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gcmVzcG9uc2VUYXNrID0gY2xpZW50LkdldEFzeW5jKCJodHRwOi8vbm90YXRyZWFsc2VydmVyLmNvbS8iKTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyAgU2VuZCBEaWdlc3QgY2hhbGxlbmdlLg0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBwcm94eVNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYyhIdHRwU3RhdHVzQ29kZS5Qcm94eUF1dGhlbnRpY2F0aW9uUmVxdWlyZWQsIGF1dGhIZWFkZXIpOw0KICAgICAgICAgICAgICAgICAgICAvLyBWZXJpZnkgdXNlciAmIHBhc3N3b3JkLg0KICAgICAgICAgICAgICAgICAgICB2YXIgdGFzayA9IHByb3h5U2VydmVyLkFjY2VwdENvbm5lY3Rpb25QZXJmb3JtQXV0aGVudGljYXRpb25BbmRDbG9zZUFzeW5jKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWRXaXRoVGltZW91dChUZXN0SGVscGVyLlBhc3NpbmdUZXN0VGltZW91dE1pbGxpc2Vjb25kcywgdGFzayk7DQoNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWRXaXRoVGltZW91dChUZXN0SGVscGVyLlBhc3NpbmdUZXN0VGltZW91dE1pbGxpc2Vjb25kcywgcmVzcG9uc2VUYXNrKTsNCiAgICAgICAgICAgICAgICAgICAgSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IHJlc3BvbnNlVGFzay5SZXN1bHQ7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgb3B0aW9ucyk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIElFbnVtZXJhYmxlPG9iamVjdFtdPiBCeXBhc3NlZFByb3hpZXMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgbnVsbCB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7IG5ldyBVc2VTcGVjaWZpZWRVcmlXZWJQcm94eShuZXcgVXJpKCQiaHR0cDovL3tHdWlkLk5ld0d1aWQoKS5Ub1N0cmluZygpLlN1YnN0cmluZygwLCAxNSl9OjEyMzQ1IiksIGJ5cGFzczogdHJ1ZSkgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIElFbnVtZXJhYmxlPG9iamVjdFtdPiBDcmVkZW50aWFsc0ZvclByb3h5UmZjQ29tcGxpYW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaCAoYm9vbCB3cmFwQ3JlZHNJbkNhY2hlIGluIG5ld1tdIHsgdHJ1ZSwgZmFsc2UgfSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgbmV3IE5ldHdvcmtDcmVkZW50aWFsKCJ1c2VybmFtZSIsICJwYXNzd29yZCIpLCB3cmFwQ3JlZHNJbkNhY2hlIH07DQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7IG5ldyBOZXR3b3JrQ3JlZGVudGlhbCgidXNlcm5hbWUiLCAicGFzc3dvcmQiLCAiZG9tYWluIiksIHdyYXBDcmVkc0luQ2FjaGUgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIElFbnVtZXJhYmxlPG9iamVjdFtdPiBDcmVkZW50aWFsc0ZvclByb3h5Tm9uUmZjQ29tcGxpYW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7IG51bGwsIGZhbHNlIH07DQogICAgICAgICAgICBmb3JlYWNoIChib29sIHdyYXBDcmVkc0luQ2FjaGUgaW4gbmV3W10geyB0cnVlLCBmYWxzZSB9KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyBuZXcgTmV0d29ya0NyZWRlbnRpYWwoInVzZXI6bmFtZSIsICJwYXNzd29yZCIpLCB3cmFwQ3JlZHNJbkNhY2hlIH07DQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7IG5ldyBOZXR3b3JrQ3JlZGVudGlhbCgidXNlcm5hbWUiLCAicGFzc3dvcmQiLCAiZG9tOlxcYWluIiksIHdyYXBDcmVkc0luQ2FjaGUgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgICNlbmRyZWdpb24NCg0KICAgICAgICAjcmVnaW9uIFVyaSB3aXJlIHRyYW5zbWlzc2lvbiBlbmNvZGluZyB0ZXN0cw0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFNlbmRSZXF1ZXN0X1VyaVBhdGhIYXNSZXNlcnZlZENoYXJzX1NlcnZlclJlY2VpdmVkRXhwZWN0ZWRQYXRoKCkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgcm9vdFVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgdXJpID0gbmV3IFVyaSgkImh0dHA6Ly97cm9vdFVybC5Ib3N0fTp7cm9vdFVybC5Qb3J0fS90ZXN0W10iKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSh1cmkuQWJzb2x1dGVVcmkuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuR2V0LCB1cmkpOw0KICAgICAgICAgICAgICAgIHN0cmluZyBzdGF0dXNMaW5lID0gc3RyaW5nLkVtcHR5Ow0KDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXRSZXNwb25zZVRhc2sgPSBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrPExpc3Q8c3RyaW5nPj4gc2VydmVyVGFzayA9IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKGdldFJlc3BvbnNlVGFzaywgc2VydmVyVGFzayk7DQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZWNlaXZlZFJlcXVlc3QgPSBhd2FpdCBzZXJ2ZXJUYXNrOw0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGdldFJlc3BvbnNlVGFzaykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKHJlY2VpdmVkUmVxdWVzdFswXS5Db250YWlucyh1cmkuUGF0aEFuZFF1ZXJ5KSwgJCJzdGF0dXNMaW5lIHNob3VsZCBjb250YWluIHt1cmkuUGF0aEFuZFF1ZXJ5fSIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbg0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpCookieProtocolTests.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uTmV0LlRlc3QuQ29tbW9uOw0KdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsNCnVzaW5nIFh1bml0Ow0KDQpuYW1lc3BhY2UgU3lzdGVtLk5ldC5IdHRwLkZ1bmN0aW9uYWwuVGVzdHMNCnsNCiAgICBwdWJsaWMgYWJzdHJhY3QgY2xhc3MgSHR0cENvb2tpZVByb3RvY29sVGVzdHMgOiBIdHRwQ2xpZW50VGVzdEJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIHNfY29va2llTmFtZSA9ICJBQkMiOw0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBzX2Nvb2tpZVZhbHVlID0gIjEyMyI7DQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIHNfZXhwZWN0ZWRDb29raWVIZWFkZXJWYWx1ZSA9ICJBQkM9MTIzIjsNCg0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBzX2N1c3RvbUNvb2tpZUhlYWRlclZhbHVlID0gIkN1c3RvbUNvb2tpZT00NTYiOw0KDQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIHNfc2ltcGxlQ29udGVudCA9ICJIZWxsbyB3b3JsZCEiOw0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFNlbmQgY29va2llIHRlc3RzDQogICAgICAgIC8vDQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgQ29va2llQ29udGFpbmVyIENyZWF0ZVNpbmdsZUNvb2tpZUNvbnRhaW5lcihVcmkgdXJpKSA9PiBDcmVhdGVTaW5nbGVDb29raWVDb250YWluZXIodXJpLCBzX2Nvb2tpZU5hbWUsIHNfY29va2llVmFsdWUpOw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIENvb2tpZUNvbnRhaW5lciBDcmVhdGVTaW5nbGVDb29raWVDb250YWluZXIoVXJpIHVyaSwgc3RyaW5nIGNvb2tpZU5hbWUsIHN0cmluZyBjb29raWVWYWx1ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IG5ldyBDb29raWVDb250YWluZXIoKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5BZGQodXJpLCBuZXcgQ29va2llKGNvb2tpZU5hbWUsIGNvb2tpZVZhbHVlKSk7DQogICAgICAgICAgICByZXR1cm4gY29udGFpbmVyOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEdldENvb2tpZUhlYWRlclZhbHVlKHN0cmluZyBjb29raWVOYW1lLCBzdHJpbmcgY29va2llVmFsdWUpID0+ICQie2Nvb2tpZU5hbWV9PXtjb29raWVWYWx1ZX0iOw0KDQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX0RlZmF1bHRDb29va2llQ29udGFpbmVyX05vQ29va2llU2VudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFJlc3BvbnNlVGFzayA9IGNsaWVudC5HZXRBc3luYyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrPExpc3Q8c3RyaW5nPj4gc2VydmVyVGFzayA9IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChnZXRSZXNwb25zZVRhc2ssIHNlcnZlclRhc2spOw0KDQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZXF1ZXN0TGluZXMgPSBhd2FpdCBzZXJ2ZXJUYXNrOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCByZXF1ZXN0TGluZXMuQ291bnQocyA9PiBzLlN0YXJ0c1dpdGgoIkNvb2tpZToiKSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKENvb2tpZU5hbWVzVmFsdWVzQW5kVXNlQ29va2llcykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19TZXRDb29raWVDb250YWluZXJfQ29va2llU2VudChzdHJpbmcgY29va2llTmFtZSwgc3RyaW5nIGNvb2tpZVZhbHVlLCBib29sIHVzZUNvb2tpZXMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkNvb2tpZUNvbnRhaW5lciA9IENyZWF0ZVNpbmdsZUNvb2tpZUNvbnRhaW5lcih1cmwsIGNvb2tpZU5hbWUsIGNvb2tpZVZhbHVlKTsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlVzZUNvb2tpZXMgPSB1c2VDb29raWVzOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFJlc3BvbnNlVGFzayA9IGNsaWVudC5HZXRBc3luYyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrPExpc3Q8c3RyaW5nPj4gc2VydmVyVGFzayA9IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChnZXRSZXNwb25zZVRhc2ssIHNlcnZlclRhc2spOw0KDQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZXF1ZXN0TGluZXMgPSBhd2FpdCBzZXJ2ZXJUYXNrOw0KDQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VDb29raWVzKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoJCJDb29raWU6IHtHZXRDb29raWVIZWFkZXJWYWx1ZShjb29raWVOYW1lLCBjb29raWVWYWx1ZSl9IiwgcmVxdWVzdExpbmVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCByZXF1ZXN0TGluZXMuQ291bnQocyA9PiBzLlN0YXJ0c1dpdGgoIkNvb2tpZToiKSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDAsIHJlcXVlc3RMaW5lcy5Db3VudChzID0+IHMuU3RhcnRzV2l0aCgiQ29va2llOiIpKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19TZXRDb29raWVDb250YWluZXJNdWx0aXBsZUNvb2tpZXNfQ29va2llc1NlbnQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgY29va2llcyA9IG5ldyBDb29raWVbXQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG5ldyBDb29raWUoImhlbGxvIiwgIndvcmxkIiksDQogICAgICAgICAgICAgICAgbmV3IENvb2tpZSgiZm9vIiwgImJhciIpLA0KICAgICAgICAgICAgICAgIG5ldyBDb29raWUoIkFCQyIsICIxMjMiKQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KDQogICAgICAgICAgICAgICAgdmFyIGNvb2tpZUNvbnRhaW5lciA9IG5ldyBDb29raWVDb250YWluZXIoKTsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChDb29raWUgYyBpbiBjb29raWVzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY29va2llQ29udGFpbmVyLkFkZCh1cmwsIGMpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ29va2llQ29udGFpbmVyID0gY29va2llQ29udGFpbmVyOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFJlc3BvbnNlVGFzayA9IGNsaWVudC5HZXRBc3luYyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrPExpc3Q8c3RyaW5nPj4gc2VydmVyVGFzayA9IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChnZXRSZXNwb25zZVRhc2ssIHNlcnZlclRhc2spOw0KDQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZXF1ZXN0TGluZXMgPSBhd2FpdCBzZXJ2ZXJUYXNrOw0KDQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZEhlYWRlciA9ICJDb29raWU6ICIgKyBzdHJpbmcuSm9pbigiOyAiLCBjb29raWVzLlNlbGVjdChjID0+ICQie2MuTmFtZX09e2MuVmFsdWV9IikuVG9BcnJheSgpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKGV4cGVjdGVkSGVhZGVyLCByZXF1ZXN0TGluZXMpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMSwgcmVxdWVzdExpbmVzLkNvdW50KHMgPT4gcy5TdGFydHNXaXRoKCJDb29raWU6IikpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19BZGRDb29raWVIZWFkZXJfQ29va2llSGVhZGVyU2VudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChJc05ldGZ4SGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBOZXRmeCBoYW5kbGVyIGRvZXMgbm90IHN1cHBvcnQgY3VzdG9tIGNvb2tpZSBoZWFkZXINCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEh0dHBSZXF1ZXN0TWVzc2FnZSByZXF1ZXN0TWVzc2FnZSA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UoSHR0cE1ldGhvZC5HZXQsIHVybCk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RNZXNzYWdlLkhlYWRlcnMuQWRkKCJDb29raWUiLCBzX2N1c3RvbUNvb2tpZUhlYWRlclZhbHVlKTsNCg0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFJlc3BvbnNlVGFzayA9IGNsaWVudC5TZW5kQXN5bmMocmVxdWVzdE1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrPExpc3Q8c3RyaW5nPj4gc2VydmVyVGFzayA9IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KDQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZXF1ZXN0TGluZXMgPSBhd2FpdCBzZXJ2ZXJUYXNrOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygkIkNvb2tpZToge3NfY3VzdG9tQ29va2llSGVhZGVyVmFsdWV9IiwgcmVxdWVzdExpbmVzKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHJlcXVlc3RMaW5lcy5Db3VudChzID0+IHMuU3RhcnRzV2l0aCgiQ29va2llOiIpKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfQWRkTXVsdGlwbGVDb29raWVIZWFkZXJzX0Nvb2tpZXNTZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzTmV0ZnhIYW5kbGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIE5ldGZ4IGhhbmRsZXIgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gY29va2llIGhlYWRlcg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgSHR0cFJlcXVlc3RNZXNzYWdlIHJlcXVlc3RNZXNzYWdlID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLkdldCwgdXJsKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdE1lc3NhZ2UuSGVhZGVycy5BZGQoIkNvb2tpZSIsICJBPTEiKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdE1lc3NhZ2UuSGVhZGVycy5BZGQoIkNvb2tpZSIsICJCPTIiKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdE1lc3NhZ2UuSGVhZGVycy5BZGQoIkNvb2tpZSIsICJDPTMiKTsNCg0KICAgICAgICAgICAgICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IGdldFJlc3BvbnNlVGFzayA9IGNsaWVudC5TZW5kQXN5bmMocmVxdWVzdE1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBUYXNrPExpc3Q8c3RyaW5nPj4gc2VydmVyVGFzayA9IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZFJlc3BvbnNlQW5kQ2xvc2VBc3luYygpOw0KDQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZXF1ZXN0TGluZXMgPSBhd2FpdCBzZXJ2ZXJUYXNrOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCByZXF1ZXN0TGluZXMuQ291bnQocyA9PiBzLlN0YXJ0c1dpdGgoIkNvb2tpZTogIikpKTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBNdWx0aXBsZSBDb29raWUgaGVhZGVyIHZhbHVlcyBhcmUgdHJlYXRlZCBhcyBhbnkgb3RoZXIgaGVhZGVyIHZhbHVlcyBhbmQgYXJlIA0KICAgICAgICAgICAgICAgICAgICAvLyBjb25jYXRlbmF0ZWQgdXNpbmcgIiwgIiBhcyB0aGUgc2VwYXJhdG9yLg0KDQogICAgICAgICAgICAgICAgICAgIHZhciBjb29raWVWYWx1ZXMgPSByZXF1ZXN0TGluZXMuU2luZ2xlKHMgPT4gcy5TdGFydHNXaXRoKCJDb29raWU6ICIpKS5TdWJzdHJpbmcoOCkuU3BsaXQobmV3IHN0cmluZ1tdIHsgIiwgIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuTm9uZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQT0xIiwgY29va2llVmFsdWVzKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCJCPTIiLCBjb29raWVWYWx1ZXMpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIkM9MyIsIGNvb2tpZVZhbHVlcyk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgzLCBjb29raWVWYWx1ZXMuQ291bnQoKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfU2V0Q29va2llQ29udGFpbmVyQW5kQ29va2llSGVhZGVyX0JvdGhDb29raWVzU2VudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChJc05ldGZ4SGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBOZXRmeCBoYW5kbGVyIGRvZXMgbm90IHN1cHBvcnQgY3VzdG9tIGNvb2tpZSBoZWFkZXINCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChJc0N1cmxIYW5kbGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIElzc3VlICMyNjk4Mw0KICAgICAgICAgICAgICAgIC8vIEN1cmxIYW5kbGVyIGlnbm9yZXMgY29udGFpbmVyIGNvb2tpZXMgd2hlbiBjdXN0b20gQ29va2llIGhlYWRlciBpcyBzZXQuDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5Db29raWVDb250YWluZXIgPSBDcmVhdGVTaW5nbGVDb29raWVDb250YWluZXIodXJsKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgSHR0cFJlcXVlc3RNZXNzYWdlIHJlcXVlc3RNZXNzYWdlID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLkdldCwgdXJsKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdE1lc3NhZ2UuSGVhZGVycy5BZGQoIkNvb2tpZSIsIHNfY3VzdG9tQ29va2llSGVhZGVyVmFsdWUpOw0KDQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gZ2V0UmVzcG9uc2VUYXNrID0gY2xpZW50LlNlbmRBc3luYyhyZXF1ZXN0TWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8TGlzdDxzdHJpbmc+PiBzZXJ2ZXJUYXNrID0gc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKGdldFJlc3BvbnNlVGFzaywgc2VydmVyVGFzayk7DQoNCiAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHJlcXVlc3RMaW5lcyA9IGF3YWl0IHNlcnZlclRhc2s7DQoNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHJlcXVlc3RMaW5lcy5Db3VudChzID0+IHMuU3RhcnRzV2l0aCgiQ29va2llOiAiKSkpOw0KDQogICAgICAgICAgICAgICAgICAgIHZhciBjb29raWVzID0gcmVxdWVzdExpbmVzLlNpbmdsZShzID0+IHMuU3RhcnRzV2l0aCgiQ29va2llOiAiKSkuU3Vic3RyaW5nKDgpLlNwbGl0KG5ldyBzdHJpbmdbXSB7ICI7ICIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoc19leHBlY3RlZENvb2tpZUhlYWRlclZhbHVlLCBjb29raWVzKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKHNfY3VzdG9tQ29va2llSGVhZGVyVmFsdWUsIGNvb2tpZXMpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMiwgY29va2llcy5Db3VudCgpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19TZXRDb29raWVDb250YWluZXJBbmRNdWx0aXBsZUNvb2tpZUhlYWRlcnNfQm90aENvb2tpZXNTZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzTmV0ZnhIYW5kbGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIE5ldGZ4IGhhbmRsZXIgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gY29va2llIGhlYWRlcg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKElzQ3VybEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gSXNzdWUgIzI2OTgzDQogICAgICAgICAgICAgICAgLy8gQ3VybEhhbmRsZXIgaWdub3JlcyBjb250YWluZXIgY29va2llcyB3aGVuIGN1c3RvbSBDb29raWUgaGVhZGVyIGlzIHNldC4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIoKTsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkNvb2tpZUNvbnRhaW5lciA9IENyZWF0ZVNpbmdsZUNvb2tpZUNvbnRhaW5lcih1cmwpOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBIdHRwUmVxdWVzdE1lc3NhZ2UgcmVxdWVzdE1lc3NhZ2UgPSBuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuR2V0LCB1cmwpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0TWVzc2FnZS5IZWFkZXJzLkFkZCgiQ29va2llIiwgIkE9MSIpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0TWVzc2FnZS5IZWFkZXJzLkFkZCgiQ29va2llIiwgIkI9MiIpOw0KDQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gZ2V0UmVzcG9uc2VUYXNrID0gY2xpZW50LlNlbmRBc3luYyhyZXF1ZXN0TWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8TGlzdDxzdHJpbmc+PiBzZXJ2ZXJUYXNrID0gc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKGdldFJlc3BvbnNlVGFzaywgc2VydmVyVGFzayk7DQoNCiAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHJlcXVlc3RMaW5lcyA9IGF3YWl0IHNlcnZlclRhc2s7DQoNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHJlcXVlc3RMaW5lcy5Db3VudChzID0+IHMuU3RhcnRzV2l0aCgiQ29va2llOiAiKSkpOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIE11bHRpcGxlIENvb2tpZSBoZWFkZXIgdmFsdWVzIGFyZSB0cmVhdGVkIGFzIGFueSBvdGhlciBoZWFkZXIgdmFsdWVzIGFuZCBhcmUgDQogICAgICAgICAgICAgICAgICAgIC8vIGNvbmNhdGVuYXRlZCB1c2luZyAiLCAiIGFzIHRoZSBzZXBhcmF0b3IuICBUaGUgY29udGFpbmVyIGNvb2tpZSBpcyBjb25jYXRlbmF0ZWQgdG8NCiAgICAgICAgICAgICAgICAgICAgLy8gb25lIG9mIHRoZXNlIHZhbHVlcyB1c2luZyB0aGUgIjsgIiBjb29raWUgc2VwYXJhdG9yLg0KDQogICAgICAgICAgICAgICAgICAgIHZhciBjb29raWVWYWx1ZXMgPSByZXF1ZXN0TGluZXMuU2luZ2xlKHMgPT4gcy5TdGFydHNXaXRoKCJDb29raWU6ICIpKS5TdWJzdHJpbmcoOCkuU3BsaXQobmV3IHN0cmluZ1tdIHsgIiwgIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuTm9uZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgyLCBjb29raWVWYWx1ZXMuQ291bnQoKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gRmluZCBjb250YWluZXIgY29va2llIGFuZCByZW1vdmUgaXQgc28gd2UgY2FuIHZhbGlkYXRlIHRoZSByZXN0IG9mIHRoZSBjb29raWUgaGVhZGVyIHZhbHVlcw0KICAgICAgICAgICAgICAgICAgICBib29sIHNhd0NvbnRhaW5lckNvb2tpZSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvb2tpZVZhbHVlcy5MZW5ndGg7IGkrKykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvb2tpZVZhbHVlc1tpXS5Db250YWlucygnOycpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShzYXdDb250YWluZXJDb29raWUpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvb2tpZXMgPSBjb29raWVWYWx1ZXNbaV0uU3BsaXQobmV3IHN0cmluZ1tdIHsgIjsgIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuTm9uZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDIsIGNvb2tpZXMuQ291bnQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKHNfZXhwZWN0ZWRDb29raWVIZWFkZXJWYWx1ZSwgY29va2llcyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXdDb250YWluZXJDb29raWUgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZVZhbHVlc1tpXSA9IGNvb2tpZXMuV2hlcmUoYyA9PiBjICE9IHNfZXhwZWN0ZWRDb29raWVIZWFkZXJWYWx1ZSkuU2luZ2xlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoIkE9MSIsIGNvb2tpZVZhbHVlcyk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygiQj0yIiwgY29va2llVmFsdWVzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY1dpdGhSZWRpcmVjdF9TZXRDb29raWVDb250YWluZXJfQ29ycmVjdENvb2tpZXNTZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIHBhdGgxID0gIi9mb28iOw0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIHBhdGgyID0gIi9iYXIiOw0KDQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVDbGllbnRBbmRTZXJ2ZXJBc3luYyhhc3luYyB1cmwgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVcmkgdXJsMSA9IG5ldyBVcmkodXJsLCBwYXRoMSk7DQogICAgICAgICAgICAgICAgVXJpIHVybDIgPSBuZXcgVXJpKHVybCwgcGF0aDIpOw0KICAgICAgICAgICAgICAgIFVyaSB1bnVzZWRVcmwgPSBuZXcgVXJpKHVybCwgIi91bnVzZWQiKTsNCg0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ29va2llQ29udGFpbmVyID0gbmV3IENvb2tpZUNvbnRhaW5lcigpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ29va2llQ29udGFpbmVyLkFkZCh1cmwxLCBuZXcgQ29va2llKCJjb29raWUxIiwgInZhbHVlMSIpKTsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkNvb2tpZUNvbnRhaW5lci5BZGQodXJsMiwgbmV3IENvb2tpZSgiY29va2llMiIsICJ2YWx1ZTIiKSk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5Db29raWVDb250YWluZXIuQWRkKHVudXNlZFVybCwgbmV3IENvb2tpZSgiY29va2llMyIsICJ2YWx1ZTMiKSk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNsaWVudC5EZWZhdWx0UmVxdWVzdEhlYWRlcnMuQ29ubmVjdGlvbkNsb3NlID0gdHJ1ZTsgLy8gdG8gYXZvaWQgaXNzdWVzIHdpdGggY29ubmVjdGlvbiBwb29saW5nDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmwxKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYXN5bmMgc2VydmVyID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHJlcXVlc3QxTGluZXMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoSHR0cFN0YXR1c0NvZGUuRm91bmQsICQiTG9jYXRpb246IHtwYXRoMn1cclxuIik7DQoNCiAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoJCJDb29raWU6IGNvb2tpZTE9dmFsdWUxIiwgcmVxdWVzdDFMaW5lcyk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHJlcXVlc3QxTGluZXMuQ291bnQocyA9PiBzLlN0YXJ0c1dpdGgoIkNvb2tpZToiKSkpOw0KDQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHJlcXVlc3QyTGluZXMgPSBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoY29udGVudDogc19zaW1wbGVDb250ZW50KTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucygkIkNvb2tpZTogY29va2llMj12YWx1ZTIiLCByZXF1ZXN0MkxpbmVzKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMSwgcmVxdWVzdDJMaW5lcy5Db3VudChzID0+IHMuU3RhcnRzV2l0aCgiQ29va2llOiIpKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFJlY2VpdmUgY29va2llIHRlc3RzDQogICAgICAgIC8vDQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKENvb2tpZU5hbWVzVmFsdWVzQW5kVXNlQ29va2llcykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY19SZWNlaXZlU2V0Q29va2llSGVhZGVyX0Nvb2tpZUFkZGVkKHN0cmluZyBjb29raWVOYW1lLCBzdHJpbmcgY29va2llVmFsdWUsIGJvb2wgdXNlQ29va2llcykNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuVXNlQ29va2llcyA9IHVzZUNvb2tpZXM7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gZ2V0UmVzcG9uc2VUYXNrID0gY2xpZW50LkdldEFzeW5jKHVybCk7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8TGlzdDxzdHJpbmc+PiBzZXJ2ZXJUYXNrID0gc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKA0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFN0YXR1c0NvZGUuT0ssICQiU2V0LUNvb2tpZToge0dldENvb2tpZUhlYWRlclZhbHVlKGNvb2tpZU5hbWUsIGNvb2tpZVZhbHVlKX1cclxuIiwgc19zaW1wbGVDb250ZW50KTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQoZ2V0UmVzcG9uc2VUYXNrLCBzZXJ2ZXJUYXNrKTsNCg0KICAgICAgICAgICAgICAgICAgICBDb29raWVDb2xsZWN0aW9uIGNvbGxlY3Rpb24gPSBoYW5kbGVyLkNvb2tpZUNvbnRhaW5lci5HZXRDb29raWVzKHVybCk7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZUNvb2tpZXMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCBjb2xsZWN0aW9uLkNvdW50KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChjb29raWVOYW1lLCBjb2xsZWN0aW9uWzBdLk5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGNvb2tpZVZhbHVlLCBjb2xsZWN0aW9uWzBdLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCBjb2xsZWN0aW9uLkNvdW50KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX1JlY2VpdmVNdWx0aXBsZVNldENvb2tpZUhlYWRlcnNfQ29va2llQWRkZWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gZ2V0UmVzcG9uc2VUYXNrID0gY2xpZW50LkdldEFzeW5jKHVybCk7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8TGlzdDxzdHJpbmc+PiBzZXJ2ZXJUYXNrID0gc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKA0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFN0YXR1c0NvZGUuT0ssDQogICAgICAgICAgICAgICAgICAgICAgICAkIlNldC1Db29raWU6IEE9MTsgUGF0aD0vXHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgJCJTZXQtQ29va2llICAgOiBCPTI7IFBhdGg9L1xyXG4iICsgLy8gc3BhY2UgYmVmb3JlIGNvbG9uIHRvIHZlcmlmeSBoZWFkZXIgaXMgdHJpbW1lZCBhbmQgcmVjb2duaXplZA0KICAgICAgICAgICAgICAgICAgICAgICAgJCJTZXQtQ29va2llOiAgICBDPTM7IFBhdGg9L1xyXG4iLA0KICAgICAgICAgICAgICAgICAgICAgICAgc19zaW1wbGVDb250ZW50KTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQoZ2V0UmVzcG9uc2VUYXNrLCBzZXJ2ZXJUYXNrKTsNCg0KICAgICAgICAgICAgICAgICAgICBDb29raWVDb2xsZWN0aW9uIGNvbGxlY3Rpb24gPSBoYW5kbGVyLkNvb2tpZUNvbnRhaW5lci5HZXRDb29raWVzKHVybCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgzLCBjb2xsZWN0aW9uLkNvdW50KTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHRvIGFycmF5IHNvIHdlIGNhbiBtb3JlIGVhc2lseSBwcm9jZXNzIGNvbnRlbnRzLCBzaW5jZSBDb29raWVDb2xsZWN0aW9uIGRvZXMgbm90IGltcGxlbWVudCBJRW51bWVyYWJsZTxDb29raWU+DQogICAgICAgICAgICAgICAgICAgIENvb2tpZVtdIGNvb2tpZXMgPSBuZXcgQ29va2llWzNdOw0KICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLkNvcHlUbyhjb29raWVzLCAwKTsNCg0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoY29va2llcywgYyA9PiBjLk5hbWUgPT0gIkEiICYmIGMuVmFsdWUgPT0gIjEiKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKGNvb2tpZXMsIGMgPT4gYy5OYW1lID09ICJCIiAmJiBjLlZhbHVlID09ICIyIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhjb29raWVzLCBjID0+IGMuTmFtZSA9PSAiQyIgJiYgYy5WYWx1ZSA9PSAiMyIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jX1JlY2VpdmVTZXRDb29raWVIZWFkZXJfQ29va2llVXBkYXRlZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGNvbnN0IHN0cmluZyBuZXdDb29raWVWYWx1ZSA9ICI3ODkiOw0KDQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5Db29raWVDb250YWluZXIgPSBDcmVhdGVTaW5nbGVDb29raWVDb250YWluZXIodXJsKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiBnZXRSZXNwb25zZVRhc2sgPSBjbGllbnQuR2V0QXN5bmModXJsKTsNCiAgICAgICAgICAgICAgICAgICAgVGFzazxMaXN0PHN0cmluZz4+IHNlcnZlclRhc2sgPSBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoDQogICAgICAgICAgICAgICAgICAgICAgICBIdHRwU3RhdHVzQ29kZS5PSywgJCJTZXQtQ29va2llOiB7c19jb29raWVOYW1lfT17bmV3Q29va2llVmFsdWV9XHJcbiIsIHNfc2ltcGxlQ29udGVudCk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKGdldFJlc3BvbnNlVGFzaywgc2VydmVyVGFzayk7DQoNCiAgICAgICAgICAgICAgICAgICAgQ29va2llQ29sbGVjdGlvbiBjb2xsZWN0aW9uID0gaGFuZGxlci5Db29raWVDb250YWluZXIuR2V0Q29va2llcyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMSwgY29sbGVjdGlvbi5Db3VudCk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChzX2Nvb2tpZU5hbWUsIGNvbGxlY3Rpb25bMF0uTmFtZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChuZXdDb29raWVWYWx1ZSwgY29sbGVjdGlvblswXS5WYWx1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfUmVjZWl2ZVNldENvb2tpZUhlYWRlcl9Db29raWVSZW1vdmVkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ29va2llQ29udGFpbmVyID0gQ3JlYXRlU2luZ2xlQ29va2llQ29udGFpbmVyKHVybCk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gZ2V0UmVzcG9uc2VUYXNrID0gY2xpZW50LkdldEFzeW5jKHVybCk7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8TGlzdDxzdHJpbmc+PiBzZXJ2ZXJUYXNrID0gc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKA0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFN0YXR1c0NvZGUuT0ssICQiU2V0LUNvb2tpZToge3NfY29va2llTmFtZX09OyBFeHBpcmVzPVN1biwgMDYgTm92IDE5OTQgMDg6NDk6MzcgR01UXHJcbiIsIHNfc2ltcGxlQ29udGVudCk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKGdldFJlc3BvbnNlVGFzaywgc2VydmVyVGFzayk7DQoNCiAgICAgICAgICAgICAgICAgICAgQ29va2llQ29sbGVjdGlvbiBjb2xsZWN0aW9uID0gaGFuZGxlci5Db29raWVDb250YWluZXIuR2V0Q29va2llcyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgY29sbGVjdGlvbi5Db3VudCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNfUmVjZWl2ZUludmFsaWRTZXRDb29raWVIZWFkZXJfVmFsaWRDb29raWVzQWRkZWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNOZXRmeEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gTmV0ZnhIYW5kbGVyIGluY29ycmVjdGx5IG9ubHkgcHJvY2Vzc2VzIG9uZSB2YWxpZCBjb29raWUgDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gZ2V0UmVzcG9uc2VUYXNrID0gY2xpZW50LkdldEFzeW5jKHVybCk7DQogICAgICAgICAgICAgICAgICAgIFRhc2s8TGlzdDxzdHJpbmc+PiBzZXJ2ZXJUYXNrID0gc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKA0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFN0YXR1c0NvZGUuT0ssDQogICAgICAgICAgICAgICAgICAgICAgICAkIlNldC1Db29raWU6IEE9MTsgUGF0aD0vO0V4cGlyZXM9YXNkZnNhZGdhZHNcclxuIiArICAgIC8vIGludmFsaWQgRXhwaXJlcw0KICAgICAgICAgICAgICAgICAgICAgICAgJCJTZXQtQ29va2llOiBCPTI7IFBhdGg9L1xyXG4iICsgDQogICAgICAgICAgICAgICAgICAgICAgICAkIlNldC1Db29raWU6IEM9MzsgUGF0aD0vXHJcbiIsDQogICAgICAgICAgICAgICAgICAgICAgICBzX3NpbXBsZUNvbnRlbnQpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChnZXRSZXNwb25zZVRhc2ssIHNlcnZlclRhc2spOw0KDQogICAgICAgICAgICAgICAgICAgIENvb2tpZUNvbGxlY3Rpb24gY29sbGVjdGlvbiA9IGhhbmRsZXIuQ29va2llQ29udGFpbmVyLkdldENvb2tpZXModXJsKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDIsIGNvbGxlY3Rpb24uQ291bnQpOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdG8gYXJyYXkgc28gd2UgY2FuIG1vcmUgZWFzaWx5IHByb2Nlc3MgY29udGVudHMsIHNpbmNlIENvb2tpZUNvbGxlY3Rpb24gZG9lcyBub3QgaW1wbGVtZW50IElFbnVtZXJhYmxlPENvb2tpZT4NCiAgICAgICAgICAgICAgICAgICAgQ29va2llW10gY29va2llcyA9IG5ldyBDb29raWVbM107DQogICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24uQ29weVRvKGNvb2tpZXMsIDApOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhjb29raWVzLCBjID0+IGMuTmFtZSA9PSAiQiIgJiYgYy5WYWx1ZSA9PSAiMiIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoY29va2llcywgYyA9PiBjLk5hbWUgPT0gIkMiICYmIGMuVmFsdWUgPT0gIjMiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY1dpdGhSZWRpcmVjdF9SZWNlaXZlU2V0Q29va2llX0Nvb2tpZVNlbnQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBjb25zdCBzdHJpbmcgcGF0aDEgPSAiL2ZvbyI7DQogICAgICAgICAgICBjb25zdCBzdHJpbmcgcGF0aDIgPSAiL2JhciI7DQoNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVybCA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFVyaSB1cmwxID0gbmV3IFVyaSh1cmwsIHBhdGgxKTsNCg0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcigpOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjbGllbnQuRGVmYXVsdFJlcXVlc3RIZWFkZXJzLkNvbm5lY3Rpb25DbG9zZSA9IHRydWU7IC8vIHRvIGF2b2lkIGlzc3VlcyB3aXRoIGNvbm5lY3Rpb24gcG9vbGluZw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJsMSk7DQoNCiAgICAgICAgICAgICAgICAgICAgQ29va2llQ29sbGVjdGlvbiBjb2xsZWN0aW9uID0gaGFuZGxlci5Db29raWVDb250YWluZXIuR2V0Q29va2llcyh1cmwpOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgyLCBjb2xsZWN0aW9uLkNvdW50KTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHRvIGFycmF5IHNvIHdlIGNhbiBtb3JlIGVhc2lseSBwcm9jZXNzIGNvbnRlbnRzLCBzaW5jZSBDb29raWVDb2xsZWN0aW9uIGRvZXMgbm90IGltcGxlbWVudCBJRW51bWVyYWJsZTxDb29raWU+DQogICAgICAgICAgICAgICAgICAgIENvb2tpZVtdIGNvb2tpZXMgPSBuZXcgQ29va2llWzJdOw0KICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLkNvcHlUbyhjb29raWVzLCAwKTsNCg0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuQ29udGFpbnMoY29va2llcywgYyA9PiBjLk5hbWUgPT0gIkEiICYmIGMuVmFsdWUgPT0gIjEiKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKGNvb2tpZXMsIGMgPT4gYy5OYW1lID09ICJCIiAmJiBjLlZhbHVlID09ICIyIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGFzeW5jIHNlcnZlciA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZXF1ZXN0MUxpbmVzID0gYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKA0KICAgICAgICAgICAgICAgICAgICBIdHRwU3RhdHVzQ29kZS5Gb3VuZCwgJCJMb2NhdGlvbjoge3BhdGgyfVxyXG5TZXQtQ29va2llOiBBPTE7IFBhdGg9L1xyXG4iKTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCByZXF1ZXN0MUxpbmVzLkNvdW50KHMgPT4gcy5TdGFydHNXaXRoKCJDb29raWU6IikpKTsNCg0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZXF1ZXN0MkxpbmVzID0gYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kUmVzcG9uc2VBbmRDbG9zZUFzeW5jKA0KICAgICAgICAgICAgICAgICAgICBIdHRwU3RhdHVzQ29kZS5PSywgJCJTZXQtQ29va2llOiBCPTI7IFBhdGg9L1xyXG4iLCBzX3NpbXBsZUNvbnRlbnQpOw0KDQogICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCQiQ29va2llOiBBPTEiLCByZXF1ZXN0MkxpbmVzKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMSwgcmVxdWVzdDJMaW5lcy5Db3VudChzID0+IHMuU3RhcnRzV2l0aCgiQ29va2llOiIpKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY1dpdGhCYXNpY0F1dGhfUmVjZWl2ZVNldENvb2tpZV9Db29raWVTZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzV2luSHR0cEhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gSXNzdWUgIzI2OTg2DQogICAgICAgICAgICAgICAgLy8gV2luSHR0cEhhbmRsZXIgZG9lcyBub3QgcHJvY2VzcyB0aGUgY29va2llLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlQ2xpZW50QW5kU2VydmVyQXN5bmMoYXN5bmMgdXJsID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5DcmVkZW50aWFscyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbCgidXNlciIsICJwYXNzIik7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmwpOw0KDQogICAgICAgICAgICAgICAgICAgIENvb2tpZUNvbGxlY3Rpb24gY29sbGVjdGlvbiA9IGhhbmRsZXIuQ29va2llQ29udGFpbmVyLkdldENvb2tpZXModXJsKTsNCg0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMiwgY29sbGVjdGlvbi5Db3VudCk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCB0byBhcnJheSBzbyB3ZSBjYW4gbW9yZSBlYXNpbHkgcHJvY2VzcyBjb250ZW50cywgc2luY2UgQ29va2llQ29sbGVjdGlvbiBkb2VzIG5vdCBpbXBsZW1lbnQgSUVudW1lcmFibGU8Q29va2llPg0KICAgICAgICAgICAgICAgICAgICBDb29raWVbXSBjb29raWVzID0gbmV3IENvb2tpZVsyXTsNCiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbi5Db3B5VG8oY29va2llcywgMCk7DQoNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKGNvb2tpZXMsIGMgPT4gYy5OYW1lID09ICJBIiAmJiBjLlZhbHVlID09ICIxIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5Db250YWlucyhjb29raWVzLCBjID0+IGMuTmFtZSA9PSAiQiIgJiYgYy5WYWx1ZSA9PSAiMiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBhc3luYyBzZXJ2ZXIgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24gPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiByZXF1ZXN0MUxpbmVzID0gYXdhaXQgY29ubmVjdGlvbi5SZWFkUmVxdWVzdEhlYWRlckFuZFNlbmRSZXNwb25zZUFzeW5jKA0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFN0YXR1c0NvZGUuVW5hdXRob3JpemVkLA0KICAgICAgICAgICAgICAgICAgICAgICAgJCJXV1ctQXV0aGVudGljYXRlOiBCYXNpYyByZWFsbT1cIldhbGx5V29ybGRcIlxyXG5TZXQtQ29va2llOiBBPTE7IFBhdGg9L1xyXG4iKTsNCg0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgcmVxdWVzdDFMaW5lcy5Db3VudChzID0+IHMuU3RhcnRzV2l0aCgiQ29va2llOiIpKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHJlcXVlc3QyTGluZXMgPSBhd2FpdCBjb25uZWN0aW9uLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZFJlc3BvbnNlQXN5bmMoDQogICAgICAgICAgICAgICAgICAgICAgICBIdHRwU3RhdHVzQ29kZS5PSywNCiAgICAgICAgICAgICAgICAgICAgICAgICQiU2V0LUNvb2tpZTogQj0yOyBQYXRoPS9cclxuIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNfc2ltcGxlQ29udGVudCk7DQoNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkNvbnRhaW5zKCQiQ29va2llOiBBPTEiLCByZXF1ZXN0MkxpbmVzKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHJlcXVlc3QyTGluZXMuQ291bnQocyA9PiBzLlN0YXJ0c1dpdGgoIkNvb2tpZToiKSkpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyANCiAgICAgICAgLy8gTWVtYmVyRGF0YSBzdHVmZg0KICAgICAgICAvLw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBHZW5lcmF0ZUNvb2tpZShzdHJpbmcgbmFtZSwgY2hhciByZXBlYXQsIGludCBvdmVyYWxsSGVhZGVyVmFsdWVMZW5ndGgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBlbXB0eUhlYWRlclZhbHVlID0gJCJ7bmFtZX09OyBQYXRoPS8iOw0KDQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQob3ZlcmFsbEhlYWRlclZhbHVlTGVuZ3RoID4gZW1wdHlIZWFkZXJWYWx1ZS5MZW5ndGgpOw0KDQogICAgICAgICAgICBpbnQgdmFsdWVDb3VudCA9IG92ZXJhbGxIZWFkZXJWYWx1ZUxlbmd0aCAtIGVtcHR5SGVhZGVyVmFsdWUuTGVuZ3RoOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBzdHJpbmcocmVwZWF0LCB2YWx1ZUNvdW50KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgSUVudW1lcmFibGU8b2JqZWN0W10+IENvb2tpZU5hbWVzVmFsdWVzQW5kVXNlQ29va2llcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIGZvcmVhY2ggKGJvb2wgdXNlQ29va2llcyBpbiBuZXdbXSB7IHRydWUsIGZhbHNlIH0pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJBQkMiLCAiMTIzIiwgdXNlQ29va2llcyB9Ow0KICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiSGVsbG8iLCAiV29ybGQiLCB1c2VDb29raWVzIH07DQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJmb28iLCAiYmFyIiwgdXNlQ29va2llcyB9Ow0KDQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICIuQXNwTmV0Q29yZS5TZXNzaW9uIiwgIlJBRXhFbVhwb0NidWVQX1FZTSIsIHVzZUNvb2tpZXMgfTsNCg0KICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICIuQXNwTmV0Q29yZS5BbnRpZm9yZ2VyeS5YYW03X09lTGNONCIsDQogICAgICAgICAgICAgICAgICAgICJDZkRKOE5HTnhBdDdDYmRDbHEzVUo4XzZ3XzQ2NjF3UlFaVDFhRHRVT0lVS3NoYmNWNFAwTmRTOGtsQ0w1cUdTTi1QTkJCVjd3MjNHNk1ZcFE4MXQwUE1teklONE8wNGZxaFowdTFZUHY2Nm1peHRrWDNpVGkyOTFEZ3dUM281a296ZlFoZTA4LVJBRXhFbVhwb0NidWVQX1FZTSIsDQogICAgICAgICAgICAgICAgICAgIHVzZUNvb2tpZXMNCiAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgLy8gV2luSHR0cEhhbmRsZXIgY2FsbHMgV2luSHR0cFF1ZXJ5SGVhZGVycyB0byBpdGVyYXRlIHRocm91Z2ggbXVsdGlwbGUgU2V0LUNvb2tpZSBoZWFkZXIgdmFsdWVzLA0KICAgICAgICAgICAgICAgIC8vIHVzaW5nIGFuIGluaXRpYWwgYnVmZmVyIHNpemUgb2YgMTI4IGNoYXJzLiBJZiB0aGUgYnVmZmVyIGlzIG5vdCBsYXJnZSBlbm91Z2gsIFdpbkh0dHBRdWVyeUhlYWRlcnMNCiAgICAgICAgICAgICAgICAvLyByZXR1cm5zIGFuIGluc3VmZmljaWVudCBidWZmZXIgZXJyb3IsIGFsbG93aW5nIFdpbkh0dHBIYW5kbGVyIHRvIHRyeSBhZ2FpbiB3aXRoIGEgbGFyZ2VyIGJ1ZmZlci4NCiAgICAgICAgICAgICAgICAvLyBTb21ldGltZXMgd2hlbiBXaW5IdHRwUXVlcnlIZWFkZXJzIGZhaWxzIGR1ZSB0byBpbnN1ZmZpY2llbnQgYnVmZmVyLCBpdCBzdGlsbCBhZHZhbmNlcyB0aGUNCiAgICAgICAgICAgICAgICAvLyBpdGVyYXRpb24gaW5kZXgsIHdoaWNoIHdvdWxkIGNhdXNlIGhlYWRlciB2YWx1ZXMgdG8gYmUgbWlzc2VkIGlmIG5vdCBoYW5kbGVkIGNvcnJlY3RseS4NCiAgICAgICAgICAgICAgICAvLw0KICAgICAgICAgICAgICAgIC8vIEluIHBhcnRpY3VsYXIsIFdpbkh0dHBRdWVyeUhlYWRlciBiZWhhdmVzIGFzIGZvbGxvd3MgZm9yIHRoZSBmb2xsb3dpbmcgaGVhZGVyIHZhbHVlIGxlbmd0aHM6DQogICAgICAgICAgICAgICAgLy8gICogMC0xMjcgY2hhcnM6IHN1Y2NlZWRzLCBpbmRleCBhZHZhbmNlcyBmcm9tIDAgdG8gMS4NCiAgICAgICAgICAgICAgICAvLyAgKiAxMjgtMjU1IGNoYXJzOiBmYWlscyBkdWUgdG8gaW5zdWZmaWNpZW50IGJ1ZmZlciwgaW5kZXggYWR2YW5jZXMgZnJvbSAwIHRvIDEuDQogICAgICAgICAgICAgICAgLy8gICogMjU2KyBjaGFyczogZmFpbHMgZHVlIHRvIGluc3VmZmljaWVudCBidWZmZXIsIGluZGV4IHN0YXlzIGF0IDAuDQogICAgICAgICAgICAgICAgLy8NCiAgICAgICAgICAgICAgICAvLyBUaGUgYmVsb3cgb3ZlcmFsbCBoZWFkZXIgdmFsdWUgbGVuZ3RocyB3ZXJlIGNob3NlbiB0byBleGVyY2lzZSByZWFkaW5nIGhlYWRlciB2YWx1ZXMgYXQgdGhlc2UNCiAgICAgICAgICAgICAgICAvLyBlZGdlcywgdG8gZW5zdXJlIFdpbkh0dHBIYW5kbGVyIGRvZXMgbm90IG1pc3MgbXVsdGlwbGUgU2V0LUNvb2tpZSBoZWFkZXJzLg0KDQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJmb28iLCBHZW5lcmF0ZUNvb2tpZShuYW1lOiAiZm9vIiwgcmVwZWF0OiAnYScsIG92ZXJhbGxIZWFkZXJWYWx1ZUxlbmd0aDogMTI2KSwgdXNlQ29va2llcyB9Ow0KICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiZm9vIiwgR2VuZXJhdGVDb29raWUobmFtZTogImZvbyIsIHJlcGVhdDogJ2EnLCBvdmVyYWxsSGVhZGVyVmFsdWVMZW5ndGg6IDEyNyksIHVzZUNvb2tpZXMgfTsNCiAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgImZvbyIsIEdlbmVyYXRlQ29va2llKG5hbWU6ICJmb28iLCByZXBlYXQ6ICdhJywgb3ZlcmFsbEhlYWRlclZhbHVlTGVuZ3RoOiAxMjgpLCB1c2VDb29raWVzIH07DQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJmb28iLCBHZW5lcmF0ZUNvb2tpZShuYW1lOiAiZm9vIiwgcmVwZWF0OiAnYScsIG92ZXJhbGxIZWFkZXJWYWx1ZUxlbmd0aDogMTI5KSwgdXNlQ29va2llcyB9Ow0KDQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJmb28iLCBHZW5lcmF0ZUNvb2tpZShuYW1lOiAiZm9vIiwgcmVwZWF0OiAnYScsIG92ZXJhbGxIZWFkZXJWYWx1ZUxlbmd0aDogMjU0KSwgdXNlQ29va2llcyB9Ow0KICAgICAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiZm9vIiwgR2VuZXJhdGVDb29raWUobmFtZTogImZvbyIsIHJlcGVhdDogJ2EnLCBvdmVyYWxsSGVhZGVyVmFsdWVMZW5ndGg6IDI1NSksIHVzZUNvb2tpZXMgfTsNCiAgICAgICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgImZvbyIsIEdlbmVyYXRlQ29va2llKG5hbWU6ICJmb28iLCByZXBlYXQ6ICdhJywgb3ZlcmFsbEhlYWRlclZhbHVlTGVuZ3RoOiAyNTYpLCB1c2VDb29raWVzIH07DQogICAgICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJmb28iLCBHZW5lcmF0ZUNvb2tpZShuYW1lOiAiZm9vIiwgcmVwZWF0OiAnYScsIG92ZXJhbGxIZWFkZXJWYWx1ZUxlbmd0aDogMjU3KSwgdXNlQ29va2llcyB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KDQpuYW1lc3BhY2UgU3lzdGVtLk5ldC5IdHRwLkZ1bmN0aW9uYWwuVGVzdHMNCnsNCiAgICB1c2luZyBDb25maWd1cmF0aW9uID0gU3lzdGVtLk5ldC5UZXN0LkNvbW1vbi5Db25maWd1cmF0aW9uOw0KDQogICAgLy8gTm90ZTogIERpc3Bvc2luZyB0aGUgSHR0cENsaWVudCBvYmplY3QgYXV0b21hdGljYWxseSBkaXNwb3NlcyB0aGUgaGFuZGxlciB3aXRoaW4uIFNvLCBpdCBpcyBub3QgbmVjZXNzYXJ5DQogICAgLy8gdG8gc2VwYXJhdGVseSBEaXNwb3NlIChvciBoYXZlIGEgJ3VzaW5nJyBzdGF0ZW1lbnQpIGZvciB0aGUgaGFuZGxlci4NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCwgImRvdG5ldC9jb3JlZnggIzIwMDEwIildDQogICAgcHVibGljIGFic3RyYWN0IGNsYXNzIFBvc3RTY2VuYXJpb1Rlc3QgOiBIdHRwQ2xpZW50VGVzdEJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIEV4cGVjdGVkQ29udGVudCA9ICJUZXN0IGNvbnRlc3QiOw0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBVc2VyTmFtZSA9ICJ1c2VyMSI7DQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIFBhc3N3b3JkID0gInBhc3N3b3JkMSI7DQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFVyaSBCYXNpY0F1dGhTZXJ2ZXJVcmkgPQ0KICAgICAgICAgICAgQ29uZmlndXJhdGlvbi5IdHRwLkJhc2ljQXV0aFVyaUZvckNyZWRzKGZhbHNlLCBVc2VyTmFtZSwgUGFzc3dvcmQpOw0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBVcmkgU2VjdXJlQmFzaWNBdXRoU2VydmVyVXJpID0NCiAgICAgICAgICAgIENvbmZpZ3VyYXRpb24uSHR0cC5CYXNpY0F1dGhVcmlGb3JDcmVkcyh0cnVlLCBVc2VyTmFtZSwgUGFzc3dvcmQpOw0KDQogICAgICAgIHByaXZhdGUgcmVhZG9ubHkgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IG9iamVjdFtdW10gRWNob1NlcnZlcnMgPSBDb25maWd1cmF0aW9uLkh0dHAuRWNob1NlcnZlcnM7DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyByZWFkb25seSBvYmplY3RbXVtdIEJhc2ljQXV0aEVjaG9TZXJ2ZXJzID0NCiAgICAgICAgICAgIG5ldyBvYmplY3RbXVtdDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBuZXcgb2JqZWN0W10geyBCYXNpY0F1dGhTZXJ2ZXJVcmkgfSwNCiAgICAgICAgICAgICAgICAgICAgbmV3IG9iamVjdFtdIHsgU2VjdXJlQmFzaWNBdXRoU2VydmVyVXJpIH0NCiAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgIHB1YmxpYyBQb3N0U2NlbmFyaW9UZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihFY2hvU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0Tm9Db250ZW50VXNpbmdDb250ZW50TGVuZ3RoU2VtYW50aWNzX1N1Y2Nlc3MoVXJpIHNlcnZlclVyaSkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgUG9zdEhlbHBlcihzZXJ2ZXJVcmksIHN0cmluZy5FbXB0eSwgbnVsbCwNCiAgICAgICAgICAgICAgICB1c2VDb250ZW50TGVuZ3RoVXBsb2FkOiB0cnVlLCB1c2VDaHVua2VkRW5jb2RpbmdVcGxvYWQ6IGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihFY2hvU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0RW1wdHlDb250ZW50VXNpbmdDb250ZW50TGVuZ3RoU2VtYW50aWNzX1N1Y2Nlc3MoVXJpIHNlcnZlclVyaSkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgUG9zdEhlbHBlcihzZXJ2ZXJVcmksIHN0cmluZy5FbXB0eSwgbmV3IFN0cmluZ0NvbnRlbnQoc3RyaW5nLkVtcHR5KSwNCiAgICAgICAgICAgICAgICB1c2VDb250ZW50TGVuZ3RoVXBsb2FkOiB0cnVlLCB1c2VDaHVua2VkRW5jb2RpbmdVcGxvYWQ6IGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihFY2hvU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0RW1wdHlDb250ZW50VXNpbmdDaHVua2VkRW5jb2RpbmdfU3VjY2VzcyhVcmkgc2VydmVyVXJpKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBQb3N0SGVscGVyKHNlcnZlclVyaSwgc3RyaW5nLkVtcHR5LCBuZXcgU3RyaW5nQ29udGVudChzdHJpbmcuRW1wdHkpLA0KICAgICAgICAgICAgICAgIHVzZUNvbnRlbnRMZW5ndGhVcGxvYWQ6IGZhbHNlLCB1c2VDaHVua2VkRW5jb2RpbmdVcGxvYWQ6IHRydWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKEVjaG9TZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RFbXB0eUNvbnRlbnRVc2luZ0NvbmZsaWN0aW5nU2VtYW50aWNzX1N1Y2Nlc3MoVXJpIHNlcnZlclVyaSkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgUG9zdEhlbHBlcihzZXJ2ZXJVcmksIHN0cmluZy5FbXB0eSwgbmV3IFN0cmluZ0NvbnRlbnQoc3RyaW5nLkVtcHR5KSwNCiAgICAgICAgICAgICAgICB1c2VDb250ZW50TGVuZ3RoVXBsb2FkOiB0cnVlLCB1c2VDaHVua2VkRW5jb2RpbmdVcGxvYWQ6IHRydWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKEVjaG9TZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RVc2luZ0NvbnRlbnRMZW5ndGhTZW1hbnRpY3NfU3VjY2VzcyhVcmkgc2VydmVyVXJpKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBQb3N0SGVscGVyKHNlcnZlclVyaSwgRXhwZWN0ZWRDb250ZW50LCBuZXcgU3RyaW5nQ29udGVudChFeHBlY3RlZENvbnRlbnQpLA0KICAgICAgICAgICAgICAgIHVzZUNvbnRlbnRMZW5ndGhVcGxvYWQ6IHRydWUsIHVzZUNodW5rZWRFbmNvZGluZ1VwbG9hZDogZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKEVjaG9TZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RVc2luZ0NodW5rZWRFbmNvZGluZ19TdWNjZXNzKFVyaSBzZXJ2ZXJVcmkpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IFBvc3RIZWxwZXIoc2VydmVyVXJpLCBFeHBlY3RlZENvbnRlbnQsIG5ldyBTdHJpbmdDb250ZW50KEV4cGVjdGVkQ29udGVudCksDQogICAgICAgICAgICAgICAgdXNlQ29udGVudExlbmd0aFVwbG9hZDogZmFsc2UsIHVzZUNodW5rZWRFbmNvZGluZ1VwbG9hZDogdHJ1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoRWNob1NlcnZlcnMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUG9zdFN5bmNCbG9ja2luZ0NvbnRlbnRVc2luZ0NodW5rZWRFbmNvZGluZ19TdWNjZXNzKFVyaSBzZXJ2ZXJVcmkpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IFBvc3RIZWxwZXIoc2VydmVyVXJpLCBFeHBlY3RlZENvbnRlbnQsIG5ldyBTeW5jQmxvY2tpbmdDb250ZW50KEV4cGVjdGVkQ29udGVudCksDQogICAgICAgICAgICAgICAgdXNlQ29udGVudExlbmd0aFVwbG9hZDogZmFsc2UsIHVzZUNodW5rZWRFbmNvZGluZ1VwbG9hZDogdHJ1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoRWNob1NlcnZlcnMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUG9zdFJlcGVhdGVkRmx1c2hDb250ZW50VXNpbmdDaHVua2VkRW5jb2RpbmdfU3VjY2VzcyhVcmkgc2VydmVyVXJpKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBQb3N0SGVscGVyKHNlcnZlclVyaSwgRXhwZWN0ZWRDb250ZW50LCBuZXcgUmVwZWF0ZWRGbHVzaENvbnRlbnQoRXhwZWN0ZWRDb250ZW50KSwNCiAgICAgICAgICAgICAgICB1c2VDb250ZW50TGVuZ3RoVXBsb2FkOiBmYWxzZSwgdXNlQ2h1bmtlZEVuY29kaW5nVXBsb2FkOiB0cnVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihFY2hvU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0VXNpbmdVc2luZ0NvbmZsaWN0aW5nU2VtYW50aWNzX1VzZXNDaHVua2VkU2VtYW50aWNzKFVyaSBzZXJ2ZXJVcmkpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IFBvc3RIZWxwZXIoc2VydmVyVXJpLCBFeHBlY3RlZENvbnRlbnQsIG5ldyBTdHJpbmdDb250ZW50KEV4cGVjdGVkQ29udGVudCksDQogICAgICAgICAgICAgICAgdXNlQ29udGVudExlbmd0aFVwbG9hZDogdHJ1ZSwgdXNlQ2h1bmtlZEVuY29kaW5nVXBsb2FkOiB0cnVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihFY2hvU2VydmVycykpXQ0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgIm5ldGZ4IGJlaGF2ZXMgZGlmZmVyZW50bHkgYW5kIHdpbGwgYnVmZmVyIGNvbnRlbnQgYW5kIHVzZSAnQ29udGVudC1MZW5ndGgnIHNlbWFudGljcyIpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0VXNpbmdOb1NwZWNpZmllZFNlbWFudGljc19Vc2VzQ2h1bmtlZFNlbWFudGljcyhVcmkgc2VydmVyVXJpKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBQb3N0SGVscGVyKHNlcnZlclVyaSwgRXhwZWN0ZWRDb250ZW50LCBuZXcgU3RyaW5nQ29udGVudChFeHBlY3RlZENvbnRlbnQpLA0KICAgICAgICAgICAgICAgIHVzZUNvbnRlbnRMZW5ndGhVcGxvYWQ6IGZhbHNlLCB1c2VDaHVua2VkRW5jb2RpbmdVcGxvYWQ6IGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSg1ICogMTAyNCldDQogICAgICAgIFtJbmxpbmVEYXRhKDYzICogMTAyNCldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RMb25nZXJDb250ZW50TGVuZ3Roc19Vc2VzQ2h1bmtlZFNlbWFudGljcyhpbnQgY29udGVudExlbmd0aCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHJhbmQgPSBuZXcgUmFuZG9tKDQyKTsNCiAgICAgICAgICAgIHZhciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKGNvbnRlbnRMZW5ndGgpOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb250ZW50TGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2IuQXBwZW5kKChjaGFyKShyYW5kLk5leHQoMCwgMjYpICsgJ2EnKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdHJpbmcgY29udGVudCA9IHNiLlRvU3RyaW5nKCk7DQoNCiAgICAgICAgICAgIGF3YWl0IFBvc3RIZWxwZXIoQ29uZmlndXJhdGlvbi5IdHRwLlJlbW90ZUVjaG9TZXJ2ZXIsIGNvbnRlbnQsIG5ldyBTdHJpbmdDb250ZW50KGNvbnRlbnQpLA0KICAgICAgICAgICAgICAgIHVzZUNvbnRlbnRMZW5ndGhVcGxvYWQ6IHRydWUsIHVzZUNodW5rZWRFbmNvZGluZ1VwbG9hZDogZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKEJhc2ljQXV0aEVjaG9TZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3RSZXdpbmRhYmxlQ29udGVudFVzaW5nQXV0aF9Ob1ByZUF1dGhlbnRpY2F0ZV9TdWNjZXNzKFVyaSBzZXJ2ZXJVcmkpDQogICAgICAgIHsNCiAgICAgICAgICAgIEh0dHBDb250ZW50IGNvbnRlbnQgPSBDdXN0b21Db250ZW50LkNyZWF0ZShFeHBlY3RlZENvbnRlbnQsIHRydWUpOw0KICAgICAgICAgICAgdmFyIGNyZWRlbnRpYWwgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoVXNlck5hbWUsIFBhc3N3b3JkKTsNCiAgICAgICAgICAgIGF3YWl0IFBvc3RVc2luZ0F1dGhIZWxwZXIoc2VydmVyVXJpLCBFeHBlY3RlZENvbnRlbnQsIGNvbnRlbnQsIGNyZWRlbnRpYWwsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdIC8vIFRPRE86IElzc3VlICMxMTM0NQ0KICAgICAgICBbVGhlb3J5LCBNZW1iZXJEYXRhKG5hbWVvZihCYXNpY0F1dGhFY2hvU2VydmVycykpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBQb3N0Tm9uUmV3aW5kYWJsZUNvbnRlbnRVc2luZ0F1dGhfTm9QcmVBdXRoZW50aWNhdGVfVGhyb3dzSHR0cFJlcXVlc3RFeGNlcHRpb24oVXJpIHNlcnZlclVyaSkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cENvbnRlbnQgY29udGVudCA9IEN1c3RvbUNvbnRlbnQuQ3JlYXRlKEV4cGVjdGVkQ29udGVudCwgZmFsc2UpOw0KICAgICAgICAgICAgdmFyIGNyZWRlbnRpYWwgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoVXNlck5hbWUsIFBhc3N3b3JkKTsNCiAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxIdHRwUmVxdWVzdEV4Y2VwdGlvbj4oKCkgPT4gDQogICAgICAgICAgICAgICAgUG9zdFVzaW5nQXV0aEhlbHBlcihzZXJ2ZXJVcmksIEV4cGVjdGVkQ29udGVudCwgY29udGVudCwgY3JlZGVudGlhbCwgcHJlQXV0aGVudGljYXRlOiBmYWxzZSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0gLy8gVE9ETzogSXNzdWUgIzExMzQ1DQogICAgICAgIFtUaGVvcnksIE1lbWJlckRhdGEobmFtZW9mKEJhc2ljQXV0aEVjaG9TZXJ2ZXJzKSldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIFBvc3ROb25SZXdpbmRhYmxlQ29udGVudFVzaW5nQXV0aF9QcmVBdXRoZW50aWNhdGVfU3VjY2VzcyhVcmkgc2VydmVyVXJpKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNXaW5IdHRwSGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBJc3N1ZSAjOTIyOA0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgSHR0cENvbnRlbnQgY29udGVudCA9IEN1c3RvbUNvbnRlbnQuQ3JlYXRlKEV4cGVjdGVkQ29udGVudCwgZmFsc2UpOw0KICAgICAgICAgICAgdmFyIGNyZWRlbnRpYWwgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoVXNlck5hbWUsIFBhc3N3b3JkKTsNCiAgICAgICAgICAgIGF3YWl0IFBvc3RVc2luZ0F1dGhIZWxwZXIoc2VydmVyVXJpLCBFeHBlY3RlZENvbnRlbnQsIGNvbnRlbnQsIGNyZWRlbnRpYWwsIHByZUF1dGhlbnRpY2F0ZTogdHJ1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wXSAvLyBUT0RPOiBJc3N1ZSAjMTEzNDUNCiAgICAgICAgW1RoZW9yeSwgTWVtYmVyRGF0YShuYW1lb2YoRWNob1NlcnZlcnMpKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgUG9zdEFzeW5jX0VtcHR5Q29udGVudF9Db250ZW50VHlwZUhlYWRlck5vdFNlbnQoVXJpIHNlcnZlclVyaSkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuUG9zdEFzeW5jKHNlcnZlclVyaSwgbnVsbCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlQ29udGVudCA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICBib29sIHNlbnRDb250ZW50VHlwZSA9IFRlc3RIZWxwZXIuSnNvbk1lc3NhZ2VDb250YWluc0tleShyZXNwb25zZUNvbnRlbnQsICJDb250ZW50LVR5cGUiKTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShzZW50Q29udGVudFR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBhc3luYyBUYXNrIFBvc3RIZWxwZXIoDQogICAgICAgICAgICBVcmkgc2VydmVyVXJpLA0KICAgICAgICAgICAgc3RyaW5nIHJlcXVlc3RCb2R5LA0KICAgICAgICAgICAgSHR0cENvbnRlbnQgcmVxdWVzdENvbnRlbnQsDQogICAgICAgICAgICBib29sIHVzZUNvbnRlbnRMZW5ndGhVcGxvYWQsDQogICAgICAgICAgICBib29sIHVzZUNodW5rZWRFbmNvZGluZ1VwbG9hZCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0Q29udGVudCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZUNvbnRlbnRMZW5ndGhVcGxvYWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB0aGF0IENvbnRlbnQtTGVuZ3RoIGlzIHBvcHVsYXRlZCAoc2VlIGlzc3VlICMyNzI0NSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RDb250ZW50LkhlYWRlcnMuQ29udGVudExlbmd0aCA9IHJlcXVlc3RDb250ZW50LkhlYWRlcnMuQ29udGVudExlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RDb250ZW50LkhlYWRlcnMuQ29udGVudExlbmd0aCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHVzZUNodW5rZWRFbmNvZGluZ1VwbG9hZCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNsaWVudC5EZWZhdWx0UmVxdWVzdEhlYWRlcnMuVHJhbnNmZXJFbmNvZGluZ0NodW5rZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlBvc3RBc3luYyhzZXJ2ZXJVcmksIHJlcXVlc3RDb250ZW50KSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHJlc3BvbnNlQ29udGVudCk7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VDb250ZW50TGVuZ3RoVXBsb2FkICYmICF1c2VDaHVua2VkRW5jb2RpbmdVcGxvYWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzZUNodW5rZWRFbmNvZGluZ1VwbG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBUZXN0SGVscGVyLlZlcmlmeVJlc3BvbnNlQm9keSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29udGVudCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLkNvbnRlbnQuSGVhZGVycy5Db250ZW50TUQ1LA0KICAgICAgICAgICAgICAgICAgICAgICAgdXNlQ2h1bmtlZEVuY29kaW5nVXBsb2FkLA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEJvZHkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gICAgICAgICAgDQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGFzeW5jIFRhc2sgUG9zdFVzaW5nQXV0aEhlbHBlcigNCiAgICAgICAgICAgIFVyaSBzZXJ2ZXJVcmksDQogICAgICAgICAgICBzdHJpbmcgcmVxdWVzdEJvZHksDQogICAgICAgICAgICBIdHRwQ29udGVudCByZXF1ZXN0Q29udGVudCwNCiAgICAgICAgICAgIE5ldHdvcmtDcmVkZW50aWFsIGNyZWRlbnRpYWwsDQogICAgICAgICAgICBib29sIHByZUF1dGhlbnRpY2F0ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKCk7DQogICAgICAgICAgICBoYW5kbGVyLlByZUF1dGhlbnRpY2F0ZSA9IHByZUF1dGhlbnRpY2F0ZTsNCiAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBjcmVkZW50aWFsOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBTZW5kIEhFQUQgcmVxdWVzdCB0byBoZWxwIGJ5cGFzcyB0aGUgNDAxIGF1dGggY2hhbGxlbmdlIGZvciB0aGUgbGF0dGVyIFBPU1QgYXNzdW1pbmcNCiAgICAgICAgICAgICAgICAvLyB0aGF0IHRoZSBhdXRoZW50aWNhdGlvbiB3aWxsIGJlIGNhY2hlZCBhbmQgcmUtdXNlZCBsYXRlciB3aGVuIFByZUF1dGhlbnRpY2F0ZSBpcyB0cnVlLg0KICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLkhlYWQsIHNlcnZlclVyaSk7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBSZXNwb25zZU1lc3NhZ2UgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBOb3cgc2VuZCBQT1NUIHJlcXVlc3QuDQogICAgICAgICAgICAgICAgcmVxdWVzdCA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UoSHR0cE1ldGhvZC5Qb3N0LCBzZXJ2ZXJVcmkpOw0KICAgICAgICAgICAgICAgIHJlcXVlc3QuQ29udGVudCA9IHJlcXVlc3RDb250ZW50Ow0KICAgICAgICAgICAgICAgIHJlcXVlc3RDb250ZW50LkhlYWRlcnMuQ29udGVudExlbmd0aCA9IG51bGw7DQogICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLlRyYW5zZmVyRW5jb2RpbmdDaHVua2VkID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlNlbmRBc3luYyhyZXF1ZXN0KSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChIdHRwU3RhdHVzQ29kZS5PSywgcmVzcG9uc2UuU3RhdHVzQ29kZSk7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHJlc3BvbnNlQ29udGVudCk7DQoNCiAgICAgICAgICAgICAgICAgICAgVGVzdEhlbHBlci5WZXJpZnlSZXNwb25zZUJvZHkoDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvbnRlbnQsDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5Db250ZW50LkhlYWRlcnMuQ29udGVudE1ENSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Qm9keSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5EaWFnbm9zdGljczsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5OZXQuSHR0cDsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KDQpuYW1lc3BhY2UgU3lzdGVtLk5ldC5IdHRwLkZ1bmN0aW9uYWwuVGVzdHMNCnsNCiAgICB1c2luZyBDb25maWd1cmF0aW9uID0gU3lzdGVtLk5ldC5UZXN0LkNvbW1vbi5Db25maWd1cmF0aW9uOw0KDQogICAgcHVibGljIGFic3RyYWN0IGNsYXNzIFBvc3RTY2VuYXJpb1VXUFRlc3QgOiBIdHRwQ2xpZW50VGVzdEJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgcmVhZG9ubHkgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCg0KICAgICAgICBwdWJsaWMgUG9zdFNjZW5hcmlvVVdQVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgQXV0aGVudGljYXRpb25fVXNlU3RyZWFtQ29udGVudF9UaHJvd3MoKQ0KICAgICAgICB7DQogICAgICAgICAgICBSZW1vdGVJbnZva2UoYXN5bmMgdXNlU29ja2V0c0h0dHBIYW5kbGVyU3RyaW5nID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVGhpcyB0ZXN0IHZhbGlkYXRlcyB0aGUgY3VycmVudCBsaW1pdGF0aW9uIG9mIENvcmVGeCdzIE5ldEZ4VG9XaW5SdFN0cmVhbUFkYXB0ZXINCiAgICAgICAgICAgICAgICAvLyB3aGljaCB0aHJvd3MgZXhjZXB0aW9ucyB3aGVuIHRyeWluZyB0byByZXdpbmQgYSAuTkVUIFN0cmVhbSB3aGVuIGl0IG5lZWRzIHRvIGJlDQogICAgICAgICAgICAgICAgLy8gcmUtUE9TVCdkIHRvIHRoZSBzZXJ2ZXIuDQogICAgICAgICAgICAgICAgc3RyaW5nIHVzZXJuYW1lID0gInRlc3R1c2VyIjsNCiAgICAgICAgICAgICAgICBzdHJpbmcgcGFzc3dvcmQgPSAicGFzc3dvcmQiOw0KICAgICAgICAgICAgICAgIFVyaSB1cmkgPSBDb25maWd1cmF0aW9uLkh0dHAuQmFzaWNBdXRoVXJpRm9yQ3JlZHMoc2VjdXJlOiBmYWxzZSwgdXNlck5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmQpOw0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcih1c2VTb2NrZXRzSHR0cEhhbmRsZXJTdHJpbmcpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwodXNlcm5hbWUsIHBhc3N3b3JkKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBieXRlW10gcG9zdERhdGEgPSBFbmNvZGluZy5VVEY4LkdldEJ5dGVzKCJUaGlzIGlzIGRhdGEgdG8gcG9zdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0ocG9zdERhdGEsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBuZXcgU3RyZWFtQ29udGVudChzdHJlYW0pOw0KDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxIdHRwUmVxdWVzdEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50LlBvc3RBc3luYyh1cmksIGNvbnRlbnQpKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gU3VjY2Vzc0V4aXRDb2RlOw0KICAgICAgICAgICAgfSwgVXNlU29ja2V0c0h0dHBIYW5kbGVyLlRvU3RyaW5nKCkpLkRpc3Bvc2UoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBBdXRoZW50aWNhdGlvbl9Vc2VNdWx0aUludGVyZmFjZU5vblJld2luZGFibGVTdHJlYW1Db250ZW50X1Rocm93cygpDQogICAgICAgIHsNCiAgICAgICAgICAgIFJlbW90ZUludm9rZShhc3luYyB1c2VTb2NrZXRzSHR0cEhhbmRsZXJTdHJpbmcgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgdXNlcm5hbWUgPSAidGVzdHVzZXIiOw0KICAgICAgICAgICAgICAgIHN0cmluZyBwYXNzd29yZCA9ICJwYXNzd29yZCI7DQogICAgICAgICAgICAgICAgVXJpIHVyaSA9IENvbmZpZ3VyYXRpb24uSHR0cC5CYXNpY0F1dGhVcmlGb3JDcmVkcyhzZWN1cmU6IGZhbHNlLCB1c2VyTmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZCk7ICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciA9IENyZWF0ZUh0dHBDbGllbnRIYW5kbGVyKHVzZVNvY2tldHNIdHRwSGFuZGxlclN0cmluZyk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5DcmVkZW50aWFscyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbCh1c2VybmFtZSwgcGFzc3dvcmQpOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBwb3N0RGF0YSA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoIlRoaXMgaXMgZGF0YSB0byBwb3N0LiIpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgc3RyZWFtID0gbmV3IE11bHRpSW50ZXJmYWNlTm9uUmV3aW5kYWJsZVJlYWRPbmx5U3RyZWFtKHBvc3REYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBuZXcgTXVsdGlJbnRlcmZhY2VTdHJlYW1Db250ZW50KHN0cmVhbSk7DQoNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FzeW5jPEh0dHBSZXF1ZXN0RXhjZXB0aW9uPigoKSA9PiBjbGllbnQuUG9zdEFzeW5jKHVyaSwgY29udGVudCkpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiBTdWNjZXNzRXhpdENvZGU7DQogICAgICAgICAgICB9LCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIuVG9TdHJpbmcoKSkuRGlzcG9zZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIEF1dGhlbnRpY2F0aW9uX1VzZU11bHRpSW50ZXJmYWNlU3RyZWFtQ29udGVudF9TdWNjZXNzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgUmVtb3RlSW52b2tlKGFzeW5jIHVzZVNvY2tldHNIdHRwSGFuZGxlclN0cmluZyA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyB1c2VybmFtZSA9ICJ0ZXN0dXNlciI7DQogICAgICAgICAgICAgICAgc3RyaW5nIHBhc3N3b3JkID0gInBhc3N3b3JkIjsNCiAgICAgICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLkJhc2ljQXV0aFVyaUZvckNyZWRzKHNlY3VyZTogZmFsc2UsIHVzZXJOYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkKTsgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIodXNlU29ja2V0c0h0dHBIYW5kbGVyU3RyaW5nKTsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkNyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKHVzZXJuYW1lLCBwYXNzd29yZCk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIHBvc3REYXRhID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcygiVGhpcyBpcyBkYXRhIHRvIHBvc3QuIik7DQogICAgICAgICAgICAgICAgICAgIHZhciBzdHJlYW0gPSBuZXcgTXVsdGlJbnRlcmZhY2VSZWFkT25seVN0cmVhbShwb3N0RGF0YSk7DQogICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gbmV3IE11bHRpSW50ZXJmYWNlU3RyZWFtQ29udGVudChzdHJlYW0pOw0KDQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlBvc3RBc3luYyh1cmksIGNvbnRlbnQpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlQ29udGVudCA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiBTdWNjZXNzRXhpdENvZGU7DQogICAgICAgICAgICB9LCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIuVG9TdHJpbmcoKSkuRGlzcG9zZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIEF1dGhlbnRpY2F0aW9uX1VzZU1lbW9yeVN0cmVhbVZpc2libGVCdWZmZXJDb250ZW50X1N1Y2Nlc3MoKQ0KICAgICAgICB7DQogICAgICAgICAgICBSZW1vdGVJbnZva2UoYXN5bmMgdXNlU29ja2V0c0h0dHBIYW5kbGVyU3RyaW5nID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIHVzZXJuYW1lID0gInRlc3R1c2VyIjsNCiAgICAgICAgICAgICAgICBzdHJpbmcgcGFzc3dvcmQgPSAicGFzc3dvcmQiOw0KICAgICAgICAgICAgICAgIFVyaSB1cmkgPSBDb25maWd1cmF0aW9uLkh0dHAuQmFzaWNBdXRoVXJpRm9yQ3JlZHMoc2VjdXJlOiBmYWxzZSwgdXNlck5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmQpOyAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIEh0dHBDbGllbnRIYW5kbGVyIGhhbmRsZXIgPSBDcmVhdGVIdHRwQ2xpZW50SGFuZGxlcih1c2VTb2NrZXRzSHR0cEhhbmRsZXJTdHJpbmcpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwodXNlcm5hbWUsIHBhc3N3b3JkKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBieXRlW10gcG9zdERhdGEgPSBFbmNvZGluZy5VVEY4LkdldEJ5dGVzKCJUaGlzIGlzIGRhdGEgdG8gcG9zdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0ocG9zdERhdGEsIDAsIHBvc3REYXRhLkxlbmd0aCwgZmFsc2UsIHRydWUpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IG5ldyBNdWx0aUludGVyZmFjZVN0cmVhbUNvbnRlbnQoc3RyZWFtKTsNCg0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5Qb3N0QXN5bmModXJpLCBjb250ZW50KSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEh0dHBTdGF0dXNDb2RlLk9LLCByZXNwb25zZS5TdGF0dXNDb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUNvbnRlbnQgPSBhd2FpdCByZXNwb25zZS5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gU3VjY2Vzc0V4aXRDb2RlOw0KICAgICAgICAgICAgfSwgVXNlU29ja2V0c0h0dHBIYW5kbGVyLlRvU3RyaW5nKCkpLkRpc3Bvc2UoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBBdXRoZW50aWNhdGlvbl9Vc2VNZW1vcnlTdHJlYW1Ob3RWaXNpYmxlQnVmZmVyQ29udGVudF9TdWNjZXNzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgUmVtb3RlSW52b2tlKGFzeW5jIHVzZVNvY2tldHNIdHRwSGFuZGxlclN0cmluZyA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyB1c2VybmFtZSA9ICJ0ZXN0dXNlciI7DQogICAgICAgICAgICAgICAgc3RyaW5nIHBhc3N3b3JkID0gInBhc3N3b3JkIjsNCiAgICAgICAgICAgICAgICBVcmkgdXJpID0gQ29uZmlndXJhdGlvbi5IdHRwLkJhc2ljQXV0aFVyaUZvckNyZWRzKHNlY3VyZTogZmFsc2UsIHVzZXJOYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkKTsgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBIdHRwQ2xpZW50SGFuZGxlciBoYW5kbGVyID0gQ3JlYXRlSHR0cENsaWVudEhhbmRsZXIodXNlU29ja2V0c0h0dHBIYW5kbGVyU3RyaW5nKTsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkNyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKHVzZXJuYW1lLCBwYXNzd29yZCk7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIHBvc3REYXRhID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcygiVGhpcyBpcyBkYXRhIHRvIHBvc3QuIik7DQogICAgICAgICAgICAgICAgICAgIHZhciBzdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKHBvc3REYXRhLCAwLCBwb3N0RGF0YS5MZW5ndGgsIGZhbHNlLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gbmV3IE11bHRpSW50ZXJmYWNlU3RyZWFtQ29udGVudChzdHJlYW0pOw0KDQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LlBvc3RBc3luYyh1cmksIGNvbnRlbnQpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoSHR0cFN0YXR1c0NvZGUuT0ssIHJlc3BvbnNlLlN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlQ29udGVudCA9IGF3YWl0IHJlc3BvbnNlLkNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiBTdWNjZXNzRXhpdENvZGU7DQogICAgICAgICAgICB9LCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIuVG9TdHJpbmcoKSkuRGlzcG9zZSgpOw0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uTmV0LlNlY3VyaXR5Ow0KdXNpbmcgU3lzdGVtLk5ldC5Tb2NrZXRzOw0KdXNpbmcgU3lzdGVtLk5ldC5UZXN0LkNvbW1vbjsNCnVzaW5nIFN5c3RlbS5TZWN1cml0eS5BdXRoZW50aWNhdGlvbjsNCnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuWDUwOUNlcnRpZmljYXRlczsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlRocmVhZGluZzsNCnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7DQp1c2luZyBYdW5pdDsNCnVzaW5nIFh1bml0LkFic3RyYWN0aW9uczsNCg0KbmFtZXNwYWNlIFN5c3RlbS5OZXQuSHR0cC5GdW5jdGlvbmFsLlRlc3RzDQp7DQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cFByb3RvY29sVGVzdHMgOiBIdHRwUHJvdG9jb2xUZXN0cw0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cFByb3RvY29sVGVzdHNfRHJpYmJsZSA6IEh0dHBQcm90b2NvbFRlc3RzX0RyaWJibGUNCiAgICB7DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX0h0dHBDbGllbnRUZXN0IDogSHR0cENsaWVudFRlc3QNCiAgICB7DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX0RpYWdub3N0aWNzVGVzdCA6IERpYWdub3N0aWNzVGVzdA0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cENsaWVudEVLVVRlc3QgOiBIdHRwQ2xpZW50RUtVVGVzdA0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cENsaWVudEhhbmRsZXJfRGFuZ2Vyb3VzQWNjZXB0QWxsQ2VydGlmaWNhdGVzVmFsaWRhdG9yX1Rlc3QgOiBIdHRwQ2xpZW50SGFuZGxlcl9EYW5nZXJvdXNBY2NlcHRBbGxDZXJ0aWZpY2F0ZXNWYWxpZGF0b3JfVGVzdA0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cENsaWVudEhhbmRsZXJfQ2xpZW50Q2VydGlmaWNhdGVzX1Rlc3QgOiBIdHRwQ2xpZW50SGFuZGxlcl9DbGllbnRDZXJ0aWZpY2F0ZXNfVGVzdA0KICAgIHsNCiAgICAgICAgcHVibGljIFNvY2tldHNIdHRwSGFuZGxlcl9IdHRwQ2xpZW50SGFuZGxlcl9DbGllbnRDZXJ0aWZpY2F0ZXNfVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpIHsgfQ0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYm9vbCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIgPT4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc2VhbGVkIGNsYXNzIFNvY2tldHNIdHRwSGFuZGxlcl9IdHRwQ2xpZW50SGFuZGxlcl9EZWZhdWx0UHJveHlDcmVkZW50aWFsc19UZXN0IDogSHR0cENsaWVudEhhbmRsZXJfRGVmYXVsdFByb3h5Q3JlZGVudGlhbHNfVGVzdA0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cENsaWVudEhhbmRsZXJfTWF4Q29ubmVjdGlvbnNQZXJTZXJ2ZXJfVGVzdCA6IEh0dHBDbGllbnRIYW5kbGVyX01heENvbm5lY3Rpb25zUGVyU2VydmVyX1Rlc3QNCiAgICB7DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX0h0dHBDbGllbnRIYW5kbGVyX1NlcnZlckNlcnRpZmljYXRlc19UZXN0IDogSHR0cENsaWVudEhhbmRsZXJfU2VydmVyQ2VydGlmaWNhdGVzX1Rlc3QNCiAgICB7DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX0h0dHBDbGllbnRIYW5kbGVyX1Jlc3BvbnNlRHJhaW5fVGVzdCA6IEh0dHBDbGllbnRIYW5kbGVyX1Jlc3BvbnNlRHJhaW5fVGVzdA0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQoNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIHZvaWQgU2V0UmVzcG9uc2VEcmFpblRpbWVvdXQoSHR0cENsaWVudEhhbmRsZXIgaGFuZGxlciwgVGltZVNwYW4gdGltZSkNCiAgICAgICAgew0KICAgICAgICAgICAgU29ja2V0c0h0dHBIYW5kbGVyIHMgPSAoU29ja2V0c0h0dHBIYW5kbGVyKUdldFVuZGVybHlpbmdTb2NrZXRzSHR0cEhhbmRsZXIoaGFuZGxlcik7DQogICAgICAgICAgICBBc3NlcnQuTm90TnVsbChzKTsNCiAgICAgICAgICAgIHMuUmVzcG9uc2VEcmFpblRpbWVvdXQgPSB0aW1lOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIE1heFJlc3BvbnNlRHJhaW5TaXplX1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEwMjQgKiAxMDI0LCBoYW5kbGVyLk1heFJlc3BvbnNlRHJhaW5TaXplKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuTWF4UmVzcG9uc2VEcmFpblNpemUgPSAwOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCBoYW5kbGVyLk1heFJlc3BvbnNlRHJhaW5TaXplKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuTWF4UmVzcG9uc2VEcmFpblNpemUgPSBpbnQuTWF4VmFsdWU7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGludC5NYXhWYWx1ZSwgaGFuZGxlci5NYXhSZXNwb25zZURyYWluU2l6ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgTWF4UmVzcG9uc2VEcmFpblNpemVfSW52YWxpZEFyZ3VtZW50X1Rocm93cygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMTAyNCAqIDEwMjQsIGhhbmRsZXIuTWF4UmVzcG9uc2VEcmFpblNpemUpOw0KDQogICAgICAgICAgICAgICAgQXNzZXJ0RXh0ZW5zaW9ucy5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigidmFsdWUiLCAoKSA9PiBoYW5kbGVyLk1heFJlc3BvbnNlRHJhaW5TaXplID0gLTEpOw0KICAgICAgICAgICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oInZhbHVlIiwgKCkgPT4gaGFuZGxlci5NYXhSZXNwb25zZURyYWluU2l6ZSA9IGludC5NaW5WYWx1ZSk7DQoNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMTAyNCAqIDEwMjQsIGhhbmRsZXIuTWF4UmVzcG9uc2VEcmFpblNpemUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIE1heFJlc3BvbnNlRHJhaW5TaXplX1NldEFmdGVyVXNlX1Rocm93cygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaGFuZGxlci5NYXhSZXNwb25zZURyYWluU2l6ZSA9IDE7DQogICAgICAgICAgICAgICAgY2xpZW50LkdldEFzeW5jKCJodHRwOi8vIiArIEd1aWQuTmV3R3VpZCgpLlRvU3RyaW5nKCJOIikpOyAvLyBpZ25vcmluZyBmYWlsdXJlDQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIGhhbmRsZXIuTWF4UmVzcG9uc2VEcmFpblNpemUpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8SW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbj4oKCkgPT4gaGFuZGxlci5NYXhSZXNwb25zZURyYWluU2l6ZSA9IDEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFJlc3BvbnNlRHJhaW5UaW1lb3V0X1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFRpbWVTcGFuLkZyb21TZWNvbmRzKDIpLCBoYW5kbGVyLlJlc3BvbnNlRHJhaW5UaW1lb3V0KTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuUmVzcG9uc2VEcmFpblRpbWVvdXQgPSBUaW1lU3Bhbi5aZXJvOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChUaW1lU3Bhbi5aZXJvLCBoYW5kbGVyLlJlc3BvbnNlRHJhaW5UaW1lb3V0KTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuUmVzcG9uc2VEcmFpblRpbWVvdXQgPSBUaW1lU3Bhbi5Gcm9tVGlja3MoaW50Lk1heFZhbHVlKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZVNwYW4uRnJvbVRpY2tzKGludC5NYXhWYWx1ZSksIGhhbmRsZXIuUmVzcG9uc2VEcmFpblRpbWVvdXQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIE1heFJlc3BvbnNlRHJhaVRpbWVfSW52YWxpZEFyZ3VtZW50X1Rocm93cygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZVNwYW4uRnJvbVNlY29uZHMoMiksIGhhbmRsZXIuUmVzcG9uc2VEcmFpblRpbWVvdXQpOw0KDQogICAgICAgICAgICAgICAgQXNzZXJ0RXh0ZW5zaW9ucy5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigidmFsdWUiLCAoKSA9PiBoYW5kbGVyLlJlc3BvbnNlRHJhaW5UaW1lb3V0ID0gVGltZVNwYW4uRnJvbVNlY29uZHMoLTEpKTsNCiAgICAgICAgICAgICAgICBBc3NlcnRFeHRlbnNpb25zLlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCJ2YWx1ZSIsICgpID0+IGhhbmRsZXIuUmVzcG9uc2VEcmFpblRpbWVvdXQgPSBUaW1lU3Bhbi5NYXhWYWx1ZSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0RXh0ZW5zaW9ucy5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigidmFsdWUiLCAoKSA9PiBoYW5kbGVyLlJlc3BvbnNlRHJhaW5UaW1lb3V0ID0gVGltZVNwYW4uRnJvbVNlY29uZHMoaW50Lk1heFZhbHVlKSk7DQoNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZVNwYW4uRnJvbVNlY29uZHMoMiksIGhhbmRsZXIuUmVzcG9uc2VEcmFpblRpbWVvdXQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFJlc3BvbnNlRHJhaW5UaW1lb3V0X1NldEFmdGVyVXNlX1Rocm93cygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaGFuZGxlci5SZXNwb25zZURyYWluVGltZW91dCA9IFRpbWVTcGFuLkZyb21TZWNvbmRzKDQyKTsNCiAgICAgICAgICAgICAgICBjbGllbnQuR2V0QXN5bmMoImh0dHA6Ly8iICsgR3VpZC5OZXdHdWlkKCkuVG9TdHJpbmcoIk4iKSk7IC8vIGlnbm9yaW5nIGZhaWx1cmUNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZVNwYW4uRnJvbVNlY29uZHMoNDIpLCBoYW5kbGVyLlJlc3BvbnNlRHJhaW5UaW1lb3V0KTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCgpID0+IGhhbmRsZXIuUmVzcG9uc2VEcmFpblRpbWVvdXQgPSBUaW1lU3Bhbi5Gcm9tU2Vjb25kcyg0MikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoMTAyNCAqIDEwMjQgKiAyLCA5XzUwMCwgMTAyNCAqIDEwMjQgKiAzLCBDb250ZW50TW9kZS5Db250ZW50TGVuZ3RoKV0NCiAgICAgICAgW0lubGluZURhdGEoMTAyNCAqIDEwMjQgKiAyLCA5XzUwMCwgMTAyNCAqIDEwMjQgKiAzLCBDb250ZW50TW9kZS5TaW5nbGVDaHVuayldDQogICAgICAgIFtJbmxpbmVEYXRhKDEwMjQgKiAxMDI0ICogMiwgOV81MDAsIDEwMjQgKiAxMDI0ICogMTMsIENvbnRlbnRNb2RlLkJ5dGVQZXJDaHVuayldDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIEdldEFzeW5jV2l0aE1heENvbm5lY3Rpb25zX0Rpc3Bvc2VCZWZvcmVSZWFkaW5nVG9FbmRfRHJhaW5zUmVxdWVzdHNVbmRlck1heERyYWluU2l6ZUFuZFJldXNlc0Nvbm5lY3Rpb24oaW50IHRvdGFsU2l6ZSwgaW50IHJlYWRTaXplLCBpbnQgbWF4RHJhaW5TaXplLCBDb250ZW50TW9kZSBtb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVDbGllbnRBbmRTZXJ2ZXJBc3luYygNCiAgICAgICAgICAgICAgICBhc3luYyB1cmwgPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpOw0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLk1heFJlc3BvbnNlRHJhaW5TaXplID0gbWF4RHJhaW5TaXplOw0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLlJlc3BvbnNlRHJhaW5UaW1lb3V0ID0gVGltZW91dC5JbmZpbml0ZVRpbWVTcGFuOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIFNldCBNYXhDb25uZWN0aW9uc1BlclNlcnZlciB0byAxLiAgVGhpcyB3aWxsIGVuc3VyZSB3ZSB3aWxsIHdhaXQgZm9yIHRoZSBwcmV2aW91cyByZXF1ZXN0IHRvIGRyYWluIChvciBmYWlsIHRvKQ0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLk1heENvbm5lY3Rpb25zUGVyU2VydmVyID0gMTsNCg0KICAgICAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlMSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmwsIEh0dHBDb21wbGV0aW9uT3B0aW9uLlJlc3BvbnNlSGVhZGVyc1JlYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVSZXNwb25zZUhlYWRlcnMocmVzcG9uc2UxLCB0b3RhbFNpemUsIG1vZGUpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIHBhcnQgYnV0IG5vdCBhbGwgb2YgcmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmVhbSByZXNwb25zZVN0cmVhbSA9IGF3YWl0IHJlc3BvbnNlMS5Db250ZW50LlJlYWRBc1N0cmVhbUFzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBSZWFkVG9CeXRlQ291bnQocmVzcG9uc2VTdHJlYW0sIHJlYWRTaXplKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UxLkRpc3Bvc2UoKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXNzdWUgYW5vdGhlciByZXF1ZXN0LiAgV2UnbGwgY29uZmlybSB0aGF0IGl0IGNvbWVzIG9uIHRoZSBzYW1lIGNvbm5lY3Rpb24uDQogICAgICAgICAgICAgICAgICAgICAgICBIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlMiA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVSZXNwb25zZUhlYWRlcnMocmVzcG9uc2UyLCB0b3RhbFNpemUsIG1vZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHRvdGFsU2l6ZSwgKGF3YWl0IHJlc3BvbnNlMi5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCkpLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGFzeW5jIHNlcnZlciA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGNvbnRlbnQgPSBuZXcgc3RyaW5nKCdhJywgdG90YWxTaXplKTsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlID0gR2V0UmVzcG9uc2VGb3JDb250ZW50TW9kZShjb250ZW50LCBtb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25Bc3luYyhhc3luYyBjb25uZWN0aW9uID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uUmVhZFJlcXVlc3RIZWFkZXJBbmRTZW5kQ3VzdG9tUmVzcG9uc2VBc3luYyhyZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZEN1c3RvbVJlc3BvbnNlQXN5bmMocmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3BdDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKDEwMF8wMDAsIDAsICBDb250ZW50TW9kZS5Db250ZW50TGVuZ3RoKV0NCiAgICAgICAgW0lubGluZURhdGEoMTAwXzAwMCwgMCwgQ29udGVudE1vZGUuU2luZ2xlQ2h1bmspXQ0KICAgICAgICBbSW5saW5lRGF0YSgxMDBfMDAwLCAwLCBDb250ZW50TW9kZS5CeXRlUGVyQ2h1bmspXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBHZXRBc3luY1dpdGhNYXhDb25uZWN0aW9uc19EaXNwb3NlTGFyZ2VyVGhhbk1heERyYWluU2l6ZV9LaWxsc0Nvbm5lY3Rpb24oaW50IHRvdGFsU2l6ZSwgaW50IG1heERyYWluU2l6ZSwgQ29udGVudE1vZGUgbW9kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlQ2xpZW50QW5kU2VydmVyQXN5bmMoDQogICAgICAgICAgICAgICAgYXN5bmMgdXJsID0+DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5NYXhSZXNwb25zZURyYWluU2l6ZSA9IG1heERyYWluU2l6ZTsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5SZXNwb25zZURyYWluVGltZW91dCA9IFRpbWVvdXQuSW5maW5pdGVUaW1lU3BhbjsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBTZXQgTWF4Q29ubmVjdGlvbnNQZXJTZXJ2ZXIgdG8gMS4gIFRoaXMgd2lsbCBlbnN1cmUgd2Ugd2lsbCB3YWl0IGZvciB0aGUgcHJldmlvdXMgcmVxdWVzdCB0byBkcmFpbiAob3IgZmFpbCB0bykNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5NYXhDb25uZWN0aW9uc1BlclNlcnZlciA9IDE7DQoNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZTEgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJsLCBIdHRwQ29tcGxldGlvbk9wdGlvbi5SZXNwb25zZUhlYWRlcnNSZWFkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlUmVzcG9uc2VIZWFkZXJzKHJlc3BvbnNlMSwgdG90YWxTaXplLCBtb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlMS5EaXNwb3NlKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElzc3VlIGFub3RoZXIgcmVxdWVzdC4gIFdlJ2xsIGNvbmZpcm0gdGhhdCBpdCBjb21lcyBvbiBhIG5ldyBjb25uZWN0aW9uLg0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZTIgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlUmVzcG9uc2VIZWFkZXJzKHJlc3BvbnNlMiwgdG90YWxTaXplLCBtb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCh0b3RhbFNpemUsIChhd2FpdCByZXNwb25zZTIuQ29udGVudC5SZWFkQXNTdHJpbmdBc3luYygpKS5MZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBhc3luYyBzZXJ2ZXIgPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb250ZW50ID0gbmV3IHN0cmluZygnYScsIHRvdGFsU2l6ZSk7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZSA9IEdldFJlc3BvbnNlRm9yQ29udGVudE1vZGUoY29udGVudCwgbW9kZSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbiA9Pg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlJlYWRSZXF1ZXN0SGVhZGVyQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uV3JpdGVyLldyaXRlQXN5bmMocmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbikgeyB9ICAgICAvLyBFYXQgZXJyb3JzIGZyb20gY2xpZW50IGRpc2Nvbm5lY3QuDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZEN1c3RvbVJlc3BvbnNlQW5kQ2xvc2VBc3luYyhyZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoQ29udGVudE1vZGUuQ29udGVudExlbmd0aCldDQogICAgICAgIFtJbmxpbmVEYXRhKENvbnRlbnRNb2RlLlNpbmdsZUNodW5rKV0NCiAgICAgICAgW0lubGluZURhdGEoQ29udGVudE1vZGUuQnl0ZVBlckNodW5rKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgR2V0QXN5bmNXaXRoTWF4Q29ubmVjdGlvbnNfRHJhaW5UYWtlc0xvbmdlclRoYW5UaW1lb3V0X0tpbGxzQ29ubmVjdGlvbihDb250ZW50TW9kZSBtb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBjb25zdCBpbnQgQ29udGVudExlbmd0aCA9IDEwXzAwMDsNCg0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlQ2xpZW50QW5kU2VydmVyQXN5bmMoDQogICAgICAgICAgICAgICAgYXN5bmMgdXJsID0+DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5NYXhSZXNwb25zZURyYWluU2l6ZSA9IGludC5NYXhWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5SZXNwb25zZURyYWluVGltZW91dCA9IFRpbWVTcGFuLkZyb21NaWxsaXNlY29uZHMoMSk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IE1heENvbm5lY3Rpb25zUGVyU2VydmVyIHRvIDEuICBUaGlzIHdpbGwgZW5zdXJlIHdlIHdpbGwgd2FpdCBmb3IgdGhlIHByZXZpb3VzIHJlcXVlc3QgdG8gZHJhaW4gKG9yIGZhaWwgdG8pDQogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuTWF4Q29ubmVjdGlvbnNQZXJTZXJ2ZXIgPSAxOw0KDQogICAgICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudC5UaW1lb3V0ID0gVGltZW91dC5JbmZpbml0ZVRpbWVTcGFuOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlMSA9IGF3YWl0IGNsaWVudC5HZXRBc3luYyh1cmwsIEh0dHBDb21wbGV0aW9uT3B0aW9uLlJlc3BvbnNlSGVhZGVyc1JlYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVSZXNwb25zZUhlYWRlcnMocmVzcG9uc2UxLCBDb250ZW50TGVuZ3RoLCBtb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlMS5EaXNwb3NlKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElzc3VlIGFub3RoZXIgcmVxdWVzdC4gIFdlJ2xsIGNvbmZpcm0gdGhhdCBpdCBjb21lcyBvbiBhIG5ldyBjb25uZWN0aW9uLg0KICAgICAgICAgICAgICAgICAgICAgICAgSHR0cFJlc3BvbnNlTWVzc2FnZSByZXNwb25zZTIgPSBhd2FpdCBjbGllbnQuR2V0QXN5bmModXJsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlUmVzcG9uc2VIZWFkZXJzKHJlc3BvbnNlMiwgQ29udGVudExlbmd0aCwgbW9kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoQ29udGVudExlbmd0aCwgKGF3YWl0IHJlc3BvbnNlMi5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCkpLkxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGFzeW5jIHNlcnZlciA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGNvbnRlbnQgPSBuZXcgc3RyaW5nKCdhJywgQ29udGVudExlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZSA9IEdldFJlc3BvbnNlRm9yQ29udGVudE1vZGUoY29udGVudCwgbW9kZSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbiA9Pg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlJlYWRSZXF1ZXN0SGVhZGVyQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdyaXRlIG91dCBvbmx5IHBhcnQgb2YgdGhlIHJlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5Xcml0ZXIuV3JpdGVBc3luYyhyZXNwb25zZS5TdWJzdHJpbmcoMCwgcmVzcG9uc2UuTGVuZ3RoIC8gMikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbikgeyB9ICAgICAvLyBFYXQgZXJyb3JzIGZyb20gY2xpZW50IGRpc2Nvbm5lY3QuDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uU2VuZEN1c3RvbVJlc3BvbnNlQW5kQ2xvc2VBc3luYyhyZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfUG9zdFNjZW5hcmlvVGVzdCA6IFBvc3RTY2VuYXJpb1Rlc3QNCiAgICB7DQogICAgICAgIHB1YmxpYyBTb2NrZXRzSHR0cEhhbmRsZXJfUG9zdFNjZW5hcmlvVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpIHsgfQ0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYm9vbCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIgPT4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc2VhbGVkIGNsYXNzIFNvY2tldHNIdHRwSGFuZGxlcl9SZXNwb25zZVN0cmVhbVRlc3QgOiBSZXNwb25zZVN0cmVhbVRlc3QNCiAgICB7DQogICAgICAgIHB1YmxpYyBTb2NrZXRzSHR0cEhhbmRsZXJfUmVzcG9uc2VTdHJlYW1UZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkgeyB9DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX0h0dHBDbGllbnRIYW5kbGVyX1NzbFByb3RvY29sc19UZXN0IDogSHR0cENsaWVudEhhbmRsZXJfU3NsUHJvdG9jb2xzX1Rlc3QNCiAgICB7DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX1NjaFNlbmRBdXhSZWNvcmRIdHRwVGVzdCA6IFNjaFNlbmRBdXhSZWNvcmRIdHRwVGVzdA0KICAgIHsNCiAgICAgICAgcHVibGljIFNvY2tldHNIdHRwSGFuZGxlcl9TY2hTZW5kQXV4UmVjb3JkSHR0cFRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KSB7IH0NCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cENsaWVudE1pbmlTdHJlc3MgOiBIdHRwQ2xpZW50TWluaVN0cmVzcw0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cENsaWVudEhhbmRsZXJUZXN0IDogSHR0cENsaWVudEhhbmRsZXJUZXN0DQogICAgew0KICAgICAgICBwdWJsaWMgU29ja2V0c0h0dHBIYW5kbGVyX0h0dHBDbGllbnRIYW5kbGVyVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpIHsgfQ0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYm9vbCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIgPT4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc2VhbGVkIGNsYXNzIFNvY2tldHNIdHRwSGFuZGxlcl9EZWZhdWx0Q3JlZGVudGlhbHNUZXN0IDogRGVmYXVsdENyZWRlbnRpYWxzVGVzdA0KICAgIHsNCiAgICAgICAgcHVibGljIFNvY2tldHNIdHRwSGFuZGxlcl9EZWZhdWx0Q3JlZGVudGlhbHNUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkgeyB9DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX0lkbmFQcm90b2NvbFRlc3RzIDogSWRuYVByb3RvY29sVGVzdHMNCiAgICB7DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYm9vbCBTdXBwb3J0c0lkbmEgPT4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc2VhbGVkIGNsYXNzIFNvY2tldHNIdHRwSGFuZGxlcl9IdHRwUmV0cnlQcm90b2NvbFRlc3RzIDogSHR0cFJldHJ5UHJvdG9jb2xUZXN0cw0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cENvb2tpZVByb3RvY29sVGVzdHMgOiBIdHRwQ29va2llUHJvdG9jb2xUZXN0cw0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfSHR0cENsaWVudEhhbmRsZXJfQ2FuY2VsbGF0aW9uX1Rlc3QgOiBIdHRwQ2xpZW50SGFuZGxlcl9DYW5jZWxsYXRpb25fVGVzdA0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIENvbm5lY3RUaW1lb3V0X0RlZmF1bHQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFRpbWVvdXQuSW5maW5pdGVUaW1lU3BhbiwgaGFuZGxlci5Db25uZWN0VGltZW91dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBbSW5saW5lRGF0YSgwKV0NCiAgICAgICAgW0lubGluZURhdGEoLTIpXQ0KICAgICAgICBbSW5saW5lRGF0YShpbnQuTWF4VmFsdWUgKyAxTCldDQogICAgICAgIHB1YmxpYyB2b2lkIENvbm5lY3RUaW1lb3V0X0ludmFsaWRWYWx1ZXMobG9uZyBtcykNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiBoYW5kbGVyLkNvbm5lY3RUaW1lb3V0ID0gVGltZVNwYW4uRnJvbU1pbGxpc2Vjb25kcyhtcykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoLTEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgxKV0NCiAgICAgICAgW0lubGluZURhdGEoaW50Lk1heFZhbHVlIC0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKGludC5NYXhWYWx1ZSldDQogICAgICAgIHB1YmxpYyB2b2lkIENvbm5lY3RUaW1lb3V0X1ZhbGlkVmFsdWVzX1JvdW5kdHJpcChsb25nIG1zKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaGFuZGxlci5Db25uZWN0VGltZW91dCA9IFRpbWVTcGFuLkZyb21NaWxsaXNlY29uZHMobXMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChUaW1lU3Bhbi5Gcm9tTWlsbGlzZWNvbmRzKG1zKSwgaGFuZGxlci5Db25uZWN0VGltZW91dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgQ29ubmVjdFRpbWVvdXRfU2V0QWZ0ZXJVc2VfVGhyb3dzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgdXNpbmcgKHZhciBjbGllbnQgPSBuZXcgSHR0cENsaWVudChoYW5kbGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkNvbm5lY3RUaW1lb3V0ID0gVGltZVNwYW4uRnJvbU1pbGxpc2Vjb25kcyhpbnQuTWF4VmFsdWUpOw0KICAgICAgICAgICAgICAgIGNsaWVudC5HZXRBc3luYygiaHR0cDovLyIgKyBHdWlkLk5ld0d1aWQoKS5Ub1N0cmluZygiTiIpKTsgLy8gaWdub3JpbmcgZmFpbHVyZQ0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChUaW1lU3Bhbi5Gcm9tTWlsbGlzZWNvbmRzKGludC5NYXhWYWx1ZSksIGhhbmRsZXIuQ29ubmVjdFRpbWVvdXQpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8SW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbj4oKCkgPT4gaGFuZGxlci5Db25uZWN0VGltZW91dCA9IFRpbWVTcGFuLkZyb21NaWxsaXNlY29uZHMoMSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0NCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrIENvbm5lY3RUaW1lb3V0X1RpbWVzT3V0U1NMQXV0aF9UaHJvd3MoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgcmVsZWFzZVNlcnZlciA9IG5ldyBUYXNrQ29tcGxldGlvblNvdXJjZTxib29sPigpOw0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlQ2xpZW50QW5kU2VydmVyQXN5bmMoYXN5bmMgdXJpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgaW52b2tlciA9IG5ldyBIdHRwTWVzc2FnZUludm9rZXIoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLkNvbm5lY3RUaW1lb3V0ID0gVGltZVNwYW4uRnJvbVNlY29uZHMoMSk7DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN3ID0gU3RvcHdhdGNoLlN0YXJ0TmV3KCk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFzc2VydC5UaHJvd3NBc3luYzxUYXNrQ2FuY2VsZWRFeGNlcHRpb24+KCgpID0+DQogICAgICAgICAgICAgICAgICAgICAgICBpbnZva2VyLlNlbmRBc3luYyhuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuR2V0LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBVcmlCdWlsZGVyKHVyaSkgeyBTY2hlbWUgPSAiaHR0cHMiIH0uVG9TdHJpbmcoKSksIGRlZmF1bHQpKTsNCiAgICAgICAgICAgICAgICAgICAgc3cuU3RvcCgpOw0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5JblJhbmdlKHN3LkVsYXBzZWRNaWxsaXNlY29uZHMsIDUwMCwgMzBfMDAwKTsNCiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZVNlcnZlci5TZXRSZXN1bHQodHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgc2VydmVyID0+IHJlbGVhc2VTZXJ2ZXIuVGFzayk7IC8vIGRvZXNuJ3QgZXN0YWJsaXNoIFNTTCBjb25uZWN0aW9uDQogICAgICAgIH0NCg0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBFeHBlY3QxMDBDb250aW51ZVRpbWVvdXRfRGVmYXVsdCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZVNwYW4uRnJvbVNlY29uZHMoMSksIGhhbmRsZXIuRXhwZWN0MTAwQ29udGludWVUaW1lb3V0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKC0yKV0NCiAgICAgICAgW0lubGluZURhdGEoaW50Lk1heFZhbHVlICsgMUwpXQ0KICAgICAgICBwdWJsaWMgdm9pZCBFeHBlY3QxMDBDb250aW51ZVRpbWVvdXRfSW52YWxpZFZhbHVlcyhsb25nIG1zKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCgpID0+IGhhbmRsZXIuRXhwZWN0MTAwQ29udGludWVUaW1lb3V0ID0gVGltZVNwYW4uRnJvbU1pbGxpc2Vjb25kcyhtcykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoLTEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgxKV0NCiAgICAgICAgW0lubGluZURhdGEoaW50Lk1heFZhbHVlIC0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKGludC5NYXhWYWx1ZSldDQogICAgICAgIHB1YmxpYyB2b2lkIEV4cGVjdDEwMENvbnRpbnVlVGltZW91dF9WYWxpZFZhbHVlc19Sb3VuZHRyaXAobG9uZyBtcykNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGhhbmRsZXIuRXhwZWN0MTAwQ29udGludWVUaW1lb3V0ID0gVGltZVNwYW4uRnJvbU1pbGxpc2Vjb25kcyhtcyk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFRpbWVTcGFuLkZyb21NaWxsaXNlY29uZHMobXMpLCBoYW5kbGVyLkV4cGVjdDEwMENvbnRpbnVlVGltZW91dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgRXhwZWN0MTAwQ29udGludWVUaW1lb3V0X1NldEFmdGVyVXNlX1Rocm93cygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHVzaW5nICh2YXIgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaGFuZGxlci5FeHBlY3QxMDBDb250aW51ZVRpbWVvdXQgPSBUaW1lU3Bhbi5Gcm9tTWlsbGlzZWNvbmRzKGludC5NYXhWYWx1ZSk7DQogICAgICAgICAgICAgICAgY2xpZW50LkdldEFzeW5jKCJodHRwOi8vIiArIEd1aWQuTmV3R3VpZCgpLlRvU3RyaW5nKCJOIikpOyAvLyBpZ25vcmluZyBmYWlsdXJlDQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFRpbWVTcGFuLkZyb21NaWxsaXNlY29uZHMoaW50Lk1heFZhbHVlKSwgaGFuZGxlci5FeHBlY3QxMDBDb250aW51ZVRpbWVvdXQpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8SW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbj4oKCkgPT4gaGFuZGxlci5FeHBlY3QxMDBDb250aW51ZVRpbWVvdXQgPSBUaW1lU3Bhbi5Gcm9tTWlsbGlzZWNvbmRzKDEpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtPdXRlckxvb3AoIkluY3VycyBzaWduaWZpY2FudCBkZWxheSIpXQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgRXhwZWN0MTAwQ29udGludWVfV2FpdHNFeHBlY3RlZFBlcmlvZE9mVGltZUJlZm9yZVNlbmRpbmdDb250ZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlQ2xpZW50QW5kU2VydmVyQXN5bmMoYXN5bmMgdXJpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgaW52b2tlciA9IG5ldyBIdHRwTWVzc2FnZUludm9rZXIoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBUaW1lU3BhbiBkZWxheSA9IFRpbWVTcGFuLkZyb21TZWNvbmRzKDMpOw0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLkV4cGVjdDEwMENvbnRpbnVlVGltZW91dCA9IGRlbGF5Ow0KDQogICAgICAgICAgICAgICAgICAgIHZhciB0Y3MgPSBuZXcgVGFza0NvbXBsZXRpb25Tb3VyY2U8Ym9vbD4oKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBuZXcgU2V0VGNzQ29udGVudChuZXcgTWVtb3J5U3RyZWFtKG5ldyBieXRlWzFdKSwgdGNzKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3RNZXNzYWdlKEh0dHBNZXRob2QuUG9zdCwgdXJpKSB7IENvbnRlbnQgPSBjb250ZW50IH07DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuSGVhZGVycy5FeHBlY3RDb250aW51ZSA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN3ID0gU3RvcHdhdGNoLlN0YXJ0TmV3KCk7DQogICAgICAgICAgICAgICAgICAgIChhd2FpdCBpbnZva2VyLlNlbmRBc3luYyhyZXF1ZXN0LCBkZWZhdWx0KSkuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICBzdy5TdG9wKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkluUmFuZ2Uoc3cuRWxhcHNlZCwgZGVsYXkgLSBUaW1lU3Bhbi5Gcm9tU2Vjb25kcyguNSksIGRlbGF5ICogMTApOyAvLyBhcmJpdHJhcnkgd2lnZ2xlIHJvb20NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCBhc3luYyBzZXJ2ZXIgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24gPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uUmVhZFJlcXVlc3RIZWFkZXJBc3luYygpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlJlYWRlci5SZWFkQXN5bmMobmV3IGNoYXJbMV0pOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLlNlbmRSZXNwb25zZUFzeW5jKCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc2VhbGVkIGNsYXNzIFNldFRjc0NvbnRlbnQgOiBTdHJlYW1Db250ZW50DQogICAgICAgIHsNCiAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgVGFza0NvbXBsZXRpb25Tb3VyY2U8Ym9vbD4gX3RjczsNCg0KICAgICAgICAgICAgcHVibGljIFNldFRjc0NvbnRlbnQoU3RyZWFtIHN0cmVhbSwgVGFza0NvbXBsZXRpb25Tb3VyY2U8Ym9vbD4gdGNzKSA6IGJhc2Uoc3RyZWFtKSA9PiBfdGNzID0gdGNzOw0KDQogICAgICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgVGFzayBTZXJpYWxpemVUb1N0cmVhbUFzeW5jKFN0cmVhbSBzdHJlYW0sIFRyYW5zcG9ydENvbnRleHQgY29udGV4dCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfdGNzLlNldFJlc3VsdCh0cnVlKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZS5TZXJpYWxpemVUb1N0cmVhbUFzeW5jKHN0cmVhbSwgY29udGV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc2VhbGVkIGNsYXNzIFNvY2tldHNIdHRwSGFuZGxlcl9IdHRwQ2xpZW50SGFuZGxlcl9NYXhSZXNwb25zZUhlYWRlcnNMZW5ndGhfVGVzdCA6IEh0dHBDbGllbnRIYW5kbGVyX01heFJlc3BvbnNlSGVhZGVyc0xlbmd0aF9UZXN0DQogICAgew0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYm9vbCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIgPT4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc2VhbGVkIGNsYXNzIFNvY2tldHNIdHRwSGFuZGxlcl9IdHRwQ2xpZW50SGFuZGxlcl9BdXRoZW50aWNhdGlvbl9UZXN0IDogSHR0cENsaWVudEhhbmRsZXJfQXV0aGVudGljYXRpb25fVGVzdA0KICAgIHsNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIGJvb2wgVXNlU29ja2V0c0h0dHBIYW5kbGVyID0+IHRydWU7DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKEF1dGhlbnRpY2F0aW9uX1NvY2tldHNIdHRwSGFuZGxlcl9UZXN0RGF0YSkpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgdm9pZCBTb2NrZXRzSHR0cEhhbmRsZXJfQXV0aGVudGljYXRpb25fU3VjY2VlZHMoc3RyaW5nIGF1dGhlbnRpY2F0ZUhlYWRlciwgYm9vbCByZXN1bHQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IEh0dHBDbGllbnRIYW5kbGVyX0F1dGhlbnRpY2F0aW9uX1N1Y2NlZWRzKGF1dGhlbnRpY2F0ZUhlYWRlciwgcmVzdWx0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgSUVudW1lcmFibGU8b2JqZWN0W10+IEF1dGhlbnRpY2F0aW9uX1NvY2tldHNIdHRwSGFuZGxlcl9UZXN0RGF0YSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIFRoZXNlIHRlc3QgY2FzZXMgcGFzcyBvbiBTb2NrZXRzSHR0cEhhbmRsZXIsIGZhaWwgZXZlcnl3aGVyZSBlbHNlLg0KICAgICAgICAgICAgLy8gVE9ETzogIzI4MDY1OiBJbnZlc3RpZ2F0ZSBmYWlsaW5nIGF1dGhlbnRpY2F0aW9uIHRlc3QgY2FzZXMgb24gV2luSHR0cEhhbmRsZXIgJiBDdXJsSGFuZGxlci4NCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiQmFzaWMgcmVhbG09XCJ0ZXN0cmVhbG0xXCIgYmFzaWMgcmVhbG09XCJ0ZXN0cmVhbG0xXCIiLCB0cnVlIH07DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgIkJhc2ljIHNvbWV0aGluZyBkaWdlc3Qgc29tZXRoaW5nIiwgdHJ1ZSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJEaWdlc3QgIiwgZmFsc2UgfTsNCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiRGlnZXN0IHJlYWxtPXdpdGhvdXRxdW90ZXMsIG5vbmNlPXdpdGhvdXRxdW90ZXMiLCBmYWxzZSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJEaWdlc3QgcmVhbG09XCJ0ZXN0cmVhbG1cIiwgbm9uY2U9XCJ0ZXN0bm9uY2VcIiwgYWxnb3JpdGhtPVwibXlvd25cIiIsIGZhbHNlIH07DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc2VhbGVkIGNsYXNzIFNvY2tldHNIdHRwSGFuZGxlcl9Db25uZWN0aW9uVXBncmFkZV9UZXN0IDogSHR0cENsaWVudFRlc3RCYXNlDQogICAgew0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYm9vbCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIgPT4gdHJ1ZTsNCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgVXBncmFkZUNvbm5lY3Rpb25fUmV0dXJuc1JlYWRhYmxlQW5kV3JpdGFibGVTdHJlYW0oKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmwpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byB1c2UgUmVzcG9uc2VIZWFkZXJzUmVhZCBoZXJlLCBvdGhlcndpc2Ugd2Ugd2lsbCBoYW5nIHRyeWluZyB0byBidWZmZXIgdGhlIHJlc3BvbnNlIGJvZHkuDQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gZ2V0UmVzcG9uc2VUYXNrID0gY2xpZW50LkdldEFzeW5jKHVybCwgSHR0cENvbXBsZXRpb25PcHRpb24uUmVzcG9uc2VIZWFkZXJzUmVhZCk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbiA9Pg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBUYXNrPExpc3Q8c3RyaW5nPj4gc2VydmVyVGFzayA9IGNvbm5lY3Rpb24uUmVhZFJlcXVlc3RIZWFkZXJBbmRTZW5kQ3VzdG9tUmVzcG9uc2VBc3luYygkIkhUVFAvMS4xIDEwMSBTd2l0Y2hpbmcgUHJvdG9jb2xzXHJcbkRhdGU6IHtEYXRlVGltZU9mZnNldC5VdGNOb3c6Un1cclxuXHJcbiIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUZXN0SGVscGVyLldoZW5BbGxDb21wbGV0ZWRPckFueUZhaWxlZChnZXRSZXNwb25zZVRhc2ssIHNlcnZlclRhc2spOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB1c2luZyAoU3RyZWFtIGNsaWVudFN0cmVhbSA9IGF3YWl0IChhd2FpdCBnZXRSZXNwb25zZVRhc2spLkNvbnRlbnQuUmVhZEFzU3RyZWFtQXN5bmMoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBCb29sZWFuIHByb3BlcnRpZXMgcmV0dXJuaW5nIGNvcnJlY3QgdmFsdWVzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoY2xpZW50U3RyZWFtLkNhbldyaXRlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShjbGllbnRTdHJlYW0uQ2FuUmVhZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKGNsaWVudFN0cmVhbS5DYW5TZWVrKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdCBzdXBwb3J0ZWQgb3BlcmF0aW9ucw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8Tm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE5vdFN1cHBvcnRlZEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50U3RyZWFtLlBvc2l0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE5vdFN1cHBvcnRlZEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50U3RyZWFtLlBvc2l0aW9uID0gMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IGNsaWVudFN0cmVhbS5TZWVrKDAsIFNlZWtPcmlnaW4uQmVnaW4pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE5vdFN1cHBvcnRlZEV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50U3RyZWFtLlNldExlbmd0aCgwKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnZhbGlkIGFyZ3VtZW50cw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub25Xcml0YWJsZVN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0obmV3IGJ5dGVbMV0sIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlzcG9zZWRTdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcG9zZWRTdHJlYW0uRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnROdWxsRXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uQ29weVRvKG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50U3RyZWFtLkNvcHlUbyhTdHJlYW0uTnVsbCwgMCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnROdWxsRXhjZXB0aW9uPigoKSA9PiB7IGNsaWVudFN0cmVhbS5Db3B5VG9Bc3luYyhudWxsLCAxMDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4geyBjbGllbnRTdHJlYW0uQ29weVRvQXN5bmMoU3RyZWFtLk51bGwsIDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4geyBjbGllbnRTdHJlYW0uQ29weVRvQXN5bmMoU3RyZWFtLk51bGwsIC0xLCBkZWZhdWx0KTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxOb3RTdXBwb3J0ZWRFeGNlcHRpb24+KCgpID0+IHsgY2xpZW50U3RyZWFtLkNvcHlUb0FzeW5jKG5vbldyaXRhYmxlU3RyZWFtLCAxMDAsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPE9iamVjdERpc3Bvc2VkRXhjZXB0aW9uPigoKSA9PiB7IGNsaWVudFN0cmVhbS5Db3B5VG9Bc3luYyhkaXNwb3NlZFN0cmVhbSwgMTAwLCBkZWZhdWx0KTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+IGNsaWVudFN0cmVhbS5SZWFkKG51bGwsIDAsIDEwMCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uUmVhZChuZXcgYnl0ZVsxXSwgLTEsIDEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PEFyZ3VtZW50RXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uUmVhZChuZXcgYnl0ZVsxXSwgMiwgMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uUmVhZChuZXcgYnl0ZVsxXSwgMCwgLTEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PEFyZ3VtZW50RXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uUmVhZChuZXcgYnl0ZVsxXSwgMCwgMikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnROdWxsRXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uQmVnaW5SZWFkKG51bGwsIDAsIDEwMCwgbnVsbCwgbnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uQmVnaW5SZWFkKG5ldyBieXRlWzFdLCAtMSwgMSwgbnVsbCwgbnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3NBbnk8QXJndW1lbnRFeGNlcHRpb24+KCgpID0+IGNsaWVudFN0cmVhbS5CZWdpblJlYWQobmV3IGJ5dGVbMV0sIDIsIDEsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oKCkgPT4gY2xpZW50U3RyZWFtLkJlZ2luUmVhZChuZXcgYnl0ZVsxXSwgMCwgLTEsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PEFyZ3VtZW50RXhjZXB0aW9uPigoKSA9PiBjbGllbnRTdHJlYW0uQmVnaW5SZWFkKG5ldyBieXRlWzFdLCAwLCAyLCBudWxsLCBudWxsKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+IGNsaWVudFN0cmVhbS5FbmRSZWFkKG51bGwpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4geyBjbGllbnRTdHJlYW0uUmVhZEFzeW5jKG51bGwsIDAsIDEwMCwgZGVmYXVsdCk7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3M8QXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uPigoKSA9PiB7IGNsaWVudFN0cmVhbS5SZWFkQXN5bmMobmV3IGJ5dGVbMV0sIC0xLCAxLCBkZWZhdWx0KTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93c0FueTxBcmd1bWVudEV4Y2VwdGlvbj4oKCkgPT4geyBjbGllbnRTdHJlYW0uUmVhZEFzeW5jKG5ldyBieXRlWzFdLCAyLCAxLCBkZWZhdWx0KTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCgpID0+IHsgY2xpZW50U3RyZWFtLlJlYWRBc3luYyhuZXcgYnl0ZVsxXSwgMCwgLTEsIGRlZmF1bHQpOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PEFyZ3VtZW50RXhjZXB0aW9uPigoKSA9PiB7IGNsaWVudFN0cmVhbS5SZWFkQXN5bmMobmV3IGJ5dGVbMV0sIDAsIDIsIGRlZmF1bHQpOyB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRlIHdyaXRpbmcgQVBJcyBvbiBjbGllbnRTdHJlYW0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFN0cmVhbS5Xcml0ZUJ5dGUoKGJ5dGUpJyEnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRTdHJlYW0uV3JpdGUobmV3IGJ5dGVbXSB7IChieXRlKSdccicsIChieXRlKSdcbicgfSwgMCwgMik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCIhIiwgYXdhaXQgY29ubmVjdGlvbi5SZWFkZXIuUmVhZExpbmVBc3luYygpKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFN0cmVhbS5Xcml0ZShuZXcgU3BhbjxieXRlPihuZXcgYnl0ZVtdIHsgKGJ5dGUpJ2gnLCAoYnl0ZSknZScsIChieXRlKSdsJywgKGJ5dGUpJ2wnLCAoYnl0ZSknbycsIChieXRlKSdccicsIChieXRlKSdcbicgfSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiaGVsbG8iLCBhd2FpdCBjb25uZWN0aW9uLlJlYWRlci5SZWFkTGluZUFzeW5jKCkpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2xpZW50U3RyZWFtLldyaXRlQXN5bmMobmV3IGJ5dGVbXSB7IChieXRlKSd3JywgKGJ5dGUpJ28nLCAoYnl0ZSkncicsIChieXRlKSdsJywgKGJ5dGUpJ2QnLCAoYnl0ZSknXHInLCAoYnl0ZSknXG4nIH0sIDAsIDcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgid29ybGQiLCBhd2FpdCBjb25uZWN0aW9uLlJlYWRlci5SZWFkTGluZUFzeW5jKCkpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2xpZW50U3RyZWFtLldyaXRlQXN5bmMobmV3IE1lbW9yeTxieXRlPihuZXcgYnl0ZVtdIHsgKGJ5dGUpJ2EnLCAoYnl0ZSknbicsIChieXRlKSdkJywgKGJ5dGUpJ1xyJywgKGJ5dGUpJ1xuJyB9LCAwLCA1KSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJhbmQiLCBhd2FpdCBjb25uZWN0aW9uLlJlYWRlci5SZWFkTGluZUFzeW5jKCkpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGFzay5GYWN0b3J5LkZyb21Bc3luYyhjbGllbnRTdHJlYW0uQmVnaW5Xcml0ZSwgY2xpZW50U3RyZWFtLkVuZFdyaXRlLCBuZXcgYnl0ZVtdIHsgKGJ5dGUpJ2InLCAoYnl0ZSknZScsIChieXRlKSd5JywgKGJ5dGUpJ28nLCAoYnl0ZSknbicsIChieXRlKSdkJywgKGJ5dGUpJ1xyJywgKGJ5dGUpJ1xuJyB9LCAwLCA4LCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoImJleW9uZCIsIGF3YWl0IGNvbm5lY3Rpb24uUmVhZGVyLlJlYWRMaW5lQXN5bmMoKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRTdHJlYW0uRmx1c2goKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjbGllbnRTdHJlYW0uRmx1c2hBc3luYygpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFsaWRhdGUgcmVhZGluZyBBUElzIG9uIGNsaWVudFN0cmVhbQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uU3RyZWFtLldyaXRlQXN5bmMoRW5jb2RpbmcuQVNDSUkuR2V0Qnl0ZXMoImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWZmZXIgPSBuZXcgYnl0ZVsxXTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgnYScsIGNsaWVudFN0cmVhbS5SZWFkQnl0ZSgpKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCBjbGllbnRTdHJlYW0uUmVhZChidWZmZXIsIDAsIDEpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoKGJ5dGUpJ2InLCBidWZmZXJbMF0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIGNsaWVudFN0cmVhbS5SZWFkKG5ldyBTcGFuPGJ5dGU+KGJ1ZmZlciwgMCwgMSkpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoKGJ5dGUpJ2MnLCBidWZmZXJbMF0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIGF3YWl0IGNsaWVudFN0cmVhbS5SZWFkQXN5bmMoYnVmZmVyLCAwLCAxKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKChieXRlKSdkJywgYnVmZmVyWzBdKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCBhd2FpdCBjbGllbnRTdHJlYW0uUmVhZEFzeW5jKG5ldyBNZW1vcnk8Ynl0ZT4oYnVmZmVyLCAwLCAxKSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgoYnl0ZSknZScsIGJ1ZmZlclswXSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoMSwgYXdhaXQgVGFzay5GYWN0b3J5LkZyb21Bc3luYyhjbGllbnRTdHJlYW0uQmVnaW5SZWFkLCBjbGllbnRTdHJlYW0uRW5kUmVhZCwgYnVmZmVyLCAwLCAxLCBudWxsKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKChieXRlKSdmJywgYnVmZmVyWzBdKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtcyA9IG5ldyBNZW1vcnlTdHJlYW0oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYXNrIGNvcHlUYXNrID0gY2xpZW50U3RyZWFtLkNvcHlUb0FzeW5jKG1zKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBiaWdTdHJpbmcgPSBzdHJpbmcuQ29uY2F0KEVudW1lcmFibGUuUmVwZWF0KCJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiIsIDEwMDApKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYXNrIGxvdHNPZkRhdGFTZW50ID0gY29ubmVjdGlvbi5Tb2NrZXQuU2VuZEFzeW5jKEVuY29kaW5nLkFTQ0lJLkdldEJ5dGVzKGJpZ1N0cmluZyksIFNvY2tldEZsYWdzLk5vbmUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uU29ja2V0LlNodXRkb3duKFNvY2tldFNodXRkb3duLlNlbmQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvcHlUYXNrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvdHNPZkRhdGFTZW50Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiZ2hpamtsbW5vcHFyc3R1dnd4eXoiICsgYmlnU3RyaW5nLCBFbmNvZGluZy5BU0NJSS5HZXRTdHJpbmcobXMuVG9BcnJheSgpKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBTb2NrZXRzSHR0cEhhbmRsZXJfQ29ubmVjdF9UZXN0IDogSHR0cENsaWVudFRlc3RCYXNlDQogICAgew0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYm9vbCBVc2VTb2NrZXRzSHR0cEhhbmRsZXIgPT4gdHJ1ZTsNCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgQ29ubmVjdE1ldGhvZF9TdWNjZXNzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJsKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChIdHRwQ2xpZW50IGNsaWVudCA9IENyZWF0ZUh0dHBDbGllbnQoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEh0dHBSZXF1ZXN0TWVzc2FnZSByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShuZXcgSHR0cE1ldGhvZCgiQ09OTkVDVCIpLCB1cmwpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkhlYWRlcnMuSG9zdCA9ICJmb28uY29tOjM0NSI7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byB1c2UgUmVzcG9uc2VIZWFkZXJzUmVhZCBoZXJlLCBvdGhlcndpc2Ugd2Ugd2lsbCBoYW5nIHRyeWluZyB0byBidWZmZXIgdGhlIHJlc3BvbnNlIGJvZHkuDQogICAgICAgICAgICAgICAgICAgIFRhc2s8SHR0cFJlc3BvbnNlTWVzc2FnZT4gcmVzcG9uc2VUYXNrID0gY2xpZW50LlNlbmRBc3luYyhyZXF1ZXN0LCAgSHR0cENvbXBsZXRpb25PcHRpb24uUmVzcG9uc2VIZWFkZXJzUmVhZCk7DQoNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25Bc3luYyhhc3luYyBjb25uZWN0aW9uID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZlcmlmeSB0aGF0IEhvc3QgaGVhZGVyIGV4aXN0IGFuZCBoYXMgc2FtZSB2YWx1ZSBhbmQgVVJJIGF1dGhvcml0eS4NCiAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBsaW5lcyA9IGF3YWl0IGNvbm5lY3Rpb24uUmVhZFJlcXVlc3RIZWFkZXJBc3luYygpLkNvbmZpZ3VyZUF3YWl0KGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBhdXRob3JpdHkgPSBsaW5lc1swXS5TcGxpdCgpWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIGxpbmUgaW4gbGluZXMpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmUuU3RhcnRzV2l0aCgiSG9zdDoiLFN0cmluZ0NvbXBhcmlzb24uSW52YXJpYW50Q3VsdHVyZUlnbm9yZUNhc2UpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGxpbmUsICJIb3N0OiBmb28uY29tOjM0NSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2sgc2VydmVyVGFzayA9IGNvbm5lY3Rpb24uU2VuZFJlc3BvbnNlQXN5bmMoSHR0cFN0YXR1c0NvZGUuT0spOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGVzdEhlbHBlci5XaGVuQWxsQ29tcGxldGVkT3JBbnlGYWlsZWQocmVzcG9uc2VUYXNrLCBzZXJ2ZXJUYXNrKS5Db25maWd1cmVBd2FpdChmYWxzZSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW0gY2xpZW50U3RyZWFtID0gYXdhaXQgKGF3YWl0IHJlc3BvbnNlVGFzaykuQ29udGVudC5SZWFkQXNTdHJlYW1Bc3luYygpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGNsaWVudFN0cmVhbS5DYW5Xcml0ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoY2xpZW50U3RyZWFtLkNhblJlYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShjbGllbnRTdHJlYW0uQ2FuU2Vlayk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0UmVhZGVyIGNsaWVudFJlYWRlciA9IG5ldyBTdHJlYW1SZWFkZXIoY2xpZW50U3RyZWFtKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0V3JpdGVyIGNsaWVudFdyaXRlciA9IG5ldyBTdHJlYW1Xcml0ZXIoY2xpZW50U3RyZWFtKSB7IEF1dG9GbHVzaCA9IHRydWUgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0UmVhZGVyIHNlcnZlclJlYWRlciA9IGNvbm5lY3Rpb24uUmVhZGVyOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRXcml0ZXIgc2VydmVyV3JpdGVyID0gY29ubmVjdGlvbi5Xcml0ZXI7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmcgaGVsbG9TZXJ2ZXIgPSAiaGVsbG8gc2VydmVyIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmcgaGVsbG9DbGllbnQgPSAiaGVsbG8gY2xpZW50IjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmcgZ29vZGJ5ZVNlcnZlciA9ICJnb29kYnllIHNlcnZlciI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nIGdvb2RieWVDbGllbnQgPSAiZ29vZGJ5ZSBjbGllbnQiOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50V3JpdGVyLldyaXRlTGluZShoZWxsb1NlcnZlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGhlbGxvU2VydmVyLCBzZXJ2ZXJSZWFkZXIuUmVhZExpbmUoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyV3JpdGVyLldyaXRlTGluZShoZWxsb0NsaWVudCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGhlbGxvQ2xpZW50LCBjbGllbnRSZWFkZXIuUmVhZExpbmUoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50V3JpdGVyLldyaXRlTGluZShnb29kYnllU2VydmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoZ29vZGJ5ZVNlcnZlciwgc2VydmVyUmVhZGVyLlJlYWRMaW5lKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlcldyaXRlci5Xcml0ZUxpbmUoZ29vZGJ5ZUNsaWVudCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGdvb2RieWVDbGllbnQsIGNsaWVudFJlYWRlci5SZWFkTGluZSgpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgQ29ubmVjdE1ldGhvZF9GYWlscygpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVybCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBIdHRwUmVxdWVzdE1lc3NhZ2UgcmVxdWVzdCA9IG5ldyBIdHRwUmVxdWVzdE1lc3NhZ2UobmV3IEh0dHBNZXRob2QoIkNPTk5FQ1QiKSwgdXJsKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5IZWFkZXJzLkhvc3QgPSAiZm9vLmNvbTozNDUiOw0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHVzZSBSZXNwb25zZUhlYWRlcnNSZWFkIGhlcmUsIG90aGVyd2lzZSB3ZSB3aWxsIGhhbmcgdHJ5aW5nIHRvIGJ1ZmZlciB0aGUgcmVzcG9uc2UgYm9keS4NCiAgICAgICAgICAgICAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiByZXNwb25zZVRhc2sgPSBjbGllbnQuU2VuZEFzeW5jKHJlcXVlc3QsICBIdHRwQ29tcGxldGlvbk9wdGlvbi5SZXNwb25zZUhlYWRlcnNSZWFkKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25Bc3luYyhhc3luYyBjb25uZWN0aW9uID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2s8TGlzdDxzdHJpbmc+PiBzZXJ2ZXJUYXNrID0gY29ubmVjdGlvbi5SZWFkUmVxdWVzdEhlYWRlckFuZFNlbmRSZXNwb25zZUFzeW5jKEh0dHBTdGF0dXNDb2RlLkZvcmJpZGRlbiwgY29udGVudDogImVycm9yIik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRlc3RIZWxwZXIuV2hlbkFsbENvbXBsZXRlZE9yQW55RmFpbGVkKHJlc3BvbnNlVGFzaywgc2VydmVyVGFzayk7DQogICAgICAgICAgICAgICAgICAgICAgICBIdHRwUmVzcG9uc2VNZXNzYWdlIHJlc3BvbnNlID0gYXdhaXQgcmVzcG9uc2VUYXNrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShyZXNwb25zZS5TdGF0dXNDb2RlID09ICBIdHRwU3RhdHVzQ29kZS5Gb3JiaWRkZW4pOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX0h0dHBDbGllbnRIYW5kbGVyX0Nvbm5lY3Rpb25Qb29saW5nX1Rlc3QgOiBIdHRwQ2xpZW50VGVzdEJhc2UNCiAgICB7DQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSBib29sIFVzZVNvY2tldHNIdHRwSGFuZGxlciA9PiB0cnVlOw0KDQogICAgICAgIC8vIFRPRE86IElTU1VFICMyNzI3Mg0KICAgICAgICAvLyBDdXJyZW50bHkgdGhlIHN1YnNlcXVlbnQgdGVzdHMgc29tZXRpbWVzIGZhaWwvaGFuZyB3aXRoIFdpbkh0dHBIYW5kbGVyIC8gQ3VybEhhbmRsZXIuDQogICAgICAgIC8vIEluIHRoZW9yeSB0aGV5IHNob3VsZCBwYXNzIHdpdGggYW55IGhhbmRsZXIgdGhhdCBkb2VzIGFwcHJvcHJpYXRlIGNvbm5lY3Rpb24gcG9vbGluZy4NCiAgICAgICAgLy8gV2Ugc2hvdWxkIHVuZGVyc3RhbmQgd2h5IHRoZXkgc29tZXRpbWVzIGZhaWwgdGhlcmUgYW5kIGlkZWFsbHkgbW92ZSB0aGVtIHRvIGJlDQogICAgICAgIC8vIHVzZWQgYnkgYWxsIGhhbmRsZXJzIHRoaXMgdGVzdCBwcm9qZWN0IHRlc3RzLg0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBNdWx0aXBsZUl0ZXJhdGl2ZVJlcXVlc3RzX1NhbWVDb25uZWN0aW9uUmV1c2VkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgdXNpbmcgKHZhciBsaXN0ZW5lciA9IG5ldyBTb2NrZXQoQWRkcmVzc0ZhbWlseS5JbnRlck5ldHdvcmssIFNvY2tldFR5cGUuU3RyZWFtLCBQcm90b2NvbFR5cGUuVGNwKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsaXN0ZW5lci5CaW5kKG5ldyBJUEVuZFBvaW50KElQQWRkcmVzcy5Mb29wYmFjaywgMCkpOw0KICAgICAgICAgICAgICAgIGxpc3RlbmVyLkxpc3RlbigxKTsNCiAgICAgICAgICAgICAgICB2YXIgZXAgPSAoSVBFbmRQb2ludClsaXN0ZW5lci5Mb2NhbEVuZFBvaW50Ow0KICAgICAgICAgICAgICAgIHZhciB1cmkgPSBuZXcgVXJpKCQiaHR0cDovL3tlcC5BZGRyZXNzfTp7ZXAuUG9ydH0vIik7DQoNCiAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2VCb2R5ID0NCiAgICAgICAgICAgICAgICAgICAgIkhUVFAvMS4xIDIwMCBPS1xyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgJCJEYXRlOiB7RGF0ZVRpbWVPZmZzZXQuVXRjTm93OlJ9XHJcbiIgKw0KICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1MZW5ndGg6IDBcclxuIiArDQogICAgICAgICAgICAgICAgICAgICJcclxuIjsNCg0KICAgICAgICAgICAgICAgIFRhc2s8c3RyaW5nPiBmaXJzdFJlcXVlc3QgPSBjbGllbnQuR2V0U3RyaW5nQXN5bmModXJpKTsNCiAgICAgICAgICAgICAgICB1c2luZyAoU29ja2V0IHNlcnZlciA9IGF3YWl0IGxpc3RlbmVyLkFjY2VwdEFzeW5jKCkpDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBzZXJ2ZXJTdHJlYW0gPSBuZXcgTmV0d29ya1N0cmVhbShzZXJ2ZXIsIG93bnNTb2NrZXQ6IGZhbHNlKSkNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIHNlcnZlclJlYWRlciA9IG5ldyBTdHJlYW1SZWFkZXIoc2VydmVyU3RyZWFtKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlICghc3RyaW5nLklzTnVsbE9yV2hpdGVTcGFjZShhd2FpdCBzZXJ2ZXJSZWFkZXIuUmVhZExpbmVBc3luYygpKSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5TZW5kQXN5bmMobmV3IEFycmF5U2VnbWVudDxieXRlPihFbmNvZGluZy5BU0NJSS5HZXRCeXRlcyhyZXNwb25zZUJvZHkpKSwgU29ja2V0RmxhZ3MuTm9uZSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGZpcnN0UmVxdWVzdDsNCg0KICAgICAgICAgICAgICAgICAgICBUYXNrPFNvY2tldD4gc2Vjb25kQWNjZXB0ID0gbGlzdGVuZXIuQWNjZXB0QXN5bmMoKTsgLy8gc2hvdWxkbid0IGNvbXBsZXRlDQoNCiAgICAgICAgICAgICAgICAgICAgVGFzazxzdHJpbmc+IGFkZGl0aW9uYWxSZXF1ZXN0ID0gY2xpZW50LkdldFN0cmluZ0FzeW5jKHVyaSk7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlICghc3RyaW5nLklzTnVsbE9yV2hpdGVTcGFjZShhd2FpdCBzZXJ2ZXJSZWFkZXIuUmVhZExpbmVBc3luYygpKSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5TZW5kQXN5bmMobmV3IEFycmF5U2VnbWVudDxieXRlPihFbmNvZGluZy5BU0NJSS5HZXRCeXRlcyhyZXNwb25zZUJvZHkpKSwgU29ja2V0RmxhZ3MuTm9uZSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGFkZGl0aW9uYWxSZXF1ZXN0Ow0KDQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShzZWNvbmRBY2NlcHQuSXNDb21wbGV0ZWQsICQiU2Vjb25kIGFjY2VwdCBzaG91bGQgbmV2ZXIgY29tcGxldGUiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbT3V0ZXJMb29wKCJJbmN1cnMgYSBkZWxheSIpXQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgU2VydmVyRGlzY29ubmVjdHNBZnRlckluaXRpYWxSZXF1ZXN0X1N1YnNlcXVlbnRSZXF1ZXN0VXNlc0RpZmZlcmVudENvbm5lY3Rpb24oKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoSHR0cENsaWVudCBjbGllbnQgPSBDcmVhdGVIdHRwQ2xpZW50KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXdhaXQgTG9vcGJhY2tTZXJ2ZXIuQ3JlYXRlU2VydmVyQXN5bmMoYXN5bmMgKHNlcnZlciwgdXJpKSA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBtdWx0aXBsZSByZXF1ZXN0cyBpdGVyYXRpdmVseS4NCiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAyOyBpKyspDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2s8c3RyaW5nPiByZXF1ZXN0ID0gY2xpZW50LkdldFN0cmluZ0FzeW5jKHVyaSk7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvblNlbmRSZXNwb25zZUFuZENsb3NlQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHJlcXVlc3Q7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09IDApDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGFzay5EZWxheSgyMDAwKTsgLy8gZ2l2ZSBjbGllbnQgdGltZSB0byBzZWUgdGhlIGNsb3NpbmcgYmVmb3JlIG5leHQgY29ubmVjdA0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgU2VydmVyU2VuZHNHYXJiYWdlQWZ0ZXJJbml0aWFsUmVxdWVzdF9TdWJzZXF1ZW50UmVxdWVzdFVzZXNEaWZmZXJlbnRDb25uZWN0aW9uKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVyaSkgPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgbXVsdGlwbGUgcmVxdWVzdHMgaXRlcmF0aXZlbHkuDQogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMjsgaSsrKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBUYXNrPHN0cmluZz4gcmVxdWVzdCA9IGNsaWVudC5HZXRTdHJpbmdBc3luYyh1cmkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlID0gTG9vcGJhY2tTZXJ2ZXIuR2V0SHR0cFJlc3BvbnNlKCkgKyAiaGVyZSBpcyBhIGJ1bmNoIG9mIGdhcmJhZ2UiOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25TZW5kQ3VzdG9tUmVzcG9uc2VBbmRDbG9zZUFzeW5jKHJlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHJlcXVlc3Q7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTZXJ2ZXJTZW5kc0Nvbm5lY3Rpb25DbG9zZV9TdWJzZXF1ZW50UmVxdWVzdFVzZXNEaWZmZXJlbnRDb25uZWN0aW9uKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gQ3JlYXRlSHR0cENsaWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZVNlcnZlckFzeW5jKGFzeW5jIChzZXJ2ZXIsIHVyaSkgPT4NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyByZXNwb25zZUJvZHkgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgIkhUVFAvMS4xIDIwMCBPS1xyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICQiRGF0ZToge0RhdGVUaW1lT2Zmc2V0LlV0Y05vdzpSfVxyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICJDb250ZW50LUxlbmd0aDogMFxyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iICsNCiAgICAgICAgICAgICAgICAgICAgICAgICJcclxuIjsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIGZpcnN0IHJlcXVlc3QuDQogICAgICAgICAgICAgICAgICAgIFRhc2s8c3RyaW5nPiByZXF1ZXN0MSA9IGNsaWVudC5HZXRTdHJpbmdBc3luYyh1cmkpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZXJ2ZXIuQWNjZXB0Q29ubmVjdGlvbkFzeW5jKGFzeW5jIGNvbm5lY3Rpb24xID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24xLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZEN1c3RvbVJlc3BvbnNlQXN5bmMocmVzcG9uc2VCb2R5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHJlcXVlc3QxOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHNlY29uZCByZXF1ZXN0IGFuZCBleHBlY3QgaXQgdG8gYmUgc2VydmVkIGZyb20gYSBkaWZmZXJlbnQgY29ubmVjdGlvbi4NCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2s8c3RyaW5nPiByZXF1ZXN0MiA9IGNsaWVudC5HZXRTdHJpbmdBc3luYyh1cmkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25Bc3luYyhhc3luYyBjb25uZWN0aW9uMiA9Pg0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24yLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZEN1c3RvbVJlc3BvbnNlQXN5bmMocmVzcG9uc2VCb2R5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByZXF1ZXN0MjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIFtJbmxpbmVEYXRhKCJQb29sZWRDb25uZWN0aW9uTGlmZXRpbWUiKV0NCiAgICAgICAgW0lubGluZURhdGEoIlBvb2xlZENvbm5lY3Rpb25JZGxlVGltZW91dCIpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTbWFsbENvbm5lY3Rpb25UaW1lb3V0X1N1YnNlcXVlbnRSZXF1ZXN0VXNlc0RpZmZlcmVudENvbm5lY3Rpb24oc3RyaW5nIHRpbWVvdXRQcm9wZXJ0eU5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRpbWVvdXRQcm9wZXJ0eU5hbWUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYXNlICJQb29sZWRDb25uZWN0aW9uTGlmZXRpbWUiOiBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25MaWZldGltZSA9IFRpbWVTcGFuLkZyb21NaWxsaXNlY29uZHMoMSk7IGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJQb29sZWRDb25uZWN0aW9uSWRsZVRpbWVvdXQiOiBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25MaWZldGltZSA9IFRpbWVTcGFuLkZyb21NaWxsaXNlY29uZHMoMSk7IGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKG5hbWVvZih0aW1lb3V0UHJvcGVydHlOYW1lKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdXNpbmcgKEh0dHBDbGllbnQgY2xpZW50ID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBMb29wYmFja1NlcnZlci5DcmVhdGVTZXJ2ZXJBc3luYyhhc3luYyAoc2VydmVyLCB1cmkpID0+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgZmlyc3QgcmVxdWVzdC4NCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2s8c3RyaW5nPiByZXF1ZXN0MSA9IGNsaWVudC5HZXRTdHJpbmdBc3luYyh1cmkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VydmVyLkFjY2VwdENvbm5lY3Rpb25Bc3luYyhhc3luYyBjb25uZWN0aW9uID0+DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5SZWFkUmVxdWVzdEhlYWRlckFuZFNlbmRSZXNwb25zZUFzeW5jKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVxdWVzdDE7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXYWl0IGEgc21hbGwgYW1vdW50IG9mIHRpbWUgYmVmb3JlIG1ha2luZyB0aGUgc2Vjb25kIHJlcXVlc3QsIHRvIGdpdmUgdGhlIGZpcnN0IHJlcXVlc3QgdGltZSB0byB0aW1lb3V0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRhc2suRGVsYXkoMTAwKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1ha2Ugc2Vjb25kIHJlcXVlc3QgYW5kIGV4cGVjdCBpdCB0byBiZSBzZXJ2ZWQgZnJvbSBhIGRpZmZlcmVudCBjb25uZWN0aW9uLg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRhc2s8c3RyaW5nPiByZXF1ZXN0MiA9IGNsaWVudC5HZXRTdHJpbmdBc3luYyh1cmkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbjIgPT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24yLlJlYWRSZXF1ZXN0SGVhZGVyQW5kU2VuZFJlc3BvbnNlQXN5bmMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVxdWVzdDI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW091dGVyTG9vcF0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoZmFsc2UpXQ0KICAgICAgICBbSW5saW5lRGF0YSh0cnVlKV0NCiAgICAgICAgcHVibGljIHZvaWQgQ29ubmVjdGlvbnNQb29sZWRUaGVuRGlzcG9zZWRfTm9Vbm9ic2VydmVkVGFza0V4Y2VwdGlvbnMoYm9vbCBzZWN1cmUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFJlbW90ZUludm9rZShhc3luYyBzZWN1cmVTdHJpbmcgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgcmVsZWFzZVNlcnZlciA9IG5ldyBUYXNrQ29tcGxldGlvblNvdXJjZTxib29sPigpOw0KICAgICAgICAgICAgICAgIGF3YWl0IExvb3BiYWNrU2VydmVyLkNyZWF0ZUNsaWVudEFuZFNlcnZlckFzeW5jKGFzeW5jIHVyaSA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgICAgICB1c2luZyAodmFyIGNsaWVudCA9IG5ldyBIdHRwQ2xpZW50KGhhbmRsZXIpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLlNzbE9wdGlvbnMuUmVtb3RlQ2VydGlmaWNhdGVWYWxpZGF0aW9uQ2FsbGJhY2sgPSBkZWxlZ2F0ZSB7IHJldHVybiB0cnVlOyB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uTGlmZXRpbWUgPSBUaW1lU3Bhbi5Gcm9tTWlsbGlzZWNvbmRzKDEpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXhjZXB0aW9ucyA9IG5ldyBMaXN0PEV4Y2VwdGlvbj4oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFRhc2tTY2hlZHVsZXIuVW5vYnNlcnZlZFRhc2tFeGNlcHRpb24gKz0gKHMsIGUpID0+IGV4Y2VwdGlvbnMuQWRkKGUuRXhjZXB0aW9uKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2xpZW50LkdldFN0cmluZ0FzeW5jKHVyaSk7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRlbGF5KDEwKTsgLy8gYW55IHZhbHVlID49IHRoZSBsaWZldGltZQ0KICAgICAgICAgICAgICAgICAgICAgICAgVGFzayBpZ25vcmVkID0gY2xpZW50LkdldFN0cmluZ0FzeW5jKHVyaSk7IC8vIGZvcmNlIHRoZSBwb29sIHRvIGxvb2sgZm9yIHRoZSBwcmV2aW91cyBjb25uZWN0aW9uIGFuZCBmaW5kIGl0J3MgdG9vIG9sZA0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGFzay5EZWxheSgxMDApOyAvLyBnaXZlIHNvbWUgdGltZSBmb3IgdGhlIGNvbm5lY3Rpb24gY2xvc2UgdG8gZmFpbCBwZW5kaW5nIHJlYWRzDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIEdDLkNvbGxlY3QoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEdDLldhaXRGb3JQZW5kaW5nRmluYWxpemVycygpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgdGhlcmUgYXJlIHJhY2UgY29uZGl0aW9ucyBoZXJlIHN1Y2ggdGhhdCB3ZSBtYXkgbm90IGNhdGNoIGV2ZXJ5IGZhaWx1cmUsDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgdGh1cyBjb3VsZCBoYXZlIHNvbWUgZmFsc2UgbmVnYXRpdmVzLCBidXQgdGhlcmUgd29uJ3QgYmUgYW55IGZhbHNlIHBvc2l0aXZlcy4NCiAgICAgICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGV4Y2VwdGlvbnMuQ291bnQgPT0gMCwgc3RyaW5nLkNvbmNhdChleGNlcHRpb25zKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGVhc2VTZXJ2ZXIuU2V0UmVzdWx0KHRydWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwgc2VydmVyID0+IHNlcnZlci5BY2NlcHRDb25uZWN0aW9uQXN5bmMoYXN5bmMgY29ubmVjdGlvbiA9Pg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5SZWFkUmVxdWVzdEhlYWRlckFuZFNlbmRSZXNwb25zZUFzeW5jKGNvbnRlbnQ6ICJoZWxsbyB3b3JsZCIpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCByZWxlYXNlU2VydmVyLlRhc2s7DQogICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgbmV3IExvb3BiYWNrU2VydmVyLk9wdGlvbnMgeyBVc2VTc2wgPSBib29sLlBhcnNlKHNlY3VyZVN0cmluZykgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIFN1Y2Nlc3NFeGl0Q29kZTsNCiAgICAgICAgICAgIH0sIHNlY3VyZS5Ub1N0cmluZygpKS5EaXNwb3NlKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc2VhbGVkIGNsYXNzIFNvY2tldHNIdHRwSGFuZGxlcl9QdWJsaWNBUElCZWhhdmlvcl9UZXN0DQogICAgew0KICAgICAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBUYXNrIElzc3VlUmVxdWVzdEFzeW5jKEh0dHBNZXNzYWdlSGFuZGxlciBoYW5kbGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGMgPSBuZXcgSHR0cE1lc3NhZ2VJbnZva2VyKGhhbmRsZXIsIGRpc3Bvc2VIYW5kbGVyOiBmYWxzZSkpDQogICAgICAgICAgICAgICAgYXdhaXQgQXNzZXJ0LlRocm93c0FueUFzeW5jPEV4Y2VwdGlvbj4oKCkgPT4NCiAgICAgICAgICAgICAgICAgICAgYy5TZW5kQXN5bmMobmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLkdldCwgbmV3IFVyaSgiL3Nob3VsZHF1aWNrbHlmYWlsIiwgVXJpS2luZC5SZWxhdGl2ZSkpLCBkZWZhdWx0KSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgQWxsb3dBdXRvUmVkaXJlY3RfR2V0U2V0X1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkFsbG93QXV0b1JlZGlyZWN0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShoYW5kbGVyLkFsbG93QXV0b1JlZGlyZWN0KTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQWxsb3dBdXRvUmVkaXJlY3QgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UoaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgQXV0b21hdGljRGVjb21wcmVzc2lvbl9HZXRTZXRfUm91bmR0cmlwcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoRGVjb21wcmVzc2lvbk1ldGhvZHMuTm9uZSwgaGFuZGxlci5BdXRvbWF0aWNEZWNvbXByZXNzaW9uKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQXV0b21hdGljRGVjb21wcmVzc2lvbiA9IERlY29tcHJlc3Npb25NZXRob2RzLkdaaXA7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKERlY29tcHJlc3Npb25NZXRob2RzLkdaaXAsIGhhbmRsZXIuQXV0b21hdGljRGVjb21wcmVzc2lvbik7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLkF1dG9tYXRpY0RlY29tcHJlc3Npb24gPSBEZWNvbXByZXNzaW9uTWV0aG9kcy5EZWZsYXRlOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChEZWNvbXByZXNzaW9uTWV0aG9kcy5EZWZsYXRlLCBoYW5kbGVyLkF1dG9tYXRpY0RlY29tcHJlc3Npb24pOw0KDQogICAgICAgICAgICAgICAgaGFuZGxlci5BdXRvbWF0aWNEZWNvbXByZXNzaW9uID0gRGVjb21wcmVzc2lvbk1ldGhvZHMuR1ppcCB8IERlY29tcHJlc3Npb25NZXRob2RzLkRlZmxhdGU7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKERlY29tcHJlc3Npb25NZXRob2RzLkdaaXAgfCBEZWNvbXByZXNzaW9uTWV0aG9kcy5EZWZsYXRlLCBoYW5kbGVyLkF1dG9tYXRpY0RlY29tcHJlc3Npb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIENvb2tpZUNvbnRhaW5lcl9HZXRTZXRfUm91bmR0cmlwcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb29raWVDb250YWluZXIgY29udGFpbmVyID0gaGFuZGxlci5Db29raWVDb250YWluZXI7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlNhbWUoY29udGFpbmVyLCBoYW5kbGVyLkNvb2tpZUNvbnRhaW5lcik7DQoNCiAgICAgICAgICAgICAgICB2YXIgbmV3Q29udGFpbmVyID0gbmV3IENvb2tpZUNvbnRhaW5lcigpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ29va2llQ29udGFpbmVyID0gbmV3Q29udGFpbmVyOw0KICAgICAgICAgICAgICAgIEFzc2VydC5TYW1lKG5ld0NvbnRhaW5lciwgaGFuZGxlci5Db29raWVDb250YWluZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIENyZWRlbnRpYWxzX0dldFNldF9Sb3VuZHRyaXBzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKGhhbmRsZXIuQ3JlZGVudGlhbHMpOw0KDQogICAgICAgICAgICAgICAgdmFyIG5ld0NyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKCJ1c2VybmFtZSIsICJwYXNzd29yZCIpOw0KICAgICAgICAgICAgICAgIGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBuZXdDcmVkZW50aWFsczsNCiAgICAgICAgICAgICAgICBBc3NlcnQuU2FtZShuZXdDcmVkZW50aWFscywgaGFuZGxlci5DcmVkZW50aWFscyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgRGVmYXVsdFByb3h5Q3JlZGVudGlhbHNfR2V0U2V0X1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk51bGwoaGFuZGxlci5EZWZhdWx0UHJveHlDcmVkZW50aWFscyk7DQoNCiAgICAgICAgICAgICAgICB2YXIgbmV3Q3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoInVzZXJuYW1lIiwgInBhc3N3b3JkIik7DQogICAgICAgICAgICAgICAgaGFuZGxlci5EZWZhdWx0UHJveHlDcmVkZW50aWFscyA9IG5ld0NyZWRlbnRpYWxzOw0KICAgICAgICAgICAgICAgIEFzc2VydC5TYW1lKG5ld0NyZWRlbnRpYWxzLCBoYW5kbGVyLkRlZmF1bHRQcm94eUNyZWRlbnRpYWxzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBNYXhBdXRvbWF0aWNSZWRpcmVjdGlvbnNfR2V0U2V0X1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDUwLCBoYW5kbGVyLk1heEF1dG9tYXRpY1JlZGlyZWN0aW9ucyk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLk1heEF1dG9tYXRpY1JlZGlyZWN0aW9ucyA9IGludC5NYXhWYWx1ZTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoaW50Lk1heFZhbHVlLCBoYW5kbGVyLk1heEF1dG9tYXRpY1JlZGlyZWN0aW9ucyk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLk1heEF1dG9tYXRpY1JlZGlyZWN0aW9ucyA9IDE7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIGhhbmRsZXIuTWF4QXV0b21hdGljUmVkaXJlY3Rpb25zKTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oInZhbHVlIiwgKCkgPT4gaGFuZGxlci5NYXhBdXRvbWF0aWNSZWRpcmVjdGlvbnMgPSAwKTsNCiAgICAgICAgICAgICAgICBBc3NlcnRFeHRlbnNpb25zLlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCJ2YWx1ZSIsICgpID0+IGhhbmRsZXIuTWF4QXV0b21hdGljUmVkaXJlY3Rpb25zID0gLTEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIE1heENvbm5lY3Rpb25zUGVyU2VydmVyX0dldFNldF9Sb3VuZHRyaXBzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChpbnQuTWF4VmFsdWUsIGhhbmRsZXIuTWF4Q29ubmVjdGlvbnNQZXJTZXJ2ZXIpOw0KDQogICAgICAgICAgICAgICAgaGFuZGxlci5NYXhDb25uZWN0aW9uc1BlclNlcnZlciA9IGludC5NYXhWYWx1ZTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoaW50Lk1heFZhbHVlLCBoYW5kbGVyLk1heENvbm5lY3Rpb25zUGVyU2VydmVyKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuTWF4Q29ubmVjdGlvbnNQZXJTZXJ2ZXIgPSAxOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCBoYW5kbGVyLk1heENvbm5lY3Rpb25zUGVyU2VydmVyKTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oInZhbHVlIiwgKCkgPT4gaGFuZGxlci5NYXhDb25uZWN0aW9uc1BlclNlcnZlciA9IDApOw0KICAgICAgICAgICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oInZhbHVlIiwgKCkgPT4gaGFuZGxlci5NYXhDb25uZWN0aW9uc1BlclNlcnZlciA9IC0xKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBNYXhSZXNwb25zZUhlYWRlcnNMZW5ndGhfR2V0U2V0X1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDY0LCBoYW5kbGVyLk1heFJlc3BvbnNlSGVhZGVyc0xlbmd0aCk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLk1heFJlc3BvbnNlSGVhZGVyc0xlbmd0aCA9IGludC5NYXhWYWx1ZTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoaW50Lk1heFZhbHVlLCBoYW5kbGVyLk1heFJlc3BvbnNlSGVhZGVyc0xlbmd0aCk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLk1heFJlc3BvbnNlSGVhZGVyc0xlbmd0aCA9IDE7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIGhhbmRsZXIuTWF4UmVzcG9uc2VIZWFkZXJzTGVuZ3RoKTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oInZhbHVlIiwgKCkgPT4gaGFuZGxlci5NYXhSZXNwb25zZUhlYWRlcnNMZW5ndGggPSAwKTsNCiAgICAgICAgICAgICAgICBBc3NlcnRFeHRlbnNpb25zLlRocm93czxBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24+KCJ2YWx1ZSIsICgpID0+IGhhbmRsZXIuTWF4UmVzcG9uc2VIZWFkZXJzTGVuZ3RoID0gLTEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFByZUF1dGhlbnRpY2F0ZV9HZXRTZXRfUm91bmR0cmlwcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UoaGFuZGxlci5QcmVBdXRoZW50aWNhdGUpOw0KDQogICAgICAgICAgICAgICAgaGFuZGxlci5QcmVBdXRoZW50aWNhdGUgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UoaGFuZGxlci5QcmVBdXRoZW50aWNhdGUpOw0KDQogICAgICAgICAgICAgICAgaGFuZGxlci5QcmVBdXRoZW50aWNhdGUgPSB0cnVlOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGhhbmRsZXIuUHJlQXV0aGVudGljYXRlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBQb29sZWRDb25uZWN0aW9uSWRsZVRpbWVvdXRfR2V0U2V0X1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFRpbWVTcGFuLkZyb21NaW51dGVzKDIpLCBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25JZGxlVGltZW91dCk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25JZGxlVGltZW91dCA9IFRpbWVvdXQuSW5maW5pdGVUaW1lU3BhbjsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZW91dC5JbmZpbml0ZVRpbWVTcGFuLCBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25JZGxlVGltZW91dCk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25JZGxlVGltZW91dCA9IFRpbWVTcGFuLkZyb21TZWNvbmRzKDApOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChUaW1lU3Bhbi5Gcm9tU2Vjb25kcygwKSwgaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uSWRsZVRpbWVvdXQpOw0KDQogICAgICAgICAgICAgICAgaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uSWRsZVRpbWVvdXQgPSBUaW1lU3Bhbi5Gcm9tU2Vjb25kcygxKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZVNwYW4uRnJvbVNlY29uZHMoMSksIGhhbmRsZXIuUG9vbGVkQ29ubmVjdGlvbklkbGVUaW1lb3V0KTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oInZhbHVlIiwgKCkgPT4gaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uSWRsZVRpbWVvdXQgPSBUaW1lU3Bhbi5Gcm9tU2Vjb25kcygtMikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFBvb2xlZENvbm5lY3Rpb25MaWZldGltZV9HZXRTZXRfUm91bmR0cmlwcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZW91dC5JbmZpbml0ZVRpbWVTcGFuLCBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25MaWZldGltZSk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25MaWZldGltZSA9IFRpbWVvdXQuSW5maW5pdGVUaW1lU3BhbjsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZW91dC5JbmZpbml0ZVRpbWVTcGFuLCBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25MaWZldGltZSk7DQoNCiAgICAgICAgICAgICAgICBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25MaWZldGltZSA9IFRpbWVTcGFuLkZyb21TZWNvbmRzKDApOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChUaW1lU3Bhbi5Gcm9tU2Vjb25kcygwKSwgaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uTGlmZXRpbWUpOw0KDQogICAgICAgICAgICAgICAgaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uTGlmZXRpbWUgPSBUaW1lU3Bhbi5Gcm9tU2Vjb25kcygxKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoVGltZVNwYW4uRnJvbVNlY29uZHMoMSksIGhhbmRsZXIuUG9vbGVkQ29ubmVjdGlvbkxpZmV0aW1lKTsNCg0KICAgICAgICAgICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbj4oInZhbHVlIiwgKCkgPT4gaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uTGlmZXRpbWUgPSBUaW1lU3Bhbi5Gcm9tU2Vjb25kcygtMikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFByb3BlcnRpZXNfUm91bmR0cmlwcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBTb2NrZXRzSHR0cEhhbmRsZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJRGljdGlvbmFyeTxzdHJpbmcsIG9iamVjdD4gcHJvcHMgPSBoYW5kbGVyLlByb3BlcnRpZXM7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwocHJvcHMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FbXB0eShwcm9wcyk7DQoNCiAgICAgICAgICAgICAgICBwcm9wcy5BZGQoImhlbGxvIiwgIndvcmxkIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHByb3BzLkNvdW50KTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoIndvcmxkIiwgcHJvcHNbImhlbGxvIl0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFByb3h5X0dldFNldF9Sb3VuZHRyaXBzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKGhhbmRsZXIuUHJveHkpOw0KDQogICAgICAgICAgICAgICAgdmFyIHByb3h5ID0gbmV3IFdlYlByb3h5KCk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5Qcm94eSA9IHByb3h5Ow0KICAgICAgICAgICAgICAgIEFzc2VydC5TYW1lKHByb3h5LCBoYW5kbGVyLlByb3h5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCBTc2xPcHRpb25zX0dldFNldF9Sb3VuZHRyaXBzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNzbENsaWVudEF1dGhlbnRpY2F0aW9uT3B0aW9ucyBvcHRpb25zID0gaGFuZGxlci5Tc2xPcHRpb25zOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKG9wdGlvbnMpOw0KDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUob3B0aW9ucy5BbGxvd1JlbmVnb3RpYXRpb24pOw0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKG9wdGlvbnMuQXBwbGljYXRpb25Qcm90b2NvbHMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChYNTA5UmV2b2NhdGlvbk1vZGUuTm9DaGVjaywgb3B0aW9ucy5DZXJ0aWZpY2F0ZVJldm9jYXRpb25DaGVja01vZGUpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKG9wdGlvbnMuQ2xpZW50Q2VydGlmaWNhdGVzKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoU3NsUHJvdG9jb2xzLk5vbmUsIG9wdGlvbnMuRW5hYmxlZFNzbFByb3RvY29scyk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKEVuY3J5cHRpb25Qb2xpY3kuUmVxdWlyZUVuY3J5cHRpb24sIG9wdGlvbnMuRW5jcnlwdGlvblBvbGljeSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk51bGwob3B0aW9ucy5Mb2NhbENlcnRpZmljYXRlU2VsZWN0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKG9wdGlvbnMuUmVtb3RlQ2VydGlmaWNhdGVWYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKG9wdGlvbnMuVGFyZ2V0SG9zdCk7DQoNCiAgICAgICAgICAgICAgICBBc3NlcnQuU2FtZShvcHRpb25zLCBoYW5kbGVyLlNzbE9wdGlvbnMpOw0KDQogICAgICAgICAgICAgICAgdmFyIG5ld09wdGlvbnMgPSBuZXcgU3NsQ2xpZW50QXV0aGVudGljYXRpb25PcHRpb25zKCk7DQogICAgICAgICAgICAgICAgaGFuZGxlci5Tc2xPcHRpb25zID0gbmV3T3B0aW9uczsNCiAgICAgICAgICAgICAgICBBc3NlcnQuU2FtZShuZXdPcHRpb25zLCBoYW5kbGVyLlNzbE9wdGlvbnMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFVzZUNvb2tpZXNfR2V0U2V0X1JvdW5kdHJpcHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgU29ja2V0c0h0dHBIYW5kbGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaGFuZGxlci5Vc2VDb29raWVzKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuVXNlQ29va2llcyA9IHRydWU7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaGFuZGxlci5Vc2VDb29raWVzKTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuVXNlQ29va2llcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShoYW5kbGVyLlVzZUNvb2tpZXMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFVzZVByb3h5X0dldFNldF9Sb3VuZHRyaXBzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGhhbmRsZXIuVXNlUHJveHkpOw0KDQogICAgICAgICAgICAgICAgaGFuZGxlci5Vc2VQcm94eSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShoYW5kbGVyLlVzZVByb3h5KTsNCg0KICAgICAgICAgICAgICAgIGhhbmRsZXIuVXNlUHJveHkgPSB0cnVlOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGhhbmRsZXIuVXNlUHJveHkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoZmFsc2UpXQ0KICAgICAgICBbSW5saW5lRGF0YSh0cnVlKV0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2sgQWZ0ZXJEaXNwb3NlU2VuZEFzeW5jX0dldHRlcnNVc2FibGVfU2V0dGVyc1Rocm93KGJvb2wgZGlzcG9zZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IFNvY2tldHNIdHRwSGFuZGxlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFR5cGUgZXhwZWN0ZWRFeGNlcHRpb25UeXBlOw0KICAgICAgICAgICAgICAgIGlmIChkaXNwb3NlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkRXhjZXB0aW9uVHlwZSA9IHR5cGVvZihPYmplY3REaXNwb3NlZEV4Y2VwdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IElzc3VlUmVxdWVzdEFzeW5jKGhhbmRsZXIpOw0KICAgICAgICAgICAgICAgICAgICBleHBlY3RlZEV4Y2VwdGlvblR5cGUgPSB0eXBlb2YoSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoaGFuZGxlci5BbGxvd0F1dG9SZWRpcmVjdCk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKERlY29tcHJlc3Npb25NZXRob2RzLk5vbmUsIGhhbmRsZXIuQXV0b21hdGljRGVjb21wcmVzc2lvbik7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwoaGFuZGxlci5Db29raWVDb250YWluZXIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKGhhbmRsZXIuQ3JlZGVudGlhbHMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5OdWxsKGhhbmRsZXIuRGVmYXVsdFByb3h5Q3JlZGVudGlhbHMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCg1MCwgaGFuZGxlci5NYXhBdXRvbWF0aWNSZWRpcmVjdGlvbnMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChpbnQuTWF4VmFsdWUsIGhhbmRsZXIuTWF4Q29ubmVjdGlvbnNQZXJTZXJ2ZXIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbCg2NCwgaGFuZGxlci5NYXhSZXNwb25zZUhlYWRlcnNMZW5ndGgpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShoYW5kbGVyLlByZUF1dGhlbnRpY2F0ZSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFRpbWVTcGFuLkZyb21NaW51dGVzKDIpLCBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25JZGxlVGltZW91dCk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFRpbWVvdXQuSW5maW5pdGVUaW1lU3BhbiwgaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uTGlmZXRpbWUpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKGhhbmRsZXIuUHJvcGVydGllcyk7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk51bGwoaGFuZGxlci5Qcm94eSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwoaGFuZGxlci5Tc2xPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShoYW5kbGVyLlVzZUNvb2tpZXMpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGhhbmRsZXIuVXNlUHJveHkpOw0KDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93cyhleHBlY3RlZEV4Y2VwdGlvblR5cGUsICgpID0+IGhhbmRsZXIuQWxsb3dBdXRvUmVkaXJlY3QgPSBmYWxzZSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93cyhleHBlY3RlZEV4Y2VwdGlvblR5cGUsICgpID0+IGhhbmRsZXIuQXV0b21hdGljRGVjb21wcmVzc2lvbiA9IERlY29tcHJlc3Npb25NZXRob2RzLkdaaXApOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3MoZXhwZWN0ZWRFeGNlcHRpb25UeXBlLCAoKSA9PiBoYW5kbGVyLkNvb2tpZUNvbnRhaW5lciA9IG5ldyBDb29raWVDb250YWluZXIoKSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93cyhleHBlY3RlZEV4Y2VwdGlvblR5cGUsICgpID0+IGhhbmRsZXIuQ3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoImFub3RoZXJ1c2VyIiwgImFub3RoZXJwYXNzd29yZCIpKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzKGV4cGVjdGVkRXhjZXB0aW9uVHlwZSwgKCkgPT4gaGFuZGxlci5EZWZhdWx0UHJveHlDcmVkZW50aWFscyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbCgiYW5vdGhlcnVzZXIiLCAiYW5vdGhlcnBhc3N3b3JkIikpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3MoZXhwZWN0ZWRFeGNlcHRpb25UeXBlLCAoKSA9PiBoYW5kbGVyLk1heEF1dG9tYXRpY1JlZGlyZWN0aW9ucyA9IDIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3MoZXhwZWN0ZWRFeGNlcHRpb25UeXBlLCAoKSA9PiBoYW5kbGVyLk1heENvbm5lY3Rpb25zUGVyU2VydmVyID0gMik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93cyhleHBlY3RlZEV4Y2VwdGlvblR5cGUsICgpID0+IGhhbmRsZXIuTWF4UmVzcG9uc2VIZWFkZXJzTGVuZ3RoID0gMik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93cyhleHBlY3RlZEV4Y2VwdGlvblR5cGUsICgpID0+IGhhbmRsZXIuUHJlQXV0aGVudGljYXRlID0gZmFsc2UpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UaHJvd3MoZXhwZWN0ZWRFeGNlcHRpb25UeXBlLCAoKSA9PiBoYW5kbGVyLlBvb2xlZENvbm5lY3Rpb25JZGxlVGltZW91dCA9IFRpbWVTcGFuLkZyb21TZWNvbmRzKDIpKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzKGV4cGVjdGVkRXhjZXB0aW9uVHlwZSwgKCkgPT4gaGFuZGxlci5Qb29sZWRDb25uZWN0aW9uTGlmZXRpbWUgPSBUaW1lU3Bhbi5Gcm9tU2Vjb25kcygyKSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93cyhleHBlY3RlZEV4Y2VwdGlvblR5cGUsICgpID0+IGhhbmRsZXIuUHJveHkgPSBuZXcgV2ViUHJveHkoKSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93cyhleHBlY3RlZEV4Y2VwdGlvblR5cGUsICgpID0+IGhhbmRsZXIuU3NsT3B0aW9ucyA9IG5ldyBTc2xDbGllbnRBdXRoZW50aWNhdGlvbk9wdGlvbnMoKSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93cyhleHBlY3RlZEV4Y2VwdGlvblR5cGUsICgpID0+IGhhbmRsZXIuVXNlQ29va2llcyA9IGZhbHNlKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzKGV4cGVjdGVkRXhjZXB0aW9uVHlwZSwgKCkgPT4gaGFuZGxlci5Vc2VQcm94eSA9IGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzZWFsZWQgY2xhc3MgU29ja2V0c0h0dHBIYW5kbGVyX0V4dGVybmFsQ29uZmlndXJhdGlvbl9UZXN0IDogSHR0cENsaWVudFRlc3RCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBFbnZpcm9ubWVudFZhcmlhYmxlU2V0dGluZ05hbWUgPSAiRE9UTkVUX1NZU1RFTV9ORVRfSFRUUF9VU0VTT0NLRVRTSFRUUEhBTkRMRVIiOw0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBBcHBDb250ZXh0U2V0dGluZ05hbWUgPSAiU3lzdGVtLk5ldC5IdHRwLlVzZVNvY2tldHNIdHRwSGFuZGxlciI7DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBVc2VTb2NrZXRzSHR0cEhhbmRsZXJFbnZpcm9ubWVudFZhcmlhYmxlSXNOb3RTZXQgPT4NCiAgICAgICAgICAgIHN0cmluZy5Jc051bGxPckVtcHR5KEVudmlyb25tZW50LkdldEVudmlyb25tZW50VmFyaWFibGUoRW52aXJvbm1lbnRWYXJpYWJsZVNldHRpbmdOYW1lKSk7DQoNCiAgICAgICAgW0NvbmRpdGlvbmFsVGhlb3J5KG5hbWVvZihVc2VTb2NrZXRzSHR0cEhhbmRsZXJFbnZpcm9ubWVudFZhcmlhYmxlSXNOb3RTZXQpKV0NCiAgICAgICAgW0lubGluZURhdGEoInRydWUiLCB0cnVlKV0NCiAgICAgICAgW0lubGluZURhdGEoIlRSVUUiLCB0cnVlKV0NCiAgICAgICAgW0lubGluZURhdGEoInRSdUUiLCB0cnVlKV0NCiAgICAgICAgW0lubGluZURhdGEoIjEiLCB0cnVlKV0NCiAgICAgICAgW0lubGluZURhdGEoIjAiLCBmYWxzZSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJmYWxzZSIsIGZhbHNlKV0NCiAgICAgICAgW0lubGluZURhdGEoImhlbGxvd29ybGQiLCB0cnVlKV0NCiAgICAgICAgW0lubGluZURhdGEoIiIsIHRydWUpXQ0KICAgICAgICBwdWJsaWMgdm9pZCBIdHRwQ2xpZW50SGFuZGxlcl9TZXR0aW5nRW52aXJvbm1lbnRWYXJpYWJsZUNoYW5nZXNEZWZhdWx0KHN0cmluZyBlbnZWYXJWYWx1ZSwgYm9vbCBleHBlY3RlZFVzZVNvY2tldHNIYW5kbGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBSZW1vdGVJbnZva2UoKGlubmVyRW52VmFyVmFsdWUsIGlubmVyRXhwZWN0ZWRVc2VTb2NrZXRzSGFuZGxlcikgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBFbnZpcm9ubWVudC5TZXRFbnZpcm9ubWVudFZhcmlhYmxlKEVudmlyb25tZW50VmFyaWFibGVTZXR0aW5nTmFtZSwgaW5uZXJFbnZWYXJWYWx1ZSk7DQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IEh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoYm9vbC5QYXJzZShpbm5lckV4cGVjdGVkVXNlU29ja2V0c0hhbmRsZXIpLCBJc1NvY2tldHNIdHRwSGFuZGxlcihoYW5kbGVyKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBTdWNjZXNzRXhpdENvZGU7DQogICAgICAgICAgICB9LCBlbnZWYXJWYWx1ZSwgZXhwZWN0ZWRVc2VTb2NrZXRzSGFuZGxlci5Ub1N0cmluZygpKS5EaXNwb3NlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgSHR0cENsaWVudEhhbmRsZXJfU2V0dGluZ0FwcENvbnRleHRDaGFuZ2VzRGVmYXVsdCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFJlbW90ZUludm9rZSgoKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFwcENvbnRleHQuU2V0U3dpdGNoKEFwcENvbnRleHRTZXR0aW5nTmFtZSwgaXNFbmFibGVkOiB0cnVlKTsNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKElzU29ja2V0c0h0dHBIYW5kbGVyKGhhbmRsZXIpKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBBcHBDb250ZXh0LlNldFN3aXRjaChBcHBDb250ZXh0U2V0dGluZ05hbWUsIGlzRW5hYmxlZDogZmFsc2UpOw0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgaGFuZGxlciA9IG5ldyBIdHRwQ2xpZW50SGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKElzU29ja2V0c0h0dHBIYW5kbGVyKGhhbmRsZXIpKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gU3VjY2Vzc0V4aXRDb2RlOw0KICAgICAgICAgICAgfSkuRGlzcG9zZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIEh0dHBDbGllbnRIYW5kbGVyX0FwcENvbnRleHRPdmVycmlkZXNFbnZpcm9ubWVudFZhcmlhYmxlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgUmVtb3RlSW52b2tlKCgpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgRW52aXJvbm1lbnQuU2V0RW52aXJvbm1lbnRWYXJpYWJsZShFbnZpcm9ubWVudFZhcmlhYmxlU2V0dGluZ05hbWUsICJ0cnVlIik7DQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBoYW5kbGVyID0gbmV3IEh0dHBDbGllbnRIYW5kbGVyKCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShJc1NvY2tldHNIdHRwSGFuZGxlcihoYW5kbGVyKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgQXBwQ29udGV4dC5TZXRTd2l0Y2goQXBwQ29udGV4dFNldHRpbmdOYW1lLCBpc0VuYWJsZWQ6IGZhbHNlKTsNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5GYWxzZShJc1NvY2tldHNIdHRwSGFuZGxlcihoYW5kbGVyKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgQXBwQ29udGV4dC5TZXRTd2l0Y2goQXBwQ29udGV4dFNldHRpbmdOYW1lLCBpc0VuYWJsZWQ6IHRydWUpOw0KICAgICAgICAgICAgICAgIEVudmlyb25tZW50LlNldEVudmlyb25tZW50VmFyaWFibGUoRW52aXJvbm1lbnRWYXJpYWJsZVNldHRpbmdOYW1lLCBudWxsKTsNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIGhhbmRsZXIgPSBuZXcgSHR0cENsaWVudEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKElzU29ja2V0c0h0dHBIYW5kbGVyKGhhbmRsZXIpKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gU3VjY2Vzc0V4aXRDb2RlOw0KICAgICAgICAgICAgfSkuRGlzcG9zZSgpOw0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Net.Http/tests/UnitTests/DigestAuthenticationTests.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLk5ldC5IdHRwOw0KdXNpbmcgWHVuaXQ7DQoNCm5hbWVzcGFjZSBTeXN0ZW0uTmV0Lkh0dHAuVGVzdHMNCnsNCiAgICBwdWJsaWMgY2xhc3MgRGlnZXN0QXV0aGVudGljYXRpb25UZXN0cw0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTGlzdDxzdHJpbmc+IHNfa2V5TGlzdFdpdGhDb3VudFR3byA9IG5ldyBMaXN0PHN0cmluZz4geyAia2V5MSIsICJrZXkyIiB9Ow0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBMaXN0PHN0cmluZz4gc192YWx1ZUxpc3RXaXRoQ291bnRUd28gPSBuZXcgTGlzdDxzdHJpbmc+IHsgInZhbHVlMSIsICJ2YWx1ZTIiIH07DQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IExpc3Q8c3RyaW5nPiBzX2xpc3RXaXRoQ291bnRPbmUgPSBuZXcgTGlzdDxzdHJpbmc+IHsgIml0ZW0xIiB9Ow0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBMaXN0PHN0cmluZz4gc19lbXB0eVN0cmluZ0xpc3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKERpZ2VzdFJlc3BvbnNlX0NoYWxsZW5nZV9UZXN0RGF0YSkpXQ0KICAgICAgICBwdWJsaWMgdm9pZCBEaWdlc3RSZXNwb25zZV9QYXJzZV9TdWNjZWVkcyhzdHJpbmcgY2hhbGxlbmdlLCBMaXN0PHN0cmluZz4ga2V5cywgTGlzdDxzdHJpbmc+IHZhbHVlcykNCiAgICAgICAgew0KICAgICAgICAgICAgQXV0aGVudGljYXRpb25IZWxwZXIuRGlnZXN0UmVzcG9uc2UgZGlnZXN0UmVzcG9uc2UgPSBuZXcgQXV0aGVudGljYXRpb25IZWxwZXIuRGlnZXN0UmVzcG9uc2UoY2hhbGxlbmdlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChrZXlzLkNvdW50LCBkaWdlc3RSZXNwb25zZS5QYXJhbWV0ZXJzLkNvdW50KTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZXMuQ291bnQsIGRpZ2VzdFJlc3BvbnNlLlBhcmFtZXRlcnMuQ291bnQpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGtleXMsIGRpZ2VzdFJlc3BvbnNlLlBhcmFtZXRlcnMuS2V5cyk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWVzLCBkaWdlc3RSZXNwb25zZS5QYXJhbWV0ZXJzLlZhbHVlcyk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIElFbnVtZXJhYmxlPG9iamVjdFtdPiBEaWdlc3RSZXNwb25zZV9DaGFsbGVuZ2VfVGVzdERhdGEoKQ0KICAgICAgICB7DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgImtleTE9dmFsdWUxLGtleTI9dmFsdWUyIiwgc19rZXlMaXN0V2l0aENvdW50VHdvLCBzX3ZhbHVlTGlzdFdpdGhDb3VudFR3byB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICJcdGtleTE9PT12YWx1ZTEsa2V5MiBcdD09PVx0dmFsdWUyIiwgc19rZXlMaXN0V2l0aENvdW50VHdvLCBzX3ZhbHVlTGlzdFdpdGhDb3VudFR3byB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBvYmplY3RbXSB7ICIgICAga2V5MSA9IHZhbHVlMSwga2V5MiA9ICAgIHZhbHVlMiwiLCBzX2tleUxpc3RXaXRoQ291bnRUd28sIHNfdmFsdWVMaXN0V2l0aENvdW50VHdvIH07DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgIml0ZW0xID09PSBpdGVtMSxrZXkyPSwgdmFsdWUyIiwgc19saXN0V2l0aENvdW50T25lLCBzX2xpc3RXaXRoQ291bnRPbmUgfTsNCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiaXRlbTEsPT1pdGVtMSwsLCAgICBrZXkyPVwidmFsdWUyXCIsIGtleTMgbSIsIG5ldyBMaXN0PHN0cmluZz4geyAiaXRlbTEsIiB9LCBzX2xpc3RXaXRoQ291bnRPbmUgfTsNCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAia2V5MT0gXCJ2YWx1ZTEgICBcIixrZXkyICA9ICBcInYgYWx1I2UyXCIgICAsIiwgc19rZXlMaXN0V2l0aENvdW50VHdvLCBuZXcgTGlzdDxzdHJpbmc+IHsgInZhbHVlMSAgICIsICJ2IGFsdSNlMiJ9IH07DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgImtleTEgICAiLCBzX2VtcHR5U3RyaW5nTGlzdCwgc19lbXB0eVN0cmluZ0xpc3QgfTsNCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiPT09PT0iLCBzX2VtcHR5U3RyaW5nTGlzdCwgc19lbXB0eVN0cmluZ0xpc3QgfTsNCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiLCwiLCBzX2VtcHR5U3RyaW5nTGlzdCwgc19lbXB0eVN0cmluZ0xpc3QgfTsNCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgb2JqZWN0W10geyAiPSw9Iiwgc19lbXB0eVN0cmluZ0xpc3QsIHNfZW1wdHlTdHJpbmdMaXN0IH07DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgIj12YWx1ZTEsa2V5Mj0sIiwgc19lbXB0eVN0cmluZ0xpc3QsIHNfZW1wdHlTdHJpbmdMaXN0IH07DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IG9iamVjdFtdIHsgImtleTFcdG09IHZhbHVlMSIsIHNfZW1wdHlTdHJpbmdMaXN0LCBzX2VtcHR5U3RyaW5nTGlzdCB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW0lubGluZURhdGEoInJlYWxtPVwiTmV0Q29yZVwiLCBub25jZT1cInFNUnFXZ0FBQUFBUU1qSUFCZ0FBQUZ3RWlFd0FBQUFBXCIsIHFvcD1cImF1dGhcIiwgc3RhbGU9ZmFsc2UiLCB0cnVlKV0NCiAgICAgICAgW0lubGluZURhdGEoInJlYWxtPVwiTmV0Q29yZVwiLCBub25jZT1cInFNUnFXZ0FBQUFBUU1qSUFCZ0FBQUZ3RWlFd0FBQUFBXCIiLCB0cnVlKV0NCiAgICAgICAgW0lubGluZURhdGEoIm5vbmNlPVwicU1ScVdnQUFBQUFRTWpJQUJnQUFBRndFaUV3QUFBQUFcIiwgcW9wPVwiYXV0aFwiLCBzdGFsZT1mYWxzZSIsIGZhbHNlKV0NCiAgICAgICAgW0lubGluZURhdGEoInJlYWxtPVwiTmV0Q29yZVwiLCBxb3A9XCJhdXRoXCIsIHN0YWxlPWZhbHNlIiwgZmFsc2UpXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgdm9pZCBEaWdlc3RSZXNwb25zZV9BdXRoVG9rZW5fSGFuZGxpbmcoc3RyaW5nIHJlc3BvbnNlLCBib29sIGV4cGVjdGVkUmVzdWx0KQ0KICAgICAgICB7DQogICAgICAgICAgICBOZXR3b3JrQ3JlZGVudGlhbCBjcmVkZW50aWFsID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKCJmb28iLCJiYXIiKTsNCiAgICAgICAgICAgIEF1dGhlbnRpY2F0aW9uSGVscGVyLkRpZ2VzdFJlc3BvbnNlIGRpZ2VzdFJlc3BvbnNlID0gbmV3IEF1dGhlbnRpY2F0aW9uSGVscGVyLkRpZ2VzdFJlc3BvbnNlKHJlc3BvbnNlKTsNCiAgICAgICAgICAgIEh0dHBSZXF1ZXN0TWVzc2FnZSByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0TWVzc2FnZShIdHRwTWV0aG9kLkdldCwgImh0dHA6Ly9taWNyb3NvZnQuY29tLyIpOw0KICAgICAgICAgICAgc3RyaW5nIHBhcmFtZXRlciA9IGF3YWl0IEF1dGhlbnRpY2F0aW9uSGVscGVyLkdldERpZ2VzdFRva2VuRm9yQ3JlZGVudGlhbChjcmVkZW50aWFsLCByZXF1ZXN0LCBkaWdlc3RSZXNwb25zZSkuQ29uZmlndXJlQXdhaXQoZmFsc2UpOw0KDQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoZXhwZWN0ZWRSZXN1bHQsIHBhcmFtZXRlciAhPSBudWxsKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        }
      },
      "results": [
        {
          "ruleId": "cs/web/missing-global-error-handler",
          "level": "warning",
          "message": "'customErrors' mode set to off in Web.config, and no 'Application_Error' handler specified in the global.asax file.",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/prerequisites/Web.config",
                "region": {
                  "startLine": 13,
                  "startColumn": -1,
                  "length": 28
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/web/missing-x-frame-options",
          "level": "warning",
          "message": "Configuration file is missing the X-Frame-Options setting.",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/prerequisites/Web.config"
              }
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"notarealuser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/DefaultCredentialsTest.cs",
                "region": {
                  "startLine": 130,
                  "startColumn": 44,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/DefaultCredentialsTest.cs",
                "region": {
                  "startLine": 130,
                  "startColumn": 44,
                  "length": 14
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/DefaultCredentialsTest.cs",
                "region": {
                  "startLine": 130,
                  "startColumn": 22,
                  "length": 47
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"123456\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/DefaultCredentialsTest.cs",
                "region": {
                  "startLine": 130,
                  "startColumn": 60,
                  "length": 8
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/DefaultCredentialsTest.cs",
                "region": {
                  "startLine": 130,
                  "startColumn": 60,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/DefaultCredentialsTest.cs",
                "region": {
                  "startLine": 130,
                  "startColumn": 22,
                  "length": 47
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 17,
                  "startColumn": 32,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 20,
                  "startColumn": 90,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 20,
                  "startColumn": 58,
                  "length": 49
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 17,
                  "startColumn": 32,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 111,
                  "startColumn": 68,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 111,
                  "startColumn": 36,
                  "length": 49
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 17,
                  "startColumn": 32,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 70,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 38,
                  "length": 49
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testusername\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 16,
                  "startColumn": 32,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 20,
                  "startColumn": 80,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 20,
                  "startColumn": 58,
                  "length": 49
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testusername\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 16,
                  "startColumn": 32,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 111,
                  "startColumn": 58,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 111,
                  "startColumn": 36,
                  "length": 49
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testusername\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 16,
                  "startColumn": 32,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 60,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 38,
                  "length": 49
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"wronguser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 129,
                  "startColumn": 137,
                  "length": 11
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 129,
                  "startColumn": 137,
                  "length": 11
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 129,
                  "startColumn": 115,
                  "length": 51
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"wrongpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 129,
                  "startColumn": 150,
                  "length": 15
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 129,
                  "startColumn": 150,
                  "length": 15
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.Authentication.cs",
                "region": {
                  "startLine": 129,
                  "startColumn": 115,
                  "length": 51
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"username\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 33,
                  "startColumn": 34,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 33,
                  "startColumn": 34,
                  "length": 10
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 33,
                  "startColumn": 12,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 33,
                  "startColumn": 46,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 33,
                  "startColumn": 46,
                  "length": 10
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 33,
                  "startColumn": 12,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"rightusername\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 51,
                  "startColumn": 47,
                  "length": 15
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 51,
                  "startColumn": 47,
                  "length": 15
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 51,
                  "startColumn": 25,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"rightpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 51,
                  "startColumn": 64,
                  "length": 15
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 51,
                  "startColumn": 64,
                  "length": 15
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 51,
                  "startColumn": 25,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"wrongusername\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 52,
                  "length": 15
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 52,
                  "length": 15
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 30,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"wrongpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 69,
                  "length": 15
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 69,
                  "length": 15
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 30,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"UsernameNotUsed\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 150,
                  "startColumn": 56,
                  "length": 17
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 150,
                  "startColumn": 56,
                  "length": 17
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 150,
                  "startColumn": 34,
                  "length": 59
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"PasswordNotUsed\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 150,
                  "startColumn": 75,
                  "length": 17
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 150,
                  "startColumn": 75,
                  "length": 17
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.DefaultProxyCredentials.cs",
                "region": {
                  "startLine": 150,
                  "startColumn": 34,
                  "length": 59
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"rightusername\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.ServerCertificates.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 76,
                  "length": 15
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.ServerCertificates.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 76,
                  "length": 15
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.ServerCertificates.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 54,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"rightpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.ServerCertificates.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 93,
                  "length": 15
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.ServerCertificates.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 93,
                  "length": 15
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.ServerCertificates.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 54,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testuser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 32,
                  "startColumn": 32,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 35,
                  "startColumn": 71,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 35,
                  "startColumn": 49,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 33,
                  "startColumn": 32,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 35,
                  "startColumn": 81,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 35,
                  "startColumn": 49,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"username\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 188,
                  "startColumn": 34,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 188,
                  "startColumn": 34,
                  "length": 10
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 188,
                  "startColumn": 12,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 188,
                  "startColumn": 46,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 188,
                  "startColumn": 46,
                  "length": 10
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 188,
                  "startColumn": 12,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testusername\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 2992,
                  "startColumn": 32,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 2996,
                  "startColumn": 39,
                  "length": 16
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 2996,
                  "startColumn": 17,
                  "length": 57
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 2993,
                  "startColumn": 32,
                  "length": 14
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 2996,
                  "startColumn": 57,
                  "length": 16
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 2996,
                  "startColumn": 17,
                  "length": 57
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"username\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3032,
                  "startColumn": 50,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3032,
                  "startColumn": 50,
                  "length": 10
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3032,
                  "startColumn": 28,
                  "length": 45
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3032,
                  "startColumn": 62,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3032,
                  "startColumn": 62,
                  "length": 10
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3032,
                  "startColumn": 28,
                  "length": 45
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"username\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3033,
                  "startColumn": 50,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3033,
                  "startColumn": 50,
                  "length": 10
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3033,
                  "startColumn": 28,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3033,
                  "startColumn": 62,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3033,
                  "startColumn": 62,
                  "length": 10
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3033,
                  "startColumn": 28,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"user:name\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3042,
                  "startColumn": 50,
                  "length": 11
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3042,
                  "startColumn": 50,
                  "length": 11
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3042,
                  "startColumn": 28,
                  "length": 46
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3042,
                  "startColumn": 63,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3042,
                  "startColumn": 63,
                  "length": 10
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3042,
                  "startColumn": 28,
                  "length": 46
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"username\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3043,
                  "startColumn": 50,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3043,
                  "startColumn": 50,
                  "length": 10
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3043,
                  "startColumn": 28,
                  "length": 58
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3043,
                  "startColumn": 62,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3043,
                  "startColumn": 62,
                  "length": 10
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 3043,
                  "startColumn": 28,
                  "length": 58
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"unused\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 553,
                  "startColumn": 44,
                  "length": 8
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 553,
                  "startColumn": 44,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 553,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"unused\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 553,
                  "startColumn": 54,
                  "length": 8
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 553,
                  "startColumn": 54,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpClientHandlerTest.cs",
                "region": {
                  "startLine": 553,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"user\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpCookieProtocolTests.cs",
                "region": {
                  "startLine": 545,
                  "startColumn": 44,
                  "length": 6
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpCookieProtocolTests.cs",
                "region": {
                  "startLine": 545,
                  "startColumn": 44,
                  "length": 6
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpCookieProtocolTests.cs",
                "region": {
                  "startLine": 545,
                  "startColumn": 22,
                  "length": 37
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"pass\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpCookieProtocolTests.cs",
                "region": {
                  "startLine": 545,
                  "startColumn": 52,
                  "length": 6
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpCookieProtocolTests.cs",
                "region": {
                  "startLine": 545,
                  "startColumn": 52,
                  "length": 6
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/HttpCookieProtocolTests.cs",
                "region": {
                  "startLine": 545,
                  "startColumn": 22,
                  "length": 37
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"user1\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 20,
                  "startColumn": 32,
                  "length": 7
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 147,
                  "startColumn": 39,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 147,
                  "startColumn": 17,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"user1\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 20,
                  "startColumn": 32,
                  "length": 7
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 156,
                  "startColumn": 39,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 156,
                  "startColumn": 17,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"user1\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 20,
                  "startColumn": 32,
                  "length": 7
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 172,
                  "startColumn": 39,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 172,
                  "startColumn": 17,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password1\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 21,
                  "startColumn": 32,
                  "length": 11
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 147,
                  "startColumn": 49,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 147,
                  "startColumn": 17,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password1\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 21,
                  "startColumn": 32,
                  "length": 11
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 156,
                  "startColumn": 49,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 156,
                  "startColumn": 17,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password1\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 21,
                  "startColumn": 32,
                  "length": 11
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 172,
                  "startColumn": 49,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioTest.cs",
                "region": {
                  "startLine": 172,
                  "startColumn": 17,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testuser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 35,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 39,
                  "startColumn": 44,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 39,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 36,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 39,
                  "startColumn": 54,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 39,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testuser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 59,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 63,
                  "startColumn": 44,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 63,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 60,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 63,
                  "startColumn": 54,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 63,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testuser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 83,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 87,
                  "startColumn": 44,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 87,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 84,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 87,
                  "startColumn": 54,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 87,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testuser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 111,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 115,
                  "startColumn": 44,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 115,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 112,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 115,
                  "startColumn": 54,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 115,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"testuser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 139,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 143,
                  "startColumn": 44,
                  "length": 8
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 143,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 140,
                  "startColumn": 18,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 143,
                  "startColumn": 54,
                  "length": 8
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/PostScenarioUWPTest.cs",
                "region": {
                  "startLine": 143,
                  "startColumn": 22,
                  "length": 41
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"username\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1052,
                  "startColumn": 43,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1052,
                  "startColumn": 43,
                  "length": 10
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1052,
                  "startColumn": 21,
                  "length": 45
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1052,
                  "startColumn": 55,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1052,
                  "startColumn": 55,
                  "length": 10
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1052,
                  "startColumn": 21,
                  "length": 45
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"username\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1065,
                  "startColumn": 43,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1065,
                  "startColumn": 43,
                  "length": 10
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1065,
                  "startColumn": 21,
                  "length": 45
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"password\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1065,
                  "startColumn": 55,
                  "length": 10
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1065,
                  "startColumn": 55,
                  "length": 10
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1065,
                  "startColumn": 21,
                  "length": 45
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"anotheruser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1303,
                  "startColumn": 87,
                  "length": 13
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1303,
                  "startColumn": 87,
                  "length": 13
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1303,
                  "startColumn": 65,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"anotherpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1303,
                  "startColumn": 102,
                  "length": 17
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1303,
                  "startColumn": 102,
                  "length": 17
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1303,
                  "startColumn": 65,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"anotheruser\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1304,
                  "startColumn": 99,
                  "length": 13
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1304,
                  "startColumn": 99,
                  "length": 13
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1304,
                  "startColumn": 77,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"anotherpassword\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1304,
                  "startColumn": 114,
                  "length": 17
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1304,
                  "startColumn": 114,
                  "length": 17
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/FunctionalTests/SocketsHttpHandlerTest.cs",
                "region": {
                  "startLine": 1304,
                  "startColumn": 77,
                  "length": 55
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"foo\" flows to the [userName] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/UnitTests/DigestAuthenticationTests.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 53,
                  "length": 5
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/UnitTests/DigestAuthenticationTests.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 53,
                  "length": 5
                }
              },
              "message": "userName"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/UnitTests/DigestAuthenticationTests.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 31,
                  "length": 34
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        },
        {
          "ruleId": "cs/hardcoded-credentials",
          "level": "warning",
          "message": "The hard-coded value \"bar\" flows to the [password] parameter in [object creation of type NetworkCredential].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/UnitTests/DigestAuthenticationTests.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 59,
                  "length": 5
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/UnitTests/DigestAuthenticationTests.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 59,
                  "length": 5
                }
              },
              "message": "password"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Net.Http/tests/UnitTests/DigestAuthenticationTests.cs",
                "region": {
                  "startLine": 52,
                  "startColumn": 31,
                  "length": 34
                }
              },
              "message": "object creation of type NetworkCredential"
            }
          ]
        }
      ],
      "rules": {
        "cs/ldap-injection": {
          "id": "cs/ldap-injection",
          "name": "cs/ldap-injection",
          "shortDescription": "LDAP query built from user-controlled sources",
          "fullDescription": "Building an LDAP query from user-controlled sources is vulnerable to insertion of malicious LDAP code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-090"
],
            "kind": "problem",
            "precision": "medium",
            "name": "LDAP query built from user-controlled sources",
            "description": "Building an LDAP query from user-controlled sources is vulnerable to insertion of malicious LDAP code by the user.",
            "id": "cs/ldap-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-090/LDAPInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/xml/xpath-injection": {
          "id": "cs/xml/xpath-injection",
          "name": "cs/xml/xpath-injection",
          "shortDescription": "XPath injection",
          "fullDescription": "Building an XPath expression from user-controlled sources is vulnerable to insertion of malicious code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-643"
],
            "kind": "problem",
            "precision": "medium",
            "name": "XPath injection",
            "description": "Building an XPath expression from user-controlled sources is vulnerable to insertion of malicious code by the user.",
            "id": "cs/xml/xpath-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-643/XPathInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/command-line-injection": {
          "id": "cs/command-line-injection",
          "name": "cs/command-line-injection",
          "shortDescription": "Uncontrolled command line",
          "fullDescription": "Using externally controlled strings in a command line may allow a malicious user to change the meaning of the command.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "correctness",
  "security",
  "external/cwe/cwe-078",
  "external/cwe/cwe-088"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Uncontrolled command line",
            "description": "Using externally controlled strings in a command line may allow a malicious user to change the meaning of the command.",
            "id": "cs/command-line-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-078/CommandInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/directory-browse-enabled": {
          "id": "cs/web/directory-browse-enabled",
          "name": "cs/web/directory-browse-enabled",
          "shortDescription": "ASP.NET config file enables directory browsing",
          "fullDescription": "Directory browsing should not be enabled in production as it can leak sensitive information.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-548"
],
            "kind": "problem",
            "precision": "very-high",
            "name": "ASP.NET config file enables directory browsing",
            "description": "Directory browsing should not be enabled in production as it can leak sensitive information.",
            "id": "cs/web/directory-browse-enabled",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-548/ASPNetDirectoryListing.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/unvalidated-url-redirection": {
          "id": "cs/web/unvalidated-url-redirection",
          "name": "cs/web/unvalidated-url-redirection",
          "shortDescription": "URL redirection from remote source",
          "fullDescription": "URL redirection based on unvalidated user input may cause redirection to malicious web sites.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-601"
],
            "kind": "problem",
            "precision": "medium",
            "name": "URL redirection from remote source",
            "description": "URL redirection based on unvalidated user input may cause redirection to malicious web sites.",
            "id": "cs/web/unvalidated-url-redirection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-601/UrlRedirect.ql",
            "problem.severity": "error"
          }
        },
        "cs/path-injection": {
          "id": "cs/path-injection",
          "name": "cs/path-injection",
          "shortDescription": "Uncontrolled data used in path expression",
          "fullDescription": "Accessing paths influenced by users can allow an attacker to access unexpected resources.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-022",
  "external/cwe/cwe-023",
  "external/cwe/cwe-036",
  "external/cwe/cwe-073",
  "external/cwe/cwe-099"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Uncontrolled data used in path expression",
            "description": "Accessing paths influenced by users can allow an attacker to access unexpected resources.",
            "id": "cs/path-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-022/TaintedPath.ql",
            "problem.severity": "error"
          }
        },
        "cs/user-controlled-bypass": {
          "id": "cs/user-controlled-bypass",
          "name": "cs/user-controlled-bypass",
          "shortDescription": "User-controlled bypass of sensitive method",
          "fullDescription": "User-controlled bypassing of sensitive methods may allow attackers to avoid passing through authentication systems.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-807",
  "external/cwe/cwe-247",
  "external/cwe/cwe-350"
],
            "kind": "problem",
            "precision": "medium",
            "name": "User-controlled bypass of sensitive method",
            "description": "User-controlled bypassing of sensitive methods may allow attackers to avoid passing through authentication systems.",
            "id": "cs/user-controlled-bypass",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-807/ConditionalBypass.ql",
            "problem.severity": "error"
          }
        },
        "cs/sensitive-data-transmission": {
          "id": "cs/sensitive-data-transmission",
          "name": "cs/sensitive-data-transmission",
          "shortDescription": "Information exposure through transmitted data",
          "fullDescription": "Transmitting sensitive information to the user is a potential security risk.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-201"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Information exposure through transmitted data",
            "description": "Transmitting sensitive information to the user is a potential security risk.",
            "id": "cs/sensitive-data-transmission",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-201/ExposureInTransmittedData.ql",
            "problem.severity": "error"
          }
        },
        "cs/inappropriate-encoding": {
          "id": "cs/inappropriate-encoding",
          "name": "cs/inappropriate-encoding",
          "shortDescription": "Inappropriate encoding",
          "fullDescription": "Using an inappropriate encoding may give unintended results and may pose a security risk.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-838"
],
            "kind": "problem",
            "precision": "low",
            "name": "Inappropriate encoding",
            "description": "Using an inappropriate encoding may give unintended results and may pose a security risk.",
            "id": "cs/inappropriate-encoding",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-838/InappropriateEncoding.ql",
            "problem.severity": "error"
          }
        },
        "cs/hardcoded-credentials": {
          "id": "cs/hardcoded-credentials",
          "name": "cs/hardcoded-credentials",
          "shortDescription": "Hard-coded credentials",
          "fullDescription": "Credentials are hard coded in the source code of the application.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-259",
  "external/cwe/cwe-321",
  "external/cwe/cwe-798"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Hard-coded credentials",
            "description": "Credentials are hard coded in the source code of the application.",
            "id": "cs/hardcoded-credentials",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-798/HardcodedCredentials.ql",
            "problem.severity": "error"
          }
        },
        "cs/insecure-randomness": {
          "id": "cs/insecure-randomness",
          "name": "cs/insecure-randomness",
          "shortDescription": "Insecure randomness",
          "fullDescription": "Using a cryptographically weak pseudo-random number generator to generate a security sensitive value may allow an attacker to predict what sensitive value will be generated.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-338"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Insecure randomness",
            "description": "Using a cryptographically weak pseudo-random number generator to generate a security sensitive value may allow an attacker to predict what sensitive value will be generated.",
            "id": "cs/insecure-randomness",
            "query-path": "/semmlecode-csharp-queries/Security Features/InsecureRandomness.ql",
            "problem.severity": "warning"
          }
        },
        "cs/empty-password-in-configuration": {
          "id": "cs/empty-password-in-configuration",
          "name": "cs/empty-password-in-configuration",
          "shortDescription": "Empty password in configuration file",
          "fullDescription": "Finds empty passwords in configuration files.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-258",
  "external/cwe/cwe-862"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Empty password in configuration file",
            "description": "Finds empty passwords in configuration files.",
            "id": "cs/empty-password-in-configuration",
            "query-path": "/semmlecode-csharp-queries/Configuration/EmptyPasswordInConfigurationFile.ql",
            "problem.severity": "warning"
          }
        },
        "cs/information-exposure-through-exception": {
          "id": "cs/information-exposure-through-exception",
          "name": "cs/information-exposure-through-exception",
          "shortDescription": "Information exposure through an exception",
          "fullDescription": "Leaking information about an exception, such as messages and stack traces, to an external user can expose implementation details that are useful to an attacker for developing a subsequent exploit.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-209",
  "external/cwe/cwe-497"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Information exposure through an exception",
            "description": "Leaking information about an exception, such as messages and stack traces, to an external user can expose implementation details that are useful to an attacker for developing a subsequent exploit.",
            "id": "cs/information-exposure-through-exception",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-209/ExceptionInformationExposure.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/missing-token-validation": {
          "id": "cs/web/missing-token-validation",
          "name": "cs/web/missing-token-validation",
          "shortDescription": "Missing cross-site request forgery token validation",
          "fullDescription": "Handling a POST request without verifying that the request came from the user allows a malicious attacker to submit a request on behalf of the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-352"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Missing cross-site request forgery token validation",
            "description": "Handling a POST request without verifying that the request came from the user allows a malicious attacker to submit a request on behalf of the user.",
            "id": "cs/web/missing-token-validation",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-352/MissingAntiForgeryTokenValidation.ql",
            "problem.severity": "error"
          }
        },
        "cs/second-order-sql-injection": {
          "id": "cs/second-order-sql-injection",
          "name": "cs/second-order-sql-injection",
          "shortDescription": "SQL query built from stored user-controlled sources",
          "fullDescription": "Building a SQL query from stored user-controlled sources is vulnerable to insertion of malicious SQL code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-089"
],
            "kind": "problem",
            "precision": "medium",
            "name": "SQL query built from stored user-controlled sources",
            "description": "Building a SQL query from stored user-controlled sources is vulnerable to insertion of malicious SQL code by the user.",
            "id": "cs/second-order-sql-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-089/SecondOrderSqlInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/unsynchronized-static-access": {
          "id": "cs/unsynchronized-static-access",
          "name": "cs/unsynchronized-static-access",
          "shortDescription": "Unsynchronized access to static collection member in non-static context",
          "fullDescription": "If an unsynchronized access to a static collection member occurs during an addition or resizing operation, an infinite loop can occur.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "concurrency",
  "external/cwe/cwe-362",
  "external/cwe/cwe-567"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Unsynchronized access to static collection member in non-static context",
            "description": "If an unsynchronized access to a static collection member occurs during an addition or resizing operation, an infinite loop can occur.",
            "id": "cs/unsynchronized-static-access",
            "query-path": "/semmlecode-csharp-queries/Concurrency/UnsynchronizedStaticAccess.ql",
            "problem.severity": "error"
          }
        },
        "cs/insufficient-key-size": {
          "id": "cs/insufficient-key-size",
          "name": "cs/insufficient-key-size",
          "shortDescription": "Weak encryption: Insufficient key size",
          "fullDescription": "Finds uses of encryption algorithms with too small a key size",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-327"
],
            "kind": "problem",
            "precision": "high",
            "name": "Weak encryption: Insufficient key size",
            "description": "Finds uses of encryption algorithms with too small a key size",
            "id": "cs/insufficient-key-size",
            "query-path": "/semmlecode-csharp-queries/Security Features/InsufficientKeySize.ql",
            "problem.severity": "warning"
          }
        },
        "cs/stored-command-line-injection": {
          "id": "cs/stored-command-line-injection",
          "name": "cs/stored-command-line-injection",
          "shortDescription": "Uncontrolled command line from stored user input",
          "fullDescription": "Using externally controlled strings in a command line may allow a malicious user to change the meaning of the command.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "correctness",
  "security",
  "external/cwe/cwe-078",
  "external/cwe/cwe-088"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Uncontrolled command line from stored user input",
            "description": "Using externally controlled strings in a command line may allow a malicious user to change the meaning of the command.",
            "id": "cs/stored-command-line-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-078/StoredCommandInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/ecb-encryption": {
          "id": "cs/ecb-encryption",
          "name": "cs/ecb-encryption",
          "shortDescription": "Encryption using ECB",
          "fullDescription": "Highlights uses of the encryption mode 'CipherMode.ECB'. This mode should normally not be used because it is vulnerable to replay attacks.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-327"
],
            "kind": "problem",
            "precision": "high",
            "name": "Encryption using ECB",
            "description": "Highlights uses of the encryption mode \u0027CipherMode.ECB\u0027. This mode should normally not be used because it is vulnerable to replay attacks.",
            "id": "cs/ecb-encryption",
            "query-path": "/semmlecode-csharp-queries/Security Features/Encryption using ECB.ql",
            "problem.severity": "warning"
          }
        },
        "cs/inadequate-rsa-padding": {
          "id": "cs/inadequate-rsa-padding",
          "name": "cs/inadequate-rsa-padding",
          "shortDescription": "Weak encryption: inadequate RSA padding",
          "fullDescription": "Finds uses of RSA encryption with inadequate padding.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-327",
  "external/cwe/cwe-780"
],
            "kind": "problem",
            "precision": "high",
            "name": "Weak encryption: inadequate RSA padding",
            "description": "Finds uses of RSA encryption with inadequate padding.",
            "id": "cs/inadequate-rsa-padding",
            "query-path": "/semmlecode-csharp-queries/Security Features/InadequateRSAPadding.ql",
            "problem.severity": "warning"
          }
        },
        "cs/cleartext-storage-of-sensitive-information": {
          "id": "cs/cleartext-storage-of-sensitive-information",
          "name": "cs/cleartext-storage-of-sensitive-information",
          "shortDescription": "Clear text storage of sensitive information",
          "fullDescription": "Sensitive information stored without encryption or hashing can expose it to an attacker.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-312",
  "external/cwe/cwe-315",
  "external/cwe/cwe-359"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Clear text storage of sensitive information",
            "description": "Sensitive information stored without encryption or hashing can expose it to an attacker.",
            "id": "cs/cleartext-storage-of-sensitive-information",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-312/CleartextStorage.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/missing-global-error-handler": {
          "id": "cs/web/missing-global-error-handler",
          "name": "cs/web/missing-global-error-handler",
          "shortDescription": "Missing global error handler",
          "fullDescription": "ASP.NET applications should not set the 'customError' mode to \"off\" without providing a global error handler, otherwise they may leak exception information.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-12",
  "external/cwe/cwe-248"
],
            "kind": "problem",
            "precision": "high",
            "name": "Missing global error handler",
            "description": "ASP.NET applications should not set the \u0027customError\u0027 mode to \"off\" without providing a global error handler, otherwise they may leak exception information.",
            "id": "cs/web/missing-global-error-handler",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-248/MissingASPNETGlobalErrorHandler.ql",
            "problem.severity": "warning"
          }
        },
        "cs/session-reuse": {
          "id": "cs/session-reuse",
          "name": "cs/session-reuse",
          "shortDescription": "Failure to abandon session",
          "fullDescription": "Reusing an existing session as a different user could allow an attacker to access someone else's account by using their session.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-384"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Failure to abandon session",
            "description": "Reusing an existing session as a different user could allow an attacker to access someone else\u0027s account by using their session.",
            "id": "cs/session-reuse",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-384/AbandonSession.ql",
            "problem.severity": "error"
          }
        },
        "cs/password-in-configuration": {
          "id": "cs/password-in-configuration",
          "name": "cs/password-in-configuration",
          "shortDescription": "Password in configuration file",
          "fullDescription": "Finds passwords in configuration files.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-13",
  "external/cwe/cwe-256",
  "external/cwe/cwe-313"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Password in configuration file",
            "description": "Finds passwords in configuration files.",
            "id": "cs/password-in-configuration",
            "query-path": "/semmlecode-csharp-queries/Configuration/PasswordInConfigurationFile.ql",
            "problem.severity": "warning"
          }
        },
        "cs/xml/missing-validation": {
          "id": "cs/xml/missing-validation",
          "name": "cs/xml/missing-validation",
          "shortDescription": "Missing XML validation",
          "fullDescription": "User input should not be processed as XML without validating it against a known schema.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-112"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Missing XML validation",
            "description": "User input should not be processed as XML without validating it against a known schema.",
            "id": "cs/xml/missing-validation",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-112/MissingXMLValidation.ql",
            "problem.severity": "recommendation"
          }
        },
        "cs/web/broad-cookie-domain": {
          "id": "cs/web/broad-cookie-domain",
          "name": "cs/web/broad-cookie-domain",
          "shortDescription": "Cookie security: overly broad domain",
          "fullDescription": "Finds cookies with an overly broad domain.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-287"
],
            "kind": "problem",
            "precision": "high",
            "name": "Cookie security: overly broad domain",
            "description": "Finds cookies with an overly broad domain.",
            "id": "cs/web/broad-cookie-domain",
            "query-path": "/semmlecode-csharp-queries/Security Features/CookieWithOverlyBroadDomain.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/persistent-cookie": {
          "id": "cs/web/persistent-cookie",
          "name": "cs/web/persistent-cookie",
          "shortDescription": "Cookie security: persistent cookie",
          "fullDescription": "Persistent cookies are vulnerable to attacks.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-539"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Cookie security: persistent cookie",
            "description": "Persistent cookies are vulnerable to attacks.",
            "id": "cs/web/persistent-cookie",
            "query-path": "/semmlecode-csharp-queries/Security Features/PersistentCookie.ql",
            "problem.severity": "warning"
          }
        },
        "cs/insecure-xml-read": {
          "id": "cs/insecure-xml-read",
          "name": "cs/insecure-xml-read",
          "shortDescription": "XML is read insecurely",
          "fullDescription": "XML may include dangerous external references, which should be restricted using a secure resolver or disabling DTD processing.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-611",
  "external/cwe/cwe-827",
  "external/cwe/cwe-776"
],
            "kind": "problem",
            "precision": "medium",
            "name": "XML is read insecurely",
            "description": "XML may include dangerous external references, which should be restricted using a secure resolver or disabling DTD processing.",
            "id": "cs/insecure-xml-read",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-611/UseXmlSecureResolver.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/xss": {
          "id": "cs/web/xss",
          "name": "cs/web/xss",
          "shortDescription": "Cross-site scripting",
          "fullDescription": "Writing user input directly to a web page allows for a cross-site scripting vulnerability.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-079",
  "external/cwe/cwe-116"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Cross-site scripting",
            "description": "Writing user input directly to a web page allows for a cross-site scripting vulnerability.",
            "id": "cs/web/xss",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-079/XSS.ql",
            "problem.severity": "error"
          }
        },
        "cs/xml/stored-xpath-injection": {
          "id": "cs/xml/stored-xpath-injection",
          "name": "cs/xml/stored-xpath-injection",
          "shortDescription": "Stored XPath injection",
          "fullDescription": "Building an XPath expression from stored data which may have been provided by the user is vulnerable to insertion of malicious code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-643"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Stored XPath injection",
            "description": "Building an XPath expression from stored data which may have been provided by the user is vulnerable to insertion of malicious code by the user.",
            "id": "cs/xml/stored-xpath-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-643/StoredXPathInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/stored-xss": {
          "id": "cs/web/stored-xss",
          "name": "cs/web/stored-xss",
          "shortDescription": "Stored cross-site scripting",
          "fullDescription": "Writing input from the database directly to a web page indicates a cross-site scripting vulnerability if the data was originally user-provided.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-079",
  "external/cwe/cwe-116"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Stored cross-site scripting",
            "description": "Writing input from the database directly to a web page indicates a cross-site scripting vulnerability if the data was originally user-provided.",
            "id": "cs/web/stored-xss",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-079/StoredXSS.ql",
            "problem.severity": "error"
          }
        },
        "cs/resource-injection": {
          "id": "cs/resource-injection",
          "name": "cs/resource-injection",
          "shortDescription": "Resource injection",
          "fullDescription": "Building a resource descriptor from untrusted user input is vulnerable to a malicious user providing an unintended resource.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-099"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Resource injection",
            "description": "Building a resource descriptor from untrusted user input is vulnerable to a malicious user providing an unintended resource.",
            "id": "cs/resource-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-099/ResourceInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/debug-binary": {
          "id": "cs/web/debug-binary",
          "name": "cs/web/debug-binary",
          "shortDescription": "Creating an ASP.NET debug binary may reveal sensitive information",
          "fullDescription": "ASP.NET projects should not produce debug binaries when deploying to production as debug builds provide additional information useful to a malicious attacker.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "maintainability",
  "frameworks/asp.net",
  "external/cwe/cwe-11"
],
            "kind": "problem",
            "precision": "very-high",
            "name": "Creating an ASP.NET debug binary may reveal sensitive information",
            "description": "ASP.NET projects should not produce debug binaries when deploying to production as debug builds provide additional information useful to a malicious attacker.",
            "id": "cs/web/debug-binary",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-011/ASPNetDebug.ql",
            "problem.severity": "warning"
          }
        },
        "cs/stored-ldap-injection": {
          "id": "cs/stored-ldap-injection",
          "name": "cs/stored-ldap-injection",
          "shortDescription": "LDAP query built from stored user-controlled sources",
          "fullDescription": "Building an LDAP query from stored user-controlled sources is vulnerable to insertion of malicious LDAP code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-090"
],
            "kind": "problem",
            "precision": "medium",
            "name": "LDAP query built from stored user-controlled sources",
            "description": "Building an LDAP query from stored user-controlled sources is vulnerable to insertion of malicious LDAP code by the user.",
            "id": "cs/stored-ldap-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-090/StoredLDAPInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/code-injection": {
          "id": "cs/code-injection",
          "name": "cs/code-injection",
          "shortDescription": "Improper control of generation of code",
          "fullDescription": "Treating externally controlled strings as code can allow an attacker to execute malicious code.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-094",
  "external/cwe/cwe-095",
  "external/cwe/cwe-096"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Improper control of generation of code",
            "description": "Treating externally controlled strings as code can allow an attacker to execute malicious code.",
            "id": "cs/code-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-094/CodeInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/unvalidated-local-pointer-arithmetic": {
          "id": "cs/unvalidated-local-pointer-arithmetic",
          "name": "cs/unvalidated-local-pointer-arithmetic",
          "shortDescription": "Unvalidated local pointer arithmetic",
          "fullDescription": "Using the result of a virtual method call in pointer arithmetic without validation is dangerous because the method may be overridden by a subtype to return any value.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-119",
  "external/cwe/cwe-120",
  "external/cwe/cwe-122",
  "external/cwe/cwe-788"
],
            "kind": "problem",
            "precision": "high",
            "name": "Unvalidated local pointer arithmetic",
            "description": "Using the result of a virtual method call in pointer arithmetic without validation is dangerous because the method may be overridden by a subtype to return any value.",
            "id": "cs/unvalidated-local-pointer-arithmetic",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-119/LocalUnvalidatedArithmetic.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/missing-x-frame-options": {
          "id": "cs/web/missing-x-frame-options",
          "name": "cs/web/missing-x-frame-options",
          "shortDescription": "Missing X-Frame-Options HTTP header",
          "fullDescription": "If the 'X-Frame-Options' setting is not provided, a malicious user may be able to overlay their own UI on top of the site by using an iframe.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-451",
  "external/cwe/cwe-829"
],
            "kind": "problem",
            "precision": "high",
            "name": "Missing X-Frame-Options HTTP header",
            "description": "If the \u0027X-Frame-Options\u0027 setting is not provided, a malicious user may be able to overlay their own UI on top of the site by using an iframe.",
            "id": "cs/web/missing-x-frame-options",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-451/MissingXFrameOptions.ql",
            "problem.severity": "error"
          }
        },
        "cs/hardcoded-connection-string-credentials": {
          "id": "cs/hardcoded-connection-string-credentials",
          "name": "cs/hardcoded-connection-string-credentials",
          "shortDescription": "Hard-coded connection string with credentials",
          "fullDescription": "Credentials are hard-coded in a connection string in the source code of the application.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-259",
  "external/cwe/cwe-321",
  "external/cwe/cwe-798"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Hard-coded connection string with credentials",
            "description": "Credentials are hard-coded in a connection string in the source code of the application.",
            "id": "cs/hardcoded-connection-string-credentials",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-798/HardcodedConnectionString.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/broad-cookie-path": {
          "id": "cs/web/broad-cookie-path",
          "name": "cs/web/broad-cookie-path",
          "shortDescription": "Cookie security: overly broad path",
          "fullDescription": "Finds cookies with an overly broad path.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-287"
],
            "kind": "problem",
            "precision": "high",
            "name": "Cookie security: overly broad path",
            "description": "Finds cookies with an overly broad path.",
            "id": "cs/web/broad-cookie-path",
            "query-path": "/semmlecode-csharp-queries/Security Features/CookieWithOverlyBroadPath.ql",
            "problem.severity": "warning"
          }
        },
        "cs/weak-encryption": {
          "id": "cs/weak-encryption",
          "name": "cs/weak-encryption",
          "shortDescription": "Weak encryption",
          "fullDescription": "Finds uses of encryption algorithms that are weak and obsolete",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-327"
],
            "kind": "problem",
            "precision": "high",
            "name": "Weak encryption",
            "description": "Finds uses of encryption algorithms that are weak and obsolete",
            "id": "cs/weak-encryption",
            "query-path": "/semmlecode-csharp-queries/Security Features/WeakEncryption.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/disabled-header-checking": {
          "id": "cs/web/disabled-header-checking",
          "name": "cs/web/disabled-header-checking",
          "shortDescription": "Header checking disabled",
          "fullDescription": "Finds places where header checking is disabled.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-113"
],
            "kind": "problem",
            "precision": "high",
            "name": "Header checking disabled",
            "description": "Finds places where header checking is disabled.",
            "id": "cs/web/disabled-header-checking",
            "query-path": "/semmlecode-csharp-queries/Security Features/HeaderCheckingDisabled.ql",
            "problem.severity": "warning"
          }
        },
        "cs/log-forging": {
          "id": "cs/log-forging",
          "name": "cs/log-forging",
          "shortDescription": "Log entries created from user input",
          "fullDescription": "Building log entries from user-controlled sources is vulnerable to insertion of forged log entries by a malicious user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-117"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Log entries created from user input",
            "description": "Building log entries from user-controlled sources is vulnerable to insertion of forged log entries by a malicious user.",
            "id": "cs/log-forging",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-117/LogForging.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/requiressl-not-set": {
          "id": "cs/web/requiressl-not-set",
          "name": "cs/web/requiressl-not-set",
          "shortDescription": "'requireSSL' attribute is not set to true",
          "fullDescription": "Omitting the 'requireSSL' attribute allows data to be transmitted insecurely using HTTP. Always set 'requireSSL' to 'true' to ensure that HTTPS is used at all times.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-319",
  "external/cwe/cwe-614"
],
            "kind": "problem",
            "precision": "high",
            "name": "\u0027requireSSL\u0027 attribute is not set to true",
            "description": "Omitting the \u0027requireSSL\u0027 attribute allows data to be transmitted insecurely using HTTP. Always set \u0027requireSSL\u0027 to \u0027true\u0027 to ensure that HTTPS is used at all times.",
            "id": "cs/web/requiressl-not-set",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-614/RequireSSL.ql",
            "problem.severity": "error"
          }
        },
        "cs/regex-injection": {
          "id": "cs/regex-injection",
          "name": "cs/regex-injection",
          "shortDescription": "Regular expression injection",
          "fullDescription": "User input should not be used in regular expressions without first being escaped, otherwise a malicious user may be able to provide a regex that could require exponential time on certain inputs.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-730",
  "external/cwe/cwe-400"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Regular expression injection",
            "description": "User input should not be used in regular expressions without first being escaped, otherwise a malicious user may be able to provide a regex that could require exponential time on certain inputs.",
            "id": "cs/regex-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-730/RegexInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/xml/insecure-dtd-handling": {
          "id": "cs/xml/insecure-dtd-handling",
          "name": "cs/xml/insecure-dtd-handling",
          "shortDescription": "Untrusted XML is read insecurely",
          "fullDescription": "Untrusted XML is read with an insecure resolver and DTD processing enabled.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-611",
  "external/cwe/cwe-827",
  "external/cwe/cwe-776"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Untrusted XML is read insecurely",
            "description": "Untrusted XML is read with an insecure resolver and DTD processing enabled.",
            "id": "cs/xml/insecure-dtd-handling",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-611/UntrustedDataInsecureXml.ql",
            "problem.severity": "error"
          }
        },
        "cs/sql-injection": {
          "id": "cs/sql-injection",
          "name": "cs/sql-injection",
          "shortDescription": "SQL query built from user-controlled sources",
          "fullDescription": "Building a SQL query from user-controlled sources is vulnerable to insertion of malicious SQL code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-089"
],
            "kind": "problem",
            "precision": "medium",
            "name": "SQL query built from user-controlled sources",
            "description": "Building a SQL query from user-controlled sources is vulnerable to insertion of malicious SQL code by the user.",
            "id": "cs/sql-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-089/SqlInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/redos": {
          "id": "cs/redos",
          "name": "cs/redos",
          "shortDescription": "Denial of Service from comparison of user input against expensive regex",
          "fullDescription": "User input should not be matched against a regular expression that could require exponential time on certain input.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-730",
  "external/cwe/cwe-400"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Denial of Service from comparison of user input against expensive regex",
            "description": "User input should not be matched against a regular expression that could require exponential time on certain input.",
            "id": "cs/redos",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-730/ReDoS.ql",
            "problem.severity": "error"
          }
        },
        "cs/exposure-of-sensitive-information": {
          "id": "cs/exposure-of-sensitive-information",
          "name": "cs/exposure-of-sensitive-information",
          "shortDescription": "Exposure of private information",
          "fullDescription": "If private information is written to an external location, it may be accessible by unauthorized persons.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-359"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Exposure of private information",
            "description": "If private information is written to an external location, it may be accessible by unauthorized persons.",
            "id": "cs/exposure-of-sensitive-information",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-359/ExposureOfPrivateInformation.ql",
            "problem.severity": "error"
          }
        }
      },
      "properties": {
        "originalUriBaseIds": {
  "%SRCROOT%": "file:///C:/corefx/src/System.Net.Http/"
}
      }
    }
  ]
}