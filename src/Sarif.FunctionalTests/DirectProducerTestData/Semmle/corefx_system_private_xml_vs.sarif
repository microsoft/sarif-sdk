{
  "$schema": "http://json.schemastore.org/sarif-1.0.0",
  "version": "1.0.0",
  "runs": [
    {
      "tool": {
        "name": "Semmle",
        "version": "1.15.2"
      },
      "files": {
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Serialization/Types.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlNlcmlhbGl6YXRpb24NCnsNCiAgICB1c2luZyBTeXN0ZW07DQogICAgdXNpbmcgU3lzdGVtLklPOw0KICAgIHVzaW5nIFN5c3RlbS5SZWZsZWN0aW9uOw0KICAgIHVzaW5nIFN5c3RlbS5Db2xsZWN0aW9uczsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsNCiAgICB1c2luZyBTeXN0ZW0uWG1sLlNjaGVtYTsNCiAgICB1c2luZyBTeXN0ZW0uWG1sOw0KICAgIHVzaW5nIFN5c3RlbS5UZXh0Ow0KICAgIHVzaW5nIFN5c3RlbS5Db21wb25lbnRNb2RlbDsNCiAgICB1c2luZyBTeXN0ZW0uR2xvYmFsaXphdGlvbjsNCiAgICB1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Ow0KICAgIHVzaW5nIFN5c3RlbS5EaWFnbm9zdGljczsNCiAgICB1c2luZyBTeXN0ZW0uTGlucTsNCiAgICB1c2luZyBTeXN0ZW0uWG1sLkV4dGVuc2lvbnM7DQogICAgdXNpbmcgU3lzdGVtLlhtbC5TZXJpYWxpemF0aW9uOw0KDQogICAgLy8gVGhlc2UgY2xhc3NlcyBwcm92aWRlIGEgaGlnaGVyIGxldmVsIHZpZXcgb24gcmVmbGVjdGlvbiBzcGVjaWZpYyB0byANCiAgICAvLyBYbWwgc2VyaWFsaXphdGlvbiwgZm9yIGV4YW1wbGU6DQogICAgLy8gLSBhbGxvd2luZyBvbmUgdG8gdGFsayBhYm91dCB0eXBlcyB3L28gaGF2aW5nIHRoZW0gY29tcGlsZWQgeWV0DQogICAgLy8gLSBhYnN0cmFjdGluZyBjb2xsZWN0aW9ucyAmIGFycmF5cw0KICAgIC8vIC0gYWJzdHJhY3RpbmcgY2xhc3Nlcywgc3RydWN0cywgaW50ZXJmYWNlcw0KICAgIC8vIC0ga25vd2luZyBhYm91dCBYU0QgcHJpbWl0aXZlcw0KICAgIC8vIC0gZGVhbGluZyB3aXRoIFNlcmlhbGl6YWJsZSBhbmQgeG1sZWxlbWVudA0KICAgIC8vIGFuZCBsb3RzIG9mIG90aGVyIGxpdHRsZSBkZXRhaWxzDQoNCiAgICBpbnRlcm5hbCBlbnVtIFR5cGVLaW5kDQogICAgew0KICAgICAgICBSb290LA0KICAgICAgICBQcmltaXRpdmUsDQogICAgICAgIEVudW0sDQogICAgICAgIFN0cnVjdCwNCiAgICAgICAgQ2xhc3MsDQogICAgICAgIEFycmF5LA0KICAgICAgICBDb2xsZWN0aW9uLA0KICAgICAgICBFbnVtZXJhYmxlLA0KICAgICAgICBWb2lkLA0KICAgICAgICBOb2RlLA0KICAgICAgICBBdHRyaWJ1dGUsDQogICAgICAgIFNlcmlhbGl6YWJsZQ0KICAgIH0NCg0KICAgIGludGVybmFsIGVudW0gVHlwZUZsYWdzDQogICAgew0KICAgICAgICBOb25lID0gMHgwLA0KICAgICAgICBBYnN0cmFjdCA9IDB4MSwNCiAgICAgICAgUmVmZXJlbmNlID0gMHgyLA0KICAgICAgICBTcGVjaWFsID0gMHg0LA0KICAgICAgICBDYW5CZUF0dHJpYnV0ZVZhbHVlID0gMHg4LA0KICAgICAgICBDYW5CZVRleHRWYWx1ZSA9IDB4MTAsDQogICAgICAgIENhbkJlRWxlbWVudFZhbHVlID0gMHgyMCwNCiAgICAgICAgSGFzQ3VzdG9tRm9ybWF0dGVyID0gMHg0MCwNCiAgICAgICAgQW1iaWd1b3VzRGF0YVR5cGUgPSAweDgwLA0KICAgICAgICBJZ25vcmVEZWZhdWx0ID0gMHgyMDAsDQogICAgICAgIEhhc0lzRW1wdHkgPSAweDQwMCwNCiAgICAgICAgSGFzRGVmYXVsdENvbnN0cnVjdG9yID0gMHg4MDAsDQogICAgICAgIFhtbEVuY29kaW5nTm90UmVxdWlyZWQgPSAweDEwMDAsDQogICAgICAgIFVzZVJlZmxlY3Rpb24gPSAweDQwMDAsDQogICAgICAgIENvbGxhcHNlV2hpdGVzcGFjZSA9IDB4ODAwMCwNCiAgICAgICAgT3B0aW9uYWxWYWx1ZSA9IDB4MTAwMDAsDQogICAgICAgIEN0b3JJbmFjY2Vzc2libGUgPSAweDIwMDAwLA0KICAgICAgICBVc2VQcml2YXRlSW1wbGVtZW50YXRpb24gPSAweDQwMDAwLA0KICAgICAgICBHZW5lcmljSW50ZXJmYWNlID0gMHg4MDAwMCwNCiAgICAgICAgVW5zdXBwb3J0ZWQgPSAweDEwMDAwMCwNCiAgICB9DQoNCiAgICBpbnRlcm5hbCBjbGFzcyBUeXBlRGVzYw0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX25hbWU7DQogICAgICAgIHByaXZhdGUgc3RyaW5nIF9mdWxsTmFtZTsNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX2NTaGFycE5hbWU7DQogICAgICAgIHByaXZhdGUgVHlwZURlc2MgX2FycmF5RWxlbWVudFR5cGVEZXNjOw0KICAgICAgICBwcml2YXRlIFR5cGVEZXNjIF9hcnJheVR5cGVEZXNjOw0KICAgICAgICBwcml2YXRlIFR5cGVEZXNjIF9udWxsYWJsZVR5cGVEZXNjOw0KICAgICAgICBwcml2YXRlIFR5cGVLaW5kIF9raW5kOw0KICAgICAgICBwcml2YXRlIFhtbFNjaGVtYVR5cGUgX2RhdGFUeXBlOw0KICAgICAgICBwcml2YXRlIFR5cGUgX3R5cGU7DQogICAgICAgIHByaXZhdGUgVHlwZURlc2MgX2Jhc2VUeXBlRGVzYzsNCiAgICAgICAgcHJpdmF0ZSBUeXBlRmxhZ3MgX2ZsYWdzOw0KICAgICAgICBwcml2YXRlIHN0cmluZyBfZm9ybWF0dGVyTmFtZTsNCiAgICAgICAgcHJpdmF0ZSBib29sIF9pc1hzZFR5cGU7DQogICAgICAgIHByaXZhdGUgYm9vbCBfaXNNaXhlZDsNCiAgICAgICAgcHJpdmF0ZSBpbnQgX3dlaWdodDsNCiAgICAgICAgcHJpdmF0ZSBFeGNlcHRpb24gX2V4Y2VwdGlvbjsNCg0KICAgICAgICBpbnRlcm5hbCBUeXBlRGVzYyhzdHJpbmcgbmFtZSwgc3RyaW5nIGZ1bGxOYW1lLCBYbWxTY2hlbWFUeXBlIGRhdGFUeXBlLCBUeXBlS2luZCBraW5kLCBUeXBlRGVzYyBiYXNlVHlwZURlc2MsIFR5cGVGbGFncyBmbGFncywgc3RyaW5nIGZvcm1hdHRlck5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9uYW1lID0gbmFtZS5SZXBsYWNlKCcrJywgJy4nKTsNCiAgICAgICAgICAgIF9mdWxsTmFtZSA9IGZ1bGxOYW1lLlJlcGxhY2UoJysnLCAnLicpOw0KICAgICAgICAgICAgX2tpbmQgPSBraW5kOw0KICAgICAgICAgICAgX2Jhc2VUeXBlRGVzYyA9IGJhc2VUeXBlRGVzYzsNCiAgICAgICAgICAgIF9mbGFncyA9IGZsYWdzOw0KICAgICAgICAgICAgX2lzWHNkVHlwZSA9IGtpbmQgPT0gVHlwZUtpbmQuUHJpbWl0aXZlOw0KICAgICAgICAgICAgaWYgKF9pc1hzZFR5cGUpDQogICAgICAgICAgICAgICAgX3dlaWdodCA9IDE7DQogICAgICAgICAgICBlbHNlIGlmIChraW5kID09IFR5cGVLaW5kLkVudW0pDQogICAgICAgICAgICAgICAgX3dlaWdodCA9IDI7DQogICAgICAgICAgICBlbHNlIGlmIChfa2luZCA9PSBUeXBlS2luZC5Sb290KQ0KICAgICAgICAgICAgICAgIF93ZWlnaHQgPSAtMTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBfd2VpZ2h0ID0gYmFzZVR5cGVEZXNjID09IG51bGwgPyAwIDogYmFzZVR5cGVEZXNjLldlaWdodCArIDE7DQogICAgICAgICAgICBfZGF0YVR5cGUgPSBkYXRhVHlwZTsNCiAgICAgICAgICAgIF9mb3JtYXR0ZXJOYW1lID0gZm9ybWF0dGVyTmFtZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFR5cGVEZXNjKHN0cmluZyBuYW1lLCBzdHJpbmcgZnVsbE5hbWUsIFR5cGVLaW5kIGtpbmQsIFR5cGVEZXNjIGJhc2VUeXBlRGVzYywgVHlwZUZsYWdzIGZsYWdzKQ0KICAgICAgICAgICAgOiB0aGlzKG5hbWUsIGZ1bGxOYW1lLCAoWG1sU2NoZW1hVHlwZSludWxsLCBraW5kLCBiYXNlVHlwZURlc2MsIGZsYWdzLCBudWxsKQ0KICAgICAgICB7IH0NCg0KICAgICAgICBpbnRlcm5hbCBUeXBlRGVzYyhUeXBlIHR5cGUsIGJvb2wgaXNYc2RUeXBlLCBYbWxTY2hlbWFUeXBlIGRhdGFUeXBlLCBzdHJpbmcgZm9ybWF0dGVyTmFtZSwgVHlwZUZsYWdzIGZsYWdzKQ0KICAgICAgICAgICAgOiB0aGlzKHR5cGUuTmFtZSwgdHlwZS5GdWxsTmFtZSwgZGF0YVR5cGUsIFR5cGVLaW5kLlByaW1pdGl2ZSwgKFR5cGVEZXNjKW51bGwsIGZsYWdzLCBmb3JtYXR0ZXJOYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBfaXNYc2RUeXBlID0gaXNYc2RUeXBlOw0KICAgICAgICAgICAgX3R5cGUgPSB0eXBlOw0KICAgICAgICB9DQogICAgICAgIGludGVybmFsIFR5cGVEZXNjKFR5cGUgdHlwZSwgc3RyaW5nIG5hbWUsIHN0cmluZyBmdWxsTmFtZSwgVHlwZUtpbmQga2luZCwgVHlwZURlc2MgYmFzZVR5cGVEZXNjLCBUeXBlRmxhZ3MgZmxhZ3MsIFR5cGVEZXNjIGFycmF5RWxlbWVudFR5cGVEZXNjKQ0KICAgICAgICAgICAgOiB0aGlzKG5hbWUsIGZ1bGxOYW1lLCBudWxsLCBraW5kLCBiYXNlVHlwZURlc2MsIGZsYWdzLCBudWxsKQ0KICAgICAgICB7DQogICAgICAgICAgICBfYXJyYXlFbGVtZW50VHlwZURlc2MgPSBhcnJheUVsZW1lbnRUeXBlRGVzYzsNCiAgICAgICAgICAgIF90eXBlID0gdHlwZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgVG9TdHJpbmcoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gX2Z1bGxOYW1lOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgVHlwZUZsYWdzIEZsYWdzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfZmxhZ3M7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNYc2RUeXBlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaXNYc2RUeXBlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIElzTWFwcGVkVHlwZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0cmluZyBOYW1lDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfbmFtZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgc3RyaW5nIEZ1bGxOYW1lDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfZnVsbE5hbWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0cmluZyBDU2hhcnBOYW1lDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfY1NoYXJwTmFtZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX2NTaGFycE5hbWUgPSBfdHlwZSA9PSBudWxsID8gQ29kZUlkZW50aWZpZXIuR2V0Q1NoYXJwTmFtZShfZnVsbE5hbWUpIDogQ29kZUlkZW50aWZpZXIuR2V0Q1NoYXJwTmFtZShfdHlwZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBfY1NoYXJwTmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFhtbFNjaGVtYVR5cGUgRGF0YVR5cGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9kYXRhVHlwZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgVHlwZSBUeXBlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfdHlwZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgc3RyaW5nIEZvcm1hdHRlck5hbWUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9mb3JtYXR0ZXJOYW1lOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBUeXBlS2luZCBLaW5kDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfa2luZDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc1ZhbHVlVHlwZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gKF9mbGFncyAmIFR5cGVGbGFncy5SZWZlcmVuY2UpID09IDA7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgQ2FuQmVBdHRyaWJ1dGVWYWx1ZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gKF9mbGFncyAmIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlKSAhPSAwOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIFhtbEVuY29kaW5nTm90UmVxdWlyZWQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIChfZmxhZ3MgJiBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCkgIT0gMDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBDYW5CZUVsZW1lbnRWYWx1ZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gKF9mbGFncyAmIFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSkgIT0gMDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBDYW5CZVRleHRWYWx1ZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gKF9mbGFncyAmIFR5cGVGbGFncy5DYW5CZVRleHRWYWx1ZSkgIT0gMDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc01peGVkDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaXNNaXhlZCB8fCBDYW5CZVRleHRWYWx1ZTsgfQ0KICAgICAgICAgICAgc2V0IHsgX2lzTWl4ZWQgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc1NwZWNpYWwNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIChfZmxhZ3MgJiBUeXBlRmxhZ3MuU3BlY2lhbCkgIT0gMDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc0FtYmlndW91c0RhdGFUeXBlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiAoX2ZsYWdzICYgVHlwZUZsYWdzLkFtYmlndW91c0RhdGFUeXBlKSAhPSAwOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIEhhc0N1c3RvbUZvcm1hdHRlcg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gKF9mbGFncyAmIFR5cGVGbGFncy5IYXNDdXN0b21Gb3JtYXR0ZXIpICE9IDA7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSGFzRGVmYXVsdFN1cHBvcnQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIChfZmxhZ3MgJiBUeXBlRmxhZ3MuSWdub3JlRGVmYXVsdCkgPT0gMDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBIYXNJc0VtcHR5DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiAoX2ZsYWdzICYgVHlwZUZsYWdzLkhhc0lzRW1wdHkpICE9IDA7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgQ29sbGFwc2VXaGl0ZXNwYWNlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiAoX2ZsYWdzICYgVHlwZUZsYWdzLkNvbGxhcHNlV2hpdGVzcGFjZSkgIT0gMDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBIYXNEZWZhdWx0Q29uc3RydWN0b3INCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIChfZmxhZ3MgJiBUeXBlRmxhZ3MuSGFzRGVmYXVsdENvbnN0cnVjdG9yKSAhPSAwOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIElzVW5zdXBwb3J0ZWQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIChfZmxhZ3MgJiBUeXBlRmxhZ3MuVW5zdXBwb3J0ZWQpICE9IDA7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNHZW5lcmljSW50ZXJmYWNlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiAoX2ZsYWdzICYgVHlwZUZsYWdzLkdlbmVyaWNJbnRlcmZhY2UpICE9IDA7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNQcml2YXRlSW1wbGVtZW50YXRpb24NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIChfZmxhZ3MgJiBUeXBlRmxhZ3MuVXNlUHJpdmF0ZUltcGxlbWVudGF0aW9uKSAhPSAwOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIENhbm5vdE5ldw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gIUhhc0RlZmF1bHRDb25zdHJ1Y3RvciB8fCBDb25zdHJ1Y3RvckluYWNjZXNzaWJsZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc0Fic3RyYWN0DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiAoX2ZsYWdzICYgVHlwZUZsYWdzLkFic3RyYWN0KSAhPSAwOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIElzT3B0aW9uYWxWYWx1ZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gKF9mbGFncyAmIFR5cGVGbGFncy5PcHRpb25hbFZhbHVlKSAhPSAwOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIFVzZVJlZmxlY3Rpb24NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIChfZmxhZ3MgJiBUeXBlRmxhZ3MuVXNlUmVmbGVjdGlvbikgIT0gMDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc1ZvaWQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9raW5kID09IFR5cGVLaW5kLlZvaWQ7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNDbGFzcw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2tpbmQgPT0gVHlwZUtpbmQuQ2xhc3M7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNTdHJ1Y3RMaWtlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfa2luZCA9PSBUeXBlS2luZC5TdHJ1Y3QgfHwgX2tpbmQgPT0gVHlwZUtpbmQuQ2xhc3M7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNBcnJheUxpa2UNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9raW5kID09IFR5cGVLaW5kLkFycmF5IHx8IF9raW5kID09IFR5cGVLaW5kLkNvbGxlY3Rpb24gfHwgX2tpbmQgPT0gVHlwZUtpbmQuRW51bWVyYWJsZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc0NvbGxlY3Rpb24NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9raW5kID09IFR5cGVLaW5kLkNvbGxlY3Rpb247IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNFbnVtZXJhYmxlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfa2luZCA9PSBUeXBlS2luZC5FbnVtZXJhYmxlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIElzQXJyYXkNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9raW5kID09IFR5cGVLaW5kLkFycmF5OyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIElzUHJpbWl0aXZlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfa2luZCA9PSBUeXBlS2luZC5QcmltaXRpdmU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNFbnVtDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfa2luZCA9PSBUeXBlS2luZC5FbnVtOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIElzTnVsbGFibGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuICFJc1ZhbHVlVHlwZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc1Jvb3QNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9raW5kID09IFR5cGVLaW5kLlJvb3Q7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgQ29uc3RydWN0b3JJbmFjY2Vzc2libGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIChfZmxhZ3MgJiBUeXBlRmxhZ3MuQ3RvckluYWNjZXNzaWJsZSkgIT0gMDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgRXhjZXB0aW9uIEV4Y2VwdGlvbg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2V4Y2VwdGlvbjsgfQ0KICAgICAgICAgICAgc2V0IHsgX2V4Y2VwdGlvbiA9IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBUeXBlRGVzYyBHZXROdWxsYWJsZVR5cGVEZXNjKFR5cGUgdHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzT3B0aW9uYWxWYWx1ZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgaWYgKF9udWxsYWJsZVR5cGVEZXNjID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX251bGxhYmxlVHlwZURlc2MgPSBuZXcgVHlwZURlc2MoIk51bGxhYmxlT2YiICsgX25hbWUsICJTeXN0ZW0uTnVsbGFibGVgMVsiICsgX2Z1bGxOYW1lICsgIl0iLCBudWxsLCBUeXBlS2luZC5TdHJ1Y3QsIHRoaXMsIF9mbGFncyB8IFR5cGVGbGFncy5PcHRpb25hbFZhbHVlLCBfZm9ybWF0dGVyTmFtZSk7DQogICAgICAgICAgICAgICAgX251bGxhYmxlVHlwZURlc2MuX3R5cGUgPSB0eXBlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gX251bGxhYmxlVHlwZURlc2M7DQogICAgICAgIH0NCiAgICAgICAgaW50ZXJuYWwgdm9pZCBDaGVja1N1cHBvcnRlZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChJc1Vuc3VwcG9ydGVkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChFeGNlcHRpb24gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IEV4Y2VwdGlvbjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdFN1cHBvcnRlZEV4Y2VwdGlvbihTUi5Gb3JtYXQoU1IuWG1sU2VyaWFsaXplclVuc3VwcG9ydGVkVHlwZSwgRnVsbE5hbWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoX2Jhc2VUeXBlRGVzYyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIF9iYXNlVHlwZURlc2MuQ2hlY2tTdXBwb3J0ZWQoKTsNCiAgICAgICAgICAgIGlmIChfYXJyYXlFbGVtZW50VHlwZURlc2MgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfYXJyYXlFbGVtZW50VHlwZURlc2MuQ2hlY2tTdXBwb3J0ZWQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHZvaWQgQ2hlY2tOZWVkQ29uc3RydWN0b3IoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIUlzVmFsdWVUeXBlICYmICFJc0Fic3RyYWN0ICYmICFIYXNEZWZhdWx0Q29uc3RydWN0b3IpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IFR5cGVGbGFncy5VbnN1cHBvcnRlZDsNCiAgICAgICAgICAgICAgICBfZXhjZXB0aW9uID0gbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbENvbnN0cnVjdG9ySW5hY2Nlc3NpYmxlLCBGdWxsTmFtZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgVHlwZURlc2MgQXJyYXlFbGVtZW50VHlwZURlc2MNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9hcnJheUVsZW1lbnRUeXBlRGVzYzsgfQ0KICAgICAgICAgICAgc2V0IHsgX2FycmF5RWxlbWVudFR5cGVEZXNjID0gdmFsdWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGludCBXZWlnaHQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF93ZWlnaHQ7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFR5cGVEZXNjIENyZWF0ZUFycmF5VHlwZURlc2MoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX2FycmF5VHlwZURlc2MgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfYXJyYXlUeXBlRGVzYyA9IG5ldyBUeXBlRGVzYyhudWxsLCBfbmFtZSArICJbXSIsIF9mdWxsTmFtZSArICJbXSIsIFR5cGVLaW5kLkFycmF5LCBudWxsLCBUeXBlRmxhZ3MuUmVmZXJlbmNlIHwgKF9mbGFncyAmIFR5cGVGbGFncy5Vc2VSZWZsZWN0aW9uKSwgdGhpcyk7DQogICAgICAgICAgICByZXR1cm4gX2FycmF5VHlwZURlc2M7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBUeXBlRGVzYyBCYXNlVHlwZURlc2MNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9iYXNlVHlwZURlc2M7IH0NCiAgICAgICAgICAgIHNldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9iYXNlVHlwZURlc2MgPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICBfd2VpZ2h0ID0gX2Jhc2VUeXBlRGVzYyA9PSBudWxsID8gMCA6IF9iYXNlVHlwZURlc2MuV2VpZ2h0ICsgMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgSXNEZXJpdmVkRnJvbShUeXBlRGVzYyBiYXNlVHlwZURlc2MpDQogICAgICAgIHsNCiAgICAgICAgICAgIFR5cGVEZXNjIHR5cGVEZXNjID0gdGhpczsNCiAgICAgICAgICAgIHdoaWxlICh0eXBlRGVzYyAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICh0eXBlRGVzYyA9PSBiYXNlVHlwZURlc2MpIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIHR5cGVEZXNjID0gdHlwZURlc2MuQmFzZVR5cGVEZXNjOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGJhc2VUeXBlRGVzYy5Jc1Jvb3Q7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgVHlwZURlc2MgRmluZENvbW1vbkJhc2VUeXBlRGVzYyhUeXBlRGVzY1tdIHR5cGVEZXNjcykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHR5cGVEZXNjcy5MZW5ndGggPT0gMCkgcmV0dXJuIG51bGw7DQogICAgICAgICAgICBUeXBlRGVzYyBsZWFzdERlcml2ZWRUeXBlRGVzYyA9IG51bGw7DQogICAgICAgICAgICBpbnQgbGVhc3REZXJpdmVkTGV2ZWwgPSBpbnQuTWF4VmFsdWU7DQoNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHlwZURlc2NzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGludCBkZXJpdmF0aW9uTGV2ZWwgPSB0eXBlRGVzY3NbaV0uV2VpZ2h0Ow0KICAgICAgICAgICAgICAgIGlmIChkZXJpdmF0aW9uTGV2ZWwgPCBsZWFzdERlcml2ZWRMZXZlbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGxlYXN0RGVyaXZlZExldmVsID0gZGVyaXZhdGlvbkxldmVsOw0KICAgICAgICAgICAgICAgICAgICBsZWFzdERlcml2ZWRUeXBlRGVzYyA9IHR5cGVEZXNjc1tpXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB3aGlsZSAobGVhc3REZXJpdmVkVHlwZURlc2MgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbnQgaTsNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdHlwZURlc2NzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCF0eXBlRGVzY3NbaV0uSXNEZXJpdmVkRnJvbShsZWFzdERlcml2ZWRUeXBlRGVzYykpIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoaSA9PSB0eXBlRGVzY3MuTGVuZ3RoKSBicmVhazsNCiAgICAgICAgICAgICAgICBsZWFzdERlcml2ZWRUeXBlRGVzYyA9IGxlYXN0RGVyaXZlZFR5cGVEZXNjLkJhc2VUeXBlRGVzYzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBsZWFzdERlcml2ZWRUeXBlRGVzYzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGludGVybmFsIGNsYXNzIFR5cGVTY29wZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBIYXNodGFibGUgX3R5cGVEZXNjcyA9IG5ldyBIYXNodGFibGUoKTsNCiAgICAgICAgcHJpdmF0ZSBIYXNodGFibGUgX2FycmF5VHlwZURlc2NzID0gbmV3IEhhc2h0YWJsZSgpOw0KICAgICAgICBwcml2YXRlIEFycmF5TGlzdCBfdHlwZU1hcHBpbmdzID0gbmV3IEFycmF5TGlzdCgpOw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIEhhc2h0YWJsZSBzX3ByaW1pdGl2ZVR5cGVzID0gbmV3IEhhc2h0YWJsZSgpOw0KICAgICAgICBwcml2YXRlIHN0YXRpYyBIYXNodGFibGUgc19wcmltaXRpdmVEYXRhVHlwZXMgPSBuZXcgSGFzaHRhYmxlKCk7DQogICAgICAgIHByaXZhdGUgc3RhdGljIE5hbWVUYWJsZSBzX3ByaW1pdGl2ZU5hbWVzID0gbmV3IE5hbWVUYWJsZSgpOw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHN0cmluZ1tdIHNfdW5zdXBwb3J0ZWRUeXBlcyA9IG5ldyBzdHJpbmdbXSB7DQogICAgICAgICAgICAiYW55VVJJIiwNCiAgICAgICAgICAgICJkdXJhdGlvbiIsDQogICAgICAgICAgICAiRU5USVRZIiwNCiAgICAgICAgICAgICJFTlRJVElFUyIsDQogICAgICAgICAgICAiZ0RheSIsDQogICAgICAgICAgICAiZ01vbnRoIiwNCiAgICAgICAgICAgICJnTW9udGhEYXkiLA0KICAgICAgICAgICAgImdZZWFyIiwNCiAgICAgICAgICAgICJnWWVhck1vbnRoIiwNCiAgICAgICAgICAgICJJRCIsDQogICAgICAgICAgICAiSURSRUYiLA0KICAgICAgICAgICAgIklEUkVGUyIsDQogICAgICAgICAgICAiaW50ZWdlciIsDQogICAgICAgICAgICAibGFuZ3VhZ2UiLA0KICAgICAgICAgICAgIm5lZ2F0aXZlSW50ZWdlciIsDQogICAgICAgICAgICAibm9uTmVnYXRpdmVJbnRlZ2VyIiwNCiAgICAgICAgICAgICJub25Qb3NpdGl2ZUludGVnZXIiLA0KICAgICAgICAgICAgLy8ibm9ybWFsaXplZFN0cmluZyIsDQogICAgICAgICAgICAiTk9UQVRJT04iLA0KICAgICAgICAgICAgInBvc2l0aXZlSW50ZWdlciIsDQogICAgICAgICAgICAidG9rZW4iDQogICAgICAgIH07DQoNCiAgICAgICAgc3RhdGljIFR5cGVTY29wZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2Yoc3RyaW5nKSwgInN0cmluZyIsICJTdHJpbmciLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZVRleHRWYWx1ZSB8IFR5cGVGbGFncy5SZWZlcmVuY2UgfCBUeXBlRmxhZ3MuSGFzRGVmYXVsdENvbnN0cnVjdG9yKTsNCiAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2YoaW50KSwgImludCIsICJJbnQzMiIsIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihib29sKSwgImJvb2xlYW4iLCAiQm9vbGVhbiIsIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihzaG9ydCksICJzaG9ydCIsICJJbnQxNiIsIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihsb25nKSwgImxvbmciLCAiSW50NjQiLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkKTsNCiAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2YoZmxvYXQpLCAiZmxvYXQiLCAiU2luZ2xlIiwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRQcmltaXRpdmUodHlwZW9mKGRvdWJsZSksICJkb3VibGUiLCAiRG91YmxlIiwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRQcmltaXRpdmUodHlwZW9mKGRlY2ltYWwpLCAiZGVjaW1hbCIsICJEZWNpbWFsIiwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRQcmltaXRpdmUodHlwZW9mKERhdGVUaW1lKSwgImRhdGVUaW1lIiwgIkRhdGVUaW1lIiwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuSGFzQ3VzdG9tRm9ybWF0dGVyIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihYbWxRdWFsaWZpZWROYW1lKSwgIlFOYW1lIiwgIlhtbFF1YWxpZmllZE5hbWUiLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5IYXNDdXN0b21Gb3JtYXR0ZXIgfCBUeXBlRmxhZ3MuSGFzSXNFbXB0eSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkIHwgVHlwZUZsYWdzLlJlZmVyZW5jZSk7DQogICAgICAgICAgICBBZGRQcmltaXRpdmUodHlwZW9mKGJ5dGUpLCAidW5zaWduZWRCeXRlIiwgIkJ5dGUiLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkKTsNCiAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2YoU0J5dGUpLCAiYnl0ZSIsICJTQnl0ZSIsIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihVSW50MTYpLCAidW5zaWduZWRTaG9ydCIsICJVSW50MTYiLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkKTsNCiAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2YoVUludDMyKSwgInVuc2lnbmVkSW50IiwgIlVJbnQzMiIsIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihVSW50NjQpLCAidW5zaWduZWRMb25nIiwgIlVJbnQ2NCIsIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KDQogICAgICAgICAgICAvLyBUeXBlcyB3aXRob3V0IGRpcmVjdCBtYXBwaW5nIChhbWJpZ3VvdXMpDQogICAgICAgICAgICBBZGRQcmltaXRpdmUodHlwZW9mKERhdGVUaW1lKSwgImRhdGUiLCAiRGF0ZSIsIFR5cGVGbGFncy5BbWJpZ3VvdXNEYXRhVHlwZSB8IFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLkhhc0N1c3RvbUZvcm1hdHRlciB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkKTsNCiAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2YoRGF0ZVRpbWUpLCAidGltZSIsICJUaW1lIiwgVHlwZUZsYWdzLkFtYmlndW91c0RhdGFUeXBlIHwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuSGFzQ3VzdG9tRm9ybWF0dGVyIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KDQogICAgICAgICAgICBBZGRQcmltaXRpdmUodHlwZW9mKHN0cmluZyksICJOYW1lIiwgIlhtbE5hbWUiLCBUeXBlRmxhZ3MuQW1iaWd1b3VzRGF0YVR5cGUgfCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5IYXNDdXN0b21Gb3JtYXR0ZXIgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlKTsNCiAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2Yoc3RyaW5nKSwgIk5DTmFtZSIsICJYbWxOQ05hbWUiLCBUeXBlRmxhZ3MuQW1iaWd1b3VzRGF0YVR5cGUgfCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5IYXNDdXN0b21Gb3JtYXR0ZXIgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlKTsNCiAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2Yoc3RyaW5nKSwgIk5NVE9LRU4iLCAiWG1sTm1Ub2tlbiIsIFR5cGVGbGFncy5BbWJpZ3VvdXNEYXRhVHlwZSB8IFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLkhhc0N1c3RvbUZvcm1hdHRlciB8IFR5cGVGbGFncy5SZWZlcmVuY2UpOw0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihzdHJpbmcpLCAiTk1UT0tFTlMiLCAiWG1sTm1Ub2tlbnMiLCBUeXBlRmxhZ3MuQW1iaWd1b3VzRGF0YVR5cGUgfCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5IYXNDdXN0b21Gb3JtYXR0ZXIgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlKTsNCg0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihieXRlW10pLCAiYmFzZTY0QmluYXJ5IiwgIkJ5dGVBcnJheUJhc2U2NCIsIFR5cGVGbGFncy5BbWJpZ3VvdXNEYXRhVHlwZSB8IFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLkhhc0N1c3RvbUZvcm1hdHRlciB8IFR5cGVGbGFncy5SZWZlcmVuY2UgfCBUeXBlRmxhZ3MuSWdub3JlRGVmYXVsdCB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkIHwgVHlwZUZsYWdzLkhhc0RlZmF1bHRDb25zdHJ1Y3Rvcik7DQogICAgICAgICAgICBBZGRQcmltaXRpdmUodHlwZW9mKGJ5dGVbXSksICJoZXhCaW5hcnkiLCAiQnl0ZUFycmF5SGV4IiwgVHlwZUZsYWdzLkFtYmlndW91c0RhdGFUeXBlIHwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuSGFzQ3VzdG9tRm9ybWF0dGVyIHwgVHlwZUZsYWdzLlJlZmVyZW5jZSB8IFR5cGVGbGFncy5JZ25vcmVEZWZhdWx0IHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQgfCBUeXBlRmxhZ3MuSGFzRGVmYXVsdENvbnN0cnVjdG9yKTsNCiAgICAgICAgICAgIC8vIE5PVEUsIE1pY29yb3NmdDogYnl0ZVtdIGNhbiBhbHNvIGJlIHVzZWQgdG8gbWVhbiBhcnJheSBvZiBieXRlcy4gVGhhdCBkYXRhdHlwZSBpcyBub3QgYSBwcmltaXRpdmUsIHNvIHdlDQogICAgICAgICAgICAvLyBjYW4ndCB1c2UgdGhlIEFtYmlndW91c0RhdGFUeXBlIG1lY2hhbmlzbS4gVG8gZ2V0IGFuIGFycmF5IG9mIGJ5dGVzIGluIGxpdGVyYWwgWE1MLCBhcHBseSBbWG1sQXJyYXldIG9yDQogICAgICAgICAgICAvLyBbWG1sQXJyYXlJdGVtXS4NCg0KICAgICAgICAgICAgWG1sU2NoZW1hUGF0dGVybkZhY2V0IGd1aWRQYXR0ZXJuID0gbmV3IFhtbFNjaGVtYVBhdHRlcm5GYWNldCgpOw0KICAgICAgICAgICAgZ3VpZFBhdHRlcm4uVmFsdWUgPSAiWzAtOWEtZkEtRl17OH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17MTJ9IjsNCg0KICAgICAgICAgICAgQWRkTm9uWHNkUHJpbWl0aXZlKHR5cGVvZihHdWlkKSwgImd1aWQiLCBVcnRUeXBlcy5OYW1lc3BhY2UsICJHdWlkIiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoInN0cmluZyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBuZXcgWG1sU2NoZW1hRmFjZXRbXSB7IGd1aWRQYXR0ZXJuIH0sIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQgfCBUeXBlRmxhZ3MuSWdub3JlRGVmYXVsdCk7DQogICAgICAgICAgICBBZGROb25Yc2RQcmltaXRpdmUodHlwZW9mKGNoYXIpLCAiY2hhciIsIFVydFR5cGVzLk5hbWVzcGFjZSwgIkNoYXIiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgidW5zaWduZWRTaG9ydCIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBuZXcgWG1sU2NoZW1hRmFjZXRbMF0sIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLkhhc0N1c3RvbUZvcm1hdHRlciB8IFR5cGVGbGFncy5JZ25vcmVEZWZhdWx0KTsNCiAgICAgICAgICAgIEFkZE5vblhzZFByaW1pdGl2ZSh0eXBlb2YoVGltZVNwYW4pLCAiVGltZVNwYW4iLCBVcnRUeXBlcy5OYW1lc3BhY2UsICJUaW1lU3BhbiIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKCJkdXJhdGlvbiIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBuZXcgWG1sU2NoZW1hRmFjZXRbMF0sIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KDQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFR5cGVzKFNvYXAuRW5jb2RpbmcpOw0KDQogICAgICAgICAgICAvLyBVbnN1cHBvdGVkIHR5cGVzIHRoYXQgd2UgbWFwIHRvIHN0cmluZywgaWYgaW4gdGhlIGZ1dHVyZSB3ZSBkZWNpZGUgDQogICAgICAgICAgICAvLyB0byBhZGQgc3VwcG9ydCBmb3IgdGhlbSB3ZSB3b3VsZCBuZWVkIHRvIGNyZWF0ZSBjdXN0b20gZm9ybWF0dGVycyBmb3IgdGhlbQ0KICAgICAgICAgICAgLy8gbm9ybWFsaXplZFN0cmluZyBpcyB0aGUgb25seSBvbmUgdW5zdXBwb3J0ZWQgdHlwZSB0aGF0IHN1cHBvc2UgdG8gcHJlc2VydmUgd2hpdGVzYXBjZQ0KICAgICAgICAgICAgQWRkUHJpbWl0aXZlKHR5cGVvZihzdHJpbmcpLCAibm9ybWFsaXplZFN0cmluZyIsICJTdHJpbmciLCBUeXBlRmxhZ3MuQW1iaWd1b3VzRGF0YVR5cGUgfCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZVRleHRWYWx1ZSB8IFR5cGVGbGFncy5SZWZlcmVuY2UgfCBUeXBlRmxhZ3MuSGFzRGVmYXVsdENvbnN0cnVjdG9yKTsNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc191bnN1cHBvcnRlZFR5cGVzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFkZFByaW1pdGl2ZSh0eXBlb2Yoc3RyaW5nKSwgc191bnN1cHBvcnRlZFR5cGVzW2ldLCAiU3RyaW5nIiwgVHlwZUZsYWdzLkFtYmlndW91c0RhdGFUeXBlIHwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVUZXh0VmFsdWUgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlIHwgVHlwZUZsYWdzLkNvbGxhcHNlV2hpdGVzcGFjZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgYm9vbCBJc0tub3duVHlwZShUeXBlIHR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh0eXBlID09IHR5cGVvZihvYmplY3QpKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgaWYgKHR5cGUuSXNFbnVtKQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCg0KICAgICAgICAgICAgc3dpdGNoICh0eXBlLkdldFR5cGVDb2RlKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5TdHJpbmc6IHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuSW50MzI6IHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuQm9vbGVhbjogcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5JbnQxNjogcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5JbnQ2NDogcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5TaW5nbGU6IHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuRG91YmxlOiByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICBjYXNlIFR5cGVDb2RlLkRlY2ltYWw6IHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuRGF0ZVRpbWU6IHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuQnl0ZTogcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5TQnl0ZTogcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5VSW50MTY6IHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuVUludDMyOiByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICBjYXNlIFR5cGVDb2RlLlVJbnQ2NDogcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5DaGFyOiByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSB0eXBlb2YoWG1sUXVhbGlmaWVkTmFtZSkpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PSB0eXBlb2YoYnl0ZVtdKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09IHR5cGVvZihHdWlkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09IHR5cGVvZihUaW1lU3BhbikpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PSB0eXBlb2YoWG1sTm9kZVtdKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgQWRkU29hcEVuY29kZWRUeXBlcyhzdHJpbmcgbnMpDQogICAgICAgIHsNCiAgICAgICAgICAgIEFkZFNvYXBFbmNvZGVkUHJpbWl0aXZlKHR5cGVvZihzdHJpbmcpLCAibm9ybWFsaXplZFN0cmluZyIsIG5zLCAiU3RyaW5nIiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoIm5vcm1hbGl6ZWRTdHJpbmciLCBYbWxTY2hlbWEuTmFtZXNwYWNlKSwgVHlwZUZsYWdzLkFtYmlndW91c0RhdGFUeXBlIHwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlIHwgVHlwZUZsYWdzLkhhc0RlZmF1bHRDb25zdHJ1Y3Rvcik7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNfdW5zdXBwb3J0ZWRUeXBlcy5MZW5ndGg7IGkrKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2Yoc3RyaW5nKSwgc191bnN1cHBvcnRlZFR5cGVzW2ldLCBucywgIlN0cmluZyIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKHNfdW5zdXBwb3J0ZWRUeXBlc1tpXSwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5BbWJpZ3VvdXNEYXRhVHlwZSB8IFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlJlZmVyZW5jZSB8IFR5cGVGbGFncy5Db2xsYXBzZVdoaXRlc3BhY2UpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2Yoc3RyaW5nKSwgInN0cmluZyIsIG5zLCAiU3RyaW5nIiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoInN0cmluZyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZVRleHRWYWx1ZSB8IFR5cGVGbGFncy5SZWZlcmVuY2UpOw0KICAgICAgICAgICAgQWRkU29hcEVuY29kZWRQcmltaXRpdmUodHlwZW9mKGludCksICJpbnQiLCBucywgIkludDMyIiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoInN0cmluZyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkKTsNCiAgICAgICAgICAgIEFkZFNvYXBFbmNvZGVkUHJpbWl0aXZlKHR5cGVvZihib29sKSwgImJvb2xlYW4iLCBucywgIkJvb2xlYW4iLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkU29hcEVuY29kZWRQcmltaXRpdmUodHlwZW9mKHNob3J0KSwgInNob3J0IiwgbnMsICJJbnQxNiIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKCJzdHJpbmciLCBYbWxTY2hlbWEuTmFtZXNwYWNlKSwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2YobG9uZyksICJsb25nIiwgbnMsICJJbnQ2NCIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKCJzdHJpbmciLCBYbWxTY2hlbWEuTmFtZXNwYWNlKSwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2YoZmxvYXQpLCAiZmxvYXQiLCBucywgIlNpbmdsZSIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKCJzdHJpbmciLCBYbWxTY2hlbWEuTmFtZXNwYWNlKSwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2YoZG91YmxlKSwgImRvdWJsZSIsIG5zLCAiRG91YmxlIiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoInN0cmluZyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkKTsNCiAgICAgICAgICAgIEFkZFNvYXBFbmNvZGVkUHJpbWl0aXZlKHR5cGVvZihkZWNpbWFsKSwgImRlY2ltYWwiLCBucywgIkRlY2ltYWwiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkU29hcEVuY29kZWRQcmltaXRpdmUodHlwZW9mKERhdGVUaW1lKSwgImRhdGVUaW1lIiwgbnMsICJEYXRlVGltZSIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKCJzdHJpbmciLCBYbWxTY2hlbWEuTmFtZXNwYWNlKSwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuSGFzQ3VzdG9tRm9ybWF0dGVyIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkU29hcEVuY29kZWRQcmltaXRpdmUodHlwZW9mKFhtbFF1YWxpZmllZE5hbWUpLCAiUU5hbWUiLCBucywgIlhtbFF1YWxpZmllZE5hbWUiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkhhc0N1c3RvbUZvcm1hdHRlciB8IFR5cGVGbGFncy5IYXNJc0VtcHR5IHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlKTsNCiAgICAgICAgICAgIEFkZFNvYXBFbmNvZGVkUHJpbWl0aXZlKHR5cGVvZihieXRlKSwgInVuc2lnbmVkQnl0ZSIsIG5zLCAiQnl0ZSIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKCJzdHJpbmciLCBYbWxTY2hlbWEuTmFtZXNwYWNlKSwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2YoU0J5dGUpLCAiYnl0ZSIsIG5zLCAiU0J5dGUiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkU29hcEVuY29kZWRQcmltaXRpdmUodHlwZW9mKFVJbnQxNiksICJ1bnNpZ25lZFNob3J0IiwgbnMsICJVSW50MTYiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KICAgICAgICAgICAgQWRkU29hcEVuY29kZWRQcmltaXRpdmUodHlwZW9mKFVJbnQzMiksICJ1bnNpZ25lZEludCIsIG5zLCAiVUludDMyIiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoInN0cmluZyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5YbWxFbmNvZGluZ05vdFJlcXVpcmVkKTsNCiAgICAgICAgICAgIEFkZFNvYXBFbmNvZGVkUHJpbWl0aXZlKHR5cGVvZihVSW50NjQpLCAidW5zaWduZWRMb25nIiwgbnMsICJVSW50NjQiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KDQogICAgICAgICAgICAvLyBUeXBlcyB3aXRob3V0IGRpcmVjdCBtYXBwaW5nIChhbWJpZ291cykNCiAgICAgICAgICAgIEFkZFNvYXBFbmNvZGVkUHJpbWl0aXZlKHR5cGVvZihEYXRlVGltZSksICJkYXRlIiwgbnMsICJEYXRlIiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoInN0cmluZyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBUeXBlRmxhZ3MuQW1iaWd1b3VzRGF0YVR5cGUgfCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5IYXNDdXN0b21Gb3JtYXR0ZXIgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2YoRGF0ZVRpbWUpLCAidGltZSIsIG5zLCAiVGltZSIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKCJzdHJpbmciLCBYbWxTY2hlbWEuTmFtZXNwYWNlKSwgVHlwZUZsYWdzLkFtYmlndW91c0RhdGFUeXBlIHwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuSGFzQ3VzdG9tRm9ybWF0dGVyIHwgVHlwZUZsYWdzLlhtbEVuY29kaW5nTm90UmVxdWlyZWQpOw0KDQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2Yoc3RyaW5nKSwgIk5hbWUiLCBucywgIlhtbE5hbWUiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5BbWJpZ3VvdXNEYXRhVHlwZSB8IFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLkhhc0N1c3RvbUZvcm1hdHRlciB8IFR5cGVGbGFncy5SZWZlcmVuY2UpOw0KICAgICAgICAgICAgQWRkU29hcEVuY29kZWRQcmltaXRpdmUodHlwZW9mKHN0cmluZyksICJOQ05hbWUiLCBucywgIlhtbE5DTmFtZSIsIG5ldyBYbWxRdWFsaWZpZWROYW1lKCJzdHJpbmciLCBYbWxTY2hlbWEuTmFtZXNwYWNlKSwgVHlwZUZsYWdzLkFtYmlndW91c0RhdGFUeXBlIHwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUgfCBUeXBlRmxhZ3MuQ2FuQmVFbGVtZW50VmFsdWUgfCBUeXBlRmxhZ3MuSGFzQ3VzdG9tRm9ybWF0dGVyIHwgVHlwZUZsYWdzLlJlZmVyZW5jZSk7DQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2Yoc3RyaW5nKSwgIk5NVE9LRU4iLCBucywgIlhtbE5tVG9rZW4iLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5BbWJpZ3VvdXNEYXRhVHlwZSB8IFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLkhhc0N1c3RvbUZvcm1hdHRlciB8IFR5cGVGbGFncy5SZWZlcmVuY2UpOw0KICAgICAgICAgICAgQWRkU29hcEVuY29kZWRQcmltaXRpdmUodHlwZW9mKHN0cmluZyksICJOTVRPS0VOUyIsIG5zLCAiWG1sTm1Ub2tlbnMiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5BbWJpZ3VvdXNEYXRhVHlwZSB8IFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLkhhc0N1c3RvbUZvcm1hdHRlciB8IFR5cGVGbGFncy5SZWZlcmVuY2UpOw0KDQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2YoYnl0ZVtdKSwgImJhc2U2NEJpbmFyeSIsIG5zLCAiQnl0ZUFycmF5QmFzZTY0IiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoInN0cmluZyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBUeXBlRmxhZ3MuQW1iaWd1b3VzRGF0YVR5cGUgfCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5IYXNDdXN0b21Gb3JtYXR0ZXIgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlIHwgVHlwZUZsYWdzLklnbm9yZURlZmF1bHQgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQogICAgICAgICAgICBBZGRTb2FwRW5jb2RlZFByaW1pdGl2ZSh0eXBlb2YoYnl0ZVtdKSwgImhleEJpbmFyeSIsIG5zLCAiQnl0ZUFycmF5SGV4IiwgbmV3IFhtbFF1YWxpZmllZE5hbWUoInN0cmluZyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpLCBUeXBlRmxhZ3MuQW1iaWd1b3VzRGF0YVR5cGUgfCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5IYXNDdXN0b21Gb3JtYXR0ZXIgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlIHwgVHlwZUZsYWdzLklnbm9yZURlZmF1bHQgfCBUeXBlRmxhZ3MuWG1sRW5jb2RpbmdOb3RSZXF1aXJlZCk7DQoNCiAgICAgICAgICAgIEFkZFNvYXBFbmNvZGVkUHJpbWl0aXZlKHR5cGVvZihzdHJpbmcpLCAiYXJyYXlDb29yZGluYXRlIiwgbnMsICJTdHJpbmciLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgic3RyaW5nIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlKTsNCiAgICAgICAgICAgIEFkZFNvYXBFbmNvZGVkUHJpbWl0aXZlKHR5cGVvZihieXRlW10pLCAiYmFzZTY0IiwgbnMsICJCeXRlQXJyYXlCYXNlNjQiLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgiYmFzZTY0QmluYXJ5IiwgWG1sU2NoZW1hLk5hbWVzcGFjZSksIFR5cGVGbGFncy5DYW5CZUF0dHJpYnV0ZVZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLklnbm9yZURlZmF1bHQgfCBUeXBlRmxhZ3MuUmVmZXJlbmNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgQWRkUHJpbWl0aXZlKFR5cGUgdHlwZSwgc3RyaW5nIGRhdGFUeXBlTmFtZSwgc3RyaW5nIGZvcm1hdHRlck5hbWUsIFR5cGVGbGFncyBmbGFncykNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hU2ltcGxlVHlwZSBkYXRhVHlwZSA9IG5ldyBYbWxTY2hlbWFTaW1wbGVUeXBlKCk7DQogICAgICAgICAgICBkYXRhVHlwZS5OYW1lID0gZGF0YVR5cGVOYW1lOw0KICAgICAgICAgICAgVHlwZURlc2MgdHlwZURlc2MgPSBuZXcgVHlwZURlc2ModHlwZSwgdHJ1ZSwgZGF0YVR5cGUsIGZvcm1hdHRlck5hbWUsIGZsYWdzKTsNCiAgICAgICAgICAgIGlmIChzX3ByaW1pdGl2ZVR5cGVzW3R5cGVdID09IG51bGwpDQogICAgICAgICAgICAgICAgc19wcmltaXRpdmVUeXBlcy5BZGQodHlwZSwgdHlwZURlc2MpOw0KICAgICAgICAgICAgc19wcmltaXRpdmVEYXRhVHlwZXMuQWRkKGRhdGFUeXBlLCB0eXBlRGVzYyk7DQogICAgICAgICAgICBzX3ByaW1pdGl2ZU5hbWVzLkFkZChkYXRhVHlwZU5hbWUsIFhtbFNjaGVtYS5OYW1lc3BhY2UsIHR5cGVEZXNjKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgQWRkTm9uWHNkUHJpbWl0aXZlKFR5cGUgdHlwZSwgc3RyaW5nIGRhdGFUeXBlTmFtZSwgc3RyaW5nIG5zLCBzdHJpbmcgZm9ybWF0dGVyTmFtZSwgWG1sUXVhbGlmaWVkTmFtZSBiYXNlVHlwZU5hbWUsIFhtbFNjaGVtYUZhY2V0W10gZmFjZXRzLCBUeXBlRmxhZ3MgZmxhZ3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZVR5cGUgZGF0YVR5cGUgPSBuZXcgWG1sU2NoZW1hU2ltcGxlVHlwZSgpOw0KICAgICAgICAgICAgZGF0YVR5cGUuTmFtZSA9IGRhdGFUeXBlTmFtZTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZVR5cGVSZXN0cmljdGlvbiByZXN0cmljdGlvbiA9IG5ldyBYbWxTY2hlbWFTaW1wbGVUeXBlUmVzdHJpY3Rpb24oKTsNCiAgICAgICAgICAgIHJlc3RyaWN0aW9uLkJhc2VUeXBlTmFtZSA9IGJhc2VUeXBlTmFtZTsNCiAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYUZhY2V0IGZhY2V0IGluIGZhY2V0cykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXN0cmljdGlvbi5GYWNldHMuQWRkKGZhY2V0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRhdGFUeXBlLkNvbnRlbnQgPSByZXN0cmljdGlvbjsNCiAgICAgICAgICAgIFR5cGVEZXNjIHR5cGVEZXNjID0gbmV3IFR5cGVEZXNjKHR5cGUsIGZhbHNlLCBkYXRhVHlwZSwgZm9ybWF0dGVyTmFtZSwgZmxhZ3MpOw0KICAgICAgICAgICAgaWYgKHNfcHJpbWl0aXZlVHlwZXNbdHlwZV0gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBzX3ByaW1pdGl2ZVR5cGVzLkFkZCh0eXBlLCB0eXBlRGVzYyk7DQogICAgICAgICAgICBzX3ByaW1pdGl2ZURhdGFUeXBlcy5BZGQoZGF0YVR5cGUsIHR5cGVEZXNjKTsNCiAgICAgICAgICAgIHNfcHJpbWl0aXZlTmFtZXMuQWRkKGRhdGFUeXBlTmFtZSwgbnMsIHR5cGVEZXNjKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgQWRkU29hcEVuY29kZWRQcmltaXRpdmUoVHlwZSB0eXBlLCBzdHJpbmcgZGF0YVR5cGVOYW1lLCBzdHJpbmcgbnMsIHN0cmluZyBmb3JtYXR0ZXJOYW1lLCBYbWxRdWFsaWZpZWROYW1lIGJhc2VUeXBlTmFtZSwgVHlwZUZsYWdzIGZsYWdzKQ0KICAgICAgICB7DQogICAgICAgICAgICBBZGROb25Yc2RQcmltaXRpdmUodHlwZSwgZGF0YVR5cGVOYW1lLCBucywgZm9ybWF0dGVyTmFtZSwgYmFzZVR5cGVOYW1lLCBuZXcgWG1sU2NoZW1hRmFjZXRbMF0sIGZsYWdzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFR5cGVEZXNjIEdldFR5cGVEZXNjKHN0cmluZyBuYW1lLCBzdHJpbmcgbnMpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBHZXRUeXBlRGVzYyhuYW1lLCBucywgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlVGV4dFZhbHVlIHwgVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgVHlwZURlc2MgR2V0VHlwZURlc2Moc3RyaW5nIG5hbWUsIHN0cmluZyBucywgVHlwZUZsYWdzIGZsYWdzKQ0KICAgICAgICB7DQogICAgICAgICAgICBUeXBlRGVzYyB0eXBlRGVzYyA9IChUeXBlRGVzYylzX3ByaW1pdGl2ZU5hbWVzW25hbWUsIG5zXTsNCiAgICAgICAgICAgIGlmICh0eXBlRGVzYyAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICgodHlwZURlc2MuRmxhZ3MgJiBmbGFncykgIT0gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlRGVzYzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFR5cGVEZXNjIEdldFR5cGVEZXNjKFhtbFNjaGVtYVNpbXBsZVR5cGUgZGF0YVR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiAoVHlwZURlc2Mpc19wcmltaXRpdmVEYXRhVHlwZXNbZGF0YVR5cGVdOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgVHlwZURlc2MgR2V0VHlwZURlc2MoVHlwZSB0eXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gR2V0VHlwZURlc2ModHlwZSwgbnVsbCwgdHJ1ZSwgdHJ1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBUeXBlRGVzYyBHZXRUeXBlRGVzYyhUeXBlIHR5cGUsIE1lbWJlckluZm8gc291cmNlLCBib29sIGRpcmVjdFJlZmVyZW5jZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIEdldFR5cGVEZXNjKHR5cGUsIHNvdXJjZSwgZGlyZWN0UmVmZXJlbmNlLCB0cnVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFR5cGVEZXNjIEdldFR5cGVEZXNjKFR5cGUgdHlwZSwgTWVtYmVySW5mbyBzb3VyY2UsIGJvb2wgZGlyZWN0UmVmZXJlbmNlLCBib29sIHRocm93T25FcnJvcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHR5cGUuQ29udGFpbnNHZW5lcmljUGFyYW1ldGVycykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5Gb3JtYXQoU1IuWG1sVW5zdXBwb3J0ZWRPcGVuR2VuZXJpY1R5cGUsIHR5cGUuVG9TdHJpbmcoKSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgVHlwZURlc2MgdHlwZURlc2MgPSAoVHlwZURlc2Mpc19wcmltaXRpdmVUeXBlc1t0eXBlXTsNCiAgICAgICAgICAgIGlmICh0eXBlRGVzYyA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHR5cGVEZXNjID0gKFR5cGVEZXNjKV90eXBlRGVzY3NbdHlwZV07DQogICAgICAgICAgICAgICAgaWYgKHR5cGVEZXNjID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0eXBlRGVzYyA9IEltcG9ydFR5cGVEZXNjKHR5cGUsIHNvdXJjZSwgZGlyZWN0UmVmZXJlbmNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhyb3dPbkVycm9yKQ0KICAgICAgICAgICAgICAgIHR5cGVEZXNjLkNoZWNrU3VwcG9ydGVkKCk7DQoNCg0KICAgICAgICAgICAgcmV0dXJuIHR5cGVEZXNjOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgVHlwZURlc2MgR2V0QXJyYXlUeXBlRGVzYyhUeXBlIHR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFR5cGVEZXNjIHR5cGVEZXNjID0gKFR5cGVEZXNjKV9hcnJheVR5cGVEZXNjc1t0eXBlXTsNCiAgICAgICAgICAgIGlmICh0eXBlRGVzYyA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHR5cGVEZXNjID0gR2V0VHlwZURlc2ModHlwZSk7DQogICAgICAgICAgICAgICAgaWYgKCF0eXBlRGVzYy5Jc0FycmF5TGlrZSkNCiAgICAgICAgICAgICAgICAgICAgdHlwZURlc2MgPSBJbXBvcnRUeXBlRGVzYyh0eXBlLCBudWxsLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgdHlwZURlc2MuQ2hlY2tTdXBwb3J0ZWQoKTsNCiAgICAgICAgICAgICAgICBfYXJyYXlUeXBlRGVzY3MuQWRkKHR5cGUsIHR5cGVEZXNjKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0eXBlRGVzYzsNCiAgICAgICAgfQ0KDQojaWYgIUZFQVRVUkVfU0VSSUFMSVpBVElPTl9VQVBBT1QNCiAgICAgICAgaW50ZXJuYWwgVHlwZU1hcHBpbmcgR2V0VHlwZU1hcHBpbmdGcm9tVHlwZURlc2MoVHlwZURlc2MgdHlwZURlc2MpDQogICAgICAgIHsNCiAgICAgICAgICAgIGZvcmVhY2ggKFR5cGVNYXBwaW5nIHR5cGVNYXBwaW5nIGluIFR5cGVNYXBwaW5ncykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAodHlwZU1hcHBpbmcuVHlwZURlc2MgPT0gdHlwZURlc2MpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlTWFwcGluZzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgVHlwZSBHZXRUeXBlRnJvbVR5cGVEZXNjKFR5cGVEZXNjIHR5cGVEZXNjKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAodHlwZURlc2MuVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0eXBlRGVzYy5UeXBlOw0KICAgICAgICAgICAgZm9yZWFjaCAoRGljdGlvbmFyeUVudHJ5IGRlIGluIF90eXBlRGVzY3MpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGRlLlZhbHVlID09IHR5cGVEZXNjKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGUuS2V5IGFzIFR5cGU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KI2VuZGlmDQoNCiAgICAgICAgcHJpdmF0ZSBUeXBlRGVzYyBJbXBvcnRUeXBlRGVzYyhUeXBlIHR5cGUsIE1lbWJlckluZm8gbWVtYmVySW5mbywgYm9vbCBkaXJlY3RSZWZlcmVuY2UpDQogICAgICAgIHsNCiAgICAgICAgICAgIFR5cGVEZXNjIHR5cGVEZXNjID0gbnVsbDsNCiAgICAgICAgICAgIFR5cGVLaW5kIGtpbmQ7DQogICAgICAgICAgICBUeXBlIGFycmF5RWxlbWVudFR5cGUgPSBudWxsOw0KICAgICAgICAgICAgVHlwZSBiYXNlVHlwZSA9IG51bGw7DQogICAgICAgICAgICBUeXBlRmxhZ3MgZmxhZ3MgPSAwOw0KICAgICAgICAgICAgRXhjZXB0aW9uIGV4Y2VwdGlvbiA9IG51bGw7DQoNCiAgICAgICAgICAgIGlmICghdHlwZS5Jc1Zpc2libGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLlVuc3VwcG9ydGVkOw0KICAgICAgICAgICAgICAgIGV4Y2VwdGlvbiA9IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxUeXBlSW5hY2Nlc3NpYmxlLCB0eXBlLkZ1bGxOYW1lKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChkaXJlY3RSZWZlcmVuY2UgJiYgKHR5cGUuSXNBYnN0cmFjdCAmJiB0eXBlLklzU2VhbGVkKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmbGFncyB8PSBUeXBlRmxhZ3MuVW5zdXBwb3J0ZWQ7DQogICAgICAgICAgICAgICAgZXhjZXB0aW9uID0gbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbFR5cGVTdGF0aWMsIHR5cGUuRnVsbE5hbWUpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChEeW5hbWljQXNzZW1ibGllcy5Jc1R5cGVEeW5hbWljKHR5cGUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IFR5cGVGbGFncy5Vc2VSZWZsZWN0aW9uOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCF0eXBlLklzVmFsdWVUeXBlKQ0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IFR5cGVGbGFncy5SZWZlcmVuY2U7DQoNCiAgICAgICAgICAgIGlmICh0eXBlID09IHR5cGVvZihvYmplY3QpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGtpbmQgPSBUeXBlS2luZC5Sb290Ow0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IFR5cGVGbGFncy5IYXNEZWZhdWx0Q29uc3RydWN0b3I7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09IHR5cGVvZihWYWx1ZVR5cGUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGtpbmQgPSBUeXBlS2luZC5FbnVtOw0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IFR5cGVGbGFncy5VbnN1cHBvcnRlZDsNCiAgICAgICAgICAgICAgICBpZiAoZXhjZXB0aW9uID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBleGNlcHRpb24gPSBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxTZXJpYWxpemVyVW5zdXBwb3J0ZWRUeXBlLCB0eXBlLkZ1bGxOYW1lKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PSB0eXBlb2Yodm9pZCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAga2luZCA9IFR5cGVLaW5kLlZvaWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YoSVhtbFNlcmlhbGl6YWJsZSkuSXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBraW5kID0gVHlwZUtpbmQuU2VyaWFsaXphYmxlOw0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IFR5cGVGbGFncy5TcGVjaWFsIHwgVHlwZUZsYWdzLkNhbkJlRWxlbWVudFZhbHVlOw0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IEdldENvbnN0cnVjdG9yRmxhZ3ModHlwZSwgcmVmIGV4Y2VwdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlLklzQXJyYXkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAga2luZCA9IFR5cGVLaW5kLkFycmF5Ow0KICAgICAgICAgICAgICAgIGlmICh0eXBlLkdldEFycmF5UmFuaygpID4gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGZsYWdzIHw9IFR5cGVGbGFncy5VbnN1cHBvcnRlZDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGV4Y2VwdGlvbiA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHRpb24gPSBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxVbnN1cHBvcnRlZFJhbmssIHR5cGUuRnVsbE5hbWUpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBhcnJheUVsZW1lbnRUeXBlID0gdHlwZS5HZXRFbGVtZW50VHlwZSgpOw0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IFR5cGVGbGFncy5IYXNEZWZhdWx0Q29uc3RydWN0b3I7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YoSUNvbGxlY3Rpb24pLklzQXNzaWduYWJsZUZyb20odHlwZSkgJiYgIUlzQXJyYXlTZWdtZW50KHR5cGUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGtpbmQgPSBUeXBlS2luZC5Db2xsZWN0aW9uOw0KICAgICAgICAgICAgICAgIGFycmF5RWxlbWVudFR5cGUgPSBHZXRDb2xsZWN0aW9uRWxlbWVudFR5cGUodHlwZSwgbWVtYmVySW5mbyA9PSBudWxsID8gbnVsbCA6IG1lbWJlckluZm8uRGVjbGFyaW5nVHlwZS5GdWxsTmFtZSArICIuIiArIG1lbWJlckluZm8uTmFtZSk7DQogICAgICAgICAgICAgICAgZmxhZ3MgfD0gR2V0Q29uc3RydWN0b3JGbGFncyh0eXBlLCByZWYgZXhjZXB0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT0gdHlwZW9mKFhtbFF1YWxpZmllZE5hbWUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGtpbmQgPSBUeXBlS2luZC5QcmltaXRpdmU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlLklzUHJpbWl0aXZlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGtpbmQgPSBUeXBlS2luZC5QcmltaXRpdmU7DQogICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLlVuc3VwcG9ydGVkOw0KICAgICAgICAgICAgICAgIGlmIChleGNlcHRpb24gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdGlvbiA9IG5ldyBOb3RTdXBwb3J0ZWRFeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbFNlcmlhbGl6ZXJVbnN1cHBvcnRlZFR5cGUsIHR5cGUuRnVsbE5hbWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlLklzRW51bSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBraW5kID0gVHlwZUtpbmQuRW51bTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUuSXNWYWx1ZVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAga2luZCA9IFR5cGVLaW5kLlN0cnVjdDsNCiAgICAgICAgICAgICAgICBpZiAoSXNPcHRpb25hbFZhbHVlKHR5cGUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZVR5cGUgPSB0eXBlLkdldEdlbmVyaWNBcmd1bWVudHMoKVswXTsNCiAgICAgICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLk9wdGlvbmFsVmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGJhc2VUeXBlID0gdHlwZS5CYXNlVHlwZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHR5cGUuSXNBYnN0cmFjdCkgZmxhZ3MgfD0gVHlwZUZsYWdzLkFic3RyYWN0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZS5Jc0NsYXNzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICh0eXBlID09IHR5cGVvZihYbWxBdHRyaWJ1dGUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAga2luZCA9IFR5cGVLaW5kLkF0dHJpYnV0ZTsNCiAgICAgICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLlNwZWNpYWwgfCBUeXBlRmxhZ3MuQ2FuQmVBdHRyaWJ1dGVWYWx1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mKFhtbE5vZGUpLklzQXNzaWduYWJsZUZyb20odHlwZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBraW5kID0gVHlwZUtpbmQuTm9kZTsNCiAgICAgICAgICAgICAgICAgICAgYmFzZVR5cGUgPSB0eXBlLkJhc2VUeXBlOw0KICAgICAgICAgICAgICAgICAgICBmbGFncyB8PSBUeXBlRmxhZ3MuU3BlY2lhbCB8IFR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZSB8IFR5cGVGbGFncy5DYW5CZVRleHRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihYbWxUZXh0KS5Jc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MgJj0gflR5cGVGbGFncy5DYW5CZUVsZW1lbnRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mKFhtbEVsZW1lbnQpLklzQXNzaWduYWJsZUZyb20odHlwZSkpDQogICAgICAgICAgICAgICAgICAgICAgICBmbGFncyAmPSB+VHlwZUZsYWdzLkNhbkJlVGV4dFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlLklzQXNzaWduYWJsZUZyb20odHlwZW9mKFhtbEF0dHJpYnV0ZSkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLkNhbkJlQXR0cmlidXRlVmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGtpbmQgPSBUeXBlS2luZC5DbGFzczsNCiAgICAgICAgICAgICAgICAgICAgYmFzZVR5cGUgPSB0eXBlLkJhc2VUeXBlOw0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZS5Jc0Fic3RyYWN0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLkFic3RyYWN0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUuSXNJbnRlcmZhY2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAga2luZCA9IFR5cGVLaW5kLlZvaWQ7DQogICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLlVuc3VwcG9ydGVkOw0KICAgICAgICAgICAgICAgIGlmIChleGNlcHRpb24gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChtZW1iZXJJbmZvID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdGlvbiA9IG5ldyBOb3RTdXBwb3J0ZWRFeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbFVuc3VwcG9ydGVkSW50ZXJmYWNlLCB0eXBlLkZ1bGxOYW1lKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHRpb24gPSBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxVbnN1cHBvcnRlZEludGVyZmFjZURldGFpbHMsIG1lbWJlckluZm8uRGVjbGFyaW5nVHlwZS5GdWxsTmFtZSArICIuIiArIG1lbWJlckluZm8uTmFtZSwgdHlwZS5GdWxsTmFtZSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGtpbmQgPSBUeXBlS2luZC5Wb2lkOw0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IFR5cGVGbGFncy5VbnN1cHBvcnRlZDsNCiAgICAgICAgICAgICAgICBpZiAoZXhjZXB0aW9uID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBleGNlcHRpb24gPSBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxTZXJpYWxpemVyVW5zdXBwb3J0ZWRUeXBlLCB0eXBlLkZ1bGxOYW1lKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgdGhlIHR5cGUgaGFzIHB1YmxpYyBkZWZhdWx0IGNvbnN0cnVjdG9yIGZvciBjbGFzc2VzDQogICAgICAgICAgICBpZiAoa2luZCA9PSBUeXBlS2luZC5DbGFzcyAmJiAhdHlwZS5Jc0Fic3RyYWN0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZsYWdzIHw9IEdldENvbnN0cnVjdG9yRmxhZ3ModHlwZSwgcmVmIGV4Y2VwdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBjaGVjayBpZiBhIHN0cnVjdC1saWtlIHR5cGUgaXMgZW51bWVyYWJsZQ0KICAgICAgICAgICAgaWYgKGtpbmQgPT0gVHlwZUtpbmQuU3RydWN0IHx8IGtpbmQgPT0gVHlwZUtpbmQuQ2xhc3MpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZihJRW51bWVyYWJsZSkuSXNBc3NpZ25hYmxlRnJvbSh0eXBlKSAmJiAhSXNBcnJheVNlZ21lbnQodHlwZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhcnJheUVsZW1lbnRUeXBlID0gR2V0RW51bWVyYXRvckVsZW1lbnRUeXBlKHR5cGUsIHJlZiBmbGFncyk7DQogICAgICAgICAgICAgICAgICAgIGtpbmQgPSBUeXBlS2luZC5FbnVtZXJhYmxlOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIEdldEVudW1lcmF0b3JFbGVtZW50VHlwZSBjaGVja3MgZm9yIHRoZSBzZWN1cml0eSBhdHRyaWJ1dGVzIG9uIHRoZSBHZXRFbnVtZXJhdG9yKCksIEFkZCgpIG1ldGhvZHMgYW5kIEN1cnJlbnQgcHJvcGVydHksIA0KICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGNoZWNrIHRoZSBNb3ZlTmV4dCgpIGFuZCBjdG9yIG1ldGhvZHMgZm9yIHRoZSBzZWN1cml0eSBhdHRyaWJ1ZXMNCiAgICAgICAgICAgICAgICAgICAgZmxhZ3MgfD0gR2V0Q29uc3RydWN0b3JGbGFncyh0eXBlLCByZWYgZXhjZXB0aW9uKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0eXBlRGVzYyA9IG5ldyBUeXBlRGVzYyh0eXBlLCBDb2RlSWRlbnRpZmllci5NYWtlVmFsaWQoVHlwZU5hbWUodHlwZSkpLCB0eXBlLlRvU3RyaW5nKCksIGtpbmQsIG51bGwsIGZsYWdzLCBudWxsKTsNCiAgICAgICAgICAgIHR5cGVEZXNjLkV4Y2VwdGlvbiA9IGV4Y2VwdGlvbjsNCg0KICAgICAgICAgICAgaWYgKGRpcmVjdFJlZmVyZW5jZSAmJiAodHlwZURlc2MuSXNDbGFzcyB8fCBraW5kID09IFR5cGVLaW5kLlNlcmlhbGl6YWJsZSkpDQogICAgICAgICAgICAgICAgdHlwZURlc2MuQ2hlY2tOZWVkQ29uc3RydWN0b3IoKTsNCg0KICAgICAgICAgICAgaWYgKHR5cGVEZXNjLklzVW5zdXBwb3J0ZWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gcmV0dXJuIHJpZ2h0IGF3YXksIGRvIG5vdCBjaGVjayBhbnl0aGluZyBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVEZXNjOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX3R5cGVEZXNjcy5BZGQodHlwZSwgdHlwZURlc2MpOw0KDQogICAgICAgICAgICBpZiAoYXJyYXlFbGVtZW50VHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFR5cGVEZXNjIHRkID0gR2V0VHlwZURlc2MoYXJyYXlFbGVtZW50VHlwZSwgbWVtYmVySW5mbywgdHJ1ZSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIC8vIGV4cGxpY2l0bHkgZGlzYWxsb3cgcmVhZC1vbmx5IGVsZW1lbnRzLCBldmVuIGlmIHRoZXkgYXJlIGNvbGxlY3Rpb25zDQogICAgICAgICAgICAgICAgaWYgKGRpcmVjdFJlZmVyZW5jZSAmJiAodGQuSXNDb2xsZWN0aW9uIHx8IHRkLklzRW51bWVyYWJsZSkgJiYgIXRkLklzUHJpbWl0aXZlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGQuQ2hlY2tOZWVkQ29uc3RydWN0b3IoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdHlwZURlc2MuQXJyYXlFbGVtZW50VHlwZURlc2MgPSB0ZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChiYXNlVHlwZSAhPSBudWxsICYmIGJhc2VUeXBlICE9IHR5cGVvZihvYmplY3QpICYmIGJhc2VUeXBlICE9IHR5cGVvZihWYWx1ZVR5cGUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHR5cGVEZXNjLkJhc2VUeXBlRGVzYyA9IEdldFR5cGVEZXNjKGJhc2VUeXBlLCBtZW1iZXJJbmZvLCBmYWxzZSwgZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGUuSXNOZXN0ZWRQdWJsaWMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9yIChUeXBlIHQgPSB0eXBlLkRlY2xhcmluZ1R5cGU7IHQgIT0gbnVsbCAmJiAhdC5Db250YWluc0dlbmVyaWNQYXJhbWV0ZXJzICYmICEodC5Jc0Fic3RyYWN0ICYmIHQuSXNTZWFsZWQpOyB0ID0gdC5EZWNsYXJpbmdUeXBlKQ0KICAgICAgICAgICAgICAgICAgICBHZXRUeXBlRGVzYyh0LCBudWxsLCBmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdHlwZURlc2M7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBib29sIElzQXJyYXlTZWdtZW50KFR5cGUgdCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIHQuSXNHZW5lcmljVHlwZSAmJiAodC5HZXRHZW5lcmljVHlwZURlZmluaXRpb24oKSA9PSB0eXBlb2YoQXJyYXlTZWdtZW50PD4pKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyBib29sIElzT3B0aW9uYWxWYWx1ZShUeXBlIHR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh0eXBlLklzR2VuZXJpY1R5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHR5cGUuR2V0R2VuZXJpY1R5cGVEZWZpbml0aW9uKCkgPT0gdHlwZW9mKE51bGxhYmxlPD4pLkdldEdlbmVyaWNUeXBlRGVmaW5pdGlvbigpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qDQogICAgICAgIHN0YXRpYyBzdHJpbmcgR2V0SGFzaChzdHJpbmcgc3RyKSB7DQogICAgICAgICAgICBNRDUgbWQ1ID0gTUQ1LkNyZWF0ZSgpOw0KICAgICAgICAgICAgc3RyaW5nIGhhc2ggPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKG1kNS5Db21wdXRlSGFzaChFbmNvZGluZy5VVEY4LkdldEJ5dGVzKHN0cikpLCAwLCA2KS5SZXBsYWNlKCIrIiwgIl9QIikuUmVwbGFjZSgiLyIsICJfUyIpOw0KICAgICAgICAgICAgcmV0dXJuIGhhc2g7DQogICAgICAgIH0NCiAgICAgICAgKi8NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgc3RyaW5nIFR5cGVOYW1lKFR5cGUgdCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHQuSXNBcnJheSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gIkFycmF5T2YiICsgVHlwZU5hbWUodC5HZXRFbGVtZW50VHlwZSgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHQuSXNHZW5lcmljVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHR5cGVOYW1lID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsNCiAgICAgICAgICAgICAgICBTdHJpbmdCdWlsZGVyIG5zID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsNCiAgICAgICAgICAgICAgICBzdHJpbmcgbmFtZSA9IHQuTmFtZTsNCiAgICAgICAgICAgICAgICBpbnQgYXJpdHkgPSBuYW1lLkluZGV4T2YoImAiLCBTdHJpbmdDb21wYXJpc29uLk9yZGluYWwpOw0KICAgICAgICAgICAgICAgIGlmIChhcml0eSA+PSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuU3Vic3RyaW5nKDAsIGFyaXR5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdHlwZU5hbWUuQXBwZW5kKG5hbWUpOw0KICAgICAgICAgICAgICAgIHR5cGVOYW1lLkFwcGVuZCgiT2YiKTsNCiAgICAgICAgICAgICAgICBUeXBlW10gYXJndW1lbnRzID0gdC5HZXRHZW5lcmljQXJndW1lbnRzKCk7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmd1bWVudHMuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZS5BcHBlbmQoVHlwZU5hbWUoYXJndW1lbnRzW2ldKSk7DQogICAgICAgICAgICAgICAgICAgIG5zLkFwcGVuZChhcmd1bWVudHNbaV0uTmFtZXNwYWNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAgICBpZiAobnMuTGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZS5BcHBlbmQoIl8iKTsNCiAgICAgICAgICAgICAgICAgICAgdHlwZU5hbWUuQXBwZW5kKEdldEhhc2gobnMuVG9TdHJpbmcoKSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIHJldHVybiB0eXBlTmFtZS5Ub1N0cmluZygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHQuTmFtZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyBUeXBlIEdldEFycmF5RWxlbWVudFR5cGUoVHlwZSB0eXBlLCBzdHJpbmcgbWVtYmVySW5mbykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHR5cGUuSXNBcnJheSkNCiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZS5HZXRFbGVtZW50VHlwZSgpOw0KICAgICAgICAgICAgZWxzZSBpZiAoSXNBcnJheVNlZ21lbnQodHlwZSkpDQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YoSUNvbGxlY3Rpb24pLklzQXNzaWduYWJsZUZyb20odHlwZSkpDQogICAgICAgICAgICAgICAgcmV0dXJuIEdldENvbGxlY3Rpb25FbGVtZW50VHlwZSh0eXBlLCBtZW1iZXJJbmZvKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZihJRW51bWVyYWJsZSkuSXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBUeXBlRmxhZ3MgZmxhZ3MgPSBUeXBlRmxhZ3MuTm9uZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gR2V0RW51bWVyYXRvckVsZW1lbnRUeXBlKHR5cGUsIHJlZiBmbGFncyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgTWVtYmVyTWFwcGluZ1tdIEdldEFsbE1lbWJlcnMoU3RydWN0TWFwcGluZyBtYXBwaW5nKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAobWFwcGluZy5CYXNlTWFwcGluZyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXBwaW5nLk1lbWJlcnM7DQogICAgICAgICAgICBBcnJheUxpc3QgbGlzdCA9IG5ldyBBcnJheUxpc3QoKTsNCiAgICAgICAgICAgIEdldEFsbE1lbWJlcnMobWFwcGluZywgbGlzdCk7DQogICAgICAgICAgICByZXR1cm4gKE1lbWJlck1hcHBpbmdbXSlsaXN0LlRvQXJyYXkodHlwZW9mKE1lbWJlck1hcHBpbmcpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyB2b2lkIEdldEFsbE1lbWJlcnMoU3RydWN0TWFwcGluZyBtYXBwaW5nLCBBcnJheUxpc3QgbGlzdCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG1hcHBpbmcuQmFzZU1hcHBpbmcgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBHZXRBbGxNZW1iZXJzKG1hcHBpbmcuQmFzZU1hcHBpbmcsIGxpc3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5nLk1lbWJlcnMuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGlzdC5BZGQobWFwcGluZy5NZW1iZXJzW2ldKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyBNZW1iZXJNYXBwaW5nW10gR2V0QWxsTWVtYmVycyhTdHJ1Y3RNYXBwaW5nIG1hcHBpbmcsIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkRpY3Rpb25hcnk8c3RyaW5nLCBNZW1iZXJJbmZvPiBtZW1iZXJJbmZvcykNCiAgICAgICAgew0KICAgICAgICAgICAgTWVtYmVyTWFwcGluZ1tdIG1hcHBpbmdzID0gR2V0QWxsTWVtYmVycyhtYXBwaW5nKTsNCiAgICAgICAgICAgIFBvcHVsYXRlTWVtYmVySW5mb3MobWFwcGluZywgbWFwcGluZ3MsIG1lbWJlckluZm9zKTsNCiAgICAgICAgICAgIHJldHVybiBtYXBwaW5nczsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyBNZW1iZXJNYXBwaW5nW10gR2V0U2V0dGFibGVNZW1iZXJzKFN0cnVjdE1hcHBpbmcgc3RydWN0TWFwcGluZykNCiAgICAgICAgew0KICAgICAgICAgICAgQXJyYXlMaXN0IGxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAgICAgICBHZXRTZXR0YWJsZU1lbWJlcnMoc3RydWN0TWFwcGluZywgbGlzdCk7DQogICAgICAgICAgICByZXR1cm4gKE1lbWJlck1hcHBpbmdbXSlsaXN0LlRvQXJyYXkodHlwZW9mKE1lbWJlck1hcHBpbmcpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgR2V0U2V0dGFibGVNZW1iZXJzKFN0cnVjdE1hcHBpbmcgbWFwcGluZywgQXJyYXlMaXN0IGxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChtYXBwaW5nLkJhc2VNYXBwaW5nICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgR2V0U2V0dGFibGVNZW1iZXJzKG1hcHBpbmcuQmFzZU1hcHBpbmcsIGxpc3QpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAobWFwcGluZy5NZW1iZXJzICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoTWVtYmVyTWFwcGluZyBtZW1iZXJNYXBwaW5nIGluIG1hcHBpbmcuTWVtYmVycykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIE1lbWJlckluZm8gbWVtYmVySW5mbyA9IG1lbWJlck1hcHBpbmcuTWVtYmVySW5mbzsNCiAgICAgICAgICAgICAgICAgICAgUHJvcGVydHlJbmZvIHByb3BlcnR5SW5mbyA9IG1lbWJlckluZm8gYXMgUHJvcGVydHlJbmZvOw0KICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHlJbmZvICE9IG51bGwgJiYgIUNhbldyaXRlUHJvcGVydHkocHJvcGVydHlJbmZvLCBtZW1iZXJNYXBwaW5nLlR5cGVEZXNjKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbFJlYWRPbmx5UHJvcGVydHlFcnJvciwgcHJvcGVydHlJbmZvLkRlY2xhcmluZ1R5cGUsIHByb3BlcnR5SW5mby5OYW1lKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgbGlzdC5BZGQobWVtYmVyTWFwcGluZyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBDYW5Xcml0ZVByb3BlcnR5KFByb3BlcnR5SW5mbyBwcm9wZXJ0eUluZm8sIFR5cGVEZXNjIHR5cGVEZXNjKQ0KICAgICAgICB7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQocHJvcGVydHlJbmZvICE9IG51bGwpOw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KHR5cGVEZXNjICE9IG51bGwpOw0KDQogICAgICAgICAgICAvLyBJZiB0aGUgcHJvcGVydHkgaXMgYSBjb2xsZWN0aW9uLCB3ZSBkb24ndCBuZWVkIGEgc2V0dGVyLg0KICAgICAgICAgICAgaWYgKHR5cGVEZXNjLktpbmQgPT0gVHlwZUtpbmQuQ29sbGVjdGlvbiB8fCB0eXBlRGVzYy5LaW5kID09IFR5cGVLaW5kLkVudW1lcmFibGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBFbHNlIHRoZSBwcm9wZXJ0eSBuZWVkcyBhIHB1YmxpYyBzZXR0ZXIuDQogICAgICAgICAgICByZXR1cm4gcHJvcGVydHlJbmZvLlNldE1ldGhvZCAhPSBudWxsICYmIHByb3BlcnR5SW5mby5TZXRNZXRob2QuSXNQdWJsaWM7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgTWVtYmVyTWFwcGluZ1tdIEdldFNldHRhYmxlTWVtYmVycyhTdHJ1Y3RNYXBwaW5nIG1hcHBpbmcsIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkRpY3Rpb25hcnk8c3RyaW5nLCBNZW1iZXJJbmZvPiBtZW1iZXJJbmZvcykNCiAgICAgICAgew0KICAgICAgICAgICAgTWVtYmVyTWFwcGluZ1tdIG1hcHBpbmdzID0gR2V0U2V0dGFibGVNZW1iZXJzKG1hcHBpbmcpOw0KICAgICAgICAgICAgUG9wdWxhdGVNZW1iZXJJbmZvcyhtYXBwaW5nLCBtYXBwaW5ncywgbWVtYmVySW5mb3MpOw0KICAgICAgICAgICAgcmV0dXJuIG1hcHBpbmdzOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBQb3B1bGF0ZU1lbWJlckluZm9zKFN0cnVjdE1hcHBpbmcgc3RydWN0TWFwcGluZywgTWVtYmVyTWFwcGluZ1tdIG1hcHBpbmdzLCBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5EaWN0aW9uYXJ5PHN0cmluZywgTWVtYmVySW5mbz4gbWVtYmVySW5mb3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIG1lbWJlckluZm9zLkNsZWFyKCk7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLkxlbmd0aDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG1lbWJlckluZm9zW21hcHBpbmdzW2ldLk5hbWVdID0gbWFwcGluZ3NbaV0uTWVtYmVySW5mbzsNCiAgICAgICAgICAgICAgICBpZiAobWFwcGluZ3NbaV0uQ2hvaWNlSWRlbnRpZmllciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBtZW1iZXJJbmZvc1ttYXBwaW5nc1tpXS5DaG9pY2VJZGVudGlmaWVyLk1lbWJlck5hbWVdID0gbWFwcGluZ3NbaV0uQ2hvaWNlSWRlbnRpZmllci5NZW1iZXJJbmZvOw0KICAgICAgICAgICAgICAgIGlmIChtYXBwaW5nc1tpXS5DaGVja1NwZWNpZmllZE1lbWJlckluZm8gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgbWVtYmVySW5mb3NbbWFwcGluZ3NbaV0uTmFtZSArICJTcGVjaWZpZWQiXSA9IG1hcHBpbmdzW2ldLkNoZWNrU3BlY2lmaWVkTWVtYmVySW5mbzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVGhlIHNjZW5hcmlvIGhlcmUgaXMgdGhhdCB1c2VyIGhhcyBvbmUgYmFzZSBjbGFzcyBBIGFuZCBvbmUgZGVyaXZlZCBjbGFzcyBCIGFuZCB3YW50cyB0byBzZXJpYWxpemUvZGVzZXJpYWxpemUgYW4gb2JqZWN0IG9mIEIuDQogICAgICAgICAgICAvLyBUaGVyZSdzIG9uZSB2aXJ0dWFsIHByb3BlcnR5IGRlZmluZWQgaW4gQSBhbmQgb3ZlcnJpZGRlbiBieSBCLiBXaXRob3V0IHRoZSByZXBsYWNpbmcgbG9naWMgYmVsb3csIHRoZSBjb2RlIGdlbmVyYXRlZCB3aWxsIGFsd2F5cw0KICAgICAgICAgICAgLy8gdHJ5IHRvIGFjY2VzcyB0aGUgcHJvcGVydHkgZGVmaW5lZCBpbiBBLCByYXRoZXIgdGhhbiBCLg0KICAgICAgICAgICAgLy8gVGhlIGxvZ2ljIGhlcmUgaXMgdG86DQogICAgICAgICAgICAvLyAxKSBDaGVjayBjdXJyZW50IG1lbWJlcnMgaW5zaWRlIG1lbWJlckluZm9zIGRpY3Rpb25hcnkgYW5kIGZpZ3VyZSBvdXQgd2hldGhlciB0aGVyZSdzIGFueSBvdmVycmlkZSBvciBuZXcgcHJvcGVydGllcyBkZWZpbmVkIGluIHRoZSBkZXJpdmVkIGNsYXNzLg0KICAgICAgICAgICAgLy8gICAgSWYgc28sIHJlcGxhY2UgdGhlIG9uZSBvbiB0aGUgYmFzZSBjbGFzcyB3aXRoIHRoZSBvbmUgb24gdGhlIGRlcml2ZWQgY2xhc3MuDQogICAgICAgICAgICAvLyAyKSBEbyB0aGUgc2FtZSB0aGluZyBmb3IgdGhlIG1lbWJlck1hcHBpbmcgYXJyYXkuIE5vdGUgdGhhdCB3ZSBuZWVkIHRvIGNyZWF0ZSBhIG5ldyBjb3B5IG9mIE1lbWJlck1hcHBpbmcgb2JqZWN0IHNpbmNlIHRoZSBvbGQgb25lIGNvdWxkIHN0aWxsIGJlIHJlZmVyZW5jZWQNCiAgICAgICAgICAgIC8vICAgIGJ5IHRoZSBTdHJ1Y3RNYXBwaW5nIG9mIHRoZSBiYXNlY2xhc3MsIHNvIHVwZGF0aW5nIGl0IGRpcmVjdGx5IGNvdWxkIGxlYWQgdG8gb3RoZXIgaXNzdWVzLg0KICAgICAgICAgICAgRGljdGlvbmFyeTxzdHJpbmcsIE1lbWJlckluZm8+IHJlcGxhY2VMaXN0ID0gbnVsbDsNCiAgICAgICAgICAgIE1lbWJlckluZm8gcmVwbGFjZWRJbmZvID0gbnVsbDsNCiAgICAgICAgICAgIGZvcmVhY2ggKEtleVZhbHVlUGFpcjxzdHJpbmcsIE1lbWJlckluZm8+IHBhaXIgaW4gbWVtYmVySW5mb3MpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKFNob3VsZEJlUmVwbGFjZWQocGFpci5WYWx1ZSwgc3RydWN0TWFwcGluZy5UeXBlRGVzYy5UeXBlLCBvdXQgcmVwbGFjZWRJbmZvKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlTGlzdCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlTGlzdCA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgTWVtYmVySW5mbz4oKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VMaXN0LkFkZChwYWlyLktleSwgcmVwbGFjZWRJbmZvKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChyZXBsYWNlTGlzdCAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKEtleVZhbHVlUGFpcjxzdHJpbmcsIE1lbWJlckluZm8+IHBhaXIgaW4gcmVwbGFjZUxpc3QpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBtZW1iZXJJbmZvc1twYWlyLktleV0gPSBwYWlyLlZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgTWVtYmVySW5mbyBtaTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcGxhY2VMaXN0LlRyeUdldFZhbHVlKG1hcHBpbmdzW2ldLk5hbWUsIG91dCBtaSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIE1lbWJlck1hcHBpbmcgbmV3TWFwcGluZyA9IG1hcHBpbmdzW2ldLkNsb25lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdNYXBwaW5nLk1lbWJlckluZm8gPSBtaTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzW2ldID0gbmV3TWFwcGluZzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIGJvb2wgU2hvdWxkQmVSZXBsYWNlZChNZW1iZXJJbmZvIG1lbWJlckluZm9Ub0JlUmVwbGFjZWQsIFR5cGUgZGVyaXZlZFR5cGUsIG91dCBNZW1iZXJJbmZvIHJlcGxhY2VkSW5mbykNCiAgICAgICAgew0KICAgICAgICAgICAgcmVwbGFjZWRJbmZvID0gbWVtYmVySW5mb1RvQmVSZXBsYWNlZDsNCiAgICAgICAgICAgIFR5cGUgY3VycmVudFR5cGUgPSBkZXJpdmVkVHlwZTsNCiAgICAgICAgICAgIFR5cGUgdHlwZVRvQmVSZXBsYWNlZCA9IG1lbWJlckluZm9Ub0JlUmVwbGFjZWQuRGVjbGFyaW5nVHlwZTsNCg0KICAgICAgICAgICAgaWYgKHR5cGVUb0JlUmVwbGFjZWQuSXNBc3NpZ25hYmxlRnJvbShjdXJyZW50VHlwZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnRUeXBlICE9IHR5cGVUb0JlUmVwbGFjZWQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBUeXBlSW5mbyBjdXJyZW50SW5mbyA9IGN1cnJlbnRUeXBlLkdldFR5cGVJbmZvKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoUHJvcGVydHlJbmZvIGluZm8gaW4gY3VycmVudEluZm8uRGVjbGFyZWRQcm9wZXJ0aWVzKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mby5OYW1lID09IG1lbWJlckluZm9Ub0JlUmVwbGFjZWQuTmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIGEgbmV3IG1vZGlmaWVyIHNpdHVhdGlvbjogcHJvcGVydHkgbmFtZXMgYXJlIHRoZSBzYW1lIGJ1dCB0aGUgZGVjbGFyaW5nIHR5cGVzIGFyZSBkaWZmZXJlbnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlZEluZm8gPSBpbmZvOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlZEluZm8gIT0gbWVtYmVySW5mb1RvQmVSZXBsYWNlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5mby5HZXRNZXRob2QuSXNQdWJsaWMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIG1lbWJlckluZm9Ub0JlUmVwbGFjZWQgaXMgUHJvcGVydHlJbmZvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAoKFByb3BlcnR5SW5mbyltZW1iZXJJbmZvVG9CZVJlcGxhY2VkKS5HZXRNZXRob2QuSXNQdWJsaWMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKEZpZWxkSW5mbyBpbmZvIGluIGN1cnJlbnRJbmZvLkRlY2xhcmVkRmllbGRzKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mby5OYW1lID09IG1lbWJlckluZm9Ub0JlUmVwbGFjZWQuTmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIGEgbmV3IG1vZGlmaWVyIHNpdHVhdGlvbjogZmllbGQgbmFtZXMgYXJlIHRoZSBzYW1lIGJ1dCB0aGUgZGVjbGFyaW5nIHR5cGVzIGFyZSBkaWZmZXJlbnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlZEluZm8gPSBpbmZvOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlZEluZm8gIT0gbWVtYmVySW5mb1RvQmVSZXBsYWNlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIC8vIHdlIGdvIG9uZSBsZXZlbCBkb3duIGFuZCB0cnkgYWdhaW4NCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFR5cGUgPSBjdXJyZW50VHlwZS5CYXNlVHlwZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIFR5cGVGbGFncyBHZXRDb25zdHJ1Y3RvckZsYWdzKFR5cGUgdHlwZSwgcmVmIEV4Y2VwdGlvbiBleGNlcHRpb24pDQogICAgICAgIHsNCiAgICAgICAgICAgIENvbnN0cnVjdG9ySW5mbyBjdG9yID0gdHlwZS5HZXRDb25zdHJ1Y3RvcihCaW5kaW5nRmxhZ3MuUHVibGljIHwgQmluZGluZ0ZsYWdzLkluc3RhbmNlIHwgQmluZGluZ0ZsYWdzLk5vblB1YmxpYywgQXJyYXkuRW1wdHk8VHlwZT4oKSk7DQogICAgICAgICAgICBpZiAoY3RvciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFR5cGVGbGFncyBmbGFncyA9IFR5cGVGbGFncy5IYXNEZWZhdWx0Q29uc3RydWN0b3I7DQogICAgICAgICAgICAgICAgaWYgKCFjdG9yLklzUHVibGljKQ0KICAgICAgICAgICAgICAgICAgICBmbGFncyB8PSBUeXBlRmxhZ3MuQ3RvckluYWNjZXNzaWJsZTsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBvYmplY3RbXSBhdHRycyA9IGN0b3IuR2V0Q3VzdG9tQXR0cmlidXRlcyh0eXBlb2YoT2Jzb2xldGVBdHRyaWJ1dGUpLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChhdHRycyAhPSBudWxsICYmIGF0dHJzLkxlbmd0aCA+IDApDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIE9ic29sZXRlQXR0cmlidXRlIG9ic29sZXRlID0gKE9ic29sZXRlQXR0cmlidXRlKWF0dHJzWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ic29sZXRlLklzRXJyb3IpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLkN0b3JJbmFjY2Vzc2libGU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGZsYWdzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBUeXBlIEdldEVudW1lcmF0b3JFbGVtZW50VHlwZShUeXBlIHR5cGUsIHJlZiBUeXBlRmxhZ3MgZmxhZ3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YoSUVudW1lcmFibGUpLklzQXNzaWduYWJsZUZyb20odHlwZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTWV0aG9kSW5mbyBlbnVtZXJhdG9yID0gdHlwZS5HZXRNZXRob2QoIkdldEVudW1lcmF0b3IiLCBBcnJheS5FbXB0eTxUeXBlPigpKTsNCg0KICAgICAgICAgICAgICAgIGlmIChlbnVtZXJhdG9yID09IG51bGwgfHwgIXR5cGVvZihJRW51bWVyYXRvcikuSXNBc3NpZ25hYmxlRnJvbShlbnVtZXJhdG9yLlJldHVyblR5cGUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IGdlbmVyaWMgaW1wbGVtZW50YXRpb24NCiAgICAgICAgICAgICAgICAgICAgZW51bWVyYXRvciA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKE1lbWJlckluZm8gbWVtYmVyIGluIHR5cGUuR2V0TWVtYmVyKCJTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5JRW51bWVyYWJsZTwqIiwgQmluZGluZ0ZsYWdzLlB1YmxpYyB8IEJpbmRpbmdGbGFncy5JbnN0YW5jZSB8IEJpbmRpbmdGbGFncy5Ob25QdWJsaWMpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhdG9yID0gbWVtYmVyIGFzIE1ldGhvZEluZm87DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW51bWVyYXRvciAhPSBudWxsICYmIHR5cGVvZihJRW51bWVyYXRvcikuSXNBc3NpZ25hYmxlRnJvbShlbnVtZXJhdG9yLlJldHVyblR5cGUpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZSB0aGUgZmlyc3Qgb25lIHdlIGZpbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFncyB8PSBUeXBlRmxhZ3MuR2VuZXJpY0ludGVyZmFjZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhdG9yID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoZW51bWVyYXRvciA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgZmluYWxseSBwcml2YXRlIGludGVyZmFjZSBpbXBsZW1lbnRhdGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MgfD0gVHlwZUZsYWdzLlVzZVByaXZhdGVJbXBsZW1lbnRhdGlvbjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmF0b3IgPSB0eXBlLkdldE1ldGhvZCgiU3lzdGVtLkNvbGxlY3Rpb25zLklFbnVtZXJhYmxlLkdldEVudW1lcmF0b3IiLCBCaW5kaW5nRmxhZ3MuUHVibGljIHwgQmluZGluZ0ZsYWdzLkluc3RhbmNlIHwgQmluZGluZ0ZsYWdzLk5vblB1YmxpYywgQXJyYXkuRW1wdHk8VHlwZT4oKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGVudW1lcmF0b3IgPT0gbnVsbCB8fCAhdHlwZW9mKElFbnVtZXJhdG9yKS5Jc0Fzc2lnbmFibGVGcm9tKGVudW1lcmF0b3IuUmV0dXJuVHlwZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgWG1sQXR0cmlidXRlcyBtZXRob2RBdHRycyA9IG5ldyBYbWxBdHRyaWJ1dGVzKGVudW1lcmF0b3IpOw0KICAgICAgICAgICAgICAgIGlmIChtZXRob2RBdHRycy5YbWxJZ25vcmUpIHJldHVybiBudWxsOw0KDQogICAgICAgICAgICAgICAgUHJvcGVydHlJbmZvIHAgPSBlbnVtZXJhdG9yLlJldHVyblR5cGUuR2V0UHJvcGVydHkoIkN1cnJlbnQiKTsNCiAgICAgICAgICAgICAgICBUeXBlIGN1cnJlbnRUeXBlID0gKHAgPT0gbnVsbCA/IHR5cGVvZihvYmplY3QpIDogcC5Qcm9wZXJ0eVR5cGUpOw0KDQogICAgICAgICAgICAgICAgTWV0aG9kSW5mbyBhZGRNZXRob2QgPSB0eXBlLkdldE1ldGhvZCgiQWRkIiwgbmV3IFR5cGVbXSB7IGN1cnJlbnRUeXBlIH0pOw0KDQogICAgICAgICAgICAgICAgaWYgKGFkZE1ldGhvZCA9PSBudWxsICYmIGN1cnJlbnRUeXBlICE9IHR5cGVvZihvYmplY3QpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFR5cGUgPSB0eXBlb2Yob2JqZWN0KTsNCiAgICAgICAgICAgICAgICAgICAgYWRkTWV0aG9kID0gdHlwZS5HZXRNZXRob2QoIkFkZCIsIG5ldyBUeXBlW10geyBjdXJyZW50VHlwZSB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGFkZE1ldGhvZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbE5vQWRkTWV0aG9kLCB0eXBlLkZ1bGxOYW1lLCBjdXJyZW50VHlwZSwgIklFbnVtZXJhYmxlIikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFR5cGU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgUHJvcGVydHlJbmZvIEdldERlZmF1bHRJbmRleGVyKFR5cGUgdHlwZSwgc3RyaW5nIG1lbWJlckluZm8pDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YoSURpY3Rpb25hcnkpLklzQXNzaWduYWJsZUZyb20odHlwZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG1lbWJlckluZm8gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBOb3RTdXBwb3J0ZWRFeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbFVuc3VwcG9ydGVkSURpY3Rpb25hcnksIHR5cGUuRnVsbE5hbWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdFN1cHBvcnRlZEV4Y2VwdGlvbihTUi5Gb3JtYXQoU1IuWG1sVW5zdXBwb3J0ZWRJRGljdGlvbmFyeURldGFpbHMsIG1lbWJlckluZm8sIHR5cGUuRnVsbE5hbWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIE1lbWJlckluZm9bXSBkZWZhdWx0TWVtYmVycyA9IHR5cGUuR2V0RGVmYXVsdE1lbWJlcnMoKTsNCiAgICAgICAgICAgIFByb3BlcnR5SW5mbyBpbmRleGVyID0gbnVsbDsNCiAgICAgICAgICAgIGlmIChkZWZhdWx0TWVtYmVycyAhPSBudWxsICYmIGRlZmF1bHRNZW1iZXJzLkxlbmd0aCA+IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9yIChUeXBlIHQgPSB0eXBlOyB0ICE9IG51bGw7IHQgPSB0LkJhc2VUeXBlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkZWZhdWx0TWVtYmVycy5MZW5ndGg7IGkrKykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlZmF1bHRNZW1iZXJzW2ldIGlzIFByb3BlcnR5SW5mbykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9wZXJ0eUluZm8gZGVmYXVsdFByb3AgPSAoUHJvcGVydHlJbmZvKWRlZmF1bHRNZW1iZXJzW2ldOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0UHJvcC5EZWNsYXJpbmdUeXBlICE9IHQpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGVmYXVsdFByb3AuQ2FuUmVhZCkgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWV0aG9kSW5mbyBnZXRNZXRob2QgPSBkZWZhdWx0UHJvcC5HZXRNZXRob2Q7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW1ldGVySW5mb1tdIHBhcmFtZXRlcnMgPSBnZXRNZXRob2QuR2V0UGFyYW1ldGVycygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJzLkxlbmd0aCA9PSAxICYmIHBhcmFtZXRlcnNbMF0uUGFyYW1ldGVyVHlwZSA9PSB0eXBlb2YoaW50KSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ZXIgPSBkZWZhdWx0UHJvcDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleGVyICE9IG51bGwpIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChpbmRleGVyID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbE5vRGVmYXVsdEFjY2Vzc29ycywgdHlwZS5GdWxsTmFtZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgTWV0aG9kSW5mbyBhZGRNZXRob2QgPSB0eXBlLkdldE1ldGhvZCgiQWRkIiwgbmV3IFR5cGVbXSB7IGluZGV4ZXIuUHJvcGVydHlUeXBlIH0pOw0KICAgICAgICAgICAgaWYgKGFkZE1ldGhvZCA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxOb0FkZE1ldGhvZCwgdHlwZS5GdWxsTmFtZSwgaW5kZXhlci5Qcm9wZXJ0eVR5cGUsICJJQ29sbGVjdGlvbiIpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBpbmRleGVyOw0KICAgICAgICB9DQogICAgICAgIHByaXZhdGUgc3RhdGljIFR5cGUgR2V0Q29sbGVjdGlvbkVsZW1lbnRUeXBlKFR5cGUgdHlwZSwgc3RyaW5nIG1lbWJlckluZm8pDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBHZXREZWZhdWx0SW5kZXhlcih0eXBlLCBtZW1iZXJJbmZvKS5Qcm9wZXJ0eVR5cGU7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgWG1sUXVhbGlmaWVkTmFtZSBQYXJzZVdzZGxBcnJheVR5cGUoc3RyaW5nIHR5cGUsIG91dCBzdHJpbmcgZGltcywgWG1sU2NoZW1hT2JqZWN0IHBhcmVudCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIG5zOw0KICAgICAgICAgICAgc3RyaW5nIG5hbWU7DQoNCiAgICAgICAgICAgIGludCBuc0xlbiA9IHR5cGUuTGFzdEluZGV4T2YoJzonKTsNCg0KICAgICAgICAgICAgaWYgKG5zTGVuIDw9IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbnMgPSAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBucyA9IHR5cGUuU3Vic3RyaW5nKDAsIG5zTGVuKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGludCBuYW1lTGVuID0gdHlwZS5JbmRleE9mKCdbJywgbnNMZW4gKyAxKTsNCg0KICAgICAgICAgICAgaWYgKG5hbWVMZW4gPD0gbnNMZW4pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbEludmFsaWRBcnJheVR5cGVTeW50YXgsIHR5cGUpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG5hbWUgPSB0eXBlLlN1YnN0cmluZyhuc0xlbiArIDEsIG5hbWVMZW4gLSBuc0xlbiAtIDEpOw0KICAgICAgICAgICAgZGltcyA9IHR5cGUuU3Vic3RyaW5nKG5hbWVMZW4pOw0KDQogICAgICAgICAgICAvLyBwYXJlbnQgaXMgbm90IG51bGwgb25seSBpbiB0aGUgY2FzZSB3aGVuIHdlIHVzZWQgWG1sU2NoZW1hLlJlYWQoKSwgDQogICAgICAgICAgICAvLyBpbiB3aGljaCBjYXNlIHdlIG5lZWQgdG8gZml4dXAgdGhlIHdzZGw6YXJheVR5cGUgYXR0cmlidXRlIHZhbHVlDQogICAgICAgICAgICB3aGlsZSAocGFyZW50ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5OYW1lc3BhY2VzICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgd3NkbE5zOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50Lk5hbWVzcGFjZXMuTmFtZXNwYWNlcy5UcnlHZXRWYWx1ZShucywgb3V0IHdzZGxOcykgJiYgd3NkbE5zICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5zID0gd3NkbE5zOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LlBhcmVudDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxRdWFsaWZpZWROYW1lKG5hbWUsIG5zKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIElDb2xsZWN0aW9uIFR5cGVzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfdHlwZURlc2NzLktleXM7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHZvaWQgQWRkVHlwZU1hcHBpbmcoVHlwZU1hcHBpbmcgdHlwZU1hcHBpbmcpDQogICAgICAgIHsNCiAgICAgICAgICAgIF90eXBlTWFwcGluZ3MuQWRkKHR5cGVNYXBwaW5nKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIElDb2xsZWN0aW9uIFR5cGVNYXBwaW5ncw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX3R5cGVNYXBwaW5nczsgfQ0KICAgICAgICB9DQogICAgICAgIGludGVybmFsIHN0YXRpYyBIYXNodGFibGUgUHJpbXRpdmVUeXBlcyB7IGdldCB7IHJldHVybiBzX3ByaW1pdGl2ZVR5cGVzOyB9IH0NCiAgICB9DQoNCiAgICBpbnRlcm5hbCBjbGFzcyBTb2FwDQogICAgew0KICAgICAgICBwcml2YXRlIFNvYXAoKSB7IH0NCiAgICAgICAgaW50ZXJuYWwgY29uc3Qgc3RyaW5nIEVuY29kaW5nID0gImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3NvYXAvZW5jb2RpbmcvIjsNCiAgICAgICAgaW50ZXJuYWwgY29uc3Qgc3RyaW5nIFVyVHlwZSA9ICJhbnlUeXBlIjsNCiAgICAgICAgaW50ZXJuYWwgY29uc3Qgc3RyaW5nIEFycmF5ID0gIkFycmF5IjsNCiAgICAgICAgaW50ZXJuYWwgY29uc3Qgc3RyaW5nIEFycmF5VHlwZSA9ICJhcnJheVR5cGUiOw0KICAgIH0NCg0KICAgIGludGVybmFsIGNsYXNzIFNvYXAxMg0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBTb2FwMTIoKSB7IH0NCiAgICAgICAgaW50ZXJuYWwgY29uc3Qgc3RyaW5nIEVuY29kaW5nID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDMvMDUvc29hcC1lbmNvZGluZyI7DQogICAgICAgIGludGVybmFsIGNvbnN0IHN0cmluZyBScGNOYW1lc3BhY2UgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMy8wNS9zb2FwLXJwYyI7DQogICAgICAgIGludGVybmFsIGNvbnN0IHN0cmluZyBScGNSZXN1bHQgPSAicmVzdWx0IjsNCiAgICB9DQoNCiAgICBpbnRlcm5hbCBjbGFzcyBXc2RsDQogICAgew0KICAgICAgICBwcml2YXRlIFdzZGwoKSB7IH0NCiAgICAgICAgaW50ZXJuYWwgY29uc3Qgc3RyaW5nIE5hbWVzcGFjZSA9ICJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93c2RsLyI7DQogICAgICAgIGludGVybmFsIGNvbnN0IHN0cmluZyBBcnJheVR5cGUgPSAiYXJyYXlUeXBlIjsNCiAgICB9DQoNCiAgICBpbnRlcm5hbCBjbGFzcyBVcnRUeXBlcw0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBVcnRUeXBlcygpIHsgfQ0KICAgICAgICBpbnRlcm5hbCBjb25zdCBzdHJpbmcgTmFtZXNwYWNlID0gImh0dHA6Ly9taWNyb3NvZnQuY29tL3dzZGwvdHlwZXMvIjsNCiAgICB9DQp9DQoNCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Serialization/XmlSerializer.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlNlcmlhbGl6YXRpb24NCnsNCiAgICB1c2luZyBTeXN0ZW0uUmVmbGVjdGlvbjsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnM7DQogICAgdXNpbmcgU3lzdGVtLklPOw0KICAgIHVzaW5nIFN5c3RlbS5YbWwuU2NoZW1hOw0KICAgIHVzaW5nIFN5c3RlbTsNCiAgICB1c2luZyBTeXN0ZW0uVGV4dDsNCiAgICB1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KICAgIHVzaW5nIFN5c3RlbS5HbG9iYWxpemF0aW9uOw0KICAgIHVzaW5nIFN5c3RlbS5TZWN1cml0eTsNCiAgICB1c2luZyBTeXN0ZW0uWG1sLlNlcmlhbGl6YXRpb24uQ29uZmlndXJhdGlvbjsNCiAgICB1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQogICAgdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQogICAgdXNpbmcgU3lzdGVtLlJ1bnRpbWUuVmVyc2lvbmluZzsNCiAgICB1c2luZyBTeXN0ZW0uWG1sOw0KICAgIHVzaW5nIFN5c3RlbS5YbWwuU2VyaWFsaXphdGlvbjsNCg0KICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbERlc2VyaWFsaXphdGlvbkV2ZW50cyJdLyonIC8+DQogICAgLy8vIDxkZXZkb2M+DQogICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgIC8vLyA8L2RldmRvYz4NCiAgICBwdWJsaWMgc3RydWN0IFhtbERlc2VyaWFsaXphdGlvbkV2ZW50cw0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBYbWxOb2RlRXZlbnRIYW5kbGVyIF9vblVua25vd25Ob2RlOw0KICAgICAgICBwcml2YXRlIFhtbEF0dHJpYnV0ZUV2ZW50SGFuZGxlciBfb25Vbmtub3duQXR0cmlidXRlOw0KICAgICAgICBwcml2YXRlIFhtbEVsZW1lbnRFdmVudEhhbmRsZXIgX29uVW5rbm93bkVsZW1lbnQ7DQogICAgICAgIHByaXZhdGUgVW5yZWZlcmVuY2VkT2JqZWN0RXZlbnRIYW5kbGVyIF9vblVucmVmZXJlbmNlZE9iamVjdDsNCiAgICAgICAgaW50ZXJuYWwgb2JqZWN0IHNlbmRlcjsNCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxEZXNlcmlhbGl6YXRpb25FdmVudHMuT25Vbmtub3duTm9kZSJdLyonIC8+DQogICAgICAgIHB1YmxpYyBYbWxOb2RlRXZlbnRIYW5kbGVyIE9uVW5rbm93bk5vZGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9vblVua25vd25Ob2RlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb25Vbmtub3duTm9kZSA9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sRGVzZXJpYWxpemF0aW9uRXZlbnRzLk9uVW5rbm93bkF0dHJpYnV0ZSJdLyonIC8+DQogICAgICAgIHB1YmxpYyBYbWxBdHRyaWJ1dGVFdmVudEhhbmRsZXIgT25Vbmtub3duQXR0cmlidXRlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfb25Vbmtub3duQXR0cmlidXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX29uVW5rbm93bkF0dHJpYnV0ZSA9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sRGVzZXJpYWxpemF0aW9uRXZlbnRzLk9uVW5rbm93bkVsZW1lbnQiXS8qJyAvPg0KICAgICAgICBwdWJsaWMgWG1sRWxlbWVudEV2ZW50SGFuZGxlciBPblVua25vd25FbGVtZW50DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfb25Vbmtub3duRWxlbWVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vblVua25vd25FbGVtZW50ID0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxEZXNlcmlhbGl6YXRpb25FdmVudHMuT25VbnJlZmVyZW5jZWRPYmplY3QiXS8qJyAvPg0KICAgICAgICBwdWJsaWMgVW5yZWZlcmVuY2VkT2JqZWN0RXZlbnRIYW5kbGVyIE9uVW5yZWZlcmVuY2VkT2JqZWN0DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfb25VbnJlZmVyZW5jZWRPYmplY3Q7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb25VbnJlZmVyZW5jZWRPYmplY3QgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXJJbXBsZW1lbnRhdGlvbiJdLyonIC8+DQogICAgLy8vPGludGVybmFsb25seS8+DQogICAgLy8vIDxkZXZkb2M+DQogICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgIC8vLyA8L2RldmRvYz4NCiAgICBwdWJsaWMgYWJzdHJhY3QgY2xhc3MgWG1sU2VyaWFsaXplckltcGxlbWVudGF0aW9uDQogICAgew0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVySW1wbGVtZW50YXRpb24uUmVhZGVyIl0vKicgLz4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sU2VyaWFsaXphdGlvblJlYWRlciBSZWFkZXIgeyBnZXQgeyB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7IH0gfQ0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVySW1wbGVtZW50YXRpb24uV3JpdGVyIl0vKicgLz4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sU2VyaWFsaXphdGlvbldyaXRlciBXcml0ZXIgeyBnZXQgeyB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7IH0gfQ0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVySW1wbGVtZW50YXRpb24uUmVhZE1ldGhvZHMiXS8qJyAvPg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBIYXNodGFibGUgUmVhZE1ldGhvZHMgeyBnZXQgeyB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7IH0gfQ0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVySW1wbGVtZW50YXRpb24uV3JpdGVNZXRob2RzIl0vKicgLz4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgSGFzaHRhYmxlIFdyaXRlTWV0aG9kcyB7IGdldCB7IHRocm93IG5ldyBOb3RTdXBwb3J0ZWRFeGNlcHRpb24oKTsgfSB9DQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXJJbXBsZW1lbnRhdGlvbi5UeXBlZFNlcmlhbGl6ZXJzIl0vKicgLz4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgSGFzaHRhYmxlIFR5cGVkU2VyaWFsaXplcnMgeyBnZXQgeyB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7IH0gfQ0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVySW1wbGVtZW50YXRpb24uQ2FuU2VyaWFsaXplIl0vKicgLz4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBDYW5TZXJpYWxpemUoVHlwZSB0eXBlKSB7IHRocm93IG5ldyBOb3RTdXBwb3J0ZWRFeGNlcHRpb24oKTsgfQ0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVySW1wbGVtZW50YXRpb24uR2V0U2VyaWFsaXplciJdLyonIC8+DQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhtbFNlcmlhbGl6ZXIgR2V0U2VyaWFsaXplcihUeXBlIHR5cGUpIHsgdGhyb3cgbmV3IE5vdFN1cHBvcnRlZEV4Y2VwdGlvbigpOyB9DQogICAgfQ0KDQogICAgLy8gVGhpcyBlbnVtIGlzIGludGVudGlvbmFsbHkga2VwdCBvdXRzaWRlIG9mIHRoZSBYbWxTZXJpYWxpemVyIGNsYXNzIHNpbmNlIGlmIGl0IHdvdWxkIGJlIGEgc3ViY2xhc3MNCiAgICAvLyBvZiBYbWxTZXJpYWxpemVyLCB0aGVuIGFueSBhY2Nlc3MgdG8gdGhpcyBlbnVtIHdvdWxkIGJlIHRyZWF0ZWQgYnkgQU9UIGNvbXBpbGVycyBhcyBhY2Nlc3MgdG8gdGhlIFhtbFNlcmlhbGl6ZXINCiAgICAvLyBhcyB3ZWxsLCB3aGljaCBoYXMgYSBsYXJnZSBzdGF0aWMgY3RvciB3aGljaCBicmluZ3MgaW4gYSBsb3Qgb2YgY29kZS4gU28ga2VlcGluZyB0aGUgZW51bSBzZXBhcmF0ZQ0KICAgIC8vIG1ha2VzIHN1cmUgdGhhdCB1c2luZyBqdXN0IHRoZSBlbnVtIGl0c2VsZiBkb2Vzbid0IGJyaW5nIGluIHRoZSB3aG9sZSBvZiBzZXJpYWxpemF0aW9uIGNvZGUgYmFzZS4NCiNpZiBGRUFUVVJFX1NFUklBTElaQVRJT05fVUFQQU9UDQogICAgcHVibGljIGVudW0gU2VyaWFsaXphdGlvbk1vZGUNCiNlbHNlDQogICAgaW50ZXJuYWwgZW51bSBTZXJpYWxpemF0aW9uTW9kZQ0KI2VuZGlmDQogICAgew0KICAgICAgICBDb2RlR2VuT25seSwNCiAgICAgICAgUmVmbGVjdGlvbk9ubHksDQogICAgICAgIFJlZmxlY3Rpb25Bc0JhY2t1cCwNCiAgICAgICAgUHJlR2VuT25seQ0KICAgIH0NCg0KICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIiXS8qJyAvPg0KICAgIC8vLyA8ZGV2ZG9jPg0KICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAvLy8gPC9kZXZkb2M+DQogICAgcHVibGljIGNsYXNzIFhtbFNlcmlhbGl6ZXINCiAgICB7DQojaWYgRkVBVFVSRV9TRVJJQUxJWkFUSU9OX1VBUEFPVA0KICAgICAgICBwdWJsaWMgc3RhdGljIFNlcmlhbGl6YXRpb25Nb2RlIE1vZGUgeyBnZXQ7IHNldDsgfSA9IFNlcmlhbGl6YXRpb25Nb2RlLlJlZmxlY3Rpb25Bc0JhY2t1cDsNCiNlbHNlDQogICAgICAgIGludGVybmFsIHN0YXRpYyBTZXJpYWxpemF0aW9uTW9kZSBNb2RlIHsgZ2V0OyBzZXQ7IH0gPSBTZXJpYWxpemF0aW9uTW9kZS5SZWZsZWN0aW9uQXNCYWNrdXA7DQojZW5kaWYNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBib29sIFJlZmxlY3Rpb25NZXRob2RFbmFibGVkDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlID09IFNlcmlhbGl6YXRpb25Nb2RlLlJlZmxlY3Rpb25Pbmx5IHx8IE1vZGUgPT0gU2VyaWFsaXphdGlvbk1vZGUuUmVmbGVjdGlvbkFzQmFja3VwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBUZW1wQXNzZW1ibHkgX3RlbXBBc3NlbWJseTsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA0MTQNCiAgICAgICAgcHJpdmF0ZSBib29sIF90eXBlZFNlcmlhbGl6ZXI7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNDE0DQogICAgICAgIHByaXZhdGUgVHlwZSBfcHJpbWl0aXZlVHlwZTsNCiAgICAgICAgcHJpdmF0ZSBYbWxNYXBwaW5nIF9tYXBwaW5nOw0KICAgICAgICBwcml2YXRlIFhtbERlc2VyaWFsaXphdGlvbkV2ZW50cyBfZXZlbnRzID0gbmV3IFhtbERlc2VyaWFsaXphdGlvbkV2ZW50cygpOw0KI2lmIEZFQVRVUkVfU0VSSUFMSVpBVElPTl9VQVBBT1QNCiAgICAgICAgcHJpdmF0ZSBYbWxTZXJpYWxpemVyIGlubmVyU2VyaWFsaXplcjsNCiAgICAgICAgcHVibGljIHN0cmluZyBEZWZhdWx0TmFtZXNwYWNlID0gbnVsbDsNCiNlbHNlDQogICAgICAgIGludGVybmFsIHN0cmluZyBEZWZhdWx0TmFtZXNwYWNlID0gbnVsbDsNCiNlbmRpZg0KICAgICAgICBwcml2YXRlIFR5cGUgX3Jvb3RUeXBlOw0KICAgICAgICBwcml2YXRlIGJvb2wgX2lzUmVmbGVjdGlvbkJhc2VkU2VyaWFsaXplciA9IGZhbHNlOw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIFRlbXBBc3NlbWJseUNhY2hlIHNfY2FjaGUgPSBuZXcgVGVtcEFzc2VtYmx5Q2FjaGUoKTsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgWG1sU2VyaWFsaXplck5hbWVzcGFjZXMgc19kZWZhdWx0TmFtZXNwYWNlczsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgWG1sU2VyaWFsaXplck5hbWVzcGFjZXMgRGVmYXVsdE5hbWVzcGFjZXMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHNfZGVmYXVsdE5hbWVzcGFjZXMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzIG5zcyA9IG5ldyBYbWxTZXJpYWxpemVyTmFtZXNwYWNlcygpOw0KICAgICAgICAgICAgICAgICAgICBuc3MuQWRkSW50ZXJuYWwoInhzaSIsIFhtbFNjaGVtYS5JbnN0YW5jZU5hbWVzcGFjZSk7DQogICAgICAgICAgICAgICAgICAgIG5zcy5BZGRJbnRlcm5hbCgieHNkIiwgWG1sU2NoZW1hLk5hbWVzcGFjZSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChzX2RlZmF1bHROYW1lc3BhY2VzID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNfZGVmYXVsdE5hbWVzcGFjZXMgPSBuc3M7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHNfZGVmYXVsdE5hbWVzcGFjZXM7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBEaWN0aW9uYXJ5PFR5cGUsIERpY3Rpb25hcnk8WG1sU2VyaWFsaXplck1hcHBpbmdLZXksIFhtbFNlcmlhbGl6ZXI+PiBzX3htbFNlcmlhbGl6ZXJUYWJsZSA9IG5ldyBEaWN0aW9uYXJ5PFR5cGUsIERpY3Rpb25hcnk8WG1sU2VyaWFsaXplck1hcHBpbmdLZXksIFhtbFNlcmlhbGl6ZXI+PigpOw0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuWG1sU2VyaWFsaXplcjgiXS8qJyAvPg0KICAgICAgICAvLy88aW50ZXJuYWxvbmx5Lz4NCiAgICAgICAgcHJvdGVjdGVkIFhtbFNlcmlhbGl6ZXIoKQ0KICAgICAgICB7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLlhtbFNlcmlhbGl6ZXIiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTZXJpYWxpemVyKFR5cGUgdHlwZSwgWG1sQXR0cmlidXRlT3ZlcnJpZGVzIG92ZXJyaWRlcywgVHlwZVtdIGV4dHJhVHlwZXMsIFhtbFJvb3RBdHRyaWJ1dGUgcm9vdCwgc3RyaW5nIGRlZmF1bHROYW1lc3BhY2UpIDoNCiAgICAgICAgICAgIHRoaXModHlwZSwgb3ZlcnJpZGVzLCBleHRyYVR5cGVzLCByb290LCBkZWZhdWx0TmFtZXNwYWNlLCBudWxsKQ0KICAgICAgICB7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLlhtbFNlcmlhbGl6ZXIyIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgWG1sU2VyaWFsaXplcihUeXBlIHR5cGUsIFhtbFJvb3RBdHRyaWJ1dGUgcm9vdCkgOiB0aGlzKHR5cGUsIG51bGwsIEFycmF5LkVtcHR5PFR5cGU+KCksIHJvb3QsIG51bGwsIG51bGwpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuWG1sU2VyaWFsaXplcjMiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTZXJpYWxpemVyKFR5cGUgdHlwZSwgVHlwZVtdIGV4dHJhVHlwZXMpIDogdGhpcyh0eXBlLCBudWxsLCBleHRyYVR5cGVzLCBudWxsLCBudWxsLCBudWxsKQ0KICAgICAgICB7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLlhtbFNlcmlhbGl6ZXI0Il0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgWG1sU2VyaWFsaXplcihUeXBlIHR5cGUsIFhtbEF0dHJpYnV0ZU92ZXJyaWRlcyBvdmVycmlkZXMpIDogdGhpcyh0eXBlLCBvdmVycmlkZXMsIEFycmF5LkVtcHR5PFR5cGU+KCksIG51bGwsIG51bGwsIG51bGwpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuWG1sU2VyaWFsaXplcjUiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTZXJpYWxpemVyKFhtbFR5cGVNYXBwaW5nIHhtbFR5cGVNYXBwaW5nKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoeG1sVHlwZU1hcHBpbmcgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZih4bWxUeXBlTWFwcGluZykpOw0KDQojaWYgIUZFQVRVUkVfU0VSSUFMSVpBVElPTl9VQVBBT1QNCiAgICAgICAgICAgIF90ZW1wQXNzZW1ibHkgPSBHZW5lcmF0ZVRlbXBBc3NlbWJseSh4bWxUeXBlTWFwcGluZyk7DQojZW5kaWYNCiAgICAgICAgICAgIF9tYXBwaW5nID0geG1sVHlwZU1hcHBpbmc7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLlhtbFNlcmlhbGl6ZXI2Il0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgWG1sU2VyaWFsaXplcihUeXBlIHR5cGUpIDogdGhpcyh0eXBlLCAoc3RyaW5nKW51bGwpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuWG1sU2VyaWFsaXplcjEiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTZXJpYWxpemVyKFR5cGUgdHlwZSwgc3RyaW5nIGRlZmF1bHROYW1lc3BhY2UpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh0eXBlID09IG51bGwpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2YodHlwZSkpOw0KDQogICAgICAgICAgICBEZWZhdWx0TmFtZXNwYWNlID0gZGVmYXVsdE5hbWVzcGFjZTsNCiAgICAgICAgICAgIF9yb290VHlwZSA9IHR5cGU7DQoNCiAgICAgICAgICAgIF9tYXBwaW5nID0gR2V0S25vd25NYXBwaW5nKHR5cGUsIGRlZmF1bHROYW1lc3BhY2UpOw0KICAgICAgICAgICAgaWYgKF9tYXBwaW5nICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3ByaW1pdGl2ZVR5cGUgPSB0eXBlOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiNpZiAhRkVBVFVSRV9TRVJJQUxJWkFUSU9OX1VBUEFPVA0KICAgICAgICAgICAgX3RlbXBBc3NlbWJseSA9IHNfY2FjaGVbZGVmYXVsdE5hbWVzcGFjZSwgdHlwZV07DQogICAgICAgICAgICBpZiAoX3RlbXBBc3NlbWJseSA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxvY2sgKHNfY2FjaGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfdGVtcEFzc2VtYmx5ID0gc19jYWNoZVtkZWZhdWx0TmFtZXNwYWNlLCB0eXBlXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKF90ZW1wQXNzZW1ibHkgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNlcmlhbGl6ZXJJbXBsZW1lbnRhdGlvbiBjb250cmFjdCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZW1ibHkgYXNzZW1ibHkgPSBUZW1wQXNzZW1ibHkuTG9hZEdlbmVyYXRlZEFzc2VtYmx5KHR5cGUsIGRlZmF1bHROYW1lc3BhY2UsIG91dCBjb250cmFjdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2VtYmx5ID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTW9kZSA9PSBTZXJpYWxpemF0aW9uTW9kZS5QcmVHZW5Pbmx5KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBc3NlbWJseU5hbWUgbmFtZSA9IHR5cGUuQXNzZW1ibHkuR2V0TmFtZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZXJOYW1lID0gQ29tcGlsZXIuR2V0VGVtcEFzc2VtYmx5TmFtZShuYW1lLCBkZWZhdWx0TmFtZXNwYWNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGaWxlTG9hZEV4Y2VwdGlvbihTUi5Gb3JtYXQoU1IuRmFpbExvYWRBc3NlbWJseVVuZGVyUHJlZ2VuTW9kZSwgc2VyaWFsaXplck5hbWUpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gcmVmbGVjdCBhbmQgZ2VuZXJhdGUgbmV3IHNlcmlhbGl6YXRpb24gYXNzZW1ibHkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sUmVmbGVjdGlvbkltcG9ydGVyIGltcG9ydGVyID0gbmV3IFhtbFJlZmxlY3Rpb25JbXBvcnRlcihkZWZhdWx0TmFtZXNwYWNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX21hcHBpbmcgPSBpbXBvcnRlci5JbXBvcnRUeXBlTWFwcGluZyh0eXBlLCBudWxsLCBkZWZhdWx0TmFtZXNwYWNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RlbXBBc3NlbWJseSA9IEdlbmVyYXRlVGVtcEFzc2VtYmx5KF9tYXBwaW5nLCB0eXBlLCBkZWZhdWx0TmFtZXNwYWNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgZm91bmQgdGhlIHByZS1nZW5lcmF0ZWQgYXNzZW1ibHksIG5vdyBtYWtlIHN1cmUgdGhhdCB0aGUgYXNzZW1ibHkgaGFzIHRoZSByaWdodCBzZXJpYWxpemVyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyeSB0byBhdm9pZCB0aGUgcmVmbGVjdGlvbiBzdGVwLCBuZWVkIHRvIGdldCBFbGVtZW50TmFtZSwgbmFtZXNwYWNlIGFuZCB0aGUgS2V5IGZvcm0gdGhlIHR5cGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX21hcHBpbmcgPSBYbWxSZWZsZWN0aW9uSW1wb3J0ZXIuR2V0VG9wTGV2ZWxNYXBwaW5nKHR5cGUsIGRlZmF1bHROYW1lc3BhY2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGVtcEFzc2VtYmx5ID0gbmV3IFRlbXBBc3NlbWJseShuZXcgWG1sTWFwcGluZ1tdIHsgX21hcHBpbmcgfSwgYXNzZW1ibHksIGNvbnRyYWN0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgc19jYWNoZS5BZGQoZGVmYXVsdE5hbWVzcGFjZSwgdHlwZSwgX3RlbXBBc3NlbWJseSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKF9tYXBwaW5nID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX21hcHBpbmcgPSBYbWxSZWZsZWN0aW9uSW1wb3J0ZXIuR2V0VG9wTGV2ZWxNYXBwaW5nKHR5cGUsIGRlZmF1bHROYW1lc3BhY2UpOw0KICAgICAgICAgICAgfQ0KI2Vsc2UNCiAgICAgICAgICAgIFhtbFNlcmlhbGl6ZXJJbXBsZW1lbnRhdGlvbiBjb250cmFjdCA9IEdldFhtbFNlcmlhbGl6ZXJDb250cmFjdEZyb21HZW5lcmF0ZWRBc3NlbWJseSgpOw0KDQogICAgICAgICAgICBpZiAoY29udHJhY3QgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aGlzLmlubmVyU2VyaWFsaXplciA9IGNvbnRyYWN0LkdldFNlcmlhbGl6ZXIodHlwZSk7DQogICAgICAgICAgICB9DQojZW5kaWYNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuWG1sU2VyaWFsaXplcjciXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTZXJpYWxpemVyKFR5cGUgdHlwZSwgWG1sQXR0cmlidXRlT3ZlcnJpZGVzIG92ZXJyaWRlcywgVHlwZVtdIGV4dHJhVHlwZXMsIFhtbFJvb3RBdHRyaWJ1dGUgcm9vdCwgc3RyaW5nIGRlZmF1bHROYW1lc3BhY2UsIHN0cmluZyBsb2NhdGlvbikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZih0eXBlKSk7DQoNCiAgICAgICAgICAgIERlZmF1bHROYW1lc3BhY2UgPSBkZWZhdWx0TmFtZXNwYWNlOw0KICAgICAgICAgICAgX3Jvb3RUeXBlID0gdHlwZTsNCiAgICAgICAgICAgIF9tYXBwaW5nID0gR2VuZXJhdGVYbWxUeXBlTWFwcGluZyh0eXBlLCBvdmVycmlkZXMsIGV4dHJhVHlwZXMsIHJvb3QsIGRlZmF1bHROYW1lc3BhY2UpOw0KI2lmICFGRUFUVVJFX1NFUklBTElaQVRJT05fVUFQQU9UDQogICAgICAgICAgICBfdGVtcEFzc2VtYmx5ID0gR2VuZXJhdGVUZW1wQXNzZW1ibHkoX21hcHBpbmcsIHR5cGUsIGRlZmF1bHROYW1lc3BhY2UsIGxvY2F0aW9uKTsNCiNlbmRpZg0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxUeXBlTWFwcGluZyBHZW5lcmF0ZVhtbFR5cGVNYXBwaW5nKFR5cGUgdHlwZSwgWG1sQXR0cmlidXRlT3ZlcnJpZGVzIG92ZXJyaWRlcywgVHlwZVtdIGV4dHJhVHlwZXMsIFhtbFJvb3RBdHRyaWJ1dGUgcm9vdCwgc3RyaW5nIGRlZmF1bHROYW1lc3BhY2UpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFJlZmxlY3Rpb25JbXBvcnRlciBpbXBvcnRlciA9IG5ldyBYbWxSZWZsZWN0aW9uSW1wb3J0ZXIob3ZlcnJpZGVzLCBkZWZhdWx0TmFtZXNwYWNlKTsNCiAgICAgICAgICAgIGlmIChleHRyYVR5cGVzICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBleHRyYVR5cGVzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgICAgICBpbXBvcnRlci5JbmNsdWRlVHlwZShleHRyYVR5cGVzW2ldKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGltcG9ydGVyLkltcG9ydFR5cGVNYXBwaW5nKHR5cGUsIHJvb3QsIGRlZmF1bHROYW1lc3BhY2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgc3RhdGljIFRlbXBBc3NlbWJseSBHZW5lcmF0ZVRlbXBBc3NlbWJseShYbWxNYXBwaW5nIHhtbE1hcHBpbmcpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBHZW5lcmF0ZVRlbXBBc3NlbWJseSh4bWxNYXBwaW5nLCBudWxsLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyBUZW1wQXNzZW1ibHkgR2VuZXJhdGVUZW1wQXNzZW1ibHkoWG1sTWFwcGluZyB4bWxNYXBwaW5nLCBUeXBlIHR5cGUsIHN0cmluZyBkZWZhdWx0TmFtZXNwYWNlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gR2VuZXJhdGVUZW1wQXNzZW1ibHkoeG1sTWFwcGluZywgdHlwZSwgZGVmYXVsdE5hbWVzcGFjZSwgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgVGVtcEFzc2VtYmx5IEdlbmVyYXRlVGVtcEFzc2VtYmx5KFhtbE1hcHBpbmcgeG1sTWFwcGluZywgVHlwZSB0eXBlLCBzdHJpbmcgZGVmYXVsdE5hbWVzcGFjZSwgc3RyaW5nIGxvY2F0aW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoeG1sTWFwcGluZyA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24obmFtZW9mKHhtbE1hcHBpbmcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgeG1sTWFwcGluZy5DaGVja1NoYWxsb3coKTsNCiAgICAgICAgICAgIGlmICh4bWxNYXBwaW5nLklzU29hcCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIG5ldyBUZW1wQXNzZW1ibHkobmV3IFhtbE1hcHBpbmdbXSB7IHhtbE1hcHBpbmcgfSwgbmV3IFR5cGVbXSB7IHR5cGUgfSwgZGVmYXVsdE5hbWVzcGFjZSwgbG9jYXRpb24pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5TZXJpYWxpemUiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyB2b2lkIFNlcmlhbGl6ZShUZXh0V3JpdGVyIHRleHRXcml0ZXIsIG9iamVjdCBvKQ0KICAgICAgICB7DQogICAgICAgICAgICBTZXJpYWxpemUodGV4dFdyaXRlciwgbywgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLlNlcmlhbGl6ZTEiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyB2b2lkIFNlcmlhbGl6ZShUZXh0V3JpdGVyIHRleHRXcml0ZXIsIG9iamVjdCBvLCBYbWxTZXJpYWxpemVyTmFtZXNwYWNlcyBuYW1lc3BhY2VzKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxUZXh0V3JpdGVyIHhtbFdyaXRlciA9IG5ldyBYbWxUZXh0V3JpdGVyKHRleHRXcml0ZXIpOw0KICAgICAgICAgICAgeG1sV3JpdGVyLkZvcm1hdHRpbmcgPSBGb3JtYXR0aW5nLkluZGVudGVkOw0KICAgICAgICAgICAgeG1sV3JpdGVyLkluZGVudGF0aW9uID0gMjsNCiAgICAgICAgICAgIFNlcmlhbGl6ZSh4bWxXcml0ZXIsIG8sIG5hbWVzcGFjZXMpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5TZXJpYWxpemUyIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgdm9pZCBTZXJpYWxpemUoU3RyZWFtIHN0cmVhbSwgb2JqZWN0IG8pDQogICAgICAgIHsNCiAgICAgICAgICAgIFNlcmlhbGl6ZShzdHJlYW0sIG8sIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5TZXJpYWxpemUzIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgdm9pZCBTZXJpYWxpemUoU3RyZWFtIHN0cmVhbSwgb2JqZWN0IG8sIFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzIG5hbWVzcGFjZXMpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFRleHRXcml0ZXIgeG1sV3JpdGVyID0gbmV3IFhtbFRleHRXcml0ZXIoc3RyZWFtLCBudWxsKTsNCiAgICAgICAgICAgIHhtbFdyaXRlci5Gb3JtYXR0aW5nID0gRm9ybWF0dGluZy5JbmRlbnRlZDsNCiAgICAgICAgICAgIHhtbFdyaXRlci5JbmRlbnRhdGlvbiA9IDI7DQogICAgICAgICAgICBTZXJpYWxpemUoeG1sV3JpdGVyLCBvLCBuYW1lc3BhY2VzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuU2VyaWFsaXplNCJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZvaWQgU2VyaWFsaXplKFhtbFdyaXRlciB4bWxXcml0ZXIsIG9iamVjdCBvKQ0KICAgICAgICB7DQogICAgICAgICAgICBTZXJpYWxpemUoeG1sV3JpdGVyLCBvLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuU2VyaWFsaXplNSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZvaWQgU2VyaWFsaXplKFhtbFdyaXRlciB4bWxXcml0ZXIsIG9iamVjdCBvLCBYbWxTZXJpYWxpemVyTmFtZXNwYWNlcyBuYW1lc3BhY2VzKQ0KICAgICAgICB7DQogICAgICAgICAgICBTZXJpYWxpemUoeG1sV3JpdGVyLCBvLCBuYW1lc3BhY2VzLCBudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLlNlcmlhbGl6ZTYiXS8qJyAvPg0KICAgICAgICBwdWJsaWMgdm9pZCBTZXJpYWxpemUoWG1sV3JpdGVyIHhtbFdyaXRlciwgb2JqZWN0IG8sIFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzIG5hbWVzcGFjZXMsIHN0cmluZyBlbmNvZGluZ1N0eWxlKQ0KICAgICAgICB7DQogICAgICAgICAgICBTZXJpYWxpemUoeG1sV3JpdGVyLCBvLCBuYW1lc3BhY2VzLCBlbmNvZGluZ1N0eWxlLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuU2VyaWFsaXplNiJdLyonIC8+DQogICAgICAgIHB1YmxpYyB2b2lkIFNlcmlhbGl6ZShYbWxXcml0ZXIgeG1sV3JpdGVyLCBvYmplY3QgbywgWG1sU2VyaWFsaXplck5hbWVzcGFjZXMgbmFtZXNwYWNlcywgc3RyaW5nIGVuY29kaW5nU3R5bGUsIHN0cmluZyBpZCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF9wcmltaXRpdmVUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoZW5jb2RpbmdTdHlsZSAhPSBudWxsICYmIGVuY29kaW5nU3R5bGUuTGVuZ3RoID4gMCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbEludmFsaWRFbmNvZGluZ05vdEVuY29kZWQxLCBlbmNvZGluZ1N0eWxlKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgU2VyaWFsaXplUHJpbWl0aXZlKHhtbFdyaXRlciwgbywgbmFtZXNwYWNlcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKFNob3VsZFVzZVJlZmxlY3Rpb25CYXNlZFNlcmlhbGl6YXRpb24oX21hcHBpbmcpIHx8IF9pc1JlZmxlY3Rpb25CYXNlZFNlcmlhbGl6ZXIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZXJpYWxpemVVc2luZ1JlZmxlY3Rpb24oeG1sV3JpdGVyLCBvLCBuYW1lc3BhY2VzLCBlbmNvZGluZ1N0eWxlLCBpZCk7DQogICAgICAgICAgICAgICAgfQ0KI2lmICFGRUFUVVJFX1NFUklBTElaQVRJT05fVUFQQU9UDQogICAgICAgICAgICAgICAgZWxzZSBpZiAoX3RlbXBBc3NlbWJseSA9PSBudWxsIHx8IF90eXBlZFNlcmlhbGl6ZXIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBUaGUgY29udGlvbiBmb3IgdGhlIGJsb2NrIGlzIG5ldmVyIHRydWUsIHRodXMgdGhlIGJsb2NrIGlzIG5ldmVyIGhpdC4NCiAgICAgICAgICAgICAgICAgICAgWG1sU2VyaWFsaXphdGlvbldyaXRlciB3cml0ZXIgPSBDcmVhdGVXcml0ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLkluaXQoeG1sV3JpdGVyLCBuYW1lc3BhY2VzID09IG51bGwgfHwgbmFtZXNwYWNlcy5Db3VudCA9PSAwID8gRGVmYXVsdE5hbWVzcGFjZXMgOiBuYW1lc3BhY2VzLCBlbmNvZGluZ1N0eWxlLCBpZCwgX3RlbXBBc3NlbWJseSk7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZXJpYWxpemUobywgd3JpdGVyKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICBfdGVtcEFzc2VtYmx5Lkludm9rZVdyaXRlcihfbWFwcGluZywgeG1sV3JpdGVyLCBvLCBuYW1lc3BhY2VzID09IG51bGwgfHwgbmFtZXNwYWNlcy5Db3VudCA9PSAwID8gRGVmYXVsdE5hbWVzcGFjZXMgOiBuYW1lc3BhY2VzLCBlbmNvZGluZ1N0eWxlLCBpZCk7DQojZWxzZQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlubmVyU2VyaWFsaXplciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPckVtcHR5KHRoaXMuRGVmYXVsdE5hbWVzcGFjZSkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbm5lclNlcmlhbGl6ZXIuRGVmYXVsdE5hbWVzcGFjZSA9IHRoaXMuRGVmYXVsdE5hbWVzcGFjZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgWG1sU2VyaWFsaXphdGlvbldyaXRlciB3cml0ZXIgPSB0aGlzLmlubmVyU2VyaWFsaXplci5DcmVhdGVXcml0ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5Jbml0KHhtbFdyaXRlciwgbmFtZXNwYWNlcyA9PSBudWxsIHx8IG5hbWVzcGFjZXMuQ291bnQgPT0gMCA/IERlZmF1bHROYW1lc3BhY2VzIDogbmFtZXNwYWNlcywgZW5jb2RpbmdTdHlsZSwgaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbm5lclNlcmlhbGl6ZXIuU2VyaWFsaXplKG8sIHdyaXRlcik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChSZWZsZWN0aW9uTWV0aG9kRW5hYmxlZCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VyaWFsaXplVXNpbmdSZWZsZWN0aW9uKHhtbFdyaXRlciwgbywgbmFtZXNwYWNlcywgZW5jb2RpbmdTdHlsZSwgaWQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbF9NaXNzaW5nU2VyaWFsaXphdGlvbkNvZGVFeGNlcHRpb24sIHRoaXMuX3Jvb3RUeXBlLCB0eXBlb2YoWG1sU2VyaWFsaXplcikuTmFtZSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KI2VuZGlmDQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGUgaXMgVGFyZ2V0SW52b2NhdGlvbkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICAgICAgZSA9IGUuSW5uZXJFeGNlcHRpb247DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWG1sR2VuRXJyb3IsIGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgeG1sV3JpdGVyLkZsdXNoKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgU2VyaWFsaXplVXNpbmdSZWZsZWN0aW9uKFhtbFdyaXRlciB4bWxXcml0ZXIsIG9iamVjdCBvLCBYbWxTZXJpYWxpemVyTmFtZXNwYWNlcyBuYW1lc3BhY2VzLCBzdHJpbmcgZW5jb2RpbmdTdHlsZSwgc3RyaW5nIGlkKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxNYXBwaW5nIG1hcHBpbmcgPSBHZXRNYXBwaW5nKCk7DQogICAgICAgICAgICB2YXIgd3JpdGVyID0gbmV3IFJlZmxlY3Rpb25YbWxTZXJpYWxpemF0aW9uV3JpdGVyKG1hcHBpbmcsIHhtbFdyaXRlciwgbmFtZXNwYWNlcyA9PSBudWxsIHx8IG5hbWVzcGFjZXMuQ291bnQgPT0gMCA/IERlZmF1bHROYW1lc3BhY2VzIDogbmFtZXNwYWNlcywgZW5jb2RpbmdTdHlsZSwgaWQpOw0KICAgICAgICAgICAgd3JpdGVyLldyaXRlT2JqZWN0KG8pOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxNYXBwaW5nIEdldE1hcHBpbmcoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX21hcHBpbmcgPT0gbnVsbCB8fCAhX21hcHBpbmcuR2VuZXJhdGVTZXJpYWxpemVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9tYXBwaW5nID0gR2VuZXJhdGVYbWxUeXBlTWFwcGluZyhfcm9vdFR5cGUsIG51bGwsIG51bGwsIG51bGwsIERlZmF1bHROYW1lc3BhY2UpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gX21hcHBpbmc7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLkRlc2VyaWFsaXplIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgb2JqZWN0IERlc2VyaWFsaXplKFN0cmVhbSBzdHJlYW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgeG1sUmVhZGVyID0gbmV3IFhtbFRleHRSZWFkZXIoc3RyZWFtKTsNCiAgICAgICAgICAgIHhtbFJlYWRlci5XaGl0ZXNwYWNlSGFuZGxpbmcgPSBXaGl0ZXNwYWNlSGFuZGxpbmcuU2lnbmlmaWNhbnQ7DQogICAgICAgICAgICB4bWxSZWFkZXIuTm9ybWFsaXphdGlvbiA9IHRydWU7DQogICAgICAgICAgICB4bWxSZWFkZXIuWG1sUmVzb2x2ZXIgPSBudWxsOw0KICAgICAgICAgICAgcmV0dXJuIERlc2VyaWFsaXplKHhtbFJlYWRlciwgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLkRlc2VyaWFsaXplMSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIG9iamVjdCBEZXNlcmlhbGl6ZShUZXh0UmVhZGVyIHRleHRSZWFkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgeG1sUmVhZGVyID0gbmV3IFhtbFRleHRSZWFkZXIodGV4dFJlYWRlcik7DQogICAgICAgICAgICB4bWxSZWFkZXIuV2hpdGVzcGFjZUhhbmRsaW5nID0gV2hpdGVzcGFjZUhhbmRsaW5nLlNpZ25pZmljYW50Ow0KICAgICAgICAgICAgeG1sUmVhZGVyLk5vcm1hbGl6YXRpb24gPSB0cnVlOw0KICAgICAgICAgICAgeG1sUmVhZGVyLlhtbFJlc29sdmVyID0gbnVsbDsNCiAgICAgICAgICAgIHJldHVybiBEZXNlcmlhbGl6ZSh4bWxSZWFkZXIsIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5EZXNlcmlhbGl6ZTIiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBvYmplY3QgRGVzZXJpYWxpemUoWG1sUmVhZGVyIHhtbFJlYWRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIERlc2VyaWFsaXplKHhtbFJlYWRlciwgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLkRlc2VyaWFsaXplMyJdLyonIC8+DQogICAgICAgIHB1YmxpYyBvYmplY3QgRGVzZXJpYWxpemUoWG1sUmVhZGVyIHhtbFJlYWRlciwgWG1sRGVzZXJpYWxpemF0aW9uRXZlbnRzIGV2ZW50cykNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIERlc2VyaWFsaXplKHhtbFJlYWRlciwgbnVsbCwgZXZlbnRzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuRGVzZXJpYWxpemU0Il0vKicgLz4NCiAgICAgICAgcHVibGljIG9iamVjdCBEZXNlcmlhbGl6ZShYbWxSZWFkZXIgeG1sUmVhZGVyLCBzdHJpbmcgZW5jb2RpbmdTdHlsZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIERlc2VyaWFsaXplKHhtbFJlYWRlciwgZW5jb2RpbmdTdHlsZSwgX2V2ZW50cyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLkRlc2VyaWFsaXplNSJdLyonIC8+DQogICAgICAgIHB1YmxpYyBvYmplY3QgRGVzZXJpYWxpemUoWG1sUmVhZGVyIHhtbFJlYWRlciwgc3RyaW5nIGVuY29kaW5nU3R5bGUsIFhtbERlc2VyaWFsaXphdGlvbkV2ZW50cyBldmVudHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGV2ZW50cy5zZW5kZXIgPSB0aGlzOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF9wcmltaXRpdmVUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoZW5jb2RpbmdTdHlsZSAhPSBudWxsICYmIGVuY29kaW5nU3R5bGUuTGVuZ3RoID4gMCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbEludmFsaWRFbmNvZGluZ05vdEVuY29kZWQxLCBlbmNvZGluZ1N0eWxlKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERlc2VyaWFsaXplUHJpbWl0aXZlKHhtbFJlYWRlciwgZXZlbnRzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoU2hvdWxkVXNlUmVmbGVjdGlvbkJhc2VkU2VyaWFsaXphdGlvbihfbWFwcGluZykgfHwgX2lzUmVmbGVjdGlvbkJhc2VkU2VyaWFsaXplcikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBEZXNlcmlhbGl6ZVVzaW5nUmVmbGVjdGlvbih4bWxSZWFkZXIsIGVuY29kaW5nU3R5bGUsIGV2ZW50cyk7DQogICAgICAgICAgICAgICAgfQ0KI2lmICFGRUFUVVJFX1NFUklBTElaQVRJT05fVUFQQU9UDQogICAgICAgICAgICAgICAgZWxzZSBpZiAoX3RlbXBBc3NlbWJseSA9PSBudWxsIHx8IF90eXBlZFNlcmlhbGl6ZXIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBYbWxTZXJpYWxpemF0aW9uUmVhZGVyIHJlYWRlciA9IENyZWF0ZVJlYWRlcigpOw0KICAgICAgICAgICAgICAgICAgICByZWFkZXIuSW5pdCh4bWxSZWFkZXIsIGV2ZW50cywgZW5jb2RpbmdTdHlsZSwgX3RlbXBBc3NlbWJseSk7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRGVzZXJpYWxpemUocmVhZGVyKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90ZW1wQXNzZW1ibHkuSW52b2tlUmVhZGVyKF9tYXBwaW5nLCB4bWxSZWFkZXIsIGV2ZW50cywgZW5jb2RpbmdTdHlsZSk7DQogICAgICAgICAgICAgICAgfQ0KI2Vsc2UNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbm5lclNlcmlhbGl6ZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eSh0aGlzLkRlZmF1bHROYW1lc3BhY2UpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5uZXJTZXJpYWxpemVyLkRlZmF1bHROYW1lc3BhY2UgPSB0aGlzLkRlZmF1bHROYW1lc3BhY2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNlcmlhbGl6YXRpb25SZWFkZXIgcmVhZGVyID0gdGhpcy5pbm5lclNlcmlhbGl6ZXIuQ3JlYXRlUmVhZGVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuSW5pdCh4bWxSZWFkZXIsIGV2ZW50cywgZW5jb2RpbmdTdHlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbm5lclNlcmlhbGl6ZXIuRGVzZXJpYWxpemUocmVhZGVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFJlZmxlY3Rpb25NZXRob2RFbmFibGVkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRGVzZXJpYWxpemVVc2luZ1JlZmxlY3Rpb24oeG1sUmVhZGVyLCBlbmNvZGluZ1N0eWxlLCBldmVudHMpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5Gb3JtYXQoU1IuWG1sX01pc3NpbmdTZXJpYWxpemF0aW9uQ29kZUV4Y2VwdGlvbiwgdGhpcy5fcm9vdFR5cGUsIHR5cGVvZihYbWxTZXJpYWxpemVyKS5OYW1lKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQojZW5kaWYNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoZSBpcyBUYXJnZXRJbnZvY2F0aW9uRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgICAgICBlID0gZS5Jbm5lckV4Y2VwdGlvbjsNCg0KICAgICAgICAgICAgICAgIGlmICh4bWxSZWFkZXIgaXMgSVhtbExpbmVJbmZvKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgSVhtbExpbmVJbmZvIGxpbmVJbmZvID0gKElYbWxMaW5lSW5mbyl4bWxSZWFkZXI7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxTZXJpYWxpemVFcnJvckRldGFpbHMsIGxpbmVJbmZvLkxpbmVOdW1iZXIuVG9TdHJpbmcoQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSksIGxpbmVJbmZvLkxpbmVQb3NpdGlvbi5Ub1N0cmluZyhDdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlKSksIGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YbWxTZXJpYWxpemVFcnJvciwgZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBvYmplY3QgRGVzZXJpYWxpemVVc2luZ1JlZmxlY3Rpb24oWG1sUmVhZGVyIHhtbFJlYWRlciwgc3RyaW5nIGVuY29kaW5nU3R5bGUsIFhtbERlc2VyaWFsaXphdGlvbkV2ZW50cyBldmVudHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbE1hcHBpbmcgbWFwcGluZyA9IEdldE1hcHBpbmcoKTsNCiAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgUmVmbGVjdGlvblhtbFNlcmlhbGl6YXRpb25SZWFkZXIobWFwcGluZywgeG1sUmVhZGVyLCBldmVudHMsIGVuY29kaW5nU3R5bGUpOw0KICAgICAgICAgICAgcmV0dXJuIHJlYWRlci5SZWFkT2JqZWN0KCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBib29sIFNob3VsZFVzZVJlZmxlY3Rpb25CYXNlZFNlcmlhbGl6YXRpb24oWG1sTWFwcGluZyBtYXBwaW5nKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gTW9kZSA9PSBTZXJpYWxpemF0aW9uTW9kZS5SZWZsZWN0aW9uT25seQ0KICAgICAgICAgICAgICAgIHx8IChtYXBwaW5nICE9IG51bGwgJiYgbWFwcGluZy5Jc1NvYXApOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5DYW5EZXNlcmlhbGl6ZSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBDYW5EZXNlcmlhbGl6ZShYbWxSZWFkZXIgeG1sUmVhZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX3ByaW1pdGl2ZVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBUeXBlRGVzYyB0eXBlRGVzYyA9IChUeXBlRGVzYylUeXBlU2NvcGUuUHJpbXRpdmVUeXBlc1tfcHJpbWl0aXZlVHlwZV07DQogICAgICAgICAgICAgICAgcmV0dXJuIHhtbFJlYWRlci5Jc1N0YXJ0RWxlbWVudCh0eXBlRGVzYy5EYXRhVHlwZS5OYW1lLCBzdHJpbmcuRW1wdHkpOw0KICAgICAgICAgICAgfQ0KI2lmICFGRUFUVVJFX1NFUklBTElaQVRJT05fVUFQQU9UDQogICAgICAgICAgICBlbHNlIGlmIChfdGVtcEFzc2VtYmx5ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF90ZW1wQXNzZW1ibHkuQ2FuUmVhZChfbWFwcGluZywgeG1sUmVhZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQojZWxzZQ0KICAgICAgICAgICAgaWYgKHRoaXMuaW5uZXJTZXJpYWxpemVyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJTZXJpYWxpemVyLkNhbkRlc2VyaWFsaXplKHhtbFJlYWRlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZmxlY3Rpb25NZXRob2RFbmFibGVkOw0KICAgICAgICAgICAgfQ0KI2VuZGlmDQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLkZyb21NYXBwaW5ncyJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHN0YXRpYyBYbWxTZXJpYWxpemVyW10gRnJvbU1hcHBpbmdzKFhtbE1hcHBpbmdbXSBtYXBwaW5ncykNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIEZyb21NYXBwaW5ncyhtYXBwaW5ncywgKFR5cGUpbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLkZyb21NYXBwaW5nczEiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBzdGF0aWMgWG1sU2VyaWFsaXplcltdIEZyb21NYXBwaW5ncyhYbWxNYXBwaW5nW10gbWFwcGluZ3MsIFR5cGUgdHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG1hcHBpbmdzID09IG51bGwgfHwgbWFwcGluZ3MuTGVuZ3RoID09IDApIHJldHVybiBBcnJheS5FbXB0eTxYbWxTZXJpYWxpemVyPigpOw0KI2lmIEZFQVRVUkVfU0VSSUFMSVpBVElPTl9VQVBBT1QNCiAgICAgICAgICAgIFhtbFNlcmlhbGl6ZXJbXSBzZXJpYWxpemVycyA9IEdldFJlZmxlY3Rpb25CYXNlZFNlcmlhbGl6ZXJzKG1hcHBpbmdzLCB0eXBlKTsNCiAgICAgICAgICAgIHJldHVybiBzZXJpYWxpemVyczsNCiNlbHNlDQogICAgICAgICAgICBib29sIGFueVNvYXBNYXBwaW5nID0gZmFsc2U7DQogICAgICAgICAgICBmb3JlYWNoICh2YXIgbWFwcGluZyBpbiBtYXBwaW5ncykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobWFwcGluZy5Jc1NvYXApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhbnlTb2FwTWFwcGluZyA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoKGFueVNvYXBNYXBwaW5nICYmIFJlZmxlY3Rpb25NZXRob2RFbmFibGVkKSB8fCBNb2RlID09IFNlcmlhbGl6YXRpb25Nb2RlLlJlZmxlY3Rpb25Pbmx5KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNlcmlhbGl6ZXJbXSBzZXJpYWxpemVycyA9IEdldFJlZmxlY3Rpb25CYXNlZFNlcmlhbGl6ZXJzKG1hcHBpbmdzLCB0eXBlKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWFsaXplcnM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFhtbFNlcmlhbGl6ZXJJbXBsZW1lbnRhdGlvbiBjb250cmFjdCA9IG51bGw7DQogICAgICAgICAgICBBc3NlbWJseSBhc3NlbWJseSA9IHR5cGUgPT0gbnVsbCA/IG51bGwgOiBUZW1wQXNzZW1ibHkuTG9hZEdlbmVyYXRlZEFzc2VtYmx5KHR5cGUsIG51bGwsIG91dCBjb250cmFjdCk7DQogICAgICAgICAgICBUZW1wQXNzZW1ibHkgdGVtcEFzc2VtYmx5ID0gbnVsbDsNCiAgICAgICAgICAgIGlmIChhc3NlbWJseSA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChNb2RlID09IFNlcmlhbGl6YXRpb25Nb2RlLlByZUdlbk9ubHkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlbWJseU5hbWUgbmFtZSA9IHR5cGUuQXNzZW1ibHkuR2V0TmFtZSgpOw0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgc2VyaWFsaXplck5hbWUgPSBDb21waWxlci5HZXRUZW1wQXNzZW1ibHlOYW1lKG5hbWUsIG51bGwpOw0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRmlsZUxvYWRFeGNlcHRpb24oU1IuRm9ybWF0KFNSLkZhaWxMb2FkQXNzZW1ibHlVbmRlclByZWdlbk1vZGUsIHNlcmlhbGl6ZXJOYW1lKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKFhtbE1hcHBpbmcuSXNTaGFsbG93KG1hcHBpbmdzKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBBcnJheS5FbXB0eTxYbWxTZXJpYWxpemVyPigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wQXNzZW1ibHkgPSBuZXcgVGVtcEFzc2VtYmx5KG1hcHBpbmdzLCBuZXcgVHlwZVtdIHsgdHlwZSB9LCBudWxsLCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNlcmlhbGl6ZXJbXSBzZXJpYWxpemVycyA9IG5ldyBYbWxTZXJpYWxpemVyW21hcHBpbmdzLkxlbmd0aF07DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyYWN0ID0gdGVtcEFzc2VtYmx5LkNvbnRyYWN0Ow0KDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlcmlhbGl6ZXJzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXJzW2ldID0gKFhtbFNlcmlhbGl6ZXIpY29udHJhY3QuVHlwZWRTZXJpYWxpemVyc1ttYXBwaW5nc1tpXS5LZXldOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXJzW2ldLlNldFRlbXBBc3NlbWJseSh0ZW1wQXNzZW1ibHksIG1hcHBpbmdzW2ldKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZXJzOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlIFhtbFNlcmlhbGl6ZXIgY2FjaGUgd2hlbiB0aGUgdHlwZSBpcyBub3QgbnVsbC4NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBHZXRTZXJpYWxpemVyc0Zyb21DYWNoZShtYXBwaW5ncywgdHlwZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2VyaWFsaXplcltdIHNlcmlhbGl6ZXJzID0gbmV3IFhtbFNlcmlhbGl6ZXJbbWFwcGluZ3MuTGVuZ3RoXTsNCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlcmlhbGl6ZXJzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVyc1tpXSA9IChYbWxTZXJpYWxpemVyKWNvbnRyYWN0LlR5cGVkU2VyaWFsaXplcnNbbWFwcGluZ3NbaV0uS2V5XTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWFsaXplcnM7DQogICAgICAgICAgICB9DQojZW5kaWYNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIFhtbFNlcmlhbGl6ZXJbXSBHZXRSZWZsZWN0aW9uQmFzZWRTZXJpYWxpemVycyhYbWxNYXBwaW5nW10gbWFwcGluZ3MsIFR5cGUgdHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZXJzID0gbmV3IFhtbFNlcmlhbGl6ZXJbbWFwcGluZ3MuTGVuZ3RoXTsNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VyaWFsaXplcnMuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2VyaWFsaXplcnNbaV0gPSBuZXcgWG1sU2VyaWFsaXplcigpOw0KICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXJzW2ldLl9yb290VHlwZSA9IHR5cGU7DQogICAgICAgICAgICAgICAgc2VyaWFsaXplcnNbaV0uX21hcHBpbmcgPSBtYXBwaW5nc1tpXTsNCiAgICAgICAgICAgICAgICBzZXJpYWxpemVyc1tpXS5faXNSZWZsZWN0aW9uQmFzZWRTZXJpYWxpemVyID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZXJzOw0KICAgICAgICB9DQoNCiNpZiAhRkVBVFVSRV9TRVJJQUxJWkFUSU9OX1VBUEFPVA0KICAgICAgICBbUmVzb3VyY2VDb25zdW1wdGlvbihSZXNvdXJjZVNjb3BlLk1hY2hpbmUsIFJlc291cmNlU2NvcGUuTWFjaGluZSldDQogICAgICAgIFtSZXNvdXJjZUV4cG9zdXJlKFJlc291cmNlU2NvcGUuTm9uZSldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBHZW5lcmF0ZVNlcmlhbGl6ZXIoVHlwZVtdIHR5cGVzLCBYbWxNYXBwaW5nW10gbWFwcGluZ3MsIFN0cmVhbSBzdHJlYW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh0eXBlcyA9PSBudWxsIHx8IHR5cGVzLkxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCg0KICAgICAgICAgICAgaWYgKG1hcHBpbmdzID09IG51bGwpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2YobWFwcGluZ3MpKTsNCg0KICAgICAgICAgICAgaWYgKHN0cmVhbSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24obmFtZW9mKHN0cmVhbSkpOw0KDQogICAgICAgICAgICBpZiAoWG1sTWFwcGluZy5Jc1NoYWxsb3cobWFwcGluZ3MpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxNZWxmb3JtTWFwcGluZykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBBc3NlbWJseSBhc3NlbWJseSA9IG51bGw7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHR5cGVzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFR5cGUgdHlwZSA9IHR5cGVzW2ldOw0KICAgICAgICAgICAgICAgIGlmIChEeW5hbWljQXNzZW1ibGllcy5Jc1R5cGVEeW5hbWljKHR5cGUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbFByZWdlblR5cGVEeW5hbWljLCB0eXBlLkZ1bGxOYW1lKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGFzc2VtYmx5ID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSA9IHR5cGUuQXNzZW1ibHk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUuQXNzZW1ibHkgIT0gYXNzZW1ibHkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRFeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbFByZWdlbk9ycGhhblR5cGUsIHR5cGUuRnVsbE5hbWUsIGFzc2VtYmx5LkxvY2F0aW9uKSwgInR5cGVzIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gVGVtcEFzc2VtYmx5LkdlbmVyYXRlU2VyaWFsaXplclRvU3RyZWFtKG1hcHBpbmdzLCB0eXBlcywgbnVsbCwgYXNzZW1ibHksIG5ldyBIYXNodGFibGUoKSwgc3RyZWFtKTsNCiAgICAgICAgfQ0KI2VuZGlmDQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgWG1sU2VyaWFsaXplcltdIEdldFNlcmlhbGl6ZXJzRnJvbUNhY2hlKFhtbE1hcHBpbmdbXSBtYXBwaW5ncywgVHlwZSB0eXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTZXJpYWxpemVyW10gc2VyaWFsaXplcnMgPSBuZXcgWG1sU2VyaWFsaXplclttYXBwaW5ncy5MZW5ndGhdOw0KDQogICAgICAgICAgICBEaWN0aW9uYXJ5PFhtbFNlcmlhbGl6ZXJNYXBwaW5nS2V5LCBYbWxTZXJpYWxpemVyPiB0eXBlZE1hcHBpbmdUYWJsZSA9IG51bGw7DQogICAgICAgICAgICBsb2NrIChzX3htbFNlcmlhbGl6ZXJUYWJsZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIXNfeG1sU2VyaWFsaXplclRhYmxlLlRyeUdldFZhbHVlKHR5cGUsIG91dCB0eXBlZE1hcHBpbmdUYWJsZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0eXBlZE1hcHBpbmdUYWJsZSA9IG5ldyBEaWN0aW9uYXJ5PFhtbFNlcmlhbGl6ZXJNYXBwaW5nS2V5LCBYbWxTZXJpYWxpemVyPigpOw0KICAgICAgICAgICAgICAgICAgICBzX3htbFNlcmlhbGl6ZXJUYWJsZVt0eXBlXSA9IHR5cGVkTWFwcGluZ1RhYmxlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbG9jayAodHlwZWRNYXBwaW5nVGFibGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIHBlbmRpbmdLZXlzID0gbmV3IERpY3Rpb25hcnk8WG1sU2VyaWFsaXplck1hcHBpbmdLZXksIGludD4oKTsNCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2VyaWFsaXplck1hcHBpbmdLZXkgbWFwcGluZ0tleSA9IG5ldyBYbWxTZXJpYWxpemVyTWFwcGluZ0tleShtYXBwaW5nc1tpXSk7DQogICAgICAgICAgICAgICAgICAgIGlmICghdHlwZWRNYXBwaW5nVGFibGUuVHJ5R2V0VmFsdWUobWFwcGluZ0tleSwgb3V0IHNlcmlhbGl6ZXJzW2ldKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0tleXMuQWRkKG1hcHBpbmdLZXksIGkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdLZXlzLkNvdW50ID4gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbE1hcHBpbmdbXSBwZW5kaW5nTWFwcGluZ3MgPSBuZXcgWG1sTWFwcGluZ1twZW5kaW5nS2V5cy5Db3VudF07DQogICAgICAgICAgICAgICAgICAgIGludCBpbmRleCA9IDA7DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNlcmlhbGl6ZXJNYXBwaW5nS2V5IG1hcHBpbmdLZXkgaW4gcGVuZGluZ0tleXMuS2V5cykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ01hcHBpbmdzW2luZGV4KytdID0gbWFwcGluZ0tleS5NYXBwaW5nOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgVGVtcEFzc2VtYmx5IHRlbXBBc3NlbWJseSA9IG5ldyBUZW1wQXNzZW1ibHkocGVuZGluZ01hcHBpbmdzLCBuZXcgVHlwZVtdIHsgdHlwZSB9LCBudWxsLCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2VyaWFsaXplckltcGxlbWVudGF0aW9uIGNvbnRyYWN0ID0gdGVtcEFzc2VtYmx5LkNvbnRyYWN0Ow0KDQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNlcmlhbGl6ZXJNYXBwaW5nS2V5IG1hcHBpbmdLZXkgaW4gcGVuZGluZ0tleXMuS2V5cykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBwZW5kaW5nS2V5c1ttYXBwaW5nS2V5XTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXJzW2luZGV4XSA9IChYbWxTZXJpYWxpemVyKWNvbnRyYWN0LlR5cGVkU2VyaWFsaXplcnNbbWFwcGluZ0tleS5NYXBwaW5nLktleV07DQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVyc1tpbmRleF0uU2V0VGVtcEFzc2VtYmx5KHRlbXBBc3NlbWJseSwgbWFwcGluZ0tleS5NYXBwaW5nKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWRNYXBwaW5nVGFibGVbbWFwcGluZ0tleV0gPSBzZXJpYWxpemVyc1tpbmRleF07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBzZXJpYWxpemVyczsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuRnJvbVR5cGVzIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgc3RhdGljIFhtbFNlcmlhbGl6ZXJbXSBGcm9tVHlwZXMoVHlwZVtdIHR5cGVzKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAodHlwZXMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuRW1wdHk8WG1sU2VyaWFsaXplcj4oKTsNCg0KI2lmIEZFQVRVUkVfU0VSSUFMSVpBVElPTl9VQVBBT1QNCiAgICAgICAgICAgIHZhciBzZXJpYWxpemVycyA9IG5ldyBYbWxTZXJpYWxpemVyW3R5cGVzLkxlbmd0aF07DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHR5cGVzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXJzW2ldID0gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZXNbaV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZXJzOw0KI2Vsc2UNCiAgICAgICAgICAgIFhtbFJlZmxlY3Rpb25JbXBvcnRlciBpbXBvcnRlciA9IG5ldyBYbWxSZWZsZWN0aW9uSW1wb3J0ZXIoKTsNCiAgICAgICAgICAgIFhtbFR5cGVNYXBwaW5nW10gbWFwcGluZ3MgPSBuZXcgWG1sVHlwZU1hcHBpbmdbdHlwZXMuTGVuZ3RoXTsNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHlwZXMuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbWFwcGluZ3NbaV0gPSBpbXBvcnRlci5JbXBvcnRUeXBlTWFwcGluZyh0eXBlc1tpXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gRnJvbU1hcHBpbmdzKG1hcHBpbmdzKTsNCiNlbmRpZg0KICAgICAgICB9DQoNCiNpZiBGRUFUVVJFX1NFUklBTElaQVRJT05fVUFQQU9UDQogICAgICAgIC8vIHRoaXMgdGhlIGdsb2JhbCBYTUwgc2VyaWFsaXplciBjb250cmFjdCBpbnRyb2R1Y2VkIGZvciBtdWx0aS1maWxlDQogICAgICAgIHByaXZhdGUgc3RhdGljIFhtbFNlcmlhbGl6ZXJJbXBsZW1lbnRhdGlvbiB4bWxTZXJpYWxpemVyQ29udHJhY3Q7DQoNCiAgICAgICAgaW50ZXJuYWwgc3RhdGljIFhtbFNlcmlhbGl6ZXJJbXBsZW1lbnRhdGlvbiBHZXRYbWxTZXJpYWxpemVyQ29udHJhY3RGcm9tR2VuZXJhdGVkQXNzZW1ibHkoKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBoYWNrIHRvIHB1bGwgaW4gU2V0WG1sU2VyaWFsaXplckNvbnRyYWN0IHdoaWNoIGlzIG9ubHkgcmVmZXJlbmNlZCBmcm9tIHRoZQ0KICAgICAgICAgICAgLy8gY29kZSBpbmplY3RlZCBieSBNYWluTWV0aG9kSW5qZWN0b3IgdHJhbnNmb3JtDQogICAgICAgICAgICAvLyB0aGVyZSdzIHByb2JhYmx5IGFsc28gYSB3YXkgdG8gZG8gdGhpcyB2aWEgW0RlcGVuZGVuY3lSZWR1Y3Rpb25Sb290XSwNCiAgICAgICAgICAgIC8vIGJ1dCBJIGNhbid0IGdldCB0aGUgY29tcGlsZXIgdG8gZmluZCB0aGF0Li4uDQogICAgICAgICAgICBpZiAoeG1sU2VyaWFsaXplckNvbnRyYWN0ID09IG51bGwpDQogICAgICAgICAgICAgICAgU2V0WG1sU2VyaWFsaXplckNvbnRyYWN0KG51bGwpOw0KDQogICAgICAgICAgICAvLyB0aGlzIG1ldGhvZCBib2R5IHVzZWQgdG8gYmUgcmV3cml0dGVuIGJ5IGFuIElMIHRyYW5zZm9ybQ0KICAgICAgICAgICAgLy8gd2l0aCB0aGUgcmVzdHJ1Y3R1cmluZyBmb3IgbXVsdGktZmlsZSwgaXQgaGFzIGJlY29tZSBhIHJlZ3VsYXIgbWV0aG9kDQogICAgICAgICAgICByZXR1cm4geG1sU2VyaWFsaXplckNvbnRyYWN0Ow0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFNldFhtbFNlcmlhbGl6ZXJDb250cmFjdChYbWxTZXJpYWxpemVySW1wbGVtZW50YXRpb24geG1sU2VyaWFsaXplckltcGxlbWVudGF0aW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICB4bWxTZXJpYWxpemVyQ29udHJhY3QgPSB4bWxTZXJpYWxpemVySW1wbGVtZW50YXRpb247DQogICAgICAgIH0NCiNlbmRpZg0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuR2V0WG1sU2VyaWFsaXplckFzc2VtYmx5TmFtZSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0WG1sU2VyaWFsaXplckFzc2VtYmx5TmFtZShUeXBlIHR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBHZXRYbWxTZXJpYWxpemVyQXNzZW1ibHlOYW1lKHR5cGUsIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5HZXRYbWxTZXJpYWxpemVyQXNzZW1ibHlOYW1lIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRYbWxTZXJpYWxpemVyQXNzZW1ibHlOYW1lKFR5cGUgdHlwZSwgc3RyaW5nIGRlZmF1bHROYW1lc3BhY2UpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh0eXBlID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2YodHlwZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIENvbXBpbGVyLkdldFRlbXBBc3NlbWJseU5hbWUodHlwZS5Bc3NlbWJseS5HZXROYW1lKCksIGRlZmF1bHROYW1lc3BhY2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5Vbmtub3duTm9kZSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIGV2ZW50IFhtbE5vZGVFdmVudEhhbmRsZXIgVW5rbm93bk5vZGUNCiAgICAgICAgew0KICAgICAgICAgICAgYWRkDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2V2ZW50cy5PblVua25vd25Ob2RlICs9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVtb3ZlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2V2ZW50cy5PblVua25vd25Ob2RlIC09IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5Vbmtub3duQXR0cmlidXRlIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgZXZlbnQgWG1sQXR0cmlidXRlRXZlbnRIYW5kbGVyIFVua25vd25BdHRyaWJ1dGUNCiAgICAgICAgew0KICAgICAgICAgICAgYWRkDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2V2ZW50cy5PblVua25vd25BdHRyaWJ1dGUgKz0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZW1vdmUNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZXZlbnRzLk9uVW5rbm93bkF0dHJpYnV0ZSAtPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuVW5rbm93bkVsZW1lbnQiXS8qJyAvPg0KICAgICAgICBwdWJsaWMgZXZlbnQgWG1sRWxlbWVudEV2ZW50SGFuZGxlciBVbmtub3duRWxlbWVudA0KICAgICAgICB7DQogICAgICAgICAgICBhZGQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZXZlbnRzLk9uVW5rbm93bkVsZW1lbnQgKz0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZW1vdmUNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZXZlbnRzLk9uVW5rbm93bkVsZW1lbnQgLT0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLlVucmVmZXJlbmNlZE9iamVjdCJdLyonIC8+DQogICAgICAgIHB1YmxpYyBldmVudCBVbnJlZmVyZW5jZWRPYmplY3RFdmVudEhhbmRsZXIgVW5yZWZlcmVuY2VkT2JqZWN0DQogICAgICAgIHsNCiAgICAgICAgICAgIGFkZA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9ldmVudHMuT25VbnJlZmVyZW5jZWRPYmplY3QgKz0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZW1vdmUNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZXZlbnRzLk9uVW5yZWZlcmVuY2VkT2JqZWN0IC09IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5DcmVhdGVSZWFkZXIiXS8qJyAvPg0KICAgICAgICAvLy88aW50ZXJuYWxvbmx5Lz4NCiAgICAgICAgcHJvdGVjdGVkIHZpcnR1YWwgWG1sU2VyaWFsaXphdGlvblJlYWRlciBDcmVhdGVSZWFkZXIoKSB7IHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpOyB9DQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2VyaWFsaXplci51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNlcmlhbGl6ZXIuRGVzZXJpYWxpemU0Il0vKicgLz4NCiAgICAgICAgLy8vPGludGVybmFsb25seS8+DQogICAgICAgIHByb3RlY3RlZCB2aXJ0dWFsIG9iamVjdCBEZXNlcmlhbGl6ZShYbWxTZXJpYWxpemF0aW9uUmVhZGVyIHJlYWRlcikgeyB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTsgfQ0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNlcmlhbGl6ZXIudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTZXJpYWxpemVyLkNyZWF0ZVdyaXRlciJdLyonIC8+DQogICAgICAgIC8vLzxpbnRlcm5hbG9ubHkvPg0KICAgICAgICBwcm90ZWN0ZWQgdmlydHVhbCBYbWxTZXJpYWxpemF0aW9uV3JpdGVyIENyZWF0ZVdyaXRlcigpIHsgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTZXJpYWxpemVyLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2VyaWFsaXplci5TZXJpYWxpemU3Il0vKicgLz4NCiAgICAgICAgLy8vPGludGVybmFsb25seS8+DQogICAgICAgIHByb3RlY3RlZCB2aXJ0dWFsIHZvaWQgU2VyaWFsaXplKG9iamVjdCBvLCBYbWxTZXJpYWxpemF0aW9uV3JpdGVyIHdyaXRlcikgeyB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTsgfQ0KDQogICAgICAgIGludGVybmFsIHZvaWQgU2V0VGVtcEFzc2VtYmx5KFRlbXBBc3NlbWJseSB0ZW1wQXNzZW1ibHksIFhtbE1hcHBpbmcgbWFwcGluZykNCiAgICAgICAgew0KICAgICAgICAgICAgX3RlbXBBc3NlbWJseSA9IHRlbXBBc3NlbWJseTsNCiAgICAgICAgICAgIF9tYXBwaW5nID0gbWFwcGluZzsNCiAgICAgICAgICAgIF90eXBlZFNlcmlhbGl6ZXIgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgWG1sVHlwZU1hcHBpbmcgR2V0S25vd25NYXBwaW5nKFR5cGUgdHlwZSwgc3RyaW5nIG5zKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAobnMgIT0gbnVsbCAmJiBucyAhPSBzdHJpbmcuRW1wdHkpDQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICBUeXBlRGVzYyB0eXBlRGVzYyA9IChUeXBlRGVzYylUeXBlU2NvcGUuUHJpbXRpdmVUeXBlc1t0eXBlXTsNCiAgICAgICAgICAgIGlmICh0eXBlRGVzYyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgRWxlbWVudEFjY2Vzc29yIGVsZW1lbnQgPSBuZXcgRWxlbWVudEFjY2Vzc29yKCk7DQogICAgICAgICAgICBlbGVtZW50Lk5hbWUgPSB0eXBlRGVzYy5EYXRhVHlwZS5OYW1lOw0KICAgICAgICAgICAgWG1sVHlwZU1hcHBpbmcgbWFwcGluZyA9IG5ldyBYbWxUeXBlTWFwcGluZyhudWxsLCBlbGVtZW50KTsNCiAgICAgICAgICAgIG1hcHBpbmcuU2V0S2V5SW50ZXJuYWwoWG1sTWFwcGluZy5HZW5lcmF0ZUtleSh0eXBlLCBudWxsLCBudWxsKSk7DQogICAgICAgICAgICByZXR1cm4gbWFwcGluZzsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBTZXJpYWxpemVQcmltaXRpdmUoWG1sV3JpdGVyIHhtbFdyaXRlciwgb2JqZWN0IG8sIFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzIG5hbWVzcGFjZXMpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNlcmlhbGl6YXRpb25QcmltaXRpdmVXcml0ZXIgd3JpdGVyID0gbmV3IFhtbFNlcmlhbGl6YXRpb25QcmltaXRpdmVXcml0ZXIoKTsNCiAgICAgICAgICAgIHdyaXRlci5Jbml0KHhtbFdyaXRlciwgbmFtZXNwYWNlcywgbnVsbCwgbnVsbCwgbnVsbCk7DQogICAgICAgICAgICBzd2l0Y2ggKF9wcmltaXRpdmVUeXBlLkdldFR5cGVDb2RlKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5TdHJpbmc6DQogICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZV9zdHJpbmcobyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuSW50MzI6DQogICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZV9pbnQobyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuQm9vbGVhbjoNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlX2Jvb2xlYW4obyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuSW50MTY6DQogICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZV9zaG9ydChvKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5JbnQ2NDoNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlX2xvbmcobyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuU2luZ2xlOg0KICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVfZmxvYXQobyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuRG91YmxlOg0KICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVfZG91YmxlKG8pOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFR5cGVDb2RlLkRlY2ltYWw6DQogICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZV9kZWNpbWFsKG8pOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFR5cGVDb2RlLkRhdGVUaW1lOg0KICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVfZGF0ZVRpbWUobyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuQ2hhcjoNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlX2NoYXIobyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuQnl0ZToNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlX3Vuc2lnbmVkQnl0ZShvKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5TQnl0ZToNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlX2J5dGUobyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuVUludDE2Og0KICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVfdW5zaWduZWRTaG9ydChvKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5VSW50MzI6DQogICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZV91bnNpZ25lZEludChvKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5VSW50NjQ6DQogICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZV91bnNpZ25lZExvbmcobyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9wcmltaXRpdmVUeXBlID09IHR5cGVvZihYbWxRdWFsaWZpZWROYW1lKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlX1FOYW1lKG8pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9wcmltaXRpdmVUeXBlID09IHR5cGVvZihieXRlW10pKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVfYmFzZTY0QmluYXJ5KG8pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9wcmltaXRpdmVUeXBlID09IHR5cGVvZihHdWlkKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlX2d1aWQobyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoX3ByaW1pdGl2ZVR5cGUgPT0gdHlwZW9mKFRpbWVTcGFuKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlX1RpbWVTcGFuKG8pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhtbFVueHBlY3RlZFR5cGUsIF9wcmltaXRpdmVUeXBlLkZ1bGxOYW1lKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIG9iamVjdCBEZXNlcmlhbGl6ZVByaW1pdGl2ZShYbWxSZWFkZXIgeG1sUmVhZGVyLCBYbWxEZXNlcmlhbGl6YXRpb25FdmVudHMgZXZlbnRzKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTZXJpYWxpemF0aW9uUHJpbWl0aXZlUmVhZGVyIHJlYWRlciA9IG5ldyBYbWxTZXJpYWxpemF0aW9uUHJpbWl0aXZlUmVhZGVyKCk7DQogICAgICAgICAgICByZWFkZXIuSW5pdCh4bWxSZWFkZXIsIGV2ZW50cywgbnVsbCwgbnVsbCk7DQogICAgICAgICAgICBvYmplY3QgbzsNCiAgICAgICAgICAgIHN3aXRjaCAoX3ByaW1pdGl2ZVR5cGUuR2V0VHlwZUNvZGUoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFR5cGVDb2RlLlN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgbyA9IHJlYWRlci5SZWFkX3N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFR5cGVDb2RlLkludDMyOg0KICAgICAgICAgICAgICAgICAgICBvID0gcmVhZGVyLlJlYWRfaW50KCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuQm9vbGVhbjoNCiAgICAgICAgICAgICAgICAgICAgbyA9IHJlYWRlci5SZWFkX2Jvb2xlYW4oKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5JbnQxNjoNCiAgICAgICAgICAgICAgICAgICAgbyA9IHJlYWRlci5SZWFkX3Nob3J0KCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuSW50NjQ6DQogICAgICAgICAgICAgICAgICAgIG8gPSByZWFkZXIuUmVhZF9sb25nKCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuU2luZ2xlOg0KICAgICAgICAgICAgICAgICAgICBvID0gcmVhZGVyLlJlYWRfZmxvYXQoKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5Eb3VibGU6DQogICAgICAgICAgICAgICAgICAgIG8gPSByZWFkZXIuUmVhZF9kb3VibGUoKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5EZWNpbWFsOg0KICAgICAgICAgICAgICAgICAgICBvID0gcmVhZGVyLlJlYWRfZGVjaW1hbCgpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFR5cGVDb2RlLkRhdGVUaW1lOg0KICAgICAgICAgICAgICAgICAgICBvID0gcmVhZGVyLlJlYWRfZGF0ZVRpbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5DaGFyOg0KICAgICAgICAgICAgICAgICAgICBvID0gcmVhZGVyLlJlYWRfY2hhcigpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFR5cGVDb2RlLkJ5dGU6DQogICAgICAgICAgICAgICAgICAgIG8gPSByZWFkZXIuUmVhZF91bnNpZ25lZEJ5dGUoKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5TQnl0ZToNCiAgICAgICAgICAgICAgICAgICAgbyA9IHJlYWRlci5SZWFkX2J5dGUoKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5VSW50MTY6DQogICAgICAgICAgICAgICAgICAgIG8gPSByZWFkZXIuUmVhZF91bnNpZ25lZFNob3J0KCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgVHlwZUNvZGUuVUludDMyOg0KICAgICAgICAgICAgICAgICAgICBvID0gcmVhZGVyLlJlYWRfdW5zaWduZWRJbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBUeXBlQ29kZS5VSW50NjQ6DQogICAgICAgICAgICAgICAgICAgIG8gPSByZWFkZXIuUmVhZF91bnNpZ25lZExvbmcoKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICBpZiAoX3ByaW1pdGl2ZVR5cGUgPT0gdHlwZW9mKFhtbFF1YWxpZmllZE5hbWUpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBvID0gcmVhZGVyLlJlYWRfUU5hbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChfcHJpbWl0aXZlVHlwZSA9PSB0eXBlb2YoYnl0ZVtdKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbyA9IHJlYWRlci5SZWFkX2Jhc2U2NEJpbmFyeSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9wcmltaXRpdmVUeXBlID09IHR5cGVvZihHdWlkKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbyA9IHJlYWRlci5SZWFkX2d1aWQoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChfcHJpbWl0aXZlVHlwZSA9PSB0eXBlb2YoVGltZVNwYW4pKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBvID0gcmVhZGVyLlJlYWRfVGltZVNwYW4oKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YbWxVbnhwZWN0ZWRUeXBlLCBfcHJpbWl0aXZlVHlwZS5GdWxsTmFtZSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG87DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGNsYXNzIFhtbFNlcmlhbGl6ZXJNYXBwaW5nS2V5DQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBYbWxNYXBwaW5nIE1hcHBpbmc7DQogICAgICAgICAgICBwdWJsaWMgWG1sU2VyaWFsaXplck1hcHBpbmdLZXkoWG1sTWFwcGluZyBtYXBwaW5nKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRoaXMuTWFwcGluZyA9IG1hcHBpbmc7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIEVxdWFscyhvYmplY3Qgb2JqKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNlcmlhbGl6ZXJNYXBwaW5nS2V5IG90aGVyID0gb2JqIGFzIFhtbFNlcmlhbGl6ZXJNYXBwaW5nS2V5Ow0KICAgICAgICAgICAgICAgIGlmIChvdGhlciA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5NYXBwaW5nLktleSAhPSBvdGhlci5NYXBwaW5nLktleSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICAgICAgaWYgKHRoaXMuTWFwcGluZy5FbGVtZW50TmFtZSAhPSBvdGhlci5NYXBwaW5nLkVsZW1lbnROYW1lKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5NYXBwaW5nLk5hbWVzcGFjZSAhPSBvdGhlci5NYXBwaW5nLk5hbWVzcGFjZSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICAgICAgaWYgKHRoaXMuTWFwcGluZy5Jc1NvYXAgIT0gb3RoZXIuTWFwcGluZy5Jc1NvYXApDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgaW50IEdldEhhc2hDb2RlKCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbnQgaGFzaENvZGUgPSB0aGlzLk1hcHBpbmcuSXNTb2FwID8gMCA6IDE7DQoNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5NYXBwaW5nLktleSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBoYXNoQ29kZSBePSB0aGlzLk1hcHBpbmcuS2V5LkdldEhhc2hDb2RlKCk7DQoNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5NYXBwaW5nLkVsZW1lbnROYW1lICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIGhhc2hDb2RlIF49IHRoaXMuTWFwcGluZy5FbGVtZW50TmFtZS5HZXRIYXNoQ29kZSgpOw0KDQogICAgICAgICAgICAgICAgaWYgKHRoaXMuTWFwcGluZy5OYW1lc3BhY2UgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgaGFzaENvZGUgXj0gdGhpcy5NYXBwaW5nLk5hbWVzcGFjZS5HZXRIYXNoQ29kZSgpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGhhc2hDb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Core/XmlValidatingReaderImpl.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlhtbC5TY2hlbWE7DQp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnM7DQp1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQp1c2luZyBTeXN0ZW0uR2xvYmFsaXphdGlvbjsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLlJ1bnRpbWUuVmVyc2lvbmluZzsNCg0KbmFtZXNwYWNlIFN5c3RlbS5YbWwNCnsNCiAgICBpbnRlcm5hbCBzZWFsZWQgcGFydGlhbCBjbGFzcyBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCA6IFhtbFJlYWRlciwgSVhtbExpbmVJbmZvLCBJWG1sTmFtZXNwYWNlUmVzb2x2ZXINCiAgICB7DQogICAgICAgIC8vDQogICAgICAgIC8vIFByaXZhdGUgaGVscGVyIHR5cGVzDQogICAgICAgIC8vDQogICAgICAgIC8vIFBhcnNpbmdGdW5jdGlvbiA9IHdoYXQgc2hvdWxkIHRoZSByZWFkZXIgZG8gd2hlbiB0aGUgbmV4dCBSZWFkKCkgaXMgY2FsbGVkDQogICAgICAgIHByaXZhdGUgZW51bSBQYXJzaW5nRnVuY3Rpb24NCiAgICAgICAgew0KICAgICAgICAgICAgUmVhZCA9IDAsDQogICAgICAgICAgICBJbml0LA0KICAgICAgICAgICAgUGFyc2VEdGRGcm9tQ29udGV4dCwNCiAgICAgICAgICAgIFJlc29sdmVFbnRpdHlJbnRlcm5hbGx5LA0KICAgICAgICAgICAgSW5SZWFkQmluYXJ5Q29udGVudCwNCiAgICAgICAgICAgIFJlYWRlckNsb3NlZCwNCiAgICAgICAgICAgIEVycm9yLA0KICAgICAgICAgICAgTm9uZSwNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGNsYXNzIFZhbGlkYXRpb25FdmVudEhhbmRsaW5nIDogSVZhbGlkYXRpb25FdmVudEhhbmRsaW5nDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIEZpZWxkcw0KICAgICAgICAgICAgcHJpdmF0ZSBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCBfcmVhZGVyOw0KICAgICAgICAgICAgcHJpdmF0ZSBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIF9ldmVudEhhbmRsZXI7DQoNCiAgICAgICAgICAgIC8vIENvbnN0cnVjdG9yDQogICAgICAgICAgICBpbnRlcm5hbCBWYWxpZGF0aW9uRXZlbnRIYW5kbGluZyhYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCByZWFkZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3JlYWRlciA9IHJlYWRlcjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gSVZhbGlkYXRpb25FdmVudEhhbmRsaW5nIGludGVyZmFjZQ0KICAgICAgICAgICAgI3JlZ2lvbiBJVmFsaWRhdGlvbkV2ZW50SGFuZGxpbmcgaW50ZXJmYWNlDQogICAgICAgICAgICBvYmplY3QgSVZhbGlkYXRpb25FdmVudEhhbmRsaW5nLkV2ZW50SGFuZGxlcg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGdldCB7IHJldHVybiBfZXZlbnRIYW5kbGVyOyB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZvaWQgSVZhbGlkYXRpb25FdmVudEhhbmRsaW5nLlNlbmRFdmVudChFeGNlcHRpb24gLypYbWxTY2hlbWFFeGNlcHRpb24qLyBleGNlcHRpb24sIFhtbFNldmVyaXR5VHlwZSBzZXZlcml0eSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX2V2ZW50SGFuZGxlciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX2V2ZW50SGFuZGxlcihfcmVhZGVyLCBuZXcgVmFsaWRhdGlvbkV2ZW50QXJncygoWG1sU2NoZW1hRXhjZXB0aW9uKWV4Y2VwdGlvbiwgc2V2ZXJpdHkpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoX3JlYWRlci5fdmFsaWRhdGlvblR5cGUgIT0gVmFsaWRhdGlvblR5cGUuTm9uZSAmJiBzZXZlcml0eSA9PSBYbWxTZXZlcml0eVR5cGUuRXJyb3IpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBleGNlcHRpb247DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgI2VuZHJlZ2lvbg0KDQogICAgICAgICAgICAvLyBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCBoZWxwZXIgbWV0aG9kcw0KICAgICAgICAgICAgaW50ZXJuYWwgdm9pZCBBZGRIYW5kbGVyKFZhbGlkYXRpb25FdmVudEhhbmRsZXIgaGFuZGxlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZXZlbnRIYW5kbGVyICs9IGhhbmRsZXI7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGludGVybmFsIHZvaWQgUmVtb3ZlSGFuZGxlcihWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIGhhbmRsZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2V2ZW50SGFuZGxlciAtPSBoYW5kbGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gRmllbGRzDQogICAgICAgIC8vDQogICAgICAgIC8vIGNvcmUgdGV4dCByZWFkZXINCiAgICAgICAgcHJpdmF0ZSBYbWxSZWFkZXIgX2NvcmVSZWFkZXI7DQogICAgICAgIHByaXZhdGUgWG1sVGV4dFJlYWRlckltcGwgX2NvcmVSZWFkZXJJbXBsOw0KICAgICAgICBwcml2YXRlIElYbWxOYW1lc3BhY2VSZXNvbHZlciBfY29yZVJlYWRlck5TUmVzb2x2ZXI7DQoNCiAgICAgICAgLy8gdmFsaWRhdGlvbg0KICAgICAgICBwcml2YXRlIFZhbGlkYXRpb25UeXBlIF92YWxpZGF0aW9uVHlwZTsNCiAgICAgICAgcHJpdmF0ZSBCYXNlVmFsaWRhdG9yIF92YWxpZGF0b3I7DQoNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDYxOA0KICAgICAgICBwcml2YXRlIFhtbFNjaGVtYUNvbGxlY3Rpb24gX3NjaGVtYUNvbGxlY3Rpb247DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSA2MTgNCiAgICAgICAgcHJpdmF0ZSBib29sIF9wcm9jZXNzSWRlbnRpdHlDb25zdHJhaW50czsNCg0KICAgICAgICAvLyBwYXJzaW5nIGZ1bmN0aW9uIChzdGF0ZSkNCiAgICAgICAgcHJpdmF0ZSBQYXJzaW5nRnVuY3Rpb24gX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5Jbml0Ow0KDQogICAgICAgIC8vIGV2ZW50IGhhbmRsaW5nDQogICAgICAgIHByaXZhdGUgVmFsaWRhdGlvbkV2ZW50SGFuZGxpbmcgX2V2ZW50SGFuZGxpbmc7DQoNCiAgICAgICAgLy8gbWlzYw0KICAgICAgICBwcml2YXRlIFhtbFBhcnNlckNvbnRleHQgX3BhcnNlckNvbnRleHQ7DQoNCiAgICAgICAgLy8gaGVscGVyIGZvciBSZWFkW0VsZW1lbnRdQ29udGVudEFze0Jhc2U2NCxCaW5IZXh9IG1ldGhvZHMNCiAgICAgICAgcHJpdmF0ZSBSZWFkQ29udGVudEFzQmluYXJ5SGVscGVyIF9yZWFkQmluYXJ5SGVscGVyOw0KDQogICAgICAgIC8vIE91dGVyIFhtbFJlYWRlciBleHBvc2VkIHRvIHRoZSB1c2VyIC0gZWl0aGVyIFhtbFZhbGlkYXRpbmdSZWFkZXIgb3IgWG1sVmFsaWRhdGluZ1JlYWRlckltcGwgKHdoZW4gY3JlYXRlZCB2aWEgWG1sUmVhZGVyLkNyZWF0ZSkuDQogICAgICAgIC8vIFZpcnR1YWwgbWV0aG9kcyBjYWxsZWQgZnJvbSB3aXRoaW4gWG1sVmFsaWRhdGluZ1JlYWRlckltcGwgbXVzdCBiZSBjYWxsZWQgb24gdGhlIG91dGVyIHJlYWRlciBzbyBpbiBjYXNlIHRoZSB1c2VyIG92ZXJyaWRlcw0KICAgICAgICAvLyBzb21lIG9mIHRoZSBYbWxWYWxpZGF0aW5nUmVhZGVyIG1ldGhvZHMgd2Ugd2lsbCBjYWxsIHRoZSBvdmVycmlkZW4gdmVyc2lvbi4NCiAgICAgICAgcHJpdmF0ZSBYbWxSZWFkZXIgX291dGVyUmVhZGVyOw0KDQogICAgICAgIC8vDQogICAgICAgIC8vIENvbnN0cnVjdG9ycw0KICAgICAgICAvLw0KICAgICAgICAvLyBJbml0aWFsaXplcyBhIG5ldyBpbnN0YW5jZSBvZiBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCBjbGFzcyB3aXRoIHRoZSBzcGVjaWZpZWQgWG1sUmVhZGVyLg0KICAgICAgICAvLyBUaGlzIGNvbnN0cnVjdG9yIGlzIHVzZWQgd2hlbiBjcmVhdGluZyBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCBmb3IgVjEgWG1sVmFsaWRhdGluZ1JlYWRlcg0KICAgICAgICBpbnRlcm5hbCBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbChYbWxSZWFkZXIgcmVhZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxBc3luY0NoZWNrUmVhZGVyIGFzeW5jQ2hlY2tSZWFkZXIgPSByZWFkZXIgYXMgWG1sQXN5bmNDaGVja1JlYWRlcjsNCiAgICAgICAgICAgIGlmIChhc3luY0NoZWNrUmVhZGVyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVhZGVyID0gYXN5bmNDaGVja1JlYWRlci5Db3JlUmVhZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dGVyUmVhZGVyID0gdGhpczsNCiAgICAgICAgICAgIF9jb3JlUmVhZGVyID0gcmVhZGVyOw0KICAgICAgICAgICAgX2NvcmVSZWFkZXJOU1Jlc29sdmVyID0gcmVhZGVyIGFzIElYbWxOYW1lc3BhY2VSZXNvbHZlcjsNCiAgICAgICAgICAgIF9jb3JlUmVhZGVySW1wbCA9IHJlYWRlciBhcyBYbWxUZXh0UmVhZGVySW1wbDsNCiAgICAgICAgICAgIGlmIChfY29yZVJlYWRlckltcGwgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxUZXh0UmVhZGVyIHRyID0gcmVhZGVyIGFzIFhtbFRleHRSZWFkZXI7DQogICAgICAgICAgICAgICAgaWYgKHRyICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfY29yZVJlYWRlckltcGwgPSB0ci5JbXBsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChfY29yZVJlYWRlckltcGwgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRFeGNlcHRpb24oU1IuQXJnX0V4cGVjdGluZ1htbFRleHRSZWFkZXIsIG5hbWVvZihyZWFkZXIpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9jb3JlUmVhZGVySW1wbC5FbnRpdHlIYW5kbGluZyA9IEVudGl0eUhhbmRsaW5nLkV4cGFuZEVudGl0aWVzOw0KICAgICAgICAgICAgX2NvcmVSZWFkZXJJbXBsLlhtbFZhbGlkYXRpbmdSZWFkZXJDb21wYXRpYmlsaXR5TW9kZSA9IHRydWU7DQogICAgICAgICAgICBfcHJvY2Vzc0lkZW50aXR5Q29uc3RyYWludHMgPSB0cnVlOw0KDQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSA2MTgNCiAgICAgICAgICAgIF9zY2hlbWFDb2xsZWN0aW9uID0gbmV3IFhtbFNjaGVtYUNvbGxlY3Rpb24oX2NvcmVSZWFkZXIuTmFtZVRhYmxlKTsNCiAgICAgICAgICAgIF9zY2hlbWFDb2xsZWN0aW9uLlhtbFJlc29sdmVyID0gR2V0UmVzb2x2ZXIoKTsNCg0KICAgICAgICAgICAgX2V2ZW50SGFuZGxpbmcgPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxpbmcodGhpcyk7DQogICAgICAgICAgICBfY29yZVJlYWRlckltcGwuVmFsaWRhdGlvbkV2ZW50SGFuZGxpbmcgPSBfZXZlbnRIYW5kbGluZzsNCiAgICAgICAgICAgIF9jb3JlUmVhZGVySW1wbC5PbkRlZmF1bHRBdHRyaWJ1dGVVc2UgPSBuZXcgWG1sVGV4dFJlYWRlckltcGwuT25EZWZhdWx0QXR0cmlidXRlVXNlRGVsZWdhdGUoVmFsaWRhdGVEZWZhdWx0QXR0cmlidXRlT25Vc2UpOw0KDQogICAgICAgICAgICBfdmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5BdXRvOw0KICAgICAgICAgICAgU2V0dXBWYWxpZGF0aW9uKFZhbGlkYXRpb25UeXBlLkF1dG8pOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgNjE4DQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIG9mIFhtbFZhbGlkYXRpbmdSZWFkZXJJbXBsIGNsYXNzIGZvciBwYXJzaW5nIGZyYWdtZW50cyB3aXRoIHRoZSBzcGVjaWZpZWQgc3RyaW5nLCBmcmFnbWVudCB0eXBlIGFuZCBwYXJzZXIgY29udGV4dA0KICAgICAgICAvLyBUaGlzIGNvbnN0cnVjdG9yIGlzIHVzZWQgd2hlbiBjcmVhdGluZyBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCBmb3IgVjEgWG1sVmFsaWRhdGluZ1JlYWRlcg0KICAgICAgICAvLyBTeFM6IFRoaXMgbWV0aG9kIHJlc29sdmVzIGFuIFVyaSBidXQgZG9lcyBub3QgZXhwb3NlIGl0IHRvIHRoZSBjYWxsZXIuIEl0J3MgT0sgdG8gc3VwcHJlc3MgdGhlIFN4UyB3YXJuaW5nLg0KICAgICAgICBpbnRlcm5hbCBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbChzdHJpbmcgeG1sRnJhZ21lbnQsIFhtbE5vZGVUeXBlIGZyYWdUeXBlLCBYbWxQYXJzZXJDb250ZXh0IGNvbnRleHQpDQogICAgICAgICAgICA6IHRoaXMobmV3IFhtbFRleHRSZWFkZXIoeG1sRnJhZ21lbnQsIGZyYWdUeXBlLCBjb250ZXh0KSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF9jb3JlUmVhZGVyLkJhc2VVUkkuTGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfdmFsaWRhdG9yLkJhc2VVcmkgPSBHZXRSZXNvbHZlcigpLlJlc29sdmVVcmkobnVsbCwgX2NvcmVSZWFkZXIuQmFzZVVSSSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChjb250ZXh0ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5QYXJzZUR0ZEZyb21Db250ZXh0Ow0KICAgICAgICAgICAgICAgIF9wYXJzZXJDb250ZXh0ID0gY29udGV4dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIG9mIFhtbFZhbGlkYXRpbmdSZWFkZXJJbXBsIGNsYXNzIGZvciBwYXJzaW5nIGZyYWdtZW50cyB3aXRoIHRoZSBzcGVjaWZpZWQgc3RyZWFtLCBmcmFnbWVudCB0eXBlIGFuZCBwYXJzZXIgY29udGV4dA0KICAgICAgICAvLyBUaGlzIGNvbnN0cnVjdG9yIGlzIHVzZWQgd2hlbiBjcmVhdGluZyBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCBmb3IgVjEgWG1sVmFsaWRhdGluZ1JlYWRlcg0KICAgICAgICAvLyBTeFM6IFRoaXMgbWV0aG9kIHJlc29sdmVzIGFuIFVyaSBidXQgZG9lcyBub3QgZXhwb3NlIGl0IHRvIHRoZSBjYWxsZXIuIEl0J3MgT0sgdG8gc3VwcHJlc3MgdGhlIFN4UyB3YXJuaW5nLg0KICAgICAgICBpbnRlcm5hbCBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbChTdHJlYW0geG1sRnJhZ21lbnQsIFhtbE5vZGVUeXBlIGZyYWdUeXBlLCBYbWxQYXJzZXJDb250ZXh0IGNvbnRleHQpDQogICAgICAgICAgICA6IHRoaXMobmV3IFhtbFRleHRSZWFkZXIoeG1sRnJhZ21lbnQsIGZyYWdUeXBlLCBjb250ZXh0KSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF9jb3JlUmVhZGVyLkJhc2VVUkkuTGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfdmFsaWRhdG9yLkJhc2VVcmkgPSBHZXRSZXNvbHZlcigpLlJlc29sdmVVcmkobnVsbCwgX2NvcmVSZWFkZXIuQmFzZVVSSSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChjb250ZXh0ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5QYXJzZUR0ZEZyb21Db250ZXh0Ow0KICAgICAgICAgICAgICAgIF9wYXJzZXJDb250ZXh0ID0gY29udGV4dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIG9mIFhtbFZhbGlkYXRpbmdSZWFkZXJJbXBsIGNsYXNzIHdpdGggdGhlIHNwZWNpZmllZCBhcmd1bWVudHMuDQogICAgICAgIC8vIFRoaXMgY29uc3RydWN0b3IgaXMgdXNlZCB3aGVuIGNyZWF0aW5nIFhtbFZhbGlkYXRpbmdSZWFkZXJJbXBsIHJlYWRlciB2aWEgIlhtbFJlYWRlci5DcmVhdGUoLi4pIg0KICAgICAgICBpbnRlcm5hbCBYbWxWYWxpZGF0aW5nUmVhZGVySW1wbChYbWxSZWFkZXIgcmVhZGVyLCBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIHNldHRpbmdzRXZlbnRIYW5kbGVyLCBib29sIHByb2Nlc3NJZGVudGl0eUNvbnN0cmFpbnRzKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxBc3luY0NoZWNrUmVhZGVyIGFzeW5jQ2hlY2tSZWFkZXIgPSByZWFkZXIgYXMgWG1sQXN5bmNDaGVja1JlYWRlcjsNCiAgICAgICAgICAgIGlmIChhc3luY0NoZWNrUmVhZGVyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVhZGVyID0gYXN5bmNDaGVja1JlYWRlci5Db3JlUmVhZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dGVyUmVhZGVyID0gdGhpczsNCiAgICAgICAgICAgIF9jb3JlUmVhZGVyID0gcmVhZGVyOw0KICAgICAgICAgICAgX2NvcmVSZWFkZXJJbXBsID0gcmVhZGVyIGFzIFhtbFRleHRSZWFkZXJJbXBsOw0KICAgICAgICAgICAgaWYgKF9jb3JlUmVhZGVySW1wbCA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgdHIgPSByZWFkZXIgYXMgWG1sVGV4dFJlYWRlcjsNCiAgICAgICAgICAgICAgICBpZiAodHIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9jb3JlUmVhZGVySW1wbCA9IHRyLkltcGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKF9jb3JlUmVhZGVySW1wbCA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudEV4Y2VwdGlvbihTUi5BcmdfRXhwZWN0aW5nWG1sVGV4dFJlYWRlciwgbmFtZW9mKHJlYWRlcikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX2NvcmVSZWFkZXJJbXBsLlhtbFZhbGlkYXRpbmdSZWFkZXJDb21wYXRpYmlsaXR5TW9kZSA9IHRydWU7DQogICAgICAgICAgICBfY29yZVJlYWRlck5TUmVzb2x2ZXIgPSByZWFkZXIgYXMgSVhtbE5hbWVzcGFjZVJlc29sdmVyOw0KICAgICAgICAgICAgX3Byb2Nlc3NJZGVudGl0eUNvbnN0cmFpbnRzID0gcHJvY2Vzc0lkZW50aXR5Q29uc3RyYWludHM7DQoNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDYxOA0KDQogICAgICAgICAgICBfc2NoZW1hQ29sbGVjdGlvbiA9IG5ldyBYbWxTY2hlbWFDb2xsZWN0aW9uKF9jb3JlUmVhZGVyLk5hbWVUYWJsZSk7DQoNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDYxOA0KDQogICAgICAgICAgICBfc2NoZW1hQ29sbGVjdGlvbi5YbWxSZXNvbHZlciA9IEdldFJlc29sdmVyKCk7DQoNCiAgICAgICAgICAgIF9ldmVudEhhbmRsaW5nID0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsaW5nKHRoaXMpOw0KICAgICAgICAgICAgaWYgKHNldHRpbmdzRXZlbnRIYW5kbGVyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2V2ZW50SGFuZGxpbmcuQWRkSGFuZGxlcihzZXR0aW5nc0V2ZW50SGFuZGxlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfY29yZVJlYWRlckltcGwuVmFsaWRhdGlvbkV2ZW50SGFuZGxpbmcgPSBfZXZlbnRIYW5kbGluZzsNCiAgICAgICAgICAgIF9jb3JlUmVhZGVySW1wbC5PbkRlZmF1bHRBdHRyaWJ1dGVVc2UgPSBuZXcgWG1sVGV4dFJlYWRlckltcGwuT25EZWZhdWx0QXR0cmlidXRlVXNlRGVsZWdhdGUoVmFsaWRhdGVEZWZhdWx0QXR0cmlidXRlT25Vc2UpOw0KDQogICAgICAgICAgICBfdmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5EVEQ7DQogICAgICAgICAgICBTZXR1cFZhbGlkYXRpb24oVmFsaWRhdGlvblR5cGUuRFREKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFhtbFJlYWRlciBtZW1iZXJzDQogICAgICAgIC8vDQogICAgICAgIC8vIFJldHVybnMgdGhlIGN1cnJlbnQgc2V0dGluZ3Mgb2YgdGhlIHJlYWRlcg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgWG1sUmVhZGVyU2V0dGluZ3MgU2V0dGluZ3MNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sUmVhZGVyU2V0dGluZ3Mgc2V0dGluZ3M7DQogICAgICAgICAgICAgICAgaWYgKF9jb3JlUmVhZGVySW1wbC5WMUNvbXBhdCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBfY29yZVJlYWRlci5TZXR0aW5nczsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHNldHRpbmdzLkNsb25lKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNldHRpbmdzLlZhbGlkYXRpb25UeXBlID0gVmFsaWRhdGlvblR5cGUuRFREOw0KICAgICAgICAgICAgICAgIGlmICghX3Byb2Nlc3NJZGVudGl0eUNvbnN0cmFpbnRzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuVmFsaWRhdGlvbkZsYWdzICY9IH5YbWxTY2hlbWFWYWxpZGF0aW9uRmxhZ3MuUHJvY2Vzc0lkZW50aXR5Q29uc3RyYWludHM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNldHRpbmdzLlJlYWRPbmx5ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3M7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSB0eXBlIG9mIHRoZSBjdXJyZW50IG5vZGUuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBYbWxOb2RlVHlwZSBOb2RlVHlwZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXIuTm9kZVR5cGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSBuYW1lIG9mIHRoZSBjdXJyZW50IG5vZGUsIGluY2x1ZGluZyBwcmVmaXguDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgTmFtZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXIuTmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgbG9jYWwgbmFtZSBvZiB0aGUgY3VycmVudCBub2RlICh3aXRob3V0IHByZWZpeCkNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBMb2NhbE5hbWUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVyLkxvY2FsTmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgbmFtZXNwYWNlIG5hbWUgb2YgdGhlIGN1cnJlbnQgbm9kZS4NCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBOYW1lc3BhY2VVUkkNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVyLk5hbWVzcGFjZVVSSTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgcHJlZml4IGFzc29jaWF0ZWQgd2l0aCB0aGUgY3VycmVudCBub2RlLg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgc3RyaW5nIFByZWZpeA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXIuUHJlZml4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB0cnVlIGlmIHRoZSBjdXJyZW50IG5vZGUgY2FuIGhhdmUgVmFsdWUgcHJvcGVydHkgIT0gc3RyaW5nLkVtcHR5Lg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBIYXNWYWx1ZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXIuSGFzVmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSB0ZXh0IHZhbHVlIG9mIHRoZSBjdXJyZW50IG5vZGUuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgVmFsdWUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVyLlZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB0aGUgZGVwdGggb2YgdGhlIGN1cnJlbnQgbm9kZSBpbiB0aGUgWE1MIGVsZW1lbnQgc3RhY2sNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGludCBEZXB0aA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXIuRGVwdGg7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSBiYXNlIFVSSSBvZiB0aGUgY3VycmVudCBub2RlLg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgc3RyaW5nIEJhc2VVUkkNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVyLkJhc2VVUkk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRydWUgaWYgdGhlIGN1cnJlbnQgbm9kZSBpcyBhbiBlbXB0eSBlbGVtZW50IChmb3IgZXhhbXBsZSwgPE15RWxlbWVudC8+KS4NCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgSXNFbXB0eUVsZW1lbnQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVyLklzRW1wdHlFbGVtZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB0cnVlIG9mIHRoZSBjdXJyZW50IG5vZGUgaXMgYSBkZWZhdWx0IGF0dHJpYnV0ZSBkZWNsYXJlZCBpbiBEVEQuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIElzRGVmYXVsdA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXIuSXNEZWZhdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB0aGUgcXVvdGUgY2hhcmFjdGVyIHVzZWQgaW4gdGhlIGN1cnJlbnQgYXR0cmlidXRlIGRlY2xhcmF0aW9uDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBjaGFyIFF1b3RlQ2hhcg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXIuUXVvdGVDaGFyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB0aGUgY3VycmVudCB4bWw6c3BhY2Ugc2NvcGUuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBYbWxTcGFjZSBYbWxTcGFjZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXIuWG1sU3BhY2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSBjdXJyZW50IHhtbDpsYW5nIHNjb3BlLjwvcGFyYT4NCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBYbWxMYW5nDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlci5YbWxMYW5nOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB0aGUgY3VycmVudCByZWFkIHN0YXRlIG9mIHRoZSByZWFkZXINCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFJlYWRTdGF0ZSBSZWFkU3RhdGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIChfcGFyc2luZ0Z1bmN0aW9uID09IFBhcnNpbmdGdW5jdGlvbi5Jbml0KSA/IFJlYWRTdGF0ZS5Jbml0aWFsIDogX2NvcmVSZWFkZXIuUmVhZFN0YXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB0cnVlIGlmIHRoZSByZWFkZXIgcmVhY2hlZCBlbmQgb2YgdGhlIGlucHV0IGRhdGENCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgRU9GDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlci5FT0Y7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSBYbWxOYW1lVGFibGUgYXNzb2NpYXRlZCB3aXRoIHRoaXMgWG1sUmVhZGVyDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBYbWxOYW1lVGFibGUgTmFtZVRhYmxlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlci5OYW1lVGFibGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIGVuY29kaW5nIG9mIHRoZSBYTUwgZG9jdW1lbnQNCiAgICAgICAgaW50ZXJuYWwgRW5jb2RpbmcgRW5jb2RpbmcNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVySW1wbC5FbmNvZGluZzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBhdHRyaWJ1dGVzIG9uIHRoZSBjdXJyZW50IG5vZGUuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgQXR0cmlidXRlQ291bnQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVyLkF0dHJpYnV0ZUNvdW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUgd2l0aCB0aGUgc3BlY2lmaWVkIE5hbWUNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBHZXRBdHRyaWJ1dGUoc3RyaW5nIG5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlci5HZXRBdHRyaWJ1dGUobmFtZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZSB3aXRoIHRoZSBzcGVjaWZpZWQgTG9jYWxOYW1lIGFuZCBOYW1lc3BhY2VVUkkNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBHZXRBdHRyaWJ1dGUoc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVyLkdldEF0dHJpYnV0ZShsb2NhbE5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IChwb3NpdGlvbikNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBHZXRBdHRyaWJ1dGUoaW50IGkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlci5HZXRBdHRyaWJ1dGUoaSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBNb3ZlcyB0byBhbiBhdHRyaWJ1dGUgd2l0aCB0aGUgc3BlY2lmaWVkIE5hbWUNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgTW92ZVRvQXR0cmlidXRlKHN0cmluZyBuYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIV9jb3JlUmVhZGVyLk1vdmVUb0F0dHJpYnV0ZShuYW1lKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfcGFyc2luZ0Z1bmN0aW9uID0gUGFyc2luZ0Z1bmN0aW9uLlJlYWQ7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE1vdmVzIHRvIGFuIGF0dHJpYnV0ZSB3aXRoIHRoZSBzcGVjaWZpZWQgTG9jYWxOYW1lIGFuZCBOYW1lc3BjZVVSSQ0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBNb3ZlVG9BdHRyaWJ1dGUoc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFfY29yZVJlYWRlci5Nb3ZlVG9BdHRyaWJ1dGUobG9jYWxOYW1lLCBuYW1lc3BhY2VVUkkpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9wYXJzaW5nRnVuY3Rpb24gPSBQYXJzaW5nRnVuY3Rpb24uUmVhZDsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTW92ZXMgdG8gYW4gYXR0cmlidXRlIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXggKHBvc2l0aW9uKQ0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBNb3ZlVG9BdHRyaWJ1dGUoaW50IGkpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9jb3JlUmVhZGVyLk1vdmVUb0F0dHJpYnV0ZShpKTsNCiAgICAgICAgICAgIF9wYXJzaW5nRnVuY3Rpb24gPSBQYXJzaW5nRnVuY3Rpb24uUmVhZDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE1vdmVzIHRvIHRoZSBmaXJzdCBhdHRyaWJ1dGUgb2YgdGhlIGN1cnJlbnQgbm9kZQ0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBNb3ZlVG9GaXJzdEF0dHJpYnV0ZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghX2NvcmVSZWFkZXIuTW92ZVRvRmlyc3RBdHRyaWJ1dGUoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfcGFyc2luZ0Z1bmN0aW9uID0gUGFyc2luZ0Z1bmN0aW9uLlJlYWQ7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE1vdmVzIHRvIHRoZSBuZXh0IGF0dHJpYnV0ZSBvZiB0aGUgY3VycmVudCBub2RlDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIE1vdmVUb05leHRBdHRyaWJ1dGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIV9jb3JlUmVhZGVyLk1vdmVUb05leHRBdHRyaWJ1dGUoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfcGFyc2luZ0Z1bmN0aW9uID0gUGFyc2luZ0Z1bmN0aW9uLlJlYWQ7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIElmIG9uIGF0dHJpYnV0ZSwgbW92ZXMgdG8gdGhlIGVsZW1lbnQgdGhhdCBjb250YWlucyB0aGUgYXR0cmlidXRlIG5vZGUNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgTW92ZVRvRWxlbWVudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghX2NvcmVSZWFkZXIuTW92ZVRvRWxlbWVudCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9wYXJzaW5nRnVuY3Rpb24gPSBQYXJzaW5nRnVuY3Rpb24uUmVhZDsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmVhZHMgYW5kIHZhbGlkYXRlZCBuZXh0IG5vZGUgZnJvbSB0aGUgaW5wdXQgZGF0YQ0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBSZWFkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3dpdGNoIChfcGFyc2luZ0Z1bmN0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgUGFyc2luZ0Z1bmN0aW9uLlJlYWQ6DQogICAgICAgICAgICAgICAgICAgIGlmIChfY29yZVJlYWRlci5SZWFkKCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFByb2Nlc3NDb3JlUmVhZGVyRXZlbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRvci5Db21wbGV0ZVZhbGlkYXRpb24oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhc2UgUGFyc2luZ0Z1bmN0aW9uLlBhcnNlRHRkRnJvbUNvbnRleHQ6DQogICAgICAgICAgICAgICAgICAgIF9wYXJzaW5nRnVuY3Rpb24gPSBQYXJzaW5nRnVuY3Rpb24uUmVhZDsNCiAgICAgICAgICAgICAgICAgICAgUGFyc2VEdGRGcm9tUGFyc2VyQ29udGV4dCgpOw0KICAgICAgICAgICAgICAgICAgICBnb3RvIGNhc2UgUGFyc2luZ0Z1bmN0aW9uLlJlYWQ7DQogICAgICAgICAgICAgICAgY2FzZSBQYXJzaW5nRnVuY3Rpb24uRXJyb3I6DQogICAgICAgICAgICAgICAgY2FzZSBQYXJzaW5nRnVuY3Rpb24uUmVhZGVyQ2xvc2VkOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgY2FzZSBQYXJzaW5nRnVuY3Rpb24uSW5pdDoNCiAgICAgICAgICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5SZWFkOyAvLyB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlIHJldHVybmVkIGJ5IFJlYWRTdGF0ZQ0KICAgICAgICAgICAgICAgICAgICBpZiAoX2NvcmVSZWFkZXIuUmVhZFN0YXRlID09IFJlYWRTdGF0ZS5JbnRlcmFjdGl2ZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgUHJvY2Vzc0NvcmVSZWFkZXJFdmVudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGNhc2UgUGFyc2luZ0Z1bmN0aW9uLlJlYWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXNlIFBhcnNpbmdGdW5jdGlvbi5SZXNvbHZlRW50aXR5SW50ZXJuYWxseToNCiAgICAgICAgICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5SZWFkOw0KICAgICAgICAgICAgICAgICAgICBSZXNvbHZlRW50aXR5SW50ZXJuYWxseSgpOw0KICAgICAgICAgICAgICAgICAgICBnb3RvIGNhc2UgUGFyc2luZ0Z1bmN0aW9uLlJlYWQ7DQogICAgICAgICAgICAgICAgY2FzZSBQYXJzaW5nRnVuY3Rpb24uSW5SZWFkQmluYXJ5Q29udGVudDoNCiAgICAgICAgICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5SZWFkOw0KICAgICAgICAgICAgICAgICAgICBfcmVhZEJpbmFyeUhlbHBlci5GaW5pc2goKTsNCiAgICAgICAgICAgICAgICAgICAgZ290byBjYXNlIFBhcnNpbmdGdW5jdGlvbi5SZWFkOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIERlYnVnLkFzc2VydChmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENsb3NlcyB0aGUgaW5wdXQgc3RyZWFtIG90IFRleHRSZWFkZXIsIGNoYW5nZXMgdGhlIFJlYWRTdGF0ZSB0byBDbG9zZWQgYW5kIHNldHMgYWxsIHByb3BlcnRpZXMgdG8gemVyby9zdHJpbmcuRW1wdHkNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgQ2xvc2UoKQ0KICAgICAgICB7DQogICAgICAgICAgICBfY29yZVJlYWRlci5DbG9zZSgpOw0KICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5SZWFkZXJDbG9zZWQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIE5hbWVzcGFjZVVSSSBhc3NvY2lhdGVkIHdpdGggdGhlIHNwZWNpZmllZCBwcmVmaXggaW4gdGhlIGN1cnJlbnQgbmFtZXNwYWNlIHNjb3BlLg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgU3RyaW5nIExvb2t1cE5hbWVzcGFjZShTdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXJJbXBsLkxvb2t1cE5hbWVzcGFjZShwcmVmaXgpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gSXRlcmF0ZXMgdGhyb3VnaCB0aGUgY3VycmVudCBhdHRyaWJ1dGUgdmFsdWUncyB0ZXh0IGFuZCBlbnRpdHkgcmVmZXJlbmNlcyBjaHVua3MuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIFJlYWRBdHRyaWJ1dGVWYWx1ZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChfcGFyc2luZ0Z1bmN0aW9uID09IFBhcnNpbmdGdW5jdGlvbi5JblJlYWRCaW5hcnlDb250ZW50KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9wYXJzaW5nRnVuY3Rpb24gPSBQYXJzaW5nRnVuY3Rpb24uUmVhZDsNCiAgICAgICAgICAgICAgICBfcmVhZEJpbmFyeUhlbHBlci5GaW5pc2goKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghX2NvcmVSZWFkZXIuUmVhZEF0dHJpYnV0ZVZhbHVlKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5SZWFkOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBDYW5SZWFkQmluYXJ5Q29udGVudA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgUmVhZENvbnRlbnRBc0Jhc2U2NChieXRlW10gYnVmZmVyLCBpbnQgaW5kZXgsIGludCBjb3VudCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFJlYWRTdGF0ZSAhPSBSZWFkU3RhdGUuSW50ZXJhY3RpdmUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIGluaXQgUmVhZENodW5rSGVscGVyIGlmIGNhbGxlZCB0aGUgZmlyc3QgdGltZQ0KICAgICAgICAgICAgaWYgKF9wYXJzaW5nRnVuY3Rpb24gIT0gUGFyc2luZ0Z1bmN0aW9uLkluUmVhZEJpbmFyeUNvbnRlbnQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3JlYWRCaW5hcnlIZWxwZXIgPSBSZWFkQ29udGVudEFzQmluYXJ5SGVscGVyLkNyZWF0ZU9yUmVzZXQoX3JlYWRCaW5hcnlIZWxwZXIsIF9vdXRlclJlYWRlcik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIHNldCBwYXJzaW5nRnVuY3Rpb24gdG8gUmVhZCBzdGF0ZSBpbiBvcmRlciB0byBoYXZlIGEgbm9ybWFsIFJlYWQoKSBiZWhhdmlvciB3aGVuIGNhbGxlZCBmcm9tIHJlYWRCaW5hcnlIZWxwZXINCiAgICAgICAgICAgIF9wYXJzaW5nRnVuY3Rpb24gPSBQYXJzaW5nRnVuY3Rpb24uUmVhZDsNCg0KICAgICAgICAgICAgLy8gY2FsbCB0byB0aGUgaGVscGVyDQogICAgICAgICAgICBpbnQgcmVhZENvdW50ID0gX3JlYWRCaW5hcnlIZWxwZXIuUmVhZENvbnRlbnRBc0Jhc2U2NChidWZmZXIsIGluZGV4LCBjb3VudCk7DQoNCiAgICAgICAgICAgIC8vIHNldHVwIHBhcnNpbmdGdW5jdGlvbiANCiAgICAgICAgICAgIF9wYXJzaW5nRnVuY3Rpb24gPSBQYXJzaW5nRnVuY3Rpb24uSW5SZWFkQmluYXJ5Q29udGVudDsNCiAgICAgICAgICAgIHJldHVybiByZWFkQ291bnQ7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgaW50IFJlYWRDb250ZW50QXNCaW5IZXgoYnl0ZVtdIGJ1ZmZlciwgaW50IGluZGV4LCBpbnQgY291bnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChSZWFkU3RhdGUgIT0gUmVhZFN0YXRlLkludGVyYWN0aXZlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBpbml0IFJlYWRDaHVua0hlbHBlciB3aGVuIGNhbGxlZCBmaXJzdCB0aW1lDQogICAgICAgICAgICBpZiAoX3BhcnNpbmdGdW5jdGlvbiAhPSBQYXJzaW5nRnVuY3Rpb24uSW5SZWFkQmluYXJ5Q29udGVudCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfcmVhZEJpbmFyeUhlbHBlciA9IFJlYWRDb250ZW50QXNCaW5hcnlIZWxwZXIuQ3JlYXRlT3JSZXNldChfcmVhZEJpbmFyeUhlbHBlciwgX291dGVyUmVhZGVyKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gc2V0IHBhcnNpbmdGdW5jdGlvbiB0byBSZWFkIHN0YXRlIGluIG9yZGVyIHRvIGhhdmUgYSBub3JtYWwgUmVhZCgpIGJlaGF2aW9yIHdoZW4gY2FsbGVkIGZyb20gcmVhZEJpbmFyeUhlbHBlcg0KICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5SZWFkOw0KDQogICAgICAgICAgICAvLyBjYWxsIHRvIHRoZSBoZWxwZXINCiAgICAgICAgICAgIGludCByZWFkQ291bnQgPSBfcmVhZEJpbmFyeUhlbHBlci5SZWFkQ29udGVudEFzQmluSGV4KGJ1ZmZlciwgaW5kZXgsIGNvdW50KTsNCg0KICAgICAgICAgICAgLy8gc2V0dXAgcGFyc2luZ0Z1bmN0aW9uIA0KICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5JblJlYWRCaW5hcnlDb250ZW50Ow0KICAgICAgICAgICAgcmV0dXJuIHJlYWRDb3VudDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgUmVhZEVsZW1lbnRDb250ZW50QXNCYXNlNjQoYnl0ZVtdIGJ1ZmZlciwgaW50IGluZGV4LCBpbnQgY291bnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChSZWFkU3RhdGUgIT0gUmVhZFN0YXRlLkludGVyYWN0aXZlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBpbml0IFJlYWRDaHVua0hlbHBlciBpZiBjYWxsZWQgdGhlIGZpcnN0IHRpbWUNCiAgICAgICAgICAgIGlmIChfcGFyc2luZ0Z1bmN0aW9uICE9IFBhcnNpbmdGdW5jdGlvbi5JblJlYWRCaW5hcnlDb250ZW50KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9yZWFkQmluYXJ5SGVscGVyID0gUmVhZENvbnRlbnRBc0JpbmFyeUhlbHBlci5DcmVhdGVPclJlc2V0KF9yZWFkQmluYXJ5SGVscGVyLCBfb3V0ZXJSZWFkZXIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBzZXQgcGFyc2luZ0Z1bmN0aW9uIHRvIFJlYWQgc3RhdGUgaW4gb3JkZXIgdG8gaGF2ZSBhIG5vcm1hbCBSZWFkKCkgYmVoYXZpb3Igd2hlbiBjYWxsZWQgZnJvbSByZWFkQmluYXJ5SGVscGVyDQogICAgICAgICAgICBfcGFyc2luZ0Z1bmN0aW9uID0gUGFyc2luZ0Z1bmN0aW9uLlJlYWQ7DQoNCiAgICAgICAgICAgIC8vIGNhbGwgdG8gdGhlIGhlbHBlcg0KICAgICAgICAgICAgaW50IHJlYWRDb3VudCA9IF9yZWFkQmluYXJ5SGVscGVyLlJlYWRFbGVtZW50Q29udGVudEFzQmFzZTY0KGJ1ZmZlciwgaW5kZXgsIGNvdW50KTsNCg0KICAgICAgICAgICAgLy8gc2V0dXAgcGFyc2luZ0Z1bmN0aW9uIA0KICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5JblJlYWRCaW5hcnlDb250ZW50Ow0KICAgICAgICAgICAgcmV0dXJuIHJlYWRDb3VudDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgUmVhZEVsZW1lbnRDb250ZW50QXNCaW5IZXgoYnl0ZVtdIGJ1ZmZlciwgaW50IGluZGV4LCBpbnQgY291bnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChSZWFkU3RhdGUgIT0gUmVhZFN0YXRlLkludGVyYWN0aXZlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBpbml0IFJlYWRDaHVua0hlbHBlciB3aGVuIGNhbGxlZCBmaXJzdCB0aW1lDQogICAgICAgICAgICBpZiAoX3BhcnNpbmdGdW5jdGlvbiAhPSBQYXJzaW5nRnVuY3Rpb24uSW5SZWFkQmluYXJ5Q29udGVudCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfcmVhZEJpbmFyeUhlbHBlciA9IFJlYWRDb250ZW50QXNCaW5hcnlIZWxwZXIuQ3JlYXRlT3JSZXNldChfcmVhZEJpbmFyeUhlbHBlciwgX291dGVyUmVhZGVyKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gc2V0IHBhcnNpbmdGdW5jdGlvbiB0byBSZWFkIHN0YXRlIGluIG9yZGVyIHRvIGhhdmUgYSBub3JtYWwgUmVhZCgpIGJlaGF2aW9yIHdoZW4gY2FsbGVkIGZyb20gcmVhZEJpbmFyeUhlbHBlcg0KICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5SZWFkOw0KDQogICAgICAgICAgICAvLyBjYWxsIHRvIHRoZSBoZWxwZXINCiAgICAgICAgICAgIGludCByZWFkQ291bnQgPSBfcmVhZEJpbmFyeUhlbHBlci5SZWFkRWxlbWVudENvbnRlbnRBc0JpbkhleChidWZmZXIsIGluZGV4LCBjb3VudCk7DQoNCiAgICAgICAgICAgIC8vIHNldHVwIHBhcnNpbmdGdW5jdGlvbiANCiAgICAgICAgICAgIF9wYXJzaW5nRnVuY3Rpb24gPSBQYXJzaW5nRnVuY3Rpb24uSW5SZWFkQmluYXJ5Q29udGVudDsNCiAgICAgICAgICAgIHJldHVybiByZWFkQ291bnQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRydWUgaWYgdGhlIFhtbFJlYWRlciBrbm93cyBob3cgdG8gcmVzb2x2ZSBnZW5lcmFsIGVudGl0aWVzDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIENhblJlc29sdmVFbnRpdHkNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXNvbHZlcyB0aGUgY3VycmVudCBlbnRpdHkgcmVmZXJlbmNlIG5vZGUNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgUmVzb2x2ZUVudGl0eSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChfcGFyc2luZ0Z1bmN0aW9uID09IFBhcnNpbmdGdW5jdGlvbi5SZXNvbHZlRW50aXR5SW50ZXJuYWxseSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfcGFyc2luZ0Z1bmN0aW9uID0gUGFyc2luZ0Z1bmN0aW9uLlJlYWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfY29yZVJlYWRlci5SZXNvbHZlRW50aXR5KCk7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxSZWFkZXIgT3V0ZXJSZWFkZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9vdXRlclJlYWRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldA0KICAgICAgICAgICAgew0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgNjE4DQogICAgICAgICAgICAgICAgRGVidWcuQXNzZXJ0KHZhbHVlIGlzIFhtbFZhbGlkYXRpbmdSZWFkZXIpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgNjE4DQogICAgICAgICAgICAgICAgX291dGVyUmVhZGVyID0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCB2b2lkIE1vdmVPZmZFbnRpdHlSZWZlcmVuY2UoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX291dGVyUmVhZGVyLk5vZGVUeXBlID09IFhtbE5vZGVUeXBlLkVudGl0eVJlZmVyZW5jZSAmJiBfcGFyc2luZ0Z1bmN0aW9uICE9IFBhcnNpbmdGdW5jdGlvbi5SZXNvbHZlRW50aXR5SW50ZXJuYWxseSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIV9vdXRlclJlYWRlci5SZWFkKCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YbWxfSW52YWxpZE9wZXJhdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBSZWFkU3RyaW5nKCkNCiAgICAgICAgew0KICAgICAgICAgICAgTW92ZU9mZkVudGl0eVJlZmVyZW5jZSgpOw0KICAgICAgICAgICAgcmV0dXJuIGJhc2UuUmVhZFN0cmluZygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gSVhtbExpbmVJbmZvIG1lbWJlcnMNCiAgICAgICAgLy8NCiAgICAgICAgcHVibGljIGJvb2wgSGFzTGluZUluZm8oKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgdGhlIGxpbmUgbnVtYmVyIG9mIHRoZSBjdXJyZW50IG5vZGUNCiAgICAgICAgcHVibGljIGludCBMaW5lTnVtYmVyDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiAoKElYbWxMaW5lSW5mbylfY29yZVJlYWRlcikuTGluZU51bWJlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgdGhlIGxpbmUgbnVtYmVyIG9mIHRoZSBjdXJyZW50IG5vZGUNCiAgICAgICAgcHVibGljIGludCBMaW5lUG9zaXRpb24NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuICgoSVhtbExpbmVJbmZvKV9jb3JlUmVhZGVyKS5MaW5lUG9zaXRpb247DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBJWG1sTmFtZXNwYWNlUmVzb2x2ZXIgbWVtYmVycw0KICAgICAgICAvLw0KICAgICAgICBJRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gSVhtbE5hbWVzcGFjZVJlc29sdmVyLkdldE5hbWVzcGFjZXNJblNjb3BlKFhtbE5hbWVzcGFjZVNjb3BlIHNjb3BlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXROYW1lc3BhY2VzSW5TY29wZShzY29wZSk7DQogICAgICAgIH0NCg0KICAgICAgICBzdHJpbmcgSVhtbE5hbWVzcGFjZVJlc29sdmVyLkxvb2t1cE5hbWVzcGFjZShzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5Mb29rdXBOYW1lc3BhY2UocHJlZml4KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHN0cmluZyBJWG1sTmFtZXNwYWNlUmVzb2x2ZXIuTG9va3VwUHJlZml4KHN0cmluZyBuYW1lc3BhY2VOYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5Mb29rdXBQcmVmaXgobmFtZXNwYWNlTmFtZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBJbnRlcm5hbCBJWG1sTmFtZXNwYWNlUmVzb2x2ZXIgbWV0aG9kcw0KICAgICAgICBpbnRlcm5hbCBJRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gR2V0TmFtZXNwYWNlc0luU2NvcGUoWG1sTmFtZXNwYWNlU2NvcGUgc2NvcGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlck5TUmVzb2x2ZXIuR2V0TmFtZXNwYWNlc0luU2NvcGUoc2NvcGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgc3RyaW5nIExvb2t1cFByZWZpeChzdHJpbmcgbmFtZXNwYWNlTmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVyTlNSZXNvbHZlci5Mb29rdXBQcmVmaXgobmFtZXNwYWNlTmFtZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBYbWxWYWxpZGF0aW5nUmVhZGVyIG1lbWJlcnMNCiAgICAgICAgLy8NCiAgICAgICAgLy8gU3BlY3VmaWVzIHRoZSB2YWxpZGF0aW9uIGV2ZW50IGhhbmRsZXIgdGhhdCB3aWwgZ2V0IHdhcm5pbmdzIGFuZCBlcnJvcnMgcmVsYXRlZCB0byB2YWxpZGF0aW9uDQogICAgICAgIGludGVybmFsIGV2ZW50IFZhbGlkYXRpb25FdmVudEhhbmRsZXIgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcg0KICAgICAgICB7DQogICAgICAgICAgICBhZGQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZXZlbnRIYW5kbGluZy5BZGRIYW5kbGVyKHZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJlbW92ZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9ldmVudEhhbmRsaW5nLlJlbW92ZUhhbmRsZXIodmFsdWUpOyA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyByZXR1cm5zIHRoZSBzY2hlbWEgdHlwZSBvZiB0aGUgY3VycmVudCBub2RlDQogICAgICAgIGludGVybmFsIG9iamVjdCBTY2hlbWFUeXBlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfdmFsaWRhdGlvblR5cGUgIT0gVmFsaWRhdGlvblR5cGUuTm9uZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVR5cGUgc2NoZW1hVHlwZU9iaiA9IF9jb3JlUmVhZGVySW1wbC5JbnRlcm5hbFNjaGVtYVR5cGUgYXMgWG1sU2NoZW1hVHlwZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGVPYmogIT0gbnVsbCAmJiBzY2hlbWFUeXBlT2JqLlF1YWxpZmllZE5hbWUuTmFtZXNwYWNlID09IFhtbFJlc2VydmVkTnMuTnNYcykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjaGVtYVR5cGVPYmouRGF0YXR5cGU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVySW1wbC5JbnRlcm5hbFNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyByZXR1cm5zIHRoZSB1bmRlcmx5aW5nIFhtbFRleHRSZWFkZXIgb3IgWG1sVGV4dFJlYWRlckltcGwNCiAgICAgICAgaW50ZXJuYWwgWG1sUmVhZGVyIFJlYWRlcg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKFhtbFJlYWRlcilfY29yZVJlYWRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHJldHVybnMgdGhlIHVuZGVybHlpbmcgWG1sVGV4dFJlYWRlckltcGwNCiAgICAgICAgaW50ZXJuYWwgWG1sVGV4dFJlYWRlckltcGwgUmVhZGVySW1wbA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXJJbXBsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gc3BlY2lmaWVzIHRoZSB2YWxpZGF0aW9uIHR5cGUgKE5vbmUsIEREVCwgWFNELCBYRFIsIEF1dG8pDQogICAgICAgIGludGVybmFsIFZhbGlkYXRpb25UeXBlIFZhbGlkYXRpb25UeXBlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfdmFsaWRhdGlvblR5cGU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoUmVhZFN0YXRlICE9IFJlYWRTdGF0ZS5Jbml0aWFsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWG1sX0ludmFsaWRPcGVyYXRpb24pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBfdmFsaWRhdGlvblR5cGUgPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICBTZXR1cFZhbGlkYXRpb24odmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gY3VycmVudCBzY2hlbWEgY29sbGVjdGlvbiB1c2VkIGZvciB2YWxpZGF0aW9uZw0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgNjE4DQogICAgICAgIGludGVybmFsIFhtbFNjaGVtYUNvbGxlY3Rpb24gU2NoZW1hcw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3NjaGVtYUNvbGxlY3Rpb247DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDYxOA0KDQogICAgICAgIC8vIFNwZWZpZmllcyB3aGV0aGVyIGdlbmVyYWwgZW50aXRpZXMgc2hvdWxkIGJlIGF1dG9tYXRpY2FsbHkgZXhwYW5kZWQgb3Igbm90DQogICAgICAgIGludGVybmFsIEVudGl0eUhhbmRsaW5nIEVudGl0eUhhbmRsaW5nDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlckltcGwuRW50aXR5SGFuZGxpbmc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfY29yZVJlYWRlckltcGwuRW50aXR5SGFuZGxpbmcgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFNwZWNpZmllcyBYbWxSZXNvbHZlciB1c2VkIGZvciBvcGVuaW5nIHRoZSBYTUwgZG9jdW1lbnQgYW5kIG90aGVyIGV4dGVybmFsIHJlZmVyZW5jZXMNCiAgICAgICAgaW50ZXJuYWwgWG1sUmVzb2x2ZXIgWG1sUmVzb2x2ZXINCiAgICAgICAgew0KICAgICAgICAgICAgc2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2NvcmVSZWFkZXJJbXBsLlhtbFJlc29sdmVyID0gdmFsdWU7DQogICAgICAgICAgICAgICAgX3ZhbGlkYXRvci5YbWxSZXNvbHZlciA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIF9zY2hlbWFDb2xsZWN0aW9uLlhtbFJlc29sdmVyID0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBEaXNhYmxlcyBvciBlbmFibGVzIHN1cHBvcnQgb2YgVzNDIFhNTCAxLjAgTmFtZXNwYWNlcw0KICAgICAgICBpbnRlcm5hbCBib29sIE5hbWVzcGFjZXMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3JlUmVhZGVySW1wbC5OYW1lc3BhY2VzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2NvcmVSZWFkZXJJbXBsLk5hbWVzcGFjZXMgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgdHlwZWQgdmFsdWUgb2YgdGhlIGN1cnJlbnQgbm9kZSAoYmFzZWQgb24gdGhlIHR5cGUgc3BlY2lmaWVkIGJ5IHNjaGVtYSkNCiAgICAgICAgcHVibGljIG9iamVjdCBSZWFkVHlwZWRWYWx1ZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChfdmFsaWRhdGlvblR5cGUgPT0gVmFsaWRhdGlvblR5cGUuTm9uZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc3dpdGNoIChfb3V0ZXJSZWFkZXIuTm9kZVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5BdHRyaWJ1dGU6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlckltcGwuSW50ZXJuYWxUeXBlZFZhbHVlOw0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRWxlbWVudDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKFNjaGVtYVR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZHR5cGUgPSAoU2NoZW1hVHlwZSBpcyBYbWxTY2hlbWFEYXRhdHlwZSkgPyAoWG1sU2NoZW1hRGF0YXR5cGUpU2NoZW1hVHlwZSA6ICgoWG1sU2NoZW1hVHlwZSlTY2hlbWFUeXBlKS5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGR0eXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX291dGVyUmVhZGVyLklzRW1wdHlFbGVtZW50KQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOzspDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV9vdXRlclJlYWRlci5SZWFkKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLlhtbF9JbnZhbGlkT3BlcmF0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxOb2RlVHlwZSB0eXBlID0gX291dGVyUmVhZGVyLk5vZGVUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSAhPSBYbWxOb2RlVHlwZS5DREFUQSAmJiB0eXBlICE9IFhtbE5vZGVUeXBlLlRleHQgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgIT0gWG1sTm9kZVR5cGUuV2hpdGVzcGFjZSAmJiB0eXBlICE9IFhtbE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSAhPSBYbWxOb2RlVHlwZS5Db21tZW50ICYmIHR5cGUgIT0gWG1sTm9kZVR5cGUuUHJvY2Vzc2luZ0luc3RydWN0aW9uKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX291dGVyUmVhZGVyLk5vZGVUeXBlICE9IFhtbE5vZGVUeXBlLkVuZEVsZW1lbnQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgWG1sRXhjZXB0aW9uKFNSLlhtbF9JbnZhbGlkTm9kZVR5cGUsIF9vdXRlclJlYWRlci5Ob2RlVHlwZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXJJbXBsLkludGVybmFsVHlwZWRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRW5kRWxlbWVudDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICBpZiAoX2NvcmVSZWFkZXJJbXBsLlYxQ29tcGF0KQ0KICAgICAgICAgICAgICAgICAgICB7IC8vSWYgdjEgWG1sVmFsaWRhdGluZ1JlYWRlciByZXR1cm4gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFByaXZhdGUgaW1wbGVtZW50YXRpb24gbWV0aG9kcw0KICAgICAgICAvLw0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQYXJzZUR0ZEZyb21QYXJzZXJDb250ZXh0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KF9wYXJzZXJDb250ZXh0ICE9IG51bGwpOw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KF9jb3JlUmVhZGVySW1wbC5EdGRJbmZvID09IG51bGwpOw0KDQogICAgICAgICAgICBpZiAoX3BhcnNlckNvbnRleHQuRG9jVHlwZU5hbWUgPT0gbnVsbCB8fCBfcGFyc2VyQ29udGV4dC5Eb2NUeXBlTmFtZS5MZW5ndGggPT0gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIElEdGRQYXJzZXIgZHRkUGFyc2VyID0gRHRkUGFyc2VyLkNyZWF0ZSgpOw0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlckltcGwuRHRkUGFyc2VyUHJveHkgcHJveHkgPSBuZXcgWG1sVGV4dFJlYWRlckltcGwuRHRkUGFyc2VyUHJveHkoX2NvcmVSZWFkZXJJbXBsKTsNCiAgICAgICAgICAgIElEdGRJbmZvIGR0ZEluZm8gPSBkdGRQYXJzZXIuUGFyc2VGcmVlRmxvYXRpbmdEdGQoX3BhcnNlckNvbnRleHQuQmFzZVVSSSwgX3BhcnNlckNvbnRleHQuRG9jVHlwZU5hbWUsIF9wYXJzZXJDb250ZXh0LlB1YmxpY0lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGFyc2VyQ29udGV4dC5TeXN0ZW1JZCwgX3BhcnNlckNvbnRleHQuSW50ZXJuYWxTdWJzZXQsIHByb3h5KTsNCiAgICAgICAgICAgIF9jb3JlUmVhZGVySW1wbC5TZXREdGRJbmZvKGR0ZEluZm8pOw0KDQogICAgICAgICAgICBWYWxpZGF0ZUR0ZCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFZhbGlkYXRlRHRkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSUR0ZEluZm8gZHRkSW5mbyA9IF9jb3JlUmVhZGVySW1wbC5EdGRJbmZvOw0KICAgICAgICAgICAgaWYgKGR0ZEluZm8gIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKF92YWxpZGF0aW9uVHlwZSkNCiAgICAgICAgICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSA2MTgNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBWYWxpZGF0aW9uVHlwZS5BdXRvOg0KICAgICAgICAgICAgICAgICAgICAgICAgU2V0dXBWYWxpZGF0aW9uKFZhbGlkYXRpb25UeXBlLkRURCk7DQogICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGNhc2UgVmFsaWRhdGlvblR5cGUuRFREOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgNjE4DQogICAgICAgICAgICAgICAgICAgIGNhc2UgVmFsaWRhdGlvblR5cGUuRFREOg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFZhbGlkYXRpb25UeXBlLk5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICBfdmFsaWRhdG9yLkR0ZEluZm8gPSBkdGRJbmZvOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFJlc29sdmVFbnRpdHlJbnRlcm5hbGx5KCkNCiAgICAgICAgew0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KF9jb3JlUmVhZGVyLk5vZGVUeXBlID09IFhtbE5vZGVUeXBlLkVudGl0eVJlZmVyZW5jZSk7DQogICAgICAgICAgICBpbnQgaW5pdGlhbERlcHRoID0gX2NvcmVSZWFkZXIuRGVwdGg7DQogICAgICAgICAgICBfb3V0ZXJSZWFkZXIuUmVzb2x2ZUVudGl0eSgpOw0KICAgICAgICAgICAgd2hpbGUgKF9vdXRlclJlYWRlci5SZWFkKCkgJiYgX2NvcmVSZWFkZXIuRGVwdGggPiBpbml0aWFsRGVwdGgpIDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFN4UzogVGhpcyBtZXRob2QgcmVzb2x2ZXMgYW4gVXJpIGJ1dCBkb2VzIG5vdCBleHBvc2UgaXQgdG8gY2FsbGVyLiBJdCdzIE9LIHRvIHN1cHByZXNzIHRoZSBTeFMgd2FybmluZy4NCiAgICAgICAgcHJpdmF0ZSB2b2lkIFNldHVwVmFsaWRhdGlvbihWYWxpZGF0aW9uVHlwZSB2YWxUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBfdmFsaWRhdG9yID0gQmFzZVZhbGlkYXRvci5DcmVhdGVJbnN0YW5jZSh2YWxUeXBlLCB0aGlzLCBfc2NoZW1hQ29sbGVjdGlvbiwgX2V2ZW50SGFuZGxpbmcsIF9wcm9jZXNzSWRlbnRpdHlDb25zdHJhaW50cyk7DQoNCiAgICAgICAgICAgIFhtbFJlc29sdmVyIHJlc29sdmVyID0gR2V0UmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIF92YWxpZGF0b3IuWG1sUmVzb2x2ZXIgPSByZXNvbHZlcjsNCg0KICAgICAgICAgICAgaWYgKF9vdXRlclJlYWRlci5CYXNlVVJJLkxlbmd0aCA+IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3ZhbGlkYXRvci5CYXNlVXJpID0gKHJlc29sdmVyID09IG51bGwpID8gbmV3IFVyaShfb3V0ZXJSZWFkZXIuQmFzZVVSSSwgVXJpS2luZC5SZWxhdGl2ZU9yQWJzb2x1dGUpIDogcmVzb2x2ZXIuUmVzb2x2ZVVyaShudWxsLCBfb3V0ZXJSZWFkZXIuQmFzZVVSSSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfY29yZVJlYWRlckltcGwuVmFsaWRhdGlvbkV2ZW50SGFuZGxpbmcgPSAoX3ZhbGlkYXRpb25UeXBlID09IFZhbGlkYXRpb25UeXBlLk5vbmUpID8gbnVsbCA6IF9ldmVudEhhbmRsaW5nOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgWG1sUmVzb2x2ZXIgc190ZW1wUmVzb2x2ZXI7DQoNCiAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgYmVjYXVzZSB3ZSBjYW4ndCBoYXZlIHRoZSBzZXR0ZXIgZm9yIFhtbFJlc29sdmVyIHB1YmxpYyBhbmQgd2l0aCBpbnRlcm5hbCBnZXR0ZXIuDQogICAgICAgIHByaXZhdGUgWG1sUmVzb2x2ZXIgR2V0UmVzb2x2ZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxSZXNvbHZlciB0ZW1wUmVzb2x2ZXIgPSBfY29yZVJlYWRlckltcGwuR2V0UmVzb2x2ZXIoKTsNCg0KICAgICAgICAgICAgaWYgKHRlbXBSZXNvbHZlciA9PSBudWxsICYmICFfY29yZVJlYWRlckltcGwuSXNSZXNvbHZlclNldCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBpdCBpcyBzYWZlIHRvIHJldHVybiB2YWxpZCByZXNvbHZlciBhcyBpdCdsbCBiZSB1c2VkIGluIHRoZSBzY2hlbWEgdmFsaWRhdGlvbiANCiAgICAgICAgICAgICAgICBpZiAoc190ZW1wUmVzb2x2ZXIgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgc190ZW1wUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc190ZW1wUmVzb2x2ZXI7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB0ZW1wUmVzb2x2ZXI7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBJbnRlcm5hbCBtZXRob2RzIGZvciB2YWxpZGF0b3JzLCBET00sIFhQYXRoRG9jdW1lbnQgZXRjLg0KICAgICAgICAvLw0KICAgICAgICBwcml2YXRlIHZvaWQgUHJvY2Vzc0NvcmVSZWFkZXJFdmVudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN3aXRjaCAoX2NvcmVSZWFkZXIuTm9kZVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5XaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICBpZiAoX2NvcmVSZWFkZXIuRGVwdGggPiAwIHx8IF9jb3JlUmVhZGVySW1wbC5GcmFnbWVudFR5cGUgIT0gWG1sTm9kZVR5cGUuRG9jdW1lbnQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdmFsaWRhdG9yLlByZXNlcnZlV2hpdGVzcGFjZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29yZVJlYWRlckltcGwuQ2hhbmdlQ3VycmVudE5vZGVUeXBlKFhtbE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZ290byBkZWZhdWx0Ow0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRG9jdW1lbnRUeXBlOg0KICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZUR0ZCgpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVudGl0eVJlZmVyZW5jZToNCiAgICAgICAgICAgICAgICAgICAgX3BhcnNpbmdGdW5jdGlvbiA9IFBhcnNpbmdGdW5jdGlvbi5SZXNvbHZlRW50aXR5SW50ZXJuYWxseTsNCiAgICAgICAgICAgICAgICAgICAgZ290byBkZWZhdWx0Ow0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIF9jb3JlUmVhZGVySW1wbC5JbnRlcm5hbFNjaGVtYVR5cGUgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICBfY29yZVJlYWRlckltcGwuSW50ZXJuYWxUeXBlZFZhbHVlID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRvci5WYWxpZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIEJhc2VWYWxpZGF0b3IgVmFsaWRhdG9yDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfdmFsaWRhdG9yOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3ZhbGlkYXRvciA9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgb3ZlcnJpZGUgWG1sTmFtZXNwYWNlTWFuYWdlciBOYW1lc3BhY2VNYW5hZ2VyDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfY29yZVJlYWRlckltcGwuTmFtZXNwYWNlTWFuYWdlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgU3RhbmRBbG9uZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXJJbXBsLlN0YW5kQWxvbmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBvYmplY3QgU2NoZW1hVHlwZU9iamVjdA0KICAgICAgICB7DQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfY29yZVJlYWRlckltcGwuSW50ZXJuYWxTY2hlbWFUeXBlID0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBvYmplY3QgVHlwZWRWYWx1ZU9iamVjdA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXJJbXBsLkludGVybmFsVHlwZWRWYWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9jb3JlUmVhZGVySW1wbC5JbnRlcm5hbFR5cGVkVmFsdWUgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgQWRkRGVmYXVsdEF0dHJpYnV0ZShTY2hlbWFBdHREZWYgYXR0ZGVmKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gX2NvcmVSZWFkZXJJbXBsLkFkZERlZmF1bHRBdHRyaWJ1dGVOb25EdGQoYXR0ZGVmKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIG92ZXJyaWRlIElEdGRJbmZvIER0ZEluZm8NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9jb3JlUmVhZGVySW1wbC5EdGRJbmZvOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCB2b2lkIFZhbGlkYXRlRGVmYXVsdEF0dHJpYnV0ZU9uVXNlKElEdGREZWZhdWx0QXR0cmlidXRlSW5mbyBkZWZhdWx0QXR0cmlidXRlLCBYbWxUZXh0UmVhZGVySW1wbCBjb3JlUmVhZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBTY2hlbWFBdHREZWYgYXR0ZGVmID0gZGVmYXVsdEF0dHJpYnV0ZSBhcyBTY2hlbWFBdHREZWY7DQogICAgICAgICAgICBpZiAoYXR0ZGVmID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoIWF0dGRlZi5EZWZhdWx0VmFsdWVDaGVja2VkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNjaGVtYUluZm8gc2NoZW1hSW5mbyA9IGNvcmVSZWFkZXIuRHRkSW5mbyBhcyBTY2hlbWFJbmZvOw0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIER0ZFZhbGlkYXRvci5DaGVja0RlZmF1bHRWYWx1ZShhdHRkZWYsIHNjaGVtYUluZm8sIF9ldmVudEhhbmRsaW5nLCBjb3JlUmVhZGVyLkJhc2VVUkkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KDQo="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Dom/XmlDocument.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9uczsNCnVzaW5nIFN5c3RlbS5EaWFnbm9zdGljczsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlhtbC5TY2hlbWE7DQp1c2luZyBTeXN0ZW0uWG1sLlhQYXRoOw0KdXNpbmcgU3lzdGVtLlNlY3VyaXR5Ow0KdXNpbmcgU3lzdGVtLkdsb2JhbGl6YXRpb247DQp1c2luZyBTeXN0ZW0uUnVudGltZS5WZXJzaW9uaW5nOw0KDQpuYW1lc3BhY2UgU3lzdGVtLlhtbA0Kew0KICAgIC8vIFJlcHJlc2VudHMgYW4gZW50aXJlIGRvY3VtZW50LiBBbiBYbWxEb2N1bWVudCBjb250YWlucyBYTUwgZGF0YS4NCiAgICBwdWJsaWMgY2xhc3MgWG1sRG9jdW1lbnQgOiBYbWxOb2RlDQogICAgew0KICAgICAgICBwcml2YXRlIFhtbEltcGxlbWVudGF0aW9uIF9pbXBsZW1lbnRhdGlvbjsNCiAgICAgICAgcHJpdmF0ZSBEb21OYW1lVGFibGUgX2RvbU5hbWVUYWJsZTsgLy8gaGFzaCB0YWJsZSBvZiBYbWxOYW1lDQogICAgICAgIHByaXZhdGUgWG1sTGlua2VkTm9kZSBfbGFzdENoaWxkOw0KICAgICAgICBwcml2YXRlIFhtbE5hbWVkTm9kZU1hcCBfZW50aXRpZXM7DQogICAgICAgIHByaXZhdGUgSGFzaHRhYmxlIF9odEVsZW1lbnRJZE1hcDsNCiAgICAgICAgcHJpdmF0ZSBIYXNodGFibGUgX2h0RWxlbWVudElEQXR0ckRlY2w7IC8va2V5OiBpZDsgb2JqZWN0OiB0aGUgQXJyYXlMaXN0IG9mIHRoZSBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHNhbWUgaWQgKGNvbm5lY3RlZCBvciBkaXNjb25uZWN0ZWQpDQogICAgICAgIHByaXZhdGUgU2NoZW1hSW5mbyBfc2NoZW1hSW5mbzsNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFTZXQgX3NjaGVtYXM7IC8vIHNjaGVtYXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBjYWNoZQ0KICAgICAgICBwcml2YXRlIGJvb2wgX3JlcG9ydFZhbGlkaXR5Ow0KICAgICAgICAvL1RoaXMgdmFyaWFibGUgcmVwcmVzZW50cyB0aGUgYWN0dWFsIGxvYWRpbmcgc3RhdHVzLiBTaW5jZSwgSXNMb2FkaW5nIHdpbGwNCiAgICAgICAgLy9iZSBtYW5pcHVsYXRlZCBzb21ldGltZXMgZm9yIGFkZGluZyBjb250ZW50IHRvIEVudGl0eVJlZmVyZW5jZSB0aGlzIHZhcmlhYmxlDQogICAgICAgIC8vaGFzIGJlZW4gYWRkZWQgd2hpY2ggd291bGQgYWx3YXlzIHJlcHJlc2VudCB0aGUgbG9hZGluZyBzdGF0dXMgb2YgZG9jdW1lbnQuDQogICAgICAgIHByaXZhdGUgYm9vbCBfYWN0dWFsTG9hZGluZ1N0YXR1czsNCg0KICAgICAgICBwcml2YXRlIFhtbE5vZGVDaGFuZ2VkRXZlbnRIYW5kbGVyIF9vbk5vZGVJbnNlcnRpbmdEZWxlZ2F0ZTsNCiAgICAgICAgcHJpdmF0ZSBYbWxOb2RlQ2hhbmdlZEV2ZW50SGFuZGxlciBfb25Ob2RlSW5zZXJ0ZWREZWxlZ2F0ZTsNCiAgICAgICAgcHJpdmF0ZSBYbWxOb2RlQ2hhbmdlZEV2ZW50SGFuZGxlciBfb25Ob2RlUmVtb3ZpbmdEZWxlZ2F0ZTsNCiAgICAgICAgcHJpdmF0ZSBYbWxOb2RlQ2hhbmdlZEV2ZW50SGFuZGxlciBfb25Ob2RlUmVtb3ZlZERlbGVnYXRlOw0KICAgICAgICBwcml2YXRlIFhtbE5vZGVDaGFuZ2VkRXZlbnRIYW5kbGVyIF9vbk5vZGVDaGFuZ2luZ0RlbGVnYXRlOw0KICAgICAgICBwcml2YXRlIFhtbE5vZGVDaGFuZ2VkRXZlbnRIYW5kbGVyIF9vbk5vZGVDaGFuZ2VkRGVsZWdhdGU7DQoNCiAgICAgICAgLy8gZmFsc2UgaWYgdGhlcmUgYXJlIG5vIGVudC1yZWYgcHJlc2VudCwgdHJ1ZSBpZiBlbnQtcmVmIG5vZGVzIGFyZSBvciB3ZXJlIHByZXNlbnQgKGkuZS4gaWYgYWxsIGVudC1yZWYgd2VyZSByZW1vdmVkLCB0aGUgZG9jIHdpbGwgbm90IGNsZWFyIHRoaXMgZmxhZykNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBmRW50UmVmTm9kZXNQcmVzZW50Ow0KICAgICAgICBpbnRlcm5hbCBib29sIGZDRGF0YU5vZGVzUHJlc2VudDsNCg0KICAgICAgICBwcml2YXRlIGJvb2wgX3ByZXNlcnZlV2hpdGVzcGFjZTsNCiAgICAgICAgcHJpdmF0ZSBib29sIF9pc0xvYWRpbmc7DQoNCiAgICAgICAgLy8gc3BlY2lhbCBuYW1lIHN0cmluZ3MgZm9yDQogICAgICAgIGludGVybmFsIHN0cmluZyBzdHJEb2N1bWVudE5hbWU7DQogICAgICAgIGludGVybmFsIHN0cmluZyBzdHJEb2N1bWVudEZyYWdtZW50TmFtZTsNCiAgICAgICAgaW50ZXJuYWwgc3RyaW5nIHN0ckNvbW1lbnROYW1lOw0KICAgICAgICBpbnRlcm5hbCBzdHJpbmcgc3RyVGV4dE5hbWU7DQogICAgICAgIGludGVybmFsIHN0cmluZyBzdHJDRGF0YVNlY3Rpb25OYW1lOw0KICAgICAgICBpbnRlcm5hbCBzdHJpbmcgc3RyRW50aXR5TmFtZTsNCiAgICAgICAgaW50ZXJuYWwgc3RyaW5nIHN0cklEOw0KICAgICAgICBpbnRlcm5hbCBzdHJpbmcgc3RyWG1sbnM7DQogICAgICAgIGludGVybmFsIHN0cmluZyBzdHJYbWw7DQogICAgICAgIGludGVybmFsIHN0cmluZyBzdHJTcGFjZTsNCiAgICAgICAgaW50ZXJuYWwgc3RyaW5nIHN0ckxhbmc7DQogICAgICAgIGludGVybmFsIHN0cmluZyBzdHJFbXB0eTsNCg0KICAgICAgICBpbnRlcm5hbCBzdHJpbmcgc3RyTm9uU2lnbmlmaWNhbnRXaGl0ZXNwYWNlTmFtZTsNCiAgICAgICAgaW50ZXJuYWwgc3RyaW5nIHN0clNpZ25pZmljYW50V2hpdGVzcGFjZU5hbWU7DQogICAgICAgIGludGVybmFsIHN0cmluZyBzdHJSZXNlcnZlZFhtbG5zOw0KICAgICAgICBpbnRlcm5hbCBzdHJpbmcgc3RyUmVzZXJ2ZWRYbWw7DQoNCiAgICAgICAgaW50ZXJuYWwgU3RyaW5nIGJhc2VVUkk7DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxSZXNvbHZlciBfcmVzb2x2ZXI7DQogICAgICAgIGludGVybmFsIGJvb2wgYlNldFJlc29sdmVyOw0KICAgICAgICBpbnRlcm5hbCBvYmplY3Qgb2JqTG9jazsNCg0KICAgICAgICBwcml2YXRlIFhtbEF0dHJpYnV0ZSBfbmFtZXNwYWNlWG1sOw0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyBFbXB0eUVudW1lcmF0b3IgRW1wdHlFbnVtZXJhdG9yID0gbmV3IEVtcHR5RW51bWVyYXRvcigpOw0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgSVhtbFNjaGVtYUluZm8gTm90S25vd25TY2hlbWFJbmZvID0gbmV3IFhtbFNjaGVtYUluZm8oWG1sU2NoZW1hVmFsaWRpdHkuTm90S25vd24pOw0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgSVhtbFNjaGVtYUluZm8gVmFsaWRTY2hlbWFJbmZvID0gbmV3IFhtbFNjaGVtYUluZm8oWG1sU2NoZW1hVmFsaWRpdHkuVmFsaWQpOw0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgSVhtbFNjaGVtYUluZm8gSW52YWxpZFNjaGVtYUluZm8gPSBuZXcgWG1sU2NoZW1hSW5mbyhYbWxTY2hlbWFWYWxpZGl0eS5JbnZhbGlkKTsNCg0KICAgICAgICAvLyBJbml0aWFsaXplcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgWG1sRG9jdW1lbnQgY2xhc3MuDQogICAgICAgIHB1YmxpYyBYbWxEb2N1bWVudCgpIDogdGhpcyhuZXcgWG1sSW1wbGVtZW50YXRpb24oKSkNCiAgICAgICAgew0KICAgICAgICB9DQoNCiAgICAgICAgLy8gSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2UNCiAgICAgICAgLy8gb2YgdGhlIFhtbERvY3VtZW50IGNsYXNzIHdpdGggdGhlIHNwZWNpZmllZCBYbWxOYW1lVGFibGUuDQogICAgICAgIHB1YmxpYyBYbWxEb2N1bWVudChYbWxOYW1lVGFibGUgbnQpIDogdGhpcyhuZXcgWG1sSW1wbGVtZW50YXRpb24obnQpKQ0KICAgICAgICB7DQogICAgICAgIH0NCg0KICAgICAgICBwcm90ZWN0ZWQgaW50ZXJuYWwgWG1sRG9jdW1lbnQoWG1sSW1wbGVtZW50YXRpb24gaW1wKSA6IGJhc2UoKQ0KICAgICAgICB7DQogICAgICAgICAgICBfaW1wbGVtZW50YXRpb24gPSBpbXA7DQogICAgICAgICAgICBfZG9tTmFtZVRhYmxlID0gbmV3IERvbU5hbWVUYWJsZSh0aGlzKTsNCg0KICAgICAgICAgICAgLy8gZm9yY2UgdGhlIGZvbGxvd2luZyBzdHJpbmcgaW5zdGFuY2VzIHRvIGJlIGRlZmF1bHQgaW4gdGhlIG5hbWV0YWJsZQ0KICAgICAgICAgICAgWG1sTmFtZVRhYmxlIG50ID0gdGhpcy5OYW1lVGFibGU7DQogICAgICAgICAgICBudC5BZGQoc3RyaW5nLkVtcHR5KTsNCiAgICAgICAgICAgIHN0ckRvY3VtZW50TmFtZSA9IG50LkFkZCgiI2RvY3VtZW50Iik7DQogICAgICAgICAgICBzdHJEb2N1bWVudEZyYWdtZW50TmFtZSA9IG50LkFkZCgiI2RvY3VtZW50LWZyYWdtZW50Iik7DQogICAgICAgICAgICBzdHJDb21tZW50TmFtZSA9IG50LkFkZCgiI2NvbW1lbnQiKTsNCiAgICAgICAgICAgIHN0clRleHROYW1lID0gbnQuQWRkKCIjdGV4dCIpOw0KICAgICAgICAgICAgc3RyQ0RhdGFTZWN0aW9uTmFtZSA9IG50LkFkZCgiI2NkYXRhLXNlY3Rpb24iKTsNCiAgICAgICAgICAgIHN0ckVudGl0eU5hbWUgPSBudC5BZGQoIiNlbnRpdHkiKTsNCiAgICAgICAgICAgIHN0cklEID0gbnQuQWRkKCJpZCIpOw0KICAgICAgICAgICAgc3RyTm9uU2lnbmlmaWNhbnRXaGl0ZXNwYWNlTmFtZSA9IG50LkFkZCgiI3doaXRlc3BhY2UiKTsNCiAgICAgICAgICAgIHN0clNpZ25pZmljYW50V2hpdGVzcGFjZU5hbWUgPSBudC5BZGQoIiNzaWduaWZpY2FudC13aGl0ZXNwYWNlIik7DQogICAgICAgICAgICBzdHJYbWxucyA9IG50LkFkZCgieG1sbnMiKTsNCiAgICAgICAgICAgIHN0clhtbCA9IG50LkFkZCgieG1sIik7DQogICAgICAgICAgICBzdHJTcGFjZSA9IG50LkFkZCgic3BhY2UiKTsNCiAgICAgICAgICAgIHN0ckxhbmcgPSBudC5BZGQoImxhbmciKTsNCiAgICAgICAgICAgIHN0clJlc2VydmVkWG1sbnMgPSBudC5BZGQoWG1sUmVzZXJ2ZWROcy5Oc1htbE5zKTsNCiAgICAgICAgICAgIHN0clJlc2VydmVkWG1sID0gbnQuQWRkKFhtbFJlc2VydmVkTnMuTnNYbWwpOw0KICAgICAgICAgICAgc3RyRW1wdHkgPSBudC5BZGQoU3RyaW5nLkVtcHR5KTsNCiAgICAgICAgICAgIGJhc2VVUkkgPSBTdHJpbmcuRW1wdHk7DQoNCiAgICAgICAgICAgIG9iakxvY2sgPSBuZXcgb2JqZWN0KCk7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBTY2hlbWFJbmZvIER0ZFNjaGVtYUluZm8NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9zY2hlbWFJbmZvOyB9DQogICAgICAgICAgICBzZXQgeyBfc2NoZW1hSW5mbyA9IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBOT1RFOiBUaGlzIGRvZXMgbm90IGNvcnJlY3RseSBjaGVjayBzdGFydCBuYW1lIGNoYXIsIGJ1dCB3ZSBjYW5ub3QgY2hhbmdlIGl0IHNpbmNlIGl0IHdvdWxkIGJlIGEgYnJlYWtpbmcgY2hhbmdlLg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgdm9pZCBDaGVja05hbWUoU3RyaW5nIG5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGludCBlbmRQb3MgPSBWYWxpZGF0ZU5hbWVzLlBhcnNlTm10b2tlbihuYW1lLCAwKTsNCiAgICAgICAgICAgIGlmIChlbmRQb3MgPCBuYW1lLkxlbmd0aCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgWG1sRXhjZXB0aW9uKFNSLlhtbF9CYWROYW1lQ2hhciwgWG1sRXhjZXB0aW9uLkJ1aWxkQ2hhckV4Y2VwdGlvbkFyZ3MobmFtZSwgZW5kUG9zKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxOYW1lIEFkZFhtbE5hbWUoc3RyaW5nIHByZWZpeCwgc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSwgSVhtbFNjaGVtYUluZm8gc2NoZW1hSW5mbykNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sTmFtZSBuID0gX2RvbU5hbWVUYWJsZS5BZGROYW1lKHByZWZpeCwgbG9jYWxOYW1lLCBuYW1lc3BhY2VVUkksIHNjaGVtYUluZm8pOw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KChwcmVmaXggPT0gbnVsbCkgPyAobi5QcmVmaXguTGVuZ3RoID09IDApIDogKHByZWZpeCA9PSBuLlByZWZpeCkpOw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KG4uTG9jYWxOYW1lID09IGxvY2FsTmFtZSk7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQoKG5hbWVzcGFjZVVSSSA9PSBudWxsKSA/IChuLk5hbWVzcGFjZVVSSS5MZW5ndGggPT0gMCkgOiAobi5OYW1lc3BhY2VVUkkgPT0gbmFtZXNwYWNlVVJJKSk7DQogICAgICAgICAgICByZXR1cm4gbjsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFhtbE5hbWUgR2V0WG1sTmFtZShzdHJpbmcgcHJlZml4LCBzdHJpbmcgbG9jYWxOYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJLCBJWG1sU2NoZW1hSW5mbyBzY2hlbWFJbmZvKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxOYW1lIG4gPSBfZG9tTmFtZVRhYmxlLkdldE5hbWUocHJlZml4LCBsb2NhbE5hbWUsIG5hbWVzcGFjZVVSSSwgc2NoZW1hSW5mbyk7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQobiA9PSBudWxsIHx8ICgocHJlZml4ID09IG51bGwpID8gKG4uUHJlZml4Lkxlbmd0aCA9PSAwKSA6IChwcmVmaXggPT0gbi5QcmVmaXgpKSk7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQobiA9PSBudWxsIHx8IG4uTG9jYWxOYW1lID09IGxvY2FsTmFtZSk7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQobiA9PSBudWxsIHx8ICgobmFtZXNwYWNlVVJJID09IG51bGwpID8gKG4uTmFtZXNwYWNlVVJJLkxlbmd0aCA9PSAwKSA6IChuLk5hbWVzcGFjZVVSSSA9PSBuYW1lc3BhY2VVUkkpKSk7DQogICAgICAgICAgICByZXR1cm4gbjsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFhtbE5hbWUgQWRkQXR0clhtbE5hbWUoc3RyaW5nIHByZWZpeCwgc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSwgSVhtbFNjaGVtYUluZm8gc2NoZW1hSW5mbykNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sTmFtZSB4bWxOYW1lID0gQWRkWG1sTmFtZShwcmVmaXgsIGxvY2FsTmFtZSwgbmFtZXNwYWNlVVJJLCBzY2hlbWFJbmZvKTsNCiAgICAgICAgICAgIERlYnVnLkFzc2VydCgocHJlZml4ID09IG51bGwpID8gKHhtbE5hbWUuUHJlZml4Lkxlbmd0aCA9PSAwKSA6IChwcmVmaXggPT0geG1sTmFtZS5QcmVmaXgpKTsNCiAgICAgICAgICAgIERlYnVnLkFzc2VydCh4bWxOYW1lLkxvY2FsTmFtZSA9PSBsb2NhbE5hbWUpOw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KChuYW1lc3BhY2VVUkkgPT0gbnVsbCkgPyAoeG1sTmFtZS5OYW1lc3BhY2VVUkkuTGVuZ3RoID09IDApIDogKHhtbE5hbWUuTmFtZXNwYWNlVVJJID09IG5hbWVzcGFjZVVSSSkpOw0KDQogICAgICAgICAgICBpZiAoIXRoaXMuSXNMb2FkaW5nKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFVzZSBhdG9taXplZCB2ZXJzaW9ucyBpbnN0ZWFkIG9mIHByZWZpeCwgbG9jYWxOYW1lIGFuZCBuc1VSSQ0KICAgICAgICAgICAgICAgIG9iamVjdCBvUHJlZml4ID0geG1sTmFtZS5QcmVmaXg7DQogICAgICAgICAgICAgICAgb2JqZWN0IG9OYW1lc3BhY2VVUkkgPSB4bWxOYW1lLk5hbWVzcGFjZVVSSTsNCiAgICAgICAgICAgICAgICBvYmplY3Qgb0xvY2FsTmFtZSA9IHhtbE5hbWUuTG9jYWxOYW1lOw0KICAgICAgICAgICAgICAgIGlmICgob1ByZWZpeCA9PSAob2JqZWN0KXN0clhtbG5zIHx8IChvUHJlZml4ID09IChvYmplY3Qpc3RyRW1wdHkgJiYgb0xvY2FsTmFtZSA9PSAob2JqZWN0KXN0clhtbG5zKSkgXiAob05hbWVzcGFjZVVSSSA9PSAob2JqZWN0KXN0clJlc2VydmVkWG1sbnMpKQ0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRFeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhkb21fQXR0cl9SZXNlcnZlZF9YbWxOUywgbmFtZXNwYWNlVVJJKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4geG1sTmFtZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgQWRkSWRJbmZvKFhtbE5hbWUgZWxlTmFtZSwgWG1sTmFtZSBhdHRyTmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgLy93aGVuIFhtbExvYWRlciBjYWxsIFhtbERvY3VtZW50LkFkZEluZm8sIHRoZSBlbGVtZW50LlhtbE5hbWUgYW5kIGF0dHIuWG1sTmFtZSANCiAgICAgICAgICAgIC8vaGF2ZSBhbHJlYWR5IGJlZW4gcmVwbGFjZWQgd2l0aCB0aGUgb25lcyB0aGF0IGRvbid0IGhhdmUgbmFtZXNwYWNlIHZhbHVlcyAob3IganVzdA0KICAgICAgICAgICAgLy9zdHJpbmcuRW1wdHkpIGJlY2F1c2UgaW4gRFRELCB0aGUgbmFtZXNwYWNlIGlzIG5vdCBzdXBwb3J0ZWQNCiAgICAgICAgICAgIGlmIChfaHRFbGVtZW50SURBdHRyRGVjbCA9PSBudWxsIHx8IF9odEVsZW1lbnRJREF0dHJEZWNsW2VsZU5hbWVdID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF9odEVsZW1lbnRJREF0dHJEZWNsID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIF9odEVsZW1lbnRJREF0dHJEZWNsID0gbmV3IEhhc2h0YWJsZSgpOw0KICAgICAgICAgICAgICAgIF9odEVsZW1lbnRJREF0dHJEZWNsLkFkZChlbGVOYW1lLCBhdHRyTmFtZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFhtbE5hbWUgR2V0SURJbmZvQnlFbGVtZW50XyhYbWxOYW1lIGVsZU5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vV2hlbiBYbWxEb2N1bWVudCBpcyBnZXR0aW5nIHRoZSBJREF0dHJpYnV0ZSBmb3IgYSBnaXZlbiBlbGVtZW50LCANCiAgICAgICAgICAgIC8vd2UgbmVlZCBvbmx5IGNvbXBhcmUgdGhlIHByZWZpeCBhbmQgbG9jYWxuYW1lIG9mIGVsZW1lbnQuWG1sTmFtZSB3aXRoDQogICAgICAgICAgICAvL3RoZSByZWdpc3RlcmVkIGh0RWxlbWVudElEQXR0ckRlY2wuDQogICAgICAgICAgICBYbWxOYW1lIG5ld05hbWUgPSBHZXRYbWxOYW1lKGVsZU5hbWUuUHJlZml4LCBlbGVOYW1lLkxvY2FsTmFtZSwgc3RyaW5nLkVtcHR5LCBudWxsKTsNCiAgICAgICAgICAgIGlmIChuZXdOYW1lICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIChYbWxOYW1lKShfaHRFbGVtZW50SURBdHRyRGVjbFtuZXdOYW1lXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFhtbE5hbWUgR2V0SURJbmZvQnlFbGVtZW50KFhtbE5hbWUgZWxlTmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF9odEVsZW1lbnRJREF0dHJEZWNsID09IG51bGwpDQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIEdldElESW5mb0J5RWxlbWVudF8oZWxlTmFtZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFdlYWtSZWZlcmVuY2UgR2V0RWxlbWVudChBcnJheUxpc3QgZWxlbWVudExpc3QsIFhtbEVsZW1lbnQgZWxlbSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXJyYXlMaXN0IGdjRWxlbVJlZnMgPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAgICAgICBmb3JlYWNoIChXZWFrUmVmZXJlbmNlIGVsZW1SZWYgaW4gZWxlbWVudExpc3QpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFlbGVtUmVmLklzQWxpdmUpDQogICAgICAgICAgICAgICAgICAgIC8vdGFrZSBub3RlcyBvbiB0aGUgZ2FyYmFnZSBjb2xsZWN0ZWQgbm9kZXMNCiAgICAgICAgICAgICAgICAgICAgZ2NFbGVtUmVmcy5BZGQoZWxlbVJlZik7DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKChYbWxFbGVtZW50KShlbGVtUmVmLlRhcmdldCkgPT0gZWxlbSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtUmVmOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vQ2xlYXIgb3V0IHRoZSBnY2VkIGVsZW1lbnRzDQogICAgICAgICAgICBmb3JlYWNoIChXZWFrUmVmZXJlbmNlIGVsZW1SZWYgaW4gZ2NFbGVtUmVmcykNCiAgICAgICAgICAgICAgICBlbGVtZW50TGlzdC5SZW1vdmUoZWxlbVJlZik7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHZvaWQgQWRkRWxlbWVudFdpdGhJZChzdHJpbmcgaWQsIFhtbEVsZW1lbnQgZWxlbSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF9odEVsZW1lbnRJZE1hcCA9PSBudWxsIHx8ICFfaHRFbGVtZW50SWRNYXAuQ29udGFpbnMoaWQpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfaHRFbGVtZW50SWRNYXAgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgX2h0RWxlbWVudElkTWFwID0gbmV3IEhhc2h0YWJsZSgpOw0KICAgICAgICAgICAgICAgIEFycmF5TGlzdCBlbGVtZW50TGlzdCA9IG5ldyBBcnJheUxpc3QoKTsNCiAgICAgICAgICAgICAgICBlbGVtZW50TGlzdC5BZGQobmV3IFdlYWtSZWZlcmVuY2UoZWxlbSkpOw0KICAgICAgICAgICAgICAgIF9odEVsZW1lbnRJZE1hcC5BZGQoaWQsIGVsZW1lbnRMaXN0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyB0aGVyZSBhcmUgb3RoZXIgZWxlbWVudChzKSB0aGF0IGhhcyB0aGUgc2FtZSBpZA0KICAgICAgICAgICAgICAgIEFycmF5TGlzdCBlbGVtZW50TGlzdCA9IChBcnJheUxpc3QpKF9odEVsZW1lbnRJZE1hcFtpZF0pOw0KICAgICAgICAgICAgICAgIGlmIChHZXRFbGVtZW50KGVsZW1lbnRMaXN0LCBlbGVtKSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBlbGVtZW50TGlzdC5BZGQobmV3IFdlYWtSZWZlcmVuY2UoZWxlbSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgdm9pZCBSZW1vdmVFbGVtZW50V2l0aElkKHN0cmluZyBpZCwgWG1sRWxlbWVudCBlbGVtKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX2h0RWxlbWVudElkTWFwICE9IG51bGwgJiYgX2h0RWxlbWVudElkTWFwLkNvbnRhaW5zKGlkKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBcnJheUxpc3QgZWxlbWVudExpc3QgPSAoQXJyYXlMaXN0KShfaHRFbGVtZW50SWRNYXBbaWRdKTsNCiAgICAgICAgICAgICAgICBXZWFrUmVmZXJlbmNlIGVsZW1SZWYgPSBHZXRFbGVtZW50KGVsZW1lbnRMaXN0LCBlbGVtKTsNCiAgICAgICAgICAgICAgICBpZiAoZWxlbVJlZiAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudExpc3QuUmVtb3ZlKGVsZW1SZWYpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudExpc3QuQ291bnQgPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIF9odEVsZW1lbnRJZE1hcC5SZW1vdmUoaWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8gQ3JlYXRlcyBhIGR1cGxpY2F0ZSBvZiB0aGlzIG5vZGUuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBYbWxOb2RlIENsb25lTm9kZShib29sIGRlZXApDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbERvY3VtZW50IGNsb25lID0gSW1wbGVtZW50YXRpb24uQ3JlYXRlRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIGNsb25lLlNldEJhc2VVUkkodGhpcy5iYXNlVVJJKTsNCiAgICAgICAgICAgIGlmIChkZWVwKQ0KICAgICAgICAgICAgICAgIGNsb25lLkltcG9ydENoaWxkcmVuKHRoaXMsIGNsb25lLCBkZWVwKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGNsb25lOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gR2V0cyB0aGUgdHlwZSBvZiB0aGUgY3VycmVudCBub2RlLg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgWG1sTm9kZVR5cGUgTm9kZVR5cGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIFhtbE5vZGVUeXBlLkRvY3VtZW50OyB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgWG1sTm9kZSBQYXJlbnROb2RlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBudWxsOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBHZXRzIHRoZSBub2RlIGZvciB0aGUgRE9DVFlQRSBkZWNsYXJhdGlvbi4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sRG9jdW1lbnRUeXBlIERvY3VtZW50VHlwZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gKFhtbERvY3VtZW50VHlwZSlGaW5kQ2hpbGQoWG1sTm9kZVR5cGUuRG9jdW1lbnRUeXBlKTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgdmlydHVhbCBYbWxEZWNsYXJhdGlvbiBEZWNsYXJhdGlvbg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoSGFzQ2hpbGROb2RlcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbERlY2xhcmF0aW9uIGRlYyA9IEZpcnN0Q2hpbGQgYXMgWG1sRGVjbGFyYXRpb247DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gR2V0cyB0aGUgWG1sSW1wbGVtZW50YXRpb24gb2JqZWN0IGZvciB0aGlzIGRvY3VtZW50Lg0KICAgICAgICBwdWJsaWMgWG1sSW1wbGVtZW50YXRpb24gSW1wbGVtZW50YXRpb24NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9pbXBsZW1lbnRhdGlvbjsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gR2V0cyB0aGUgbmFtZSBvZiB0aGUgbm9kZS4NCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFN0cmluZyBOYW1lDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBzdHJEb2N1bWVudE5hbWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEdldHMgdGhlIG5hbWUgb2YgdGhlIGN1cnJlbnQgbm9kZSB3aXRob3V0IHRoZSBuYW1lc3BhY2UgcHJlZml4Lg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgU3RyaW5nIExvY2FsTmFtZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gc3RyRG9jdW1lbnROYW1lOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBHZXRzIHRoZSByb290IFhtbEVsZW1lbnQgZm9yIHRoZSBkb2N1bWVudC4NCiAgICAgICAgcHVibGljIFhtbEVsZW1lbnQgRG9jdW1lbnRFbGVtZW50DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiAoWG1sRWxlbWVudClGaW5kQ2hpbGQoWG1sTm9kZVR5cGUuRWxlbWVudCk7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIG92ZXJyaWRlIGJvb2wgSXNDb250YWluZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIHRydWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIG92ZXJyaWRlIFhtbExpbmtlZE5vZGUgTGFzdE5vZGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9sYXN0Q2hpbGQ7IH0NCiAgICAgICAgICAgIHNldCB7IF9sYXN0Q2hpbGQgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gR2V0cyB0aGUgWG1sRG9jdW1lbnQgdGhhdCBjb250YWlucyB0aGlzIG5vZGUuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBYbWxEb2N1bWVudCBPd25lckRvY3VtZW50DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBudWxsOyB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgWG1sU2NoZW1hU2V0IFNjaGVtYXMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF9zY2hlbWFzID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfc2NoZW1hcyA9IG5ldyBYbWxTY2hlbWFTZXQoTmFtZVRhYmxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIF9zY2hlbWFzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfc2NoZW1hcyA9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBDYW5SZXBvcnRWYWxpZGl0eQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX3JlcG9ydFZhbGlkaXR5OyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIEhhc1NldFJlc29sdmVyDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBiU2V0UmVzb2x2ZXI7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFhtbFJlc29sdmVyIEdldFJlc29sdmVyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIF9yZXNvbHZlcjsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhtbFJlc29sdmVyIFhtbFJlc29sdmVyDQogICAgICAgIHsNCiAgICAgICAgICAgIHNldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9yZXNvbHZlciA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIGlmICghYlNldFJlc29sdmVyKQ0KICAgICAgICAgICAgICAgICAgICBiU2V0UmVzb2x2ZXIgPSB0cnVlOw0KDQogICAgICAgICAgICAgICAgWG1sRG9jdW1lbnRUeXBlIGR0ZCA9IHRoaXMuRG9jdW1lbnRUeXBlOw0KICAgICAgICAgICAgICAgIGlmIChkdGQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGR0ZC5EdGRTY2hlbWFJbmZvID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaW50ZXJuYWwgb3ZlcnJpZGUgYm9vbCBJc1ZhbGlkQ2hpbGRUeXBlKFhtbE5vZGVUeXBlIHR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlByb2Nlc3NpbmdJbnN0cnVjdGlvbjoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNvbW1lbnQ6DQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5XaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuU2lnbmlmaWNhbnRXaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRG9jdW1lbnRUeXBlOg0KICAgICAgICAgICAgICAgICAgICBpZiAoRG9jdW1lbnRUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YZG9tX0R1YWxEb2N1bWVudFR5cGVOb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgIGlmIChEb2N1bWVudEVsZW1lbnQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLlhkb21fRHVhbERvY3VtZW50RWxlbWVudE5vZGUpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuWG1sRGVjbGFyYXRpb246DQogICAgICAgICAgICAgICAgICAgIGlmIChEZWNsYXJhdGlvbiAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWGRvbV9EdWFsRGVjbGFyYXRpb25Ob2RlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gdGhlIGZ1bmN0aW9uIGV4YW1pbmVzIGFsbCB0aGUgc2libGluZ3MgYmVmb3JlIHRoZSByZWZOb2RlDQogICAgICAgIC8vICBpZiBhbnkgb2YgdGhlIG5vZGVzIGhhcyB0eXBlIGVxdWFscyB0byAibnQiLCByZXR1cm4gdHJ1ZTsgb3RoZXJ3aXNlLCByZXR1cm4gZmFsc2U7DQogICAgICAgIHByaXZhdGUgYm9vbCBIYXNOb2RlVHlwZUluUHJldlNpYmxpbmdzKFhtbE5vZGVUeXBlIG50LCBYbWxOb2RlIHJlZk5vZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChyZWZOb2RlID09IG51bGwpDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICBYbWxOb2RlIG5vZGUgPSBudWxsOw0KICAgICAgICAgICAgaWYgKHJlZk5vZGUuUGFyZW50Tm9kZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIG5vZGUgPSByZWZOb2RlLlBhcmVudE5vZGUuRmlyc3RDaGlsZDsNCiAgICAgICAgICAgIHdoaWxlIChub2RlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG5vZGUuTm9kZVR5cGUgPT0gbnQpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIGlmIChub2RlID09IHJlZk5vZGUpDQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLk5leHRTaWJsaW5nOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gdGhlIGZ1bmN0aW9uIGV4YW1pbmVzIGFsbCB0aGUgc2libGluZ3MgYWZ0ZXIgdGhlIHJlZk5vZGUNCiAgICAgICAgLy8gIGlmIGFueSBvZiB0aGUgbm9kZXMgaGFzIHRoZSB0eXBlIGVxdWFscyB0byAibnQiLCByZXR1cm4gdHJ1ZTsgb3RoZXJ3aXNlLCByZXR1cm4gZmFsc2U7DQogICAgICAgIHByaXZhdGUgYm9vbCBIYXNOb2RlVHlwZUluTmV4dFNpYmxpbmdzKFhtbE5vZGVUeXBlIG50LCBYbWxOb2RlIHJlZk5vZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbE5vZGUgbm9kZSA9IHJlZk5vZGU7DQogICAgICAgICAgICB3aGlsZSAobm9kZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChub2RlLk5vZGVUeXBlID09IG50KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5OZXh0U2libGluZzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIG92ZXJyaWRlIGJvb2wgQ2FuSW5zZXJ0QmVmb3JlKFhtbE5vZGUgbmV3Q2hpbGQsIFhtbE5vZGUgcmVmQ2hpbGQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChyZWZDaGlsZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJlZkNoaWxkID0gRmlyc3RDaGlsZDsNCg0KICAgICAgICAgICAgaWYgKHJlZkNoaWxkID09IG51bGwpDQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICAgICAgICAgIHN3aXRjaCAobmV3Q2hpbGQuTm9kZVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5YbWxEZWNsYXJhdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChyZWZDaGlsZCA9PSBGaXJzdENoaWxkKTsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuUHJvY2Vzc2luZ0luc3RydWN0aW9uOg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuQ29tbWVudDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZkNoaWxkLk5vZGVUeXBlICE9IFhtbE5vZGVUeXBlLlhtbERlY2xhcmF0aW9uOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Eb2N1bWVudFR5cGU6DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWZDaGlsZC5Ob2RlVHlwZSAhPSBYbWxOb2RlVHlwZS5YbWxEZWNsYXJhdGlvbikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHJlZkNoaWxkIGlzIG5vdCB0aGUgWG1sRGVjbGFyYXRpb24gbm9kZSwgb25seSBuZWVkIHRvIGdvIHRocm91Z2ggdGhlIHNpYmxpbmcgYmVmb3JlIGFuZCBpbmNsdWRpbmcgcmVmQ2hpbGQgdG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgbWFrZSBzdXJlIG5vIEVsZW1lbnQgKCByb290RWxlbSBub2RlICkgYmVmb3JlIHRoZSBjdXJyZW50IHBvc2l0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFIYXNOb2RlVHlwZUluUHJldlNpYmxpbmdzKFhtbE5vZGVUeXBlLkVsZW1lbnQsIHJlZkNoaWxkLlByZXZpb3VzU2libGluZyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWZDaGlsZC5Ob2RlVHlwZSAhPSBYbWxOb2RlVHlwZS5YbWxEZWNsYXJhdGlvbikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHJlZkNoaWxkIGlzIG5vdCB0aGUgWG1sRGVjbGFyYXRpb24gbm9kZSwgb25seSBuZWVkIHRvIGdvIHRocm91Z2ggdGhlIHNpYmxpbmdzIGFmdGVyIGFuZCBpbmNsdWRpbmcgdGhlIHJlZkNoaWxkIHRvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIG1ha2Ugc3VyZSBubyBEb2NUeXBlIG5vZGUgYW5kIFhtbERlY2xhcmF0aW9uIG5vZGUgYWZ0ZXIgdGhlIGN1cnJlbnQgcG9zaXRpb24uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFIYXNOb2RlVHlwZUluTmV4dFNpYmxpbmdzKFhtbE5vZGVUeXBlLkRvY3VtZW50VHlwZSwgcmVmQ2hpbGQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBvdmVycmlkZSBib29sIENhbkluc2VydEFmdGVyKFhtbE5vZGUgbmV3Q2hpbGQsIFhtbE5vZGUgcmVmQ2hpbGQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChyZWZDaGlsZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJlZkNoaWxkID0gTGFzdENoaWxkOw0KDQogICAgICAgICAgICBpZiAocmVmQ2hpbGQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgc3dpdGNoIChuZXdDaGlsZC5Ob2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlByb2Nlc3NpbmdJbnN0cnVjdGlvbjoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNvbW1lbnQ6DQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5XaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuU2lnbmlmaWNhbnRXaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRG9jdW1lbnRUeXBlOg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAvL3dlIHdpbGwgaGF2ZSB0byBnbyB0aHJvdWdoIGFsbCB0aGUgc2libGluZ3MgYmVmb3JlIHRoZSByZWZDaGlsZCBqdXN0IHRvIG1ha2Ugc3VyZSBubyBFbGVtZW50IG5vZGUgKCByb290RWxlbSApDQogICAgICAgICAgICAgICAgICAgICAgICAvLyAgYmVmb3JlIHRoZSBjdXJyZW50IHBvc2l0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIUhhc05vZGVUeXBlSW5QcmV2U2libGluZ3MoWG1sTm9kZVR5cGUuRWxlbWVudCwgcmVmQ2hpbGQpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhSGFzTm9kZVR5cGVJbk5leHRTaWJsaW5ncyhYbWxOb2RlVHlwZS5Eb2N1bWVudFR5cGUsIHJlZkNoaWxkLk5leHRTaWJsaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGFuIFhtbEF0dHJpYnV0ZSB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS4NCiAgICAgICAgcHVibGljIFhtbEF0dHJpYnV0ZSBDcmVhdGVBdHRyaWJ1dGUoU3RyaW5nIG5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFN0cmluZyBwcmVmaXggPSBTdHJpbmcuRW1wdHk7DQogICAgICAgICAgICBTdHJpbmcgbG9jYWxOYW1lID0gU3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgU3RyaW5nIG5hbWVzcGFjZVVSSSA9IFN0cmluZy5FbXB0eTsNCg0KICAgICAgICAgICAgU3BsaXROYW1lKG5hbWUsIG91dCBwcmVmaXgsIG91dCBsb2NhbE5hbWUpOw0KDQogICAgICAgICAgICBTZXREZWZhdWx0TmFtZXNwYWNlKHByZWZpeCwgbG9jYWxOYW1lLCByZWYgbmFtZXNwYWNlVVJJKTsNCg0KICAgICAgICAgICAgcmV0dXJuIENyZWF0ZUF0dHJpYnV0ZShwcmVmaXgsIGxvY2FsTmFtZSwgbmFtZXNwYWNlVVJJKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHZvaWQgU2V0RGVmYXVsdE5hbWVzcGFjZShTdHJpbmcgcHJlZml4LCBTdHJpbmcgbG9jYWxOYW1lLCByZWYgU3RyaW5nIG5hbWVzcGFjZVVSSSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHByZWZpeCA9PSBzdHJYbWxucyB8fCAocHJlZml4Lkxlbmd0aCA9PSAwICYmIGxvY2FsTmFtZSA9PSBzdHJYbWxucykpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbmFtZXNwYWNlVVJJID0gc3RyUmVzZXJ2ZWRYbWxuczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHByZWZpeCA9PSBzdHJYbWwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbmFtZXNwYWNlVVJJID0gc3RyUmVzZXJ2ZWRYbWw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGEgWG1sQ0RhdGFTZWN0aW9uIGNvbnRhaW5pbmcgdGhlIHNwZWNpZmllZCBkYXRhLg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxDRGF0YVNlY3Rpb24gQ3JlYXRlQ0RhdGFTZWN0aW9uKFN0cmluZyBkYXRhKQ0KICAgICAgICB7DQogICAgICAgICAgICBmQ0RhdGFOb2Rlc1ByZXNlbnQgPSB0cnVlOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxDRGF0YVNlY3Rpb24oZGF0YSwgdGhpcyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGFuIFhtbENvbW1lbnQgY29udGFpbmluZyB0aGUgc3BlY2lmaWVkIGRhdGEuDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhtbENvbW1lbnQgQ3JlYXRlQ29tbWVudChTdHJpbmcgZGF0YSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxDb21tZW50KGRhdGEsIHRoaXMpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyBhIG5ldyBYbWxEb2N1bWVudFR5cGUgb2JqZWN0Lg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxEb2N1bWVudFR5cGUgQ3JlYXRlRG9jdW1lbnRUeXBlKHN0cmluZyBuYW1lLCBzdHJpbmcgcHVibGljSWQsIHN0cmluZyBzeXN0ZW1JZCwgc3RyaW5nIGludGVybmFsU3Vic2V0KQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhtbERvY3VtZW50VHlwZShuYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQsIGludGVybmFsU3Vic2V0LCB0aGlzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENyZWF0ZXMgYW4gWG1sRG9jdW1lbnRGcmFnbWVudC4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sRG9jdW1lbnRGcmFnbWVudCBDcmVhdGVEb2N1bWVudEZyYWdtZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxEb2N1bWVudEZyYWdtZW50KHRoaXMpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ3JlYXRlcyBhbiBlbGVtZW50IHdpdGggdGhlIHNwZWNpZmllZCBuYW1lLg0KICAgICAgICBwdWJsaWMgWG1sRWxlbWVudCBDcmVhdGVFbGVtZW50KFN0cmluZyBuYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgcHJlZml4ID0gU3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgc3RyaW5nIGxvY2FsTmFtZSA9IFN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgIFNwbGl0TmFtZShuYW1lLCBvdXQgcHJlZml4LCBvdXQgbG9jYWxOYW1lKTsNCiAgICAgICAgICAgIHJldHVybiBDcmVhdGVFbGVtZW50KHByZWZpeCwgbG9jYWxOYW1lLCBzdHJpbmcuRW1wdHkpOw0KICAgICAgICB9DQoNCg0KICAgICAgICBpbnRlcm5hbCB2b2lkIEFkZERlZmF1bHRBdHRyaWJ1dGVzKFhtbEVsZW1lbnQgZWxlbSkNCiAgICAgICAgew0KICAgICAgICAgICAgU2NoZW1hSW5mbyBzY2hJbmZvID0gRHRkU2NoZW1hSW5mbzsNCiAgICAgICAgICAgIFNjaGVtYUVsZW1lbnREZWNsIGVkID0gR2V0U2NoZW1hRWxlbWVudERlY2woZWxlbSk7DQogICAgICAgICAgICBpZiAoZWQgIT0gbnVsbCAmJiBlZC5BdHREZWZzICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSURpY3Rpb25hcnlFbnVtZXJhdG9yIGF0dHJEZWZzID0gZWQuQXR0RGVmcy5HZXRFbnVtZXJhdG9yKCk7DQogICAgICAgICAgICAgICAgd2hpbGUgKGF0dHJEZWZzLk1vdmVOZXh0KCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTY2hlbWFBdHREZWYgYXR0ZGVmID0gKFNjaGVtYUF0dERlZilhdHRyRGVmcy5WYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGRlZi5QcmVzZW5jZSA9PSBTY2hlbWFEZWNsQmFzZS5Vc2UuRGVmYXVsdCB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGRlZi5QcmVzZW5jZSA9PSBTY2hlbWFEZWNsQmFzZS5Vc2UuRml4ZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vYnVpbGQgYSBkZWZhdWx0IGF0dHJpYnV0ZSBhbmQgcmV0dXJuDQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgYXR0clByZWZpeCA9IHN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBhdHRyTG9jYWxuYW1lID0gYXR0ZGVmLk5hbWUuTmFtZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBhdHRyTmFtZXNwYWNlVVJJID0gc3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaEluZm8uU2NoZW1hVHlwZSA9PSBTY2hlbWFUeXBlLkRURCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyUHJlZml4ID0gYXR0ZGVmLk5hbWUuTmFtZXNwYWNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJQcmVmaXggPSBhdHRkZWYuUHJlZml4Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJOYW1lc3BhY2VVUkkgPSBhdHRkZWYuTmFtZS5OYW1lc3BhY2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBYbWxBdHRyaWJ1dGUgZGVmYXR0ciA9IFByZXBhcmVEZWZhdWx0QXR0cmlidXRlKGF0dGRlZiwgYXR0clByZWZpeCwgYXR0ckxvY2FsbmFtZSwgYXR0ck5hbWVzcGFjZVVSSSk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtLlNldEF0dHJpYnV0ZU5vZGUoZGVmYXR0cik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFNjaGVtYUVsZW1lbnREZWNsIEdldFNjaGVtYUVsZW1lbnREZWNsKFhtbEVsZW1lbnQgZWxlbSkNCiAgICAgICAgew0KICAgICAgICAgICAgU2NoZW1hSW5mbyBzY2hJbmZvID0gRHRkU2NoZW1hSW5mbzsNCiAgICAgICAgICAgIGlmIChzY2hJbmZvICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy9idWlsZCBYbWxRdWFsaWZpZWROYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIGVsZW1lbnQgc2NoZW1hIGRlY2xhcmF0aW9uDQogICAgICAgICAgICAgICAgWG1sUXVhbGlmaWVkTmFtZSBxbmFtZSA9IG5ldyBYbWxRdWFsaWZpZWROYW1lKGVsZW0uTG9jYWxOYW1lLCBzY2hJbmZvLlNjaGVtYVR5cGUgPT0gU2NoZW1hVHlwZS5EVEQgPyBlbGVtLlByZWZpeCA6IGVsZW0uTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgICAgICAvL2dldCB0aGUgc2NoZW1hIGluZm8gZm9yIHRoZSBlbGVtZW50DQogICAgICAgICAgICAgICAgU2NoZW1hRWxlbWVudERlY2wgZWxlbURlY2w7DQogICAgICAgICAgICAgICAgaWYgKHNjaEluZm8uRWxlbWVudERlY2xzLlRyeUdldFZhbHVlKHFuYW1lLCBvdXQgZWxlbURlY2wpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1EZWNsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9XaWxsIGJlIHVzZWQgYnkgQWRkRGVhZnVsYXRBdHRyaWJ1dGVzKCkgYW5kIEdldERlZmF1bHRBdHRyaWJ1dGUoKSBtZXRob2RzDQogICAgICAgIHByaXZhdGUgWG1sQXR0cmlidXRlIFByZXBhcmVEZWZhdWx0QXR0cmlidXRlKFNjaGVtYUF0dERlZiBhdHRkZWYsIHN0cmluZyBhdHRyUHJlZml4LCBzdHJpbmcgYXR0ckxvY2FsbmFtZSwgc3RyaW5nIGF0dHJOYW1lc3BhY2VVUkkpDQogICAgICAgIHsNCiAgICAgICAgICAgIFNldERlZmF1bHROYW1lc3BhY2UoYXR0clByZWZpeCwgYXR0ckxvY2FsbmFtZSwgcmVmIGF0dHJOYW1lc3BhY2VVUkkpOw0KICAgICAgICAgICAgWG1sQXR0cmlidXRlIGRlZmF0dHIgPSBDcmVhdGVEZWZhdWx0QXR0cmlidXRlKGF0dHJQcmVmaXgsIGF0dHJMb2NhbG5hbWUsIGF0dHJOYW1lc3BhY2VVUkkpOw0KICAgICAgICAgICAgLy9wYXJzaW5nIHRoZSBkZWZhdWx0IHZhbHVlIGZvciB0aGUgZGVmYXVsdCBhdHRyaWJ1dGUNCiAgICAgICAgICAgIGRlZmF0dHIuSW5uZXJYbWwgPSBhdHRkZWYuRGVmYXVsdFZhbHVlUmF3Ow0KICAgICAgICAgICAgLy9kdXJpbmcgdGhlIGV4cGFuc2lvbiBvZiB0aGUgdHJlZSwgdGhlIGZsYWcgY291bGQgYmUgc2V0IHRvIHRydWUsIHdlIG5lZWQgdG8gc2V0IGl0IGJhY2suDQogICAgICAgICAgICBYbWxVbnNwZWNpZmllZEF0dHJpYnV0ZSB1bnNwQXR0ciA9IGRlZmF0dHIgYXMgWG1sVW5zcGVjaWZpZWRBdHRyaWJ1dGU7DQogICAgICAgICAgICBpZiAodW5zcEF0dHIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1bnNwQXR0ci5TZXRTcGVjaWZpZWQoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGRlZmF0dHI7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGFuIFhtbEVudGl0eVJlZmVyZW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sRW50aXR5UmVmZXJlbmNlIENyZWF0ZUVudGl0eVJlZmVyZW5jZShTdHJpbmcgbmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxFbnRpdHlSZWZlcmVuY2UobmFtZSwgdGhpcyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGEgWG1sUHJvY2Vzc2luZ0luc3RydWN0aW9uIHdpdGggdGhlIHNwZWNpZmllZCBuYW1lDQogICAgICAgIC8vIGFuZCBkYXRhIHN0cmluZ3MuDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhtbFByb2Nlc3NpbmdJbnN0cnVjdGlvbiBDcmVhdGVQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24oU3RyaW5nIHRhcmdldCwgU3RyaW5nIGRhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgWG1sUHJvY2Vzc2luZ0luc3RydWN0aW9uKHRhcmdldCwgZGF0YSwgdGhpcyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGEgWG1sRGVjbGFyYXRpb24gbm9kZSB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWVzLg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxEZWNsYXJhdGlvbiBDcmVhdGVYbWxEZWNsYXJhdGlvbihTdHJpbmcgdmVyc2lvbiwgc3RyaW5nIGVuY29kaW5nLCBzdHJpbmcgc3RhbmRhbG9uZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxEZWNsYXJhdGlvbih2ZXJzaW9uLCBlbmNvZGluZywgc3RhbmRhbG9uZSwgdGhpcyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGFuIFhtbFRleHQgd2l0aCB0aGUgc3BlY2lmaWVkIHRleHQuDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhtbFRleHQgQ3JlYXRlVGV4dE5vZGUoU3RyaW5nIHRleHQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgWG1sVGV4dCh0ZXh0LCB0aGlzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENyZWF0ZXMgYSBYbWxTaWduaWZpY2FudFdoaXRlc3BhY2Ugbm9kZS4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sU2lnbmlmaWNhbnRXaGl0ZXNwYWNlIENyZWF0ZVNpZ25pZmljYW50V2hpdGVzcGFjZShzdHJpbmcgdGV4dCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxTaWduaWZpY2FudFdoaXRlc3BhY2UodGV4dCwgdGhpcyk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgWFBhdGhOYXZpZ2F0b3IgQ3JlYXRlTmF2aWdhdG9yKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIENyZWF0ZU5hdmlnYXRvcih0aGlzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByb3RlY3RlZCBpbnRlcm5hbCB2aXJ0dWFsIFhQYXRoTmF2aWdhdG9yIENyZWF0ZU5hdmlnYXRvcihYbWxOb2RlIG5vZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbE5vZGVUeXBlIG5vZGVUeXBlID0gbm9kZS5Ob2RlVHlwZTsNCiAgICAgICAgICAgIFhtbE5vZGUgcGFyZW50Ow0KICAgICAgICAgICAgWG1sTm9kZVR5cGUgcGFyZW50VHlwZTsNCg0KICAgICAgICAgICAgc3dpdGNoIChub2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVudGl0eVJlZmVyZW5jZToNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVudGl0eToNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkRvY3VtZW50VHlwZToNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLk5vdGF0aW9uOg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuWG1sRGVjbGFyYXRpb246DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuVGV4dDoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNEQVRBOg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuU2lnbmlmaWNhbnRXaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBub2RlLlBhcmVudE5vZGU7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRUeXBlID0gcGFyZW50Lk5vZGVUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnRUeXBlID09IFhtbE5vZGVUeXBlLkF0dHJpYnV0ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJlbnRUeXBlID09IFhtbE5vZGVUeXBlLkVudGl0eVJlZmVyZW5jZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5QYXJlbnROb2RlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocGFyZW50ICE9IG51bGwpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIG5vZGUgPSBOb3JtYWxpemVUZXh0KG5vZGUpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLldoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IG5vZGUuUGFyZW50Tm9kZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFR5cGUgPSBwYXJlbnQuTm9kZVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudFR5cGUgPT0gWG1sTm9kZVR5cGUuRG9jdW1lbnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgcGFyZW50VHlwZSA9PSBYbWxOb2RlVHlwZS5BdHRyaWJ1dGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyZW50VHlwZSA9PSBYbWxOb2RlVHlwZS5FbnRpdHlSZWZlcmVuY2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQuUGFyZW50Tm9kZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHBhcmVudCAhPSBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBub2RlID0gTm9ybWFsaXplVGV4dChub2RlKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50WFBhdGhOYXZpZ2F0b3IodGhpcywgbm9kZSk7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgYm9vbCBJc1RleHROb2RlKFhtbE5vZGVUeXBlIG50KQ0KICAgICAgICB7DQogICAgICAgICAgICBzd2l0Y2ggKG50KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuVGV4dDoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNEQVRBOg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuV2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxOb2RlIE5vcm1hbGl6ZVRleHQoWG1sTm9kZSBuKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxOb2RlIHJldG5vZGUgPSBudWxsOw0KICAgICAgICAgICAgd2hpbGUgKElzVGV4dE5vZGUobi5Ob2RlVHlwZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0bm9kZSA9IG47DQogICAgICAgICAgICAgICAgbiA9IG4uUHJldmlvdXNTaWJsaW5nOw0KDQogICAgICAgICAgICAgICAgaWYgKG4gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbE5vZGUgaW50bm9kZSA9IHJldG5vZGU7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50bm9kZS5QYXJlbnROb2RlICE9IG51bGwgJiYgaW50bm9kZS5QYXJlbnROb2RlLk5vZGVUeXBlID09IFhtbE5vZGVUeXBlLkVudGl0eVJlZmVyZW5jZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50bm9kZS5QYXJlbnROb2RlLlByZXZpb3VzU2libGluZyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGludG5vZGUuUGFyZW50Tm9kZS5QcmV2aW91c1NpYmxpbmc7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRub2RlID0gaW50bm9kZS5QYXJlbnROb2RlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50bm9kZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKG4gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgd2hpbGUgKG4uTm9kZVR5cGUgPT0gWG1sTm9kZVR5cGUuRW50aXR5UmVmZXJlbmNlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgbiA9IG4uTGFzdENoaWxkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXRub2RlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ3JlYXRlcyBhIFhtbFdoaXRlc3BhY2Ugbm9kZS4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sV2hpdGVzcGFjZSBDcmVhdGVXaGl0ZXNwYWNlKHN0cmluZyB0ZXh0KQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhtbFdoaXRlc3BhY2UodGV4dCwgdGhpcyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIGFuIFhtbE5vZGVMaXN0IGNvbnRhaW5pbmcNCiAgICAgICAgLy8gYSBsaXN0IG9mIGFsbCBkZXNjZW5kYW50IGVsZW1lbnRzIHRoYXQgbWF0Y2ggdGhlIHNwZWNpZmllZCBuYW1lLg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxOb2RlTGlzdCBHZXRFbGVtZW50c0J5VGFnTmFtZShTdHJpbmcgbmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxFbGVtZW50TGlzdCh0aGlzLCBuYW1lKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIERPTSBMZXZlbCAyDQoNCiAgICAgICAgLy8gQ3JlYXRlcyBhbiBYbWxBdHRyaWJ1dGUgd2l0aCB0aGUgc3BlY2lmaWVkIExvY2FsTmFtZQ0KICAgICAgICAvLyBhbmQgTmFtZXNwYWNlVVJJLg0KICAgICAgICBwdWJsaWMgWG1sQXR0cmlidXRlIENyZWF0ZUF0dHJpYnV0ZShTdHJpbmcgcXVhbGlmaWVkTmFtZSwgU3RyaW5nIG5hbWVzcGFjZVVSSSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHByZWZpeCA9IFN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgIHN0cmluZyBsb2NhbE5hbWUgPSBTdHJpbmcuRW1wdHk7DQoNCiAgICAgICAgICAgIFNwbGl0TmFtZShxdWFsaWZpZWROYW1lLCBvdXQgcHJlZml4LCBvdXQgbG9jYWxOYW1lKTsNCiAgICAgICAgICAgIHJldHVybiBDcmVhdGVBdHRyaWJ1dGUocHJlZml4LCBsb2NhbE5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGFuIFhtbEVsZW1lbnQgd2l0aCB0aGUgc3BlY2lmaWVkIExvY2FsTmFtZSBhbmQNCiAgICAgICAgLy8gTmFtZXNwYWNlVVJJLg0KICAgICAgICBwdWJsaWMgWG1sRWxlbWVudCBDcmVhdGVFbGVtZW50KFN0cmluZyBxdWFsaWZpZWROYW1lLCBTdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgcHJlZml4ID0gU3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgc3RyaW5nIGxvY2FsTmFtZSA9IFN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgIFNwbGl0TmFtZShxdWFsaWZpZWROYW1lLCBvdXQgcHJlZml4LCBvdXQgbG9jYWxOYW1lKTsNCiAgICAgICAgICAgIHJldHVybiBDcmVhdGVFbGVtZW50KHByZWZpeCwgbG9jYWxOYW1lLCBuYW1lc3BhY2VVUkkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyBhIFhtbE5vZGVMaXN0IGNvbnRhaW5pbmcNCiAgICAgICAgLy8gYSBsaXN0IG9mIGFsbCBkZXNjZW5kYW50IGVsZW1lbnRzIHRoYXQgbWF0Y2ggdGhlIHNwZWNpZmllZCBuYW1lLg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxOb2RlTGlzdCBHZXRFbGVtZW50c0J5VGFnTmFtZShTdHJpbmcgbG9jYWxOYW1lLCBTdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhtbEVsZW1lbnRMaXN0KHRoaXMsIGxvY2FsTmFtZSwgbmFtZXNwYWNlVVJJKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgdGhlIFhtbEVsZW1lbnQgd2l0aCB0aGUgc3BlY2lmaWVkIElELg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxFbGVtZW50IEdldEVsZW1lbnRCeUlkKHN0cmluZyBlbGVtZW50SWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChfaHRFbGVtZW50SWRNYXAgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBcnJheUxpc3QgZWxlbWVudExpc3QgPSAoQXJyYXlMaXN0KShfaHRFbGVtZW50SWRNYXBbZWxlbWVudElkXSk7DQogICAgICAgICAgICAgICAgaWYgKGVsZW1lbnRMaXN0ICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChXZWFrUmVmZXJlbmNlIGVsZW1SZWYgaW4gZWxlbWVudExpc3QpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbEVsZW1lbnQgZWxlbSA9IChYbWxFbGVtZW50KWVsZW1SZWYuVGFyZ2V0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0gIT0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIGVsZW0uSXNDb25uZWN0ZWQoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gSW1wb3J0cyBhIG5vZGUgZnJvbSBhbm90aGVyIGRvY3VtZW50IHRvIHRoaXMgZG9jdW1lbnQuDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhtbE5vZGUgSW1wb3J0Tm9kZShYbWxOb2RlIG5vZGUsIGJvb2wgZGVlcCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIEltcG9ydE5vZGVJbnRlcm5hbChub2RlLCBkZWVwKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgWG1sTm9kZSBJbXBvcnROb2RlSW50ZXJuYWwoWG1sTm9kZSBub2RlLCBib29sIGRlZXApDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbE5vZGUgbmV3Tm9kZSA9IG51bGw7DQoNCiAgICAgICAgICAgIGlmIChub2RlID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWGRvbV9JbXBvcnRfTnVsbE5vZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAobm9kZS5Ob2RlVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRWxlbWVudDoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld05vZGUgPSBDcmVhdGVFbGVtZW50KG5vZGUuUHJlZml4LCBub2RlLkxvY2FsTmFtZSwgbm9kZS5OYW1lc3BhY2VVUkkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgSW1wb3J0QXR0cmlidXRlcyhub2RlLCBuZXdOb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWVwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEltcG9ydENoaWxkcmVuKG5vZGUsIG5ld05vZGUsIGRlZXApOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5BdHRyaWJ1dGU6DQogICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQoKChYbWxBdHRyaWJ1dGUpbm9kZSkuU3BlY2lmaWVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld05vZGUgPSBDcmVhdGVBdHRyaWJ1dGUobm9kZS5QcmVmaXgsIG5vZGUuTG9jYWxOYW1lLCBub2RlLk5hbWVzcGFjZVVSSSk7DQogICAgICAgICAgICAgICAgICAgICAgICBJbXBvcnRDaGlsZHJlbihub2RlLCBuZXdOb2RlLCB0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuVGV4dDoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld05vZGUgPSBDcmVhdGVUZXh0Tm9kZShub2RlLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNvbW1lbnQ6DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdOb2RlID0gQ3JlYXRlQ29tbWVudChub2RlLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlByb2Nlc3NpbmdJbnN0cnVjdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld05vZGUgPSBDcmVhdGVQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24obm9kZS5OYW1lLCBub2RlLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlhtbERlY2xhcmF0aW9uOg0KICAgICAgICAgICAgICAgICAgICAgICAgWG1sRGVjbGFyYXRpb24gZGVjbCA9IChYbWxEZWNsYXJhdGlvbilub2RlOw0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZSA9IENyZWF0ZVhtbERlY2xhcmF0aW9uKGRlY2wuVmVyc2lvbiwgZGVjbC5FbmNvZGluZywgZGVjbC5TdGFuZGFsb25lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNEQVRBOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZSA9IENyZWF0ZUNEYXRhU2VjdGlvbihub2RlLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkRvY3VtZW50VHlwZToNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbERvY3VtZW50VHlwZSBkb2NUeXBlID0gKFhtbERvY3VtZW50VHlwZSlub2RlOw0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZSA9IENyZWF0ZURvY3VtZW50VHlwZShkb2NUeXBlLk5hbWUsIGRvY1R5cGUuUHVibGljSWQsIGRvY1R5cGUuU3lzdGVtSWQsIGRvY1R5cGUuSW50ZXJuYWxTdWJzZXQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRG9jdW1lbnRGcmFnbWVudDoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld05vZGUgPSBDcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVlcCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbXBvcnRDaGlsZHJlbihub2RlLCBuZXdOb2RlLCBkZWVwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRW50aXR5UmVmZXJlbmNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZSA9IENyZWF0ZUVudGl0eVJlZmVyZW5jZShub2RlLk5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgZG9uJ3QgaW1wb3J0IHRoZSBjaGlsZHJlbiBvZiBlbnRpdHkgcmVmZXJlbmNlIGJlY2F1c2UgdGhleSBtaWdodCByZXN1bHQgaW4gZGlmZmVyZW50DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGlsZHJlbiBub2RlcyBnaXZlbiBkaWZmZXJlbnQgbmFtZXNwYWNlIGNvbnRleHQgaW4gdGhlIG5ldyBkb2N1bWVudC4NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuV2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld05vZGUgPSBDcmVhdGVXaGl0ZXNwYWNlKG5vZGUuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5TaWduaWZpY2FudFdoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdOb2RlID0gQ3JlYXRlU2lnbmlmaWNhbnRXaGl0ZXNwYWNlKG5vZGUuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFN0cmluZy5Gb3JtYXQoQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgU1IuWGRvbV9JbXBvcnQsIG5vZGUuTm9kZVR5cGUuVG9TdHJpbmcoKSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIG5ld05vZGU7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgSW1wb3J0QXR0cmlidXRlcyhYbWxOb2RlIGZyb21FbGVtLCBYbWxOb2RlIHRvRWxlbSkNCiAgICAgICAgew0KICAgICAgICAgICAgaW50IGNBdHRyID0gZnJvbUVsZW0uQXR0cmlidXRlcy5Db3VudDsNCiAgICAgICAgICAgIGZvciAoaW50IGlBdHRyID0gMDsgaUF0dHIgPCBjQXR0cjsgaUF0dHIrKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoZnJvbUVsZW0uQXR0cmlidXRlc1tpQXR0cl0uU3BlY2lmaWVkKQ0KICAgICAgICAgICAgICAgICAgICB0b0VsZW0uQXR0cmlidXRlcy5TZXROYW1lZEl0ZW0oSW1wb3J0Tm9kZUludGVybmFsKGZyb21FbGVtLkF0dHJpYnV0ZXNbaUF0dHJdLCB0cnVlKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgSW1wb3J0Q2hpbGRyZW4oWG1sTm9kZSBmcm9tTm9kZSwgWG1sTm9kZSB0b05vZGUsIGJvb2wgZGVlcCkNCiAgICAgICAgew0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KHRvTm9kZS5Ob2RlVHlwZSAhPSBYbWxOb2RlVHlwZS5FbnRpdHlSZWZlcmVuY2UpOw0KICAgICAgICAgICAgZm9yIChYbWxOb2RlIG4gPSBmcm9tTm9kZS5GaXJzdENoaWxkOyBuICE9IG51bGw7IG4gPSBuLk5leHRTaWJsaW5nKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRvTm9kZS5BcHBlbmRDaGlsZChJbXBvcnROb2RlSW50ZXJuYWwobiwgZGVlcCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTWljcm9zb2Z0IGV4dGVuc2lvbnMNCg0KICAgICAgICAvLyBHZXRzIHRoZSBYbWxOYW1lVGFibGUgYXNzb2NpYXRlZCB3aXRoIHRoaXMNCiAgICAgICAgLy8gaW1wbGVtZW50YXRpb24uDQogICAgICAgIHB1YmxpYyBYbWxOYW1lVGFibGUgTmFtZVRhYmxlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaW1wbGVtZW50YXRpb24uTmFtZVRhYmxlOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGEgWG1sQXR0cmlidXRlIHdpdGggdGhlIHNwZWNpZmllZCBQcmVmaXgsIExvY2FsTmFtZSwNCiAgICAgICAgLy8gYW5kIE5hbWVzcGFjZVVSSS4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sQXR0cmlidXRlIENyZWF0ZUF0dHJpYnV0ZShzdHJpbmcgcHJlZml4LCBzdHJpbmcgbG9jYWxOYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhtbEF0dHJpYnV0ZShBZGRBdHRyWG1sTmFtZShwcmVmaXgsIGxvY2FsTmFtZSwgbmFtZXNwYWNlVVJJLCBudWxsKSwgdGhpcyk7DQogICAgICAgIH0NCg0KICAgICAgICBwcm90ZWN0ZWQgaW50ZXJuYWwgdmlydHVhbCBYbWxBdHRyaWJ1dGUgQ3JlYXRlRGVmYXVsdEF0dHJpYnV0ZShzdHJpbmcgcHJlZml4LCBzdHJpbmcgbG9jYWxOYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhtbFVuc3BlY2lmaWVkQXR0cmlidXRlKHByZWZpeCwgbG9jYWxOYW1lLCBuYW1lc3BhY2VVUkksIHRoaXMpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sRWxlbWVudCBDcmVhdGVFbGVtZW50KHN0cmluZyBwcmVmaXgsIHN0cmluZyBsb2NhbE5hbWUsIHN0cmluZyBuYW1lc3BhY2VVUkkpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbEVsZW1lbnQgZWxlbSA9IG5ldyBYbWxFbGVtZW50KEFkZFhtbE5hbWUocHJlZml4LCBsb2NhbE5hbWUsIG5hbWVzcGFjZVVSSSwgbnVsbCksIHRydWUsIHRoaXMpOw0KICAgICAgICAgICAgaWYgKCFJc0xvYWRpbmcpDQogICAgICAgICAgICAgICAgQWRkRGVmYXVsdEF0dHJpYnV0ZXMoZWxlbSk7DQogICAgICAgICAgICByZXR1cm4gZWxlbTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEdldHMgb3Igc2V0cyBhIHZhbHVlIGluZGljYXRpbmcgd2hldGhlciB0byBwcmVzZXJ2ZSB3aGl0ZXNwYWNlLg0KICAgICAgICBwdWJsaWMgYm9vbCBQcmVzZXJ2ZVdoaXRlc3BhY2UNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9wcmVzZXJ2ZVdoaXRlc3BhY2U7IH0NCiAgICAgICAgICAgIHNldCB7IF9wcmVzZXJ2ZVdoaXRlc3BhY2UgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gR2V0cyBhIHZhbHVlIGluZGljYXRpbmcgd2hldGhlciB0aGUgbm9kZSBpcyByZWFkLW9ubHkuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIElzUmVhZE9ubHkNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxOYW1lZE5vZGVNYXAgRW50aXRpZXMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF9lbnRpdGllcyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBfZW50aXRpZXMgPSBuZXcgWG1sTmFtZWROb2RlTWFwKHRoaXMpOw0KICAgICAgICAgICAgICAgIHJldHVybiBfZW50aXRpZXM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXQgeyBfZW50aXRpZXMgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBJc0xvYWRpbmcNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9pc0xvYWRpbmc7IH0NCiAgICAgICAgICAgIHNldCB7IF9pc0xvYWRpbmcgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgYm9vbCBBY3R1YWxMb2FkaW5nU3RhdHVzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfYWN0dWFsTG9hZGluZ1N0YXR1czsgfQ0KICAgICAgICAgICAgc2V0IHsgX2FjdHVhbExvYWRpbmdTdGF0dXMgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvLyBDcmVhdGVzIGEgWG1sTm9kZSB3aXRoIHRoZSBzcGVjaWZpZWQgWG1sTm9kZVR5cGUsIFByZWZpeCwgTmFtZSwgYW5kIE5hbWVzcGFjZVVSSS4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sTm9kZSBDcmVhdGVOb2RlKFhtbE5vZGVUeXBlIHR5cGUsIHN0cmluZyBwcmVmaXgsIHN0cmluZyBuYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5FbGVtZW50Og0KICAgICAgICAgICAgICAgICAgICBpZiAocHJlZml4ICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ3JlYXRlRWxlbWVudChwcmVmaXgsIG5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDcmVhdGVFbGVtZW50KG5hbWUsIG5hbWVzcGFjZVVSSSk7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkF0dHJpYnV0ZToNCiAgICAgICAgICAgICAgICAgICAgaWYgKHByZWZpeCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENyZWF0ZUF0dHJpYnV0ZShwcmVmaXgsIG5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDcmVhdGVBdHRyaWJ1dGUobmFtZSwgbmFtZXNwYWNlVVJJKTsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuVGV4dDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENyZWF0ZVRleHROb2RlKHN0cmluZy5FbXB0eSk7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNEQVRBOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ3JlYXRlQ0RhdGFTZWN0aW9uKHN0cmluZy5FbXB0eSk7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVudGl0eVJlZmVyZW5jZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENyZWF0ZUVudGl0eVJlZmVyZW5jZShuYW1lKTsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuUHJvY2Vzc2luZ0luc3RydWN0aW9uOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ3JlYXRlUHJvY2Vzc2luZ0luc3RydWN0aW9uKG5hbWUsIHN0cmluZy5FbXB0eSk7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlhtbERlY2xhcmF0aW9uOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ3JlYXRlWG1sRGVjbGFyYXRpb24oIjEuMCIsIG51bGwsIG51bGwpOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Db21tZW50Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ3JlYXRlQ29tbWVudChzdHJpbmcuRW1wdHkpOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Eb2N1bWVudEZyYWdtZW50Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Eb2N1bWVudFR5cGU6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDcmVhdGVEb2N1bWVudFR5cGUobmFtZSwgc3RyaW5nLkVtcHR5LCBzdHJpbmcuRW1wdHksIHN0cmluZy5FbXB0eSk7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkRvY3VtZW50Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFhtbERvY3VtZW50KCk7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENyZWF0ZVNpZ25pZmljYW50V2hpdGVzcGFjZShzdHJpbmcuRW1wdHkpOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5XaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ3JlYXRlV2hpdGVzcGFjZShzdHJpbmcuRW1wdHkpOw0KDQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uKFNSLkZvcm1hdChTUi5BcmdfQ2Fubm90Q3JlYXRlTm9kZSwgdHlwZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ3JlYXRlcyBhbiBYbWxOb2RlIHdpdGggdGhlIHNwZWNpZmllZCBub2RlIHR5cGUsIE5hbWUsIGFuZA0KICAgICAgICAvLyBOYW1lc3BhY2VVUkkuDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhtbE5vZGUgQ3JlYXRlTm9kZShzdHJpbmcgbm9kZVR5cGVTdHJpbmcsIHN0cmluZyBuYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gQ3JlYXRlTm9kZShDb252ZXJ0VG9Ob2RlVHlwZShub2RlVHlwZVN0cmluZyksIG5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGFuIFhtbE5vZGUgd2l0aCB0aGUgc3BlY2lmaWVkIFhtbE5vZGVUeXBlLCBOYW1lLCBhbmQNCiAgICAgICAgLy8gTmFtZXNwYWNlVVJJLg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxOb2RlIENyZWF0ZU5vZGUoWG1sTm9kZVR5cGUgdHlwZSwgc3RyaW5nIG5hbWUsIHN0cmluZyBuYW1lc3BhY2VVUkkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBDcmVhdGVOb2RlKHR5cGUsIG51bGwsIG5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDcmVhdGVzIGFuIFhtbE5vZGUgb2JqZWN0IGJhc2VkIG9uIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgWG1sUmVhZGVyLg0KICAgICAgICAvLyBUaGUgcmVhZGVyIG11c3QgYmUgcG9zaXRpb25lZCBvbiBhIG5vZGUgb3IgYXR0cmlidXRlLg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxOb2RlIFJlYWROb2RlKFhtbFJlYWRlciByZWFkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbE5vZGUgbm9kZSA9IG51bGw7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJc0xvYWRpbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgIFhtbExvYWRlciBsb2FkZXIgPSBuZXcgWG1sTG9hZGVyKCk7DQogICAgICAgICAgICAgICAgbm9kZSA9IGxvYWRlci5SZWFkQ3VycmVudE5vZGUodGhpcywgcmVhZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJc0xvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBub2RlOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgWG1sTm9kZVR5cGUgQ29udmVydFRvTm9kZVR5cGUoc3RyaW5nIG5vZGVUeXBlU3RyaW5nKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAobm9kZVR5cGVTdHJpbmcgPT0gImVsZW1lbnQiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBYbWxOb2RlVHlwZS5FbGVtZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZVR5cGVTdHJpbmcgPT0gImF0dHJpYnV0ZSIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFhtbE5vZGVUeXBlLkF0dHJpYnV0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlU3RyaW5nID09ICJ0ZXh0IikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gWG1sTm9kZVR5cGUuVGV4dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlU3RyaW5nID09ICJjZGF0YXNlY3Rpb24iKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBYbWxOb2RlVHlwZS5DREFUQTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlU3RyaW5nID09ICJlbnRpdHlyZWZlcmVuY2UiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBYbWxOb2RlVHlwZS5FbnRpdHlSZWZlcmVuY2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChub2RlVHlwZVN0cmluZyA9PSAiZW50aXR5IikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gWG1sTm9kZVR5cGUuRW50aXR5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZVR5cGVTdHJpbmcgPT0gInByb2Nlc3NpbmdpbnN0cnVjdGlvbiIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFhtbE5vZGVUeXBlLlByb2Nlc3NpbmdJbnN0cnVjdGlvbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlU3RyaW5nID09ICJjb21tZW50IikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gWG1sTm9kZVR5cGUuQ29tbWVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlU3RyaW5nID09ICJkb2N1bWVudCIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFhtbE5vZGVUeXBlLkRvY3VtZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZVR5cGVTdHJpbmcgPT0gImRvY3VtZW50dHlwZSIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFhtbE5vZGVUeXBlLkRvY3VtZW50VHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlU3RyaW5nID09ICJkb2N1bWVudGZyYWdtZW50IikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gWG1sTm9kZVR5cGUuRG9jdW1lbnRGcmFnbWVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlU3RyaW5nID09ICJub3RhdGlvbiIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFhtbE5vZGVUeXBlLk5vdGF0aW9uOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZVR5cGVTdHJpbmcgPT0gInNpZ25pZmljYW50d2hpdGVzcGFjZSIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFhtbE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlU3RyaW5nID09ICJ3aGl0ZXNwYWNlIikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gWG1sTm9kZVR5cGUuV2hpdGVzcGFjZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudEV4Y2VwdGlvbihTUi5Gb3JtYXQoU1IuWGRvbV9JbnZhbGlkX05UX1N0cmluZywgbm9kZVR5cGVTdHJpbmcpKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgcHJpdmF0ZSBYbWxUZXh0UmVhZGVyIFNldHVwUmVhZGVyKFhtbFRleHRSZWFkZXIgdHIpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyLlhtbFZhbGlkYXRpbmdSZWFkZXJDb21wYXRpYmlsaXR5TW9kZSA9IHRydWU7DQogICAgICAgICAgICB0ci5FbnRpdHlIYW5kbGluZyA9IEVudGl0eUhhbmRsaW5nLkV4cGFuZENoYXJFbnRpdGllczsNCiAgICAgICAgICAgIGlmICh0aGlzLkhhc1NldFJlc29sdmVyKQ0KICAgICAgICAgICAgICAgIHRyLlhtbFJlc29sdmVyID0gR2V0UmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHJldHVybiB0cjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIExvYWRzIHRoZSBYTUwgZG9jdW1lbnQgZnJvbSB0aGUgc3BlY2lmaWVkIFVSTC4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBMb2FkKHN0cmluZyBmaWxlbmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciByZWFkZXIgPSBTZXR1cFJlYWRlcihuZXcgWG1sVGV4dFJlYWRlcihmaWxlbmFtZSwgTmFtZVRhYmxlKSk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkKHJlYWRlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVhZGVyLkNsb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIExvYWQoU3RyZWFtIGluU3RyZWFtKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxUZXh0UmVhZGVyIHJlYWRlciA9IFNldHVwUmVhZGVyKG5ldyBYbWxUZXh0UmVhZGVyKGluU3RyZWFtLCBOYW1lVGFibGUpKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWQocmVhZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZWFkZXIuSW1wbC5DbG9zZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBMb2FkcyB0aGUgWE1MIGRvY3VtZW50IGZyb20gdGhlIHNwZWNpZmllZCBUZXh0UmVhZGVyLg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIExvYWQoVGV4dFJlYWRlciB0eHRSZWFkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgcmVhZGVyID0gU2V0dXBSZWFkZXIobmV3IFhtbFRleHRSZWFkZXIodHh0UmVhZGVyLCBOYW1lVGFibGUpKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWQocmVhZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZWFkZXIuSW1wbC5DbG9zZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBMb2FkcyB0aGUgWE1MIGRvY3VtZW50IGZyb20gdGhlIHNwZWNpZmllZCBYbWxSZWFkZXIuDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgTG9hZChYbWxSZWFkZXIgcmVhZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJc0xvYWRpbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgIF9hY3R1YWxMb2FkaW5nU3RhdHVzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBSZW1vdmVBbGwoKTsNCiAgICAgICAgICAgICAgICBmRW50UmVmTm9kZXNQcmVzZW50ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgZkNEYXRhTm9kZXNQcmVzZW50ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgX3JlcG9ydFZhbGlkaXR5ID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIFhtbExvYWRlciBsb2FkZXIgPSBuZXcgWG1sTG9hZGVyKCk7DQogICAgICAgICAgICAgICAgbG9hZGVyLkxvYWQodGhpcywgcmVhZGVyLCBfcHJlc2VydmVXaGl0ZXNwYWNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJc0xvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBfYWN0dWFsTG9hZGluZ1N0YXR1cyA9IGZhbHNlOw0KDQogICAgICAgICAgICAgICAgLy8gRW5zdXJlIHRoZSBiaXQgaXMgc3RpbGwgb24gYWZ0ZXIgbG9hZGluZyBhIGR0ZCANCiAgICAgICAgICAgICAgICBfcmVwb3J0VmFsaWRpdHkgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTG9hZHMgdGhlIFhNTCBkb2N1bWVudCBmcm9tIHRoZSBzcGVjaWZpZWQgc3RyaW5nLg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIExvYWRYbWwoc3RyaW5nIHhtbCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciByZWFkZXIgPSBTZXR1cFJlYWRlcihuZXcgWG1sVGV4dFJlYWRlcihuZXcgU3RyaW5nUmVhZGVyKHhtbCksIE5hbWVUYWJsZSkpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZChyZWFkZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlYWRlci5DbG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9UZXh0RW5jb2RpbmcgaXMgdGhlIG9uZSBmcm9tIFhtbERlY2xhcmF0aW9uIGlmIHRoZXJlIGlzIGFueQ0KICAgICAgICBpbnRlcm5hbCBFbmNvZGluZyBUZXh0RW5jb2RpbmcNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKERlY2xhcmF0aW9uICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgdmFsdWUgPSBEZWNsYXJhdGlvbi5FbmNvZGluZzsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLkxlbmd0aCA+IDApDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTeXN0ZW0uVGV4dC5FbmNvZGluZy5HZXRFbmNvZGluZyh2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgc3RyaW5nIElubmVyVGV4dA0KICAgICAgICB7DQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YZG9tX0RvY3VtZW50X0lubmVydGV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgc3RyaW5nIElubmVyWG1sDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBiYXNlLklubmVyWG1sOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhtbCh2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBTYXZlcyB0aGUgWE1MIGRvY3VtZW50IHRvIHRoZSBzcGVjaWZpZWQgZmlsZS4NCiAgICAgICAgLy9TYXZlcyBvdXQgdGhlIHRvIHRoZSBmaWxlIHdpdGggZXhhY3QgY29udGVudCBpbiB0aGUgWG1sRG9jdW1lbnQuDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgU2F2ZShzdHJpbmcgZmlsZW5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChEb2N1bWVudEVsZW1lbnQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgWG1sRXhjZXB0aW9uKFNSLlhtbF9JbnZhbGlkWG1sRG9jdW1lbnQsIFNSLlhkb21fTm9Sb290RWxlKTsNCiAgICAgICAgICAgIFhtbERPTVRleHRXcml0ZXIgeHcgPSBuZXcgWG1sRE9NVGV4dFdyaXRlcihmaWxlbmFtZSwgVGV4dEVuY29kaW5nKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfcHJlc2VydmVXaGl0ZXNwYWNlID09IGZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICB4dy5Gb3JtYXR0aW5nID0gRm9ybWF0dGluZy5JbmRlbnRlZDsNCiAgICAgICAgICAgICAgICBXcml0ZVRvKHh3KTsNCiAgICAgICAgICAgICAgICB4dy5GbHVzaCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHh3LkNsb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL1NhdmVzIG91dCB0aGUgdG8gdGhlIGZpbGUgd2l0aCBleGFjdCBjb250ZW50IGluIHRoZSBYbWxEb2N1bWVudC4NCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBTYXZlKFN0cmVhbSBvdXRTdHJlYW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbERPTVRleHRXcml0ZXIgeHcgPSBuZXcgWG1sRE9NVGV4dFdyaXRlcihvdXRTdHJlYW0sIFRleHRFbmNvZGluZyk7DQogICAgICAgICAgICBpZiAoX3ByZXNlcnZlV2hpdGVzcGFjZSA9PSBmYWxzZSkNCiAgICAgICAgICAgICAgICB4dy5Gb3JtYXR0aW5nID0gRm9ybWF0dGluZy5JbmRlbnRlZDsNCiAgICAgICAgICAgIFdyaXRlVG8oeHcpOw0KICAgICAgICAgICAgeHcuRmx1c2goKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFNhdmVzIHRoZSBYTUwgZG9jdW1lbnQgdG8gdGhlIHNwZWNpZmllZCBUZXh0V3JpdGVyLg0KICAgICAgICAvLw0KICAgICAgICAvL1NhdmVzIG91dCB0aGUgZmlsZSB3aXRoIHhtbGRlY2xhcmF0aW9uIHdoaWNoIGhhcyBlbmNvZGluZyB2YWx1ZSBlcXVhbCB0bw0KICAgICAgICAvL3RoYXQgb2YgdGV4dHdyaXRlcidzIGVuY29kaW5nDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgU2F2ZShUZXh0V3JpdGVyIHdyaXRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sRE9NVGV4dFdyaXRlciB4dyA9IG5ldyBYbWxET01UZXh0V3JpdGVyKHdyaXRlcik7DQogICAgICAgICAgICBpZiAoX3ByZXNlcnZlV2hpdGVzcGFjZSA9PSBmYWxzZSkNCiAgICAgICAgICAgICAgICB4dy5Gb3JtYXR0aW5nID0gRm9ybWF0dGluZy5JbmRlbnRlZDsNCiAgICAgICAgICAgIFNhdmUoeHcpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU2F2ZXMgdGhlIFhNTCBkb2N1bWVudCB0byB0aGUgc3BlY2lmaWVkIFhtbFdyaXRlci4NCiAgICAgICAgLy8gDQogICAgICAgIC8vU2F2ZXMgb3V0IHRoZSBmaWxlIHdpdGggeG1sZGVjbGFyYXRpb24gd2hpY2ggaGFzIGVuY29kaW5nIHZhbHVlIGVxdWFsIHRvDQogICAgICAgIC8vdGhhdCBvZiB0ZXh0d3JpdGVyJ3MgZW5jb2RpbmcNCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBTYXZlKFhtbFdyaXRlciB3KQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxOb2RlIG4gPSB0aGlzLkZpcnN0Q2hpbGQ7DQogICAgICAgICAgICBpZiAobiA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIGlmICh3LldyaXRlU3RhdGUgPT0gV3JpdGVTdGF0ZS5TdGFydCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobiBpcyBYbWxEZWNsYXJhdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChTdGFuZGFsb25lLkxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdy5Xcml0ZVN0YXJ0RG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoU3RhbmRhbG9uZSA9PSAieWVzIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHcuV3JpdGVTdGFydERvY3VtZW50KHRydWUpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChTdGFuZGFsb25lID09ICJubyIpDQogICAgICAgICAgICAgICAgICAgICAgICB3LldyaXRlU3RhcnREb2N1bWVudChmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIG4gPSBuLk5leHRTaWJsaW5nOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB3LldyaXRlU3RhcnREb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHdoaWxlIChuICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbi5Xcml0ZVRvKHcpOw0KICAgICAgICAgICAgICAgIG4gPSBuLk5leHRTaWJsaW5nOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdy5GbHVzaCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU2F2ZXMgdGhlIG5vZGUgdG8gdGhlIHNwZWNpZmllZCBYbWxXcml0ZXIuDQogICAgICAgIC8vIA0KICAgICAgICAvL1dyaXRlcyBvdXQgdGhlIHRvIHRoZSBmaWxlIHdpdGggZXhhY3QgY29udGVudCBpbiB0aGUgWG1sRG9jdW1lbnQuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFdyaXRlVG8oWG1sV3JpdGVyIHcpDQogICAgICAgIHsNCiAgICAgICAgICAgIFdyaXRlQ29udGVudFRvKHcpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU2F2ZXMgYWxsIHRoZSBjaGlsZHJlbiBvZiB0aGUgbm9kZSB0byB0aGUgc3BlY2lmaWVkIFhtbFdyaXRlci4NCiAgICAgICAgLy8gDQogICAgICAgIC8vV3JpdGVzIG91dCB0aGUgdG8gdGhlIGZpbGUgd2l0aCBleGFjdCBjb250ZW50IGluIHRoZSBYbWxEb2N1bWVudC4NCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgV3JpdGVDb250ZW50VG8oWG1sV3JpdGVyIHh3KQ0KICAgICAgICB7DQogICAgICAgICAgICBmb3JlYWNoIChYbWxOb2RlIG4gaW4gdGhpcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBuLldyaXRlVG8oeHcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgVmFsaWRhdGUoVmFsaWRhdGlvbkV2ZW50SGFuZGxlciB2YWxpZGF0aW9uRXZlbnRIYW5kbGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBWYWxpZGF0ZSh2YWxpZGF0aW9uRXZlbnRIYW5kbGVyLCB0aGlzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2b2lkIFZhbGlkYXRlKFZhbGlkYXRpb25FdmVudEhhbmRsZXIgdmFsaWRhdGlvbkV2ZW50SGFuZGxlciwgWG1sTm9kZSBub2RlVG9WYWxpZGF0ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF9zY2hlbWFzID09IG51bGwgfHwgX3NjaGVtYXMuQ291bnQgPT0gMCkNCiAgICAgICAgICAgIHsgLy9TaG91bGQgd2UgZXJyb3INCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YbWxEb2N1bWVudF9Ob1NjaGVtYUluZm8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgWG1sRG9jdW1lbnQgcGFyZW50RG9jdW1lbnQgPSBub2RlVG9WYWxpZGF0ZS5Eb2N1bWVudDsNCiAgICAgICAgICAgIGlmIChwYXJlbnREb2N1bWVudCAhPSB0aGlzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudEV4Y2VwdGlvbihTUi5Gb3JtYXQoU1IuWG1sRG9jdW1lbnRfTm9kZU5vdEZyb21Eb2N1bWVudCwgbmFtZW9mKG5vZGVUb1ZhbGlkYXRlKSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG5vZGVUb1ZhbGlkYXRlID09IHRoaXMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3JlcG9ydFZhbGlkaXR5ID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBEb2N1bWVudFNjaGVtYVZhbGlkYXRvciB2YWxpZGF0b3IgPSBuZXcgRG9jdW1lbnRTY2hlbWFWYWxpZGF0b3IodGhpcywgX3NjaGVtYXMsIHZhbGlkYXRpb25FdmVudEhhbmRsZXIpOw0KICAgICAgICAgICAgdmFsaWRhdG9yLlZhbGlkYXRlKG5vZGVUb1ZhbGlkYXRlKTsNCiAgICAgICAgICAgIGlmIChub2RlVG9WYWxpZGF0ZSA9PSB0aGlzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9yZXBvcnRWYWxpZGl0eSA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgZXZlbnQgWG1sTm9kZUNoYW5nZWRFdmVudEhhbmRsZXIgTm9kZUluc2VydGluZw0KICAgICAgICB7DQogICAgICAgICAgICBhZGQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb25Ob2RlSW5zZXJ0aW5nRGVsZWdhdGUgKz0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZW1vdmUNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb25Ob2RlSW5zZXJ0aW5nRGVsZWdhdGUgLT0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgZXZlbnQgWG1sTm9kZUNoYW5nZWRFdmVudEhhbmRsZXIgTm9kZUluc2VydGVkDQogICAgICAgIHsNCiAgICAgICAgICAgIGFkZA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vbk5vZGVJbnNlcnRlZERlbGVnYXRlICs9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVtb3ZlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX29uTm9kZUluc2VydGVkRGVsZWdhdGUgLT0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgZXZlbnQgWG1sTm9kZUNoYW5nZWRFdmVudEhhbmRsZXIgTm9kZVJlbW92aW5nDQogICAgICAgIHsNCiAgICAgICAgICAgIGFkZA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vbk5vZGVSZW1vdmluZ0RlbGVnYXRlICs9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVtb3ZlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX29uTm9kZVJlbW92aW5nRGVsZWdhdGUgLT0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgZXZlbnQgWG1sTm9kZUNoYW5nZWRFdmVudEhhbmRsZXIgTm9kZVJlbW92ZWQNCiAgICAgICAgew0KICAgICAgICAgICAgYWRkDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX29uTm9kZVJlbW92ZWREZWxlZ2F0ZSArPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJlbW92ZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vbk5vZGVSZW1vdmVkRGVsZWdhdGUgLT0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgZXZlbnQgWG1sTm9kZUNoYW5nZWRFdmVudEhhbmRsZXIgTm9kZUNoYW5naW5nDQogICAgICAgIHsNCiAgICAgICAgICAgIGFkZA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vbk5vZGVDaGFuZ2luZ0RlbGVnYXRlICs9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVtb3ZlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX29uTm9kZUNoYW5naW5nRGVsZWdhdGUgLT0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgZXZlbnQgWG1sTm9kZUNoYW5nZWRFdmVudEhhbmRsZXIgTm9kZUNoYW5nZWQNCiAgICAgICAgew0KICAgICAgICAgICAgYWRkDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX29uTm9kZUNoYW5nZWREZWxlZ2F0ZSArPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJlbW92ZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vbk5vZGVDaGFuZ2VkRGVsZWdhdGUgLT0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBvdmVycmlkZSBYbWxOb2RlQ2hhbmdlZEV2ZW50QXJncyBHZXRFdmVudEFyZ3MoWG1sTm9kZSBub2RlLCBYbWxOb2RlIG9sZFBhcmVudCwgWG1sTm9kZSBuZXdQYXJlbnQsIHN0cmluZyBvbGRWYWx1ZSwgc3RyaW5nIG5ld1ZhbHVlLCBYbWxOb2RlQ2hhbmdlZEFjdGlvbiBhY3Rpb24pDQogICAgICAgIHsNCiAgICAgICAgICAgIF9yZXBvcnRWYWxpZGl0eSA9IGZhbHNlOw0KDQogICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVDaGFuZ2VkQWN0aW9uLkluc2VydDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9vbk5vZGVJbnNlcnRpbmdEZWxlZ2F0ZSA9PSBudWxsICYmIF9vbk5vZGVJbnNlcnRlZERlbGVnYXRlID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZUNoYW5nZWRBY3Rpb24uUmVtb3ZlOg0KICAgICAgICAgICAgICAgICAgICBpZiAoX29uTm9kZVJlbW92aW5nRGVsZWdhdGUgPT0gbnVsbCAmJiBfb25Ob2RlUmVtb3ZlZERlbGVnYXRlID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZUNoYW5nZWRBY3Rpb24uQ2hhbmdlOg0KICAgICAgICAgICAgICAgICAgICBpZiAoX29uTm9kZUNoYW5naW5nRGVsZWdhdGUgPT0gbnVsbCAmJiBfb25Ob2RlQ2hhbmdlZERlbGVnYXRlID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxOb2RlQ2hhbmdlZEV2ZW50QXJncyhub2RlLCBvbGRQYXJlbnQsIG5ld1BhcmVudCwgb2xkVmFsdWUsIG5ld1ZhbHVlLCBhY3Rpb24pOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgWG1sTm9kZUNoYW5nZWRFdmVudEFyZ3MgR2V0SW5zZXJ0RXZlbnRBcmdzRm9yTG9hZChYbWxOb2RlIG5vZGUsIFhtbE5vZGUgbmV3UGFyZW50KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX29uTm9kZUluc2VydGluZ0RlbGVnYXRlID09IG51bGwgJiYgX29uTm9kZUluc2VydGVkRGVsZWdhdGUgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHN0cmluZyBub2RlVmFsdWUgPSBub2RlLlZhbHVlOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxOb2RlQ2hhbmdlZEV2ZW50QXJncyhub2RlLCBudWxsLCBuZXdQYXJlbnQsIG5vZGVWYWx1ZSwgbm9kZVZhbHVlLCBYbWxOb2RlQ2hhbmdlZEFjdGlvbi5JbnNlcnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgb3ZlcnJpZGUgdm9pZCBCZWZvcmVFdmVudChYbWxOb2RlQ2hhbmdlZEV2ZW50QXJncyBhcmdzKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYXJncyAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJncy5BY3Rpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVDaGFuZ2VkQWN0aW9uLkluc2VydDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb25Ob2RlSW5zZXJ0aW5nRGVsZWdhdGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb25Ob2RlSW5zZXJ0aW5nRGVsZWdhdGUodGhpcywgYXJncyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVDaGFuZ2VkQWN0aW9uLlJlbW92ZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb25Ob2RlUmVtb3ZpbmdEZWxlZ2F0ZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vbk5vZGVSZW1vdmluZ0RlbGVnYXRlKHRoaXMsIGFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlQ2hhbmdlZEFjdGlvbi5DaGFuZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX29uTm9kZUNoYW5naW5nRGVsZWdhdGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb25Ob2RlQ2hhbmdpbmdEZWxlZ2F0ZSh0aGlzLCBhcmdzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIG92ZXJyaWRlIHZvaWQgQWZ0ZXJFdmVudChYbWxOb2RlQ2hhbmdlZEV2ZW50QXJncyBhcmdzKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYXJncyAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJncy5BY3Rpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVDaGFuZ2VkQWN0aW9uLkluc2VydDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb25Ob2RlSW5zZXJ0ZWREZWxlZ2F0ZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vbk5vZGVJbnNlcnRlZERlbGVnYXRlKHRoaXMsIGFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlQ2hhbmdlZEFjdGlvbi5SZW1vdmU6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX29uTm9kZVJlbW92ZWREZWxlZ2F0ZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vbk5vZGVSZW1vdmVkRGVsZWdhdGUodGhpcywgYXJncyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVDaGFuZ2VkQWN0aW9uLkNoYW5nZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb25Ob2RlQ2hhbmdlZERlbGVnYXRlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX29uTm9kZUNoYW5nZWREZWxlZ2F0ZSh0aGlzLCBhcmdzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFRoZSBmdW5jdGlvbiBzdWNoIHRocm91Z2ggc2NoZW1hIGluZm8gdG8gZmluZCBvdXQgaWYgdGhlcmUgZXhpc3RzIGEgZGVmYXVsdCBhdHRyaWJ1dGUgd2l0aCBwYXNzZWQgaW4gbmFtZXMgaW4gdGhlIHBhc3NlZCBpbiBlbGVtZW50DQogICAgICAgIC8vIElmIHNvLCByZXR1cm4gdGhlIG5ld2x5IGNyZWF0ZWQgZGVmYXVsdCBhdHRyaWJ1dGUgKHdpdGggY2hpbGRyZW4gdHJlZSk7DQogICAgICAgIC8vIE90aGVyd2lzZSwgcmV0dXJuIG51bGwuDQoNCiAgICAgICAgaW50ZXJuYWwgWG1sQXR0cmlidXRlIEdldERlZmF1bHRBdHRyaWJ1dGUoWG1sRWxlbWVudCBlbGVtLCBzdHJpbmcgYXR0clByZWZpeCwgc3RyaW5nIGF0dHJMb2NhbG5hbWUsIHN0cmluZyBhdHRyTmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICBTY2hlbWFJbmZvIHNjaEluZm8gPSBEdGRTY2hlbWFJbmZvOw0KICAgICAgICAgICAgU2NoZW1hRWxlbWVudERlY2wgZWQgPSBHZXRTY2hlbWFFbGVtZW50RGVjbChlbGVtKTsNCiAgICAgICAgICAgIGlmIChlZCAhPSBudWxsICYmIGVkLkF0dERlZnMgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJRGljdGlvbmFyeUVudW1lcmF0b3IgYXR0ckRlZnMgPSBlZC5BdHREZWZzLkdldEVudW1lcmF0b3IoKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAoYXR0ckRlZnMuTW92ZU5leHQoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNjaGVtYUF0dERlZiBhdHRkZWYgPSAoU2NoZW1hQXR0RGVmKWF0dHJEZWZzLlZhbHVlOw0KICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ZGVmLlByZXNlbmNlID09IFNjaGVtYURlY2xCYXNlLlVzZS5EZWZhdWx0IHx8DQogICAgICAgICAgICAgICAgICAgICAgICBhdHRkZWYuUHJlc2VuY2UgPT0gU2NoZW1hRGVjbEJhc2UuVXNlLkZpeGVkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ZGVmLk5hbWUuTmFtZSA9PSBhdHRyTG9jYWxuYW1lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoc2NoSW5mby5TY2hlbWFUeXBlID09IFNjaGVtYVR5cGUuRFREICYmIGF0dGRlZi5OYW1lLk5hbWVzcGFjZSA9PSBhdHRyUHJlZml4KSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNjaEluZm8uU2NoZW1hVHlwZSAhPSBTY2hlbWFUeXBlLkRURCAmJiBhdHRkZWYuTmFtZS5OYW1lc3BhY2UgPT0gYXR0ck5hbWVzcGFjZVVSSSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ZpbmQgYSBkZWYgYXR0cmlidXRlIHdpdGggdGhlIHNhbWUgbmFtZSwgYnVpbGQgYSBkZWZhdWx0IGF0dHJpYnV0ZSBhbmQgcmV0dXJuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbEF0dHJpYnV0ZSBkZWZhdHRyID0gUHJlcGFyZURlZmF1bHRBdHRyaWJ1dGUoYXR0ZGVmLCBhdHRyUHJlZml4LCBhdHRyTG9jYWxuYW1lLCBhdHRyTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF0dHI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBTdHJpbmcgVmVyc2lvbg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxEZWNsYXJhdGlvbiBkZWNsID0gRGVjbGFyYXRpb247DQogICAgICAgICAgICAgICAgaWYgKGRlY2wgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlY2wuVmVyc2lvbjsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFN0cmluZyBFbmNvZGluZw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxEZWNsYXJhdGlvbiBkZWNsID0gRGVjbGFyYXRpb247DQogICAgICAgICAgICAgICAgaWYgKGRlY2wgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlY2wuRW5jb2Rpbmc7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBTdHJpbmcgU3RhbmRhbG9uZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxEZWNsYXJhdGlvbiBkZWNsID0gRGVjbGFyYXRpb247DQogICAgICAgICAgICAgICAgaWYgKGRlY2wgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlY2wuU3RhbmRhbG9uZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFhtbEVudGl0eSBHZXRFbnRpdHlOb2RlKFN0cmluZyBuYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoRG9jdW1lbnRUeXBlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sTmFtZWROb2RlTWFwIGVudGl0ZXMgPSBEb2N1bWVudFR5cGUuRW50aXRpZXM7DQogICAgICAgICAgICAgICAgaWYgKGVudGl0ZXMgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChYbWxFbnRpdHkpKGVudGl0ZXMuR2V0TmFtZWRJdGVtKG5hbWUpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIElYbWxTY2hlbWFJbmZvIFNjaGVtYUluZm8NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF9yZXBvcnRWYWxpZGl0eSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbEVsZW1lbnQgZG9jdW1lbnRFbGVtZW50ID0gRG9jdW1lbnRFbGVtZW50Ow0KICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnRFbGVtZW50ICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZG9jdW1lbnRFbGVtZW50LlNjaGVtYUluZm8uVmFsaWRpdHkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxTY2hlbWFWYWxpZGl0eS5WYWxpZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZhbGlkU2NoZW1hSW5mbzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbFNjaGVtYVZhbGlkaXR5LkludmFsaWQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBJbnZhbGlkU2NoZW1hSW5mbzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gTm90S25vd25TY2hlbWFJbmZvOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFN0cmluZyBCYXNlVVJJDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBiYXNlVVJJOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCB2b2lkIFNldEJhc2VVUkkoU3RyaW5nIGluQmFzZVVSSSkNCiAgICAgICAgew0KICAgICAgICAgICAgYmFzZVVSSSA9IGluQmFzZVVSSTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIG92ZXJyaWRlIFhtbE5vZGUgQXBwZW5kQ2hpbGRGb3JMb2FkKFhtbE5vZGUgbmV3Q2hpbGQsIFhtbERvY3VtZW50IGRvYykNCiAgICAgICAgew0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KGRvYyA9PSB0aGlzKTsNCg0KICAgICAgICAgICAgaWYgKCFJc1ZhbGlkQ2hpbGRUeXBlKG5ld0NoaWxkLk5vZGVUeXBlKSkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YZG9tX05vZGVfSW5zZXJ0X1R5cGVDb25mbGljdCk7DQoNCiAgICAgICAgICAgIGlmICghQ2FuSW5zZXJ0QWZ0ZXIobmV3Q2hpbGQsIExhc3RDaGlsZCkpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWGRvbV9Ob2RlX0luc2VydF9Mb2NhdGlvbik7DQoNCiAgICAgICAgICAgIFhtbE5vZGVDaGFuZ2VkRXZlbnRBcmdzIGFyZ3MgPSBHZXRJbnNlcnRFdmVudEFyZ3NGb3JMb2FkKG5ld0NoaWxkLCB0aGlzKTsNCg0KICAgICAgICAgICAgaWYgKGFyZ3MgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBCZWZvcmVFdmVudChhcmdzKTsNCg0KICAgICAgICAgICAgWG1sTGlua2VkTm9kZSBuZXdOb2RlID0gKFhtbExpbmtlZE5vZGUpbmV3Q2hpbGQ7DQoNCiAgICAgICAgICAgIGlmIChfbGFzdENoaWxkID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbmV3Tm9kZS5uZXh0ID0gbmV3Tm9kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBuZXdOb2RlLm5leHQgPSBfbGFzdENoaWxkLm5leHQ7DQogICAgICAgICAgICAgICAgX2xhc3RDaGlsZC5uZXh0ID0gbmV3Tm9kZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgX2xhc3RDaGlsZCA9IG5ld05vZGU7DQogICAgICAgICAgICBuZXdOb2RlLlNldFBhcmVudEZvckxvYWQodGhpcyk7DQoNCiAgICAgICAgICAgIGlmIChhcmdzICE9IG51bGwpDQogICAgICAgICAgICAgICAgQWZ0ZXJFdmVudChhcmdzKTsNCg0KICAgICAgICAgICAgcmV0dXJuIG5ld05vZGU7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBvdmVycmlkZSBYUGF0aE5vZGVUeXBlIFhQTm9kZVR5cGUgeyBnZXQgeyByZXR1cm4gWFBhdGhOb2RlVHlwZS5Sb290OyB9IH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIEhhc0VudGl0eVJlZmVyZW5jZXMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZFbnRSZWZOb2Rlc1ByZXNlbnQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxBdHRyaWJ1dGUgTmFtZXNwYWNlWG1sDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfbmFtZXNwYWNlWG1sID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfbmFtZXNwYWNlWG1sID0gbmV3IFhtbEF0dHJpYnV0ZShBZGRBdHRyWG1sTmFtZShzdHJYbWxucywgc3RyWG1sLCBzdHJSZXNlcnZlZFhtbG5zLCBudWxsKSwgdGhpcyk7DQogICAgICAgICAgICAgICAgICAgIF9uYW1lc3BhY2VYbWwuVmFsdWUgPSBzdHJSZXNlcnZlZFhtbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIF9uYW1lc3BhY2VYbWw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQo="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/SchemaCollectionpreProcessor.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlNjaGVtYQ0Kew0KICAgIHVzaW5nIFN5c3RlbS5Db2xsZWN0aW9uczsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsNCiAgICB1c2luZyBTeXN0ZW0uSU87DQogICAgdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KICAgIHVzaW5nIFN5c3RlbS5SdW50aW1lLlZlcnNpb25pbmc7DQoNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDYxOA0KICAgIGludGVybmFsIHNlYWxlZCBjbGFzcyBTY2hlbWFDb2xsZWN0aW9uUHJlcHJvY2Vzc29yIDogQmFzZVByb2Nlc3Nvcg0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBlbnVtIENvbXBvc2l0b3INCiAgICAgICAgew0KICAgICAgICAgICAgUm9vdCwNCiAgICAgICAgICAgIEluY2x1ZGUsDQogICAgICAgICAgICBJbXBvcnQNCiAgICAgICAgfTsNCg0KICAgICAgICBwcml2YXRlIFhtbFNjaGVtYSBfc2NoZW1hOw0KICAgICAgICBwcml2YXRlIHN0cmluZyBfdGFyZ2V0TmFtZXNwYWNlOw0KICAgICAgICBwcml2YXRlIGJvb2wgX2J1aWxkaW5JbmNsdWRlZCA9IGZhbHNlOw0KICAgICAgICBwcml2YXRlIFhtbFNjaGVtYUZvcm0gX2VsZW1lbnRGb3JtRGVmYXVsdDsNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFGb3JtIF9hdHRyaWJ1dGVGb3JtRGVmYXVsdDsNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kIF9ibG9ja0RlZmF1bHQ7DQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZCBfZmluYWxEZWZhdWx0Ow0KICAgICAgICAvL0RpY3Rpb25hcnk8VXJpLCBVcmk+IHNjaGVtYUxvY2F0aW9uczsNCiAgICAgICAgcHJpdmF0ZSBIYXNodGFibGUgX3NjaGVtYUxvY2F0aW9uczsNCiAgICAgICAgcHJpdmF0ZSBIYXNodGFibGUgX3JlZmVyZW5jZU5hbWVzcGFjZXM7DQoNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX3htbG5zOw0KICAgICAgICBwcml2YXRlIGNvbnN0IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2Qgc2NoZW1hQmxvY2tEZWZhdWx0QWxsb3dlZCA9IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuUmVzdHJpY3Rpb24gfCBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkV4dGVuc2lvbiB8IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuU3Vic3RpdHV0aW9uOw0KICAgICAgICBwcml2YXRlIGNvbnN0IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2Qgc2NoZW1hRmluYWxEZWZhdWx0QWxsb3dlZCA9IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuUmVzdHJpY3Rpb24gfCBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkV4dGVuc2lvbiB8IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuTGlzdCB8IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuVW5pb247DQogICAgICAgIHByaXZhdGUgY29uc3QgWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZCBlbGVtZW50QmxvY2tBbGxvd2VkID0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5SZXN0cmljdGlvbiB8IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuRXh0ZW5zaW9uIHwgWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5TdWJzdGl0dXRpb247DQogICAgICAgIHByaXZhdGUgY29uc3QgWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZCBlbGVtZW50RmluYWxBbGxvd2VkID0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5SZXN0cmljdGlvbiB8IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuRXh0ZW5zaW9uOw0KICAgICAgICBwcml2YXRlIGNvbnN0IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2Qgc2ltcGxlVHlwZUZpbmFsQWxsb3dlZCA9IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuUmVzdHJpY3Rpb24gfCBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkxpc3QgfCBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLlVuaW9uOw0KICAgICAgICBwcml2YXRlIGNvbnN0IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QgY29tcGxleFR5cGVCbG9ja0FsbG93ZWQgPSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLlJlc3RyaWN0aW9uIHwgWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5FeHRlbnNpb247DQogICAgICAgIHByaXZhdGUgY29uc3QgWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZCBjb21wbGV4VHlwZUZpbmFsQWxsb3dlZCA9IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuUmVzdHJpY3Rpb24gfCBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkV4dGVuc2lvbjsNCg0KICAgICAgICBwcml2YXRlIFhtbFJlc29sdmVyIF94bWxSZXNvbHZlciA9IG51bGw7DQoNCiAgICAgICAgcHVibGljIFNjaGVtYUNvbGxlY3Rpb25QcmVwcm9jZXNzb3IoWG1sTmFtZVRhYmxlIG5hbWVUYWJsZSwgU2NoZW1hTmFtZXMgc2NoZW1hTmFtZXMsIFZhbGlkYXRpb25FdmVudEhhbmRsZXIgZXZlbnRIYW5kbGVyKQ0KICAgICAgICAgICAgOiBiYXNlKG5hbWVUYWJsZSwgc2NoZW1hTmFtZXMsIGV2ZW50SGFuZGxlcikNCiAgICAgICAgew0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGJvb2wgRXhlY3V0ZShYbWxTY2hlbWEgc2NoZW1hLCBzdHJpbmcgdGFyZ2V0TmFtZXNwYWNlLCBib29sIGxvYWRFeHRlcm5hbHMsIFhtbFNjaGVtYUNvbGxlY3Rpb24geHNjKQ0KICAgICAgICB7DQogICAgICAgICAgICBfc2NoZW1hID0gc2NoZW1hOw0KICAgICAgICAgICAgX3htbG5zID0gTmFtZVRhYmxlLkFkZCgieG1sbnMiKTsNCg0KICAgICAgICAgICAgQ2xlYW51cChzY2hlbWEpOw0KICAgICAgICAgICAgaWYgKGxvYWRFeHRlcm5hbHMgJiYgX3htbFJlc29sdmVyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3NjaGVtYUxvY2F0aW9ucyA9IG5ldyBIYXNodGFibGUoKTsgLy9uZXcgRGljdGlvbmFyeTxVcmksIFVyaT4oKTsNCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hLkJhc2VVcmkgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9zY2hlbWFMb2NhdGlvbnMuQWRkKHNjaGVtYS5CYXNlVXJpLCBzY2hlbWEuQmFzZVVyaSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIExvYWRFeHRlcm5hbHMoc2NoZW1hLCB4c2MpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgVmFsaWRhdGVJZEF0dHJpYnV0ZShzY2hlbWEpOw0KICAgICAgICAgICAgUHJlcHJvY2VzcyhzY2hlbWEsIHRhcmdldE5hbWVzcGFjZSwgQ29tcG9zaXRvci5Sb290KTsNCiAgICAgICAgICAgIGlmICghSGFzRXJyb3JzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNjaGVtYS5Jc1ByZXByb2Nlc3NlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWEuSW5jbHVkZXMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYUV4dGVybmFsIGluY2x1ZGUgPSAoWG1sU2NoZW1hRXh0ZXJuYWwpc2NoZW1hLkluY2x1ZGVzW2ldOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZS5TY2hlbWEgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZS5TY2hlbWEuSXNQcmVwcm9jZXNzZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICFIYXNFcnJvcnM7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgQ2xlYW51cChYbWxTY2hlbWEgc2NoZW1hKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoc2NoZW1hLklzUHJvY2Vzc2luZykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzY2hlbWEuSXNQcm9jZXNzaW5nID0gdHJ1ZTsNCg0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWEuSW5jbHVkZXMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFFeHRlcm5hbCBpbmNsdWRlID0gKFhtbFNjaGVtYUV4dGVybmFsKXNjaGVtYS5JbmNsdWRlc1tpXTsNCg0KICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlLlNjaGVtYSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQ2xlYW51cChpbmNsdWRlLlNjaGVtYSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGluY2x1ZGUgaXMgWG1sU2NoZW1hUmVkZWZpbmUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFSZWRlZmluZSByZGVmID0gaW5jbHVkZSBhcyBYbWxTY2hlbWFSZWRlZmluZTsNCiAgICAgICAgICAgICAgICAgICAgcmRlZi5BdHRyaWJ1dGVHcm91cHMuQ2xlYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmRlZi5Hcm91cHMuQ2xlYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmRlZi5TY2hlbWFUeXBlcy5DbGVhcigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc2NoZW1hLkF0dHJpYnV0ZXMuQ2xlYXIoKTsNCiAgICAgICAgICAgIHNjaGVtYS5BdHRyaWJ1dGVHcm91cHMuQ2xlYXIoKTsNCiAgICAgICAgICAgIHNjaGVtYS5TY2hlbWFUeXBlcy5DbGVhcigpOw0KICAgICAgICAgICAgc2NoZW1hLkVsZW1lbnRzLkNsZWFyKCk7DQogICAgICAgICAgICBzY2hlbWEuR3JvdXBzLkNsZWFyKCk7DQogICAgICAgICAgICBzY2hlbWEuTm90YXRpb25zLkNsZWFyKCk7DQogICAgICAgICAgICBzY2hlbWEuSWRzLkNsZWFyKCk7DQogICAgICAgICAgICBzY2hlbWEuSWRlbnRpdHlDb25zdHJhaW50cy5DbGVhcigpOw0KDQogICAgICAgICAgICBzY2hlbWEuSXNQcm9jZXNzaW5nID0gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxSZXNvbHZlciBYbWxSZXNvbHZlcg0KICAgICAgICB7DQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfeG1sUmVzb2x2ZXIgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFN4UzogVGhpcyBtZXRob2QgcmVhZHMgcmVzb3VyY2UgbmFtZXMgZnJvbSB0aGUgc291cmNlIGRvY3VtZW50cyBhbmQgZG9lcyBub3QgcmV0dXJuIGFueSByZXNvdXJjZXMgdG8gdGhlIGNhbGxlciANCiAgICAgICAgLy8gSXQncyBmaW5lIHRvIHN1cHByZXNzIHRoZSBTeFMgd2FybmluZw0KICAgICAgICBwcml2YXRlIHZvaWQgTG9hZEV4dGVybmFscyhYbWxTY2hlbWEgc2NoZW1hLCBYbWxTY2hlbWFDb2xsZWN0aW9uIHhzYykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHNjaGVtYS5Jc1Byb2Nlc3NpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2NoZW1hLklzUHJvY2Vzc2luZyA9IHRydWU7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYS5JbmNsdWRlcy5Db3VudDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUV4dGVybmFsIGluY2x1ZGUgPSAoWG1sU2NoZW1hRXh0ZXJuYWwpc2NoZW1hLkluY2x1ZGVzW2ldOw0KICAgICAgICAgICAgICAgIFVyaSBpbmNsdWRlTG9jYXRpb24gPSBudWxsOw0KICAgICAgICAgICAgICAgIC8vQ0FTRSAxOiBJZiB0aGUgU2NoZW1hIG9iamVjdCBvZiB0aGUgaW5jbHVkZSBoYXMgYmVlbiBzZXQgDQogICAgICAgICAgICAgICAgaWYgKGluY2x1ZGUuU2NoZW1hICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBhbHJlYWR5IGxvYWRlZA0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZSBpcyBYbWxTY2hlbWFJbXBvcnQgJiYgKChYbWxTY2hlbWFJbXBvcnQpaW5jbHVkZSkuTmFtZXNwYWNlID09IFhtbFJlc2VydmVkTnMuTnNYbWwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9idWlsZGluSW5jbHVkZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZUxvY2F0aW9uID0gaW5jbHVkZS5CYXNlVXJpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVMb2NhdGlvbiAhPSBudWxsICYmIF9zY2hlbWFMb2NhdGlvbnNbaW5jbHVkZUxvY2F0aW9uXSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zY2hlbWFMb2NhdGlvbnMuQWRkKGluY2x1ZGVMb2NhdGlvbiwgaW5jbHVkZUxvY2F0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIExvYWRFeHRlcm5hbHMoaW5jbHVkZS5TY2hlbWEsIHhzYyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy9DQVNFIDI6IElmIHRoZSBpbmNsdWRlIGhhcyBiZWVuIGFscmVhZHkgYWRkZWQgdG8gdGhlIHNjaGVtYSBjb2xsZWN0aW9uIGRpcmVjdGx5DQogICAgICAgICAgICAgICAgaWYgKHhzYyAhPSBudWxsICYmIGluY2x1ZGUgaXMgWG1sU2NoZW1hSW1wb3J0KQ0KICAgICAgICAgICAgICAgIHsgLy9BZGRlZCBmb3IgU2NoZW1hQ29sbGVjdGlvbiBjb21wYXRpYmlsaXR5DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYUltcG9ydCBpbXBvcnQgPSAoWG1sU2NoZW1hSW1wb3J0KWluY2x1ZGU7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBpbXBvcnROUyA9IGltcG9ydC5OYW1lc3BhY2UgIT0gbnVsbCA/IGltcG9ydC5OYW1lc3BhY2UgOiBzdHJpbmcuRW1wdHk7DQogICAgICAgICAgICAgICAgICAgIGluY2x1ZGUuU2NoZW1hID0geHNjW2ltcG9ydE5TXTsgLy9GZXRjaCBpdCBmcm9tIHRoZSBjb2xsZWN0aW9uDQogICAgICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlLlNjaGVtYSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlLlNjaGVtYSA9IGluY2x1ZGUuU2NoZW1hLkNsb25lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZS5TY2hlbWEuQmFzZVVyaSAhPSBudWxsICYmIF9zY2hlbWFMb2NhdGlvbnNbaW5jbHVkZS5TY2hlbWEuQmFzZVVyaV0gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfc2NoZW1hTG9jYXRpb25zLkFkZChpbmNsdWRlLlNjaGVtYS5CYXNlVXJpLCBpbmNsdWRlLlNjaGVtYS5CYXNlVXJpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIC8vVG8gYXZvaWQgcmUtaW5jbHVkaW5nIGNvbXBvbmVudHMgdGhhdCB3ZXJlIGFscmVhZHkgaW5jbHVkZWQgdGhyb3VnaCBhIGRpZmZlcmVudCBwYXRoDQogICAgICAgICAgICAgICAgICAgICAgICBVcmkgc3ViVXJpID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgaW5jbHVkZS5TY2hlbWEuSW5jbHVkZXMuQ291bnQ7ICsraikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFFeHRlcm5hbCBzdWJJbmMgPSAoWG1sU2NoZW1hRXh0ZXJuYWwpaW5jbHVkZS5TY2hlbWEuSW5jbHVkZXNbal07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YkluYyBpcyBYbWxTY2hlbWFJbXBvcnQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFJbXBvcnQgc3ViSW1wID0gKFhtbFNjaGVtYUltcG9ydClzdWJJbmM7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlVyaSA9IHN1YkltcC5CYXNlVXJpICE9IG51bGwgPyBzdWJJbXAuQmFzZVVyaSA6IChzdWJJbXAuU2NoZW1hICE9IG51bGwgJiYgc3ViSW1wLlNjaGVtYS5CYXNlVXJpICE9IG51bGwgPyBzdWJJbXAuU2NoZW1hLkJhc2VVcmkgOiBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlVyaSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3NjaGVtYUxvY2F0aW9uc1tzdWJVcmldICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViSW1wLlNjaGVtYSA9IG51bGw7IC8vU28gdGhhdCB0aGUgY29tcG9uZW50cyBhcmUgbm90IGluY2x1ZGVkIGFnYWluDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IC8vaWYgaXRzIG5vdCB0aGVyZSBhbHJlYWR5LCBhZGQgaXQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfc2NoZW1hTG9jYXRpb25zLkFkZChzdWJVcmksIHN1YlVyaSk7IC8vVGhlIHNjaGVtYSBmb3IgdGhhdCBsb2NhdGlvbiBpcyBhdmFpbGFibGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy9DQVNFIDM6IElmIHRoZSBpbXBvcnRlZCBuYW1lc3BhY2UgaXMgdGhlIFhNTCBuYW1lc3BhY2UsIGxvYWQgYnVpbHQtaW4gc2NoZW1hDQogICAgICAgICAgICAgICAgaWYgKGluY2x1ZGUgaXMgWG1sU2NoZW1hSW1wb3J0ICYmICgoWG1sU2NoZW1hSW1wb3J0KWluY2x1ZGUpLk5hbWVzcGFjZSA9PSBYbWxSZXNlcnZlZE5zLk5zWG1sKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFfYnVpbGRpbkluY2x1ZGVkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBfYnVpbGRpbkluY2x1ZGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGUuU2NoZW1hID0gUHJlcHJvY2Vzc29yLkdldEJ1aWxkSW5TY2hlbWEoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvL0NBU0U0OiBQYXJzZSBzY2hlbWEgZnJvbSB0aGUgcHJvdmlkZWQgbG9jYXRpb24NCiAgICAgICAgICAgICAgICBzdHJpbmcgc2NoZW1hTG9jYXRpb24gPSBpbmNsdWRlLlNjaGVtYUxvY2F0aW9uOw0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWFMb2NhdGlvbiA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgVXJpIHJ1cmkgPSBSZXNvbHZlU2NoZW1hTG9jYXRpb25Vcmkoc2NoZW1hLCBzY2hlbWFMb2NhdGlvbik7DQoNCiAgICAgICAgICAgICAgICBpZiAocnVyaSAhPSBudWxsICYmIF9zY2hlbWFMb2NhdGlvbnNbcnVyaV0gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFN0cmVhbSBzdHJlYW0gPSBHZXRTY2hlbWFFbnRpdHkocnVyaSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChzdHJlYW0gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZS5CYXNlVXJpID0gcnVyaTsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9zY2hlbWFMb2NhdGlvbnMuQWRkKHJ1cmksIHJ1cmkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgWG1sVGV4dFJlYWRlciByZWFkZXIgPSBuZXcgWG1sVGV4dFJlYWRlcihydXJpLlRvU3RyaW5nKCksIHN0cmVhbSwgTmFtZVRhYmxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5YbWxSZXNvbHZlciA9IF94bWxSZXNvbHZlcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcnNlciBwYXJzZXIgPSBuZXcgUGFyc2VyKFNjaGVtYVR5cGUuWFNELCBOYW1lVGFibGUsIFNjaGVtYU5hbWVzLCBFdmVudEhhbmRsZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5QYXJzZShyZWFkZXIsIG51bGwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWFkZXIuUmVhZCgpKSA7Ly8gd2VsbGZvcm1uZXNzIGNoZWNrDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZS5TY2hlbWEgPSBwYXJzZXIuWG1sU2NoZW1hOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvYWRFeHRlcm5hbHMoaW5jbHVkZS5TY2hlbWEsIHhzYyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hRXhjZXB0aW9uIGUpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudE5vVGhyb3cobmV3IFhtbFNjaGVtYUV4Y2VwdGlvbihTUi5TY2hfQ2Fubm90TG9hZFNjaGVtYSwgbmV3IHN0cmluZ1tdIHsgc2NoZW1hTG9jYXRpb24sIGUuTWVzc2FnZSB9LCBlLlNvdXJjZVVyaSwgZS5MaW5lTnVtYmVyLCBlLkxpbmVQb3NpdGlvbiksIFhtbFNldmVyaXR5VHlwZS5FcnJvcik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRJbmNsdWRlTG9jYXRpb24sIGluY2x1ZGUsIFhtbFNldmVyaXR5VHlwZS5XYXJuaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuQ2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRJbmNsdWRlTG9jYXRpb24sIGluY2x1ZGUsIFhtbFNldmVyaXR5VHlwZS5XYXJuaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNjaGVtYS5Jc1Byb2Nlc3NpbmcgPSBmYWxzZTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIEJ1aWxkUmVmTmFtZXNwYWNlcyhYbWxTY2hlbWEgc2NoZW1hKQ0KICAgICAgICB7DQogICAgICAgICAgICBfcmVmZXJlbmNlTmFtZXNwYWNlcyA9IG5ldyBIYXNodGFibGUoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYUltcG9ydCBpbXBvcnQ7DQogICAgICAgICAgICBzdHJpbmcgbnM7DQoNCiAgICAgICAgICAgIC8vQWRkIFhTRCBuYW1lc3BhY2UNCiAgICAgICAgICAgIF9yZWZlcmVuY2VOYW1lc3BhY2VzLkFkZChYbWxSZXNlcnZlZE5zLk5zWHMsIFhtbFJlc2VydmVkTnMuTnNYcyk7DQogICAgICAgICAgICBfcmVmZXJlbmNlTmFtZXNwYWNlcy5BZGQoc3RyaW5nLkVtcHR5LCBzdHJpbmcuRW1wdHkpOw0KDQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYS5JbmNsdWRlcy5Db3VudDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGltcG9ydCA9IHNjaGVtYS5JbmNsdWRlc1tpXSBhcyBYbWxTY2hlbWFJbXBvcnQ7DQogICAgICAgICAgICAgICAgaWYgKGltcG9ydCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgbnMgPSBpbXBvcnQuTmFtZXNwYWNlOw0KICAgICAgICAgICAgICAgICAgICBpZiAobnMgIT0gbnVsbCAmJiBfcmVmZXJlbmNlTmFtZXNwYWNlc1tuc10gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWZlcmVuY2VOYW1lc3BhY2VzLkFkZChucywgbnMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy9BZGQgdGhlIHNjaGVtYSdzIHRhcmdldG5hbWVzcGFjZSANCiAgICAgICAgICAgIGlmIChzY2hlbWEuVGFyZ2V0TmFtZXNwYWNlICE9IG51bGwgJiYgX3JlZmVyZW5jZU5hbWVzcGFjZXNbc2NoZW1hLlRhcmdldE5hbWVzcGFjZV0gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfcmVmZXJlbmNlTmFtZXNwYWNlcy5BZGQoc2NoZW1hLlRhcmdldE5hbWVzcGFjZSwgc2NoZW1hLlRhcmdldE5hbWVzcGFjZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgUHJlcHJvY2VzcyhYbWxTY2hlbWEgc2NoZW1hLCBzdHJpbmcgdGFyZ2V0TmFtZXNwYWNlLCBDb21wb3NpdG9yIGNvbXBvc2l0b3IpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChzY2hlbWEuSXNQcm9jZXNzaW5nKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNjaGVtYS5Jc1Byb2Nlc3NpbmcgPSB0cnVlOw0KICAgICAgICAgICAgc3RyaW5nIHRucyA9IHNjaGVtYS5UYXJnZXROYW1lc3BhY2U7DQogICAgICAgICAgICBpZiAodG5zICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2NoZW1hLlRhcmdldE5hbWVzcGFjZSA9IHRucyA9IE5hbWVUYWJsZS5BZGQodG5zKTsNCiAgICAgICAgICAgICAgICBpZiAodG5zLkxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZFRhcmdldE5hbWVzcGFjZUF0dHJpYnV0ZSwgc2NoZW1hKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbENvbnZlcnQuVG9VcmkodG5zKTsgIC8vIGNhbiB0aHJvdw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWROYW1lc3BhY2UsIHNjaGVtYS5UYXJnZXROYW1lc3BhY2UsIHNjaGVtYSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChzY2hlbWEuVmVyc2lvbiAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sQ29udmVydC5WZXJpZnlUT0tFTihzY2hlbWEuVmVyc2lvbik7IC8vIGNhbiB0aHJvdw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfQXR0cmlidXRlVmFsdWVEYXRhVHlwZSwgInZlcnNpb24iLCBzY2hlbWEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHN3aXRjaCAoY29tcG9zaXRvcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIENvbXBvc2l0b3IuUm9vdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldE5hbWVzcGFjZSA9PSBudWxsICYmIHNjaGVtYS5UYXJnZXROYW1lc3BhY2UgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgeyAvLyBub3Qgc3BlY2lmaWVkDQogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXROYW1lc3BhY2UgPSBzY2hlbWEuVGFyZ2V0TmFtZXNwYWNlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjaGVtYS5UYXJnZXROYW1lc3BhY2UgPT0gbnVsbCAmJiB0YXJnZXROYW1lc3BhY2UgIT0gbnVsbCAmJiB0YXJnZXROYW1lc3BhY2UuTGVuZ3RoID09IDApDQogICAgICAgICAgICAgICAgICAgIHsgLy8gbm8gbmFtZXNwYWNlIHNjaGVtYQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TmFtZXNwYWNlID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0TmFtZXNwYWNlICE9IHNjaGVtYS5UYXJnZXROYW1lc3BhY2UpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc21hdGNoVGFyZ2V0TmFtZXNwYWNlRXgsIHRhcmdldE5hbWVzcGFjZSwgc2NoZW1hLlRhcmdldE5hbWVzcGFjZSwgc2NoZW1hKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIENvbXBvc2l0b3IuSW1wb3J0Og0KICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0TmFtZXNwYWNlICE9IHNjaGVtYS5UYXJnZXROYW1lc3BhY2UpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc21hdGNoVGFyZ2V0TmFtZXNwYWNlSW1wb3J0LCB0YXJnZXROYW1lc3BhY2UsIHNjaGVtYS5UYXJnZXROYW1lc3BhY2UsIHNjaGVtYSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBDb21wb3NpdG9yLkluY2x1ZGU6DQogICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWEuVGFyZ2V0TmFtZXNwYWNlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXROYW1lc3BhY2UgIT0gc2NoZW1hLlRhcmdldE5hbWVzcGFjZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNtYXRjaFRhcmdldE5hbWVzcGFjZUluY2x1ZGUsIHRhcmdldE5hbWVzcGFjZSwgc2NoZW1hLlRhcmdldE5hbWVzcGFjZSwgc2NoZW1hKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWEuSW5jbHVkZXMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFFeHRlcm5hbCBpbmNsdWRlID0gKFhtbFNjaGVtYUV4dGVybmFsKXNjaGVtYS5JbmNsdWRlc1tpXTsNCiAgICAgICAgICAgICAgICBTZXRQYXJlbnQoaW5jbHVkZSwgc2NoZW1hKTsNCiAgICAgICAgICAgICAgICBQcmVwcm9jZXNzQW5ub3RhdGlvbihpbmNsdWRlKTsNCg0KICAgICAgICAgICAgICAgIHN0cmluZyBsb2MgPSBpbmNsdWRlLlNjaGVtYUxvY2F0aW9uOw0KICAgICAgICAgICAgICAgIGlmIChsb2MgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBYbWxDb252ZXJ0LlRvVXJpKGxvYyk7IC8vIGNhbiB0aHJvdw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRTY2hlbWFMb2NhdGlvbiwgbG9jLCBpbmNsdWRlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICgoaW5jbHVkZSBpcyBYbWxTY2hlbWFSZWRlZmluZSB8fCBpbmNsdWRlIGlzIFhtbFNjaGVtYUluY2x1ZGUpICYmIGluY2x1ZGUuU2NoZW1hID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzUmVxdWlyZWRBdHRyaWJ1dGUsICJzY2hlbWFMb2NhdGlvbiIsIGluY2x1ZGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZS5TY2hlbWEgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlIGlzIFhtbFNjaGVtYVJlZGVmaW5lKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzKGluY2x1ZGUuU2NoZW1hLCBzY2hlbWEuVGFyZ2V0TmFtZXNwYWNlLCBDb21wb3NpdG9yLkluY2x1ZGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGluY2x1ZGUgaXMgWG1sU2NoZW1hSW1wb3J0KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKChYbWxTY2hlbWFJbXBvcnQpaW5jbHVkZSkuTmFtZXNwYWNlID09IG51bGwgJiYgc2NoZW1hLlRhcmdldE5hbWVzcGFjZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ltcG9ydFRhcmdldE5hbWVzcGFjZU51bGwsIGluY2x1ZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKChYbWxTY2hlbWFJbXBvcnQpaW5jbHVkZSkuTmFtZXNwYWNlID09IHNjaGVtYS5UYXJnZXROYW1lc3BhY2UpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW1wb3J0VGFyZ2V0TmFtZXNwYWNlLCBpbmNsdWRlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3MoaW5jbHVkZS5TY2hlbWEsICgoWG1sU2NoZW1hSW1wb3J0KWluY2x1ZGUpLk5hbWVzcGFjZSwgQ29tcG9zaXRvci5JbXBvcnQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgUHJlcHJvY2VzcyhpbmNsdWRlLlNjaGVtYSwgc2NoZW1hLlRhcmdldE5hbWVzcGFjZSwgQ29tcG9zaXRvci5JbmNsdWRlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChpbmNsdWRlIGlzIFhtbFNjaGVtYUltcG9ydCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBucyA9ICgoWG1sU2NoZW1hSW1wb3J0KWluY2x1ZGUpLk5hbWVzcGFjZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG5zICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChucy5MZW5ndGggPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9JbnZhbGlkTmFtZXNwYWNlQXR0cmlidXRlLCBucywgaW5jbHVkZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxDb252ZXJ0LlRvVXJpKG5zKTsgLy9jYW4gdGhyb3cNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEZvcm1hdEV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWROYW1lc3BhY2UsIG5zLCBpbmNsdWRlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vQmVnaW4gcHJvY2Vzc2luZyB0aGUgY3VycmVudCBzY2hlbWEgcGFzc2VkIHRvIHByZXByb2Nlc3MNCiAgICAgICAgICAgIC8vQnVpbGQgdGhlIG5hbWVzcGFjZXMgdGhhdCBjYW4gYmUgcmVmZXJlbmNlZCBpbiB0aGUgY3VycmVudCBzY2hlbWENCiAgICAgICAgICAgIEJ1aWxkUmVmTmFtZXNwYWNlcyhzY2hlbWEpOw0KDQogICAgICAgICAgICBfdGFyZ2V0TmFtZXNwYWNlID0gdGFyZ2V0TmFtZXNwYWNlID09IG51bGwgPyBzdHJpbmcuRW1wdHkgOiB0YXJnZXROYW1lc3BhY2U7DQoNCiAgICAgICAgICAgIGlmIChzY2hlbWEuQmxvY2tEZWZhdWx0ID09IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuQWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9ibG9ja0RlZmF1bHQgPSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkFsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHNjaGVtYS5CbG9ja0RlZmF1bHQgPT0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5Ob25lKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9ibG9ja0RlZmF1bHQgPSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkVtcHR5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICgoc2NoZW1hLkJsb2NrRGVmYXVsdCAmIH5zY2hlbWFCbG9ja0RlZmF1bHRBbGxvd2VkKSAhPSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZEJsb2NrRGVmYXVsdFZhbHVlLCBzY2hlbWEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBfYmxvY2tEZWZhdWx0ID0gc2NoZW1hLkJsb2NrRGVmYXVsdCAmIHNjaGVtYUJsb2NrRGVmYXVsdEFsbG93ZWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc2NoZW1hLkZpbmFsRGVmYXVsdCA9PSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkFsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZmluYWxEZWZhdWx0ID0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChzY2hlbWEuRmluYWxEZWZhdWx0ID09IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuTm9uZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZmluYWxEZWZhdWx0ID0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5FbXB0eTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoKHNjaGVtYS5GaW5hbERlZmF1bHQgJiB+c2NoZW1hRmluYWxEZWZhdWx0QWxsb3dlZCkgIT0gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRGaW5hbERlZmF1bHRWYWx1ZSwgc2NoZW1hKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgX2ZpbmFsRGVmYXVsdCA9IHNjaGVtYS5GaW5hbERlZmF1bHQgJiBzY2hlbWFGaW5hbERlZmF1bHRBbGxvd2VkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX2VsZW1lbnRGb3JtRGVmYXVsdCA9IHNjaGVtYS5FbGVtZW50Rm9ybURlZmF1bHQ7DQogICAgICAgICAgICBpZiAoX2VsZW1lbnRGb3JtRGVmYXVsdCA9PSBYbWxTY2hlbWFGb3JtLk5vbmUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2VsZW1lbnRGb3JtRGVmYXVsdCA9IFhtbFNjaGVtYUZvcm0uVW5xdWFsaWZpZWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfYXR0cmlidXRlRm9ybURlZmF1bHQgPSBzY2hlbWEuQXR0cmlidXRlRm9ybURlZmF1bHQ7DQogICAgICAgICAgICBpZiAoX2F0dHJpYnV0ZUZvcm1EZWZhdWx0ID09IFhtbFNjaGVtYUZvcm0uTm9uZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfYXR0cmlidXRlRm9ybURlZmF1bHQgPSBYbWxTY2hlbWFGb3JtLlVucXVhbGlmaWVkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYS5JbmNsdWRlcy5Db3VudDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUV4dGVybmFsIGluY2x1ZGUgPSAoWG1sU2NoZW1hRXh0ZXJuYWwpc2NoZW1hLkluY2x1ZGVzW2ldOw0KICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlIGlzIFhtbFNjaGVtYVJlZGVmaW5lKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hUmVkZWZpbmUgcmVkZWZpbmUgPSAoWG1sU2NoZW1hUmVkZWZpbmUpaW5jbHVkZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluY2x1ZGUuU2NoZW1hICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NSZWRlZmluZShyZWRlZmluZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHJlZGVmaW5lLkl0ZW1zLkNvdW50OyArK2opDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVkZWZpbmUuSXRlbXNbal0gaXMgWG1sU2NoZW1hQW5ub3RhdGlvbikpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9SZWRlZmluZU5vU2NoZW1hLCByZWRlZmluZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBYbWxTY2hlbWEgaW5jbHVkZWRTY2hlbWEgPSBpbmNsdWRlLlNjaGVtYTsNCiAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZWRTY2hlbWEgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYUVsZW1lbnQgZWxlbWVudCBpbiBpbmNsdWRlZFNjaGVtYS5FbGVtZW50cy5WYWx1ZXMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFkZFRvVGFibGUoc2NoZW1hLkVsZW1lbnRzLCBlbGVtZW50LlF1YWxpZmllZE5hbWUsIGVsZW1lbnQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYUF0dHJpYnV0ZSBhdHRyaWJ1dGUgaW4gaW5jbHVkZWRTY2hlbWEuQXR0cmlidXRlcy5WYWx1ZXMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFkZFRvVGFibGUoc2NoZW1hLkF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5RdWFsaWZpZWROYW1lLCBhdHRyaWJ1dGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYUdyb3VwIGdyb3VwIGluIGluY2x1ZGVkU2NoZW1hLkdyb3Vwcy5WYWx1ZXMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFkZFRvVGFibGUoc2NoZW1hLkdyb3VwcywgZ3JvdXAuUXVhbGlmaWVkTmFtZSwgZ3JvdXApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYUF0dHJpYnV0ZUdyb3VwIGF0dHJpYnV0ZUdyb3VwIGluIGluY2x1ZGVkU2NoZW1hLkF0dHJpYnV0ZUdyb3Vwcy5WYWx1ZXMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFkZFRvVGFibGUoc2NoZW1hLkF0dHJpYnV0ZUdyb3VwcywgYXR0cmlidXRlR3JvdXAuUXVhbGlmaWVkTmFtZSwgYXR0cmlidXRlR3JvdXApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYVR5cGUgdHlwZSBpbiBpbmNsdWRlZFNjaGVtYS5TY2hlbWFUeXBlcy5WYWx1ZXMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFkZFRvVGFibGUoc2NoZW1hLlNjaGVtYVR5cGVzLCB0eXBlLlF1YWxpZmllZE5hbWUsIHR5cGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYU5vdGF0aW9uIG5vdGF0aW9uIGluIGluY2x1ZGVkU2NoZW1hLk5vdGF0aW9ucy5WYWx1ZXMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFkZFRvVGFibGUoc2NoZW1hLk5vdGF0aW9ucywgbm90YXRpb24uUXVhbGlmaWVkTmFtZSwgbm90YXRpb24pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFZhbGlkYXRlSWRBdHRyaWJ1dGUoaW5jbHVkZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIExpc3Q8WG1sU2NoZW1hT2JqZWN0PiByZW1vdmVJdGVtc0xpc3QgPSBuZXcgTGlzdDxYbWxTY2hlbWFPYmplY3Q+KCk7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYS5JdGVtcy5Db3VudDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNldFBhcmVudChzY2hlbWEuSXRlbXNbaV0sIHNjaGVtYSk7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hQXR0cmlidXRlIGF0dHJpYnV0ZSA9IHNjaGVtYS5JdGVtc1tpXSBhcyBYbWxTY2hlbWFBdHRyaWJ1dGU7DQogICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0F0dHJpYnV0ZShhdHRyaWJ1dGUpOw0KICAgICAgICAgICAgICAgICAgICBBZGRUb1RhYmxlKHNjaGVtYS5BdHRyaWJ1dGVzLCBhdHRyaWJ1dGUuUXVhbGlmaWVkTmFtZSwgYXR0cmlidXRlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NoZW1hLkl0ZW1zW2ldIGlzIFhtbFNjaGVtYUF0dHJpYnV0ZUdyb3VwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hQXR0cmlidXRlR3JvdXAgYXR0cmlidXRlR3JvdXAgPSAoWG1sU2NoZW1hQXR0cmlidXRlR3JvdXApc2NoZW1hLkl0ZW1zW2ldOw0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzQXR0cmlidXRlR3JvdXAoYXR0cmlidXRlR3JvdXApOw0KICAgICAgICAgICAgICAgICAgICBBZGRUb1RhYmxlKHNjaGVtYS5BdHRyaWJ1dGVHcm91cHMsIGF0dHJpYnV0ZUdyb3VwLlF1YWxpZmllZE5hbWUsIGF0dHJpYnV0ZUdyb3VwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NoZW1hLkl0ZW1zW2ldIGlzIFhtbFNjaGVtYUNvbXBsZXhUeXBlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hQ29tcGxleFR5cGUgY29tcGxleFR5cGUgPSAoWG1sU2NoZW1hQ29tcGxleFR5cGUpc2NoZW1hLkl0ZW1zW2ldOw0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzQ29tcGxleFR5cGUoY29tcGxleFR5cGUsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgQWRkVG9UYWJsZShzY2hlbWEuU2NoZW1hVHlwZXMsIGNvbXBsZXhUeXBlLlF1YWxpZmllZE5hbWUsIGNvbXBsZXhUeXBlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NoZW1hLkl0ZW1zW2ldIGlzIFhtbFNjaGVtYVNpbXBsZVR5cGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFTaW1wbGVUeXBlIHNpbXBsZVR5cGUgPSAoWG1sU2NoZW1hU2ltcGxlVHlwZSlzY2hlbWEuSXRlbXNbaV07DQogICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NTaW1wbGVUeXBlKHNpbXBsZVR5cGUsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgQWRkVG9UYWJsZShzY2hlbWEuU2NoZW1hVHlwZXMsIHNpbXBsZVR5cGUuUXVhbGlmaWVkTmFtZSwgc2ltcGxlVHlwZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjaGVtYS5JdGVtc1tpXSBpcyBYbWxTY2hlbWFFbGVtZW50KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hRWxlbWVudCBlbGVtZW50ID0gKFhtbFNjaGVtYUVsZW1lbnQpc2NoZW1hLkl0ZW1zW2ldOw0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzRWxlbWVudChlbGVtZW50KTsNCiAgICAgICAgICAgICAgICAgICAgQWRkVG9UYWJsZShzY2hlbWEuRWxlbWVudHMsIGVsZW1lbnQuUXVhbGlmaWVkTmFtZSwgZWxlbWVudCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjaGVtYS5JdGVtc1tpXSBpcyBYbWxTY2hlbWFHcm91cCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYUdyb3VwIGdyb3VwID0gKFhtbFNjaGVtYUdyb3VwKXNjaGVtYS5JdGVtc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0dyb3VwKGdyb3VwKTsNCiAgICAgICAgICAgICAgICAgICAgQWRkVG9UYWJsZShzY2hlbWEuR3JvdXBzLCBncm91cC5RdWFsaWZpZWROYW1lLCBncm91cCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjaGVtYS5JdGVtc1tpXSBpcyBYbWxTY2hlbWFOb3RhdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYU5vdGF0aW9uIG5vdGF0aW9uID0gKFhtbFNjaGVtYU5vdGF0aW9uKXNjaGVtYS5JdGVtc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgUHJlcHJvY2Vzc05vdGF0aW9uKG5vdGF0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgQWRkVG9UYWJsZShzY2hlbWEuTm90YXRpb25zLCBub3RhdGlvbi5RdWFsaWZpZWROYW1lLCBub3RhdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKCEoc2NoZW1hLkl0ZW1zW2ldIGlzIFhtbFNjaGVtYUFubm90YXRpb24pKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZENvbGxlY3Rpb24sIHNjaGVtYS5JdGVtc1tpXSk7DQogICAgICAgICAgICAgICAgICAgIHJlbW92ZUl0ZW1zTGlzdC5BZGQoc2NoZW1hLkl0ZW1zW2ldKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlbW92ZUl0ZW1zTGlzdC5Db3VudDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNjaGVtYS5JdGVtcy5SZW1vdmUocmVtb3ZlSXRlbXNMaXN0W2ldKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc2NoZW1hLklzUHJvY2Vzc2luZyA9IGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByZXByb2Nlc3NSZWRlZmluZShYbWxTY2hlbWFSZWRlZmluZSByZWRlZmluZSkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZWRlZmluZS5JdGVtcy5Db3VudDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNldFBhcmVudChyZWRlZmluZS5JdGVtc1tpXSwgcmVkZWZpbmUpOw0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUdyb3VwIGdyb3VwID0gcmVkZWZpbmUuSXRlbXNbaV0gYXMgWG1sU2NoZW1hR3JvdXA7DQogICAgICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzR3JvdXAoZ3JvdXApOw0KICAgICAgICAgICAgICAgICAgICBpZiAocmVkZWZpbmUuR3JvdXBzW2dyb3VwLlF1YWxpZmllZE5hbWVdICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0dyb3VwRG91YmxlUmVkZWZpbmUsIGdyb3VwKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFkZFRvVGFibGUocmVkZWZpbmUuR3JvdXBzLCBncm91cC5RdWFsaWZpZWROYW1lLCBncm91cCk7DQogICAgICAgICAgICAgICAgICAgICAgICBncm91cC5SZWRlZmluZWQgPSAoWG1sU2NoZW1hR3JvdXApcmVkZWZpbmUuU2NoZW1hLkdyb3Vwc1tncm91cC5RdWFsaWZpZWROYW1lXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncm91cC5SZWRlZmluZWQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaGVja1JlZmluZWRHcm91cChncm91cCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfR3JvdXBSZWRlZmluZU5vdEZvdW5kLCBncm91cCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocmVkZWZpbmUuSXRlbXNbaV0gaXMgWG1sU2NoZW1hQXR0cmlidXRlR3JvdXApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFBdHRyaWJ1dGVHcm91cCBhdHRyaWJ1dGVHcm91cCA9IChYbWxTY2hlbWFBdHRyaWJ1dGVHcm91cClyZWRlZmluZS5JdGVtc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0F0dHJpYnV0ZUdyb3VwKGF0dHJpYnV0ZUdyb3VwKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZGVmaW5lLkF0dHJpYnV0ZUdyb3Vwc1thdHRyaWJ1dGVHcm91cC5RdWFsaWZpZWROYW1lXSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9BdHRyR3JvdXBEb3VibGVSZWRlZmluZSwgYXR0cmlidXRlR3JvdXApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQWRkVG9UYWJsZShyZWRlZmluZS5BdHRyaWJ1dGVHcm91cHMsIGF0dHJpYnV0ZUdyb3VwLlF1YWxpZmllZE5hbWUsIGF0dHJpYnV0ZUdyb3VwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUdyb3VwLlJlZGVmaW5lZCA9IChYbWxTY2hlbWFBdHRyaWJ1dGVHcm91cClyZWRlZmluZS5TY2hlbWEuQXR0cmlidXRlR3JvdXBzW2F0dHJpYnV0ZUdyb3VwLlF1YWxpZmllZE5hbWVdOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZUdyb3VwLlJlZGVmaW5lZCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoZWNrUmVmaW5lZEF0dHJpYnV0ZUdyb3VwKGF0dHJpYnV0ZUdyb3VwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9BdHRyR3JvdXBSZWRlZmluZU5vdEZvdW5kLCBhdHRyaWJ1dGVHcm91cCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocmVkZWZpbmUuSXRlbXNbaV0gaXMgWG1sU2NoZW1hQ29tcGxleFR5cGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFDb21wbGV4VHlwZSBjb21wbGV4VHlwZSA9IChYbWxTY2hlbWFDb21wbGV4VHlwZSlyZWRlZmluZS5JdGVtc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0NvbXBsZXhUeXBlKGNvbXBsZXhUeXBlLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZWRlZmluZS5TY2hlbWFUeXBlc1tjb21wbGV4VHlwZS5RdWFsaWZpZWROYW1lXSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Db21wbGV4VHlwZURvdWJsZVJlZGVmaW5lLCBjb21wbGV4VHlwZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBZGRUb1RhYmxlKHJlZGVmaW5lLlNjaGVtYVR5cGVzLCBjb21wbGV4VHlwZS5RdWFsaWZpZWROYW1lLCBjb21wbGV4VHlwZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFUeXBlIHR5cGUgPSAoWG1sU2NoZW1hVHlwZSlyZWRlZmluZS5TY2hlbWEuU2NoZW1hVHlwZXNbY29tcGxleFR5cGUuUXVhbGlmaWVkTmFtZV07DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlIGlzIFhtbFNjaGVtYUNvbXBsZXhUeXBlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxleFR5cGUuUmVkZWZpbmVkID0gdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tSZWZpbmVkQ29tcGxleFR5cGUoY29tcGxleFR5cGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9TaW1wbGVUb0NvbXBsZXhUeXBlUmVkZWZpbmUsIGNvbXBsZXhUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfQ29tcGxleFR5cGVSZWRlZmluZU5vdEZvdW5kLCBjb21wbGV4VHlwZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocmVkZWZpbmUuSXRlbXNbaV0gaXMgWG1sU2NoZW1hU2ltcGxlVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZVR5cGUgc2ltcGxlVHlwZSA9IChYbWxTY2hlbWFTaW1wbGVUeXBlKXJlZGVmaW5lLkl0ZW1zW2ldOw0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzU2ltcGxlVHlwZShzaW1wbGVUeXBlLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZWRlZmluZS5TY2hlbWFUeXBlc1tzaW1wbGVUeXBlLlF1YWxpZmllZE5hbWVdICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1NpbXBsZVR5cGVEb3VibGVSZWRlZmluZSwgc2ltcGxlVHlwZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBZGRUb1RhYmxlKHJlZGVmaW5lLlNjaGVtYVR5cGVzLCBzaW1wbGVUeXBlLlF1YWxpZmllZE5hbWUsIHNpbXBsZVR5cGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hVHlwZSB0eXBlID0gKFhtbFNjaGVtYVR5cGUpcmVkZWZpbmUuU2NoZW1hLlNjaGVtYVR5cGVzW3NpbXBsZVR5cGUuUXVhbGlmaWVkTmFtZV07DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlIGlzIFhtbFNjaGVtYVNpbXBsZVR5cGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVUeXBlLlJlZGVmaW5lZCA9IHR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoZWNrUmVmaW5lZFNpbXBsZVR5cGUoc2ltcGxlVHlwZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0NvbXBsZXhUb1NpbXBsZVR5cGVSZWRlZmluZSwgc2ltcGxlVHlwZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1NpbXBsZVR5cGVSZWRlZmluZU5vdEZvdW5kLCBzaW1wbGVUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZm9yZWFjaCAoRGljdGlvbmFyeUVudHJ5IGVudHJ5IGluIHJlZGVmaW5lLkdyb3VwcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZWRlZmluZS5TY2hlbWEuR3JvdXBzLkluc2VydCgoWG1sUXVhbGlmaWVkTmFtZSllbnRyeS5LZXksIChYbWxTY2hlbWFPYmplY3QpZW50cnkuVmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yZWFjaCAoRGljdGlvbmFyeUVudHJ5IGVudHJ5IGluIHJlZGVmaW5lLkF0dHJpYnV0ZUdyb3VwcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZWRlZmluZS5TY2hlbWEuQXR0cmlidXRlR3JvdXBzLkluc2VydCgoWG1sUXVhbGlmaWVkTmFtZSllbnRyeS5LZXksIChYbWxTY2hlbWFPYmplY3QpZW50cnkuVmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yZWFjaCAoRGljdGlvbmFyeUVudHJ5IGVudHJ5IGluIHJlZGVmaW5lLlNjaGVtYVR5cGVzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlZGVmaW5lLlNjaGVtYS5TY2hlbWFUeXBlcy5JbnNlcnQoKFhtbFF1YWxpZmllZE5hbWUpZW50cnkuS2V5LCAoWG1sU2NoZW1hT2JqZWN0KWVudHJ5LlZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgaW50IENvdW50R3JvdXBTZWxmUmVmZXJlbmNlKFhtbFNjaGVtYU9iamVjdENvbGxlY3Rpb24gaXRlbXMsIFhtbFF1YWxpZmllZE5hbWUgbmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaW50IGNvdW50ID0gMDsNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaXRlbXMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFHcm91cFJlZiBncm91cFJlZiA9IGl0ZW1zW2ldIGFzIFhtbFNjaGVtYUdyb3VwUmVmOw0KICAgICAgICAgICAgICAgIGlmIChncm91cFJlZiAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGdyb3VwUmVmLlJlZk5hbWUgPT0gbmFtZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdyb3VwUmVmLk1pbk9jY3VycyAhPSBkZWNpbWFsLk9uZSB8fCBncm91cFJlZi5NYXhPY2N1cnMgIT0gZGVjaW1hbC5PbmUpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfTWluTWF4R3JvdXBSZWRlZmluZSwgZ3JvdXBSZWYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChpdGVtc1tpXSBpcyBYbWxTY2hlbWFHcm91cEJhc2UpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjb3VudCArPSBDb3VudEdyb3VwU2VsZlJlZmVyZW5jZSgoKFhtbFNjaGVtYUdyb3VwQmFzZSlpdGVtc1tpXSkuSXRlbXMsIG5hbWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAxKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNvdW50Ow0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIENoZWNrUmVmaW5lZEdyb3VwKFhtbFNjaGVtYUdyb3VwIGdyb3VwKQ0KICAgICAgICB7DQogICAgICAgICAgICBpbnQgY291bnQgPSAwOw0KICAgICAgICAgICAgaWYgKGdyb3VwLlBhcnRpY2xlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY291bnQgPSBDb3VudEdyb3VwU2VsZlJlZmVyZW5jZShncm91cC5QYXJ0aWNsZS5JdGVtcywgZ3JvdXAuUXVhbGlmaWVkTmFtZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY291bnQgPiAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX011bHRpcGxlR3JvdXBTZWxmUmVmLCBncm91cCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgQ2hlY2tSZWZpbmVkQXR0cmlidXRlR3JvdXAoWG1sU2NoZW1hQXR0cmlidXRlR3JvdXAgYXR0cmlidXRlR3JvdXApDQogICAgICAgIHsNCiAgICAgICAgICAgIGludCBjb3VudCA9IDA7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGF0dHJpYnV0ZUdyb3VwLkF0dHJpYnV0ZXMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFBdHRyaWJ1dGVHcm91cFJlZiBncm91cFJlZiA9IGF0dHJpYnV0ZUdyb3VwLkF0dHJpYnV0ZXNbaV0gYXMgWG1sU2NoZW1hQXR0cmlidXRlR3JvdXBSZWY7DQogICAgICAgICAgICAgICAgaWYgKGdyb3VwUmVmICE9IG51bGwgJiYgZ3JvdXBSZWYuUmVmTmFtZSA9PSBhdHRyaWJ1dGVHcm91cC5RdWFsaWZpZWROYW1lKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY291bnQrKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY291bnQgPiAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX011bHRpcGxlQXR0ckdyb3VwU2VsZlJlZiwgYXR0cmlidXRlR3JvdXApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIENoZWNrUmVmaW5lZFNpbXBsZVR5cGUoWG1sU2NoZW1hU2ltcGxlVHlwZSBzdHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHN0eXBlLkNvbnRlbnQgIT0gbnVsbCAmJiBzdHlwZS5Db250ZW50IGlzIFhtbFNjaGVtYVNpbXBsZVR5cGVSZXN0cmljdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFTaW1wbGVUeXBlUmVzdHJpY3Rpb24gcmVzdHJpY3Rpb24gPSAoWG1sU2NoZW1hU2ltcGxlVHlwZVJlc3RyaWN0aW9uKXN0eXBlLkNvbnRlbnQ7DQogICAgICAgICAgICAgICAgaWYgKHJlc3RyaWN0aW9uLkJhc2VUeXBlTmFtZSA9PSBzdHlwZS5RdWFsaWZpZWROYW1lKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRUeXBlUmVkZWZpbmUsIHN0eXBlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBDaGVja1JlZmluZWRDb21wbGV4VHlwZShYbWxTY2hlbWFDb21wbGV4VHlwZSBjdHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGN0eXBlLkNvbnRlbnRNb2RlbCAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUgYmFzZU5hbWU7DQogICAgICAgICAgICAgICAgaWYgKGN0eXBlLkNvbnRlbnRNb2RlbCBpcyBYbWxTY2hlbWFDb21wbGV4Q29udGVudCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYUNvbXBsZXhDb250ZW50IGNvbnRlbnQgPSAoWG1sU2NoZW1hQ29tcGxleENvbnRlbnQpY3R5cGUuQ29udGVudE1vZGVsOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudC5Db250ZW50IGlzIFhtbFNjaGVtYUNvbXBsZXhDb250ZW50UmVzdHJpY3Rpb24pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VOYW1lID0gKChYbWxTY2hlbWFDb21wbGV4Q29udGVudFJlc3RyaWN0aW9uKWNvbnRlbnQuQ29udGVudCkuQmFzZVR5cGVOYW1lOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYmFzZU5hbWUgPSAoKFhtbFNjaGVtYUNvbXBsZXhDb250ZW50RXh0ZW5zaW9uKWNvbnRlbnQuQ29udGVudCkuQmFzZVR5cGVOYW1lOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZUNvbnRlbnQgY29udGVudCA9IChYbWxTY2hlbWFTaW1wbGVDb250ZW50KWN0eXBlLkNvbnRlbnRNb2RlbDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQuQ29udGVudCBpcyBYbWxTY2hlbWFTaW1wbGVDb250ZW50UmVzdHJpY3Rpb24pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VOYW1lID0gKChYbWxTY2hlbWFTaW1wbGVDb250ZW50UmVzdHJpY3Rpb24pY29udGVudC5Db250ZW50KS5CYXNlVHlwZU5hbWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBiYXNlTmFtZSA9ICgoWG1sU2NoZW1hU2ltcGxlQ29udGVudEV4dGVuc2lvbiljb250ZW50LkNvbnRlbnQpLkJhc2VUeXBlTmFtZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYmFzZU5hbWUgPT0gY3R5cGUuUXVhbGlmaWVkTmFtZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9JbnZhbGlkVHlwZVJlZGVmaW5lLCBjdHlwZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgUHJlcHJvY2Vzc0F0dHJpYnV0ZShYbWxTY2hlbWFBdHRyaWJ1dGUgYXR0cmlidXRlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYXR0cmlidXRlLk5hbWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWYWxpZGF0ZU5hbWVBdHRyaWJ1dGUoYXR0cmlidXRlKTsNCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuU2V0UXVhbGlmaWVkTmFtZShuZXcgWG1sUXVhbGlmaWVkTmFtZShhdHRyaWJ1dGUuTmFtZSwgX3RhcmdldE5hbWVzcGFjZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc3NSZXF1aXJlZEF0dHJpYnV0ZSwgIm5hbWUiLCBhdHRyaWJ1dGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5Vc2UgIT0gWG1sU2NoZW1hVXNlLk5vbmUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRm9yYmlkZGVuQXR0cmlidXRlLCAidXNlIiwgYXR0cmlidXRlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUuRm9ybSAhPSBYbWxTY2hlbWFGb3JtLk5vbmUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRm9yYmlkZGVuQXR0cmlidXRlLCAiZm9ybSIsIGF0dHJpYnV0ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBQcmVwcm9jZXNzQXR0cmlidXRlQ29udGVudChhdHRyaWJ1dGUpOw0KICAgICAgICAgICAgVmFsaWRhdGVJZEF0dHJpYnV0ZShhdHRyaWJ1dGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByZXByb2Nlc3NMb2NhbEF0dHJpYnV0ZShYbWxTY2hlbWFBdHRyaWJ1dGUgYXR0cmlidXRlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYXR0cmlidXRlLk5hbWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsgLy8gbmFtZQ0KICAgICAgICAgICAgICAgIFZhbGlkYXRlTmFtZUF0dHJpYnV0ZShhdHRyaWJ1dGUpOw0KICAgICAgICAgICAgICAgIFByZXByb2Nlc3NBdHRyaWJ1dGVDb250ZW50KGF0dHJpYnV0ZSk7DQogICAgICAgICAgICAgICAgYXR0cmlidXRlLlNldFF1YWxpZmllZE5hbWUobmV3IFhtbFF1YWxpZmllZE5hbWUoYXR0cmlidXRlLk5hbWUsIChhdHRyaWJ1dGUuRm9ybSA9PSBYbWxTY2hlbWFGb3JtLlF1YWxpZmllZCB8fCAoYXR0cmlidXRlLkZvcm0gPT0gWG1sU2NoZW1hRm9ybS5Ob25lICYmIF9hdHRyaWJ1dGVGb3JtRGVmYXVsdCA9PSBYbWxTY2hlbWFGb3JtLlF1YWxpZmllZCkpID8gX3RhcmdldE5hbWVzcGFjZSA6IG51bGwpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsgLy8gcmVmDQogICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0Fubm90YXRpb24oYXR0cmlidXRlKTsgLy9zZXQgcGFyZW50IG9mIGFubm90YXRpb24gY2hpbGQgb2YgcmVmDQogICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5SZWZOYW1lLklzRW1wdHkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9BdHRyaWJ1dGVOYW1lUmVmLCAiPz8/IiwgYXR0cmlidXRlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVRTmFtZUF0dHJpYnV0ZShhdHRyaWJ1dGUsICJyZWYiLCBhdHRyaWJ1dGUuUmVmTmFtZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghYXR0cmlidXRlLlNjaGVtYVR5cGVOYW1lLklzRW1wdHkgfHwNCiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLlNjaGVtYVR5cGUgIT0gbnVsbCB8fA0KICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuRm9ybSAhPSBYbWxTY2hlbWFGb3JtLk5vbmUgLyp8fA0KICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuRGVmYXVsdFZhbHVlICE9IG51bGwgfHwNCiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLkZpeGVkVmFsdWUgIT0gbnVsbCovDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZEF0dHJpYnV0ZVJlZiwgYXR0cmlidXRlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYXR0cmlidXRlLlNldFF1YWxpZmllZE5hbWUoYXR0cmlidXRlLlJlZk5hbWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgVmFsaWRhdGVJZEF0dHJpYnV0ZShhdHRyaWJ1dGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByZXByb2Nlc3NBdHRyaWJ1dGVDb250ZW50KFhtbFNjaGVtYUF0dHJpYnV0ZSBhdHRyaWJ1dGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFByZXByb2Nlc3NBbm5vdGF0aW9uKGF0dHJpYnV0ZSk7DQogICAgICAgICAgICBpZiAoX3NjaGVtYS5UYXJnZXROYW1lc3BhY2UgPT0gWG1sUmVzZXJ2ZWROcy5Oc1hzaSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9UYXJnZXROYW1lc3BhY2VYc2ksIGF0dHJpYnV0ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIWF0dHJpYnV0ZS5SZWZOYW1lLklzRW1wdHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRm9yYmlkZGVuQXR0cmlidXRlLCAicmVmIiwgYXR0cmlidXRlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUuRGVmYXVsdFZhbHVlICE9IG51bGwgJiYgYXR0cmlidXRlLkZpeGVkVmFsdWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EZWZhdWx0Rml4ZWRBdHRyaWJ1dGVzLCBhdHRyaWJ1dGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5EZWZhdWx0VmFsdWUgIT0gbnVsbCAmJiBhdHRyaWJ1dGUuVXNlICE9IFhtbFNjaGVtYVVzZS5PcHRpb25hbCAmJiBhdHRyaWJ1dGUuVXNlICE9IFhtbFNjaGVtYVVzZS5Ob25lKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX09wdGlvbmFsRGVmYXVsdEF0dHJpYnV0ZSwgYXR0cmlidXRlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUuTmFtZSA9PSBfeG1sbnMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfWG1sTnNBdHRyaWJ1dGUsIGF0dHJpYnV0ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYXR0cmlidXRlLlNjaGVtYVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZXRQYXJlbnQoYXR0cmlidXRlLlNjaGVtYVR5cGUsIGF0dHJpYnV0ZSk7DQogICAgICAgICAgICAgICAgaWYgKCFhdHRyaWJ1dGUuU2NoZW1hVHlwZU5hbWUuSXNFbXB0eSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1R5cGVNdXR1YWxFeGNsdXNpdmUsIGF0dHJpYnV0ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFByZXByb2Nlc3NTaW1wbGVUeXBlKGF0dHJpYnV0ZS5TY2hlbWFUeXBlLCB0cnVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghYXR0cmlidXRlLlNjaGVtYVR5cGVOYW1lLklzRW1wdHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmFsaWRhdGVRTmFtZUF0dHJpYnV0ZShhdHRyaWJ1dGUsICJ0eXBlIiwgYXR0cmlidXRlLlNjaGVtYVR5cGVOYW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQcmVwcm9jZXNzQXR0cmlidXRlR3JvdXAoWG1sU2NoZW1hQXR0cmlidXRlR3JvdXAgYXR0cmlidXRlR3JvdXApDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVHcm91cC5OYW1lICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmFsaWRhdGVOYW1lQXR0cmlidXRlKGF0dHJpYnV0ZUdyb3VwKTsNCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVHcm91cC5TZXRRdWFsaWZpZWROYW1lKG5ldyBYbWxRdWFsaWZpZWROYW1lKGF0dHJpYnV0ZUdyb3VwLk5hbWUsIF90YXJnZXROYW1lc3BhY2UpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzUmVxdWlyZWRBdHRyaWJ1dGUsICJuYW1lIiwgYXR0cmlidXRlR3JvdXApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgUHJlcHJvY2Vzc0F0dHJpYnV0ZXMoYXR0cmlidXRlR3JvdXAuQXR0cmlidXRlcywgYXR0cmlidXRlR3JvdXAuQW55QXR0cmlidXRlLCBhdHRyaWJ1dGVHcm91cCk7DQogICAgICAgICAgICBQcmVwcm9jZXNzQW5ub3RhdGlvbihhdHRyaWJ1dGVHcm91cCk7DQogICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKGF0dHJpYnV0ZUdyb3VwKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQcmVwcm9jZXNzRWxlbWVudChYbWxTY2hlbWFFbGVtZW50IGVsZW1lbnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChlbGVtZW50Lk5hbWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWYWxpZGF0ZU5hbWVBdHRyaWJ1dGUoZWxlbWVudCk7DQogICAgICAgICAgICAgICAgZWxlbWVudC5TZXRRdWFsaWZpZWROYW1lKG5ldyBYbWxRdWFsaWZpZWROYW1lKGVsZW1lbnQuTmFtZSwgX3RhcmdldE5hbWVzcGFjZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc3NSZXF1aXJlZEF0dHJpYnV0ZSwgIm5hbWUiLCBlbGVtZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFByZXByb2Nlc3NFbGVtZW50Q29udGVudChlbGVtZW50KTsNCg0KICAgICAgICAgICAgaWYgKGVsZW1lbnQuRmluYWwgPT0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZWxlbWVudC5TZXRGaW5hbFJlc29sdmVkKFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuQWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGVsZW1lbnQuRmluYWwgPT0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5Ob25lKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfZmluYWxEZWZhdWx0ID09IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuQWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5TZXRGaW5hbFJlc29sdmVkKFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuQWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5TZXRGaW5hbFJlc29sdmVkKF9maW5hbERlZmF1bHQgJiBlbGVtZW50RmluYWxBbGxvd2VkKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKChlbGVtZW50LkZpbmFsICYgfmVsZW1lbnRGaW5hbEFsbG93ZWQpICE9IDApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9JbnZhbGlkRWxlbWVudEZpbmFsVmFsdWUsIGVsZW1lbnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbGVtZW50LlNldEZpbmFsUmVzb2x2ZWQoZWxlbWVudC5GaW5hbCAmIGVsZW1lbnRGaW5hbEFsbG93ZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGVsZW1lbnQuRm9ybSAhPSBYbWxTY2hlbWFGb3JtLk5vbmUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRm9yYmlkZGVuQXR0cmlidXRlLCAiZm9ybSIsIGVsZW1lbnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGVsZW1lbnQuTWluT2NjdXJzU3RyaW5nICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRm9yYmlkZGVuQXR0cmlidXRlLCAibWluT2NjdXJzIiwgZWxlbWVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZWxlbWVudC5NYXhPY2N1cnNTdHJpbmcgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Gb3JiaWRkZW5BdHRyaWJ1dGUsICJtYXhPY2N1cnMiLCBlbGVtZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghZWxlbWVudC5TdWJzdGl0dXRpb25Hcm91cC5Jc0VtcHR5KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZhbGlkYXRlUU5hbWVBdHRyaWJ1dGUoZWxlbWVudCwgInR5cGUiLCBlbGVtZW50LlN1YnN0aXR1dGlvbkdyb3VwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFZhbGlkYXRlSWRBdHRyaWJ1dGUoZWxlbWVudCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgUHJlcHJvY2Vzc0xvY2FsRWxlbWVudChYbWxTY2hlbWFFbGVtZW50IGVsZW1lbnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChlbGVtZW50Lk5hbWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsgLy8gbmFtZQ0KICAgICAgICAgICAgICAgIFZhbGlkYXRlTmFtZUF0dHJpYnV0ZShlbGVtZW50KTsNCiAgICAgICAgICAgICAgICBQcmVwcm9jZXNzRWxlbWVudENvbnRlbnQoZWxlbWVudCk7DQogICAgICAgICAgICAgICAgZWxlbWVudC5TZXRRdWFsaWZpZWROYW1lKG5ldyBYbWxRdWFsaWZpZWROYW1lKGVsZW1lbnQuTmFtZSwgKGVsZW1lbnQuRm9ybSA9PSBYbWxTY2hlbWFGb3JtLlF1YWxpZmllZCB8fCAoZWxlbWVudC5Gb3JtID09IFhtbFNjaGVtYUZvcm0uTm9uZSAmJiBfZWxlbWVudEZvcm1EZWZhdWx0ID09IFhtbFNjaGVtYUZvcm0uUXVhbGlmaWVkKSkgPyBfdGFyZ2V0TmFtZXNwYWNlIDogbnVsbCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgeyAvLyByZWYNCiAgICAgICAgICAgICAgICBQcmVwcm9jZXNzQW5ub3RhdGlvbihlbGVtZW50KTsgLy9DaGVjayBhbm5vdGF0aW9uIGNoaWxkIGZvciByZWYgYW5kIHNldCBwYXJlbnQgDQogICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuUmVmTmFtZS5Jc0VtcHR5KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRWxlbWVudE5hbWVSZWYsIGVsZW1lbnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZVFOYW1lQXR0cmlidXRlKGVsZW1lbnQsICJyZWYiLCBlbGVtZW50LlJlZk5hbWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQuU2NoZW1hVHlwZU5hbWUuSXNFbXB0eSB8fA0KICAgICAgICAgICAgICAgICAgICBlbGVtZW50LklzQWJzdHJhY3QgfHwNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5CbG9jayAhPSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLk5vbmUgfHwNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5TY2hlbWFUeXBlICE9IG51bGwgfHwNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5IYXNDb25zdHJhaW50cyB8fA0KICAgICAgICAgICAgICAgICAgICBlbGVtZW50LkRlZmF1bHRWYWx1ZSAhPSBudWxsIHx8DQogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuRm9ybSAhPSBYbWxTY2hlbWFGb3JtLk5vbmUgfHwNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5GaXhlZFZhbHVlICE9IG51bGwgfHwNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5IYXNOaWxsYWJsZUF0dHJpYnV0ZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRFbGVtZW50UmVmLCBlbGVtZW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuRGVmYXVsdFZhbHVlICE9IG51bGwgJiYgZWxlbWVudC5GaXhlZFZhbHVlICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EZWZhdWx0Rml4ZWRBdHRyaWJ1dGVzLCBlbGVtZW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxlbWVudC5TZXRRdWFsaWZpZWROYW1lKGVsZW1lbnQuUmVmTmFtZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZWxlbWVudC5NaW5PY2N1cnMgPiBlbGVtZW50Lk1heE9jY3VycykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBlbGVtZW50Lk1pbk9jY3VycyA9IGRlY2ltYWwuWmVybzsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaW5HdE1heCwgZWxlbWVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZWxlbWVudC5Jc0Fic3RyYWN0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ZvcmJpZGRlbkF0dHJpYnV0ZSwgImFic3RyYWN0IiwgZWxlbWVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZWxlbWVudC5GaW5hbCAhPSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLk5vbmUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRm9yYmlkZGVuQXR0cmlidXRlLCAiZmluYWwiLCBlbGVtZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghZWxlbWVudC5TdWJzdGl0dXRpb25Hcm91cC5Jc0VtcHR5KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ZvcmJpZGRlbkF0dHJpYnV0ZSwgInN1YnN0aXR1dGlvbkdyb3VwIiwgZWxlbWVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKGVsZW1lbnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByZXByb2Nlc3NFbGVtZW50Q29udGVudChYbWxTY2hlbWFFbGVtZW50IGVsZW1lbnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIFByZXByb2Nlc3NBbm5vdGF0aW9uKGVsZW1lbnQpOyAvL1NldCBwYXJlbnQgZm9yIEFubm90YXRpb24gY2hpbGQgb2YgZWxlbWVudA0KICAgICAgICAgICAgaWYgKCFlbGVtZW50LlJlZk5hbWUuSXNFbXB0eSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Gb3JiaWRkZW5BdHRyaWJ1dGUsICJyZWYiLCBlbGVtZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChlbGVtZW50LkJsb2NrID09IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuQWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGVsZW1lbnQuU2V0QmxvY2tSZXNvbHZlZChYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkFsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50LkJsb2NrID09IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuTm9uZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX2Jsb2NrRGVmYXVsdCA9PSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkFsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuU2V0QmxvY2tSZXNvbHZlZChYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkFsbCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuU2V0QmxvY2tSZXNvbHZlZChfYmxvY2tEZWZhdWx0ICYgZWxlbWVudEJsb2NrQWxsb3dlZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICgoZWxlbWVudC5CbG9jayAmIH5lbGVtZW50QmxvY2tBbGxvd2VkKSAhPSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZEVsZW1lbnRCbG9ja1ZhbHVlLCBlbGVtZW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxlbWVudC5TZXRCbG9ja1Jlc29sdmVkKGVsZW1lbnQuQmxvY2sgJiBlbGVtZW50QmxvY2tBbGxvd2VkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChlbGVtZW50LlNjaGVtYVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZXRQYXJlbnQoZWxlbWVudC5TY2hlbWFUeXBlLCBlbGVtZW50KTsgLy9TZXQgcGFyZW50IGZvciBzaW1wbGUgLyBjb21wbGV4IHR5cGUgY2hpbGQgb2YgZWxlbWVudA0KICAgICAgICAgICAgICAgIGlmICghZWxlbWVudC5TY2hlbWFUeXBlTmFtZS5Jc0VtcHR5KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfVHlwZU11dHVhbEV4Y2x1c2l2ZSwgZWxlbWVudCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LlNjaGVtYVR5cGUgaXMgWG1sU2NoZW1hQ29tcGxleFR5cGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzQ29tcGxleFR5cGUoKFhtbFNjaGVtYUNvbXBsZXhUeXBlKWVsZW1lbnQuU2NoZW1hVHlwZSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NTaW1wbGVUeXBlKChYbWxTY2hlbWFTaW1wbGVUeXBlKWVsZW1lbnQuU2NoZW1hVHlwZSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFlbGVtZW50LlNjaGVtYVR5cGVOYW1lLklzRW1wdHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmFsaWRhdGVRTmFtZUF0dHJpYnV0ZShlbGVtZW50LCAidHlwZSIsIGVsZW1lbnQuU2NoZW1hVHlwZU5hbWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGVsZW1lbnQuRGVmYXVsdFZhbHVlICE9IG51bGwgJiYgZWxlbWVudC5GaXhlZFZhbHVlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRGVmYXVsdEZpeGVkQXR0cmlidXRlcywgZWxlbWVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGVsZW1lbnQuQ29uc3RyYWludHMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZXRQYXJlbnQoZWxlbWVudC5Db25zdHJhaW50c1tpXSwgZWxlbWVudCk7DQogICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0lkZW50aXR5Q29uc3RyYWludCgoWG1sU2NoZW1hSWRlbnRpdHlDb25zdHJhaW50KWVsZW1lbnQuQ29uc3RyYWludHNbaV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByZXByb2Nlc3NJZGVudGl0eUNvbnN0cmFpbnQoWG1sU2NoZW1hSWRlbnRpdHlDb25zdHJhaW50IGNvbnN0cmFpbnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJvb2wgdmFsaWQgPSB0cnVlOw0KICAgICAgICAgICAgUHJlcHJvY2Vzc0Fubm90YXRpb24oY29uc3RyYWludCk7IC8vU2V0IHBhcmVudCBvZiBhbm5vdGF0aW9uIGNoaWxkIG9mIGtleS9rZXlyZWYvdW5pcXVlDQogICAgICAgICAgICBpZiAoY29uc3RyYWludC5OYW1lICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmFsaWRhdGVOYW1lQXR0cmlidXRlKGNvbnN0cmFpbnQpOw0KICAgICAgICAgICAgICAgIGNvbnN0cmFpbnQuU2V0UXVhbGlmaWVkTmFtZShuZXcgWG1sUXVhbGlmaWVkTmFtZShjb25zdHJhaW50Lk5hbWUsIF90YXJnZXROYW1lc3BhY2UpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzUmVxdWlyZWRBdHRyaWJ1dGUsICJuYW1lIiwgY29uc3RyYWludCk7DQogICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKF9zY2hlbWEuSWRlbnRpdHlDb25zdHJhaW50c1tjb25zdHJhaW50LlF1YWxpZmllZE5hbWVdICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRHVwSWRlbnRpdHlDb25zdHJhaW50LCBjb25zdHJhaW50LlF1YWxpZmllZE5hbWUuVG9TdHJpbmcoKSwgY29uc3RyYWludCk7DQogICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfc2NoZW1hLklkZW50aXR5Q29uc3RyYWludHMuQWRkKGNvbnN0cmFpbnQuUXVhbGlmaWVkTmFtZSwgY29uc3RyYWludCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChjb25zdHJhaW50LlNlbGVjdG9yID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSWRDb25zdHJhaW50Tm9TZWxlY3RvciwgY29uc3RyYWludCk7DQogICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChjb25zdHJhaW50LkZpZWxkcy5Db3VudCA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0lkQ29uc3RyYWludE5vRmllbGRzLCBjb25zdHJhaW50KTsNCiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGNvbnN0cmFpbnQgaXMgWG1sU2NoZW1hS2V5cmVmKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUtleXJlZiBrZXlyZWYgPSAoWG1sU2NoZW1hS2V5cmVmKWNvbnN0cmFpbnQ7DQogICAgICAgICAgICAgICAgaWYgKGtleXJlZi5SZWZlci5Jc0VtcHR5KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSWRDb25zdHJhaW50Tm9SZWZlciwgY29uc3RyYWludCk7DQogICAgICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlUU5hbWVBdHRyaWJ1dGUoa2V5cmVmLCAicmVmZXIiLCBrZXlyZWYuUmVmZXIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh2YWxpZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKGNvbnN0cmFpbnQpOw0KICAgICAgICAgICAgICAgIFZhbGlkYXRlSWRBdHRyaWJ1dGUoY29uc3RyYWludC5TZWxlY3Rvcik7DQogICAgICAgICAgICAgICAgU2V0UGFyZW50KGNvbnN0cmFpbnQuU2VsZWN0b3IsIGNvbnN0cmFpbnQpOw0KICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29uc3RyYWludC5GaWVsZHMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNldFBhcmVudChjb25zdHJhaW50LkZpZWxkc1tpXSwgY29uc3RyYWludCk7DQogICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlSWRBdHRyaWJ1dGUoY29uc3RyYWludC5GaWVsZHNbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQcmVwcm9jZXNzU2ltcGxlVHlwZShYbWxTY2hlbWFTaW1wbGVUeXBlIHNpbXBsZVR5cGUsIGJvb2wgbG9jYWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChsb2NhbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoc2ltcGxlVHlwZS5OYW1lICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Gb3JiaWRkZW5BdHRyaWJ1dGUsICJuYW1lIiwgc2ltcGxlVHlwZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChzaW1wbGVUeXBlLk5hbWUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlTmFtZUF0dHJpYnV0ZShzaW1wbGVUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgc2ltcGxlVHlwZS5TZXRRdWFsaWZpZWROYW1lKG5ldyBYbWxRdWFsaWZpZWROYW1lKHNpbXBsZVR5cGUuTmFtZSwgX3RhcmdldE5hbWVzcGFjZSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzUmVxdWlyZWRBdHRyaWJ1dGUsICJuYW1lIiwgc2ltcGxlVHlwZSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKHNpbXBsZVR5cGUuRmluYWwgPT0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzaW1wbGVUeXBlLlNldEZpbmFsUmVzb2x2ZWQoWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChzaW1wbGVUeXBlLkZpbmFsID09IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuTm9uZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChfZmluYWxEZWZhdWx0ID09IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuQWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVUeXBlLlNldEZpbmFsUmVzb2x2ZWQoWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGwpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlVHlwZS5TZXRGaW5hbFJlc29sdmVkKF9maW5hbERlZmF1bHQgJiBzaW1wbGVUeXBlRmluYWxBbGxvd2VkKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoKHNpbXBsZVR5cGUuRmluYWwgJiB+c2ltcGxlVHlwZUZpbmFsQWxsb3dlZCkgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZFNpbXBsZVR5cGVGaW5hbFZhbHVlLCBzaW1wbGVUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBzaW1wbGVUeXBlLlNldEZpbmFsUmVzb2x2ZWQoc2ltcGxlVHlwZS5GaW5hbCAmIHNpbXBsZVR5cGVGaW5hbEFsbG93ZWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHNpbXBsZVR5cGUuQ29udGVudCA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX05vU2ltcGxlVHlwZUNvbnRlbnQsIHNpbXBsZVR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoc2ltcGxlVHlwZS5Db250ZW50IGlzIFhtbFNjaGVtYVNpbXBsZVR5cGVSZXN0cmljdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFTaW1wbGVUeXBlUmVzdHJpY3Rpb24gcmVzdHJpY3Rpb24gPSAoWG1sU2NoZW1hU2ltcGxlVHlwZVJlc3RyaWN0aW9uKXNpbXBsZVR5cGUuQ29udGVudDsNCiAgICAgICAgICAgICAgICAvL1NldFBhcmVudA0KICAgICAgICAgICAgICAgIFNldFBhcmVudChyZXN0cmljdGlvbiwgc2ltcGxlVHlwZSk7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZXN0cmljdGlvbi5GYWNldHMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNldFBhcmVudChyZXN0cmljdGlvbi5GYWNldHNbaV0sIHJlc3RyaWN0aW9uKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAocmVzdHJpY3Rpb24uQmFzZVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICghcmVzdHJpY3Rpb24uQmFzZVR5cGVOYW1lLklzRW1wdHkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1NpbXBsZVR5cGVSZXN0UmVmQmFzZSwgcmVzdHJpY3Rpb24pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NTaW1wbGVUeXBlKHJlc3RyaWN0aW9uLkJhc2VUeXBlLCB0cnVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3RyaWN0aW9uLkJhc2VUeXBlTmFtZS5Jc0VtcHR5KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9TaW1wbGVUeXBlUmVzdFJlZkJhc2VOb25lLCByZXN0cmljdGlvbik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZVFOYW1lQXR0cmlidXRlKHJlc3RyaWN0aW9uLCAiYmFzZSIsIHJlc3RyaWN0aW9uLkJhc2VUeXBlTmFtZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0Fubm90YXRpb24ocmVzdHJpY3Rpb24pOyAvL3NldCBwYXJlbnQgb2YgYW5ub3RhdGlvbiBjaGlsZCBvZiBzaW1wbGUgdHlwZSByZXN0cmljdGlvbg0KICAgICAgICAgICAgICAgIFZhbGlkYXRlSWRBdHRyaWJ1dGUocmVzdHJpY3Rpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoc2ltcGxlVHlwZS5Db250ZW50IGlzIFhtbFNjaGVtYVNpbXBsZVR5cGVMaXN0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZVR5cGVMaXN0IGxpc3QgPSAoWG1sU2NoZW1hU2ltcGxlVHlwZUxpc3Qpc2ltcGxlVHlwZS5Db250ZW50Ow0KICAgICAgICAgICAgICAgIFNldFBhcmVudChsaXN0LCBzaW1wbGVUeXBlKTsNCg0KICAgICAgICAgICAgICAgIGlmIChsaXN0Lkl0ZW1UeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIWxpc3QuSXRlbVR5cGVOYW1lLklzRW1wdHkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1NpbXBsZVR5cGVMaXN0UmVmQmFzZSwgbGlzdCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgU2V0UGFyZW50KGxpc3QuSXRlbVR5cGUsIGxpc3QpOw0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzU2ltcGxlVHlwZShsaXN0Lkl0ZW1UeXBlLCB0cnVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3QuSXRlbVR5cGVOYW1lLklzRW1wdHkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1NpbXBsZVR5cGVMaXN0UmVmQmFzZU5vbmUsIGxpc3QpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVRTmFtZUF0dHJpYnV0ZShsaXN0LCAiaXRlbVR5cGUiLCBsaXN0Lkl0ZW1UeXBlTmFtZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0Fubm90YXRpb24obGlzdCk7IC8vc2V0IHBhcmVudCBvZiBhbm5vdGF0aW9uIGNoaWxkIG9mIHNpbXBsZSB0eXBlIGxpc3QNCiAgICAgICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKGxpc3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgeyAvLyB1bmlvbg0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZVR5cGVVbmlvbiB1bmlvbjEgPSAoWG1sU2NoZW1hU2ltcGxlVHlwZVVuaW9uKXNpbXBsZVR5cGUuQ29udGVudDsNCiAgICAgICAgICAgICAgICBTZXRQYXJlbnQodW5pb24xLCBzaW1wbGVUeXBlKTsNCg0KICAgICAgICAgICAgICAgIGludCBiYXNlVHlwZUNvdW50ID0gdW5pb24xLkJhc2VUeXBlcy5Db3VudDsNCiAgICAgICAgICAgICAgICBpZiAodW5pb24xLk1lbWJlclR5cGVzICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBiYXNlVHlwZUNvdW50ICs9IHVuaW9uMS5NZW1iZXJUeXBlcy5MZW5ndGg7DQogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdW5pb24xLk1lbWJlclR5cGVzLkxlbmd0aDsgKytpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZVFOYW1lQXR0cmlidXRlKHVuaW9uMSwgIm1lbWJlclR5cGVzIiwgdW5pb24xLk1lbWJlclR5cGVzW2ldKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYmFzZVR5cGVDb3VudCA9PSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfU2ltcGxlVHlwZVVuaW9uTm9CYXNlLCB1bmlvbjEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHVuaW9uMS5CYXNlVHlwZXMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNldFBhcmVudCh1bmlvbjEuQmFzZVR5cGVzW2ldLCB1bmlvbjEpOw0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzU2ltcGxlVHlwZSgoWG1sU2NoZW1hU2ltcGxlVHlwZSl1bmlvbjEuQmFzZVR5cGVzW2ldLCB0cnVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgUHJlcHJvY2Vzc0Fubm90YXRpb24odW5pb24xKTsgLy9zZXQgcGFyZW50IG9mIGFubm90YXRpb24gY2hpbGQgb2Ygc2ltcGxlIHR5cGUgdW5pb24NCiAgICAgICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKHVuaW9uMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKHNpbXBsZVR5cGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByZXByb2Nlc3NDb21wbGV4VHlwZShYbWxTY2hlbWFDb21wbGV4VHlwZSBjb21wbGV4VHlwZSwgYm9vbCBsb2NhbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGxvY2FsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChjb21wbGV4VHlwZS5OYW1lICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Gb3JiaWRkZW5BdHRyaWJ1dGUsICJuYW1lIiwgY29tcGxleFR5cGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoY29tcGxleFR5cGUuTmFtZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVOYW1lQXR0cmlidXRlKGNvbXBsZXhUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgY29tcGxleFR5cGUuU2V0UXVhbGlmaWVkTmFtZShuZXcgWG1sUXVhbGlmaWVkTmFtZShjb21wbGV4VHlwZS5OYW1lLCBfdGFyZ2V0TmFtZXNwYWNlKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc3NSZXF1aXJlZEF0dHJpYnV0ZSwgIm5hbWUiLCBjb21wbGV4VHlwZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChjb21wbGV4VHlwZS5CbG9jayA9PSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLkFsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNvbXBsZXhUeXBlLlNldEJsb2NrUmVzb2x2ZWQoWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb21wbGV4VHlwZS5CbG9jayA9PSBYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLk5vbmUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjb21wbGV4VHlwZS5TZXRCbG9ja1Jlc29sdmVkKF9ibG9ja0RlZmF1bHQgJiBjb21wbGV4VHlwZUJsb2NrQWxsb3dlZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICgoY29tcGxleFR5cGUuQmxvY2sgJiB+Y29tcGxleFR5cGVCbG9ja0FsbG93ZWQpICE9IDApDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRDb21wbGV4VHlwZUJsb2NrVmFsdWUsIGNvbXBsZXhUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjb21wbGV4VHlwZS5TZXRCbG9ja1Jlc29sdmVkKGNvbXBsZXhUeXBlLkJsb2NrICYgY29tcGxleFR5cGVCbG9ja0FsbG93ZWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoY29tcGxleFR5cGUuRmluYWwgPT0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjb21wbGV4VHlwZS5TZXRGaW5hbFJlc29sdmVkKFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuQWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoY29tcGxleFR5cGUuRmluYWwgPT0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5Ob25lKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9maW5hbERlZmF1bHQgPT0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXhUeXBlLlNldEZpbmFsUmVzb2x2ZWQoWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5BbGwpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxleFR5cGUuU2V0RmluYWxSZXNvbHZlZChfZmluYWxEZWZhdWx0ICYgY29tcGxleFR5cGVGaW5hbEFsbG93ZWQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICgoY29tcGxleFR5cGUuRmluYWwgJiB+Y29tcGxleFR5cGVGaW5hbEFsbG93ZWQpICE9IDApDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRDb21wbGV4VHlwZUZpbmFsVmFsdWUsIGNvbXBsZXhUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjb21wbGV4VHlwZS5TZXRGaW5hbFJlc29sdmVkKGNvbXBsZXhUeXBlLkZpbmFsICYgY29tcGxleFR5cGVGaW5hbEFsbG93ZWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGNvbXBsZXhUeXBlLkNvbnRlbnRNb2RlbCAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNldFBhcmVudChjb21wbGV4VHlwZS5Db250ZW50TW9kZWwsIGNvbXBsZXhUeXBlKTsgLy9TaW1wbGVDb250ZW50IC8gY29tcGxleENvdGVudA0KICAgICAgICAgICAgICAgIFByZXByb2Nlc3NBbm5vdGF0aW9uKGNvbXBsZXhUeXBlLkNvbnRlbnRNb2RlbCk7DQoNCiAgICAgICAgICAgICAgICBpZiAoY29tcGxleFR5cGUuUGFydGljbGUgIT0gbnVsbCB8fCBjb21wbGV4VHlwZS5BdHRyaWJ1dGVzICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGlsbGlnYWwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGNvbXBsZXhUeXBlLkNvbnRlbnRNb2RlbCBpcyBYbWxTY2hlbWFTaW1wbGVDb250ZW50KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hU2ltcGxlQ29udGVudCBjb250ZW50ID0gKFhtbFNjaGVtYVNpbXBsZUNvbnRlbnQpY29tcGxleFR5cGUuQ29udGVudE1vZGVsOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudC5Db250ZW50ID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21wbGV4VHlwZS5RdWFsaWZpZWROYW1lID09IFhtbFF1YWxpZmllZE5hbWUuRW1wdHkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfTm9SZXN0T3JFeHQsIGNvbXBsZXhUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Ob1Jlc3RPckV4dFFOYW1lLCBjb21wbGV4VHlwZS5RdWFsaWZpZWROYW1lLk5hbWUsIGNvbXBsZXhUeXBlLlF1YWxpZmllZE5hbWUuTmFtZXNwYWNlLCBjb21wbGV4VHlwZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZXRQYXJlbnQoY29udGVudC5Db250ZW50LCBjb250ZW50KTsgICAvL3NpbXBsZWNvbnRlbnQgZXh0ZW5zaW9uIC8gcmVzdHJpY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NBbm5vdGF0aW9uKGNvbnRlbnQuQ29udGVudCk7IC8vYW5ub3RhdGlvbiBjaGlsZCBvZiBzaW1wbGUgZXh0ZW5zaW9uIC8gcmVzdHJpY3Rpb24NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQuQ29udGVudCBpcyBYbWxTY2hlbWFTaW1wbGVDb250ZW50RXh0ZW5zaW9uKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZUNvbnRlbnRFeHRlbnNpb24gY29udGVudEV4dGVuc2lvbiA9IChYbWxTY2hlbWFTaW1wbGVDb250ZW50RXh0ZW5zaW9uKWNvbnRlbnQuQ29udGVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudEV4dGVuc2lvbi5CYXNlVHlwZU5hbWUuSXNFbXB0eSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc3NBdHRyaWJ1dGUsICJiYXNlIiwgY29udGVudEV4dGVuc2lvbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlUU5hbWVBdHRyaWJ1dGUoY29udGVudEV4dGVuc2lvbiwgImJhc2UiLCBjb250ZW50RXh0ZW5zaW9uLkJhc2VUeXBlTmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NBdHRyaWJ1dGVzKGNvbnRlbnRFeHRlbnNpb24uQXR0cmlidXRlcywgY29udGVudEV4dGVuc2lvbi5BbnlBdHRyaWJ1dGUsIGNvbnRlbnRFeHRlbnNpb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlSWRBdHRyaWJ1dGUoY29udGVudEV4dGVuc2lvbik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7IC8vWG1sU2NoZW1hU2ltcGxlQ29udGVudFJlc3RyaWN0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hU2ltcGxlQ29udGVudFJlc3RyaWN0aW9uIGNvbnRlbnRSZXN0cmljdGlvbiA9IChYbWxTY2hlbWFTaW1wbGVDb250ZW50UmVzdHJpY3Rpb24pY29udGVudC5Db250ZW50Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50UmVzdHJpY3Rpb24uQmFzZVR5cGVOYW1lLklzRW1wdHkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzQXR0cmlidXRlLCAiYmFzZSIsIGNvbnRlbnRSZXN0cmljdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlUU5hbWVBdHRyaWJ1dGUoY29udGVudFJlc3RyaWN0aW9uLCAiYmFzZSIsIGNvbnRlbnRSZXN0cmljdGlvbi5CYXNlVHlwZU5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudFJlc3RyaWN0aW9uLkJhc2VUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXRQYXJlbnQoY29udGVudFJlc3RyaWN0aW9uLkJhc2VUeXBlLCBjb250ZW50UmVzdHJpY3Rpb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzU2ltcGxlVHlwZShjb250ZW50UmVzdHJpY3Rpb24uQmFzZVR5cGUsIHRydWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzQXR0cmlidXRlcyhjb250ZW50UmVzdHJpY3Rpb24uQXR0cmlidXRlcywgY29udGVudFJlc3RyaWN0aW9uLkFueUF0dHJpYnV0ZSwgY29udGVudFJlc3RyaWN0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKGNvbnRlbnRSZXN0cmljdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVJZEF0dHJpYnV0ZShjb250ZW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsgLy8gWG1sU2NoZW1hQ29tcGxleENvbnRlbnQNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hQ29tcGxleENvbnRlbnQgY29udGVudCA9IChYbWxTY2hlbWFDb21wbGV4Q29udGVudCljb21wbGV4VHlwZS5Db250ZW50TW9kZWw7DQogICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50LkNvbnRlbnQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBsZXhUeXBlLlF1YWxpZmllZE5hbWUgPT0gWG1sUXVhbGlmaWVkTmFtZS5FbXB0eSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Ob1Jlc3RPckV4dCwgY29tcGxleFR5cGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX05vUmVzdE9yRXh0UU5hbWUsIGNvbXBsZXhUeXBlLlF1YWxpZmllZE5hbWUuTmFtZSwgY29tcGxleFR5cGUuUXVhbGlmaWVkTmFtZS5OYW1lc3BhY2UsIGNvbXBsZXhUeXBlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29udGVudC5IYXNNaXhlZEF0dHJpYnV0ZSAmJiBjb21wbGV4VHlwZS5Jc01peGVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQuSXNNaXhlZCA9IHRydWU7IC8vIGZpeHVwDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBTZXRQYXJlbnQoY29udGVudC5Db250ZW50LCBjb250ZW50KTsgICAvL2NvbXBsZXhjb250ZW50IGV4dGVuc2lvbiAvIHJlc3RyaWN0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzQW5ub3RhdGlvbihjb250ZW50LkNvbnRlbnQpOyAvL0Fubm90YXRpb24gY2hpbGQgb2YgZXh0ZW5zaW9uIC8gcmVzdHJpY3Rpb24NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQuQ29udGVudCBpcyBYbWxTY2hlbWFDb21wbGV4Q29udGVudEV4dGVuc2lvbikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFDb21wbGV4Q29udGVudEV4dGVuc2lvbiBjb250ZW50RXh0ZW5zaW9uID0gKFhtbFNjaGVtYUNvbXBsZXhDb250ZW50RXh0ZW5zaW9uKWNvbnRlbnQuQ29udGVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudEV4dGVuc2lvbi5CYXNlVHlwZU5hbWUuSXNFbXB0eSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc3NBdHRyaWJ1dGUsICJiYXNlIiwgY29udGVudEV4dGVuc2lvbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlUU5hbWVBdHRyaWJ1dGUoY29udGVudEV4dGVuc2lvbiwgImJhc2UiLCBjb250ZW50RXh0ZW5zaW9uLkJhc2VUeXBlTmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50RXh0ZW5zaW9uLlBhcnRpY2xlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXRQYXJlbnQoY29udGVudEV4dGVuc2lvbi5QYXJ0aWNsZSwgY29udGVudEV4dGVuc2lvbik7IC8vR3JvdXAgLyBhbGwgLyBjaG9pY2UgLyBzZXF1ZW5jZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzUGFydGljbGUoY29udGVudEV4dGVuc2lvbi5QYXJ0aWNsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NBdHRyaWJ1dGVzKGNvbnRlbnRFeHRlbnNpb24uQXR0cmlidXRlcywgY29udGVudEV4dGVuc2lvbi5BbnlBdHRyaWJ1dGUsIGNvbnRlbnRFeHRlbnNpb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlSWRBdHRyaWJ1dGUoY29udGVudEV4dGVuc2lvbik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7IC8vIFhtbFNjaGVtYUNvbXBsZXhDb250ZW50UmVzdHJpY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFDb21wbGV4Q29udGVudFJlc3RyaWN0aW9uIGNvbnRlbnRSZXN0cmljdGlvbiA9IChYbWxTY2hlbWFDb21wbGV4Q29udGVudFJlc3RyaWN0aW9uKWNvbnRlbnQuQ29udGVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudFJlc3RyaWN0aW9uLkJhc2VUeXBlTmFtZS5Jc0VtcHR5KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfTWlzc0F0dHJpYnV0ZSwgImJhc2UiLCBjb250ZW50UmVzdHJpY3Rpb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZVFOYW1lQXR0cmlidXRlKGNvbnRlbnRSZXN0cmljdGlvbiwgImJhc2UiLCBjb250ZW50UmVzdHJpY3Rpb24uQmFzZVR5cGVOYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRSZXN0cmljdGlvbi5QYXJ0aWNsZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0UGFyZW50KGNvbnRlbnRSZXN0cmljdGlvbi5QYXJ0aWNsZSwgY29udGVudFJlc3RyaWN0aW9uKTsgLy9Hcm91cCAvIGFsbCAvIGNob2ljZSAvIHNlcXVlbmNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NQYXJ0aWNsZShjb250ZW50UmVzdHJpY3Rpb24uUGFydGljbGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzQXR0cmlidXRlcyhjb250ZW50UmVzdHJpY3Rpb24uQXR0cmlidXRlcywgY29udGVudFJlc3RyaWN0aW9uLkFueUF0dHJpYnV0ZSwgY29udGVudFJlc3RyaWN0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKGNvbnRlbnRSZXN0cmljdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKGNvbnRlbnQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChjb21wbGV4VHlwZS5QYXJ0aWNsZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2V0UGFyZW50KGNvbXBsZXhUeXBlLlBhcnRpY2xlLCBjb21wbGV4VHlwZSk7DQogICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NQYXJ0aWNsZShjb21wbGV4VHlwZS5QYXJ0aWNsZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFByZXByb2Nlc3NBdHRyaWJ1dGVzKGNvbXBsZXhUeXBlLkF0dHJpYnV0ZXMsIGNvbXBsZXhUeXBlLkFueUF0dHJpYnV0ZSwgY29tcGxleFR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgVmFsaWRhdGVJZEF0dHJpYnV0ZShjb21wbGV4VHlwZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgUHJlcHJvY2Vzc0dyb3VwKFhtbFNjaGVtYUdyb3VwIGdyb3VwKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoZ3JvdXAuTmFtZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZhbGlkYXRlTmFtZUF0dHJpYnV0ZShncm91cCk7DQogICAgICAgICAgICAgICAgZ3JvdXAuU2V0UXVhbGlmaWVkTmFtZShuZXcgWG1sUXVhbGlmaWVkTmFtZShncm91cC5OYW1lLCBfdGFyZ2V0TmFtZXNwYWNlKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfTWlzc1JlcXVpcmVkQXR0cmlidXRlLCAibmFtZSIsIGdyb3VwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChncm91cC5QYXJ0aWNsZSA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX05vR3JvdXBQYXJ0aWNsZSwgZ3JvdXApOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChncm91cC5QYXJ0aWNsZS5NaW5PY2N1cnNTdHJpbmcgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Gb3JiaWRkZW5BdHRyaWJ1dGUsICJtaW5PY2N1cnMiLCBncm91cC5QYXJ0aWNsZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZ3JvdXAuUGFydGljbGUuTWF4T2NjdXJzU3RyaW5nICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRm9yYmlkZGVuQXR0cmlidXRlLCAibWF4T2NjdXJzIiwgZ3JvdXAuUGFydGljbGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBQcmVwcm9jZXNzUGFydGljbGUoZ3JvdXAuUGFydGljbGUpOw0KICAgICAgICAgICAgUHJlcHJvY2Vzc0Fubm90YXRpb24oZ3JvdXApOyAvL1NldCBwYXJlbnQgb2YgYW5ub3RhdGlvbiBjaGlsZCBvZiBncm91cA0KICAgICAgICAgICAgVmFsaWRhdGVJZEF0dHJpYnV0ZShncm91cCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgUHJlcHJvY2Vzc05vdGF0aW9uKFhtbFNjaGVtYU5vdGF0aW9uIG5vdGF0aW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAobm90YXRpb24uTmFtZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZhbGlkYXRlTmFtZUF0dHJpYnV0ZShub3RhdGlvbik7DQogICAgICAgICAgICAgICAgbm90YXRpb24uUXVhbGlmaWVkTmFtZSA9IG5ldyBYbWxRdWFsaWZpZWROYW1lKG5vdGF0aW9uLk5hbWUsIF90YXJnZXROYW1lc3BhY2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc3NSZXF1aXJlZEF0dHJpYnV0ZSwgIm5hbWUiLCBub3RhdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobm90YXRpb24uUHVibGljICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBYbWxDb252ZXJ0LlRvVXJpKG5vdGF0aW9uLlB1YmxpYyk7IC8vIGNhbiB0aHJvdw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZFB1YmxpY0F0dHJpYnV0ZSwgbm90YXRpb24uUHVibGljLCBub3RhdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc3NSZXF1aXJlZEF0dHJpYnV0ZSwgInB1YmxpYyIsIG5vdGF0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChub3RhdGlvbi5TeXN0ZW0gIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbENvbnZlcnQuVG9Vcmkobm90YXRpb24uU3lzdGVtKTsgLy8gY2FuIHRocm93DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9JbnZhbGlkU3lzdGVtQXR0cmlidXRlLCBub3RhdGlvbi5TeXN0ZW0sIG5vdGF0aW9uKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBQcmVwcm9jZXNzQW5ub3RhdGlvbihub3RhdGlvbik7IC8vU2V0IHBhcmVudCBvZiBhbm5vdGF0aW9uIGNoaWxkIG9mIG5vdGF0aW9uDQogICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKG5vdGF0aW9uKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByZXByb2Nlc3NQYXJ0aWNsZShYbWxTY2hlbWFQYXJ0aWNsZSBwYXJ0aWNsZSkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hQWxsIHNjaGVtYUFsbCA9IHBhcnRpY2xlIGFzIFhtbFNjaGVtYUFsbDsNCiAgICAgICAgICAgIGlmIChzY2hlbWFBbGwgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAocGFydGljbGUuTWluT2NjdXJzICE9IGRlY2ltYWwuWmVybyAmJiBwYXJ0aWNsZS5NaW5PY2N1cnMgIT0gZGVjaW1hbC5PbmUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5NaW5PY2N1cnMgPSBkZWNpbWFsLk9uZTsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZEFsbE1pbiwgcGFydGljbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAocGFydGljbGUuTWF4T2NjdXJzICE9IGRlY2ltYWwuT25lKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuTWF4T2NjdXJzID0gZGVjaW1hbC5PbmU7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRBbGxNYXgsIHBhcnRpY2xlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFBbGwuSXRlbXMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYUVsZW1lbnQgZWxlbWVudCA9IChYbWxTY2hlbWFFbGVtZW50KXNjaGVtYUFsbC5JdGVtc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuTWF4T2NjdXJzICE9IGRlY2ltYWwuWmVybyAmJiBlbGVtZW50Lk1heE9jY3VycyAhPSBkZWNpbWFsLk9uZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5NYXhPY2N1cnMgPSBkZWNpbWFsLk9uZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRBbGxFbGVtZW50TWF4LCBlbGVtZW50KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBTZXRQYXJlbnQoZWxlbWVudCwgcGFydGljbGUpOw0KICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzTG9jYWxFbGVtZW50KGVsZW1lbnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAocGFydGljbGUuTWluT2NjdXJzID4gcGFydGljbGUuTWF4T2NjdXJzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuTWluT2NjdXJzID0gcGFydGljbGUuTWF4T2NjdXJzOw0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaW5HdE1heCwgcGFydGljbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFDaG9pY2UgY2hvaWNlID0gcGFydGljbGUgYXMgWG1sU2NoZW1hQ2hvaWNlOw0KICAgICAgICAgICAgICAgIGlmIChjaG9pY2UgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYU9iamVjdENvbGxlY3Rpb24gY2hvaWNlcyA9IGNob2ljZS5JdGVtczsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjaG9pY2VzLkNvdW50OyArK2kpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNldFBhcmVudChjaG9pY2VzW2ldLCBwYXJ0aWNsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFFbGVtZW50IGVsZW1lbnQgPSBjaG9pY2VzW2ldIGFzIFhtbFNjaGVtYUVsZW1lbnQ7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NMb2NhbEVsZW1lbnQoZWxlbWVudCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJlcHJvY2Vzc1BhcnRpY2xlKChYbWxTY2hlbWFQYXJ0aWNsZSljaG9pY2VzW2ldKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJ0aWNsZSBpcyBYbWxTY2hlbWFTZXF1ZW5jZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYU9iamVjdENvbGxlY3Rpb24gc2VxdWVuY2VzID0gKChYbWxTY2hlbWFTZXF1ZW5jZSlwYXJ0aWNsZSkuSXRlbXM7DQogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VxdWVuY2VzLkNvdW50OyArK2kpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNldFBhcmVudChzZXF1ZW5jZXNbaV0sIHBhcnRpY2xlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYUVsZW1lbnQgZWxlbWVudCA9IHNlcXVlbmNlc1tpXSBhcyBYbWxTY2hlbWFFbGVtZW50Ow0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVwcm9jZXNzTG9jYWxFbGVtZW50KGVsZW1lbnQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NQYXJ0aWNsZSgoWG1sU2NoZW1hUGFydGljbGUpc2VxdWVuY2VzW2ldKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJ0aWNsZSBpcyBYbWxTY2hlbWFHcm91cFJlZikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYUdyb3VwUmVmIGdyb3VwUmVmID0gKFhtbFNjaGVtYUdyb3VwUmVmKXBhcnRpY2xlOw0KICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBSZWYuUmVmTmFtZS5Jc0VtcHR5KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzQXR0cmlidXRlLCAicmVmIiwgZ3JvdXBSZWYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVRTmFtZUF0dHJpYnV0ZShncm91cFJlZiwgInJlZiIsIGdyb3VwUmVmLlJlZk5hbWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnRpY2xlIGlzIFhtbFNjaGVtYUFueSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAoKFhtbFNjaGVtYUFueSlwYXJ0aWNsZSkuQnVpbGROYW1lc3BhY2VMaXN0VjFDb21wYXQoX3RhcmdldE5hbWVzcGFjZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZEFueSwgcGFydGljbGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgUHJlcHJvY2Vzc0Fubm90YXRpb24ocGFydGljbGUpOyAvL3NldCBwYXJlbnQgb2YgYW5ub3RhdGlvbiBjaGlsZCBvZiBncm91cCAvIGFsbC8gY2hvaWNlIC8gc2VxdWVuY2UNCiAgICAgICAgICAgIFZhbGlkYXRlSWRBdHRyaWJ1dGUocGFydGljbGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByZXByb2Nlc3NBdHRyaWJ1dGVzKFhtbFNjaGVtYU9iamVjdENvbGxlY3Rpb24gYXR0cmlidXRlcywgWG1sU2NoZW1hQW55QXR0cmlidXRlIGFueUF0dHJpYnV0ZSwgWG1sU2NoZW1hT2JqZWN0IHBhcmVudCkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhdHRyaWJ1dGVzLkNvdW50OyArK2kpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2V0UGFyZW50KGF0dHJpYnV0ZXNbaV0sIHBhcmVudCk7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hQXR0cmlidXRlIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbaV0gYXMgWG1sU2NoZW1hQXR0cmlidXRlOw0KICAgICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NMb2NhbEF0dHJpYnV0ZShhdHRyaWJ1dGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgeyAvLyBYbWxTY2hlbWFBdHRyaWJ1dGVHcm91cFJlZg0KICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFBdHRyaWJ1dGVHcm91cFJlZiBhdHRyaWJ1dGVHcm91cFJlZiA9IChYbWxTY2hlbWFBdHRyaWJ1dGVHcm91cFJlZilhdHRyaWJ1dGVzW2ldOw0KICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlR3JvdXBSZWYuUmVmTmFtZS5Jc0VtcHR5KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzQXR0cmlidXRlLCAicmVmIiwgYXR0cmlidXRlR3JvdXBSZWYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVRTmFtZUF0dHJpYnV0ZShhdHRyaWJ1dGVHcm91cFJlZiwgInJlZiIsIGF0dHJpYnV0ZUdyb3VwUmVmLlJlZk5hbWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NBbm5vdGF0aW9uKGF0dHJpYnV0ZXNbaV0pOyAvL3NldCBwYXJlbnQgb2YgYW5ub3RhdGlvbiBjaGlsZCBvZiBhdHRyaWJ1dGVHcm91cFJlZg0KICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZUlkQXR0cmlidXRlKGF0dHJpYnV0ZXNbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhbnlBdHRyaWJ1dGUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNldFBhcmVudChhbnlBdHRyaWJ1dGUsIHBhcmVudCk7DQogICAgICAgICAgICAgICAgICAgIFByZXByb2Nlc3NBbm5vdGF0aW9uKGFueUF0dHJpYnV0ZSk7IC8vc2V0IHBhcmVudCBvZiBhbm5vdGF0aW9uIGNoaWxkIG9mIGFueSBhdHRyaWJ1dGUNCiAgICAgICAgICAgICAgICAgICAgYW55QXR0cmlidXRlLkJ1aWxkTmFtZXNwYWNlTGlzdFYxQ29tcGF0KF90YXJnZXROYW1lc3BhY2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSW52YWxpZEFueUF0dHJpYnV0ZSwgYW55QXR0cmlidXRlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgVmFsaWRhdGVJZEF0dHJpYnV0ZShhbnlBdHRyaWJ1dGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFZhbGlkYXRlSWRBdHRyaWJ1dGUoWG1sU2NoZW1hT2JqZWN0IHhzbykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHhzby5JZEF0dHJpYnV0ZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeHNvLklkQXR0cmlidXRlID0gTmFtZVRhYmxlLkFkZChYbWxDb252ZXJ0LlZlcmlmeU5DTmFtZSh4c28uSWRBdHRyaWJ1dGUpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9zY2hlbWEuSWRzW3hzby5JZEF0dHJpYnV0ZV0gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRHVwSWRBdHRyaWJ1dGUsIHhzbyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBfc2NoZW1hLklkcy5BZGQoeHNvLklkQXR0cmlidXRlLCB4c28pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9JbnZhbGlkSWRBdHRyaWJ1dGUsIGV4Lk1lc3NhZ2UsIHhzbyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFZhbGlkYXRlTmFtZUF0dHJpYnV0ZShYbWxTY2hlbWFPYmplY3QgeHNvKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgbmFtZSA9IHhzby5OYW1lQXR0cmlidXRlOw0KICAgICAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCB8fCBuYW1lLkxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWROYW1lQXR0cmlidXRlRXgsIG51bGwsIFNSLlNjaF9OdWxsVmFsdWUsIHhzbyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvL05vcm1hbGl6ZSB3aGl0ZXNwYWNlIHNpbmNlIE5DTmFtZSBoYXMgd2hpdGVzcGFjZSBmYWNldD0iY29sbGFwc2UiDQogICAgICAgICAgICBuYW1lID0gWG1sQ29tcGxpYW5jZVV0aWwuTm9uQ0RhdGFOb3JtYWxpemUobmFtZSk7DQogICAgICAgICAgICBpbnQgbGVuID0gVmFsaWRhdGVOYW1lcy5QYXJzZU5DTmFtZShuYW1lLCAwKTsNCiAgICAgICAgICAgIGlmIChsZW4gIT0gbmFtZS5MZW5ndGgpDQogICAgICAgICAgICB7IC8vIElmIHRoZSBzdHJpbmcgaXMgbm90IGEgdmFsaWQgTkNOYW1lLCB0aGVuIHRocm93IG9yIHJldHVybiBmYWxzZQ0KICAgICAgICAgICAgICAgIHN0cmluZ1tdIGludkNoYXJBcmdzID0gWG1sRXhjZXB0aW9uLkJ1aWxkQ2hhckV4Y2VwdGlvbkFyZ3MobmFtZSwgbGVuKTsNCiAgICAgICAgICAgICAgICBzdHJpbmcgaW5uZXJTdHIgPSBTUi5Gb3JtYXQoU1IuWG1sX0JhZE5hbWVDaGFyV2l0aFBvcywgaW52Q2hhckFyZ3NbMF0sIGludkNoYXJBcmdzWzFdLCBsZW4pOw0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWROYW1lQXR0cmlidXRlRXgsIG5hbWUsIGlubmVyU3RyLCB4c28pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzby5OYW1lQXR0cmlidXRlID0gTmFtZVRhYmxlLkFkZChuYW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBWYWxpZGF0ZVFOYW1lQXR0cmlidXRlKFhtbFNjaGVtYU9iamVjdCB4c28sIHN0cmluZyBhdHRyaWJ1dGVOYW1lLCBYbWxRdWFsaWZpZWROYW1lIHZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YWx1ZS5WZXJpZnkoKTsNCiAgICAgICAgICAgICAgICB2YWx1ZS5BdG9taXplKE5hbWVUYWJsZSk7DQogICAgICAgICAgICAgICAgaWYgKF9yZWZlcmVuY2VOYW1lc3BhY2VzW3ZhbHVlLk5hbWVzcGFjZV0gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1VucmVmTlMsIHZhbHVlLk5hbWVzcGFjZSwgeHNvLCBYbWxTZXZlcml0eVR5cGUuV2FybmluZyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9JbnZhbGlkQXR0cmlidXRlLCBhdHRyaWJ1dGVOYW1lLCBleC5NZXNzYWdlLCB4c28pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFNldFBhcmVudChYbWxTY2hlbWFPYmplY3QgY2hpbGQsIFhtbFNjaGVtYU9iamVjdCBwYXJlbnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGNoaWxkLlBhcmVudCA9IHBhcmVudDsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQcmVwcm9jZXNzQW5ub3RhdGlvbihYbWxTY2hlbWFPYmplY3Qgc2NoZW1hT2JqZWN0KQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFBbm5vdGF0ZWQgYW5ub3RhdGVkID0gc2NoZW1hT2JqZWN0IGFzIFhtbFNjaGVtYUFubm90YXRlZDsNCiAgICAgICAgICAgIGlmIChhbm5vdGF0ZWQgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoYW5ub3RhdGVkLkFubm90YXRpb24gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFubm90YXRlZC5Bbm5vdGF0aW9uLlBhcmVudCA9IHNjaGVtYU9iamVjdDsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbm5vdGF0ZWQuQW5ub3RhdGlvbi5JdGVtcy5Db3VudDsgKytpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBhbm5vdGF0ZWQuQW5ub3RhdGlvbi5JdGVtc1tpXS5QYXJlbnQgPSBhbm5vdGF0ZWQuQW5ub3RhdGlvbjsgLy9DYW4gYmUgZG9jdW1lbnRhdGlvbiBvciBhcHBJbmZvDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFVyaSBSZXNvbHZlU2NoZW1hTG9jYXRpb25VcmkoWG1sU2NoZW1hIGVuY2xvc2luZ1NjaGVtYSwgc3RyaW5nIGxvY2F0aW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3htbFJlc29sdmVyLlJlc29sdmVVcmkoZW5jbG9zaW5nU2NoZW1hLkJhc2VVcmksIGxvY2F0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFN0cmVhbSBHZXRTY2hlbWFFbnRpdHkoVXJpIHJ1cmkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiAoU3RyZWFtKV94bWxSZXNvbHZlci5HZXRFbnRpdHkocnVyaSwgbnVsbCwgbnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDYxOA0KfSAgLy8gbmFtZXNwYWNlIFN5c3RlbS5YbWwNCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XdrBuilder.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlNjaGVtYQ0Kew0KICAgIHVzaW5nIFN5c3RlbS5JTzsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnM7DQogICAgdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQogICAgdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KICAgIHVzaW5nIFN5c3RlbS5Db21wb25lbnRNb2RlbDsNCiAgICB1c2luZyBTeXN0ZW0uR2xvYmFsaXphdGlvbjsNCiAgICB1c2luZyBTeXN0ZW0uUnVudGltZS5WZXJzaW9uaW5nOw0KDQogICAgLyoNCiAgICAgKiBUaGUgWGRyQnVpbGRlciBjbGFzcyBwYXJzZXMgdGhlIFhEUiBTY2hlbWEgYW5kIA0KICAgICAqIGJ1aWxkcyBpbnRlcm5hbCB2YWxpZGF0aW9uIGluZm9ybWF0aW9uIA0KICAgICAqLw0KICAgIGludGVybmFsIHNlYWxlZCBjbGFzcyBYZHJCdWlsZGVyIDogU2NoZW1hQnVpbGRlcg0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgWGRyU2NoZW1hID0gMTsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgWGRyRWxlbWVudFR5cGUgPSAyOw0KICAgICAgICBwcml2YXRlIGNvbnN0IGludCBYZHJBdHRyaWJ1dGVUeXBlID0gMzsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgWGRyRWxlbWVudCA9IDQ7DQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFhkckF0dHJpYnV0ZSA9IDU7DQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFhkckdyb3VwID0gNjsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgWGRyRWxlbWVudERhdGF0eXBlID0gNzsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgWGRyQXR0cmlidXRlRGF0YXR5cGUgPSA4Ow0KDQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFNjaGVtYUZsYWdzTnMgPSAweDAxMDA7DQoNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgU3RhY2tJbmNyZW1lbnQgPSAxMDsNCg0KDQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFNjaGVtYU9yZGVyTm9uZSA9IDA7DQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFNjaGVtYU9yZGVyTWFueSA9IDE7DQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFNjaGVtYU9yZGVyU2VxdWVuY2UgPSAyOw0KICAgICAgICBwcml2YXRlIGNvbnN0IGludCBTY2hlbWFPcmRlckNob2ljZSA9IDM7DQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFNjaGVtYU9yZGVyQWxsID0gNDsNCg0KICAgICAgICBwcml2YXRlIGNvbnN0IGludCBTY2hlbWFDb250ZW50Tm9uZSA9IDA7DQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFNjaGVtYUNvbnRlbnRFbXB0eSA9IDE7DQogICAgICAgIHByaXZhdGUgY29uc3QgaW50IFNjaGVtYUNvbnRlbnRUZXh0ID0gMjsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgU2NoZW1hQ29udGVudE1peGVkID0gMzsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgU2NoZW1hQ29udGVudEVsZW1lbnQgPSA0Ow0KDQoNCiAgICAgICAgcHJpdmF0ZSBzZWFsZWQgY2xhc3MgRGVjbEJhc2VJbmZvDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIHVzZWQgZm9yIDxlbGVtZW50Li4uIG9yIDxhdHRyaWJ1dGUuLi4NCiAgICAgICAgICAgIGludGVybmFsIFhtbFF1YWxpZmllZE5hbWUgX05hbWU7DQogICAgICAgICAgICBpbnRlcm5hbCBzdHJpbmcgX1ByZWZpeDsNCiAgICAgICAgICAgIGludGVybmFsIFhtbFF1YWxpZmllZE5hbWUgX1R5cGVOYW1lOw0KICAgICAgICAgICAgaW50ZXJuYWwgc3RyaW5nIF9UeXBlUHJlZml4Ow0KICAgICAgICAgICAgaW50ZXJuYWwgb2JqZWN0IF9EZWZhdWx0Ow0KICAgICAgICAgICAgaW50ZXJuYWwgb2JqZWN0IF9SZXZpc2VzOw0KICAgICAgICAgICAgaW50ZXJuYWwgdWludCBfTWF4T2NjdXJzOw0KICAgICAgICAgICAgaW50ZXJuYWwgdWludCBfTWluT2NjdXJzOw0KDQogICAgICAgICAgICAvLyB1c2VkIGZvciBjaGVja2luZyB1bmRlY2xhcmVkIGF0dHJpYnV0ZSB0eXBlDQogICAgICAgICAgICBpbnRlcm5hbCBib29sIF9DaGVja2luZzsNCiAgICAgICAgICAgIGludGVybmFsIFNjaGVtYUVsZW1lbnREZWNsIF9FbGVtZW50RGVjbDsNCiAgICAgICAgICAgIGludGVybmFsIFNjaGVtYUF0dERlZiBfQXR0ZGVmOw0KICAgICAgICAgICAgaW50ZXJuYWwgRGVjbEJhc2VJbmZvIF9OZXh0Ow0KDQogICAgICAgICAgICBpbnRlcm5hbCBEZWNsQmFzZUluZm8oKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFJlc2V0KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGludGVybmFsIHZvaWQgUmVzZXQoKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9OYW1lID0gWG1sUXVhbGlmaWVkTmFtZS5FbXB0eTsNCiAgICAgICAgICAgICAgICBfUHJlZml4ID0gbnVsbDsNCiAgICAgICAgICAgICAgICBfVHlwZU5hbWUgPSBYbWxRdWFsaWZpZWROYW1lLkVtcHR5Ow0KICAgICAgICAgICAgICAgIF9UeXBlUHJlZml4ID0gbnVsbDsNCiAgICAgICAgICAgICAgICBfRGVmYXVsdCA9IG51bGw7DQogICAgICAgICAgICAgICAgX1JldmlzZXMgPSBudWxsOw0KICAgICAgICAgICAgICAgIF9NYXhPY2N1cnMgPSAxOw0KICAgICAgICAgICAgICAgIF9NaW5PY2N1cnMgPSAxOw0KICAgICAgICAgICAgICAgIF9DaGVja2luZyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIF9FbGVtZW50RGVjbCA9IG51bGw7DQogICAgICAgICAgICAgICAgX05leHQgPSBudWxsOw0KICAgICAgICAgICAgICAgIF9BdHRkZWYgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIHByaXZhdGUgc2VhbGVkIGNsYXNzIEdyb3VwQ29udGVudA0KICAgICAgICB7DQogICAgICAgICAgICBpbnRlcm5hbCB1aW50IF9NaW5WYWw7DQogICAgICAgICAgICBpbnRlcm5hbCB1aW50IF9NYXhWYWw7DQogICAgICAgICAgICBpbnRlcm5hbCBib29sIF9IYXNNYXhBdHRyOw0KICAgICAgICAgICAgaW50ZXJuYWwgYm9vbCBfSGFzTWluQXR0cjsNCiAgICAgICAgICAgIGludGVybmFsIGludCBfT3JkZXI7DQoNCiAgICAgICAgICAgIGludGVybmFsIHN0YXRpYyB2b2lkIENvcHkoR3JvdXBDb250ZW50IGZyb20sIEdyb3VwQ29udGVudCB0bykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0by5fTWluVmFsID0gZnJvbS5fTWluVmFsOw0KICAgICAgICAgICAgICAgIHRvLl9NYXhWYWwgPSBmcm9tLl9NYXhWYWw7DQogICAgICAgICAgICAgICAgdG8uX09yZGVyID0gZnJvbS5fT3JkZXI7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGludGVybmFsIHN0YXRpYyBHcm91cENvbnRlbnQgQ29weShHcm91cENvbnRlbnQgb3RoZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgR3JvdXBDb250ZW50IGcgPSBuZXcgR3JvdXBDb250ZW50KCk7DQogICAgICAgICAgICAgICAgQ29weShvdGhlciwgZyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGc7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgcHJpdmF0ZSBzZWFsZWQgY2xhc3MgRWxlbWVudENvbnRlbnQNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gZm9yIDxFbGVtZW50VHlwZSAuLi4NCiAgICAgICAgICAgIGludGVybmFsIFNjaGVtYUVsZW1lbnREZWNsIF9FbGVtZW50RGVjbDsgICAgICAgICAgLy8gRWxlbWVudCBJbmZvcm1hdGlvbg0KDQogICAgICAgICAgICBpbnRlcm5hbCBpbnQgX0NvbnRlbnRBdHRyOyAgICAgICAgICAgICAgLy8gY29udGVudCBhdHRyaWJ1dGUNCiAgICAgICAgICAgIGludGVybmFsIGludCBfT3JkZXJBdHRyOyAgICAgICAgICAgICAgICAvLyBvcmRlciBhdHRyaWJ1dGUNCg0KICAgICAgICAgICAgaW50ZXJuYWwgYm9vbCBfTWFzdGVyR3JvdXBSZXF1aXJlZDsgICAgICAvLyBJbiBhIHNpdHVhdGlvbiBsaWtlIDwhRUxFTUVOVCByb290IChlMSk+IGUxIGhhcyB0byBoYXZlIGEgKCkNCiAgICAgICAgICAgIGludGVybmFsIGJvb2wgX0V4aXN0VGVybWluYWw7ICAgICAgICAgICAgLy8gd2hlbiB0aGVyZSBleGlzdCBhIHRlcm1pbmFsLCB3ZSBuZWVkIHRvIGFkZE9yZGVyIGJlZm9yZQ0KDQogICAgICAgICAgICAvLyB3ZSBjYW4gYWRkIGFub3RoZXIgdGVybWluYWwNCiAgICAgICAgICAgIGludGVybmFsIGJvb2wgX0FsbG93RGF0YVR5cGU7ICAgICAgICAgICAgLy8gbXVzdCBoYXZlIHRleHRPbmx5IGlmIHdlIGhhdmUgZGF0YXR5cGUNCiAgICAgICAgICAgIGludGVybmFsIGJvb2wgX0hhc0RhdGFUeXBlOyAgICAgICAgICAgICAgLy8gZ290IGRhdGEgdHlwZQ0KDQogICAgICAgICAgICAvLyBmb3IgPGVsZW1lbnQgLi4uDQogICAgICAgICAgICBpbnRlcm5hbCBib29sIF9IYXNUeXBlOyAgICAgICAgICAgICAgICAgIC8vIHVzZXIgbXVzdCBoYXZlIGEgdHlwZSBhdHRyaWJ1dGUgaW4gPGVsZW1lbnQgLi4uDQogICAgICAgICAgICBpbnRlcm5hbCBib29sIF9FbnVtZXJhdGlvblJlcXVpcmVkOw0KICAgICAgICAgICAgaW50ZXJuYWwgdWludCBfTWluVmFsOw0KICAgICAgICAgICAgaW50ZXJuYWwgdWludCBfTWF4VmFsOyAgICAgICAgICAgICAgICAgICAvLyAtMSBtZWFucyBpbmZpbml0eQ0KDQogICAgICAgICAgICBpbnRlcm5hbCB1aW50IF9NYXhMZW5ndGg7ICAgICAgICAgICAgICAgIC8vIGR0Om1heExlbmd0aA0KICAgICAgICAgICAgaW50ZXJuYWwgdWludCBfTWluTGVuZ3RoOyAgICAgICAgICAgICAgICAvLyBkdDptaW5MZW5ndGgNCg0KICAgICAgICAgICAgaW50ZXJuYWwgSGFzaHRhYmxlIF9BdHREZWZMaXN0OyAgICAgICAgICAgICAgIC8vIGEgbGlzdCBvZiBjdXJyZW50IEF0dERlZnMgZm9yIHRoZSA8RWxlbWVudFR5cGUgLi4uDQogICAgICAgICAgICAvLyBvbmx5IHRoZSB1c2VkIG9uZSB3aWxsIGJlIGFkZGVkDQogICAgICAgIH07DQoNCiAgICAgICAgcHJpdmF0ZSBzZWFsZWQgY2xhc3MgQXR0cmlidXRlQ29udGVudA0KICAgICAgICB7DQogICAgICAgICAgICAvLyB1c2VkIGZvciA8QXR0cmlidXRlVHlwZSAuLi4NCiAgICAgICAgICAgIGludGVybmFsIFNjaGVtYUF0dERlZiBfQXR0RGVmOw0KDQogICAgICAgICAgICAvLyB1c2VkIHRvIHN0b3JlIG5hbWUgJiBwcmVmaXggZm9yIHRoZSBBdHRyaWJ1dGVUeXBlDQogICAgICAgICAgICBpbnRlcm5hbCBYbWxRdWFsaWZpZWROYW1lIF9OYW1lOw0KICAgICAgICAgICAgaW50ZXJuYWwgc3RyaW5nIF9QcmVmaXg7DQogICAgICAgICAgICBpbnRlcm5hbCBib29sIF9SZXF1aXJlZDsgICAgICAgICAgICAgICAgICAvLyB0cnVlOiAgd2hlbiB0aGUgYXR0cmlidXRlIHJlcXVpcmVkPSJ5ZXMiDQoNCiAgICAgICAgICAgIC8vIHVzZWQgZm9yIGJvdGggQXR0cmlidXRlVHlwZSBhbmQgYXR0cmlidXRlDQogICAgICAgICAgICBpbnRlcm5hbCB1aW50IF9NaW5WYWw7DQogICAgICAgICAgICBpbnRlcm5hbCB1aW50IF9NYXhWYWw7ICAgICAgICAgICAgICAgICAgIC8vIC0xIG1lYW5zIGluZmluaXR5DQoNCiAgICAgICAgICAgIGludGVybmFsIHVpbnQgX01heExlbmd0aDsgICAgICAgICAgICAgICAgIC8vIGR0Om1heExlbmd0aA0KICAgICAgICAgICAgaW50ZXJuYWwgdWludCBfTWluTGVuZ3RoOyAgICAgICAgICAgICAgICAgLy8gZHQ6bWluTGVuZ3RoDQoNCiAgICAgICAgICAgIC8vIHVzZWQgZm9yIGRhdGF0eXBlIA0KICAgICAgICAgICAgaW50ZXJuYWwgYm9vbCBfRW51bWVyYXRpb25SZXF1aXJlZDsgICAgICAgLy8gd2hlbiB3ZSBoYXZlIGR0OnZhbHVlIHRoZW4gd2UgbXVzdCBoYXZlIGR0OnR5cGU9ImVudW1lcmF0aW9uIg0KICAgICAgICAgICAgaW50ZXJuYWwgYm9vbCBfSGFzRGF0YVR5cGU7DQoNCiAgICAgICAgICAgIC8vIHVzZWQgZm9yIDxhdHRyaWJ1dGUgLi4uDQogICAgICAgICAgICBpbnRlcm5hbCBib29sIF9HbG9iYWw7DQoNCiAgICAgICAgICAgIGludGVybmFsIG9iamVjdCBfRGVmYXVsdDsNCiAgICAgICAgfTsNCg0KICAgICAgICBwcml2YXRlIGRlbGVnYXRlIHZvaWQgWGRyQnVpbGRGdW5jdGlvbihYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpOw0KICAgICAgICBwcml2YXRlIGRlbGVnYXRlIHZvaWQgWGRySW5pdEZ1bmN0aW9uKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaik7DQogICAgICAgIHByaXZhdGUgZGVsZWdhdGUgdm9pZCBYZHJCZWdpbkNoaWxkRnVuY3Rpb24oWGRyQnVpbGRlciBidWlsZGVyKTsNCiAgICAgICAgcHJpdmF0ZSBkZWxlZ2F0ZSB2b2lkIFhkckVuZENoaWxkRnVuY3Rpb24oWGRyQnVpbGRlciBidWlsZGVyKTsNCg0KICAgICAgICBwcml2YXRlIHNlYWxlZCBjbGFzcyBYZHJBdHRyaWJ1dGVFbnRyeQ0KICAgICAgICB7DQogICAgICAgICAgICBpbnRlcm5hbCBTY2hlbWFOYW1lcy5Ub2tlbiBfQXR0cmlidXRlOyAgICAgLy8gcG9zc2libGUgYXR0cmlidXRlIG5hbWVzDQogICAgICAgICAgICBpbnRlcm5hbCBpbnQgX1NjaGVtYUZsYWdzOw0KICAgICAgICAgICAgaW50ZXJuYWwgWG1sU2NoZW1hRGF0YXR5cGUgX0RhdGF0eXBlOw0KICAgICAgICAgICAgaW50ZXJuYWwgWGRyQnVpbGRGdW5jdGlvbiBfQnVpbGRGdW5jOyAgICAgLy8gQ29ycmVzcG9uZGluZyBidWlsZCBmdW5jdGlvbnMgZm9yIGF0dHJpYnV0ZSB2YWx1ZQ0KDQogICAgICAgICAgICBpbnRlcm5hbCBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbiBhLCBYbWxUb2tlbml6ZWRUeXBlIHR0eXBlLCBYZHJCdWlsZEZ1bmN0aW9uIGJ1aWxkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9BdHRyaWJ1dGUgPSBhOw0KICAgICAgICAgICAgICAgIF9EYXRhdHlwZSA9IFhtbFNjaGVtYURhdGF0eXBlLkZyb21YbWxUb2tlbml6ZWRUeXBlKHR0eXBlKTsNCiAgICAgICAgICAgICAgICBfU2NoZW1hRmxhZ3MgPSAwOw0KICAgICAgICAgICAgICAgIF9CdWlsZEZ1bmMgPSBidWlsZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGludGVybmFsIFhkckF0dHJpYnV0ZUVudHJ5KFNjaGVtYU5hbWVzLlRva2VuIGEsIFhtbFRva2VuaXplZFR5cGUgdHR5cGUsIGludCBzY2hlbWFGbGFncywgWGRyQnVpbGRGdW5jdGlvbiBidWlsZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfQXR0cmlidXRlID0gYTsNCiAgICAgICAgICAgICAgICBfRGF0YXR5cGUgPSBYbWxTY2hlbWFEYXRhdHlwZS5Gcm9tWG1sVG9rZW5pemVkVHlwZSh0dHlwZSk7DQogICAgICAgICAgICAgICAgX1NjaGVtYUZsYWdzID0gc2NoZW1hRmxhZ3M7DQogICAgICAgICAgICAgICAgX0J1aWxkRnVuYyA9IGJ1aWxkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFhkckVudHJ5IGNvbnRyb2xzIHRoZSBzdGF0ZXMgb2YgcGFyc2luZyBhIHNjaGVtYSBkb2N1bWVudA0KICAgICAgICAvLyBhbmQgY2FsbHMgdGhlIGNvcnJlc3BvbmRpbmcgImluaXQiLCAiZW5kIiBhbmQgImJ1aWxkIiBmdW5jdGlvbnMgd2hlbiBuZWNlc3NhcnkNCiAgICAgICAgLy8NCiAgICAgICAgcHJpdmF0ZSBzZWFsZWQgY2xhc3MgWGRyRW50cnkNCiAgICAgICAgew0KICAgICAgICAgICAgaW50ZXJuYWwgU2NoZW1hTmFtZXMuVG9rZW4gX05hbWU7ICAgICAgICAgICAgICAgLy8gdGhlIG5hbWUgb2YgdGhlIG9iamVjdCBpdCBpcyBjb21wYXJpbmcgdG8NCiAgICAgICAgICAgIGludGVybmFsIGludFtdIF9OZXh0U3RhdGVzOyAgICAgICAgIC8vIHBvc3NpYmxlIG5leHQgc3RhdGVzDQogICAgICAgICAgICBpbnRlcm5hbCBYZHJBdHRyaWJ1dGVFbnRyeVtdIF9BdHRyaWJ1dGVzOyAgICAgICAgIC8vIGFsbG93ZWQgYXR0cmlidXRlcw0KICAgICAgICAgICAgaW50ZXJuYWwgWGRySW5pdEZ1bmN0aW9uIF9Jbml0RnVuYzsgICAgICAgICAgIC8vICJpbml0IiBmdW5jdGlvbnMgaW4gWGRyQnVpbGRlcg0KICAgICAgICAgICAgaW50ZXJuYWwgWGRyQmVnaW5DaGlsZEZ1bmN0aW9uIF9CZWdpbkNoaWxkRnVuYzsgICAgIC8vICJiZWdpbiIgZnVuY3Rpb25zIGluIFhkckJ1aWxkZXIgZm9yIEJlZ2luQ2hpbGRyZW4NCiAgICAgICAgICAgIGludGVybmFsIFhkckVuZENoaWxkRnVuY3Rpb24gX0VuZENoaWxkRnVuYzsgICAgICAgLy8gImVuZCIgZnVuY3Rpb25zIGluIFhkckJ1aWxkZXIgZm9yIEVuZENoaWxkcmVuDQogICAgICAgICAgICBpbnRlcm5hbCBib29sIF9BbGxvd1RleHQ7ICAgICAgICAgIC8vIHdoZXRoZXIgdGV4dCBjb250ZW50IGlzIGFsbG93ZWQgIA0KDQogICAgICAgICAgICBpbnRlcm5hbCBYZHJFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbiBuLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50W10gc3RhdGVzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWGRyQXR0cmlidXRlRW50cnlbXSBhdHRyaWJ1dGVzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWGRySW5pdEZ1bmN0aW9uIGluaXQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYZHJCZWdpbkNoaWxkRnVuY3Rpb24gYmVnaW4sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYZHJFbmRDaGlsZEZ1bmN0aW9uIGVuZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgZlRleHQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX05hbWUgPSBuOw0KICAgICAgICAgICAgICAgIF9OZXh0U3RhdGVzID0gc3RhdGVzOw0KICAgICAgICAgICAgICAgIF9BdHRyaWJ1dGVzID0gYXR0cmlidXRlczsNCiAgICAgICAgICAgICAgICBfSW5pdEZ1bmMgPSBpbml0Ow0KICAgICAgICAgICAgICAgIF9CZWdpbkNoaWxkRnVuYyA9IGJlZ2luOw0KICAgICAgICAgICAgICAgIF9FbmRDaGlsZEZ1bmMgPSBlbmQ7DQogICAgICAgICAgICAgICAgX0FsbG93VGV4dCA9IGZUZXh0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQoNCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAgICAgLy8gRGF0YSBzdHJ1Y3R1cmVzIGZvciBYTUwtRGF0YSBSZWR1Y2VkIChYRFIgU2NoZW1hKQ0KICAgICAgICAvLw0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEVsZW1lbnRzDQogICAgICAgIC8vDQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IGludFtdIHNfWERSX1Jvb3RfRWxlbWVudCA9IHsgWGRyU2NoZW1hIH07DQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IGludFtdIHNfWERSX1Jvb3RfU3ViRWxlbWVudHMgPSB7IFhkckVsZW1lbnRUeXBlLCBYZHJBdHRyaWJ1dGVUeXBlIH07DQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IGludFtdIHNfWERSX0VsZW1lbnRUeXBlX1N1YkVsZW1lbnRzID0geyBYZHJFbGVtZW50LCBYZHJHcm91cCwgWGRyQXR0cmlidXRlVHlwZSwgWGRyQXR0cmlidXRlLCBYZHJFbGVtZW50RGF0YXR5cGUgfTsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgaW50W10gc19YRFJfQXR0cmlidXRlVHlwZV9TdWJFbGVtZW50cyA9IHsgWGRyQXR0cmlidXRlRGF0YXR5cGUgfTsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgaW50W10gc19YRFJfR3JvdXBfU3ViRWxlbWVudHMgPSB7IFhkckVsZW1lbnQsIFhkckdyb3VwIH07DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gQXR0cmlidXRlcw0KICAgICAgICAvLw0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBYZHJBdHRyaWJ1dGVFbnRyeVtdIHNfWERSX1Jvb3RfQXR0cmlidXRlcyA9DQogICAgICAgIHsNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFOYW1lLCBYbWxUb2tlbml6ZWRUeXBlLkNEQVRBLCBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRSb290X05hbWUpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hSWQsICAgWG1sVG9rZW5pemVkVHlwZS5RTmFtZSwgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkUm9vdF9JRCkgKQ0KICAgICAgICB9Ow0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFhkckF0dHJpYnV0ZUVudHJ5W10gc19YRFJfRWxlbWVudFR5cGVfQXR0cmlidXRlcyA9DQogICAgICAgIHsNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFOYW1lLCAgICAgICAgIFhtbFRva2VuaXplZFR5cGUuUU5hbWUsIFNjaGVtYUZsYWdzTnMsICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRFbGVtZW50VHlwZV9OYW1lKSApLA0KICAgICAgICAgICAgbmV3IFhkckF0dHJpYnV0ZUVudHJ5KFNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYUNvbnRlbnQsICAgICAgWG1sVG9rZW5pemVkVHlwZS5RTmFtZSwgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkRWxlbWVudFR5cGVfQ29udGVudCkgKSwNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFNb2RlbCwgICAgICAgIFhtbFRva2VuaXplZFR5cGUuUU5hbWUsICAgIG5ldyBYZHJCdWlsZEZ1bmN0aW9uKFhEUl9CdWlsZEVsZW1lbnRUeXBlX01vZGVsKSApLA0KICAgICAgICAgICAgbmV3IFhkckF0dHJpYnV0ZUVudHJ5KFNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYU9yZGVyLCAgICAgICAgWG1sVG9rZW5pemVkVHlwZS5RTmFtZSwgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkRWxlbWVudFR5cGVfT3JkZXIpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRUeXBlLCAgICAgICBYbWxUb2tlbml6ZWRUeXBlLkNEQVRBLCAgICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRFbGVtZW50VHlwZV9EdFR5cGUpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRWYWx1ZXMsICAgICBYbWxUb2tlbml6ZWRUeXBlLk5NVE9LRU5TLCBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRFbGVtZW50VHlwZV9EdFZhbHVlcykgKSwNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFEdE1heExlbmd0aCwgIFhtbFRva2VuaXplZFR5cGUuQ0RBVEEsICAgIG5ldyBYZHJCdWlsZEZ1bmN0aW9uKFhEUl9CdWlsZEVsZW1lbnRUeXBlX0R0TWF4TGVuZ3RoKSApLA0KICAgICAgICAgICAgbmV3IFhkckF0dHJpYnV0ZUVudHJ5KFNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYUR0TWluTGVuZ3RoLCAgWG1sVG9rZW5pemVkVHlwZS5DREFUQSwgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkRWxlbWVudFR5cGVfRHRNaW5MZW5ndGgpICkNCiAgICAgICAgfTsNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBYZHJBdHRyaWJ1dGVFbnRyeVtdIHNfWERSX0F0dHJpYnV0ZVR5cGVfQXR0cmlidXRlcyA9DQogICAgICAgIHsNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFOYW1lLCAgICAgICAgIFhtbFRva2VuaXplZFR5cGUuUU5hbWUsICAgICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRBdHRyaWJ1dGVUeXBlX05hbWUpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hUmVxdWlyZWQsICAgICBYbWxUb2tlbml6ZWRUeXBlLlFOYW1lLCAgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkQXR0cmlidXRlVHlwZV9SZXF1aXJlZCkgKSwNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFEZWZhdWx0LCAgICAgIFhtbFRva2VuaXplZFR5cGUuQ0RBVEEsICAgICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRBdHRyaWJ1dGVUeXBlX0RlZmF1bHQpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRUeXBlLCAgICAgICBYbWxUb2tlbml6ZWRUeXBlLlFOYW1lLCAgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkQXR0cmlidXRlVHlwZV9EdFR5cGUpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRWYWx1ZXMsICAgICBYbWxUb2tlbml6ZWRUeXBlLk5NVE9LRU5TLCAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkQXR0cmlidXRlVHlwZV9EdFZhbHVlcykgKSwNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFEdE1heExlbmd0aCwgIFhtbFRva2VuaXplZFR5cGUuQ0RBVEEsICAgICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRBdHRyaWJ1dGVUeXBlX0R0TWF4TGVuZ3RoKSApLA0KICAgICAgICAgICAgbmV3IFhkckF0dHJpYnV0ZUVudHJ5KFNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYUR0TWluTGVuZ3RoLCAgWG1sVG9rZW5pemVkVHlwZS5DREFUQSwgICAgIG5ldyBYZHJCdWlsZEZ1bmN0aW9uKFhEUl9CdWlsZEF0dHJpYnV0ZVR5cGVfRHRNaW5MZW5ndGgpICkNCiAgICAgICAgfTsNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBYZHJBdHRyaWJ1dGVFbnRyeVtdIHNfWERSX0VsZW1lbnRfQXR0cmlidXRlcyA9DQogICAgICAgIHsNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFUeXBlLCAgICAgIFhtbFRva2VuaXplZFR5cGUuUU5hbWUsIFNjaGVtYUZsYWdzTnMsICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRFbGVtZW50X1R5cGUpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hTWluT2NjdXJzLCBYbWxUb2tlbml6ZWRUeXBlLkNEQVRBLCAgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkRWxlbWVudF9NaW5PY2N1cnMpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hTWF4T2NjdXJzLCBYbWxUb2tlbml6ZWRUeXBlLkNEQVRBLCAgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkRWxlbWVudF9NYXhPY2N1cnMpICkNCiAgICAgICAgfTsNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBYZHJBdHRyaWJ1dGVFbnRyeVtdIHNfWERSX0F0dHJpYnV0ZV9BdHRyaWJ1dGVzID0NCiAgICAgICAgew0KICAgICAgICAgICAgbmV3IFhkckF0dHJpYnV0ZUVudHJ5KFNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYVR5cGUsICAgICAgIFhtbFRva2VuaXplZFR5cGUuUU5hbWUsICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkQXR0cmlidXRlX1R5cGUpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hUmVxdWlyZWQsICAgWG1sVG9rZW5pemVkVHlwZS5RTmFtZSwgICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRBdHRyaWJ1dGVfUmVxdWlyZWQpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRGVmYXVsdCwgICAgWG1sVG9rZW5pemVkVHlwZS5DREFUQSwgICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRBdHRyaWJ1dGVfRGVmYXVsdCkgKQ0KICAgICAgICB9Ow0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFhkckF0dHJpYnV0ZUVudHJ5W10gc19YRFJfR3JvdXBfQXR0cmlidXRlcyA9DQogICAgICAgIHsNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFPcmRlciwgICAgIFhtbFRva2VuaXplZFR5cGUuUU5hbWUsICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkR3JvdXBfT3JkZXIpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hTWluT2NjdXJzLCBYbWxUb2tlbml6ZWRUeXBlLkNEQVRBLCAgIG5ldyBYZHJCdWlsZEZ1bmN0aW9uKFhEUl9CdWlsZEdyb3VwX01pbk9jY3VycykgKSwNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFNYXhPY2N1cnMsIFhtbFRva2VuaXplZFR5cGUuQ0RBVEEsICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkR3JvdXBfTWF4T2NjdXJzKSApDQogICAgICAgIH07DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgWGRyQXR0cmlidXRlRW50cnlbXSBzX1hEUl9FbGVtZW50RGF0YVR5cGVfQXR0cmlidXRlcyA9DQogICAgICAgIHsNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFEdFR5cGUsICAgICAgICBYbWxUb2tlbml6ZWRUeXBlLkNEQVRBLCAgICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRFbGVtZW50VHlwZV9EdFR5cGUpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRWYWx1ZXMsICAgICAgWG1sVG9rZW5pemVkVHlwZS5OTVRPS0VOUywgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkRWxlbWVudFR5cGVfRHRWYWx1ZXMpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRNYXhMZW5ndGgsICAgWG1sVG9rZW5pemVkVHlwZS5DREFUQSwgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkRWxlbWVudFR5cGVfRHRNYXhMZW5ndGgpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRNaW5MZW5ndGgsICAgWG1sVG9rZW5pemVkVHlwZS5DREFUQSwgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkRWxlbWVudFR5cGVfRHRNaW5MZW5ndGgpICkNCiAgICAgICAgfTsNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBYZHJBdHRyaWJ1dGVFbnRyeVtdIHNfWERSX0F0dHJpYnV0ZURhdGFUeXBlX0F0dHJpYnV0ZXMgPQ0KICAgICAgICB7DQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRUeXBlLCAgICAgICAgWG1sVG9rZW5pemVkVHlwZS5RTmFtZSwgICAgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkQXR0cmlidXRlVHlwZV9EdFR5cGUpICksDQogICAgICAgICAgICBuZXcgWGRyQXR0cmlidXRlRW50cnkoU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRHRWYWx1ZXMsICAgICAgWG1sVG9rZW5pemVkVHlwZS5OTVRPS0VOUywgbmV3IFhkckJ1aWxkRnVuY3Rpb24oWERSX0J1aWxkQXR0cmlidXRlVHlwZV9EdFZhbHVlcykgKSwNCiAgICAgICAgICAgIG5ldyBYZHJBdHRyaWJ1dGVFbnRyeShTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFEdE1heExlbmd0aCwgICBYbWxUb2tlbml6ZWRUeXBlLkNEQVRBLCAgICBuZXcgWGRyQnVpbGRGdW5jdGlvbihYRFJfQnVpbGRBdHRyaWJ1dGVUeXBlX0R0TWF4TGVuZ3RoKSApLA0KICAgICAgICAgICAgbmV3IFhkckF0dHJpYnV0ZUVudHJ5KFNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYUR0TWluTGVuZ3RoLCAgIFhtbFRva2VuaXplZFR5cGUuQ0RBVEEsICAgIG5ldyBYZHJCdWlsZEZ1bmN0aW9uKFhEUl9CdWlsZEF0dHJpYnV0ZVR5cGVfRHRNaW5MZW5ndGgpICkNCn07DQogICAgICAgIC8vDQogICAgICAgIC8vIFNjaGVtYSBlbnRyaWVzDQogICAgICAgIC8vDQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFhkckVudHJ5W10gc19zY2hlbWFFbnRyaWVzID0NCiAgICAgICAgew0KICAgICAgICAgICAgbmV3IFhkckVudHJ5KCBTY2hlbWFOYW1lcy5Ub2tlbi5FbXB0eSwgICAgIHNfWERSX1Jvb3RfRWxlbWVudCwgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpLA0KICAgICAgICAgICAgbmV3IFhkckVudHJ5KCBTY2hlbWFOYW1lcy5Ub2tlbi5YZHJSb290LCAgICAgc19YRFJfUm9vdF9TdWJFbGVtZW50cywgc19YRFJfUm9vdF9BdHRyaWJ1dGVzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgWGRySW5pdEZ1bmN0aW9uKFhEUl9Jbml0Um9vdCksDQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBYZHJCZWdpbkNoaWxkRnVuY3Rpb24oWERSX0JlZ2luUm9vdCksDQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBYZHJFbmRDaGlsZEZ1bmN0aW9uKFhEUl9FbmRSb290KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpLA0KICAgICAgICAgICAgbmV3IFhkckVudHJ5KCBTY2hlbWFOYW1lcy5Ub2tlbi5YZHJFbGVtZW50VHlwZSwgICAgc19YRFJfRWxlbWVudFR5cGVfU3ViRWxlbWVudHMsIHNfWERSX0VsZW1lbnRUeXBlX0F0dHJpYnV0ZXMsDQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBYZHJJbml0RnVuY3Rpb24oWERSX0luaXRFbGVtZW50VHlwZSksDQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBYZHJCZWdpbkNoaWxkRnVuY3Rpb24oWERSX0JlZ2luRWxlbWVudFR5cGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgWGRyRW5kQ2hpbGRGdW5jdGlvbihYRFJfRW5kRWxlbWVudFR5cGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSksDQogICAgICAgICAgICBuZXcgWGRyRW50cnkoIFNjaGVtYU5hbWVzLlRva2VuLlhkckF0dHJpYnV0ZVR5cGUsICBzX1hEUl9BdHRyaWJ1dGVUeXBlX1N1YkVsZW1lbnRzLCBzX1hEUl9BdHRyaWJ1dGVUeXBlX0F0dHJpYnV0ZXMsDQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBYZHJJbml0RnVuY3Rpb24oWERSX0luaXRBdHRyaWJ1dGVUeXBlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFhkckJlZ2luQ2hpbGRGdW5jdGlvbihYRFJfQmVnaW5BdHRyaWJ1dGVUeXBlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFhkckVuZENoaWxkRnVuY3Rpb24oWERSX0VuZEF0dHJpYnV0ZVR5cGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSksDQogICAgICAgICAgICBuZXcgWGRyRW50cnkoIFNjaGVtYU5hbWVzLlRva2VuLlhkckVsZW1lbnQsICAgICAgICBudWxsLCBzX1hEUl9FbGVtZW50X0F0dHJpYnV0ZXMsDQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBYZHJJbml0RnVuY3Rpb24oWERSX0luaXRFbGVtZW50KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFhkckVuZENoaWxkRnVuY3Rpb24oWERSX0VuZEVsZW1lbnQpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSksDQogICAgICAgICAgICBuZXcgWGRyRW50cnkoIFNjaGVtYU5hbWVzLlRva2VuLlhkckF0dHJpYnV0ZSwgICAgICBudWxsLCBzX1hEUl9BdHRyaWJ1dGVfQXR0cmlidXRlcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFhkckluaXRGdW5jdGlvbihYRFJfSW5pdEF0dHJpYnV0ZSksDQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBYZHJCZWdpbkNoaWxkRnVuY3Rpb24oWERSX0JlZ2luQXR0cmlidXRlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFhkckVuZENoaWxkRnVuY3Rpb24oWERSX0VuZEF0dHJpYnV0ZSksDQogICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKSwNCiAgICAgICAgICAgIG5ldyBYZHJFbnRyeSggU2NoZW1hTmFtZXMuVG9rZW4uWGRyR3JvdXAsICAgICAgICAgIHNfWERSX0dyb3VwX1N1YkVsZW1lbnRzLCBzX1hEUl9Hcm91cF9BdHRyaWJ1dGVzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgWGRySW5pdEZ1bmN0aW9uKFhEUl9Jbml0R3JvdXApLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgWGRyRW5kQ2hpbGRGdW5jdGlvbihYRFJfRW5kR3JvdXApLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSksDQogICAgICAgICAgICBuZXcgWGRyRW50cnkoIFNjaGVtYU5hbWVzLlRva2VuLlhkckRhdGF0eXBlLCAgICAgICBudWxsLCBzX1hEUl9FbGVtZW50RGF0YVR5cGVfQXR0cmlidXRlcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFhkckluaXRGdW5jdGlvbihYRFJfSW5pdEVsZW1lbnREdFR5cGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgWGRyRW5kQ2hpbGRGdW5jdGlvbihYRFJfRW5kRWxlbWVudER0VHlwZSksDQogICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUpLA0KICAgICAgICAgICAgbmV3IFhkckVudHJ5KCBTY2hlbWFOYW1lcy5Ub2tlbi5YZHJEYXRhdHlwZSwgICAgICAgbnVsbCwgc19YRFJfQXR0cmlidXRlRGF0YVR5cGVfQXR0cmlidXRlcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFhkckluaXRGdW5jdGlvbihYRFJfSW5pdEF0dHJpYnV0ZUR0VHlwZSksDQogICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBYZHJFbmRDaGlsZEZ1bmN0aW9uKFhEUl9FbmRBdHRyaWJ1dGVEdFR5cGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlKQ0KICAgICAgICB9Ow0KDQogICAgICAgIHByaXZhdGUgU2NoZW1hSW5mbyBfU2NoZW1hSW5mbzsNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX1RhcmdldE5hbWVzcGFjZTsNCiAgICAgICAgcHJpdmF0ZSBYbWxSZWFkZXIgX3JlYWRlcjsNCiAgICAgICAgcHJpdmF0ZSBQb3NpdGlvbkluZm8gX3Bvc2l0aW9uSW5mbzsNCiAgICAgICAgcHJpdmF0ZSBQYXJ0aWNsZUNvbnRlbnRWYWxpZGF0b3IgX2NvbnRlbnRWYWxpZGF0b3I7DQoNCiAgICAgICAgcHJpdmF0ZSBYZHJFbnRyeSBfQ3VyU3RhdGU7DQogICAgICAgIHByaXZhdGUgWGRyRW50cnkgX05leHRTdGF0ZTsNCg0KICAgICAgICBwcml2YXRlIEhXU3RhY2sgX1N0YXRlSGlzdG9yeTsNCiAgICAgICAgcHJpdmF0ZSBIV1N0YWNrIF9Hcm91cFN0YWNrOw0KICAgICAgICBwcml2YXRlIHN0cmluZyBfWGRyTmFtZTsNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX1hkclByZWZpeDsNCg0KICAgICAgICBwcml2YXRlIEVsZW1lbnRDb250ZW50IF9FbGVtZW50RGVmOw0KICAgICAgICBwcml2YXRlIEdyb3VwQ29udGVudCBfR3JvdXBEZWY7DQogICAgICAgIHByaXZhdGUgQXR0cmlidXRlQ29udGVudCBfQXR0cmlidXRlRGVmOw0KDQogICAgICAgIHByaXZhdGUgRGVjbEJhc2VJbmZvIF9VbmRlZmluZWRBdHRyaWJ1dGVUeXBlczsNCiAgICAgICAgcHJpdmF0ZSBEZWNsQmFzZUluZm8gX0Jhc2VEZWNsOw0KDQogICAgICAgIHByaXZhdGUgWG1sTmFtZVRhYmxlIF9OYW1lVGFibGU7DQogICAgICAgIHByaXZhdGUgU2NoZW1hTmFtZXMgX1NjaGVtYU5hbWVzOw0KDQogICAgICAgIHByaXZhdGUgWG1sTmFtZXNwYWNlTWFuYWdlciBfQ3VyTnNNZ3I7DQogICAgICAgIHByaXZhdGUgc3RyaW5nIF9UZXh0Ow0KDQogICAgICAgIHByaXZhdGUgVmFsaWRhdGlvbkV2ZW50SGFuZGxlciBfdmFsaWRhdGlvbkV2ZW50SGFuZGxlcjsNCiAgICAgICAgcHJpdmF0ZSBIYXNodGFibGUgX1VuZGVjbGFyZWRFbGVtZW50cyA9IG5ldyBIYXNodGFibGUoKTsNCg0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyB4X3NjaGVtYSA9ICJ4LXNjaGVtYToiOw0KDQogICAgICAgIHByaXZhdGUgWG1sUmVzb2x2ZXIgX3htbFJlc29sdmVyID0gbnVsbDsNCg0KICAgICAgICBpbnRlcm5hbCBYZHJCdWlsZGVyKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbE5hbWVzcGFjZU1hbmFnZXIgY3VybWdyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgU2NoZW1hSW5mbyBzaW5mbywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyB0YXJnZXROYW1zcGFjZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbE5hbWVUYWJsZSBuYW1lVGFibGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICBTY2hlbWFOYW1lcyBzY2hlbWFOYW1lcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRpb25FdmVudEhhbmRsZXIgZXZlbnRoYW5kbGVyDQogICAgICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgIHsNCiAgICAgICAgICAgIF9TY2hlbWFJbmZvID0gc2luZm87DQogICAgICAgICAgICBfVGFyZ2V0TmFtZXNwYWNlID0gdGFyZ2V0TmFtc3BhY2U7DQogICAgICAgICAgICBfcmVhZGVyID0gcmVhZGVyOw0KICAgICAgICAgICAgX0N1ck5zTWdyID0gY3VybWdyOw0KICAgICAgICAgICAgX3ZhbGlkYXRpb25FdmVudEhhbmRsZXIgPSBldmVudGhhbmRsZXI7DQogICAgICAgICAgICBfU3RhdGVIaXN0b3J5ID0gbmV3IEhXU3RhY2soU3RhY2tJbmNyZW1lbnQpOw0KICAgICAgICAgICAgX0VsZW1lbnREZWYgPSBuZXcgRWxlbWVudENvbnRlbnQoKTsNCiAgICAgICAgICAgIF9BdHRyaWJ1dGVEZWYgPSBuZXcgQXR0cmlidXRlQ29udGVudCgpOw0KICAgICAgICAgICAgX0dyb3VwU3RhY2sgPSBuZXcgSFdTdGFjayhTdGFja0luY3JlbWVudCk7DQogICAgICAgICAgICBfR3JvdXBEZWYgPSBuZXcgR3JvdXBDb250ZW50KCk7DQogICAgICAgICAgICBfTmFtZVRhYmxlID0gbmFtZVRhYmxlOw0KICAgICAgICAgICAgX1NjaGVtYU5hbWVzID0gc2NoZW1hTmFtZXM7DQogICAgICAgICAgICBfQ3VyU3RhdGUgPSBzX3NjaGVtYUVudHJpZXNbMF07DQogICAgICAgICAgICBfcG9zaXRpb25JbmZvID0gUG9zaXRpb25JbmZvLkdldFBvc2l0aW9uSW5mbyhfcmVhZGVyKTsNCiAgICAgICAgICAgIF94bWxSZXNvbHZlciA9IG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBvdmVycmlkZSBib29sIFByb2Nlc3NFbGVtZW50KHN0cmluZyBwcmVmaXgsIHN0cmluZyBuYW1lLCBzdHJpbmcgbnMpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUgcW5hbWUgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZShuYW1lLCBYbWxTY2hlbWFEYXRhdHlwZS5YZHJDYW5vbml6ZVVyaShucywgX05hbWVUYWJsZSwgX1NjaGVtYU5hbWVzKSk7DQogICAgICAgICAgICBpZiAoR2V0TmV4dFN0YXRlKHFuYW1lKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBQdXNoKCk7DQogICAgICAgICAgICAgICAgaWYgKF9DdXJTdGF0ZS5fSW5pdEZ1bmMgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICh0aGlzLl9DdXJTdGF0ZS5fSW5pdEZ1bmMpKHRoaXMsIHFuYW1lKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFJc1NraXBhYmxlRWxlbWVudChxbmFtZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9VbnN1cHBvcnRlZEVsZW1lbnQsIFhtbFF1YWxpZmllZE5hbWUuVG9TdHJpbmcobmFtZSwgcHJlZml4KSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFN4UzogVGhpcyBtZXRob2QgcHJvY2Vzc2VzIGF0dHJpYnV0ZSBmcm9tIHRoZSBzb3VyY2UgZG9jdW1lbnQgYW5kIGRvZXMgbm90IGV4cG9zZSBhbnkgcmVzb3VyY2VzIHRvIHRoZSBjYWxsZXINCiAgICAgICAgLy8gSXQgaXMgZmluZSB0byBzdXBwcmVzcyB0aGUgU3hTIHdhcm5pbmcuDQogICAgICAgIGludGVybmFsIG92ZXJyaWRlIHZvaWQgUHJvY2Vzc0F0dHJpYnV0ZShzdHJpbmcgcHJlZml4LCBzdHJpbmcgbmFtZSwgc3RyaW5nIG5zLCBzdHJpbmcgdmFsdWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUgcW5hbWUgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZShuYW1lLCBYbWxTY2hlbWFEYXRhdHlwZS5YZHJDYW5vbml6ZVVyaShucywgX05hbWVUYWJsZSwgX1NjaGVtYU5hbWVzKSk7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9DdXJTdGF0ZS5fQXR0cmlidXRlcy5MZW5ndGg7IGkrKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYZHJBdHRyaWJ1dGVFbnRyeSBhID0gX0N1clN0YXRlLl9BdHRyaWJ1dGVzW2ldOw0KICAgICAgICAgICAgICAgIGlmIChfU2NoZW1hTmFtZXMuVG9rZW5Ub1FOYW1lWyhpbnQpYS5fQXR0cmlidXRlXS5FcXVhbHMocW5hbWUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWGRyQnVpbGRGdW5jdGlvbiBidWlsZEZ1bmMgPSBhLl9CdWlsZEZ1bmM7DQogICAgICAgICAgICAgICAgICAgIGlmIChhLl9EYXRhdHlwZS5Ub2tlbml6ZWRUeXBlID09IFhtbFRva2VuaXplZFR5cGUuUU5hbWUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBwcmVmaXhWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUgcW5hbWVWYWx1ZSA9IFhtbFF1YWxpZmllZE5hbWUuUGFyc2UodmFsdWUsIF9DdXJOc01nciwgb3V0IHByZWZpeFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHFuYW1lVmFsdWUuQXRvbWl6ZShfTmFtZVRhYmxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmVmaXhWYWx1ZS5MZW5ndGggIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5fQXR0cmlidXRlICE9IFNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYVR5cGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAgICAvLyA8YXR0cmlidXRlIHR5cGU9IHx8IDxlbGVtZW50IHR5cGU9IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgWG1sRXhjZXB0aW9uKFNSLlhtbF9VbmV4cGVjdGVkVG9rZW4sICJOQU1FIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSXNHbG9iYWwoYS5fU2NoZW1hRmxhZ3MpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFuYW1lVmFsdWUgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZShxbmFtZVZhbHVlLk5hbWUsIF9UYXJnZXROYW1lc3BhY2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFuYW1lVmFsdWUgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZShxbmFtZVZhbHVlLk5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRGdW5jKHRoaXMsIHFuYW1lVmFsdWUsIHByZWZpeFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkRnVuYyh0aGlzLCBhLl9EYXRhdHlwZS5QYXJzZVZhbHVlKHZhbHVlLCBfTmFtZVRhYmxlLCBfQ3VyTnNNZ3IpLCBzdHJpbmcuRW1wdHkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICgob2JqZWN0KW5zID09IChvYmplY3QpX1NjaGVtYU5hbWVzLk5zWG1sTnMgJiYgSXNYZHJTY2hlbWEodmFsdWUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRTY2hlbWEodmFsdWUpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gQ2hlY2sgbm9uLXN1cHBvcnRlZCBhdHRyaWJ1dGUNCiAgICAgICAgICAgIGlmICghSXNTa2lwYWJsZUF0dHJpYnV0ZShxbmFtZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfVW5zdXBwb3J0ZWRBdHRyaWJ1dGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxRdWFsaWZpZWROYW1lLlRvU3RyaW5nKHFuYW1lLk5hbWUsIHByZWZpeCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgWG1sUmVzb2x2ZXIgWG1sUmVzb2x2ZXINCiAgICAgICAgew0KICAgICAgICAgICAgc2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3htbFJlc29sdmVyID0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGJvb2wgTG9hZFNjaGVtYShzdHJpbmcgdXJpKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX3htbFJlc29sdmVyID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdXJpID0gX05hbWVUYWJsZS5BZGQodXJpKTsNCiAgICAgICAgICAgIGlmIChfU2NoZW1hSW5mby5UYXJnZXROYW1lc3BhY2VzLkNvbnRhaW5zS2V5KHVyaSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgU2NoZW1hSW5mbyBzY2hlbWFJbmZvID0gbnVsbDsNCiAgICAgICAgICAgIFVyaSBfYmFzZVVyaSA9IF94bWxSZXNvbHZlci5SZXNvbHZlVXJpKG51bGwsIF9yZWFkZXIuQmFzZVVSSSk7DQogICAgICAgICAgICBYbWxSZWFkZXIgcmVhZGVyID0gbnVsbDsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFVyaSBydXJpID0gX3htbFJlc29sdmVyLlJlc29sdmVVcmkoX2Jhc2VVcmksIHVyaS5TdWJzdHJpbmcoeF9zY2hlbWEuTGVuZ3RoKSk7DQogICAgICAgICAgICAgICAgU3RyZWFtIHN0bSA9IChTdHJlYW0pX3htbFJlc29sdmVyLkdldEVudGl0eShydXJpLCBudWxsLCBudWxsKTsNCiAgICAgICAgICAgICAgICByZWFkZXIgPSBuZXcgWG1sVGV4dFJlYWRlcihydXJpLlRvU3RyaW5nKCksIHN0bSwgX05hbWVUYWJsZSk7DQogICAgICAgICAgICAgICAgc2NoZW1hSW5mbyA9IG5ldyBTY2hlbWFJbmZvKCk7DQogICAgICAgICAgICAgICAgUGFyc2VyIHBhcnNlciA9IG5ldyBQYXJzZXIoU2NoZW1hVHlwZS5YRFIsIF9OYW1lVGFibGUsIF9TY2hlbWFOYW1lcywgX3ZhbGlkYXRpb25FdmVudEhhbmRsZXIpOw0KICAgICAgICAgICAgICAgIHBhcnNlci5YbWxSZXNvbHZlciA9IF94bWxSZXNvbHZlcjsNCiAgICAgICAgICAgICAgICBwYXJzZXIuUGFyc2UocmVhZGVyLCB1cmkpOw0KICAgICAgICAgICAgICAgIHNjaGVtYUluZm8gPSBwYXJzZXIuWGRyU2NoZW1hOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0Nhbm5vdExvYWRTY2hlbWEsIG5ldyBzdHJpbmdbXSB7IHVyaSwgZS5NZXNzYWdlIH0sIFhtbFNldmVyaXR5VHlwZS5XYXJuaW5nKTsNCiAgICAgICAgICAgICAgICBzY2hlbWFJbmZvID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAocmVhZGVyICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZWFkZXIuQ2xvc2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc2NoZW1hSW5mbyAhPSBudWxsICYmIHNjaGVtYUluZm8uRXJyb3JDb3VudCA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9TY2hlbWFJbmZvLkFkZChzY2hlbWFJbmZvLCBfdmFsaWRhdGlvbkV2ZW50SGFuZGxlcik7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgYm9vbCBJc1hkclNjaGVtYShzdHJpbmcgdXJpKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdXJpLkxlbmd0aCA+PSB4X3NjaGVtYS5MZW5ndGggJiYNCiAgICAgICAgICAgICAgICAgICAwID09IHN0cmluZy5Db21wYXJlKHVyaSwgMCwgeF9zY2hlbWEsIDAsIHhfc2NoZW1hLkxlbmd0aCwgU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsKSAmJg0KICAgICAgICAgICAgICAgICAgICF1cmkuU3RhcnRzV2l0aCgieC1zY2hlbWE6IyIsIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbCk7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBvdmVycmlkZSBib29sIElzQ29udGVudFBhcnNlZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgb3ZlcnJpZGUgdm9pZCBQcm9jZXNzTWFya3VwKFhtbE5vZGVbXSBtYXJrdXApDQogICAgICAgIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLlhtbF9JbnZhbGlkT3BlcmF0aW9uKTsgLy8gc2hvdWxkIG5ldmVyIGJlIGNhbGxlZA0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgb3ZlcnJpZGUgdm9pZCBQcm9jZXNzQ0RhdGEoc3RyaW5nIHZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX0N1clN0YXRlLl9BbGxvd1RleHQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX1RleHQgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9UZXh0Tm90QWxsb3dlZCwgdmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgb3ZlcnJpZGUgdm9pZCBTdGFydENoaWxkcmVuKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF9DdXJTdGF0ZS5fQmVnaW5DaGlsZEZ1bmMgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAodGhpcy5fQ3VyU3RhdGUuX0JlZ2luQ2hpbGRGdW5jKSh0aGlzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIG92ZXJyaWRlIHZvaWQgRW5kQ2hpbGRyZW4oKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX0N1clN0YXRlLl9FbmRDaGlsZEZ1bmMgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAodGhpcy5fQ3VyU3RhdGUuX0VuZENoaWxkRnVuYykodGhpcyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFBvcCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gU3RhdGUgc3RhY2sgcHVzaCAmIHBvcA0KICAgICAgICAvLw0KICAgICAgICBwcml2YXRlIHZvaWQgUHVzaCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9TdGF0ZUhpc3RvcnkuUHVzaCgpOw0KICAgICAgICAgICAgX1N0YXRlSGlzdG9yeVtfU3RhdGVIaXN0b3J5Lkxlbmd0aCAtIDFdID0gX0N1clN0YXRlOw0KICAgICAgICAgICAgX0N1clN0YXRlID0gX05leHRTdGF0ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQb3AoKQ0KICAgICAgICB7DQogICAgICAgICAgICBfQ3VyU3RhdGUgPSAoWGRyRW50cnkpX1N0YXRlSGlzdG9yeS5Qb3AoKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR3JvdXAgc3RhY2sgcHVzaCAmIHBvcA0KICAgICAgICAvLw0KICAgICAgICBwcml2YXRlIHZvaWQgUHVzaEdyb3VwSW5mbygpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9Hcm91cFN0YWNrLlB1c2goKTsNCiAgICAgICAgICAgIF9Hcm91cFN0YWNrW19Hcm91cFN0YWNrLkxlbmd0aCAtIDFdID0gR3JvdXBDb250ZW50LkNvcHkoX0dyb3VwRGVmKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQb3BHcm91cEluZm8oKQ0KICAgICAgICB7DQogICAgICAgICAgICBfR3JvdXBEZWYgPSAoR3JvdXBDb250ZW50KV9Hcm91cFN0YWNrLlBvcCgpOw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KF9Hcm91cERlZiAhPSBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFhEUiBTY2hlbWENCiAgICAgICAgLy8NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfSW5pdFJvb3QoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqKQ0KICAgICAgICB7DQogICAgICAgICAgICBidWlsZGVyLl9TY2hlbWFJbmZvLlNjaGVtYVR5cGUgPSBTY2hlbWFUeXBlLlhEUjsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsID0gbnVsbDsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0F0dERlZkxpc3QgPSBudWxsOw0KICAgICAgICAgICAgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9BdHREZWYgPSBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRSb290X05hbWUoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBidWlsZGVyLl9YZHJOYW1lID0gKHN0cmluZylvYmo7DQogICAgICAgICAgICBidWlsZGVyLl9YZHJQcmVmaXggPSBwcmVmaXg7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZFJvb3RfSUQoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CZWdpblJvb3QoWGRyQnVpbGRlciBidWlsZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYnVpbGRlci5fVGFyZ2V0TmFtZXNwYWNlID09IG51bGwpDQogICAgICAgICAgICB7IC8vIGlubGluZSB4ZHIgc2NoZW1hDQogICAgICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX1hkck5hbWUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX1RhcmdldE5hbWVzcGFjZSA9IGJ1aWxkZXIuX05hbWVUYWJsZS5BZGQoIngtc2NoZW1hOiMiICsgYnVpbGRlci5fWGRyTmFtZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX1RhcmdldE5hbWVzcGFjZSA9IFN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBidWlsZGVyLl9TY2hlbWFJbmZvLlRhcmdldE5hbWVzcGFjZXMuQWRkKGJ1aWxkZXIuX1RhcmdldE5hbWVzcGFjZSwgdHJ1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9FbmRSb290KFhkckJ1aWxkZXIgYnVpbGRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIC8vIGNoZWNrIHVuZGVmaW5lZCBhdHRyaWJ1dGUgdHlwZXMNCiAgICAgICAgICAgIC8vIFdlIGFscmVhZHkgY2hlY2tlZCBsb2NhbCBhdHRyaWJ1dGUgdHlwZXMsIHNvIG9ubHkgbmVlZCB0byBjaGVjayBnbG9iYWwgYXR0cmlidXRlIHR5cGVzIGhlcmUgDQogICAgICAgICAgICAvLw0KICAgICAgICAgICAgd2hpbGUgKGJ1aWxkZXIuX1VuZGVmaW5lZEF0dHJpYnV0ZVR5cGVzICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sUXVhbGlmaWVkTmFtZSBnbmFtZSA9IGJ1aWxkZXIuX1VuZGVmaW5lZEF0dHJpYnV0ZVR5cGVzLl9UeXBlTmFtZTsNCg0KICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIFVSTiBpbiB0aGlzIG5hbWUgdGhlbiB0aGUgbmFtZSBpcyBsb2NhbCB0byB0aGUNCiAgICAgICAgICAgICAgICAvLyBzY2hlbWEsIGJ1dCB0aGUgZ2xvYmFsIGF0dHJpYnV0ZSB3YXMgc3RpbGwgVVJOIHF1YWxpZmllZCwgc28NCiAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHF1YWxpZnkgdGhpcyBuYW1lIG5vdy4NCiAgICAgICAgICAgICAgICBpZiAoZ25hbWUuTmFtZXNwYWNlLkxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZ25hbWUgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZShnbmFtZS5OYW1lLCBidWlsZGVyLl9UYXJnZXROYW1lc3BhY2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBTY2hlbWFBdHREZWYgYWQ7DQogICAgICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX1NjaGVtYUluZm8uQXR0cmlidXRlRGVjbHMuVHJ5R2V0VmFsdWUoZ25hbWUsIG91dCBhZCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9VbmRlZmluZWRBdHRyaWJ1dGVUeXBlcy5fQXR0ZGVmID0gKFNjaGVtYUF0dERlZilhZC5DbG9uZSgpOw0KICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9VbmRlZmluZWRBdHRyaWJ1dGVUeXBlcy5fQXR0ZGVmLk5hbWUgPSBnbmFtZTsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5YRFJfQ2hlY2tBdHRyaWJ1dGVEZWZhdWx0KGJ1aWxkZXIuX1VuZGVmaW5lZEF0dHJpYnV0ZVR5cGVzLCBidWlsZGVyLl9VbmRlZmluZWRBdHRyaWJ1dGVUeXBlcy5fQXR0ZGVmKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9VbmRlY2xhcmVkQXR0cmlidXRlLCBnbmFtZS5OYW1lKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnVpbGRlci5fVW5kZWZpbmVkQXR0cmlidXRlVHlwZXMgPSBidWlsZGVyLl9VbmRlZmluZWRBdHRyaWJ1dGVUeXBlcy5fTmV4dDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZm9yZWFjaCAoU2NoZW1hRWxlbWVudERlY2wgZWQgaW4gYnVpbGRlci5fVW5kZWNsYXJlZEVsZW1lbnRzLlZhbHVlcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1VuZGVjbGFyZWRFbGVtZW50LCBYbWxRdWFsaWZpZWROYW1lLlRvU3RyaW5nKGVkLk5hbWUuTmFtZSwgZWQuUHJlZml4KSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFhEUiBFbGVtZW50VHlwZQ0KICAgICAgICAvLw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0luaXRFbGVtZW50VHlwZShYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmopDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsID0gbmV3IFNjaGVtYUVsZW1lbnREZWNsKCk7DQogICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yID0gbmV3IFBhcnRpY2xlQ29udGVudFZhbGlkYXRvcihYbWxTY2hlbWFDb250ZW50VHlwZS5NaXhlZCk7DQogICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLklzT3BlbiA9IHRydWU7DQoNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0NvbnRlbnRBdHRyID0gU2NoZW1hQ29udGVudE5vbmU7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9PcmRlckF0dHIgPSBTY2hlbWFPcmRlck5vbmU7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9NYXN0ZXJHcm91cFJlcXVpcmVkID0gZmFsc2U7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9FeGlzdFRlcm1pbmFsID0gZmFsc2U7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9BbGxvd0RhdGFUeXBlID0gdHJ1ZTsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0hhc0RhdGFUeXBlID0gZmFsc2U7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9FbnVtZXJhdGlvblJlcXVpcmVkID0gZmFsc2U7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9BdHREZWZMaXN0ID0gbmV3IEhhc2h0YWJsZSgpOw0KICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fTWF4TGVuZ3RoID0gdWludC5NYXhWYWx1ZTsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX01pbkxlbmd0aCA9IHVpbnQuTWF4VmFsdWU7DQoNCiAgICAgICAgICAgIC8vICAgICAgICBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0hhc0RhdGFUeXBlID0gZmFsc2U7DQogICAgICAgICAgICAvLyAgICAgICAgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9EZWZhdWx0ID0gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0J1aWxkRWxlbWVudFR5cGVfTmFtZShYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUgcW5hbWUgPSAoWG1sUXVhbGlmaWVkTmFtZSlvYmo7DQoNCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9TY2hlbWFJbmZvLkVsZW1lbnREZWNscy5Db250YWluc0tleShxbmFtZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EdXBFbGVtZW50RGVjbCwgWG1sUXVhbGlmaWVkTmFtZS5Ub1N0cmluZyhxbmFtZS5OYW1lLCBwcmVmaXgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsLk5hbWUgPSBxbmFtZTsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsLlByZWZpeCA9IHByZWZpeDsNCiAgICAgICAgICAgIGJ1aWxkZXIuX1NjaGVtYUluZm8uRWxlbWVudERlY2xzLkFkZChxbmFtZSwgYnVpbGRlci5fRWxlbWVudERlZi5fRWxlbWVudERlY2wpOw0KICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX1VuZGVjbGFyZWRFbGVtZW50c1txbmFtZV0gIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLl9VbmRlY2xhcmVkRWxlbWVudHMuUmVtb3ZlKHFuYW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0J1aWxkRWxlbWVudFR5cGVfQ29udGVudChYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0NvbnRlbnRBdHRyID0gYnVpbGRlci5HZXRDb250ZW50KChYbWxRdWFsaWZpZWROYW1lKW9iaik7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZEVsZW1lbnRUeXBlX01vZGVsKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaiwgc3RyaW5nIHByZWZpeCkNCiAgICAgICAgew0KICAgICAgICAgICAgYnVpbGRlci5fY29udGVudFZhbGlkYXRvci5Jc09wZW4gPSBidWlsZGVyLkdldE1vZGVsKChYbWxRdWFsaWZpZWROYW1lKW9iaik7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZEVsZW1lbnRUeXBlX09yZGVyKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaiwgc3RyaW5nIHByZWZpeCkNCiAgICAgICAgew0KICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fT3JkZXJBdHRyID0gYnVpbGRlci5fR3JvdXBEZWYuX09yZGVyID0gYnVpbGRlci5HZXRPcmRlcigoWG1sUXVhbGlmaWVkTmFtZSlvYmopOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRFbGVtZW50VHlwZV9EdFR5cGUoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9IYXNEYXRhVHlwZSA9IHRydWU7DQogICAgICAgICAgICBzdHJpbmcgcyA9ICgoc3RyaW5nKW9iaikuVHJpbSgpOw0KICAgICAgICAgICAgaWYgKHMuTGVuZ3RoID09IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzRHR2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZHR5cGUgPSBYbWxTY2hlbWFEYXRhdHlwZS5Gcm9tWGRyTmFtZShzKTsNCiAgICAgICAgICAgICAgICBpZiAoZHR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfVW5rbm93bkR0VHlwZSwgcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsLkRhdGF0eXBlID0gZHR5cGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZEVsZW1lbnRUeXBlX0R0VmFsdWVzKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaiwgc3RyaW5nIHByZWZpeCkNCiAgICAgICAgew0KICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fRW51bWVyYXRpb25SZXF1aXJlZCA9IHRydWU7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9FbGVtZW50RGVjbC5WYWx1ZXMgPSBuZXcgTGlzdDxzdHJpbmc+KChzdHJpbmdbXSlvYmopOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRFbGVtZW50VHlwZV9EdE1heExlbmd0aChYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFBhcnNlRHRNYXhMZW5ndGgocmVmIGJ1aWxkZXIuX0VsZW1lbnREZWYuX01heExlbmd0aCwgb2JqLCBidWlsZGVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0J1aWxkRWxlbWVudFR5cGVfRHRNaW5MZW5ndGgoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBQYXJzZUR0TWluTGVuZ3RoKHJlZiBidWlsZGVyLl9FbGVtZW50RGVmLl9NaW5MZW5ndGgsIG9iaiwgYnVpbGRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CZWdpbkVsZW1lbnRUeXBlKFhkckJ1aWxkZXIgYnVpbGRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGNvZGUgPSBudWxsOw0KICAgICAgICAgICAgc3RyaW5nIG1zZyA9IG51bGw7DQoNCiAgICAgICAgICAgIC8vDQogICAgICAgICAgICAvLyBjaGVjayBuYW1lIGF0dHJpYnV0ZQ0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9FbGVtZW50RGVjbC5OYW1lLklzRW1wdHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY29kZSA9IFNSLlNjaF9NaXNzQXR0cmlidXRlOw0KICAgICAgICAgICAgICAgIG1zZyA9ICJuYW1lIjsNCiAgICAgICAgICAgICAgICBnb3RvIGNsZWFudXA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vDQogICAgICAgICAgICAvLyBjaGVjayBkdDp0eXBlIGF0dHJpYnV0ZQ0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9IYXNEYXRhVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIWJ1aWxkZXIuX0VsZW1lbnREZWYuX0FsbG93RGF0YVR5cGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjb2RlID0gU1IuU2NoX0RhdGFUeXBlVGV4dE9ubHk7DQogICAgICAgICAgICAgICAgICAgIGdvdG8gY2xlYW51cDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fQ29udGVudEF0dHIgPSBTY2hlbWFDb250ZW50VGV4dDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9Db250ZW50QXR0ciA9PSBTY2hlbWFDb250ZW50Tm9uZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGJ1aWxkZXIuX0VsZW1lbnREZWYuX09yZGVyQXR0cikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgU2NoZW1hT3JkZXJOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fQ29udGVudEF0dHIgPSBTY2hlbWFDb250ZW50TWl4ZWQ7DQogICAgICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9PcmRlckF0dHIgPSBTY2hlbWFPcmRlck1hbnk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBTY2hlbWFPcmRlclNlcXVlbmNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fQ29udGVudEF0dHIgPSBTY2hlbWFDb250ZW50RWxlbWVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFNjaGVtYU9yZGVyQ2hvaWNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fQ29udGVudEF0dHIgPSBTY2hlbWFDb250ZW50RWxlbWVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFNjaGVtYU9yZGVyTWFueToNCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0NvbnRlbnRBdHRyID0gU2NoZW1hQ29udGVudE1peGVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIC8vc2F2ZSB0aGUgbW9kZWwgdmFsdWUgZnJvbSB0aGUgYmFzZQ0KICAgICAgICAgICAgYm9vbCB0ZW1wT3BlbiA9IGJ1aWxkZXIuX2NvbnRlbnRWYWxpZGF0b3IuSXNPcGVuOw0KICAgICAgICAgICAgRWxlbWVudENvbnRlbnQgZGVmID0gYnVpbGRlci5fRWxlbWVudERlZjsNCiAgICAgICAgICAgIHN3aXRjaCAoYnVpbGRlci5fRWxlbWVudERlZi5fQ29udGVudEF0dHIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBTY2hlbWFDb250ZW50VGV4dDoNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fRWxlbWVudERlY2wuQ29udGVudFZhbGlkYXRvciA9IENvbnRlbnRWYWxpZGF0b3IuVGV4dE9ubHk7DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX0dyb3VwRGVmLl9PcmRlciA9IFNjaGVtYU9yZGVyTWFueTsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fY29udGVudFZhbGlkYXRvciA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgU2NoZW1hQ29udGVudEVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX2NvbnRlbnRWYWxpZGF0b3IgPSBuZXcgUGFydGljbGVDb250ZW50VmFsaWRhdG9yKFhtbFNjaGVtYUNvbnRlbnRUeXBlLkVsZW1lbnRPbmx5KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGRlZi5fT3JkZXJBdHRyID09IFNjaGVtYU9yZGVyTm9uZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fR3JvdXBEZWYuX09yZGVyID0gU2NoZW1hT3JkZXJTZXF1ZW5jZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBkZWYuX01hc3Rlckdyb3VwUmVxdWlyZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLklzT3BlbiA9IHRlbXBPcGVuOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgU2NoZW1hQ29udGVudEVtcHR5Og0KICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9FbGVtZW50RGVjbC5Db250ZW50VmFsaWRhdG9yID0gQ29udGVudFZhbGlkYXRvci5FbXB0eTsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fY29udGVudFZhbGlkYXRvciA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBTY2hlbWFDb250ZW50TWl4ZWQ6DQogICAgICAgICAgICAgICAgICAgIGlmIChkZWYuX09yZGVyQXR0ciA9PSBTY2hlbWFPcmRlck5vbmUgfHwgZGVmLl9PcmRlckF0dHIgPT0gU2NoZW1hT3JkZXJNYW55KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9Hcm91cERlZi5fT3JkZXIgPSBTY2hlbWFPcmRlck1hbnk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gU1IuU2NoX01peGVkTWFueTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gY2xlYW51cDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBkZWYuX01hc3Rlckdyb3VwUmVxdWlyZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLklzT3BlbiA9IHRlbXBPcGVuOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICBpZiAoZGVmLl9Db250ZW50QXR0ciA9PSBTY2hlbWFDb250ZW50TWl4ZWQgfHwgZGVmLl9Db250ZW50QXR0ciA9PSBTY2hlbWFDb250ZW50RWxlbWVudCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLlN0YXJ0KCk7DQogICAgICAgICAgICAgICAgYnVpbGRlci5fY29udGVudFZhbGlkYXRvci5PcGVuR3JvdXAoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgY2xlYW51cDoNCiAgICAgICAgICAgIGlmIChjb2RlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KGNvZGUsIG1zZyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9FbmRFbGVtZW50VHlwZShYZHJCdWlsZGVyIGJ1aWxkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIFNjaGVtYUVsZW1lbnREZWNsIGVkID0gYnVpbGRlci5fRWxlbWVudERlZi5fRWxlbWVudERlY2w7DQoNCiAgICAgICAgICAgIC8vIGNoZWNrIHVuZGVmaW5lZCBhdHRyaWJ1dGUgdHlwZXMgZmlyc3QNCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9VbmRlZmluZWRBdHRyaWJ1dGVUeXBlcyAhPSBudWxsICYmIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0F0dERlZkxpc3QgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBEZWNsQmFzZUluZm8gcGF0dCA9IGJ1aWxkZXIuX1VuZGVmaW5lZEF0dHJpYnV0ZVR5cGVzOw0KICAgICAgICAgICAgICAgIERlY2xCYXNlSW5mbyBwMSA9IHBhdHQ7DQoNCiAgICAgICAgICAgICAgICB3aGlsZSAocGF0dCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2NoZW1hQXR0RGVmIHBBdHRkZWYgPSBudWxsOw0KDQogICAgICAgICAgICAgICAgICAgIGlmIChwYXR0Ll9FbGVtZW50RGVjbCA9PSBlZCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgWG1sUXVhbGlmaWVkTmFtZSBwTmFtZSA9IHBhdHQuX1R5cGVOYW1lOw0KICAgICAgICAgICAgICAgICAgICAgICAgcEF0dGRlZiA9IChTY2hlbWFBdHREZWYpYnVpbGRlci5fRWxlbWVudERlZi5fQXR0RGVmTGlzdFtwTmFtZV07DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocEF0dGRlZiAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHQuX0F0dGRlZiA9IChTY2hlbWFBdHREZWYpcEF0dGRlZi5DbG9uZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHQuX0F0dGRlZi5OYW1lID0gcE5hbWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5YRFJfQ2hlY2tBdHRyaWJ1dGVEZWZhdWx0KHBhdHQsIHBBdHRkZWYpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGl0IGZyb20gX3BVbmRlZmluZWRBdHRyaWJ1dGVUeXBlcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ID09IGJ1aWxkZXIuX1VuZGVmaW5lZEF0dHJpYnV0ZVR5cGVzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0dCA9IGJ1aWxkZXIuX1VuZGVmaW5lZEF0dHJpYnV0ZVR5cGVzID0gcGF0dC5fTmV4dDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDEgPSBwYXR0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMS5fTmV4dCA9IHBhdHQuX05leHQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHQgPSBwMS5fTmV4dDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBpZiAocEF0dGRlZiA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF0dCAhPSBidWlsZGVyLl9VbmRlZmluZWRBdHRyaWJ1dGVUeXBlcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMSA9IHAxLl9OZXh0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgcGF0dCA9IHBhdHQuX05leHQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9NYXN0ZXJHcm91cFJlcXVpcmVkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBjb250ZW50IGlzIG1peGVkLCB0aGVyZSBpcyBhIGdyb3VwIHRoYXQgbmVlZCB0byBiZSBjbG9zZWQNCiAgICAgICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLkNsb3NlR3JvdXAoKTsNCg0KICAgICAgICAgICAgICAgIGlmICghYnVpbGRlci5fRWxlbWVudERlZi5fRXhpc3RUZXJtaW5hbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLklzT3BlbikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fRWxlbWVudERlY2wuQ29udGVudFZhbGlkYXRvciA9IENvbnRlbnRWYWxpZGF0b3IuQW55Ow0KICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fY29udGVudFZhbGlkYXRvciA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnVpbGRlci5fRWxlbWVudERlZi5fQ29udGVudEF0dHIgIT0gU2NoZW1hQ29udGVudE1peGVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRWxlbWVudE1pc3NpbmcpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChidWlsZGVyLl9Hcm91cERlZi5fT3JkZXIgPT0gU2NoZW1hT3JkZXJNYW55KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLkFkZFN0YXIoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChlZC5EYXRhdHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFRva2VuaXplZFR5cGUgdHR5cGUgPSBlZC5EYXRhdHlwZS5Ub2tlbml6ZWRUeXBlOw0KICAgICAgICAgICAgICAgIGlmICh0dHlwZSA9PSBYbWxUb2tlbml6ZWRUeXBlLkVOVU1FUkFUSU9OICYmDQogICAgICAgICAgICAgICAgICAgICFidWlsZGVyLl9FbGVtZW50RGVmLl9FbnVtZXJhdGlvblJlcXVpcmVkKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzRHR2YWx1ZXNBdHRyaWJ1dGUpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICh0dHlwZSAhPSBYbWxUb2tlbml6ZWRUeXBlLkVOVU1FUkFUSU9OICYmDQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0VudW1lcmF0aW9uUmVxdWlyZWQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1JlcXVpcmVFbnVtZXJhdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQ29tcGFyZU1pbk1heExlbmd0aChidWlsZGVyLl9FbGVtZW50RGVmLl9NaW5MZW5ndGgsIGJ1aWxkZXIuX0VsZW1lbnREZWYuX01heExlbmd0aCwgYnVpbGRlcik7DQogICAgICAgICAgICBlZC5NYXhMZW5ndGggPSAobG9uZylidWlsZGVyLl9FbGVtZW50RGVmLl9NYXhMZW5ndGg7DQogICAgICAgICAgICBlZC5NaW5MZW5ndGggPSAobG9uZylidWlsZGVyLl9FbGVtZW50RGVmLl9NaW5MZW5ndGg7DQoNCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fRWxlbWVudERlY2wuQ29udGVudFZhbGlkYXRvciA9IGJ1aWxkZXIuX2NvbnRlbnRWYWxpZGF0b3IuRmluaXNoKHRydWUpOw0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuX2NvbnRlbnRWYWxpZGF0b3IgPSBudWxsOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9FbGVtZW50RGVjbCA9IG51bGw7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9BdHREZWZMaXN0ID0gbnVsbDsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gWERSIEF0dHJpYnV0ZVR5cGUNCiAgICAgICAgLy8gDQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfSW5pdEF0dHJpYnV0ZVR5cGUoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqKQ0KICAgICAgICB7DQogICAgICAgICAgICBBdHRyaWJ1dGVDb250ZW50IGFkID0gYnVpbGRlci5fQXR0cmlidXRlRGVmOw0KICAgICAgICAgICAgYWQuX0F0dERlZiA9IG5ldyBTY2hlbWFBdHREZWYoWG1sUXVhbGlmaWVkTmFtZS5FbXB0eSwgbnVsbCk7DQoNCiAgICAgICAgICAgIGFkLl9SZXF1aXJlZCA9IGZhbHNlOw0KICAgICAgICAgICAgYWQuX1ByZWZpeCA9IG51bGw7DQoNCiAgICAgICAgICAgIGFkLl9EZWZhdWx0ID0gbnVsbDsNCiAgICAgICAgICAgIGFkLl9NaW5WYWwgPSAwOyAvLyBvcHRpb25hbCBieSBkZWZhdWx0Lg0KICAgICAgICAgICAgYWQuX01heFZhbCA9IDE7DQoNCiAgICAgICAgICAgIC8vIHVzZWQgZm9yIGRhdGF0eXBlDQogICAgICAgICAgICBhZC5fRW51bWVyYXRpb25SZXF1aXJlZCA9IGZhbHNlOw0KICAgICAgICAgICAgYWQuX0hhc0RhdGFUeXBlID0gZmFsc2U7DQogICAgICAgICAgICBhZC5fR2xvYmFsID0gKGJ1aWxkZXIuX1N0YXRlSGlzdG9yeS5MZW5ndGggPT0gMik7DQoNCiAgICAgICAgICAgIGFkLl9NYXhMZW5ndGggPSB1aW50Lk1heFZhbHVlOw0KICAgICAgICAgICAgYWQuX01pbkxlbmd0aCA9IHVpbnQuTWF4VmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZEF0dHJpYnV0ZVR5cGVfTmFtZShYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUgcW5hbWUgPSAoWG1sUXVhbGlmaWVkTmFtZSlvYmo7DQoNCiAgICAgICAgICAgIGJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fTmFtZSA9IHFuYW1lOw0KICAgICAgICAgICAgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9QcmVmaXggPSBwcmVmaXg7DQogICAgICAgICAgICBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0F0dERlZi5OYW1lID0gcW5hbWU7DQoNCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9FbGVtZW50RGVjbCAhPSBudWxsKQ0KICAgICAgICAgICAgeyAgLy8gTG9jYWwgQXR0cmlidXRlVHlwZQ0KICAgICAgICAgICAgICAgIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9BdHREZWZMaXN0W3FuYW1lXSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fQXR0RGVmTGlzdC5BZGQocW5hbWUsIGJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fQXR0RGVmKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EdXBBdHRyaWJ1dGUsIFhtbFF1YWxpZmllZE5hbWUuVG9TdHJpbmcocW5hbWUuTmFtZSwgcHJlZml4KSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgeyAgLy8gR2xvYmFsIEF0dHJpYnV0ZVR5cGUNCiAgICAgICAgICAgICAgICAvLyBHbG9iYWwgQXR0cmlidXRlVHlwZXMgYXJlIFVSTiBxdWFsaWZpZWQgc28gdGhhdCB3ZSBjYW4gbG9vayB0aGVtIHVwIGFjcm9zcyBzY2hlbWFzLg0KICAgICAgICAgICAgICAgIHFuYW1lID0gbmV3IFhtbFF1YWxpZmllZE5hbWUocW5hbWUuTmFtZSwgYnVpbGRlci5fVGFyZ2V0TmFtZXNwYWNlKTsNCiAgICAgICAgICAgICAgICBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0F0dERlZi5OYW1lID0gcW5hbWU7DQogICAgICAgICAgICAgICAgaWYgKCFidWlsZGVyLl9TY2hlbWFJbmZvLkF0dHJpYnV0ZURlY2xzLkNvbnRhaW5zS2V5KHFuYW1lKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX1NjaGVtYUluZm8uQXR0cmlidXRlRGVjbHMuQWRkKHFuYW1lLCBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0F0dERlZik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRHVwQXR0cmlidXRlLCBYbWxRdWFsaWZpZWROYW1lLlRvU3RyaW5nKHFuYW1lLk5hbWUsIHByZWZpeCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0J1aWxkQXR0cmlidXRlVHlwZV9SZXF1aXJlZChYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fUmVxdWlyZWQgPSBJc1llcyhvYmosIGJ1aWxkZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRBdHRyaWJ1dGVUeXBlX0RlZmF1bHQoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0RlZmF1bHQgPSBvYmo7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZEF0dHJpYnV0ZVR5cGVfRHRUeXBlKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaiwgc3RyaW5nIHByZWZpeCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sUXVhbGlmaWVkTmFtZSBxbmFtZSA9IChYbWxRdWFsaWZpZWROYW1lKW9iajsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fSGFzRGF0YVR5cGUgPSB0cnVlOw0KICAgICAgICAgICAgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9BdHREZWYuRGF0YXR5cGUgPSBidWlsZGVyLkNoZWNrRGF0YXR5cGUocW5hbWUuTmFtZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZEF0dHJpYnV0ZVR5cGVfRHRWYWx1ZXMoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0VudW1lcmF0aW9uUmVxdWlyZWQgPSB0cnVlOw0KICAgICAgICAgICAgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9BdHREZWYuVmFsdWVzID0gbmV3IExpc3Q8c3RyaW5nPigoc3RyaW5nW10pb2JqKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0J1aWxkQXR0cmlidXRlVHlwZV9EdE1heExlbmd0aChYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFBhcnNlRHRNYXhMZW5ndGgocmVmIGJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fTWF4TGVuZ3RoLCBvYmosIGJ1aWxkZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRBdHRyaWJ1dGVUeXBlX0R0TWluTGVuZ3RoKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaiwgc3RyaW5nIHByZWZpeCkNCiAgICAgICAgew0KICAgICAgICAgICAgUGFyc2VEdE1pbkxlbmd0aChyZWYgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9NaW5MZW5ndGgsIG9iaiwgYnVpbGRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CZWdpbkF0dHJpYnV0ZVR5cGUoWGRyQnVpbGRlciBidWlsZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYnVpbGRlci5fQXR0cmlidXRlRGVmLl9OYW1lLklzRW1wdHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaXNzQXR0cmlidXRlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0VuZEF0dHJpYnV0ZVR5cGUoWGRyQnVpbGRlciBidWlsZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgY29kZSA9IG51bGw7DQogICAgICAgICAgICBpZiAoYnVpbGRlci5fQXR0cmlidXRlRGVmLl9IYXNEYXRhVHlwZSAmJiBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0F0dERlZi5EYXRhdHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFRva2VuaXplZFR5cGUgdHR5cGUgPSBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0F0dERlZi5EYXRhdHlwZS5Ub2tlbml6ZWRUeXBlOw0KDQogICAgICAgICAgICAgICAgaWYgKHR0eXBlID09IFhtbFRva2VuaXplZFR5cGUuRU5VTUVSQVRJT04gJiYgIWJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fRW51bWVyYXRpb25SZXF1aXJlZCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNvZGUgPSBTUi5TY2hfTWlzc0R0dmFsdWVzQXR0cmlidXRlOw0KICAgICAgICAgICAgICAgICAgICBnb3RvIGNsZWFudXA7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKHR0eXBlICE9IFhtbFRva2VuaXplZFR5cGUuRU5VTUVSQVRJT04gJiYgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9FbnVtZXJhdGlvblJlcXVpcmVkKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY29kZSA9IFNSLlNjaF9SZXF1aXJlRW51bWVyYXRpb247DQogICAgICAgICAgICAgICAgICAgIGdvdG8gY2xlYW51cDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBhbiBhdHRyaWJ1dGUgb2YgdHlwZSBpZCBpcyBub3Qgc3VwcG9zZWQgdG8gaGF2ZSBhIGRlZmF1bHQgdmFsdWUNCiAgICAgICAgICAgICAgICBpZiAoYnVpbGRlci5fQXR0cmlidXRlRGVmLl9EZWZhdWx0ICE9IG51bGwgJiYgdHR5cGUgPT0gWG1sVG9rZW5pemVkVHlwZS5JRCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNvZGUgPSBTUi5TY2hfRGVmYXVsdElkVmFsdWU7DQogICAgICAgICAgICAgICAgICAgIGdvdG8gY2xlYW51cDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9BdHREZWYuRGF0YXR5cGUgPSBYbWxTY2hlbWFEYXRhdHlwZS5Gcm9tWG1sVG9rZW5pemVkVHlwZShYbWxUb2tlbml6ZWRUeXBlLkNEQVRBKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIC8vIGNvbnN0cmFpbnRzDQogICAgICAgICAgICAvLw0KICAgICAgICAgICAgQ29tcGFyZU1pbk1heExlbmd0aChidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX01pbkxlbmd0aCwgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9NYXhMZW5ndGgsIGJ1aWxkZXIpOw0KICAgICAgICAgICAgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9BdHREZWYuTWF4TGVuZ3RoID0gYnVpbGRlci5fQXR0cmlidXRlRGVmLl9NYXhMZW5ndGg7DQogICAgICAgICAgICBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0F0dERlZi5NaW5MZW5ndGggPSBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX01pbkxlbmd0aDsNCg0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIC8vIGNoZWNrQXR0cmlidXRlVHlwZSANCiAgICAgICAgICAgIC8vDQogICAgICAgICAgICBpZiAoYnVpbGRlci5fQXR0cmlidXRlRGVmLl9EZWZhdWx0ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9BdHREZWYuRGVmYXVsdFZhbHVlUmF3ID0gYnVpbGRlci5fQXR0cmlidXRlRGVmLl9BdHREZWYuRGVmYXVsdFZhbHVlRXhwYW5kZWQgPSAoc3RyaW5nKWJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fRGVmYXVsdDsNCiAgICAgICAgICAgICAgICBidWlsZGVyLkNoZWNrRGVmYXVsdEF0dFZhbHVlKGJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fQXR0RGVmKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYnVpbGRlci5TZXRBdHRyaWJ1dGVQcmVzZW5jZShidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0F0dERlZiwgYnVpbGRlci5fQXR0cmlidXRlRGVmLl9SZXF1aXJlZCk7DQoNCiAgICAgICAgY2xlYW51cDoNCiAgICAgICAgICAgIGlmIChjb2RlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KGNvZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvLw0KICAgICAgICAvLyBYRFIgRWxlbWVudA0KICAgICAgICAvLw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0luaXRFbGVtZW50KFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX0VsZW1lbnREZWYuX0hhc0RhdGFUeXBlIHx8DQogICAgICAgICAgICAgICAgKGJ1aWxkZXIuX0VsZW1lbnREZWYuX0NvbnRlbnRBdHRyID09IFNjaGVtYUNvbnRlbnRFbXB0eSkgfHwNCiAgICAgICAgICAgICAgICAoYnVpbGRlci5fRWxlbWVudERlZi5fQ29udGVudEF0dHIgPT0gU2NoZW1hQ29udGVudFRleHQpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRWxlbWVudE5vdEFsbG93ZWQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9BbGxvd0RhdGFUeXBlID0gZmFsc2U7DQoNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0hhc1R5cGUgPSBmYWxzZTsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX01pblZhbCA9IDE7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9NYXhWYWwgPSAxOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRFbGVtZW50X1R5cGUoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxRdWFsaWZpZWROYW1lIHFuYW1lID0gKFhtbFF1YWxpZmllZE5hbWUpb2JqOw0KDQogICAgICAgICAgICBpZiAoIWJ1aWxkZXIuX1NjaGVtYUluZm8uRWxlbWVudERlY2xzLkNvbnRhaW5zS2V5KHFuYW1lKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTY2hlbWFFbGVtZW50RGVjbCBlZCA9IChTY2hlbWFFbGVtZW50RGVjbClidWlsZGVyLl9VbmRlY2xhcmVkRWxlbWVudHNbcW5hbWVdOw0KICAgICAgICAgICAgICAgIGlmIChlZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZWQgPSBuZXcgU2NoZW1hRWxlbWVudERlY2wocW5hbWUsIHByZWZpeCk7DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX1VuZGVjbGFyZWRFbGVtZW50cy5BZGQocW5hbWUsIGVkKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0hhc1R5cGUgPSB0cnVlOw0KICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX0VsZW1lbnREZWYuX0V4aXN0VGVybWluYWwpDQogICAgICAgICAgICAgICAgYnVpbGRlci5BZGRPcmRlcigpOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX0V4aXN0VGVybWluYWwgPSB0cnVlOw0KDQogICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLkFkZE5hbWUocW5hbWUsIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRFbGVtZW50X01pbk9jY3VycyhYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0VsZW1lbnREZWYuX01pblZhbCA9IFBhcnNlTWluT2NjdXJzKG9iaiwgYnVpbGRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZEVsZW1lbnRfTWF4T2NjdXJzKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaiwgc3RyaW5nIHByZWZpeCkNCiAgICAgICAgew0KICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fTWF4VmFsID0gUGFyc2VNYXhPY2N1cnMob2JqLCBidWlsZGVyKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8gICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQmVnaW5FbGVtZW50KFhkckJ1aWxkZXIgYnVpbGRlcikNCiAgICAgICAgLy8gIHsNCiAgICAgICAgLy8NCiAgICAgICAgLy8gIH0NCg0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0VuZEVsZW1lbnQoWGRyQnVpbGRlciBidWlsZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYnVpbGRlci5fRWxlbWVudERlZi5fSGFzVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBIYW5kbGVNaW5NYXgoYnVpbGRlci5fY29udGVudFZhbGlkYXRvciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fTWluVmFsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9NYXhWYWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfTWlzc0F0dHJpYnV0ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFhEUiBBdHRyaWJ1dGUNCiAgICAgICAgLy8NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9Jbml0QXR0cmlidXRlKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX0Jhc2VEZWNsID09IG51bGwpDQogICAgICAgICAgICAgICAgYnVpbGRlci5fQmFzZURlY2wgPSBuZXcgRGVjbEJhc2VJbmZvKCk7DQogICAgICAgICAgICBidWlsZGVyLl9CYXNlRGVjbC5fTWluT2NjdXJzID0gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0J1aWxkQXR0cmlidXRlX1R5cGUoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBidWlsZGVyLl9CYXNlRGVjbC5fVHlwZU5hbWUgPSAoWG1sUXVhbGlmaWVkTmFtZSlvYmo7DQogICAgICAgICAgICBidWlsZGVyLl9CYXNlRGVjbC5fUHJlZml4ID0gcHJlZml4Ow0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRBdHRyaWJ1dGVfUmVxdWlyZWQoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNZZXMob2JqLCBidWlsZGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLl9CYXNlRGVjbC5fTWluT2NjdXJzID0gMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0J1aWxkQXR0cmlidXRlX0RlZmF1bHQoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBidWlsZGVyLl9CYXNlRGVjbC5fRGVmYXVsdCA9IG9iajsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0JlZ2luQXR0cmlidXRlKFhkckJ1aWxkZXIgYnVpbGRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX0Jhc2VEZWNsLl9UeXBlTmFtZS5Jc0VtcHR5KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfTWlzc0F0dHJpYnV0ZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFNjaGVtYUF0dERlZiBhdHRkZWYgPSBudWxsOw0KICAgICAgICAgICAgWG1sUXVhbGlmaWVkTmFtZSBxbmFtZSA9IGJ1aWxkZXIuX0Jhc2VEZWNsLl9UeXBlTmFtZTsNCiAgICAgICAgICAgIHN0cmluZyBwcmVmaXggPSBidWlsZGVyLl9CYXNlRGVjbC5fUHJlZml4Ow0KDQogICAgICAgICAgICAvLyBsb2NhbD8NCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9BdHREZWZMaXN0ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXR0ZGVmID0gKFNjaGVtYUF0dERlZilidWlsZGVyLl9FbGVtZW50RGVmLl9BdHREZWZMaXN0W3FuYW1lXTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gZ2xvYmFsPw0KICAgICAgICAgICAgaWYgKGF0dGRlZiA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIFVSTiBpbiB0aGlzIG5hbWUgdGhlbiB0aGUgbmFtZSBpcyBsb2NhbCB0byB0aGUNCiAgICAgICAgICAgICAgICAvLyBzY2hlbWEsIGJ1dCB0aGUgZ2xvYmFsIGF0dHJpYnV0ZSB3YXMgc3RpbGwgVVJOIHF1YWxpZmllZCwgc28NCiAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHF1YWxpZnkgdGhpcyBuYW1lIG5vdy4NCiAgICAgICAgICAgICAgICBYbWxRdWFsaWZpZWROYW1lIGduYW1lID0gcW5hbWU7DQogICAgICAgICAgICAgICAgaWYgKHByZWZpeC5MZW5ndGggPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgZ25hbWUgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZShxbmFtZS5OYW1lLCBidWlsZGVyLl9UYXJnZXROYW1lc3BhY2UpOw0KICAgICAgICAgICAgICAgIFNjaGVtYUF0dERlZiBhZDsNCiAgICAgICAgICAgICAgICBpZiAoYnVpbGRlci5fU2NoZW1hSW5mby5BdHRyaWJ1dGVEZWNscy5UcnlHZXRWYWx1ZShnbmFtZSwgb3V0IGFkKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF0dGRlZiA9IChTY2hlbWFBdHREZWYpYWQuQ2xvbmUoKTsNCiAgICAgICAgICAgICAgICAgICAgYXR0ZGVmLk5hbWUgPSBxbmFtZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocHJlZml4Lkxlbmd0aCAhPSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9VbmRlY2xhcmVkQXR0cmlidXRlLCBYbWxRdWFsaWZpZWROYW1lLlRvU3RyaW5nKHFuYW1lLk5hbWUsIHByZWZpeCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGF0dGRlZiAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuWERSX0NoZWNrQXR0cmlidXRlRGVmYXVsdChidWlsZGVyLl9CYXNlRGVjbCwgYXR0ZGVmKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyB3aWxsIHByb2Nlc3MgdW5kZWNsYXJlZCB0eXBlcyBsYXRlcg0KICAgICAgICAgICAgICAgIGF0dGRlZiA9IG5ldyBTY2hlbWFBdHREZWYocW5hbWUsIHByZWZpeCk7DQogICAgICAgICAgICAgICAgRGVjbEJhc2VJbmZvIGRlY2wgPSBuZXcgRGVjbEJhc2VJbmZvKCk7DQogICAgICAgICAgICAgICAgZGVjbC5fQ2hlY2tpbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGRlY2wuX0F0dGRlZiA9IGF0dGRlZjsNCiAgICAgICAgICAgICAgICBkZWNsLl9UeXBlTmFtZSA9IGJ1aWxkZXIuX0Jhc2VEZWNsLl9UeXBlTmFtZTsNCiAgICAgICAgICAgICAgICBkZWNsLl9FbGVtZW50RGVjbCA9IGJ1aWxkZXIuX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsOw0KICAgICAgICAgICAgICAgIGRlY2wuX01pbk9jY3VycyA9IGJ1aWxkZXIuX0Jhc2VEZWNsLl9NaW5PY2N1cnM7DQogICAgICAgICAgICAgICAgZGVjbC5fRGVmYXVsdCA9IGJ1aWxkZXIuX0Jhc2VEZWNsLl9EZWZhdWx0Ow0KDQogICAgICAgICAgICAgICAgLy8gYWRkIHVuZGVmaW5lZCBhdHRyaWJ1dGUgdHlwZXMNCiAgICAgICAgICAgICAgICBkZWNsLl9OZXh0ID0gYnVpbGRlci5fVW5kZWZpbmVkQXR0cmlidXRlVHlwZXM7DQogICAgICAgICAgICAgICAgYnVpbGRlci5fVW5kZWZpbmVkQXR0cmlidXRlVHlwZXMgPSBkZWNsOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9FbGVtZW50RGVjbC5BZGRBdHREZWYoYXR0ZGVmKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0VuZEF0dHJpYnV0ZShYZHJCdWlsZGVyIGJ1aWxkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0Jhc2VEZWNsLlJlc2V0KCk7DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFhEUiBHcm91cA0KICAgICAgICAvLw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0luaXRHcm91cChYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmopDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9Db250ZW50QXR0ciA9PSBTY2hlbWFDb250ZW50RW1wdHkgfHwNCiAgICAgICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9Db250ZW50QXR0ciA9PSBTY2hlbWFDb250ZW50VGV4dCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0dyb3VwRGlzYWJsZWQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBidWlsZGVyLlB1c2hHcm91cEluZm8oKTsNCg0KICAgICAgICAgICAgYnVpbGRlci5fR3JvdXBEZWYuX01pblZhbCA9IDE7DQogICAgICAgICAgICBidWlsZGVyLl9Hcm91cERlZi5fTWF4VmFsID0gMTsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0dyb3VwRGVmLl9IYXNNYXhBdHRyID0gZmFsc2U7DQogICAgICAgICAgICBidWlsZGVyLl9Hcm91cERlZi5fSGFzTWluQXR0ciA9IGZhbHNlOw0KDQogICAgICAgICAgICBpZiAoYnVpbGRlci5fRWxlbWVudERlZi5fRXhpc3RUZXJtaW5hbCkNCiAgICAgICAgICAgICAgICBidWlsZGVyLkFkZE9yZGVyKCk7DQoNCiAgICAgICAgICAgIC8vIG5vdyB3ZSBhcmUgaW4gYSBncm91cCBzbyB3ZSByZXNldCBmRXhpc3RUZXJtaW5hbA0KICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fRXhpc3RUZXJtaW5hbCA9IGZhbHNlOw0KDQogICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLk9wZW5Hcm91cCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRHcm91cF9PcmRlcihYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0dyb3VwRGVmLl9PcmRlciA9IGJ1aWxkZXIuR2V0T3JkZXIoKFhtbFF1YWxpZmllZE5hbWUpb2JqKTsNCiAgICAgICAgICAgIGlmIChidWlsZGVyLl9FbGVtZW50RGVmLl9Db250ZW50QXR0ciA9PSBTY2hlbWFDb250ZW50TWl4ZWQgJiYgYnVpbGRlci5fR3JvdXBEZWYuX09yZGVyICE9IFNjaGVtYU9yZGVyTWFueSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01peGVkTWFueSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9CdWlsZEdyb3VwX01pbk9jY3VycyhYZHJCdWlsZGVyIGJ1aWxkZXIsIG9iamVjdCBvYmosIHN0cmluZyBwcmVmaXgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0dyb3VwRGVmLl9NaW5WYWwgPSBQYXJzZU1pbk9jY3VycyhvYmosIGJ1aWxkZXIpOw0KICAgICAgICAgICAgYnVpbGRlci5fR3JvdXBEZWYuX0hhc01pbkF0dHIgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQnVpbGRHcm91cF9NYXhPY2N1cnMoWGRyQnVpbGRlciBidWlsZGVyLCBvYmplY3Qgb2JqLCBzdHJpbmcgcHJlZml4KQ0KICAgICAgICB7DQogICAgICAgICAgICBidWlsZGVyLl9Hcm91cERlZi5fTWF4VmFsID0gUGFyc2VNYXhPY2N1cnMob2JqLCBidWlsZGVyKTsNCiAgICAgICAgICAgIGJ1aWxkZXIuX0dyb3VwRGVmLl9IYXNNYXhBdHRyID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8gICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfQmVnaW5Hcm91cChYZHJCdWlsZGVyIGJ1aWxkZXIpDQogICAgICAgIC8vICAgIHsNCiAgICAgICAgLy8NCiAgICAgICAgLy8gICAgfQ0KDQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfRW5kR3JvdXAoWGRyQnVpbGRlciBidWlsZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIWJ1aWxkZXIuX0VsZW1lbnREZWYuX0V4aXN0VGVybWluYWwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9FbGVtZW50TWlzc2luZyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGJ1aWxkZXIuX2NvbnRlbnRWYWxpZGF0b3IuQ2xvc2VHcm91cCgpOw0KDQogICAgICAgICAgICBpZiAoYnVpbGRlci5fR3JvdXBEZWYuX09yZGVyID09IFNjaGVtYU9yZGVyTWFueSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLl9jb250ZW50VmFsaWRhdG9yLkFkZFN0YXIoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKFNjaGVtYU9yZGVyTWFueSA9PSBidWlsZGVyLl9Hcm91cERlZi5fT3JkZXIgJiYNCiAgICAgICAgICAgICAgICBidWlsZGVyLl9Hcm91cERlZi5fSGFzTWF4QXR0ciAmJg0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuX0dyb3VwRGVmLl9NYXhWYWwgIT0gdWludC5NYXhWYWx1ZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01hbnlNYXhPY2N1cnMpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBIYW5kbGVNaW5NYXgoYnVpbGRlci5fY29udGVudFZhbGlkYXRvciwNCiAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZGVyLl9Hcm91cERlZi5fTWluVmFsLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuX0dyb3VwRGVmLl9NYXhWYWwpOw0KDQogICAgICAgICAgICBidWlsZGVyLlBvcEdyb3VwSW5mbygpOw0KICAgICAgICB9DQoNCg0KICAgICAgICAvLw0KICAgICAgICAvLyBEYXRhVHlwZQ0KICAgICAgICAvLw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWERSX0luaXRFbGVtZW50RHRUeXBlKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX0VsZW1lbnREZWYuX0hhc0RhdGFUeXBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRHVwRHRUeXBlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCFidWlsZGVyLl9FbGVtZW50RGVmLl9BbGxvd0RhdGFUeXBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRGF0YVR5cGVUZXh0T25seSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9FbmRFbGVtZW50RHRUeXBlKFhkckJ1aWxkZXIgYnVpbGRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFidWlsZGVyLl9FbGVtZW50RGVmLl9IYXNEYXRhVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01pc3NBdHRyaWJ1dGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fRWxlbWVudERlY2wuQ29udGVudFZhbGlkYXRvciA9IENvbnRlbnRWYWxpZGF0b3IuVGV4dE9ubHk7DQogICAgICAgICAgICBidWlsZGVyLl9FbGVtZW50RGVmLl9Db250ZW50QXR0ciA9IFNjaGVtYUNvbnRlbnRUZXh0Ow0KICAgICAgICAgICAgYnVpbGRlci5fRWxlbWVudERlZi5fTWFzdGVyR3JvdXBSZXF1aXJlZCA9IGZhbHNlOw0KICAgICAgICAgICAgYnVpbGRlci5fY29udGVudFZhbGlkYXRvciA9IG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFhEUl9Jbml0QXR0cmlidXRlRHRUeXBlKFhkckJ1aWxkZXIgYnVpbGRlciwgb2JqZWN0IG9iaikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fSGFzRGF0YVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EdXBEdFR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYRFJfRW5kQXR0cmlidXRlRHRUeXBlKFhkckJ1aWxkZXIgYnVpbGRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGNvZGUgPSBudWxsOw0KDQogICAgICAgICAgICBpZiAoIWJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fSGFzRGF0YVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY29kZSA9IFNSLlNjaF9NaXNzQXR0cmlidXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0F0dERlZi5EYXRhdHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sVG9rZW5pemVkVHlwZSB0dHlwZSA9IGJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fQXR0RGVmLkRhdGF0eXBlLlRva2VuaXplZFR5cGU7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR0eXBlID09IFhtbFRva2VuaXplZFR5cGUuRU5VTUVSQVRJT04gJiYgIWJ1aWxkZXIuX0F0dHJpYnV0ZURlZi5fRW51bWVyYXRpb25SZXF1aXJlZCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IFNSLlNjaF9NaXNzRHR2YWx1ZXNBdHRyaWJ1dGU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHR5cGUgIT0gWG1sVG9rZW5pemVkVHlwZS5FTlVNRVJBVElPTiAmJiBidWlsZGVyLl9BdHRyaWJ1dGVEZWYuX0VudW1lcmF0aW9uUmVxdWlyZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBTUi5TY2hfUmVxdWlyZUVudW1lcmF0aW9uOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoY29kZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBwcml2YXRlIHV0aWxpdHkgbWV0aG9kcw0KICAgICAgICAvLw0KDQogICAgICAgIHByaXZhdGUgYm9vbCBHZXROZXh0U3RhdGUoWG1sUXVhbGlmaWVkTmFtZSBxbmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF9DdXJTdGF0ZS5fTmV4dFN0YXRlcyAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX0N1clN0YXRlLl9OZXh0U3RhdGVzLkxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9TY2hlbWFOYW1lcy5Ub2tlblRvUU5hbWVbKGludClzX3NjaGVtYUVudHJpZXNbX0N1clN0YXRlLl9OZXh0U3RhdGVzW2ldXS5fTmFtZV0uRXF1YWxzKHFuYW1lKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgX05leHRTdGF0ZSA9IHNfc2NoZW1hRW50cmllc1tfQ3VyU3RhdGUuX05leHRTdGF0ZXNbaV1dOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYm9vbCBJc1NraXBhYmxlRWxlbWVudChYbWxRdWFsaWZpZWROYW1lIHFuYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgbnMgPSBxbmFtZS5OYW1lc3BhY2U7DQogICAgICAgICAgICBpZiAobnMgIT0gbnVsbCAmJiAhUmVmLkVxdWFsKG5zLCBfU2NoZW1hTmFtZXMuTnNYZHIpKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KDQogICAgICAgICAgICAvLyBza2lwIGRlc2NyaXB0aW9uICYmIGV4dGVuZHMNCiAgICAgICAgICAgIGlmIChfU2NoZW1hTmFtZXMuVG9rZW5Ub1FOYW1lWyhpbnQpU2NoZW1hTmFtZXMuVG9rZW4uWGRyRGVzY3JpcHRpb25dLkVxdWFscyhxbmFtZSkgfHwNCiAgICAgICAgICAgICAgICBfU2NoZW1hTmFtZXMuVG9rZW5Ub1FOYW1lWyhpbnQpU2NoZW1hTmFtZXMuVG9rZW4uWGRyRXh0ZW5kc10uRXF1YWxzKHFuYW1lKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBib29sIElzU2tpcGFibGVBdHRyaWJ1dGUoWG1sUXVhbGlmaWVkTmFtZSBxbmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIG5zID0gcW5hbWUuTmFtZXNwYWNlOw0KICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgIG5zLkxlbmd0aCAhPSAwICYmDQogICAgICAgICAgICAgICAgIVJlZi5FcXVhbChucywgX1NjaGVtYU5hbWVzLk5zWGRyKSAmJg0KICAgICAgICAgICAgICAgICFSZWYuRXF1YWwobnMsIF9TY2hlbWFOYW1lcy5Oc0RhdGFUeXBlKQ0KICAgICAgICAgICAgICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKFJlZi5FcXVhbChucywgX1NjaGVtYU5hbWVzLk5zRGF0YVR5cGUpICYmDQogICAgICAgICAgICAgICAgX0N1clN0YXRlLl9OYW1lID09IFNjaGVtYU5hbWVzLlRva2VuLlhkckRhdGF0eXBlICYmDQogICAgICAgICAgICAgICAgKF9TY2hlbWFOYW1lcy5RbkR0TWF4LkVxdWFscyhxbmFtZSkgfHwNCiAgICAgICAgICAgICAgICAgX1NjaGVtYU5hbWVzLlFuRHRNaW4uRXF1YWxzKHFuYW1lKSB8fA0KICAgICAgICAgICAgICAgICBfU2NoZW1hTmFtZXMuUW5EdE1heEV4Y2x1c2l2ZS5FcXVhbHMocW5hbWUpIHx8DQogICAgICAgICAgICAgICAgIF9TY2hlbWFOYW1lcy5RbkR0TWluRXhjbHVzaXZlLkVxdWFscyhxbmFtZSkpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGludCBHZXRPcmRlcihYbWxRdWFsaWZpZWROYW1lIHFuYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBpbnQgb3JkZXIgPSAwOw0KICAgICAgICAgICAgaWYgKF9TY2hlbWFOYW1lcy5Ub2tlblRvUU5hbWVbKGludClTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFTZXFdLkVxdWFscyhxbmFtZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgb3JkZXIgPSBTY2hlbWFPcmRlclNlcXVlbmNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoX1NjaGVtYU5hbWVzLlRva2VuVG9RTmFtZVsoaW50KVNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYU9uZV0uRXF1YWxzKHFuYW1lKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBvcmRlciA9IFNjaGVtYU9yZGVyQ2hvaWNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoX1NjaGVtYU5hbWVzLlRva2VuVG9RTmFtZVsoaW50KVNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYU1hbnldLkVxdWFscyhxbmFtZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgb3JkZXIgPSBTY2hlbWFPcmRlck1hbnk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfVW5rbm93bk9yZGVyLCBxbmFtZS5OYW1lKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIG9yZGVyOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIEFkZE9yZGVyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gYWRkaXRpb25hbCBvcmRlciBjYW4gYmUgYWRkIG9uIGJ5IGNoYW5naW5nIHRoZSBzZXRPcmRlciBhbmQgYWRkT3JkZXINCiAgICAgICAgICAgIHN3aXRjaCAoX0dyb3VwRGVmLl9PcmRlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFNjaGVtYU9yZGVyU2VxdWVuY2U6DQogICAgICAgICAgICAgICAgICAgIF9jb250ZW50VmFsaWRhdG9yLkFkZFNlcXVlbmNlKCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgU2NoZW1hT3JkZXJDaG9pY2U6DQogICAgICAgICAgICAgICAgY2FzZSBTY2hlbWFPcmRlck1hbnk6DQogICAgICAgICAgICAgICAgICAgIF9jb250ZW50VmFsaWRhdG9yLkFkZENob2ljZSgpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIGNhc2UgU2NoZW1hT3JkZXJBbGw6DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBYbWxFeGNlcHRpb24oU1IuWG1sX1VuZXhwZWN0ZWRUb2tlbiwgIk5BTUUiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIGJvb2wgSXNZZXMob2JqZWN0IG9iaiwgWGRyQnVpbGRlciBidWlsZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxRdWFsaWZpZWROYW1lIHFuYW1lID0gKFhtbFF1YWxpZmllZE5hbWUpb2JqOw0KICAgICAgICAgICAgYm9vbCBmWWVzID0gZmFsc2U7DQoNCiAgICAgICAgICAgIGlmIChxbmFtZS5OYW1lID09ICJ5ZXMiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZZZXMgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAocW5hbWUuTmFtZSAhPSAibm8iKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ1aWxkZXIuU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfVW5rbm93blJlcXVpcmVkKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGZZZXM7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB1aW50IFBhcnNlTWluT2NjdXJzKG9iamVjdCBvYmosIFhkckJ1aWxkZXIgYnVpbGRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgdWludCBjVmFsID0gMTsNCg0KICAgICAgICAgICAgaWYgKCFQYXJzZUludGVnZXIoKHN0cmluZylvYmosIHJlZiBjVmFsKSB8fCAoY1ZhbCAhPSAwICYmIGNWYWwgIT0gMSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaW5PY2N1cnNJbnZhbGlkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBjVmFsOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdWludCBQYXJzZU1heE9jY3VycyhvYmplY3Qgb2JqLCBYZHJCdWlsZGVyIGJ1aWxkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVpbnQgY1ZhbCA9IHVpbnQuTWF4VmFsdWU7DQogICAgICAgICAgICBzdHJpbmcgcyA9IChzdHJpbmcpb2JqOw0KDQogICAgICAgICAgICBpZiAoIXMuRXF1YWxzKCIqIikgJiYNCiAgICAgICAgICAgICAgICAoIVBhcnNlSW50ZWdlcihzLCByZWYgY1ZhbCkgfHwgKGNWYWwgIT0gdWludC5NYXhWYWx1ZSAmJiBjVmFsICE9IDEpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX01heE9jY3Vyc0ludmFsaWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNWYWw7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIEhhbmRsZU1pbk1heChQYXJ0aWNsZUNvbnRlbnRWYWxpZGF0b3IgcENvbnRlbnQsIHVpbnQgY01pbiwgdWludCBjTWF4KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAocENvbnRlbnQgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoY01heCA9PSB1aW50Lk1heFZhbHVlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNNaW4gPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHBDb250ZW50LkFkZFN0YXIoKTsgICAgICAgICAgIC8vIG1pbk9jY3Vycz0iMCIgYW5kIG1heE9jY3Vycz0iaW5maW5pdGUiDQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHBDb250ZW50LkFkZFBsdXMoKTsgICAgICAgICAgIC8vIG1pbk9jY3Vycz0iMSIgYW5kIG1heE9jY3Vycz0iaW5maW5pdGUiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNNaW4gPT0gMCkNCiAgICAgICAgICAgICAgICB7ICAgICAgICAgICAgICAgICAvLyBtaW5PY2N1cnM9IjAiIGFuZCBtYXhPY2N1cnM9IjEiKQ0KICAgICAgICAgICAgICAgICAgICBwQ29udGVudC5BZGRRTWFyaygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgUGFyc2VEdE1heExlbmd0aChyZWYgdWludCBjVmFsLCBvYmplY3Qgb2JqLCBYZHJCdWlsZGVyIGJ1aWxkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh1aW50Lk1heFZhbHVlICE9IGNWYWwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EdXBEdE1heExlbmd0aCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICghUGFyc2VJbnRlZ2VyKChzdHJpbmcpb2JqLCByZWYgY1ZhbCkgfHwgY1ZhbCA8IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EdE1heExlbmd0aEludmFsaWQsIG9iai5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgUGFyc2VEdE1pbkxlbmd0aChyZWYgdWludCBjVmFsLCBvYmplY3Qgb2JqLCBYZHJCdWlsZGVyIGJ1aWxkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh1aW50Lk1heFZhbHVlICE9IGNWYWwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EdXBEdE1pbkxlbmd0aCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICghUGFyc2VJbnRlZ2VyKChzdHJpbmcpb2JqLCByZWYgY1ZhbCkgfHwgY1ZhbCA8IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYnVpbGRlci5TZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EdE1pbkxlbmd0aEludmFsaWQsIG9iai5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgQ29tcGFyZU1pbk1heExlbmd0aCh1aW50IGNNaW4sIHVpbnQgY01heCwgWGRyQnVpbGRlciBidWlsZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoY01pbiAhPSB1aW50Lk1heFZhbHVlICYmIGNNYXggIT0gdWludC5NYXhWYWx1ZSAmJiBjTWluID4gY01heCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBidWlsZGVyLlNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0R0TWluTWF4TGVuZ3RoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIGJvb2wgUGFyc2VJbnRlZ2VyKHN0cmluZyBzdHIsIHJlZiB1aW50IG4pDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBVSW50MzIuVHJ5UGFyc2Uoc3RyLCBOdW1iZXJTdHlsZXMuQWxsb3dMZWFkaW5nV2hpdGUgfCBOdW1iZXJTdHlsZXMuQWxsb3dUcmFpbGluZ1doaXRlLCBOdW1iZXJGb3JtYXRJbmZvLkludmFyaWFudEluZm8sIG91dCBuKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBYRFJfQ2hlY2tBdHRyaWJ1dGVEZWZhdWx0KERlY2xCYXNlSW5mbyBkZWNsLCBTY2hlbWFBdHREZWYgcEF0dGRlZikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGRlY2wuX0RlZmF1bHQgIT0gbnVsbCB8fCBwQXR0ZGVmLkRlZmF1bHRWYWx1ZVR5cGVkICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGRlY2wuX0RlZmF1bHQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHBBdHRkZWYuRGVmYXVsdFZhbHVlUmF3ID0gcEF0dGRlZi5EZWZhdWx0VmFsdWVFeHBhbmRlZCA9IChzdHJpbmcpZGVjbC5fRGVmYXVsdDsNCiAgICAgICAgICAgICAgICAgICAgQ2hlY2tEZWZhdWx0QXR0VmFsdWUocEF0dGRlZik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBTZXRBdHRyaWJ1dGVQcmVzZW5jZShwQXR0ZGVmLCAxID09IGRlY2wuX01pbk9jY3Vycyk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgU2V0QXR0cmlidXRlUHJlc2VuY2UoU2NoZW1hQXR0RGVmIHBBdHRkZWYsIGJvb2wgZlJlcXVpcmVkKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoU2NoZW1hRGVjbEJhc2UuVXNlLkZpeGVkICE9IHBBdHRkZWYuUHJlc2VuY2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGZSZXF1aXJlZCB8fCBTY2hlbWFEZWNsQmFzZS5Vc2UuUmVxdWlyZWQgPT0gcEF0dGRlZi5QcmVzZW5jZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIElmIGl0IGlzIHJlcXVpcmVkIGFuZCBpdCBoYXMgYSBkZWZhdWx0IHZhbHVlIHRoZW4gaXQgaXMgYSBGSVhFRCBhdHRyaWJ1dGUuDQogICAgICAgICAgICAgICAgICAgIGlmIChwQXR0ZGVmLkRlZmF1bHRWYWx1ZVR5cGVkICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICBwQXR0ZGVmLlByZXNlbmNlID0gU2NoZW1hRGVjbEJhc2UuVXNlLkZpeGVkOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBwQXR0ZGVmLlByZXNlbmNlID0gU2NoZW1hRGVjbEJhc2UuVXNlLlJlcXVpcmVkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwQXR0ZGVmLkRlZmF1bHRWYWx1ZVR5cGVkICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBwQXR0ZGVmLlByZXNlbmNlID0gU2NoZW1hRGVjbEJhc2UuVXNlLkRlZmF1bHQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHBBdHRkZWYuUHJlc2VuY2UgPSBTY2hlbWFEZWNsQmFzZS5Vc2UuSW1wbGllZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGludCBHZXRDb250ZW50KFhtbFF1YWxpZmllZE5hbWUgcW5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGludCBjb250ZW50ID0gMDsNCiAgICAgICAgICAgIGlmIChfU2NoZW1hTmFtZXMuVG9rZW5Ub1FOYW1lWyhpbnQpU2NoZW1hTmFtZXMuVG9rZW4uU2NoZW1hRW1wdHldLkVxdWFscyhxbmFtZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY29udGVudCA9IFNjaGVtYUNvbnRlbnRFbXB0eTsNCiAgICAgICAgICAgICAgICBfRWxlbWVudERlZi5fQWxsb3dEYXRhVHlwZSA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoX1NjaGVtYU5hbWVzLlRva2VuVG9RTmFtZVsoaW50KVNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYUVsZW1lbnRPbmx5XS5FcXVhbHMocW5hbWUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTY2hlbWFDb250ZW50RWxlbWVudDsNCiAgICAgICAgICAgICAgICBfRWxlbWVudERlZi5fQWxsb3dEYXRhVHlwZSA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoX1NjaGVtYU5hbWVzLlRva2VuVG9RTmFtZVsoaW50KVNjaGVtYU5hbWVzLlRva2VuLlNjaGVtYU1peGVkXS5FcXVhbHMocW5hbWUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTY2hlbWFDb250ZW50TWl4ZWQ7DQogICAgICAgICAgICAgICAgX0VsZW1lbnREZWYuX0FsbG93RGF0YVR5cGUgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKF9TY2hlbWFOYW1lcy5Ub2tlblRvUU5hbWVbKGludClTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFUZXh0T25seV0uRXF1YWxzKHFuYW1lKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjb250ZW50ID0gU2NoZW1hQ29udGVudFRleHQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfVW5rbm93bkNvbnRlbnQsIHFuYW1lLk5hbWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGJvb2wgR2V0TW9kZWwoWG1sUXVhbGlmaWVkTmFtZSBxbmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgYm9vbCBmT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgaWYgKF9TY2hlbWFOYW1lcy5Ub2tlblRvUU5hbWVbKGludClTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFPcGVuXS5FcXVhbHMocW5hbWUpKQ0KICAgICAgICAgICAgICAgIGZPcGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIGVsc2UgaWYgKF9TY2hlbWFOYW1lcy5Ub2tlblRvUU5hbWVbKGludClTY2hlbWFOYW1lcy5Ub2tlbi5TY2hlbWFDbG9zZWRdLkVxdWFscyhxbmFtZSkpDQogICAgICAgICAgICAgICAgZk9wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Vbmtub3duTW9kZWwsIHFuYW1lLk5hbWUpOw0KICAgICAgICAgICAgcmV0dXJuIGZPcGVuOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFEYXRhdHlwZSBDaGVja0RhdGF0eXBlKHN0cmluZyBzdHIpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYURhdGF0eXBlIGR0eXBlID0gWG1sU2NoZW1hRGF0YXR5cGUuRnJvbVhkck5hbWUoc3RyKTsNCiAgICAgICAgICAgIGlmIChkdHlwZSA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1Vua25vd25EdFR5cGUsIHN0cik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChkdHlwZS5Ub2tlbml6ZWRUeXBlID09IFhtbFRva2VuaXplZFR5cGUuSUQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFfQXR0cmlidXRlRGVmLl9HbG9iYWwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsLklzSWREZWNsYXJlZCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfSWRBdHRyRGVjbGFyZWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUuVG9TdHJpbmcoX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsLk5hbWUuTmFtZSwgX0VsZW1lbnREZWYuX0VsZW1lbnREZWNsLlByZWZpeCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIF9FbGVtZW50RGVmLl9FbGVtZW50RGVjbC5Jc0lkRGVjbGFyZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGR0eXBlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIENoZWNrRGVmYXVsdEF0dFZhbHVlKFNjaGVtYUF0dERlZiBhdHREZWYpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBzdHIgPSAoYXR0RGVmLkRlZmF1bHRWYWx1ZVJhdykuVHJpbSgpOw0KICAgICAgICAgICAgWGRyVmFsaWRhdG9yLkNoZWNrRGVmYXVsdFZhbHVlKHN0ciwgYXR0RGVmLCBfU2NoZW1hSW5mbywgX0N1ck5zTWdyLCBfTmFtZVRhYmxlLCBudWxsLCBfdmFsaWRhdGlvbkV2ZW50SGFuZGxlciwgX3JlYWRlci5CYXNlVVJJLCBfcG9zaXRpb25JbmZvLkxpbmVOdW1iZXIsIF9wb3NpdGlvbkluZm8uTGluZVBvc2l0aW9uKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYm9vbCBJc0dsb2JhbChpbnQgZmxhZ3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBmbGFncyA9PSBTY2hlbWFGbGFnc05zOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFNlbmRWYWxpZGF0aW9uRXZlbnQoc3RyaW5nIGNvZGUsIHN0cmluZ1tdIGFyZ3MsIFhtbFNldmVyaXR5VHlwZSBzZXZlcml0eSkNCiAgICAgICAgew0KICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChuZXcgWG1sU2NoZW1hRXhjZXB0aW9uKGNvZGUsIGFyZ3MsIF9yZWFkZXIuQmFzZVVSSSwgX3Bvc2l0aW9uSW5mby5MaW5lTnVtYmVyLCBfcG9zaXRpb25JbmZvLkxpbmVQb3NpdGlvbiksIHNldmVyaXR5KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBTZW5kVmFsaWRhdGlvbkV2ZW50KHN0cmluZyBjb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KGNvZGUsIHN0cmluZy5FbXB0eSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgU2VuZFZhbGlkYXRpb25FdmVudChzdHJpbmcgY29kZSwgc3RyaW5nIG1zZykNCiAgICAgICAgew0KICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChuZXcgWG1sU2NoZW1hRXhjZXB0aW9uKGNvZGUsIG1zZywgX3JlYWRlci5CYXNlVVJJLCBfcG9zaXRpb25JbmZvLkxpbmVOdW1iZXIsIF9wb3NpdGlvbkluZm8uTGluZVBvc2l0aW9uKSwgWG1sU2V2ZXJpdHlUeXBlLkVycm9yKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBTZW5kVmFsaWRhdGlvbkV2ZW50KFhtbFNjaGVtYUV4Y2VwdGlvbiBlLCBYbWxTZXZlcml0eVR5cGUgc2V2ZXJpdHkpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9TY2hlbWFJbmZvLkVycm9yQ291bnQrKzsNCiAgICAgICAgICAgIGlmIChfdmFsaWRhdGlvbkV2ZW50SGFuZGxlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uRXZlbnRIYW5kbGVyKHRoaXMsIG5ldyBWYWxpZGF0aW9uRXZlbnRBcmdzKGUsIHNldmVyaXR5KSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChzZXZlcml0eSA9PSBYbWxTZXZlcml0eVR5cGUuRXJyb3IpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07IC8vIGNsYXNzIFhkckJ1aWxkZXINCn0gLy8gbmFtZXNwYWNlIFN5c3RlbS5YbWwNCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XdrValidator.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlNjaGVtYQ0Kew0KICAgIHVzaW5nIFN5c3RlbS5JTzsNCiAgICB1c2luZyBTeXN0ZW0uVGV4dDsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnM7DQogICAgdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KICAgIHVzaW5nIFN5c3RlbS5HbG9iYWxpemF0aW9uOw0KICAgIHVzaW5nIFN5c3RlbS5SdW50aW1lLlZlcnNpb25pbmc7DQoNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDYxOA0KICAgIGludGVybmFsIHNlYWxlZCBjbGFzcyBYZHJWYWxpZGF0b3IgOiBCYXNlVmFsaWRhdG9yDQogICAgew0KICAgICAgICBwcml2YXRlIGNvbnN0IGludCBTVEFDS19JTkNSRU1FTlQgPSAxMDsNCiAgICAgICAgcHJpdmF0ZSBIV1N0YWNrIF92YWxpZGF0aW9uU3RhY2s7ICAvLyB2YWxpZGF0b24gY29udGV4dHMNCiAgICAgICAgcHJpdmF0ZSBIYXNodGFibGUgX2F0dFByZXNlbmNlOw0KICAgICAgICBwcml2YXRlIFhtbFF1YWxpZmllZE5hbWUgX25hbWUgPSBYbWxRdWFsaWZpZWROYW1lLkVtcHR5Ow0KICAgICAgICBwcml2YXRlIFhtbE5hbWVzcGFjZU1hbmFnZXIgX25zTWFuYWdlcjsNCiAgICAgICAgcHJpdmF0ZSBib29sIF9pc1Byb2Nlc3NDb250ZW50cyA9IGZhbHNlOw0KICAgICAgICBwcml2YXRlIEhhc2h0YWJsZSBfSURzOw0KICAgICAgICBwcml2YXRlIElkUmVmTm9kZSBfaWRSZWZMaXN0SGVhZDsNCiAgICAgICAgcHJpdmF0ZSBQYXJzZXIgX2lubGluZVNjaGVtYVBhcnNlciA9IG51bGw7DQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIHhfc2NoZW1hID0gIngtc2NoZW1hOiI7DQoNCiAgICAgICAgaW50ZXJuYWwgWGRyVmFsaWRhdG9yKEJhc2VWYWxpZGF0b3IgdmFsaWRhdG9yKSA6IGJhc2UodmFsaWRhdG9yKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0KCk7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYZHJWYWxpZGF0b3IoWG1sVmFsaWRhdGluZ1JlYWRlckltcGwgcmVhZGVyLCBYbWxTY2hlbWFDb2xsZWN0aW9uIHNjaGVtYUNvbGxlY3Rpb24sIElWYWxpZGF0aW9uRXZlbnRIYW5kbGluZyBldmVudEhhbmRsaW5nKSA6IGJhc2UocmVhZGVyLCBzY2hlbWFDb2xsZWN0aW9uLCBldmVudEhhbmRsaW5nKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0KCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgSW5pdCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9uc01hbmFnZXIgPSByZWFkZXIuTmFtZXNwYWNlTWFuYWdlcjsNCiAgICAgICAgICAgIGlmIChfbnNNYW5hZ2VyID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX25zTWFuYWdlciA9IG5ldyBYbWxOYW1lc3BhY2VNYW5hZ2VyKE5hbWVUYWJsZSk7DQogICAgICAgICAgICAgICAgX2lzUHJvY2Vzc0NvbnRlbnRzID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF92YWxpZGF0aW9uU3RhY2sgPSBuZXcgSFdTdGFjayhTVEFDS19JTkNSRU1FTlQpOw0KICAgICAgICAgICAgdGV4dFZhbHVlID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsNCiAgICAgICAgICAgIF9uYW1lID0gWG1sUXVhbGlmaWVkTmFtZS5FbXB0eTsNCiAgICAgICAgICAgIF9hdHRQcmVzZW5jZSA9IG5ldyBIYXNodGFibGUoKTsNCiAgICAgICAgICAgIFB1c2goWG1sUXVhbGlmaWVkTmFtZS5FbXB0eSk7DQogICAgICAgICAgICBzY2hlbWFJbmZvID0gbmV3IFNjaGVtYUluZm8oKTsNCiAgICAgICAgICAgIGNoZWNrRGF0YXR5cGUgPSBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFZhbGlkYXRlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKElzSW5saW5lU2NoZW1hU3RhcnRlZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBQcm9jZXNzSW5saW5lU2NoZW1hKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3dpdGNoIChyZWFkZXIuTm9kZVR5cGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZUVsZW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIuSXNFbXB0eUVsZW1lbnQpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBjYXNlIFhtbE5vZGVUeXBlLkVuZEVsZW1lbnQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5XaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVXaGl0ZXNwYWNlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5UZXh0OiAgICAgICAgICAvLyB0ZXh0IGluc2lkZSBhIG5vZGUNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5DREFUQTogICAgICAgICAvLyA8IVtDREFUQVsuLi5dXT4NCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5TaWduaWZpY2FudFdoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZVRleHQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVuZEVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZUVuZEVsZW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBWYWxpZGF0ZUVsZW1lbnQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBlbGVtZW50TmFtZS5Jbml0KHJlYWRlci5Mb2NhbE5hbWUsIFhtbFNjaGVtYURhdGF0eXBlLlhkckNhbm9uaXplVXJpKHJlYWRlci5OYW1lc3BhY2VVUkksIE5hbWVUYWJsZSwgU2NoZW1hTmFtZXMpKTsNCiAgICAgICAgICAgIFZhbGlkYXRlQ2hpbGRFbGVtZW50KCk7DQogICAgICAgICAgICBpZiAoU2NoZW1hTmFtZXMuSXNYRFJSb290KGVsZW1lbnROYW1lLk5hbWUsIGVsZW1lbnROYW1lLk5hbWVzcGFjZSkgJiYgcmVhZGVyLkRlcHRoID4gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfaW5saW5lU2NoZW1hUGFyc2VyID0gbmV3IFBhcnNlcihTY2hlbWFUeXBlLlhEUiwgTmFtZVRhYmxlLCBTY2hlbWFOYW1lcywgRXZlbnRIYW5kbGVyKTsNCiAgICAgICAgICAgICAgICBfaW5saW5lU2NoZW1hUGFyc2VyLlN0YXJ0UGFyc2luZyhyZWFkZXIsIG51bGwpOw0KICAgICAgICAgICAgICAgIF9pbmxpbmVTY2hlbWFQYXJzZXIuUGFyc2VSZWFkZXJOb2RlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgUHJvY2Vzc0VsZW1lbnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBWYWxpZGF0ZUNoaWxkRWxlbWVudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChjb250ZXh0Lk5lZWRWYWxpZGF0ZUNoaWxkcmVuKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGludCBlcnJvckNvZGUgPSAwOw0KICAgICAgICAgICAgICAgIGNvbnRleHQuRWxlbWVudERlY2wuQ29udGVudFZhbGlkYXRvci5WYWxpZGF0ZUVsZW1lbnQoZWxlbWVudE5hbWUsIGNvbnRleHQsIG91dCBlcnJvckNvZGUpOw0KICAgICAgICAgICAgICAgIGlmIChlcnJvckNvZGUgPCAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hVmFsaWRhdG9yLkVsZW1lbnRWYWxpZGF0aW9uRXJyb3IoZWxlbWVudE5hbWUsIGNvbnRleHQsIEV2ZW50SGFuZGxlciwgcmVhZGVyLCByZWFkZXIuQmFzZVVSSSwgUG9zaXRpb25JbmZvLkxpbmVOdW1iZXIsIFBvc2l0aW9uSW5mby5MaW5lUG9zaXRpb24sIG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYm9vbCBJc0lubGluZVNjaGVtYVN0YXJ0ZWQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9pbmxpbmVTY2hlbWFQYXJzZXIgIT0gbnVsbDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByb2Nlc3NJbmxpbmVTY2hlbWEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIV9pbmxpbmVTY2hlbWFQYXJzZXIuUGFyc2VSZWFkZXJOb2RlKCkpDQogICAgICAgICAgICB7IC8vIERvbmUNCiAgICAgICAgICAgICAgICBfaW5saW5lU2NoZW1hUGFyc2VyLkZpbmlzaFBhcnNpbmcoKTsNCiAgICAgICAgICAgICAgICBTY2hlbWFJbmZvIHhkclNjaGVtYSA9IF9pbmxpbmVTY2hlbWFQYXJzZXIuWGRyU2NoZW1hOw0KICAgICAgICAgICAgICAgIGlmICh4ZHJTY2hlbWEgIT0gbnVsbCAmJiB4ZHJTY2hlbWEuRXJyb3JDb3VudCA9PSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIGlubGluZU5TIGluIHhkclNjaGVtYS5UYXJnZXROYW1lc3BhY2VzLktleXMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zY2hlbWFJbmZvLkhhc1NjaGVtYShpbmxpbmVOUykpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hSW5mby5BZGQoeGRyU2NoZW1hLCBFdmVudEhhbmRsZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNjaGVtYUNvbGxlY3Rpb24uQWRkKGlubGluZU5TLCB4ZHJTY2hlbWEsIG51bGwsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBfaW5saW5lU2NoZW1hUGFyc2VyID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQcm9jZXNzRWxlbWVudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFB1c2goZWxlbWVudE5hbWUpOw0KICAgICAgICAgICAgaWYgKF9pc1Byb2Nlc3NDb250ZW50cykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfbnNNYW5hZ2VyLlBvcFNjb3BlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb250ZXh0LkVsZW1lbnREZWNsID0gVGhvcm91Z2hHZXRFbGVtZW50RGVjbCgpOw0KICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWYWxpZGF0ZVN0YXJ0RWxlbWVudCgpOw0KICAgICAgICAgICAgICAgIFZhbGlkYXRlRW5kU3RhcnRFbGVtZW50KCk7DQogICAgICAgICAgICAgICAgY29udGV4dC5OZWVkVmFsaWRhdGVDaGlsZHJlbiA9IHRydWU7DQogICAgICAgICAgICAgICAgY29udGV4dC5FbGVtZW50RGVjbC5Db250ZW50VmFsaWRhdG9yLkluaXRWYWxpZGF0aW9uKGNvbnRleHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFZhbGlkYXRlRW5kRWxlbWVudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChfaXNQcm9jZXNzQ29udGVudHMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX25zTWFuYWdlci5Qb3BTY29wZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5OZWVkVmFsaWRhdGVDaGlsZHJlbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICghY29udGV4dC5FbGVtZW50RGVjbC5Db250ZW50VmFsaWRhdG9yLkNvbXBsZXRlVmFsaWRhdGlvbihjb250ZXh0KSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hVmFsaWRhdG9yLkNvbXBsZXRlVmFsaWRhdGlvbkVycm9yKGNvbnRleHQsIEV2ZW50SGFuZGxlciwgcmVhZGVyLCByZWFkZXIuQmFzZVVSSSwgUG9zaXRpb25JbmZvLkxpbmVOdW1iZXIsIFBvc2l0aW9uSW5mby5MaW5lUG9zaXRpb24sIG51bGwpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChjaGVja0RhdGF0eXBlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHN0cmluZ1ZhbHVlID0gIWhhc1NpYmxpbmcgPyB0ZXh0U3RyaW5nIDogdGV4dFZhbHVlLlRvU3RyaW5nKCk7ICAvLyBvbmx5IGZvciBpZGVudGl0eS1jb25zdHJhaW50IGV4Y2VwdGlvbiByZXBvcnRpbmcNCiAgICAgICAgICAgICAgICAgICAgQ2hlY2tWYWx1ZShzdHJpbmdWYWx1ZSwgbnVsbCk7DQogICAgICAgICAgICAgICAgICAgIGNoZWNrRGF0YXR5cGUgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgdGV4dFZhbHVlLkxlbmd0aCA9IDA7IC8vIGNsZWFudXANCiAgICAgICAgICAgICAgICAgICAgdGV4dFN0cmluZyA9IHN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBQb3AoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFN4UzogVGhpcyBtZXRob2QgcHJvY2Vzc2VzIHJlc291cmNlIG5hbWVzIHJlYWQgZnJvbSB0aGUgc291cmNlIGRvY3VtZW50IGFuZCBkb2VzIG5vdCBleHBvc2UNCiAgICAgICAgLy8gYW55IHJlc291cmNlcyB0byB0aGUgY2FsbGVyLiBJdCBpcyBmaW5lIHRvIHN1cHByZXNzIHRoZSBTeFMgd2FybmluZy4NCiAgICAgICAgcHJpdmF0ZSBTY2hlbWFFbGVtZW50RGVjbCBUaG9yb3VnaEdldEVsZW1lbnREZWNsKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHJlYWRlci5EZXB0aCA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRTY2hlbWEoc3RyaW5nLkVtcHR5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChyZWFkZXIuTW92ZVRvRmlyc3RBdHRyaWJ1dGUoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBkbw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG9iamVjdE5zID0gcmVhZGVyLk5hbWVzcGFjZVVSSTsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG9iamVjdE5hbWUgPSByZWFkZXIuTG9jYWxOYW1lOw0KICAgICAgICAgICAgICAgICAgICBpZiAoUmVmLkVxdWFsKG9iamVjdE5zLCBTY2hlbWFOYW1lcy5Oc1htbE5zKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgTG9hZFNjaGVtYShyZWFkZXIuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9pc1Byb2Nlc3NDb250ZW50cykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbnNNYW5hZ2VyLkFkZE5hbWVzcGFjZShyZWFkZXIuUHJlZml4Lkxlbmd0aCA9PSAwID8gc3RyaW5nLkVtcHR5IDogcmVhZGVyLkxvY2FsTmFtZSwgcmVhZGVyLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgICAgICBSZWYuRXF1YWwob2JqZWN0TnMsIFNjaGVtYU5hbWVzLlFuRHREdC5OYW1lc3BhY2UpICYmDQogICAgICAgICAgICAgICAgICAgICAgICBSZWYuRXF1YWwob2JqZWN0TmFtZSwgU2NoZW1hTmFtZXMuUW5EdER0Lk5hbWUpDQogICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLlNjaGVtYVR5cGVPYmplY3QgPSBYbWxTY2hlbWFEYXRhdHlwZS5Gcm9tWGRyTmFtZShyZWFkZXIuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSB3aGlsZSAocmVhZGVyLk1vdmVUb05leHRBdHRyaWJ1dGUoKSk7DQogICAgICAgICAgICAgICAgcmVhZGVyLk1vdmVUb0VsZW1lbnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFNjaGVtYUVsZW1lbnREZWNsIGVsZW1lbnREZWNsID0gc2NoZW1hSW5mby5HZXRFbGVtZW50RGVjbChlbGVtZW50TmFtZSk7DQogICAgICAgICAgICBpZiAoZWxlbWVudERlY2wgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hSW5mby5UYXJnZXROYW1lc3BhY2VzLkNvbnRhaW5zS2V5KGNvbnRleHQuTmFtZXNwYWNlKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1VuZGVjbGFyZWRFbGVtZW50LCBYbWxTY2hlbWFWYWxpZGF0b3IuUU5hbWVTdHJpbmcoY29udGV4dC5Mb2NhbE5hbWUsIGNvbnRleHQuTmFtZXNwYWNlKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnREZWNsOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFZhbGlkYXRlU3RhcnRFbGVtZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5FbGVtZW50RGVjbC5TY2hlbWFUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZWFkZXIuU2NoZW1hVHlwZU9iamVjdCA9IGNvbnRleHQuRWxlbWVudERlY2wuU2NoZW1hVHlwZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLlNjaGVtYVR5cGVPYmplY3QgPSBjb250ZXh0LkVsZW1lbnREZWNsLkRhdGF0eXBlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAocmVhZGVyLklzRW1wdHlFbGVtZW50ICYmICFjb250ZXh0LklzTmlsbCAmJiBjb250ZXh0LkVsZW1lbnREZWNsLkRlZmF1bHRWYWx1ZVR5cGVkICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZWFkZXIuVHlwZWRWYWx1ZU9iamVjdCA9IGNvbnRleHQuRWxlbWVudERlY2wuRGVmYXVsdFZhbHVlVHlwZWQ7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuSXNOaWxsID0gdHJ1ZTsgLy8gcmV1c2luZyBJc05pbGwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udGV4dC5FbGVtZW50RGVjbC5IYXNSZXF1aXJlZEF0dHJpYnV0ZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9hdHRQcmVzZW5jZS5DbGVhcigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHJlYWRlci5Nb3ZlVG9GaXJzdEF0dHJpYnV0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGRvDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoKG9iamVjdClyZWFkZXIuTmFtZXNwYWNlVVJJID09IChvYmplY3QpU2NoZW1hTmFtZXMuTnNYbWxOcykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLlNjaGVtYVR5cGVPYmplY3QgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgU2NoZW1hQXR0RGVmIGF0dG5EZWYgPSBzY2hlbWFJbmZvLkdldEF0dHJpYnV0ZVhkcihjb250ZXh0LkVsZW1lbnREZWNsLCBRdWFsaWZpZWROYW1lKHJlYWRlci5Mb2NhbE5hbWUsIHJlYWRlci5OYW1lc3BhY2VVUkkpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRuRGVmICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wgIT0gbnVsbCAmJiBjb250ZXh0LkVsZW1lbnREZWNsLkhhc1JlcXVpcmVkQXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2F0dFByZXNlbmNlLkFkZChhdHRuRGVmLk5hbWUsIGF0dG5EZWYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuU2NoZW1hVHlwZU9iamVjdCA9IChhdHRuRGVmLlNjaGVtYVR5cGUgIT0gbnVsbCkgPyAob2JqZWN0KWF0dG5EZWYuU2NoZW1hVHlwZSA6IChvYmplY3QpYXR0bkRlZi5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0bkRlZi5EYXRhdHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGF0dHJpYnV0ZVZhbHVlID0gcmVhZGVyLlZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuZWVkIHRvIGNoZWNrIHRoZSBjb250ZW50cyBvZiB0aGlzIGF0dHJpYnV0ZSB0byBtYWtlIHN1cmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgaXMgdmFsaWQgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlIHR5cGUuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoZWNrVmFsdWUoYXR0cmlidXRlVmFsdWUsIGF0dG5EZWYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hRXhjZXB0aW9uIGUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGUuU2V0U291cmNlKHJlYWRlci5CYXNlVVJJLCBQb3NpdGlvbkluZm8uTGluZU51bWJlciwgUG9zaXRpb25JbmZvLkxpbmVQb3NpdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSB3aGlsZSAocmVhZGVyLk1vdmVUb05leHRBdHRyaWJ1dGUoKSk7DQogICAgICAgICAgICAgICAgcmVhZGVyLk1vdmVUb0VsZW1lbnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBWYWxpZGF0ZUVuZFN0YXJ0RWxlbWVudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChjb250ZXh0LkVsZW1lbnREZWNsLkhhc0RlZmF1bHRBdHRyaWJ1dGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb250ZXh0LkVsZW1lbnREZWNsLkRlZmF1bHRBdHREZWZzLkNvdW50OyArK2kpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZWFkZXIuQWRkRGVmYXVsdEF0dHJpYnV0ZSgoU2NoZW1hQXR0RGVmKWNvbnRleHQuRWxlbWVudERlY2wuRGVmYXVsdEF0dERlZnNbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChjb250ZXh0LkVsZW1lbnREZWNsLkhhc1JlcXVpcmVkQXR0cmlidXRlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5FbGVtZW50RGVjbC5DaGVja0F0dHJpYnV0ZXMoX2F0dFByZXNlbmNlLCByZWFkZXIuU3RhbmRBbG9uZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChYbWxTY2hlbWFFeGNlcHRpb24gZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGUuU2V0U291cmNlKHJlYWRlci5CYXNlVVJJLCBQb3NpdGlvbkluZm8uTGluZU51bWJlciwgUG9zaXRpb25JbmZvLkxpbmVQb3NpdGlvbik7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wuRGF0YXR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjaGVja0RhdGF0eXBlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBoYXNTaWJsaW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgdGV4dFN0cmluZyA9IHN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgICAgICB0ZXh0VmFsdWUuTGVuZ3RoID0gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBMb2FkU2NoZW1hRnJvbUxvY2F0aW9uKHN0cmluZyB1cmkpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIGlzIHgtc2NoZW1hDQogICAgICAgICAgICBpZiAoIVhkckJ1aWxkZXIuSXNYZHJTY2hlbWEodXJpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdHJpbmcgdXJsID0gdXJpLlN1YnN0cmluZyh4X3NjaGVtYS5MZW5ndGgpOw0KICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IG51bGw7DQogICAgICAgICAgICBTY2hlbWFJbmZvIHhkclNjaGVtYSA9IG51bGw7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVcmkgcnVyaSA9IHRoaXMuWG1sUmVzb2x2ZXIuUmVzb2x2ZVVyaShCYXNlVXJpLCB1cmwpOw0KICAgICAgICAgICAgICAgIFN0cmVhbSBzdG0gPSAoU3RyZWFtKXRoaXMuWG1sUmVzb2x2ZXIuR2V0RW50aXR5KHJ1cmksIG51bGwsIG51bGwpOw0KICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyBYbWxUZXh0UmVhZGVyKHJ1cmkuVG9TdHJpbmcoKSwgc3RtLCBOYW1lVGFibGUpOw0KICAgICAgICAgICAgICAgICgoWG1sVGV4dFJlYWRlcilyZWFkZXIpLlhtbFJlc29sdmVyID0gdGhpcy5YbWxSZXNvbHZlcjsNCiAgICAgICAgICAgICAgICBQYXJzZXIgcGFyc2VyID0gbmV3IFBhcnNlcihTY2hlbWFUeXBlLlhEUiwgTmFtZVRhYmxlLCBTY2hlbWFOYW1lcywgRXZlbnRIYW5kbGVyKTsNCiAgICAgICAgICAgICAgICBwYXJzZXIuWG1sUmVzb2x2ZXIgPSB0aGlzLlhtbFJlc29sdmVyOw0KICAgICAgICAgICAgICAgIHBhcnNlci5QYXJzZShyZWFkZXIsIHVyaSk7DQogICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5SZWFkKCkpIDsvLyB3ZWxsZm9ybW5lc3MgY2hlY2sNCiAgICAgICAgICAgICAgICB4ZHJTY2hlbWEgPSBwYXJzZXIuWGRyU2NoZW1hOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbFNjaGVtYUV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0Nhbm5vdExvYWRTY2hlbWEsIG5ldyBzdHJpbmdbXSB7IHVyaSwgZS5NZXNzYWdlIH0sIFhtbFNldmVyaXR5VHlwZS5FcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfQ2Fubm90TG9hZFNjaGVtYSwgbmV3IHN0cmluZ1tdIHsgdXJpLCBlLk1lc3NhZ2UgfSwgWG1sU2V2ZXJpdHlUeXBlLldhcm5pbmcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChyZWFkZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJlYWRlci5DbG9zZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh4ZHJTY2hlbWEgIT0gbnVsbCAmJiB4ZHJTY2hlbWEuRXJyb3JDb3VudCA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNjaGVtYUluZm8uQWRkKHhkclNjaGVtYSwgRXZlbnRIYW5kbGVyKTsNCiAgICAgICAgICAgICAgICBTY2hlbWFDb2xsZWN0aW9uLkFkZCh1cmksIHhkclNjaGVtYSwgbnVsbCwgZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIExvYWRTY2hlbWEoc3RyaW5nIHVyaSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHRoaXMuc2NoZW1hSW5mby5UYXJnZXROYW1lc3BhY2VzLkNvbnRhaW5zS2V5KHVyaSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHRoaXMuWG1sUmVzb2x2ZXIgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFNjaGVtYUluZm8gc2NoZW1hSW5mbyA9IG51bGw7DQogICAgICAgICAgICBpZiAoU2NoZW1hQ29sbGVjdGlvbiAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHNjaGVtYUluZm8gPSBTY2hlbWFDb2xsZWN0aW9uLkdldFNjaGVtYUluZm8odXJpKTsNCiAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8uU2NoZW1hVHlwZSAhPSBTY2hlbWFUeXBlLlhEUikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBYbWxFeGNlcHRpb24oU1IuWG1sX011bHRpcGxlVmFsaWRhaXRvblR5cGVzLCBzdHJpbmcuRW1wdHksIHRoaXMuUG9zaXRpb25JbmZvLkxpbmVOdW1iZXIsIHRoaXMuUG9zaXRpb25JbmZvLkxpbmVQb3NpdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1hSW5mby5BZGQoc2NoZW1hSW5mbywgRXZlbnRIYW5kbGVyKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBMb2FkU2NoZW1hRnJvbUxvY2F0aW9uKHVyaSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGJvb2wgSGFzU2NoZW1hIHsgZ2V0IHsgcmV0dXJuIHNjaGVtYUluZm8uU2NoZW1hVHlwZSAhPSBTY2hlbWFUeXBlLk5vbmU7IH0gfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIFByZXNlcnZlV2hpdGVzcGFjZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gY29udGV4dC5FbGVtZW50RGVjbCAhPSBudWxsID8gY29udGV4dC5FbGVtZW50RGVjbC5Db250ZW50VmFsaWRhdG9yLlByZXNlcnZlV2hpdGVzcGFjZSA6IGZhbHNlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgUHJvY2Vzc1Rva2VuaXplZFR5cGUoDQogICAgICAgICAgICBYbWxUb2tlbml6ZWRUeXBlIHR0eXBlLA0KICAgICAgICAgICAgc3RyaW5nIG5hbWUNCiAgICAgICAgKQ0KICAgICAgICB7DQogICAgICAgICAgICBzd2l0Y2ggKHR0eXBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgWG1sVG9rZW5pemVkVHlwZS5JRDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRJZChuYW1lKSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9EdXBJZCwgbmFtZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBBZGRJRChuYW1lLCBjb250ZXh0LkxvY2FsTmFtZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBYbWxUb2tlbml6ZWRUeXBlLklEUkVGOg0KICAgICAgICAgICAgICAgICAgICBvYmplY3QgcCA9IEZpbmRJZChuYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHAgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgeyAvLyBhZGQgaXQgdG8gbGlua2VkIGxpc3QgdG8gY2hlY2sgaXQgbGF0ZXINCiAgICAgICAgICAgICAgICAgICAgICAgIF9pZFJlZkxpc3RIZWFkID0gbmV3IElkUmVmTm9kZShfaWRSZWZMaXN0SGVhZCwgbmFtZSwgdGhpcy5Qb3NpdGlvbkluZm8uTGluZU51bWJlciwgdGhpcy5Qb3NpdGlvbkluZm8uTGluZVBvc2l0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFhtbFRva2VuaXplZFR5cGUuRU5USVRZOg0KICAgICAgICAgICAgICAgICAgICBQcm9jZXNzRW50aXR5KHNjaGVtYUluZm8sIG5hbWUsIHRoaXMsIEV2ZW50SGFuZGxlciwgcmVhZGVyLkJhc2VVUkksIFBvc2l0aW9uSW5mby5MaW5lTnVtYmVyLCBQb3NpdGlvbkluZm8uTGluZVBvc2l0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIENvbXBsZXRlVmFsaWRhdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChIYXNTY2hlbWEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ2hlY2tGb3J3YXJkUmVmcygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQobmV3IFhtbFNjaGVtYUV4Y2VwdGlvbihTUi5YbWxfTm9WYWxpZGF0aW9uLCBzdHJpbmcuRW1wdHkpLCBYbWxTZXZlcml0eVR5cGUuV2FybmluZyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIHByaXZhdGUgdm9pZCBDaGVja1ZhbHVlKA0KICAgICAgICAgICAgc3RyaW5nIHZhbHVlLA0KICAgICAgICAgICAgU2NoZW1hQXR0RGVmIGF0dGRlZg0KICAgICAgICApDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlYWRlci5UeXBlZFZhbHVlT2JqZWN0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICBib29sIGlzQXR0biA9IGF0dGRlZiAhPSBudWxsOw0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYURhdGF0eXBlIGR0eXBlID0gaXNBdHRuID8gYXR0ZGVmLkRhdGF0eXBlIDogY29udGV4dC5FbGVtZW50RGVjbC5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICBpZiAoZHR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gbm8gcmVhc29uIHRvIGNoZWNrDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGR0eXBlLlRva2VuaXplZFR5cGUgIT0gWG1sVG9rZW5pemVkVHlwZS5DREFUQSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuVHJpbSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodmFsdWUuTGVuZ3RoID09IDApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIGRvbid0IG5lZWQgdG8gY2hlY2sNCiAgICAgICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgICAgIG9iamVjdCB0eXBlZFZhbHVlID0gZHR5cGUuUGFyc2VWYWx1ZSh2YWx1ZSwgTmFtZVRhYmxlLCBfbnNNYW5hZ2VyKTsNCiAgICAgICAgICAgICAgICByZWFkZXIuVHlwZWRWYWx1ZU9iamVjdCA9IHR5cGVkVmFsdWU7DQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgc3BlY2lhbCB0eXBlcw0KICAgICAgICAgICAgICAgIFhtbFRva2VuaXplZFR5cGUgdHR5cGUgPSBkdHlwZS5Ub2tlbml6ZWRUeXBlOw0KICAgICAgICAgICAgICAgIGlmICh0dHlwZSA9PSBYbWxUb2tlbml6ZWRUeXBlLkVOVElUWSB8fCB0dHlwZSA9PSBYbWxUb2tlbml6ZWRUeXBlLklEIHx8IHR0eXBlID09IFhtbFRva2VuaXplZFR5cGUuSURSRUYpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoZHR5cGUuVmFyaWV0eSA9PSBYbWxTY2hlbWFEYXRhdHlwZVZhcmlldHkuTGlzdCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nW10gc3MgPSAoc3RyaW5nW10pdHlwZWRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3MuTGVuZ3RoOyArK2kpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvY2Vzc1Rva2VuaXplZFR5cGUoZHR5cGUuVG9rZW5pemVkVHlwZSwgc3NbaV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgUHJvY2Vzc1Rva2VuaXplZFR5cGUoZHR5cGUuVG9rZW5pemVkVHlwZSwgKHN0cmluZyl0eXBlZFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIFNjaGVtYURlY2xCYXNlIGRlY2wgPSBpc0F0dG4gPyAoU2NoZW1hRGVjbEJhc2UpYXR0ZGVmIDogKFNjaGVtYURlY2xCYXNlKWNvbnRleHQuRWxlbWVudERlY2w7DQoNCiAgICAgICAgICAgICAgICBpZiAoZGVjbC5NYXhMZW5ndGggIT0gdWludC5NYXhWYWx1ZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5MZW5ndGggPiBkZWNsLk1heExlbmd0aCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfTWF4TGVuZ3RoQ29uc3RyYWludEZhaWxlZCwgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChkZWNsLk1pbkxlbmd0aCAhPSB1aW50Lk1heFZhbHVlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLkxlbmd0aCA8IGRlY2wuTWluTGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9NaW5MZW5ndGhDb25zdHJhaW50RmFpbGVkLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGRlY2wuVmFsdWVzICE9IG51bGwgJiYgIWRlY2wuQ2hlY2tFbnVtZXJhdGlvbih0eXBlZFZhbHVlKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChkdHlwZS5Ub2tlbml6ZWRUeXBlID09IFhtbFRva2VuaXplZFR5cGUuTk9UQVRJT04pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX05vdGF0aW9uVmFsdWUsIHR5cGVkVmFsdWUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9FbnVtZXJhdGlvblZhbHVlLCB0eXBlZFZhbHVlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghZGVjbC5DaGVja1ZhbHVlKHR5cGVkVmFsdWUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQXR0bikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRml4ZWRBdHRyaWJ1dGVWYWx1ZSwgYXR0ZGVmLk5hbWUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9GaXhlZEVsZW1lbnRWYWx1ZSwgWG1sU2NoZW1hVmFsaWRhdG9yLlFOYW1lU3RyaW5nKGNvbnRleHQuTG9jYWxOYW1lLCBjb250ZXh0Lk5hbWVzcGFjZSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbFNjaGVtYUV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoYXR0ZGVmICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9BdHRyaWJ1dGVWYWx1ZURhdGFUeXBlLCBhdHRkZWYuTmFtZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRWxlbWVudFZhbHVlRGF0YVR5cGUsIFhtbFNjaGVtYVZhbGlkYXRvci5RTmFtZVN0cmluZyhjb250ZXh0LkxvY2FsTmFtZSwgY29udGV4dC5OYW1lc3BhY2UpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQ2hlY2tEZWZhdWx0VmFsdWUoDQogICAgICAgICAgICBzdHJpbmcgdmFsdWUsDQogICAgICAgICAgICBTY2hlbWFBdHREZWYgYXR0ZGVmLA0KICAgICAgICAgICAgU2NoZW1hSW5mbyBzaW5mbywNCiAgICAgICAgICAgIFhtbE5hbWVzcGFjZU1hbmFnZXIgbnNNYW5hZ2VyLA0KICAgICAgICAgICAgWG1sTmFtZVRhYmxlIE5hbWVUYWJsZSwNCiAgICAgICAgICAgIG9iamVjdCBzZW5kZXIsDQogICAgICAgICAgICBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIGV2ZW50aGFuZGxlciwNCiAgICAgICAgICAgIHN0cmluZyBiYXNlVXJpLA0KICAgICAgICAgICAgaW50IGxpbmVObywNCiAgICAgICAgICAgIGludCBsaW5lUG9zDQogICAgICAgICkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZHR5cGUgPSBhdHRkZWYuRGF0YXR5cGU7DQogICAgICAgICAgICAgICAgaWYgKGR0eXBlID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIG5vIHJlYXNvbiB0byBjaGVjaw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChkdHlwZS5Ub2tlbml6ZWRUeXBlICE9IFhtbFRva2VuaXplZFR5cGUuQ0RBVEEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLlRyaW0oKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLkxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBkb24ndCBuZWVkIHRvIGNoZWNrDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG9iamVjdCB0eXBlZFZhbHVlID0gZHR5cGUuUGFyc2VWYWx1ZSh2YWx1ZSwgTmFtZVRhYmxlLCBuc01hbmFnZXIpOw0KDQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgc3BlY2lhbCB0eXBlcw0KICAgICAgICAgICAgICAgIFhtbFRva2VuaXplZFR5cGUgdHR5cGUgPSBkdHlwZS5Ub2tlbml6ZWRUeXBlOw0KICAgICAgICAgICAgICAgIGlmICh0dHlwZSA9PSBYbWxUb2tlbml6ZWRUeXBlLkVOVElUWSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChkdHlwZS5WYXJpZXR5ID09IFhtbFNjaGVtYURhdGF0eXBlVmFyaWV0eS5MaXN0KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBzcyA9IChzdHJpbmdbXSl0eXBlZFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzcy5MZW5ndGg7ICsraSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNzRW50aXR5KHNpbmZvLCBzc1tpXSwgc2VuZGVyLCBldmVudGhhbmRsZXIsIGJhc2VVcmksIGxpbmVObywgbGluZVBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNzRW50aXR5KHNpbmZvLCAoc3RyaW5nKXR5cGVkVmFsdWUsIHNlbmRlciwgZXZlbnRoYW5kbGVyLCBiYXNlVXJpLCBsaW5lTm8sIGxpbmVQb3MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR0eXBlID09IFhtbFRva2VuaXplZFR5cGUuRU5VTUVSQVRJT04pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIWF0dGRlZi5DaGVja0VudW1lcmF0aW9uKHR5cGVkVmFsdWUpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFFeGNlcHRpb24gZSA9IG5ldyBYbWxTY2hlbWFFeGNlcHRpb24oU1IuU2NoX0VudW1lcmF0aW9uVmFsdWUsIHR5cGVkVmFsdWUuVG9TdHJpbmcoKSwgYmFzZVVyaSwgbGluZU5vLCBsaW5lUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudGhhbmRsZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudGhhbmRsZXIoc2VuZGVyLCBuZXcgVmFsaWRhdGlvbkV2ZW50QXJncyhlKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBhdHRkZWYuRGVmYXVsdFZhbHVlVHlwZWQgPSB0eXBlZFZhbHVlOw0KICAgICAgICAgICAgfQ0KI2lmIERFQlVHDQogICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIERlYnVnLldyaXRlTGluZUlmKERpYWdub3N0aWNzU3dpdGNoZXMuWG1sU2NoZW1hLlRyYWNlRXJyb3IsIGV4Lk1lc3NhZ2UpOw0KI2Vsc2UNCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFFeGNlcHRpb24gZSA9IG5ldyBYbWxTY2hlbWFFeGNlcHRpb24oU1IuU2NoX0F0dHJpYnV0ZURlZmF1bHREYXRhVHlwZSwgYXR0ZGVmLk5hbWUuVG9TdHJpbmcoKSwgYmFzZVVyaSwgbGluZU5vLCBsaW5lUG9zKTsNCiAgICAgICAgICAgICAgICBpZiAoZXZlbnRoYW5kbGVyICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBldmVudGhhbmRsZXIoc2VuZGVyLCBuZXcgVmFsaWRhdGlvbkV2ZW50QXJncyhlKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgdm9pZCBBZGRJRChzdHJpbmcgbmFtZSwgb2JqZWN0IG5vZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIE5vdGU6IEl0IHVzZWQgdG8gYmUgdHJ1ZSB0aGF0IHdlIG9ubHkgY2FsbGVkIHRoaXMgaWYgX2ZWYWxpZGF0ZSB3YXMgdHJ1ZSwNCiAgICAgICAgICAgIC8vIGJ1dCBkdWUgdG8gdGhlIGZhY3QgdGhhdCB5b3UgY2FuIG5vdyBkeW5hbWljYWxseSB0eXBlIHNvbWV0aGlnbiBhcyBhbiBJRA0KICAgICAgICAgICAgLy8gdGhhdCBpcyBubyBsb25nZXIgdHJ1ZS4NCiAgICAgICAgICAgIGlmIChfSURzID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX0lEcyA9IG5ldyBIYXNodGFibGUoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgX0lEcy5BZGQobmFtZSwgbm9kZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgb2JqZWN0IEZpbmRJZChzdHJpbmcgbmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIF9JRHMgPT0gbnVsbCA/IG51bGwgOiBfSURzW25hbWVdOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFB1c2goWG1sUXVhbGlmaWVkTmFtZSBlbGVtZW50TmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgY29udGV4dCA9IChWYWxpZGF0aW9uU3RhdGUpX3ZhbGlkYXRpb25TdGFjay5QdXNoKCk7DQogICAgICAgICAgICBpZiAoY29udGV4dCA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbnRleHQgPSBuZXcgVmFsaWRhdGlvblN0YXRlKCk7DQogICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25TdGFjay5BZGRUb1RvcChjb250ZXh0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnRleHQuTG9jYWxOYW1lID0gZWxlbWVudE5hbWUuTmFtZTsNCiAgICAgICAgICAgIGNvbnRleHQuTmFtZXNwYWNlID0gZWxlbWVudE5hbWUuTmFtZXNwYWNlOw0KICAgICAgICAgICAgY29udGV4dC5IYXNNYXRjaGVkID0gZmFsc2U7DQogICAgICAgICAgICBjb250ZXh0LklzTmlsbCA9IGZhbHNlOw0KICAgICAgICAgICAgY29udGV4dC5OZWVkVmFsaWRhdGVDaGlsZHJlbiA9IGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFBvcCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChfdmFsaWRhdGlvblN0YWNrLkxlbmd0aCA+IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25TdGFjay5Qb3AoKTsNCiAgICAgICAgICAgICAgICBjb250ZXh0ID0gKFZhbGlkYXRpb25TdGF0ZSlfdmFsaWRhdGlvblN0YWNrLlBlZWsoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBDaGVja0ZvcndhcmRSZWZzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSWRSZWZOb2RlIG5leHQgPSBfaWRSZWZMaXN0SGVhZDsNCiAgICAgICAgICAgIHdoaWxlIChuZXh0ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKEZpbmRJZChuZXh0LklkKSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChuZXcgWG1sU2NoZW1hRXhjZXB0aW9uKFNSLlNjaF9VbmRlY2xhcmVkSWQsIG5leHQuSWQsIHJlYWRlci5CYXNlVVJJLCBuZXh0LkxpbmVObywgbmV4dC5MaW5lUG9zKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIElkUmVmTm9kZSBwdHIgPSBuZXh0Lk5leHQ7DQogICAgICAgICAgICAgICAgbmV4dC5OZXh0ID0gbnVsbDsgLy8gdW5ob29rIGVhY2ggb2JqZWN0IHNvIGl0IGlzIGNsZWFuZWQgdXAgYnkgR2FyYmFnZSBDb2xsZWN0b3INCiAgICAgICAgICAgICAgICBuZXh0ID0gcHRyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gbm90IG5lZWRlZCBhbnkgbW9yZS4NCiAgICAgICAgICAgIF9pZFJlZkxpc3RIZWFkID0gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgWG1sUXVhbGlmaWVkTmFtZSBRdWFsaWZpZWROYW1lKHN0cmluZyBuYW1lLCBzdHJpbmcgbnMpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgWG1sUXVhbGlmaWVkTmFtZShuYW1lLCBYbWxTY2hlbWFEYXRhdHlwZS5YZHJDYW5vbml6ZVVyaShucywgTmFtZVRhYmxlLCBTY2hlbWFOYW1lcykpOw0KICAgICAgICB9DQogICAgfTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDYxOA0KfQ0KDQo="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XmlSchema.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlNjaGVtYQ0Kew0KICAgIHVzaW5nIFN5c3RlbS5JTzsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnM7DQogICAgdXNpbmcgU3lzdGVtLkNvbXBvbmVudE1vZGVsOw0KICAgIHVzaW5nIFN5c3RlbS5YbWwuU2VyaWFsaXphdGlvbjsNCiAgICB1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KICAgIHVzaW5nIFN5c3RlbS5EaWFnbm9zdGljczsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsNCg0KICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hIl0vKicgLz4NCiAgICAvLy8gPGRldmRvYz4NCiAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgLy8vIDwvZGV2ZG9jPg0KICAgIFtYbWxSb290KCJzY2hlbWEiLCBOYW1lc3BhY2UgPSBYbWxTY2hlbWEuTmFtZXNwYWNlKV0NCiAgICBwdWJsaWMgY2xhc3MgWG1sU2NoZW1hIDogWG1sU2NoZW1hT2JqZWN0DQogICAgew0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5OYW1lc3BhY2UiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBjb25zdCBzdHJpbmcgTmFtZXNwYWNlID0gWG1sUmVzZXJ2ZWROcy5Oc1hzOw0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5JbnN0YW5jZU5hbWVzcGFjZSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIGNvbnN0IHN0cmluZyBJbnN0YW5jZU5hbWVzcGFjZSA9IFhtbFJlc2VydmVkTnMuTnNYc2k7DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFGb3JtIF9hdHRyaWJ1dGVGb3JtRGVmYXVsdCA9IFhtbFNjaGVtYUZvcm0uTm9uZTsNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFGb3JtIF9lbGVtZW50Rm9ybURlZmF1bHQgPSBYbWxTY2hlbWFGb3JtLk5vbmU7DQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZCBfYmxvY2tEZWZhdWx0ID0gWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5Ob25lOw0KICAgICAgICBwcml2YXRlIFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QgX2ZpbmFsRGVmYXVsdCA9IFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QuTm9uZTsNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX3RhcmdldE5zOw0KICAgICAgICBwcml2YXRlIHN0cmluZyBfdmVyc2lvbjsNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFPYmplY3RDb2xsZWN0aW9uIF9pbmNsdWRlcyA9IG5ldyBYbWxTY2hlbWFPYmplY3RDb2xsZWN0aW9uKCk7DQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hT2JqZWN0Q29sbGVjdGlvbiBfaXRlbXMgPSBuZXcgWG1sU2NoZW1hT2JqZWN0Q29sbGVjdGlvbigpOw0KICAgICAgICBwcml2YXRlIHN0cmluZyBfaWQ7DQogICAgICAgIHByaXZhdGUgWG1sQXR0cmlidXRlW10gX21vcmVBdHRyaWJ1dGVzOw0KDQogICAgICAgIC8vIGNvbXBpbGVkIGluZm8NCiAgICAgICAgcHJpdmF0ZSBib29sIF9pc0NvbXBpbGVkID0gZmFsc2U7DQogICAgICAgIHByaXZhdGUgYm9vbCBfaXNDb21waWxlZEJ5U2V0ID0gZmFsc2U7DQogICAgICAgIHByaXZhdGUgYm9vbCBfaXNQcmVwcm9jZXNzZWQgPSBmYWxzZTsNCiAgICAgICAgcHJpdmF0ZSBib29sIF9pc1JlZGVmaW5lZCA9IGZhbHNlOw0KICAgICAgICBwcml2YXRlIGludCBfZXJyb3JDb3VudCA9IDA7DQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hT2JqZWN0VGFibGUgX2F0dHJpYnV0ZXM7DQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hT2JqZWN0VGFibGUgX2F0dHJpYnV0ZUdyb3VwcyA9IG5ldyBYbWxTY2hlbWFPYmplY3RUYWJsZSgpOw0KICAgICAgICBwcml2YXRlIFhtbFNjaGVtYU9iamVjdFRhYmxlIF9lbGVtZW50cyA9IG5ldyBYbWxTY2hlbWFPYmplY3RUYWJsZSgpOw0KICAgICAgICBwcml2YXRlIFhtbFNjaGVtYU9iamVjdFRhYmxlIF90eXBlcyA9IG5ldyBYbWxTY2hlbWFPYmplY3RUYWJsZSgpOw0KICAgICAgICBwcml2YXRlIFhtbFNjaGVtYU9iamVjdFRhYmxlIF9ncm91cHMgPSBuZXcgWG1sU2NoZW1hT2JqZWN0VGFibGUoKTsNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFPYmplY3RUYWJsZSBfbm90YXRpb25zID0gbmV3IFhtbFNjaGVtYU9iamVjdFRhYmxlKCk7DQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hT2JqZWN0VGFibGUgX2lkZW50aXR5Q29uc3RyYWludHMgPSBuZXcgWG1sU2NoZW1hT2JqZWN0VGFibGUoKTsNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBpbnQgc19nbG9iYWxJZENvdW50ZXIgPSAtMTsNCiAgICAgICAgcHJpdmF0ZSBBcnJheUxpc3QgX2ltcG9ydGVkU2NoZW1hczsNCiAgICAgICAgcHJpdmF0ZSBBcnJheUxpc3QgX2ltcG9ydGVkTmFtZXNwYWNlczsNCg0KICAgICAgICBwcml2YXRlIGludCBfc2NoZW1hSWQgPSAtMTsgLy9Ob3QgYWRkZWQgdG8gYSBzZXQNCiAgICAgICAgcHJpdmF0ZSBVcmkgX2Jhc2VVcmk7DQogICAgICAgIHByaXZhdGUgYm9vbCBfaXNDaGFtZWxlb247DQogICAgICAgIHByaXZhdGUgSGFzaHRhYmxlIF9pZHMgPSBuZXcgSGFzaHRhYmxlKCk7DQogICAgICAgIHByaXZhdGUgWG1sRG9jdW1lbnQgX2RvY3VtZW50Ow0KICAgICAgICBwcml2YXRlIFhtbE5hbWVUYWJsZSBfbmFtZVRhYmxlOw0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLlhtbFNjaGVtYSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIFhtbFNjaGVtYSgpIHsgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLlJlYWQiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBzdGF0aWMgWG1sU2NoZW1hIFJlYWQoVGV4dFJlYWRlciByZWFkZXIsIFZhbGlkYXRpb25FdmVudEhhbmRsZXIgdmFsaWRhdGlvbkV2ZW50SGFuZGxlcikNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFJlYWQobmV3IFhtbFRleHRSZWFkZXIocmVhZGVyKSwgdmFsaWRhdGlvbkV2ZW50SGFuZGxlcik7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5SZWFkMSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHN0YXRpYyBYbWxTY2hlbWEgUmVhZChTdHJlYW0gc3RyZWFtLCBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIHZhbGlkYXRpb25FdmVudEhhbmRsZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBSZWFkKG5ldyBYbWxUZXh0UmVhZGVyKHN0cmVhbSksIHZhbGlkYXRpb25FdmVudEhhbmRsZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWEudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWEuUmVhZDIiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBzdGF0aWMgWG1sU2NoZW1hIFJlYWQoWG1sUmVhZGVyIHJlYWRlciwgVmFsaWRhdGlvbkV2ZW50SGFuZGxlciB2YWxpZGF0aW9uRXZlbnRIYW5kbGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxOYW1lVGFibGUgbmFtZVRhYmxlID0gcmVhZGVyLk5hbWVUYWJsZTsNCiAgICAgICAgICAgIFBhcnNlciBwYXJzZXIgPSBuZXcgUGFyc2VyKFNjaGVtYVR5cGUuWFNELCBuYW1lVGFibGUsIG5ldyBTY2hlbWFOYW1lcyhuYW1lVGFibGUpLCB2YWxpZGF0aW9uRXZlbnRIYW5kbGVyKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHBhcnNlci5QYXJzZShyZWFkZXIsIG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbFNjaGVtYUV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXZlbnRIYW5kbGVyICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uRXZlbnRIYW5kbGVyKG51bGwsIG5ldyBWYWxpZGF0aW9uRXZlbnRBcmdzKGUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlci5YbWxTY2hlbWE7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5Xcml0ZSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZvaWQgV3JpdGUoU3RyZWFtIHN0cmVhbSkNCiAgICAgICAgew0KICAgICAgICAgICAgV3JpdGUoc3RyZWFtLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLldyaXRlMSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZvaWQgV3JpdGUoU3RyZWFtIHN0cmVhbSwgWG1sTmFtZXNwYWNlTWFuYWdlciBuYW1lc3BhY2VNYW5hZ2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxUZXh0V3JpdGVyIHhtbFdyaXRlciA9IG5ldyBYbWxUZXh0V3JpdGVyKHN0cmVhbSwgbnVsbCk7DQogICAgICAgICAgICB4bWxXcml0ZXIuRm9ybWF0dGluZyA9IEZvcm1hdHRpbmcuSW5kZW50ZWQ7DQogICAgICAgICAgICBXcml0ZSh4bWxXcml0ZXIsIG5hbWVzcGFjZU1hbmFnZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWEudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWEuV3JpdGUyIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgdm9pZCBXcml0ZShUZXh0V3JpdGVyIHdyaXRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgV3JpdGUod3JpdGVyLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLldyaXRlMyJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZvaWQgV3JpdGUoVGV4dFdyaXRlciB3cml0ZXIsIFhtbE5hbWVzcGFjZU1hbmFnZXIgbmFtZXNwYWNlTWFuYWdlcikNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sVGV4dFdyaXRlciB4bWxXcml0ZXIgPSBuZXcgWG1sVGV4dFdyaXRlcih3cml0ZXIpOw0KICAgICAgICAgICAgeG1sV3JpdGVyLkZvcm1hdHRpbmcgPSBGb3JtYXR0aW5nLkluZGVudGVkOw0KICAgICAgICAgICAgV3JpdGUoeG1sV3JpdGVyLCBuYW1lc3BhY2VNYW5hZ2VyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLldyaXRlNCJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZvaWQgV3JpdGUoWG1sV3JpdGVyIHdyaXRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgV3JpdGUod3JpdGVyLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLldyaXRlNSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZvaWQgV3JpdGUoWG1sV3JpdGVyIHdyaXRlciwgWG1sTmFtZXNwYWNlTWFuYWdlciBuYW1lc3BhY2VNYW5hZ2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTZXJpYWxpemVyIHNlcmlhbGl6ZXIgPSBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoWG1sU2NoZW1hKSk7DQogICAgICAgICAgICBYbWxTZXJpYWxpemVyTmFtZXNwYWNlcyBuczsNCg0KICAgICAgICAgICAgaWYgKG5hbWVzcGFjZU1hbmFnZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBucyA9IG5ldyBYbWxTZXJpYWxpemVyTmFtZXNwYWNlcygpOw0KICAgICAgICAgICAgICAgIGJvb2wgaWdub3JlWFMgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5OYW1lc3BhY2VzICE9IG51bGwpDQogICAgICAgICAgICAgICAgeyAvL1VzZXIgbWF5IGhhdmUgc2V0IGJvdGggbnNNYW5hZ2VyIGFuZCBOYW1lc3BhY2VzIHByb3BlcnR5IG9uIHRoZSBYbWxTY2hlbWEgb2JqZWN0DQogICAgICAgICAgICAgICAgICAgIGlnbm9yZVhTID0gdGhpcy5OYW1lc3BhY2VzLk5hbWVzcGFjZXMuQ29udGFpbnNLZXkoInhzIikgfHwgdGhpcy5OYW1lc3BhY2VzLk5hbWVzcGFjZXMuQ29udGFpbnNWYWx1ZShYbWxSZXNlcnZlZE5zLk5zWHMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWlnbm9yZVhTICYmIG5hbWVzcGFjZU1hbmFnZXIuTG9va3VwUHJlZml4KFhtbFJlc2VydmVkTnMuTnNYcykgPT0gbnVsbCAmJg0KICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2VNYW5hZ2VyLkxvb2t1cE5hbWVzcGFjZSgieHMiKSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgbnMuQWRkKCJ4cyIsIFhtbFJlc2VydmVkTnMuTnNYcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyBwcmVmaXggaW4gbmFtZXNwYWNlTWFuYWdlcikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwcmVmaXggIT0gInhtbCIgJiYgcHJlZml4ICE9ICJ4bWxucyIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5zLkFkZChwcmVmaXgsIG5hbWVzcGFjZU1hbmFnZXIuTG9va3VwTmFtZXNwYWNlKHByZWZpeCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5OYW1lc3BhY2VzICE9IG51bGwgJiYgdGhpcy5OYW1lc3BhY2VzLkNvdW50ID4gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBzZXJpYWxpemVyTlMgPSB0aGlzLk5hbWVzcGFjZXMuTmFtZXNwYWNlczsNCiAgICAgICAgICAgICAgICBpZiAoIXNlcmlhbGl6ZXJOUy5Db250YWluc0tleSgieHMiKSAmJiAhc2VyaWFsaXplck5TLkNvbnRhaW5zVmFsdWUoWG1sUmVzZXJ2ZWROcy5Oc1hzKSkNCiAgICAgICAgICAgICAgICB7IC8vUHJlZml4IHhzIG5vdCBkZWZpbmVkIEFORCBzY2hlbWEgbmFtZXNwYWNlIG5vdCBhbHJlYWR5IG1hcHBlZCB0byBhIHByZWZpeA0KICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVyTlMuQWRkKCJ4cyIsIFhtbFJlc2VydmVkTnMuTnNYcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG5zID0gdGhpcy5OYW1lc3BhY2VzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG5zID0gbmV3IFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzKCk7DQogICAgICAgICAgICAgICAgbnMuQWRkKCJ4cyIsIFhtbFNjaGVtYS5OYW1lc3BhY2UpOw0KICAgICAgICAgICAgICAgIGlmIChfdGFyZ2V0TnMgIT0gbnVsbCAmJiBfdGFyZ2V0TnMuTGVuZ3RoICE9IDApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBucy5BZGQoInRucyIsIF90YXJnZXROcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2VyaWFsaXplci5TZXJpYWxpemUod3JpdGVyLCB0aGlzLCBucyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5Db21waWxlIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBbT2Jzb2xldGUoIlVzZSBTeXN0ZW0uWG1sLlNjaGVtYS5YbWxTY2hlbWFTZXQgZm9yIHNjaGVtYSBjb21waWxhdGlvbiBhbmQgdmFsaWRhdGlvbi4gaHR0cDovL2dvLm1pY3Jvc29mdC5jb20vZndsaW5rLz9saW5raWQ9MTQyMDIiKV0NCiAgICAgICAgcHVibGljIHZvaWQgQ29tcGlsZShWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIHZhbGlkYXRpb25FdmVudEhhbmRsZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIFNjaGVtYUluZm8gc0luZm8gPSBuZXcgU2NoZW1hSW5mbygpOw0KICAgICAgICAgICAgc0luZm8uU2NoZW1hVHlwZSA9IFNjaGVtYVR5cGUuWFNEOw0KICAgICAgICAgICAgQ29tcGlsZVNjaGVtYShudWxsLCBudWxsLCBzSW5mbywgbnVsbCwgdmFsaWRhdGlvbkV2ZW50SGFuZGxlciwgTmFtZVRhYmxlLCBmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5Db21waWxlcSJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgW09ic29sZXRlKCJVc2UgU3lzdGVtLlhtbC5TY2hlbWEuWG1sU2NoZW1hU2V0IGZvciBzY2hlbWEgY29tcGlsYXRpb24gYW5kIHZhbGlkYXRpb24uIGh0dHA6Ly9nby5taWNyb3NvZnQuY29tL2Z3bGluay8/bGlua2lkPTE0MjAyIildDQogICAgICAgIHB1YmxpYyB2b2lkIENvbXBpbGUoVmFsaWRhdGlvbkV2ZW50SGFuZGxlciB2YWxpZGF0aW9uRXZlbnRIYW5kbGVyLCBYbWxSZXNvbHZlciByZXNvbHZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgU2NoZW1hSW5mbyBzSW5mbyA9IG5ldyBTY2hlbWFJbmZvKCk7DQogICAgICAgICAgICBzSW5mby5TY2hlbWFUeXBlID0gU2NoZW1hVHlwZS5YU0Q7DQogICAgICAgICAgICBDb21waWxlU2NoZW1hKG51bGwsIHJlc29sdmVyLCBzSW5mbywgbnVsbCwgdmFsaWRhdGlvbkV2ZW50SGFuZGxlciwgTmFtZVRhYmxlLCBmYWxzZSk7DQogICAgICAgIH0NCg0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgNjE4DQogICAgICAgIGludGVybmFsIGJvb2wgQ29tcGlsZVNjaGVtYShYbWxTY2hlbWFDb2xsZWN0aW9uIHhzYywgWG1sUmVzb2x2ZXIgcmVzb2x2ZXIsIFNjaGVtYUluZm8gc2NoZW1hSW5mbywgc3RyaW5nIG5zLCBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIHZhbGlkYXRpb25FdmVudEhhbmRsZXIsIFhtbE5hbWVUYWJsZSBuYW1lVGFibGUsIGJvb2wgQ29tcGlsZUNvbnRlbnRNb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgLy9OZWVkIHRvIGxvY2sgaGVyZSB0byBwcmV2ZW50IG11bHRpLXRocmVhZGluZyBwcm9ibGVtcyB3aGVuIHNhbWUgc2NoZW1hIGlzIGFkZGVkIHRvIHNldCBhbmQgY29tcGlsZWQNCiAgICAgICAgICAgIGxvY2sgKHRoaXMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy9QcmVwcm9jZXNzaW5nDQogICAgICAgICAgICAgICAgU2NoZW1hQ29sbGVjdGlvblByZXByb2Nlc3NvciBwcmVwID0gbmV3IFNjaGVtYUNvbGxlY3Rpb25QcmVwcm9jZXNzb3IobmFtZVRhYmxlLCBudWxsLCB2YWxpZGF0aW9uRXZlbnRIYW5kbGVyKTsNCiAgICAgICAgICAgICAgICBwcmVwLlhtbFJlc29sdmVyID0gcmVzb2x2ZXI7DQogICAgICAgICAgICAgICAgaWYgKCFwcmVwLkV4ZWN1dGUodGhpcywgbnMsIHRydWUsIHhzYykpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy9Db21waWxhdGlvbg0KICAgICAgICAgICAgICAgIFNjaGVtYUNvbGxlY3Rpb25Db21waWxlciBjb21waWxlciA9IG5ldyBTY2hlbWFDb2xsZWN0aW9uQ29tcGlsZXIobmFtZVRhYmxlLCB2YWxpZGF0aW9uRXZlbnRIYW5kbGVyKTsNCiAgICAgICAgICAgICAgICBfaXNDb21waWxlZCA9IGNvbXBpbGVyLkV4ZWN1dGUodGhpcywgc2NoZW1hSW5mbywgQ29tcGlsZUNvbnRlbnRNb2RlbCk7DQogICAgICAgICAgICAgICAgdGhpcy5TZXRJc0NvbXBpbGVkKF9pc0NvbXBpbGVkKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2lzQ29tcGlsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDYxOA0KDQogICAgICAgIGludGVybmFsIHZvaWQgQ29tcGlsZVNjaGVtYUluU2V0KFhtbE5hbWVUYWJsZSBuYW1lVGFibGUsIFZhbGlkYXRpb25FdmVudEhhbmRsZXIgZXZlbnRIYW5kbGVyLCBYbWxTY2hlbWFDb21waWxhdGlvblNldHRpbmdzIGNvbXBpbGF0aW9uU2V0dGluZ3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIERlYnVnLkFzc2VydChfaXNQcmVwcm9jZXNzZWQpOw0KICAgICAgICAgICAgQ29tcGlsZXIgc2V0Q29tcGlsZXIgPSBuZXcgQ29tcGlsZXIobmFtZVRhYmxlLCBldmVudEhhbmRsZXIsIG51bGwsIGNvbXBpbGF0aW9uU2V0dGluZ3MpOw0KICAgICAgICAgICAgc2V0Q29tcGlsZXIuUHJlcGFyZSh0aGlzLCB0cnVlKTsNCiAgICAgICAgICAgIF9pc0NvbXBpbGVkQnlTZXQgPSBzZXRDb21waWxlci5Db21waWxlKCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5BdHRyaWJ1dGVGb3JtRGVmYXVsdCJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgW1htbEF0dHJpYnV0ZSgiYXR0cmlidXRlRm9ybURlZmF1bHQiKSwgRGVmYXVsdFZhbHVlKFhtbFNjaGVtYUZvcm0uTm9uZSldDQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWFGb3JtIEF0dHJpYnV0ZUZvcm1EZWZhdWx0DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfYXR0cmlidXRlRm9ybURlZmF1bHQ7IH0NCiAgICAgICAgICAgIHNldCB7IF9hdHRyaWJ1dGVGb3JtRGVmYXVsdCA9IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5CbG9ja0RlZmF1bHQiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIFtYbWxBdHRyaWJ1dGUoImJsb2NrRGVmYXVsdCIpLCBEZWZhdWx0VmFsdWUoWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZC5Ob25lKV0NCiAgICAgICAgcHVibGljIFhtbFNjaGVtYURlcml2YXRpb25NZXRob2QgQmxvY2tEZWZhdWx0DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfYmxvY2tEZWZhdWx0OyB9DQogICAgICAgICAgICBzZXQgeyBfYmxvY2tEZWZhdWx0ID0gdmFsdWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLkZpbmFsRGVmYXVsdCJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgW1htbEF0dHJpYnV0ZSgiZmluYWxEZWZhdWx0IiksIERlZmF1bHRWYWx1ZShYbWxTY2hlbWFEZXJpdmF0aW9uTWV0aG9kLk5vbmUpXQ0KICAgICAgICBwdWJsaWMgWG1sU2NoZW1hRGVyaXZhdGlvbk1ldGhvZCBGaW5hbERlZmF1bHQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9maW5hbERlZmF1bHQ7IH0NCiAgICAgICAgICAgIHNldCB7IF9maW5hbERlZmF1bHQgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWEudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWEuRWxlbWVudEZvcm1EZWZhdWx0Il0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBbWG1sQXR0cmlidXRlKCJlbGVtZW50Rm9ybURlZmF1bHQiKSwgRGVmYXVsdFZhbHVlKFhtbFNjaGVtYUZvcm0uTm9uZSldDQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWFGb3JtIEVsZW1lbnRGb3JtRGVmYXVsdA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2VsZW1lbnRGb3JtRGVmYXVsdDsgfQ0KICAgICAgICAgICAgc2V0IHsgX2VsZW1lbnRGb3JtRGVmYXVsdCA9IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5UYXJnZXROYW1lc3BhY2UiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIFtYbWxBdHRyaWJ1dGUoInRhcmdldE5hbWVzcGFjZSIsIERhdGFUeXBlID0gImFueVVSSSIpXQ0KICAgICAgICBwdWJsaWMgc3RyaW5nIFRhcmdldE5hbWVzcGFjZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX3RhcmdldE5zOyB9DQogICAgICAgICAgICBzZXQgeyBfdGFyZ2V0TnMgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWEudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWEuVmVyc2lvbiJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgW1htbEF0dHJpYnV0ZSgidmVyc2lvbiIsIERhdGFUeXBlID0gInRva2VuIildDQogICAgICAgIHB1YmxpYyBzdHJpbmcgVmVyc2lvbg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX3ZlcnNpb247IH0NCiAgICAgICAgICAgIHNldCB7IF92ZXJzaW9uID0gdmFsdWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLkluY2x1ZGVzIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBbWG1sRWxlbWVudCgiaW5jbHVkZSIsIHR5cGVvZihYbWxTY2hlbWFJbmNsdWRlKSksDQogICAgICAgICBYbWxFbGVtZW50KCJpbXBvcnQiLCB0eXBlb2YoWG1sU2NoZW1hSW1wb3J0KSksDQogICAgICAgICBYbWxFbGVtZW50KCJyZWRlZmluZSIsIHR5cGVvZihYbWxTY2hlbWFSZWRlZmluZSkpXQ0KICAgICAgICBwdWJsaWMgWG1sU2NoZW1hT2JqZWN0Q29sbGVjdGlvbiBJbmNsdWRlcw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2luY2x1ZGVzOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5JdGVtcyJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgW1htbEVsZW1lbnQoImFubm90YXRpb24iLCB0eXBlb2YoWG1sU2NoZW1hQW5ub3RhdGlvbikpLA0KICAgICAgICAgWG1sRWxlbWVudCgiYXR0cmlidXRlIiwgdHlwZW9mKFhtbFNjaGVtYUF0dHJpYnV0ZSkpLA0KICAgICAgICAgWG1sRWxlbWVudCgiYXR0cmlidXRlR3JvdXAiLCB0eXBlb2YoWG1sU2NoZW1hQXR0cmlidXRlR3JvdXApKSwNCiAgICAgICAgIFhtbEVsZW1lbnQoImNvbXBsZXhUeXBlIiwgdHlwZW9mKFhtbFNjaGVtYUNvbXBsZXhUeXBlKSksDQogICAgICAgICBYbWxFbGVtZW50KCJzaW1wbGVUeXBlIiwgdHlwZW9mKFhtbFNjaGVtYVNpbXBsZVR5cGUpKSwNCiAgICAgICAgIFhtbEVsZW1lbnQoImVsZW1lbnQiLCB0eXBlb2YoWG1sU2NoZW1hRWxlbWVudCkpLA0KICAgICAgICAgWG1sRWxlbWVudCgiZ3JvdXAiLCB0eXBlb2YoWG1sU2NoZW1hR3JvdXApKSwNCiAgICAgICAgIFhtbEVsZW1lbnQoIm5vdGF0aW9uIiwgdHlwZW9mKFhtbFNjaGVtYU5vdGF0aW9uKSldDQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWFPYmplY3RDb2xsZWN0aW9uIEl0ZW1zDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaXRlbXM7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENvbXBpbGVkIGluZm8NCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWEudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWEuSXNDb21waWxlZCJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgW1htbElnbm9yZV0NCiAgICAgICAgcHVibGljIGJvb2wgSXNDb21waWxlZA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX2lzQ29tcGlsZWQgfHwgX2lzQ29tcGlsZWRCeVNldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtYbWxJZ25vcmVdDQogICAgICAgIGludGVybmFsIGJvb2wgSXNDb21waWxlZEJ5U2V0DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaXNDb21waWxlZEJ5U2V0OyB9DQogICAgICAgICAgICBzZXQgeyBfaXNDb21waWxlZEJ5U2V0ID0gdmFsdWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtYbWxJZ25vcmVdDQogICAgICAgIGludGVybmFsIGJvb2wgSXNQcmVwcm9jZXNzZWQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9pc1ByZXByb2Nlc3NlZDsgfQ0KICAgICAgICAgICAgc2V0IHsgX2lzUHJlcHJvY2Vzc2VkID0gdmFsdWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtYbWxJZ25vcmVdDQogICAgICAgIGludGVybmFsIGJvb2wgSXNSZWRlZmluZWQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9pc1JlZGVmaW5lZDsgfQ0KICAgICAgICAgICAgc2V0IHsgX2lzUmVkZWZpbmVkID0gdmFsdWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLkF0dHJpYnV0ZXMiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIFtYbWxJZ25vcmVdDQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWFPYmplY3RUYWJsZSBBdHRyaWJ1dGVzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfYXR0cmlidXRlcyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX2F0dHJpYnV0ZXMgPSBuZXcgWG1sU2NoZW1hT2JqZWN0VGFibGUoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIF9hdHRyaWJ1dGVzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWEudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWEuQXR0cmlidXRlR3JvdXBzIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICBwdWJsaWMgWG1sU2NoZW1hT2JqZWN0VGFibGUgQXR0cmlidXRlR3JvdXBzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfYXR0cmlidXRlR3JvdXBzID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfYXR0cmlidXRlR3JvdXBzID0gbmV3IFhtbFNjaGVtYU9iamVjdFRhYmxlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBfYXR0cmlidXRlR3JvdXBzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWEudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWEuU2NoZW1hVHlwZXMiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIFtYbWxJZ25vcmVdDQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWFPYmplY3RUYWJsZSBTY2hlbWFUeXBlcw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX3R5cGVzID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfdHlwZXMgPSBuZXcgWG1sU2NoZW1hT2JqZWN0VGFibGUoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIF90eXBlczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hLkVsZW1lbnRzIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICBwdWJsaWMgWG1sU2NoZW1hT2JqZWN0VGFibGUgRWxlbWVudHMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF9lbGVtZW50cyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX2VsZW1lbnRzID0gbmV3IFhtbFNjaGVtYU9iamVjdFRhYmxlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBfZWxlbWVudHM7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5JZCJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgW1htbEF0dHJpYnV0ZSgiaWQiLCBEYXRhVHlwZSA9ICJJRCIpXQ0KICAgICAgICBwdWJsaWMgc3RyaW5nIElkDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaWQ7IH0NCiAgICAgICAgICAgIHNldCB7IF9pZCA9IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5VbmhhbmRsZWRBdHRyaWJ1dGVzIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBbWG1sQW55QXR0cmlidXRlXQ0KICAgICAgICBwdWJsaWMgWG1sQXR0cmlidXRlW10gVW5oYW5kbGVkQXR0cmlidXRlcw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX21vcmVBdHRyaWJ1dGVzOyB9DQogICAgICAgICAgICBzZXQgeyBfbW9yZUF0dHJpYnV0ZXMgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWEudWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWEuR3JvdXBzIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICBwdWJsaWMgWG1sU2NoZW1hT2JqZWN0VGFibGUgR3JvdXBzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfZ3JvdXBzOyB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYS51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYS5Ob3RhdGlvbnMiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIFtYbWxJZ25vcmVdDQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWFPYmplY3RUYWJsZSBOb3RhdGlvbnMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9ub3RhdGlvbnM7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtYbWxJZ25vcmVdDQogICAgICAgIGludGVybmFsIFhtbFNjaGVtYU9iamVjdFRhYmxlIElkZW50aXR5Q29uc3RyYWludHMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9pZGVudGl0eUNvbnN0cmFpbnRzOyB9DQogICAgICAgIH0NCg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICBpbnRlcm5hbCBVcmkgQmFzZVVyaQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2Jhc2VVcmk7IH0NCiAgICAgICAgICAgIHNldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9iYXNlVXJpID0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICAvLyBQbGVhc2UgYmUgY2FyZWZ1bCB3aXRoIHRoaXMgcHJvcGVydHkuIFNpbmNlIGl0IGxhenkgaW5pdGlhbGl6ZWQgYW5kIGl0cyB2YWx1ZSBkZXBlbmRzIG9uIGEgZ2xvYmFsIHN0YXRlDQogICAgICAgIC8vICAgaWYgaXQgZ2V0cyBjYWxsZWQgb24gbXVsdGlwbGUgc2NoZW1hcyBpbiBhIGRpZmZlcmVudCBvcmRlciB0aGUgc2NoZW1hcyB3aWxsIGVuZCB1cCB3aXRoIGRpZmZlcmVudCBJRHMNCiAgICAgICAgLy8gICBVbmZvcnR1bmF0ZWx5IHRoZSBJRHMgYXJlIHVzZWQgdG8gc29ydCB0aGUgc2NoZW1hcyBpbiB0aGUgc2NoZW1hIHNldCBhbmQgdGh1cyBjaGFuZ2luZyB0aGUgSURzIG1pZ2h0IGNoYW5nZQ0KICAgICAgICAvLyAgIHRoZSBvcmRlciB3aGljaCB3b3VsZCBiZSBhIGJyZWFraW5nIGNoYW5nZSEhDQogICAgICAgIC8vIFNpbXBseSBwdXQgaWYgeW91IGFyZSBwbGFubmluZyB0byBhZGQgb3IgcmVtb3ZlIGEgY2FsbCB0byB0aGlzIGdldHRlciB5b3UgbmVlZCB0byBiZSBleHRyYSBjYXJlZnVsbA0KICAgICAgICAvLyAgIG9yIGJldHRlciBkb24ndCBkbyBpdCBhdCBhbGwuDQogICAgICAgIGludGVybmFsIGludCBTY2hlbWFJZA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX3NjaGVtYUlkID09IC0xKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX3NjaGVtYUlkID0gSW50ZXJsb2NrZWQuSW5jcmVtZW50KHJlZiBzX2dsb2JhbElkQ291bnRlcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBfc2NoZW1hSWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICBpbnRlcm5hbCBib29sIElzQ2hhbWVsZW9uDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaXNDaGFtZWxlb247IH0NCiAgICAgICAgICAgIHNldCB7IF9pc0NoYW1lbGVvbiA9IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICBpbnRlcm5hbCBIYXNodGFibGUgSWRzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaWRzOyB9DQogICAgICAgIH0NCg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICBpbnRlcm5hbCBYbWxEb2N1bWVudCBEb2N1bWVudA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyBpZiAoX2RvY3VtZW50ID09IG51bGwpIF9kb2N1bWVudCA9IG5ldyBYbWxEb2N1bWVudCgpOyByZXR1cm4gX2RvY3VtZW50OyB9DQogICAgICAgIH0NCg0KICAgICAgICBbWG1sSWdub3JlXQ0KICAgICAgICBpbnRlcm5hbCBpbnQgRXJyb3JDb3VudA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2Vycm9yQ291bnQ7IH0NCiAgICAgICAgICAgIHNldCB7IF9lcnJvckNvdW50ID0gdmFsdWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIG5ldyBYbWxTY2hlbWEgQ2xvbmUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWEgdGhhdCA9IG5ldyBYbWxTY2hlbWEoKTsNCiAgICAgICAgICAgIHRoYXQuX2F0dHJpYnV0ZUZvcm1EZWZhdWx0ID0gX2F0dHJpYnV0ZUZvcm1EZWZhdWx0Ow0KICAgICAgICAgICAgdGhhdC5fZWxlbWVudEZvcm1EZWZhdWx0ID0gX2VsZW1lbnRGb3JtRGVmYXVsdDsNCiAgICAgICAgICAgIHRoYXQuX2Jsb2NrRGVmYXVsdCA9IF9ibG9ja0RlZmF1bHQ7DQogICAgICAgICAgICB0aGF0Ll9maW5hbERlZmF1bHQgPSBfZmluYWxEZWZhdWx0Ow0KICAgICAgICAgICAgdGhhdC5fdGFyZ2V0TnMgPSBfdGFyZ2V0TnM7DQogICAgICAgICAgICB0aGF0Ll92ZXJzaW9uID0gX3ZlcnNpb247DQogICAgICAgICAgICB0aGF0Ll9pbmNsdWRlcyA9IF9pbmNsdWRlczsNCg0KICAgICAgICAgICAgdGhhdC5OYW1lc3BhY2VzID0gdGhpcy5OYW1lc3BhY2VzOw0KICAgICAgICAgICAgdGhhdC5faXRlbXMgPSBfaXRlbXM7DQogICAgICAgICAgICB0aGF0LkJhc2VVcmkgPSB0aGlzLkJhc2VVcmk7DQoNCiAgICAgICAgICAgIFNjaGVtYUNvbGxlY3Rpb25Db21waWxlci5DbGVhbnVwKHRoYXQpOw0KICAgICAgICAgICAgcmV0dXJuIHRoYXQ7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxTY2hlbWEgRGVlcENsb25lKCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hIHRoYXQgPSBuZXcgWG1sU2NoZW1hKCk7DQogICAgICAgICAgICB0aGF0Ll9hdHRyaWJ1dGVGb3JtRGVmYXVsdCA9IF9hdHRyaWJ1dGVGb3JtRGVmYXVsdDsNCiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRGb3JtRGVmYXVsdCA9IF9lbGVtZW50Rm9ybURlZmF1bHQ7DQogICAgICAgICAgICB0aGF0Ll9ibG9ja0RlZmF1bHQgPSBfYmxvY2tEZWZhdWx0Ow0KICAgICAgICAgICAgdGhhdC5fZmluYWxEZWZhdWx0ID0gX2ZpbmFsRGVmYXVsdDsNCiAgICAgICAgICAgIHRoYXQuX3RhcmdldE5zID0gX3RhcmdldE5zOw0KICAgICAgICAgICAgdGhhdC5fdmVyc2lvbiA9IF92ZXJzaW9uOw0KICAgICAgICAgICAgdGhhdC5faXNQcmVwcm9jZXNzZWQgPSBfaXNQcmVwcm9jZXNzZWQ7DQogICAgICAgICAgICAvL3RoYXQuSXNQcm9jZXNzaW5nICAgICAgICAgICA9IHRoaXMuSXNQcm9jZXNzaW5nOyAvL05vdCBzdXJlIGlmIHRoaXMgaXMgbmVlZGVkDQoNCiAgICAgICAgICAgIC8vQ2xvbmUgaXRzIEl0ZW1zDQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9pdGVtcy5Db3VudDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYU9iamVjdCBuZXdJdGVtOw0KDQogICAgICAgICAgICAgICAgWG1sU2NoZW1hQ29tcGxleFR5cGUgY29tcGxleFR5cGU7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRWxlbWVudCBlbGVtZW50Ow0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUdyb3VwIGdyb3VwOw0KDQogICAgICAgICAgICAgICAgaWYgKChjb21wbGV4VHlwZSA9IF9pdGVtc1tpXSBhcyBYbWxTY2hlbWFDb21wbGV4VHlwZSkgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIG5ld0l0ZW0gPSBjb21wbGV4VHlwZS5DbG9uZSh0aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKGVsZW1lbnQgPSBfaXRlbXNbaV0gYXMgWG1sU2NoZW1hRWxlbWVudCkgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIG5ld0l0ZW0gPSBlbGVtZW50LkNsb25lKHRoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZ3JvdXAgPSBfaXRlbXNbaV0gYXMgWG1sU2NoZW1hR3JvdXApICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBuZXdJdGVtID0gZ3JvdXAuQ2xvbmUodGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIG5ld0l0ZW0gPSBfaXRlbXNbaV0uQ2xvbmUoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhhdC5JdGVtcy5BZGQobmV3SXRlbSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vQ2xvbmUgSW5jbHVkZXMNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2luY2x1ZGVzLkNvdW50OyArK2kpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRXh0ZXJuYWwgbmV3SW5jbHVkZSA9IChYbWxTY2hlbWFFeHRlcm5hbClfaW5jbHVkZXNbaV0uQ2xvbmUoKTsNCiAgICAgICAgICAgICAgICB0aGF0LkluY2x1ZGVzLkFkZChuZXdJbmNsdWRlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoYXQuTmFtZXNwYWNlcyA9IHRoaXMuTmFtZXNwYWNlczsNCiAgICAgICAgICAgIC8vdGhhdC5pbmNsdWRlcyAgICAgICAgICAgICAgID0gdGhpcy5pbmNsdWRlczsgLy9OZWVkIHRvIHZlcmlmeSB0aGlzIGlzIE9LIGZvciByZWRlZmluZXMNCiAgICAgICAgICAgIHRoYXQuQmFzZVVyaSA9IHRoaXMuQmFzZVVyaTsNCiAgICAgICAgICAgIHJldHVybiB0aGF0Ow0KICAgICAgICB9DQoNCiAgICAgICAgW1htbElnbm9yZV0NCiAgICAgICAgaW50ZXJuYWwgb3ZlcnJpZGUgc3RyaW5nIElkQXR0cmlidXRlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBJZDsgfQ0KICAgICAgICAgICAgc2V0IHsgSWQgPSB2YWx1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgdm9pZCBTZXRJc0NvbXBpbGVkKGJvb2wgaXNDb21waWxlZCkNCiAgICAgICAgew0KICAgICAgICAgICAgX2lzQ29tcGlsZWQgPSBpc0NvbXBpbGVkOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgb3ZlcnJpZGUgdm9pZCBTZXRVbmhhbmRsZWRBdHRyaWJ1dGVzKFhtbEF0dHJpYnV0ZVtdIG1vcmVBdHRyaWJ1dGVzKQ0KICAgICAgICB7DQogICAgICAgICAgICBfbW9yZUF0dHJpYnV0ZXMgPSBtb3JlQXR0cmlidXRlczsNCiAgICAgICAgfQ0KICAgICAgICBpbnRlcm5hbCBvdmVycmlkZSB2b2lkIEFkZEFubm90YXRpb24oWG1sU2NoZW1hQW5ub3RhdGlvbiBhbm5vdGF0aW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICBfaXRlbXMuQWRkKGFubm90YXRpb24pOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgWG1sTmFtZVRhYmxlIE5hbWVUYWJsZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyBpZiAoX25hbWVUYWJsZSA9PSBudWxsKSBfbmFtZVRhYmxlID0gbmV3IFN5c3RlbS5YbWwuTmFtZVRhYmxlKCk7IHJldHVybiBfbmFtZVRhYmxlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBBcnJheUxpc3QgSW1wb3J0ZWRTY2hlbWFzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChfaW1wb3J0ZWRTY2hlbWFzID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfaW1wb3J0ZWRTY2hlbWFzID0gbmV3IEFycmF5TGlzdCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gX2ltcG9ydGVkU2NoZW1hczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIEFycmF5TGlzdCBJbXBvcnRlZE5hbWVzcGFjZXMNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF9pbXBvcnRlZE5hbWVzcGFjZXMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9pbXBvcnRlZE5hbWVzcGFjZXMgPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBfaW1wb3J0ZWROYW1lc3BhY2VzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgdm9pZCBHZXRFeHRlcm5hbFNjaGVtYXNMaXN0KElMaXN0IGV4dExpc3QsIFhtbFNjaGVtYSBzY2hlbWEpDQogICAgICAgIHsNCiAgICAgICAgICAgIERlYnVnLkFzc2VydChleHRMaXN0ICE9IG51bGwgJiYgc2NoZW1hICE9IG51bGwpOw0KICAgICAgICAgICAgaWYgKGV4dExpc3QuQ29udGFpbnMoc2NoZW1hKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBleHRMaXN0LkFkZChzY2hlbWEpOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWEuSW5jbHVkZXMuQ291bnQ7ICsraSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFFeHRlcm5hbCBleHQgPSAoWG1sU2NoZW1hRXh0ZXJuYWwpc2NoZW1hLkluY2x1ZGVzW2ldOw0KICAgICAgICAgICAgICAgIGlmIChleHQuU2NoZW1hICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBHZXRFeHRlcm5hbFNjaGVtYXNMaXN0KGV4dExpc3QsIGV4dC5TY2hlbWEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQojaWYgVFJVU1RfQ09NUElMRV9TVEFURQ0KICAgICAgICBpbnRlcm5hbCB2b2lkIEFkZENvbXBpbGVkSW5mbyhTY2hlbWFJbmZvIHNjaGVtYUluZm8pIHsNCiAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUgaXRlbU5hbWU7DQogICAgICAgICAgICBmb3JlYWNoIChYbWxTY2hlbWFFbGVtZW50IGVsZW1lbnQgaW4gZWxlbWVudHMuVmFsdWVzKSB7DQogICAgICAgICAgICAgICAgaXRlbU5hbWUgPSBlbGVtZW50LlF1YWxpZmllZE5hbWU7DQogICAgICAgICAgICAgICAgc2NoZW1hSW5mby5UYXJnZXROYW1lc3BhY2VzW2l0ZW1OYW1lLk5hbWVzcGFjZV0gPSB0cnVlOw0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvLkVsZW1lbnREZWNsc1tpdGVtTmFtZV0gPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBzY2hlbWFJbmZvLkVsZW1lbnREZWNscy5BZGQoaXRlbU5hbWUsIGVsZW1lbnQuRWxlbWVudERlY2wpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYUF0dHJpYnV0ZSBhdHRyaWJ1dGUgaW4gYXR0cmlidXRlcy5WYWx1ZXMpIHsNCiAgICAgICAgICAgICAgICBpdGVtTmFtZSA9IGF0dHJpYnV0ZS5RdWFsaWZpZWROYW1lOw0KICAgICAgICAgICAgICAgIHNjaGVtYUluZm8uVGFyZ2V0TmFtZXNwYWNlc1tpdGVtTmFtZS5OYW1lc3BhY2VdID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hSW5mby5FbGVtZW50RGVjbHNbaXRlbU5hbWVdID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgc2NoZW1hSW5mby5BdHRyaWJ1dGVEZWNscy5BZGQoaXRlbU5hbWUsIGF0dHJpYnV0ZS5BdHREZWYpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gICAgDQogICAgICAgICAgICBmb3JlYWNoIChYbWxTY2hlbWFUeXBlIHR5cGUgaW4gdHlwZXMuVmFsdWVzKSB7DQogICAgICAgICAgICAgICAgaXRlbU5hbWUgPSB0eXBlLlF1YWxpZmllZE5hbWU7DQogICAgICAgICAgICAgICAgc2NoZW1hSW5mby5UYXJnZXROYW1lc3BhY2VzW2l0ZW1OYW1lLk5hbWVzcGFjZV0gPSB0cnVlOw0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUNvbXBsZXhUeXBlIGNvbXBsZXhUeXBlID0gdHlwZSBhcyBYbWxTY2hlbWFDb21wbGV4VHlwZTsNCiAgICAgICAgICAgICAgICBpZiAoKGNvbXBsZXhUeXBlID09IG51bGwgfHwgdHlwZSAhPSBYbWxTY2hlbWFDb21wbGV4VHlwZS5BbnlUeXBlKSAmJiBzY2hlbWFJbmZvLkVsZW1lbnREZWNsc0J5VHlwZVtpdGVtTmFtZV0gPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBzY2hlbWFJbmZvLkVsZW1lbnREZWNsc0J5VHlwZS5BZGQoaXRlbU5hbWUsIHR5cGUuRWxlbWVudERlY2wpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYU5vdGF0aW9uIG5vdGF0aW9uIGluIG5vdGF0aW9ucy5WYWx1ZXMpIHsNCiAgICAgICAgICAgICAgICBpdGVtTmFtZSA9IG5vdGF0aW9uLlF1YWxpZmllZE5hbWU7DQogICAgICAgICAgICAgICAgc2NoZW1hSW5mby5UYXJnZXROYW1lc3BhY2VzW2l0ZW1OYW1lLk5hbWVzcGFjZV0gPSB0cnVlOw0KICAgICAgICAgICAgICAgIFNjaGVtYU5vdGF0aW9uIG5vID0gbmV3IFNjaGVtYU5vdGF0aW9uKGl0ZW1OYW1lKTsNCiAgICAgICAgICAgICAgICBuby5TeXN0ZW1MaXRlcmFsID0gbm90YXRpb24uU3lzdGVtOw0KICAgICAgICAgICAgICAgIG5vLlB1YmlkID0gbm90YXRpb24uUHVibGljOw0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvLk5vdGF0aW9uc1tpdGVtTmFtZS5OYW1lXSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHNjaGVtYUluZm8uTm90YXRpb25zLkFkZChpdGVtTmFtZS5OYW1lLCBubyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQojZW5kaWYvL1RSVVNUX0NPTVBJTEVfU1RBVEUNCiAgICB9DQp9DQo="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XmlSchemaCollection.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlNjaGVtYQ0Kew0KICAgIHVzaW5nIFN5c3RlbTsNCiAgICB1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KICAgIHVzaW5nIFN5c3RlbS5Db2xsZWN0aW9uczsNCiAgICB1c2luZyBTeXN0ZW0uWG1sLlNjaGVtYTsNCiAgICB1c2luZyBTeXN0ZW0uUnVudGltZS5WZXJzaW9uaW5nOw0KDQoNCiAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYUNvbGxlY3Rpb24udWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWFDb2xsZWN0aW9uIl0vKicgLz4NCiAgICAvLy8gPGRldmRvYz4NCiAgICAvLy8gICAgPHBhcmE+VGhlIFhtbFNjaGVtYUNvbGxlY3Rpb24gY29udGFpbnMgYSBzZXQgb2YgbmFtZXNwYWNlIFVSSSdzLg0KICAgIC8vLyAgICAgICBFYWNoIG5hbWVzcGFjZSBhbHNvIGhhdmUgYW4gYXNzb2NpYXRlZCBwcml2YXRlIGRhdGEgY2FjaGUNCiAgICAvLy8gICAgICAgY29ycmVzcG9uZGluZyB0byB0aGUgWE1MLURhdGEgU2NoZW1hIG9yIFczQyBYTUwgU2NoZW1hLg0KICAgIC8vLyAgICAgICBUaGUgWG1sU2NoZW1hQ29sbGVjdGlvbiB3aWxsIGFibGUgdG8gbG9hZCBYU0QgYW5kIFhEUiBzY2hlbWFzLA0KICAgIC8vLyAgICAgICBhbmQgY29tcGlsZSB0aGVtIGludG8gYW4gaW50ZXJuYWwgImNvb2tlZCBzY2hlbWEgcmVwcmVzZW50YXRpb24iLg0KICAgIC8vLyAgICAgICBUaGUgVmFsaWRhdGUgbWV0aG9kIHRoZW4gdXNlcyB0aGlzIGludGVybmFsIHJlcHJlc2VudGF0aW9uIGZvcg0KICAgIC8vLyAgICAgICBlZmZpY2llbnQgcnVudGltZSB2YWxpZGF0aW9uIG9mIGFueSBnaXZlbiBzdWJ0cmVlLjwvcGFyYT4NCiAgICAvLy8gPC9kZXZkb2M+DQogICAgW09ic29sZXRlKCJVc2UgU3lzdGVtLlhtbC5TY2hlbWEuWG1sU2NoZW1hU2V0IGZvciBzY2hlbWEgY29tcGlsYXRpb24gYW5kIHZhbGlkYXRpb24uIGh0dHA6Ly9nby5taWNyb3NvZnQuY29tL2Z3bGluay8/bGlua2lkPTE0MjAyIildDQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBYbWxTY2hlbWFDb2xsZWN0aW9uIDogSUNvbGxlY3Rpb24NCiAgICB7DQogICAgICAgIHByaXZhdGUgSGFzaHRhYmxlIF9jb2xsZWN0aW9uOw0KICAgICAgICBwcml2YXRlIFhtbE5hbWVUYWJsZSBfbmFtZVRhYmxlOw0KICAgICAgICBwcml2YXRlIFNjaGVtYU5hbWVzIF9zY2hlbWFOYW1lczsNCiAgICAgICAgcHJpdmF0ZSBvYmplY3QgX3dMb2NrOw0KICAgICAgICBwcml2YXRlIGJvb2wgX2lzVGhyZWFkU2FmZSA9IHRydWU7DQogICAgICAgIHByaXZhdGUgVmFsaWRhdGlvbkV2ZW50SGFuZGxlciBfdmFsaWRhdGlvbkV2ZW50SGFuZGxlciA9IG51bGw7DQogICAgICAgIHByaXZhdGUgWG1sUmVzb2x2ZXIgX3htbFJlc29sdmVyID0gbnVsbDsNCg0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uWG1sU2NoZW1hQ29sbGVjdGlvbiJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+Q29uc3RydWN0IGEgbmV3IGVtcHR5IHNjaGVtYSBjb2xsZWN0aW9uLjwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgWG1sU2NoZW1hQ29sbGVjdGlvbigpIDogdGhpcyhuZXcgTmFtZVRhYmxlKCkpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uWG1sU2NoZW1hQ29sbGVjdGlvbjEiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPkNvbnN0cnVjdCBhIG5ldyBlbXB0eSBzY2hlbWEgY29sbGVjdGlvbiB3aXRoIGFzc29jaWF0ZWQgWG1sTmFtZVRhYmxlLg0KICAgICAgICAvLy8gICAgICAgVGhlIFhtbE5hbWVUYWJsZSBpcyB1c2VkIHdoZW4gbG9hZGluZyBzY2hlbWFzPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWFDb2xsZWN0aW9uKFhtbE5hbWVUYWJsZSBuYW1ldGFibGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChuYW1ldGFibGUgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihuYW1ldGFibGUpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9uYW1lVGFibGUgPSBuYW1ldGFibGU7DQogICAgICAgICAgICBfY29sbGVjdGlvbiA9IEhhc2h0YWJsZS5TeW5jaHJvbml6ZWQobmV3IEhhc2h0YWJsZSgpKTsNCiAgICAgICAgICAgIF94bWxSZXNvbHZlciA9IG51bGw7DQogICAgICAgICAgICBfaXNUaHJlYWRTYWZlID0gdHJ1ZTsNCiAgICAgICAgICAgIGlmIChfaXNUaHJlYWRTYWZlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF93TG9jayA9IG5ldyBvYmplY3QoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uQ291bnQiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPlJldHVybnMgdGhlIG51bWJlciBvZiBuYW1lc3BhY2VzIGRlZmluZWQgaW4gdGhpcyBjb2xsZWN0aW9uDQogICAgICAgIC8vLyAgICAgICAod2hldGhlciBvciBub3QgdGhlcmUgaXMgYW4gYWN0dWFsIHNjaGVtYSBhc3NvY2lhdGVkIHdpdGggdGhvc2UgbmFtZXNwYWNlcyBvciBub3QpLjwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgaW50IENvdW50DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfY29sbGVjdGlvbi5Db3VudDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbi5OYW1lVGFibGUiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPlRoZSBkZWZhdWx0IFhtbE5hbWVUYWJsZSB1c2VkIGJ5IHRoZSBYbWxTY2hlbWFDb2xsZWN0aW9uIHdoZW4gbG9hZGluZyBuZXcgc2NoZW1hcy48L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIFhtbE5hbWVUYWJsZSBOYW1lVGFibGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9uYW1lVGFibGU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uVmFsaWRhdGlvbkV2ZW50SGFuZGxlciJdLyonIC8+DQogICAgICAgIHB1YmxpYyBldmVudCBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIFZhbGlkYXRpb25FdmVudEhhbmRsZXINCiAgICAgICAgew0KICAgICAgICAgICAgYWRkIHsgX3ZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gdmFsdWU7IH0NCiAgICAgICAgICAgIHJlbW92ZSB7IF92YWxpZGF0aW9uRXZlbnRIYW5kbGVyIC09IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxSZXNvbHZlciBYbWxSZXNvbHZlcg0KICAgICAgICB7DQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfeG1sUmVzb2x2ZXIgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbi5BZGQiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPkFkZCB0aGUgc2NoZW1hIGxvY2F0ZWQgYnkgdGhlIGdpdmVuIFVSTCBpbnRvIHRoZSBzY2hlbWEgY29sbGVjdGlvbi4NCiAgICAgICAgLy8vICAgICAgIElmIHRoZSBnaXZlbiBzY2hlbWEgcmVmZXJlbmNlcyBvdGhlciBuYW1lc3BhY2VzLCB0aGUgc2NoZW1hcyBmb3IgdGhvc2Ugb3RoZXINCiAgICAgICAgLy8vICAgICAgIG5hbWVzcGFjZXMgYXJlIE5PVCBhdXRvbWF0aWNhbGx5IGxvYWRlZC48L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIFhtbFNjaGVtYSBBZGQoc3RyaW5nIG5zLCBzdHJpbmcgdXJpKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAodXJpID09IG51bGwgfHwgdXJpLkxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24obmFtZW9mKHVyaSkpOw0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciByZWFkZXIgPSBuZXcgWG1sVGV4dFJlYWRlcih1cmksIF9uYW1lVGFibGUpOw0KICAgICAgICAgICAgcmVhZGVyLlhtbFJlc29sdmVyID0gX3htbFJlc29sdmVyOw0KDQogICAgICAgICAgICBYbWxTY2hlbWEgc2NoZW1hID0gbnVsbDsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNjaGVtYSA9IEFkZChucywgcmVhZGVyLCBfeG1sUmVzb2x2ZXIpOw0KICAgICAgICAgICAgICAgIHdoaWxlIChyZWFkZXIuUmVhZCgpKSA7Ly8gd2VsbGZvcm1uZXNzIGNoZWNrDQogICAgICAgICAgICB9DQogICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVhZGVyLkNsb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gc2NoZW1hOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbi5BZGQ0Il0vKicgLz4NCiAgICAgICAgcHVibGljIFhtbFNjaGVtYSBBZGQoU3RyaW5nIG5zLCBYbWxSZWFkZXIgcmVhZGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gQWRkKG5zLCByZWFkZXIsIF94bWxSZXNvbHZlcik7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYUNvbGxlY3Rpb24udWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWFDb2xsZWN0aW9uLkFkZDEiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPkFkZCB0aGUgZ2l2ZW4gc2NoZW1hIGludG8gdGhlIHNjaGVtYSBjb2xsZWN0aW9uLg0KICAgICAgICAvLy8gICAgICAgSWYgdGhlIGdpdmVuIHNjaGVtYSByZWZlcmVuY2VzIG90aGVyIG5hbWVzcGFjZXMsIHRoZSBzY2hlbWFzIGZvciB0aG9zZQ0KICAgICAgICAvLy8gICAgICAgb3RoZXIgbmFtZXNwYWNlcyBhcmUgTk9UIGF1dG9tYXRpY2FsbHkgbG9hZGVkLjwvcGFyYT4NCiAgICAgICAgLy8vIDwvZGV2ZG9jPg0KICAgICAgICBwdWJsaWMgWG1sU2NoZW1hIEFkZChTdHJpbmcgbnMsIFhtbFJlYWRlciByZWFkZXIsIFhtbFJlc29sdmVyIHJlc29sdmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAocmVhZGVyID09IG51bGwpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2YocmVhZGVyKSk7DQogICAgICAgICAgICBYbWxOYW1lVGFibGUgcmVhZGVyTmFtZVRhYmxlID0gcmVhZGVyLk5hbWVUYWJsZTsNCiAgICAgICAgICAgIFNjaGVtYUluZm8gc2NoZW1hSW5mbyA9IG5ldyBTY2hlbWFJbmZvKCk7DQoNCiAgICAgICAgICAgIFBhcnNlciBwYXJzZXIgPSBuZXcgUGFyc2VyKFNjaGVtYVR5cGUuTm9uZSwgcmVhZGVyTmFtZVRhYmxlLCBHZXRTY2hlbWFOYW1lcyhyZWFkZXJOYW1lVGFibGUpLCBfdmFsaWRhdGlvbkV2ZW50SGFuZGxlcik7DQogICAgICAgICAgICBwYXJzZXIuWG1sUmVzb2x2ZXIgPSByZXNvbHZlcjsNCiAgICAgICAgICAgIFNjaGVtYVR5cGUgc2NoZW1hVHlwZTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBwYXJzZXIuUGFyc2UocmVhZGVyLCBucyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChlKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgPT0gU2NoZW1hVHlwZS5YU0QpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2NoZW1hSW5mby5TY2hlbWFUeXBlID0gU2NoZW1hVHlwZS5YU0Q7DQogICAgICAgICAgICAgICAgcmV0dXJuIEFkZChucywgc2NoZW1hSW5mbywgcGFyc2VyLlhtbFNjaGVtYSwgdHJ1ZSwgcmVzb2x2ZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNjaGVtYUluZm8geGRyU2NoZW1hID0gcGFyc2VyLlhkclNjaGVtYTsNCiAgICAgICAgICAgICAgICByZXR1cm4gQWRkKG5zLCBwYXJzZXIuWGRyU2NoZW1hLCBudWxsLCB0cnVlLCByZXNvbHZlcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYUNvbGxlY3Rpb24udWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWFDb2xsZWN0aW9uLkFkZDIiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWEgQWRkKFhtbFNjaGVtYSBzY2hlbWEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBBZGQoc2NoZW1hLCBfeG1sUmVzb2x2ZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbi5BZGQ1Il0vKicgLz4NCgkgICAgcHVibGljIFhtbFNjaGVtYSBBZGQoWG1sU2NoZW1hIHNjaGVtYSwgWG1sUmVzb2x2ZXIgcmVzb2x2ZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihzY2hlbWEpKTsNCg0KICAgICAgICAgICAgU2NoZW1hSW5mbyBzY2hlbWFJbmZvID0gbmV3IFNjaGVtYUluZm8oKTsNCiAgICAgICAgICAgIHNjaGVtYUluZm8uU2NoZW1hVHlwZSA9IFNjaGVtYVR5cGUuWFNEOw0KICAgICAgICAgICAgcmV0dXJuIEFkZChzY2hlbWEuVGFyZ2V0TmFtZXNwYWNlLCBzY2hlbWFJbmZvLCBzY2hlbWEsIHRydWUsIHJlc29sdmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uQWRkMyJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+QWRkcyBhbGwgdGhlIG5hbWVzcGFjZXMgZGVmaW5lZCBpbiB0aGUgZ2l2ZW4gY29sbGVjdGlvbg0KICAgICAgICAvLy8gICAgICAgKGluY2x1ZGluZyB0aGVpciBhc3NvY2lhdGVkIHNjaGVtYXMpIHRvIHRoaXMgY29sbGVjdGlvbi48L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIHZvaWQgQWRkKFhtbFNjaGVtYUNvbGxlY3Rpb24gc2NoZW1hKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2Yoc2NoZW1hKSk7DQogICAgICAgICAgICBpZiAodGhpcyA9PSBzY2hlbWEpDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgSURpY3Rpb25hcnlFbnVtZXJhdG9yIGVudW1lcmF0b3IgPSBzY2hlbWEuX2NvbGxlY3Rpb24uR2V0RW51bWVyYXRvcigpOw0KICAgICAgICAgICAgd2hpbGUgKGVudW1lcmF0b3IuTW92ZU5leHQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFDb2xsZWN0aW9uTm9kZSBub2RlID0gKFhtbFNjaGVtYUNvbGxlY3Rpb25Ob2RlKWVudW1lcmF0b3IuVmFsdWU7DQogICAgICAgICAgICAgICAgQWRkKG5vZGUuTmFtZXNwYWNlVVJJLCBub2RlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbi50aGlzIl0vKicgLz4NCiAgICAgICAgLy8vIDxkZXZkb2M+DQogICAgICAgIC8vLyAgICA8cGFyYT5Mb29rcyB1cCB0aGUgc2NoZW1hIGJ5IGl0J3MgYXNzb2NpYXRlZCBuYW1lc3BhY2UgVVJJPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWEgdGhpc1tzdHJpbmcgbnNdDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUNvbGxlY3Rpb25Ob2RlIG5vZGUgPSAoWG1sU2NoZW1hQ29sbGVjdGlvbk5vZGUpX2NvbGxlY3Rpb25bKG5zICE9IG51bGwpID8gbnMgOiBzdHJpbmcuRW1wdHldOw0KICAgICAgICAgICAgICAgIHJldHVybiAobm9kZSAhPSBudWxsKSA/IG5vZGUuU2NoZW1hIDogbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uQ29udGFpbnMiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBib29sIENvbnRhaW5zKFhtbFNjaGVtYSBzY2hlbWEpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihzY2hlbWEpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0aGlzW3NjaGVtYS5UYXJnZXROYW1lc3BhY2VdICE9IG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYUNvbGxlY3Rpb24udWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWFDb2xsZWN0aW9uLkNvbnRhaW5zMSJdLyonIC8+DQogICAgICAgIHB1YmxpYyBib29sIENvbnRhaW5zKHN0cmluZyBucykNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIF9jb2xsZWN0aW9uWyhucyAhPSBudWxsKSA/IG5zIDogc3RyaW5nLkVtcHR5XSAhPSBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbi5JRW51bWVyYWJsZS5HZXRFbnVtZXJhdG9yIl0vKicgLz4NCiAgICAgICAgLy8vIDxpbnRlcm5hbG9ubHkvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vIEdldCBhIElFbnVtZXJhdG9yIG9mIHRoZSBYbWxTY2hlbWFDb2xsZWN0aW9uLg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIElFbnVtZXJhdG9yIElFbnVtZXJhYmxlLkdldEVudW1lcmF0b3IoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhtbFNjaGVtYUNvbGxlY3Rpb25FbnVtZXJhdG9yKF9jb2xsZWN0aW9uKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uR2V0RW51bWVyYXRvciJdLyonIC8+DQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWFDb2xsZWN0aW9uRW51bWVyYXRvciBHZXRFbnVtZXJhdG9yKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxTY2hlbWFDb2xsZWN0aW9uRW51bWVyYXRvcihfY29sbGVjdGlvbik7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYUNvbGxlY3Rpb24udWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWFDb2xsZWN0aW9uLklDb2xsZWN0aW9uLkNvcHlUbyJdLyonIC8+DQogICAgICAgIC8vLyA8aW50ZXJuYWxvbmx5Lz4NCiAgICAgICAgdm9pZCBJQ29sbGVjdGlvbi5Db3B5VG8oQXJyYXkgYXJyYXksIGludCBpbmRleCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGFycmF5ID09IG51bGwpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2YoYXJyYXkpKTsNCiAgICAgICAgICAgIGlmIChpbmRleCA8IDApDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbihuYW1lb2YoaW5kZXgpKTsNCiAgICAgICAgICAgIGZvciAoWG1sU2NoZW1hQ29sbGVjdGlvbkVudW1lcmF0b3IgZSA9IHRoaXMuR2V0RW51bWVyYXRvcigpOyBlLk1vdmVOZXh0KCk7KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PSBhcnJheS5MZW5ndGgpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKG5hbWVvZihpbmRleCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBhcnJheS5TZXRWYWx1ZShlLkN1cnJlbnQsIGluZGV4KyspOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbi5Db3B5VG8iXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyB2b2lkIENvcHlUbyhYbWxTY2hlbWFbXSBhcnJheSwgaW50IGluZGV4KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYXJyYXkgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihhcnJheSkpOw0KICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKG5hbWVvZihpbmRleCkpOw0KICAgICAgICAgICAgZm9yIChYbWxTY2hlbWFDb2xsZWN0aW9uRW51bWVyYXRvciBlID0gdGhpcy5HZXRFbnVtZXJhdG9yKCk7IGUuTW92ZU5leHQoKTspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYSA9IGUuQ3VycmVudDsNCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gYXJyYXkuTGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKG5hbWVvZihpbmRleCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGFycmF5W2luZGV4KytdID0gZS5DdXJyZW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uSUNvbGxlY3Rpb24uSXNTeW5jaHJvbml6ZWQiXS8qJyAvPg0KICAgICAgICAvLy8gPGludGVybmFsb25seS8+DQogICAgICAgIGJvb2wgSUNvbGxlY3Rpb24uSXNTeW5jaHJvbml6ZWQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIHRydWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb24uSUNvbGxlY3Rpb24uU3luY1Jvb3QiXS8qJyAvPg0KICAgICAgICAvLy8gPGludGVybmFsb25seS8+DQogICAgICAgIG9iamVjdCBJQ29sbGVjdGlvbi5TeW5jUm9vdA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gdGhpczsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbi5JQ29sbGVjdGlvbi5Db3VudCJdLyonIC8+DQogICAgICAgIC8vLyA8aW50ZXJuYWxvbmx5Lz4NCiAgICAgICAgaW50IElDb2xsZWN0aW9uLkNvdW50DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfY29sbGVjdGlvbi5Db3VudDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgU2NoZW1hSW5mbyBHZXRTY2hlbWFJbmZvKHN0cmluZyBucykNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hQ29sbGVjdGlvbk5vZGUgbm9kZSA9IChYbWxTY2hlbWFDb2xsZWN0aW9uTm9kZSlfY29sbGVjdGlvblsobnMgIT0gbnVsbCkgPyBucyA6IHN0cmluZy5FbXB0eV07DQogICAgICAgICAgICByZXR1cm4gKG5vZGUgIT0gbnVsbCkgPyBub2RlLlNjaGVtYUluZm8gOiBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgU2NoZW1hTmFtZXMgR2V0U2NoZW1hTmFtZXMoWG1sTmFtZVRhYmxlIG50KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX25hbWVUYWJsZSAhPSBudCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNjaGVtYU5hbWVzKG50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX3NjaGVtYU5hbWVzID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfc2NoZW1hTmFtZXMgPSBuZXcgU2NoZW1hTmFtZXMoX25hbWVUYWJsZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBfc2NoZW1hTmFtZXM7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxTY2hlbWEgQWRkKHN0cmluZyBucywgU2NoZW1hSW5mbyBzY2hlbWFJbmZvLCBYbWxTY2hlbWEgc2NoZW1hLCBib29sIGNvbXBpbGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBBZGQobnMsIHNjaGVtYUluZm8sIHNjaGVtYSwgY29tcGlsZSwgX3htbFJlc29sdmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hIEFkZChzdHJpbmcgbnMsIFNjaGVtYUluZm8gc2NoZW1hSW5mbywgWG1sU2NoZW1hIHNjaGVtYSwgYm9vbCBjb21waWxlLCBYbWxSZXNvbHZlciByZXNvbHZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaW50IGVycm9yQ291bnQgPSAwOw0KICAgICAgICAgICAgaWYgKHNjaGVtYSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWEuRXJyb3JDb3VudCA9PSAwICYmIGNvbXBpbGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIXNjaGVtYS5Db21waWxlU2NoZW1hKHRoaXMsIHJlc29sdmVyLCBzY2hlbWFJbmZvLCBucywgX3ZhbGlkYXRpb25FdmVudEhhbmRsZXIsIF9uYW1lVGFibGUsIHRydWUpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNvdW50ID0gMTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBucyA9IHNjaGVtYS5UYXJnZXROYW1lc3BhY2UgPT0gbnVsbCA/IHN0cmluZy5FbXB0eSA6IHNjaGVtYS5UYXJnZXROYW1lc3BhY2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVycm9yQ291bnQgKz0gc2NoZW1hLkVycm9yQ291bnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZXJyb3JDb3VudCArPSBzY2hlbWFJbmZvLkVycm9yQ291bnQ7DQogICAgICAgICAgICAgICAgLy9ucyA9IG5zID09IG51bGw/IHN0cmluZy5FbXB0eSA6IE5hbWVUYWJsZS5BZGQobnMpOw0KICAgICAgICAgICAgICAgIG5zID0gTmFtZVRhYmxlLkFkZChucyk7IC8vQWRkZWQgd2l0aG91dCBjaGVja2luZyBmb3IgbnMgPT0gbnVsbCwgc2luY2UgWERSIGNhbm5vdCBoYXZlIG51bGwgbmFtZXNwYWNlDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZXJyb3JDb3VudCA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUNvbGxlY3Rpb25Ob2RlIG5vZGUgPSBuZXcgWG1sU2NoZW1hQ29sbGVjdGlvbk5vZGUoKTsNCiAgICAgICAgICAgICAgICBub2RlLk5hbWVzcGFjZVVSSSA9IG5zOw0KICAgICAgICAgICAgICAgIG5vZGUuU2NoZW1hSW5mbyA9IHNjaGVtYUluZm87DQogICAgICAgICAgICAgICAgbm9kZS5TY2hlbWEgPSBzY2hlbWE7DQogICAgICAgICAgICAgICAgQWRkKG5zLCBub2RlKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgQWRkTm9uVGhyZWFkU2FmZShzdHJpbmcgbnMsIFhtbFNjaGVtYUNvbGxlY3Rpb25Ob2RlIG5vZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChfY29sbGVjdGlvbltuc10gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfY29sbGVjdGlvbi5SZW1vdmUobnMpOw0KICAgICAgICAgICAgX2NvbGxlY3Rpb24uQWRkKG5zLCBub2RlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBBZGQoc3RyaW5nIG5zLCBYbWxTY2hlbWFDb2xsZWN0aW9uTm9kZSBub2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX2lzVGhyZWFkU2FmZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsb2NrIChfd0xvY2spDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBZGROb25UaHJlYWRTYWZlKG5zLCBub2RlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQWRkTm9uVGhyZWFkU2FmZShucywgbm9kZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgU2VuZFZhbGlkYXRpb25FdmVudChYbWxTY2hlbWFFeGNlcHRpb24gZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF92YWxpZGF0aW9uRXZlbnRIYW5kbGVyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25FdmVudEhhbmRsZXIodGhpcywgbmV3IFZhbGlkYXRpb25FdmVudEFyZ3MoZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIEV2ZW50SGFuZGxlcg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3ZhbGlkYXRpb25FdmVudEhhbmRsZXI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbkV2ZW50SGFuZGxlciA9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KDQogICAgaW50ZXJuYWwgc2VhbGVkIGNsYXNzIFhtbFNjaGVtYUNvbGxlY3Rpb25Ob2RlDQogICAgew0KICAgICAgICBwcml2YXRlIFN0cmluZyBfbmFtZXNwYWNlVXJpOw0KICAgICAgICBwcml2YXRlIFNjaGVtYUluZm8gX3NjaGVtYUluZm87DQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hIF9zY2hlbWE7DQoNCiAgICAgICAgaW50ZXJuYWwgU3RyaW5nIE5hbWVzcGFjZVVSSQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX25hbWVzcGFjZVVyaTsgfQ0KICAgICAgICAgICAgc2V0IHsgX25hbWVzcGFjZVVyaSA9IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBTY2hlbWFJbmZvIFNjaGVtYUluZm8NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9zY2hlbWFJbmZvOyB9DQogICAgICAgICAgICBzZXQgeyBfc2NoZW1hSW5mbyA9IHZhbHVlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBYbWxTY2hlbWEgU2NoZW1hDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfc2NoZW1hOyB9DQogICAgICAgICAgICBzZXQgeyBfc2NoZW1hID0gdmFsdWU7IH0NCiAgICAgICAgfQ0KICAgIH0NCg0KDQogICAgLy8vIDxpbmNsdWRlIGZpbGU9J2RvY1xYbWxTY2hlbWFDb2xsZWN0aW9uLnVleCcgcGF0aD0nZG9jcy9kb2NbQGZvcj0iWG1sU2NoZW1hQ29sbGVjdGlvbkVudW1lcmF0b3IiXS8qJyAvPg0KICAgIC8vLyA8ZGV2ZG9jPg0KICAgIC8vLyAgICA8cGFyYT5bVG8gYmUgc3VwcGxpZWQuXTwvcGFyYT4NCiAgICAvLy8gPC9kZXZkb2M+DQogICAgcHVibGljIHNlYWxlZCBjbGFzcyBYbWxTY2hlbWFDb2xsZWN0aW9uRW51bWVyYXRvciA6IElFbnVtZXJhdG9yDQogICAgew0KICAgICAgICBwcml2YXRlIElEaWN0aW9uYXJ5RW51bWVyYXRvciBfZW51bWVyYXRvcjsNCg0KICAgICAgICBpbnRlcm5hbCBYbWxTY2hlbWFDb2xsZWN0aW9uRW51bWVyYXRvcihIYXNodGFibGUgY29sbGVjdGlvbikNCiAgICAgICAgew0KICAgICAgICAgICAgX2VudW1lcmF0b3IgPSBjb2xsZWN0aW9uLkdldEVudW1lcmF0b3IoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb25FbnVtZXJhdG9yLklFbnVtZXJhdG9yLlJlc2V0Il0vKicgLz4NCiAgICAgICAgLy8vIDxpbnRlcm5hbG9ubHkvPg0KICAgICAgICB2b2lkIElFbnVtZXJhdG9yLlJlc2V0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgX2VudW1lcmF0b3IuUmVzZXQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb25FbnVtZXJhdG9yLklFbnVtZXJhdG9yLk1vdmVOZXh0Il0vKicgLz4NCiAgICAgICAgLy8vIDxpbnRlcm5hbG9ubHkvPg0KICAgICAgICBib29sIElFbnVtZXJhdG9yLk1vdmVOZXh0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIF9lbnVtZXJhdG9yLk1vdmVOZXh0KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPGluY2x1ZGUgZmlsZT0nZG9jXFhtbFNjaGVtYUNvbGxlY3Rpb24udWV4JyBwYXRoPSdkb2NzL2RvY1tAZm9yPSJYbWxTY2hlbWFDb2xsZWN0aW9uRW51bWVyYXRvci5Nb3ZlTmV4dCJdLyonIC8+DQogICAgICAgIC8vLyA8ZGV2ZG9jPg0KICAgICAgICAvLy8gICAgPHBhcmE+W1RvIGJlIHN1cHBsaWVkLl08L3BhcmE+DQogICAgICAgIC8vLyA8L2RldmRvYz4NCiAgICAgICAgcHVibGljIGJvb2wgTW92ZU5leHQoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gX2VudW1lcmF0b3IuTW92ZU5leHQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb25FbnVtZXJhdG9yLklFbnVtZXJhdG9yLkN1cnJlbnQiXS8qJyAvPg0KICAgICAgICAvLy8gPGludGVybmFsb25seS8+DQogICAgICAgIG9iamVjdCBJRW51bWVyYXRvci5DdXJyZW50DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiB0aGlzLkN1cnJlbnQ7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8aW5jbHVkZSBmaWxlPSdkb2NcWG1sU2NoZW1hQ29sbGVjdGlvbi51ZXgnIHBhdGg9J2RvY3MvZG9jW0Bmb3I9IlhtbFNjaGVtYUNvbGxlY3Rpb25FbnVtZXJhdG9yLkN1cnJlbnQiXS8qJyAvPg0KICAgICAgICAvLy8gPGRldmRvYz4NCiAgICAgICAgLy8vICAgIDxwYXJhPltUbyBiZSBzdXBwbGllZC5dPC9wYXJhPg0KICAgICAgICAvLy8gPC9kZXZkb2M+DQogICAgICAgIHB1YmxpYyBYbWxTY2hlbWEgQ3VycmVudA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFDb2xsZWN0aW9uTm9kZSBuID0gKFhtbFNjaGVtYUNvbGxlY3Rpb25Ob2RlKV9lbnVtZXJhdG9yLlZhbHVlOw0KICAgICAgICAgICAgICAgIGlmIChuICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuLlNjaGVtYTsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgWG1sU2NoZW1hQ29sbGVjdGlvbk5vZGUgQ3VycmVudE5vZGUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hQ29sbGVjdGlvbk5vZGUgbiA9IChYbWxTY2hlbWFDb2xsZWN0aW9uTm9kZSlfZW51bWVyYXRvci5WYWx1ZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XsdValidator.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlNjaGVtYQ0Kew0KICAgIHVzaW5nIFN5c3RlbS5Db2xsZWN0aW9uczsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuU3BlY2lhbGl6ZWQ7DQogICAgdXNpbmcgU3lzdGVtLlRleHQ7DQogICAgdXNpbmcgU3lzdGVtLklPOw0KICAgIHVzaW5nIFN5c3RlbS5EaWFnbm9zdGljczsNCiAgICB1c2luZyBTeXN0ZW0uWG1sLlNjaGVtYTsNCiAgICB1c2luZyBTeXN0ZW0uWG1sLlhQYXRoOw0KICAgIHVzaW5nIFN5c3RlbS5SdW50aW1lLlZlcnNpb25pbmc7DQoNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDYxOA0KICAgIGludGVybmFsIHNlYWxlZCBjbGFzcyBYc2RWYWxpZGF0b3IgOiBCYXNlVmFsaWRhdG9yDQogICAgew0KICAgICAgICBwcml2YXRlIGludCBfc3RhcnRJRENvbnN0cmFpbnQgPSAtMTsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBpbnQgU1RBQ0tfSU5DUkVNRU5UID0gMTA7DQogICAgICAgIHByaXZhdGUgSFdTdGFjayBfdmFsaWRhdGlvblN0YWNrOyAgLy8gdmFsaWRhdG9uIGNvbnRleHRzDQoNCiAgICAgICAgcHJpdmF0ZSBIYXNodGFibGUgX2F0dFByZXNlbmNlOw0KICAgICAgICBwcml2YXRlIFhtbE5hbWVzcGFjZU1hbmFnZXIgX25zTWFuYWdlcjsNCiAgICAgICAgcHJpdmF0ZSBib29sIF9iTWFuYWdlTmFtZXNwYWNlcyA9IGZhbHNlOw0KICAgICAgICBwcml2YXRlIEhhc2h0YWJsZSBfSURzOw0KICAgICAgICBwcml2YXRlIElkUmVmTm9kZSBfaWRSZWZMaXN0SGVhZDsNCiAgICAgICAgcHJpdmF0ZSBQYXJzZXIgX2lubGluZVNjaGVtYVBhcnNlciA9IG51bGw7DQogICAgICAgIHByaXZhdGUgWG1sU2NoZW1hQ29udGVudFByb2Nlc3NpbmcgX3Byb2Nlc3NDb250ZW50czsNCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBYbWxTY2hlbWFEYXRhdHlwZSBzX2R0Q0RBVEEgPSBYbWxTY2hlbWFEYXRhdHlwZS5Gcm9tWG1sVG9rZW5pemVkVHlwZShYbWxUb2tlbml6ZWRUeXBlLkNEQVRBKTsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgWG1sU2NoZW1hRGF0YXR5cGUgc19kdFFOYW1lID0gWG1sU2NoZW1hRGF0YXR5cGUuRnJvbVhtbFRva2VuaXplZFR5cGVYc2QoWG1sVG9rZW5pemVkVHlwZS5RTmFtZSk7DQogICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFhtbFNjaGVtYURhdGF0eXBlIHNfZHRTdHJpbmdBcnJheSA9IHNfZHRDREFUQS5EZXJpdmVCeUxpc3QobnVsbCk7DQoNCiAgICAgICAgLy9UbyBhdm9pZCBTY2hlbWFOYW1lcyBjcmVhdGlvbg0KICAgICAgICBwcml2YXRlIHN0cmluZyBfbnNYbWxOczsNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX25zWHM7DQogICAgICAgIHByaXZhdGUgc3RyaW5nIF9uc1hzaTsNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX3hzaVR5cGU7DQogICAgICAgIHByaXZhdGUgc3RyaW5nIF94c2lOaWw7DQogICAgICAgIHByaXZhdGUgc3RyaW5nIF94c2lTY2hlbWFMb2NhdGlvbjsNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX3hzaU5vTmFtZXNwYWNlU2NoZW1hTG9jYXRpb247DQogICAgICAgIHByaXZhdGUgc3RyaW5nIF94c2RTY2hlbWE7DQoNCg0KICAgICAgICBpbnRlcm5hbCBYc2RWYWxpZGF0b3IoQmFzZVZhbGlkYXRvciB2YWxpZGF0b3IpIDogYmFzZSh2YWxpZGF0b3IpDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIFhzZFZhbGlkYXRvcihYbWxWYWxpZGF0aW5nUmVhZGVySW1wbCByZWFkZXIsIFhtbFNjaGVtYUNvbGxlY3Rpb24gc2NoZW1hQ29sbGVjdGlvbiwgSVZhbGlkYXRpb25FdmVudEhhbmRsaW5nIGV2ZW50SGFuZGxpbmcpIDogYmFzZShyZWFkZXIsIHNjaGVtYUNvbGxlY3Rpb24sIGV2ZW50SGFuZGxpbmcpDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBJbml0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgX25zTWFuYWdlciA9IHJlYWRlci5OYW1lc3BhY2VNYW5hZ2VyOw0KICAgICAgICAgICAgaWYgKF9uc01hbmFnZXIgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfbnNNYW5hZ2VyID0gbmV3IFhtbE5hbWVzcGFjZU1hbmFnZXIoTmFtZVRhYmxlKTsNCiAgICAgICAgICAgICAgICBfYk1hbmFnZU5hbWVzcGFjZXMgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX3ZhbGlkYXRpb25TdGFjayA9IG5ldyBIV1N0YWNrKFNUQUNLX0lOQ1JFTUVOVCk7DQogICAgICAgICAgICB0ZXh0VmFsdWUgPSBuZXcgU3RyaW5nQnVpbGRlcigpOw0KICAgICAgICAgICAgX2F0dFByZXNlbmNlID0gbmV3IEhhc2h0YWJsZSgpOw0KICAgICAgICAgICAgc2NoZW1hSW5mbyA9IG5ldyBTY2hlbWFJbmZvKCk7DQogICAgICAgICAgICBjaGVja0RhdGF0eXBlID0gZmFsc2U7DQogICAgICAgICAgICBfcHJvY2Vzc0NvbnRlbnRzID0gWG1sU2NoZW1hQ29udGVudFByb2Nlc3NpbmcuU3RyaWN0Ow0KICAgICAgICAgICAgUHVzaChYbWxRdWFsaWZpZWROYW1lLkVtcHR5KTsNCg0KICAgICAgICAgICAgLy9BZGQgY29tbW9uIHN0cmluZ3MgdG8gYmUgY29tcGFyZWQgdG8gTmFtZVRhYmxlDQogICAgICAgICAgICBfbnNYbWxOcyA9IE5hbWVUYWJsZS5BZGQoWG1sUmVzZXJ2ZWROcy5Oc1htbE5zKTsNCiAgICAgICAgICAgIF9uc1hzID0gTmFtZVRhYmxlLkFkZChYbWxSZXNlcnZlZE5zLk5zWHMpOw0KICAgICAgICAgICAgX25zWHNpID0gTmFtZVRhYmxlLkFkZChYbWxSZXNlcnZlZE5zLk5zWHNpKTsNCiAgICAgICAgICAgIF94c2lUeXBlID0gTmFtZVRhYmxlLkFkZCgidHlwZSIpOw0KICAgICAgICAgICAgX3hzaU5pbCA9IE5hbWVUYWJsZS5BZGQoIm5pbCIpOw0KICAgICAgICAgICAgX3hzaVNjaGVtYUxvY2F0aW9uID0gTmFtZVRhYmxlLkFkZCgic2NoZW1hTG9jYXRpb24iKTsNCiAgICAgICAgICAgIF94c2lOb05hbWVzcGFjZVNjaGVtYUxvY2F0aW9uID0gTmFtZVRhYmxlLkFkZCgibm9OYW1lc3BhY2VTY2hlbWFMb2NhdGlvbiIpOw0KICAgICAgICAgICAgX3hzZFNjaGVtYSA9IE5hbWVUYWJsZS5BZGQoInNjaGVtYSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVmFsaWRhdGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoSXNJbmxpbmVTY2hlbWFTdGFydGVkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFByb2Nlc3NJbmxpbmVTY2hlbWEoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlYWRlci5Ob2RlVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRWxlbWVudDoNCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlRWxlbWVudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWRlci5Jc0VtcHR5RWxlbWVudCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGNhc2UgWG1sTm9kZVR5cGUuRW5kRWxlbWVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLldoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICBWYWxpZGF0ZVdoaXRlc3BhY2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlRleHQ6ICAgICAgICAgIC8vIHRleHQgaW5zaWRlIGEgbm9kZQ0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNEQVRBOiAgICAgICAgIC8vIDwhW0NEQVRBWy4uLl1dPg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlVGV4dCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRW5kRWxlbWVudDoNCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbGlkYXRlRW5kRWxlbWVudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBDb21wbGV0ZVZhbGlkYXRpb24oKQ0KICAgICAgICB7DQogICAgICAgICAgICBDaGVja0ZvcndhcmRSZWZzKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGJvb2wgSXNJbmxpbmVTY2hlbWFTdGFydGVkDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaW5saW5lU2NoZW1hUGFyc2VyICE9IG51bGw7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQcm9jZXNzSW5saW5lU2NoZW1hKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFfaW5saW5lU2NoZW1hUGFyc2VyLlBhcnNlUmVhZGVyTm9kZSgpKQ0KICAgICAgICAgICAgeyAvLyBEb25lDQogICAgICAgICAgICAgICAgX2lubGluZVNjaGVtYVBhcnNlci5GaW5pc2hQYXJzaW5nKCk7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYSA9IF9pbmxpbmVTY2hlbWFQYXJzZXIuWG1sU2NoZW1hOw0KICAgICAgICAgICAgICAgIHN0cmluZyBpbmxpbmVOUyA9IG51bGw7DQogICAgICAgICAgICAgICAgaWYgKHNjaGVtYSAhPSBudWxsICYmIHNjaGVtYS5FcnJvckNvdW50ID09IDApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2NoZW1hSW5mbyBpbmxpbmVTY2hlbWFJbmZvID0gbmV3IFNjaGVtYUluZm8oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlubGluZVNjaGVtYUluZm8uU2NoZW1hVHlwZSA9IFNjaGVtYVR5cGUuWFNEOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW5saW5lTlMgPSBzY2hlbWEuVGFyZ2V0TmFtZXNwYWNlID09IG51bGwgPyBzdHJpbmcuRW1wdHkgOiBzY2hlbWEuVGFyZ2V0TmFtZXNwYWNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFTY2hlbWFJbmZvLlRhcmdldE5hbWVzcGFjZXMuQ29udGFpbnNLZXkoaW5saW5lTlMpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTY2hlbWFDb2xsZWN0aW9uLkFkZChpbmxpbmVOUywgaW5saW5lU2NoZW1hSW5mbywgc2NoZW1hLCB0cnVlKSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgLy9JZiBubyBlcnJvcnMgb24gY29tcGlsZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0FkZCB0byB2YWxpZGF0b3IncyBTY2hlbWFJbmZvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNjaGVtYUluZm8uQWRkKGlubGluZVNjaGVtYUluZm8sIEV2ZW50SGFuZGxlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChYbWxTY2hlbWFFeGNlcHRpb24gZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfQ2Fubm90TG9hZFNjaGVtYSwgbmV3IHN0cmluZ1tdIHsgQmFzZVVyaS5BYnNvbHV0ZVVyaSwgZS5NZXNzYWdlIH0sIFhtbFNldmVyaXR5VHlwZS5FcnJvcik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgX2lubGluZVNjaGVtYVBhcnNlciA9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgVmFsaWRhdGVFbGVtZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgZWxlbWVudE5hbWUuSW5pdChyZWFkZXIuTG9jYWxOYW1lLCByZWFkZXIuTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgIG9iamVjdCBwYXJ0aWNsZSA9IFZhbGlkYXRlQ2hpbGRFbGVtZW50KCk7DQogICAgICAgICAgICBpZiAoSXNYU0RSb290KGVsZW1lbnROYW1lLk5hbWUsIGVsZW1lbnROYW1lLk5hbWVzcGFjZSkgJiYgcmVhZGVyLkRlcHRoID4gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfaW5saW5lU2NoZW1hUGFyc2VyID0gbmV3IFBhcnNlcihTY2hlbWFUeXBlLlhTRCwgTmFtZVRhYmxlLCBTY2hlbWFOYW1lcywgRXZlbnRIYW5kbGVyKTsNCiAgICAgICAgICAgICAgICBfaW5saW5lU2NoZW1hUGFyc2VyLlN0YXJ0UGFyc2luZyhyZWFkZXIsIG51bGwpOw0KICAgICAgICAgICAgICAgIFByb2Nlc3NJbmxpbmVTY2hlbWEoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBQcm9jZXNzRWxlbWVudChwYXJ0aWNsZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIG9iamVjdCBWYWxpZGF0ZUNoaWxkRWxlbWVudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIG9iamVjdCBwYXJ0aWNsZSA9IG51bGw7DQogICAgICAgICAgICBpbnQgZXJyb3JDb2RlID0gMDsNCiAgICAgICAgICAgIGlmIChjb250ZXh0Lk5lZWRWYWxpZGF0ZUNoaWxkcmVuKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LklzTmlsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0NvbnRlbnRJbk5pbGwsIGVsZW1lbnROYW1lLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcGFydGljbGUgPSBjb250ZXh0LkVsZW1lbnREZWNsLkNvbnRlbnRWYWxpZGF0b3IuVmFsaWRhdGVFbGVtZW50KGVsZW1lbnROYW1lLCBjb250ZXh0LCBvdXQgZXJyb3JDb2RlKTsNCiAgICAgICAgICAgICAgICBpZiAocGFydGljbGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9wcm9jZXNzQ29udGVudHMgPSBjb250ZXh0LlByb2Nlc3NDb250ZW50cyA9IFhtbFNjaGVtYUNvbnRlbnRQcm9jZXNzaW5nLlNraXA7DQogICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckNvZGUgPT0gLTIpDQogICAgICAgICAgICAgICAgICAgIHsgLy9Db250ZW50TW9kZWwgYWxsIGdyb3VwIGVycm9yDQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9BbGxFbGVtZW50LCBlbGVtZW50TmFtZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFWYWxpZGF0b3IuRWxlbWVudFZhbGlkYXRpb25FcnJvcihlbGVtZW50TmFtZSwgY29udGV4dCwgRXZlbnRIYW5kbGVyLCByZWFkZXIsIHJlYWRlci5CYXNlVVJJLCBQb3NpdGlvbkluZm8uTGluZU51bWJlciwgUG9zaXRpb25JbmZvLkxpbmVQb3NpdGlvbiwgbnVsbCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHBhcnRpY2xlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByb2Nlc3NFbGVtZW50KG9iamVjdCBwYXJ0aWNsZSkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sUXVhbGlmaWVkTmFtZSB4c2lUeXBlOw0KICAgICAgICAgICAgc3RyaW5nIHhzaU5pbDsNCiAgICAgICAgICAgIFNjaGVtYUVsZW1lbnREZWNsIGVsZW1lbnREZWNsID0gRmFzdEdldEVsZW1lbnREZWNsKHBhcnRpY2xlKTsNCiAgICAgICAgICAgIFB1c2goZWxlbWVudE5hbWUpOw0KICAgICAgICAgICAgaWYgKF9iTWFuYWdlTmFtZXNwYWNlcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfbnNNYW5hZ2VyLlB1c2hTY29wZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgUHJvY2Vzc1hzaUF0dHJpYnV0ZXMob3V0IHhzaVR5cGUsIG91dCB4c2lOaWwpOw0KICAgICAgICAgICAgaWYgKF9wcm9jZXNzQ29udGVudHMgIT0gWG1sU2NoZW1hQ29udGVudFByb2Nlc3NpbmcuU2tpcCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudERlY2wgPT0gbnVsbCB8fCAheHNpVHlwZS5Jc0VtcHR5IHx8IHhzaU5pbCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudERlY2wgPSBUaG9yb3VnaEdldEVsZW1lbnREZWNsKGVsZW1lbnREZWNsLCB4c2lUeXBlLCB4c2lOaWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudERlY2wgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChIYXNTY2hlbWEgJiYgX3Byb2Nlc3NDb250ZW50cyA9PSBYbWxTY2hlbWFDb250ZW50UHJvY2Vzc2luZy5TdHJpY3QpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1VuZGVjbGFyZWRFbGVtZW50LCBYbWxTY2hlbWFWYWxpZGF0b3IuUU5hbWVTdHJpbmcoY29udGV4dC5Mb2NhbE5hbWUsIGNvbnRleHQuTmFtZXNwYWNlKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Ob0VsZW1lbnRTY2hlbWFGb3VuZCwgWG1sU2NoZW1hVmFsaWRhdG9yLlFOYW1lU3RyaW5nKGNvbnRleHQuTG9jYWxOYW1lLCBjb250ZXh0Lk5hbWVzcGFjZSksIFhtbFNldmVyaXR5VHlwZS5XYXJuaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgY29udGV4dC5FbGVtZW50RGVjbCA9IGVsZW1lbnREZWNsOw0KICAgICAgICAgICAgVmFsaWRhdGVTdGFydEVsZW1lbnRJZGVudGl0eUNvbnN0cmFpbnRzKCk7DQogICAgICAgICAgICBWYWxpZGF0ZVN0YXJ0RWxlbWVudCgpOw0KICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWYWxpZGF0ZUVuZFN0YXJ0RWxlbWVudCgpOw0KICAgICAgICAgICAgICAgIGNvbnRleHQuTmVlZFZhbGlkYXRlQ2hpbGRyZW4gPSBfcHJvY2Vzc0NvbnRlbnRzICE9IFhtbFNjaGVtYUNvbnRlbnRQcm9jZXNzaW5nLlNraXA7DQogICAgICAgICAgICAgICAgY29udGV4dC5FbGVtZW50RGVjbC5Db250ZW50VmFsaWRhdG9yLkluaXRWYWxpZGF0aW9uKGNvbnRleHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU3hTOiBUaGlzIG1ldGhvZCBwcm9jZXNzZXMgYXR0cmlidXRlcyByZWFkIGZyb20gc291cmNlIGRvY3VtZW50IGFuZCBkb2VzIG5vdCBleHBvc2UgYW55IHJlc291cmNlcy4gDQogICAgICAgIC8vIEl0J3MgT0sgdG8gc3VwcHJlc3MgdGhlIFN4UyB3YXJuaW5nLg0KICAgICAgICBwcml2YXRlIHZvaWQgUHJvY2Vzc1hzaUF0dHJpYnV0ZXMob3V0IFhtbFF1YWxpZmllZE5hbWUgeHNpVHlwZSwgb3V0IHN0cmluZyB4c2lOaWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZ1tdIHhzaVNjaGVtYUxvY2F0aW9uID0gbnVsbDsNCiAgICAgICAgICAgIHN0cmluZyB4c2lOb05hbWVzcGFjZVNjaGVtYUxvY2F0aW9uID0gbnVsbDsNCiAgICAgICAgICAgIHhzaVR5cGUgPSBYbWxRdWFsaWZpZWROYW1lLkVtcHR5Ow0KICAgICAgICAgICAgeHNpTmlsID0gbnVsbDsNCg0KICAgICAgICAgICAgaWYgKHJlYWRlci5EZXB0aCA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vTG9hZCBzY2hlbWEgZm9yIGVtcHR5IG5hbWVzcGFjZQ0KICAgICAgICAgICAgICAgIExvYWRTY2hlbWEoc3RyaW5nLkVtcHR5LCBudWxsKTsNCg0KICAgICAgICAgICAgICAgIC8vU2hvdWxkIGxvYWQgc2NoZW1hcyBmb3IgbmFtZXNwYWNlcyBhbHJlYWR5IGFkZGVkIHRvIG5zTWFuYWdlcg0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyBucyBpbiBfbnNNYW5hZ2VyLkdldE5hbWVzcGFjZXNJblNjb3BlKFhtbE5hbWVzcGFjZVNjb3BlLkV4Y2x1ZGVYbWwpLlZhbHVlcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIExvYWRTY2hlbWEobnMsIG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHJlYWRlci5Nb3ZlVG9GaXJzdEF0dHJpYnV0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGRvDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgb2JqZWN0TnMgPSByZWFkZXIuTmFtZXNwYWNlVVJJOw0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgb2JqZWN0TmFtZSA9IHJlYWRlci5Mb2NhbE5hbWU7DQogICAgICAgICAgICAgICAgICAgIGlmIChSZWYuRXF1YWwob2JqZWN0TnMsIF9uc1htbE5zKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgTG9hZFNjaGVtYShyZWFkZXIuVmFsdWUsIG51bGwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9iTWFuYWdlTmFtZXNwYWNlcykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbnNNYW5hZ2VyLkFkZE5hbWVzcGFjZShyZWFkZXIuUHJlZml4Lkxlbmd0aCA9PSAwID8gc3RyaW5nLkVtcHR5IDogcmVhZGVyLkxvY2FsTmFtZSwgcmVhZGVyLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChSZWYuRXF1YWwob2JqZWN0TnMsIF9uc1hzaSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSZWYuRXF1YWwob2JqZWN0TmFtZSwgX3hzaVNjaGVtYUxvY2F0aW9uKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2lTY2hlbWFMb2NhdGlvbiA9IChzdHJpbmdbXSlzX2R0U3RyaW5nQXJyYXkuUGFyc2VWYWx1ZShyZWFkZXIuVmFsdWUsIE5hbWVUYWJsZSwgX25zTWFuYWdlcik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChSZWYuRXF1YWwob2JqZWN0TmFtZSwgX3hzaU5vTmFtZXNwYWNlU2NoZW1hTG9jYXRpb24pKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzaU5vTmFtZXNwYWNlU2NoZW1hTG9jYXRpb24gPSByZWFkZXIuVmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChSZWYuRXF1YWwob2JqZWN0TmFtZSwgX3hzaVR5cGUpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzaVR5cGUgPSAoWG1sUXVhbGlmaWVkTmFtZSlzX2R0UU5hbWUuUGFyc2VWYWx1ZShyZWFkZXIuVmFsdWUsIE5hbWVUYWJsZSwgX25zTWFuYWdlcik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChSZWYuRXF1YWwob2JqZWN0TmFtZSwgX3hzaU5pbCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNpTmlsID0gcmVhZGVyLlZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSB3aGlsZSAocmVhZGVyLk1vdmVUb05leHRBdHRyaWJ1dGUoKSk7DQogICAgICAgICAgICAgICAgcmVhZGVyLk1vdmVUb0VsZW1lbnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh4c2lOb05hbWVzcGFjZVNjaGVtYUxvY2F0aW9uICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFNjaGVtYShzdHJpbmcuRW1wdHksIHhzaU5vTmFtZXNwYWNlU2NoZW1hTG9jYXRpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHhzaVNjaGVtYUxvY2F0aW9uICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB4c2lTY2hlbWFMb2NhdGlvbi5MZW5ndGggLSAxOyBpICs9IDIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBMb2FkU2NoZW1hKChzdHJpbmcpeHNpU2NoZW1hTG9jYXRpb25baV0sIChzdHJpbmcpeHNpU2NoZW1hTG9jYXRpb25baSArIDFdKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgVmFsaWRhdGVFbmRFbGVtZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKF9iTWFuYWdlTmFtZXNwYWNlcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfbnNNYW5hZ2VyLlBvcFNjb3BlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY29udGV4dC5FbGVtZW50RGVjbCAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICghY29udGV4dC5Jc05pbGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5OZWVkVmFsaWRhdGVDaGlsZHJlbikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb250ZXh0LkVsZW1lbnREZWNsLkNvbnRlbnRWYWxpZGF0b3IuQ29tcGxldGVWYWxpZGF0aW9uKGNvbnRleHQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVZhbGlkYXRvci5Db21wbGV0ZVZhbGlkYXRpb25FcnJvcihjb250ZXh0LCBFdmVudEhhbmRsZXIsIHJlYWRlciwgcmVhZGVyLkJhc2VVUkksIFBvc2l0aW9uSW5mby5MaW5lTnVtYmVyLCBQb3NpdGlvbkluZm8uTGluZVBvc2l0aW9uLCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGlmIChjaGVja0RhdGF0eXBlICYmICFjb250ZXh0LklzTmlsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHN0cmluZ1ZhbHVlID0gIWhhc1NpYmxpbmcgPyB0ZXh0U3RyaW5nIDogdGV4dFZhbHVlLlRvU3RyaW5nKCk7ICAvLyBvbmx5IGZvciBpZGVudGl0eS1jb25zdHJhaW50IGV4Y2VwdGlvbiByZXBvcnRpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKHN0cmluZ1ZhbHVlLkxlbmd0aCA9PSAwICYmIGNvbnRleHQuRWxlbWVudERlY2wuRGVmYXVsdFZhbHVlVHlwZWQgIT0gbnVsbCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tWYWx1ZShzdHJpbmdWYWx1ZSwgbnVsbCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tEYXRhdHlwZSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gZm9yIGVhY2ggbGV2ZWwgaW4gdGhlIHN0YWNrLCBlbmRjaGlsZHJlbiBhbmQgZmlsbCB2YWx1ZSBmcm9tIGVsZW1lbnQNCiAgICAgICAgICAgICAgICBpZiAoSGFzSWRlbnRpdHlDb25zdHJhaW50cykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEVuZEVsZW1lbnRJZGVudGl0eUNvbnN0cmFpbnRzKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgUG9wKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFNjaGVtYUVsZW1lbnREZWNsIEZhc3RHZXRFbGVtZW50RGVjbChvYmplY3QgcGFydGljbGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFNjaGVtYUVsZW1lbnREZWNsIGVsZW1lbnREZWNsID0gbnVsbDsNCiAgICAgICAgICAgIGlmIChwYXJ0aWNsZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYUVsZW1lbnQgZWxlbWVudCA9IHBhcnRpY2xlIGFzIFhtbFNjaGVtYUVsZW1lbnQ7DQogICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGVsZW1lbnREZWNsID0gZWxlbWVudC5FbGVtZW50RGVjbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hQW55IGFueSA9IChYbWxTY2hlbWFBbnkpcGFydGljbGU7DQogICAgICAgICAgICAgICAgICAgIF9wcm9jZXNzQ29udGVudHMgPSBhbnkuUHJvY2Vzc0NvbnRlbnRzQ29ycmVjdDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZWxlbWVudERlY2w7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFNjaGVtYUVsZW1lbnREZWNsIFRob3JvdWdoR2V0RWxlbWVudERlY2woU2NoZW1hRWxlbWVudERlY2wgZWxlbWVudERlY2wsIFhtbFF1YWxpZmllZE5hbWUgeHNpVHlwZSwgc3RyaW5nIHhzaU5pbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGVsZW1lbnREZWNsID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZWxlbWVudERlY2wgPSBzY2hlbWFJbmZvLkdldEVsZW1lbnREZWNsKGVsZW1lbnROYW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChlbGVtZW50RGVjbCAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICh4c2lUeXBlLklzRW1wdHkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudERlY2wuSXNBYnN0cmFjdCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfQWJzdHJhY3RFbGVtZW50LCBYbWxTY2hlbWFWYWxpZGF0b3IuUU5hbWVTdHJpbmcoY29udGV4dC5Mb2NhbE5hbWUsIGNvbnRleHQuTmFtZXNwYWNlKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50RGVjbCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoeHNpTmlsICE9IG51bGwgJiYgeHNpTmlsLkVxdWFscygidHJ1ZSIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfWHNpTmlsQW5kVHlwZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNjaGVtYUVsZW1lbnREZWNsIGVsZW1lbnREZWNsWHNpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIXNjaGVtYUluZm8uRWxlbWVudERlY2xzQnlUeXBlLlRyeUdldFZhbHVlKHhzaVR5cGUsIG91dCBlbGVtZW50RGVjbFhzaSkgJiYgeHNpVHlwZS5OYW1lc3BhY2UgPT0gX25zWHMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZVR5cGUgc2ltcGxlVHlwZSA9IERhdGF0eXBlSW1wbGVtZW50YXRpb24uR2V0U2ltcGxlVHlwZUZyb21Yc2RUeXBlKG5ldyBYbWxRdWFsaWZpZWROYW1lKHhzaVR5cGUuTmFtZSwgX25zWHMpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaW1wbGVUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudERlY2xYc2kgPSBzaW1wbGVUeXBlLkVsZW1lbnREZWNsOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50RGVjbFhzaSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9Yc2lUeXBlTm90Rm91bmQsIHhzaVR5cGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50RGVjbCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIVhtbFNjaGVtYVR5cGUuSXNEZXJpdmVkRnJvbShlbGVtZW50RGVjbFhzaS5TY2hlbWFUeXBlLCBlbGVtZW50RGVjbC5TY2hlbWFUeXBlLCBlbGVtZW50RGVjbC5CbG9jaykpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1hzaVR5cGVCbG9ja2VkRXgsIG5ldyBzdHJpbmdbXSB7IHhzaVR5cGUuVG9TdHJpbmcoKSwgWG1sU2NoZW1hVmFsaWRhdG9yLlFOYW1lU3RyaW5nKGNvbnRleHQuTG9jYWxOYW1lLCBjb250ZXh0Lk5hbWVzcGFjZSkgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50RGVjbCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50RGVjbCA9IGVsZW1lbnREZWNsWHNpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChlbGVtZW50RGVjbCAhPSBudWxsICYmIGVsZW1lbnREZWNsLklzTmlsbGFibGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoeHNpTmlsICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuSXNOaWxsID0gWG1sQ29udmVydC5Ub0Jvb2xlYW4oeHNpTmlsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LklzTmlsbCAmJiBlbGVtZW50RGVjbC5EZWZhdWx0VmFsdWVUeXBlZCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX1hzaU5pbEFuZEZpeGVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICh4c2lOaWwgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ludmFsaWRYc2lOaWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZWxlbWVudERlY2w7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgVmFsaWRhdGVTdGFydEVsZW1lbnQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoY29udGV4dC5FbGVtZW50RGVjbCAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LkVsZW1lbnREZWNsLklzQWJzdHJhY3QpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9BYnN0cmFjdEVsZW1lbnQsIFhtbFNjaGVtYVZhbGlkYXRvci5RTmFtZVN0cmluZyhjb250ZXh0LkxvY2FsTmFtZSwgY29udGV4dC5OYW1lc3BhY2UpKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZWFkZXIuU2NoZW1hVHlwZU9iamVjdCA9IGNvbnRleHQuRWxlbWVudERlY2wuU2NoZW1hVHlwZTsNCg0KICAgICAgICAgICAgICAgIGlmIChyZWFkZXIuSXNFbXB0eUVsZW1lbnQgJiYgIWNvbnRleHQuSXNOaWxsICYmIGNvbnRleHQuRWxlbWVudERlY2wuRGVmYXVsdFZhbHVlVHlwZWQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJlYWRlci5UeXBlZFZhbHVlT2JqZWN0ID0gVW5XcmFwVW5pb24oY29udGV4dC5FbGVtZW50RGVjbC5EZWZhdWx0VmFsdWVUeXBlZCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuSXNOaWxsID0gdHJ1ZTsgLy8gcmV1c2luZyBJc05pbGwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLlR5cGVkVmFsdWVPYmplY3QgPSBudWxsOyAvL1R5cGVkIHZhbHVlIGNsZWFudXAgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRleHQuRWxlbWVudERlY2wuSGFzUmVxdWlyZWRBdHRyaWJ1dGUgfHwgSGFzSWRlbnRpdHlDb25zdHJhaW50cykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9hdHRQcmVzZW5jZS5DbGVhcigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHJlYWRlci5Nb3ZlVG9GaXJzdEF0dHJpYnV0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGRvDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoKG9iamVjdClyZWFkZXIuTmFtZXNwYWNlVVJJID09IChvYmplY3QpX25zWG1sTnMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmICgob2JqZWN0KXJlYWRlci5OYW1lc3BhY2VVUkkgPT0gKG9iamVjdClfbnNYc2kpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5TY2hlbWFUeXBlT2JqZWN0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFF1YWxpZmllZE5hbWUgYXR0UU5hbWUgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZShyZWFkZXIuTG9jYWxOYW1lLCByZWFkZXIuTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgc2tpcENvbnRlbnRzID0gKF9wcm9jZXNzQ29udGVudHMgPT0gWG1sU2NoZW1hQ29udGVudFByb2Nlc3NpbmcuU2tpcCk7DQogICAgICAgICAgICAgICAgICAgICAgICBTY2hlbWFBdHREZWYgYXR0bkRlZiA9IHNjaGVtYUluZm8uR2V0QXR0cmlidXRlWHNkKGNvbnRleHQuRWxlbWVudERlY2wsIGF0dFFOYW1lLCByZWYgc2tpcENvbnRlbnRzKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dG5EZWYgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5FbGVtZW50RGVjbCAhPSBudWxsICYmIChjb250ZXh0LkVsZW1lbnREZWNsLkhhc1JlcXVpcmVkQXR0cmlidXRlIHx8IF9zdGFydElEQ29uc3RyYWludCAhPSAtMSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYXR0UHJlc2VuY2UuQWRkKGF0dG5EZWYuTmFtZSwgYXR0bkRlZik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLkFzc2VydChhdHRuRGVmLlNjaGVtYVR5cGUgIT0gbnVsbCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLlNjaGVtYVR5cGVPYmplY3QgPSBhdHRuRGVmLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dG5EZWYuRGF0YXR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gY2hlY2sgdGhlIGNvbnRlbnRzIG9mIHRoaXMgYXR0cmlidXRlIHRvIG1ha2Ugc3VyZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCBpcyB2YWxpZCBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmllZCBhdHRyaWJ1dGUgdHlwZS4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tWYWx1ZShyZWFkZXIuVmFsdWUsIGF0dG5EZWYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGFzSWRlbnRpdHlDb25zdHJhaW50cykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF0dHJpYnV0ZUlkZW50aXR5Q29uc3RyYWludHMocmVhZGVyLkxvY2FsTmFtZSwgcmVhZGVyLk5hbWVzcGFjZVVSSSwgcmVhZGVyLlR5cGVkVmFsdWVPYmplY3QsIHJlYWRlci5WYWx1ZSwgYXR0bkRlZik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIXNraXBDb250ZW50cykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5FbGVtZW50RGVjbCA9PSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIF9wcm9jZXNzQ29udGVudHMgPT0gWG1sU2NoZW1hQ29udGVudFByb2Nlc3NpbmcuU3RyaWN0DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIGF0dFFOYW1lLk5hbWVzcGFjZS5MZW5ndGggIT0gMA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBzY2hlbWFJbmZvLkNvbnRhaW5zKGF0dFFOYW1lLk5hbWVzcGFjZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfVW5kZWNsYXJlZEF0dHJpYnV0ZSwgYXR0UU5hbWUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX05vQXR0cmlidXRlU2NoZW1hRm91bmQsIGF0dFFOYW1lLlRvU3RyaW5nKCksIFhtbFNldmVyaXR5VHlwZS5XYXJuaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKFhtbFNjaGVtYUV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBlLlNldFNvdXJjZShyZWFkZXIuQmFzZVVSSSwgUG9zaXRpb25JbmZvLkxpbmVOdW1iZXIsIFBvc2l0aW9uSW5mby5MaW5lUG9zaXRpb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gd2hpbGUgKHJlYWRlci5Nb3ZlVG9OZXh0QXR0cmlidXRlKCkpOw0KICAgICAgICAgICAgICAgIHJlYWRlci5Nb3ZlVG9FbGVtZW50KCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgVmFsaWRhdGVFbmRTdGFydEVsZW1lbnQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoY29udGV4dC5FbGVtZW50RGVjbC5IYXNEZWZhdWx0QXR0cmlidXRlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29udGV4dC5FbGVtZW50RGVjbC5EZWZhdWx0QXR0RGVmcy5Db3VudDsgKytpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2NoZW1hQXR0RGVmIGF0dGRlZiA9IChTY2hlbWFBdHREZWYpY29udGV4dC5FbGVtZW50RGVjbC5EZWZhdWx0QXR0RGVmc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLkFkZERlZmF1bHRBdHRyaWJ1dGUoYXR0ZGVmKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gZXZlbiBkZWZhdWx0IGF0dHJpYnV0ZSBpIGhhdmUgdG8gbW92ZSB0by4uLiBidXQgY2FuJ3QgZXhpc3QNCiAgICAgICAgICAgICAgICAgICAgaWYgKEhhc0lkZW50aXR5Q29uc3RyYWludHMgJiYgIV9hdHRQcmVzZW5jZS5Db250YWlucyhhdHRkZWYuTmFtZSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEF0dHJpYnV0ZUlkZW50aXR5Q29uc3RyYWludHMoYXR0ZGVmLk5hbWUuTmFtZSwgYXR0ZGVmLk5hbWUuTmFtZXNwYWNlLCBVbldyYXBVbmlvbihhdHRkZWYuRGVmYXVsdFZhbHVlVHlwZWQpLCBhdHRkZWYuRGVmYXVsdFZhbHVlUmF3LCBhdHRkZWYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoY29udGV4dC5FbGVtZW50RGVjbC5IYXNSZXF1aXJlZEF0dHJpYnV0ZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuRWxlbWVudERlY2wuQ2hlY2tBdHRyaWJ1dGVzKF9hdHRQcmVzZW5jZSwgcmVhZGVyLlN0YW5kQWxvbmUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hRXhjZXB0aW9uIGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBlLlNldFNvdXJjZShyZWFkZXIuQmFzZVVSSSwgUG9zaXRpb25JbmZvLkxpbmVOdW1iZXIsIFBvc2l0aW9uSW5mby5MaW5lUG9zaXRpb24pOw0KICAgICAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChjb250ZXh0LkVsZW1lbnREZWNsLkRhdGF0eXBlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2hlY2tEYXRhdHlwZSA9IHRydWU7DQogICAgICAgICAgICAgICAgaGFzU2libGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHRleHRTdHJpbmcgPSBzdHJpbmcuRW1wdHk7DQogICAgICAgICAgICAgICAgdGV4dFZhbHVlLkxlbmd0aCA9IDA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgTG9hZFNjaGVtYUZyb21Mb2NhdGlvbihzdHJpbmcgdXJpLCBzdHJpbmcgdXJsKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxSZWFkZXIgcmVhZGVyID0gbnVsbDsNCiAgICAgICAgICAgIFNjaGVtYUluZm8gc2NoZW1hSW5mbyA9IG51bGw7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFVyaSBydXJpID0gdGhpcy5YbWxSZXNvbHZlci5SZXNvbHZlVXJpKEJhc2VVcmksIHVybCk7DQogICAgICAgICAgICAgICAgU3RyZWFtIHN0bSA9IChTdHJlYW0pdGhpcy5YbWxSZXNvbHZlci5HZXRFbnRpdHkocnVyaSwgbnVsbCwgbnVsbCk7DQogICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3IFhtbFRleHRSZWFkZXIocnVyaS5Ub1N0cmluZygpLCBzdG0sIE5hbWVUYWJsZSk7DQogICAgICAgICAgICAgICAgLy9YbWxTY2hlbWEgc2NoZW1hID0gU2NoZW1hQ29sbGVjdGlvbi5BZGQodXJpLCByZWFkZXIsIHRoaXMuWG1sUmVzb2x2ZXIpOw0KDQogICAgICAgICAgICAgICAgUGFyc2VyIHBhcnNlciA9IG5ldyBQYXJzZXIoU2NoZW1hVHlwZS5YU0QsIE5hbWVUYWJsZSwgU2NoZW1hTmFtZXMsIEV2ZW50SGFuZGxlcik7DQogICAgICAgICAgICAgICAgcGFyc2VyLlhtbFJlc29sdmVyID0gdGhpcy5YbWxSZXNvbHZlcjsNCiAgICAgICAgICAgICAgICBTY2hlbWFUeXBlIHNjaGVtYVR5cGUgPSBwYXJzZXIuUGFyc2UocmVhZGVyLCB1cmkpOw0KDQogICAgICAgICAgICAgICAgc2NoZW1hSW5mbyA9IG5ldyBTY2hlbWFJbmZvKCk7DQogICAgICAgICAgICAgICAgc2NoZW1hSW5mby5TY2hlbWFUeXBlID0gc2NoZW1hVHlwZTsNCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSA9PSBTY2hlbWFUeXBlLlhTRCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChTY2hlbWFDb2xsZWN0aW9uLkV2ZW50SGFuZGxlciA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBTY2hlbWFDb2xsZWN0aW9uLkV2ZW50SGFuZGxlciA9IHRoaXMuRXZlbnRIYW5kbGVyOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIFNjaGVtYUNvbGxlY3Rpb24uQWRkKHVyaSwgc2NoZW1hSW5mbywgcGFyc2VyLlhtbFNjaGVtYSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vQWRkIHRvIHZhbGlkYXRvcidzIFNjaGVtYUluZm8NCiAgICAgICAgICAgICAgICBTY2hlbWFJbmZvLkFkZChzY2hlbWFJbmZvLCBFdmVudEhhbmRsZXIpOw0KDQogICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5SZWFkKCkpIDsvLyB3ZWxsZm9ybW5lc3MgY2hlY2sNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxTY2hlbWFFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzY2hlbWFJbmZvID0gbnVsbDsNCiAgICAgICAgICAgICAgICBTZW5kVmFsaWRhdGlvbkV2ZW50KFNSLlNjaF9DYW5ub3RMb2FkU2NoZW1hLCBuZXcgc3RyaW5nW10geyB1cmksIGUuTWVzc2FnZSB9LCBYbWxTZXZlcml0eVR5cGUuRXJyb3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNjaGVtYUluZm8gPSBudWxsOw0KICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0Nhbm5vdExvYWRTY2hlbWEsIG5ldyBzdHJpbmdbXSB7IHVyaSwgZS5NZXNzYWdlIH0sIFhtbFNldmVyaXR5VHlwZS5XYXJuaW5nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAocmVhZGVyICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZWFkZXIuQ2xvc2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgTG9hZFNjaGVtYShzdHJpbmcgdXJpLCBzdHJpbmcgdXJsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAodGhpcy5YbWxSZXNvbHZlciA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChTY2hlbWFJbmZvLlRhcmdldE5hbWVzcGFjZXMuQ29udGFpbnNLZXkodXJpKSAmJiBfbnNNYW5hZ2VyLkxvb2t1cFByZWZpeCh1cmkpICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBTY2hlbWFJbmZvIHNjaGVtYUluZm8gPSBudWxsOw0KICAgICAgICAgICAgaWYgKFNjaGVtYUNvbGxlY3Rpb24gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBzY2hlbWFJbmZvID0gU2NoZW1hQ29sbGVjdGlvbi5HZXRTY2hlbWFJbmZvKHVyaSk7DQogICAgICAgICAgICBpZiAoc2NoZW1hSW5mbyAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvLlNjaGVtYVR5cGUgIT0gU2NoZW1hVHlwZS5YU0QpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgWG1sRXhjZXB0aW9uKFNSLlhtbF9NdWx0aXBsZVZhbGlkYWl0b25UeXBlcywgc3RyaW5nLkVtcHR5LCB0aGlzLlBvc2l0aW9uSW5mby5MaW5lTnVtYmVyLCB0aGlzLlBvc2l0aW9uSW5mby5MaW5lUG9zaXRpb24pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBTY2hlbWFJbmZvLkFkZChzY2hlbWFJbmZvLCBFdmVudEhhbmRsZXIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh1cmwgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkU2NoZW1hRnJvbUxvY2F0aW9uKHVyaSwgdXJsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYm9vbCBIYXNTY2hlbWEgeyBnZXQgeyByZXR1cm4gc2NoZW1hSW5mby5TY2hlbWFUeXBlICE9IFNjaGVtYVR5cGUuTm9uZTsgfSB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgUHJlc2VydmVXaGl0ZXNwYWNlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBjb250ZXh0LkVsZW1lbnREZWNsICE9IG51bGwgPyBjb250ZXh0LkVsZW1lbnREZWNsLkNvbnRlbnRWYWxpZGF0b3IuUHJlc2VydmVXaGl0ZXNwYWNlIDogZmFsc2U7IH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFByb2Nlc3NUb2tlbml6ZWRUeXBlKA0KICAgICAgICAgICAgWG1sVG9rZW5pemVkVHlwZSB0dHlwZSwNCiAgICAgICAgICAgIHN0cmluZyBuYW1lDQogICAgICAgICkNCiAgICAgICAgew0KICAgICAgICAgICAgc3dpdGNoICh0dHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhtbFRva2VuaXplZFR5cGUuSUQ6DQogICAgICAgICAgICAgICAgICAgIGlmIChGaW5kSWQobmFtZSkgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRHVwSWQsIG5hbWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQWRkSUQobmFtZSwgY29udGV4dC5Mb2NhbE5hbWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgWG1sVG9rZW5pemVkVHlwZS5JRFJFRjoNCiAgICAgICAgICAgICAgICAgICAgb2JqZWN0IHAgPSBGaW5kSWQobmFtZSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsgLy8gYWRkIGl0IHRvIGxpbmtlZCBsaXN0IHRvIGNoZWNrIGl0IGxhdGVyDQogICAgICAgICAgICAgICAgICAgICAgICBfaWRSZWZMaXN0SGVhZCA9IG5ldyBJZFJlZk5vZGUoX2lkUmVmTGlzdEhlYWQsIG5hbWUsIHRoaXMuUG9zaXRpb25JbmZvLkxpbmVOdW1iZXIsIHRoaXMuUG9zaXRpb25JbmZvLkxpbmVQb3NpdGlvbik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBYbWxUb2tlbml6ZWRUeXBlLkVOVElUWToNCiAgICAgICAgICAgICAgICAgICAgUHJvY2Vzc0VudGl0eShzY2hlbWFJbmZvLCBuYW1lLCB0aGlzLCBFdmVudEhhbmRsZXIsIHJlYWRlci5CYXNlVVJJLCBQb3NpdGlvbkluZm8uTGluZU51bWJlciwgUG9zaXRpb25JbmZvLkxpbmVQb3NpdGlvbik7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIENoZWNrVmFsdWUoDQogICAgICAgICAgICBzdHJpbmcgdmFsdWUsDQogICAgICAgICAgICBTY2hlbWFBdHREZWYgYXR0ZGVmDQogICAgICAgICkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVhZGVyLlR5cGVkVmFsdWVPYmplY3QgPSBudWxsOw0KICAgICAgICAgICAgICAgIGJvb2wgaXNBdHRuID0gYXR0ZGVmICE9IG51bGw7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZHR5cGUgPSBpc0F0dG4gPyBhdHRkZWYuRGF0YXR5cGUgOiBjb250ZXh0LkVsZW1lbnREZWNsLkRhdGF0eXBlOw0KICAgICAgICAgICAgICAgIGlmIChkdHlwZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBubyByZWFzb24gdG8gY2hlY2sNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBvYmplY3QgdHlwZWRWYWx1ZSA9IGR0eXBlLlBhcnNlVmFsdWUodmFsdWUsIE5hbWVUYWJsZSwgX25zTWFuYWdlciwgdHJ1ZSk7DQoNCiAgICAgICAgICAgICAgICAvLyBDaGVjayBzcGVjaWFsIHR5cGVzDQogICAgICAgICAgICAgICAgWG1sVG9rZW5pemVkVHlwZSB0dHlwZSA9IGR0eXBlLlRva2VuaXplZFR5cGU7DQogICAgICAgICAgICAgICAgaWYgKHR0eXBlID09IFhtbFRva2VuaXplZFR5cGUuRU5USVRZIHx8IHR0eXBlID09IFhtbFRva2VuaXplZFR5cGUuSUQgfHwgdHR5cGUgPT0gWG1sVG9rZW5pemVkVHlwZS5JRFJFRikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChkdHlwZS5WYXJpZXR5ID09IFhtbFNjaGVtYURhdGF0eXBlVmFyaWV0eS5MaXN0KQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBzcyA9IChzdHJpbmdbXSl0eXBlZFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzcy5MZW5ndGg7ICsraSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNzVG9rZW5pemVkVHlwZShkdHlwZS5Ub2tlbml6ZWRUeXBlLCBzc1tpXSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNzVG9rZW5pemVkVHlwZShkdHlwZS5Ub2tlbml6ZWRUeXBlLCAoc3RyaW5nKXR5cGVkVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgU2NoZW1hRGVjbEJhc2UgZGVjbCA9IGlzQXR0biA/IChTY2hlbWFEZWNsQmFzZSlhdHRkZWYgOiAoU2NoZW1hRGVjbEJhc2UpY29udGV4dC5FbGVtZW50RGVjbDsNCiAgICAgICAgICAgICAgICBpZiAoIWRlY2wuQ2hlY2tWYWx1ZSh0eXBlZFZhbHVlKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpc0F0dG4pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0ZpeGVkQXR0cmlidXRlVmFsdWUsIGF0dGRlZi5OYW1lLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRml4ZWRFbGVtZW50VmFsdWUsIFhtbFNjaGVtYVZhbGlkYXRvci5RTmFtZVN0cmluZyhjb250ZXh0LkxvY2FsTmFtZSwgY29udGV4dC5OYW1lc3BhY2UpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoZHR5cGUuVmFyaWV0eSA9PSBYbWxTY2hlbWFEYXRhdHlwZVZhcmlldHkuVW5pb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0eXBlZFZhbHVlID0gVW5XcmFwVW5pb24odHlwZWRWYWx1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJlYWRlci5UeXBlZFZhbHVlT2JqZWN0ID0gdHlwZWRWYWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxTY2hlbWFFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGF0dGRlZiAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfQXR0cmlidXRlVmFsdWVEYXRhVHlwZSwgYXR0ZGVmLk5hbWUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQoU1IuU2NoX0VsZW1lbnRWYWx1ZURhdGFUeXBlLCBYbWxTY2hlbWFWYWxpZGF0b3IuUU5hbWVTdHJpbmcoY29udGV4dC5Mb2NhbE5hbWUsIGNvbnRleHQuTmFtZXNwYWNlKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KDQogICAgICAgIGludGVybmFsIHZvaWQgQWRkSUQoc3RyaW5nIG5hbWUsIG9iamVjdCBub2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBOb3RlOiBJdCB1c2VkIHRvIGJlIHRydWUgdGhhdCB3ZSBvbmx5IGNhbGxlZCB0aGlzIGlmIF9mVmFsaWRhdGUgd2FzIHRydWUsDQogICAgICAgICAgICAvLyBidXQgZHVlIHRvIHRoZSBmYWN0IHRoYXQgeW91IGNhbiBub3cgZHluYW1pY2FsbHkgdHlwZSBzb21ldGhpZ24gYXMgYW4gSUQNCiAgICAgICAgICAgIC8vIHRoYXQgaXMgbm8gbG9uZ2VyIHRydWUuDQogICAgICAgICAgICBpZiAoX0lEcyA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9JRHMgPSBuZXcgSGFzaHRhYmxlKCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIF9JRHMuQWRkKG5hbWUsIG5vZGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIG9iamVjdCBGaW5kSWQoc3RyaW5nIG5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBfSURzID09IG51bGwgPyBudWxsIDogX0lEc1tuYW1lXTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29sIElzWFNEUm9vdChzdHJpbmcgbG9jYWxOYW1lLCBzdHJpbmcgbnMpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBSZWYuRXF1YWwobnMsIF9uc1hzKSAmJiBSZWYuRXF1YWwobG9jYWxOYW1lLCBfeHNkU2NoZW1hKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQdXNoKFhtbFF1YWxpZmllZE5hbWUgZWxlbWVudE5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGNvbnRleHQgPSAoVmFsaWRhdGlvblN0YXRlKV92YWxpZGF0aW9uU3RhY2suUHVzaCgpOw0KICAgICAgICAgICAgaWYgKGNvbnRleHQgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0ID0gbmV3IFZhbGlkYXRpb25TdGF0ZSgpOw0KICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uU3RhY2suQWRkVG9Ub3AoY29udGV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb250ZXh0LkxvY2FsTmFtZSA9IGVsZW1lbnROYW1lLk5hbWU7DQogICAgICAgICAgICBjb250ZXh0Lk5hbWVzcGFjZSA9IGVsZW1lbnROYW1lLk5hbWVzcGFjZTsNCiAgICAgICAgICAgIGNvbnRleHQuSGFzTWF0Y2hlZCA9IGZhbHNlOw0KICAgICAgICAgICAgY29udGV4dC5Jc05pbGwgPSBmYWxzZTsNCiAgICAgICAgICAgIGNvbnRleHQuUHJvY2Vzc0NvbnRlbnRzID0gX3Byb2Nlc3NDb250ZW50czsNCiAgICAgICAgICAgIGNvbnRleHQuTmVlZFZhbGlkYXRlQ2hpbGRyZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIGNvbnRleHQuQ29uc3RyID0gbnVsbDsgLy9yZXNldHRpbmcgdGhlIGNvbnN0cmFpbnRzIHRvIGJlIG51bGwgaW5jYXNlIGNvbnRleHQgIT0gbnVsbCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBwdXNoaW5nIG9udG8gc3RhY2s7DQogICAgICAgIH0NCg0KDQogICAgICAgIHByaXZhdGUgdm9pZCBQb3AoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoX3ZhbGlkYXRpb25TdGFjay5MZW5ndGggPiAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uU3RhY2suUG9wKCk7DQogICAgICAgICAgICAgICAgaWYgKF9zdGFydElEQ29uc3RyYWludCA9PSBfdmFsaWRhdGlvblN0YWNrLkxlbmd0aCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9zdGFydElEQ29uc3RyYWludCA9IC0xOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb250ZXh0ID0gKFZhbGlkYXRpb25TdGF0ZSlfdmFsaWRhdGlvblN0YWNrLlBlZWsoKTsNCiAgICAgICAgICAgICAgICBfcHJvY2Vzc0NvbnRlbnRzID0gY29udGV4dC5Qcm9jZXNzQ29udGVudHM7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgQ2hlY2tGb3J3YXJkUmVmcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIElkUmVmTm9kZSBuZXh0ID0gX2lkUmVmTGlzdEhlYWQ7DQogICAgICAgICAgICB3aGlsZSAobmV4dCAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChGaW5kSWQobmV4dC5JZCkgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQobmV3IFhtbFNjaGVtYUV4Y2VwdGlvbihTUi5TY2hfVW5kZWNsYXJlZElkLCBuZXh0LklkLCByZWFkZXIuQmFzZVVSSSwgbmV4dC5MaW5lTm8sIG5leHQuTGluZVBvcykpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBJZFJlZk5vZGUgcHRyID0gbmV4dC5OZXh0Ow0KICAgICAgICAgICAgICAgIG5leHQuTmV4dCA9IG51bGw7IC8vIHVuaG9vayBlYWNoIG9iamVjdCBzbyBpdCBpcyBjbGVhbmVkIHVwIGJ5IEdhcmJhZ2UgQ29sbGVjdG9yDQogICAgICAgICAgICAgICAgbmV4dCA9IHB0cjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIG5vdCBuZWVkZWQgYW55IG1vcmUuDQogICAgICAgICAgICBfaWRSZWZMaXN0SGVhZCA9IG51bGw7DQogICAgICAgIH0NCg0KDQogICAgICAgIHByaXZhdGUgdm9pZCBWYWxpZGF0ZVN0YXJ0RWxlbWVudElkZW50aXR5Q29uc3RyYWludHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBhZGRlZCBvbiBKdW5lIDE1LCBzZXQgdGhlIGNvbnRleHQgaGVyZSwgc28gdGhlIHN0YWNrIGNhbiBoYXZlIHRoZW0NCiAgICAgICAgICAgIGlmIChjb250ZXh0LkVsZW1lbnREZWNsICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wuQ29uc3RyYWludHMgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFkZElkZW50aXR5Q29uc3RyYWludHMoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy9mb3JlYWNoIGNvbnN0cmFpbnQgaW4gc3RhY2sgKGluY2x1ZGluZyB0aGUgY3VycmVudCBvbmUpDQogICAgICAgICAgICAgICAgaWYgKEhhc0lkZW50aXR5Q29uc3RyYWludHMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBFbGVtZW50SWRlbnRpdHlDb25zdHJhaW50cygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYm9vbCBIYXNJZGVudGl0eUNvbnN0cmFpbnRzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfc3RhcnRJRENvbnN0cmFpbnQgIT0gLTE7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBBZGRJZGVudGl0eUNvbnN0cmFpbnRzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgY29udGV4dC5Db25zdHIgPSBuZXcgQ29uc3RyYWludFN0cnVjdFtjb250ZXh0LkVsZW1lbnREZWNsLkNvbnN0cmFpbnRzLkxlbmd0aF07DQogICAgICAgICAgICBpbnQgaWQgPSAwOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb250ZXh0LkVsZW1lbnREZWNsLkNvbnN0cmFpbnRzLkxlbmd0aDsgKytpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbnRleHQuQ29uc3RyW2lkKytdID0gbmV3IENvbnN0cmFpbnRTdHJ1Y3QoY29udGV4dC5FbGVtZW50RGVjbC5Db25zdHJhaW50c1tpXSk7DQogICAgICAgICAgICB9IC8vIGZvcmVhY2ggY29uc3RyYWludCAvY29uc3RyYWludHN0cnVjdA0KDQogICAgICAgICAgICAvLyBhZGRlZCBvbiBKdW5lIDE5LCBtYWtlIGNvbm5lY3Rpb25zIGJldHdlZW4gbmV3IGtleXJlZiB0YWJsZXMgd2l0aCBrZXkvdW5pcXVlIHRhYmxlcyBpbiBzdGFjaw0KICAgICAgICAgICAgLy8gaSBjYW4ndCBwdXQgaXQgaW4gdGhlIGFib3ZlIGxvb3AsIGNveiB0aGVyZSB3aWxsIGJlIGtleSBvbiB0aGUgc2FtZSBsZXZlbA0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb250ZXh0LkNvbnN0ci5MZW5ndGg7ICsraSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5Db25zdHJbaV0uY29uc3RyYWludC5Sb2xlID09IENvbXBpbGVkSWRlbnRpdHlDb25zdHJhaW50LkNvbnN0cmFpbnRSb2xlLktleXJlZikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGJvb2wgZmluZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAvLyBnbyB1cHdhcmRzIGNoZWNraW5nIG9yIG9ubHkgaW4gdGhpcyBsZXZlbA0KICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBsZXZlbCA9IF92YWxpZGF0aW9uU3RhY2suTGVuZ3RoIC0gMTsgbGV2ZWwgPj0gKChfc3RhcnRJRENvbnN0cmFpbnQgPj0gMCkgPyBfc3RhcnRJRENvbnN0cmFpbnQgOiBfdmFsaWRhdGlvblN0YWNrLkxlbmd0aCAtIDEpOyBsZXZlbC0tKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBjb25zdHJhaW50IGZvciB0aGlzIGxldmVsDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKChWYWxpZGF0aW9uU3RhdGUpKF92YWxpZGF0aW9uU3RhY2tbbGV2ZWxdKSkuQ29uc3RyID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBDb25zdHJhaW50U3RydWN0W10gY29uc3RyYWludHMgPSAoKFZhbGlkYXRpb25TdGF0ZSlfdmFsaWRhdGlvblN0YWNrW2xldmVsXSkuQ29uc3RyOw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBjb25zdHJhaW50cy5MZW5ndGg7ICsraikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3RyYWludHNbal0uY29uc3RyYWludC5uYW1lID09IGNvbnRleHQuQ29uc3RyW2ldLmNvbnN0cmFpbnQucmVmZXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5kID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnN0cmFpbnRzW2pdLmtleXJlZlRhYmxlID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzW2pdLmtleXJlZlRhYmxlID0gbmV3IEhhc2h0YWJsZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuQ29uc3RyW2ldLnF1YWxpZmllZFRhYmxlID0gY29uc3RyYWludHNbal0ua2V5cmVmVGFibGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmQpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaW5kKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBkaWRuJ3QgZmluZCBjb25uZWN0aW9ucywgdGhyb3cgZXhjZXB0aW9ucw0KICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfUmVmTm90SW5TY29wZSwgWG1sU2NoZW1hVmFsaWRhdG9yLlFOYW1lU3RyaW5nKGNvbnRleHQuTG9jYWxOYW1lLCBjb250ZXh0Lk5hbWVzcGFjZSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSAvLyBmaW5pc2hlZCBkZWFsaW5nIHdpdGgga2V5cmVmDQogICAgICAgICAgICB9ICAvLyBlbmQgZm9yZWFjaA0KDQogICAgICAgICAgICAvLyBpbml0aWFsIHNldA0KICAgICAgICAgICAgaWYgKF9zdGFydElEQ29uc3RyYWludCA9PSAtMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfc3RhcnRJRENvbnN0cmFpbnQgPSBfdmFsaWRhdGlvblN0YWNrLkxlbmd0aCAtIDE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgRWxlbWVudElkZW50aXR5Q29uc3RyYWludHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBmb3IgKGludCBpID0gX3N0YXJ0SURDb25zdHJhaW50OyBpIDwgX3ZhbGlkYXRpb25TdGFjay5MZW5ndGg7IGkrKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBubyBjb25zdHJhaW50IGZvciB0aGlzIGxldmVsDQogICAgICAgICAgICAgICAgaWYgKCgoVmFsaWRhdGlvblN0YXRlKShfdmFsaWRhdGlvblN0YWNrW2ldKSkuQ29uc3RyID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBlbHNlDQogICAgICAgICAgICAgICAgQ29uc3RyYWludFN0cnVjdFtdIGNvbnN0cmFpbnRzID0gKChWYWxpZGF0aW9uU3RhdGUpX3ZhbGlkYXRpb25TdGFja1tpXSkuQ29uc3RyOw0KICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgY29uc3RyYWludHMuTGVuZ3RoOyArK2opDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBzZWxlY3RvciBmcm9tIGhlcmUNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnN0cmFpbnRzW2pdLmF4aXNTZWxlY3Rvci5Nb3ZlVG9TdGFydEVsZW1lbnQocmVhZGVyLkxvY2FsTmFtZSwgcmVhZGVyLk5hbWVzcGFjZVVSSSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlbGVjdG9yIHNlbGVjdHMgbmV3IG5vZGUsIGFjdGl2YXRlIGEgbmV3IHNldCBvZiBmaWVsZHMNCiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLldyaXRlTGluZSgiU2VsZWN0b3IgTWF0Y2ghIik7DQogICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Xcml0ZUxpbmUoIk5hbWU6ICIgKyByZWFkZXIuTG9jYWxOYW1lICsgIlx0fFx0VVJJOiAiICsgcmVhZGVyLk5hbWVzcGFjZVVSSSArICJcbiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gd2hpY2ggYXhpc0ZpZWxkcyBnb3QgdXBkYXRlZA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludHNbal0uYXhpc1NlbGVjdG9yLlB1c2hLUyhQb3NpdGlvbkluZm8uTGluZU51bWJlciwgUG9zaXRpb25JbmZvLkxpbmVQb3NpdGlvbik7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAvLyBheGlzRmllbGRzIGlzIG5vdCBudWxsLCBidXQgbWF5IGJlIGVtcHR5DQogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgY29uc3RyYWludHNbal0uYXhpc0ZpZWxkcy5Db3VudDsgKytrKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBMb2NhdGVkQWN0aXZlQXhpcyBsYXhpcyA9IChMb2NhdGVkQWN0aXZlQXhpcyljb25zdHJhaW50c1tqXS5heGlzRmllbGRzW2tdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBmaWVsZCBmcm9tIGhlcmUNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXhpcy5Nb3ZlVG9TdGFydEVsZW1lbnQocmVhZGVyLkxvY2FsTmFtZSwgcmVhZGVyLk5hbWVzcGFjZVVSSSkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcuV3JpdGVMaW5lKCJFbGVtZW50IEZpZWxkIE1hdGNoISIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNraW5nIHNpbXBsZVR5cGUgLyBzaW1wbGVDb250ZW50DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ICAgICAgLy8gbmV4dEVsZW1lbnQgY2FuIGJlIG51bGwgd2hlbiB4bWwveHNkIGFyZSBub3QgdmFsaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuRWxlbWVudERlY2wuRGF0YXR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRmllbGRTaW1wbGVUeXBlRXhwZWN0ZWQsIHJlYWRlci5Mb2NhbE5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FuJ3QgZmlsbCB2YWx1ZSBoZXJlLCB3YWl0IHRpbGwgbGF0ZXIuLi4uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmaWxsIHR5cGUgOiB4c2RUeXBlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXhpcy5pc01hdGNoZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2luY2UgaXQncyBzaW1wbGV0eXBlZCBlbGVtZW50LCB0aGUgZW5kY2hpbGRyZW4gd2lsbCBjb21lIGNvbnNlcXVlbnRseS4uLiBkb24ndCB3b3JyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gZmFjaWxpdGF0ZSBtb2RpZnlpbmcNCiAgICAgICAgcHJpdmF0ZSB2b2lkIEF0dHJpYnV0ZUlkZW50aXR5Q29uc3RyYWludHMoc3RyaW5nIG5hbWUsIHN0cmluZyBucywgb2JqZWN0IG9iaiwgc3RyaW5nIHNvYmosIFNjaGVtYUF0dERlZiBhdHRkZWYpDQogICAgICAgIHsNCiAgICAgICAgICAgIGZvciAoaW50IGNpID0gX3N0YXJ0SURDb25zdHJhaW50OyBjaSA8IF92YWxpZGF0aW9uU3RhY2suTGVuZ3RoOyBjaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIG5vIGNvbnN0cmFpbnQgZm9yIHRoaXMgbGV2ZWwNCiAgICAgICAgICAgICAgICBpZiAoKChWYWxpZGF0aW9uU3RhdGUpKF92YWxpZGF0aW9uU3RhY2tbY2ldKSkuQ29uc3RyID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBlbHNlDQogICAgICAgICAgICAgICAgQ29uc3RyYWludFN0cnVjdFtdIGNvbnN0cmFpbnRzID0gKChWYWxpZGF0aW9uU3RhdGUpX3ZhbGlkYXRpb25TdGFja1tjaV0pLkNvbnN0cjsNCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbnN0cmFpbnRzLkxlbmd0aDsgKytpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gYXhpc0ZpZWxkcyBpcyBub3QgbnVsbCwgYnV0IG1heSBiZSBlbXB0eQ0KICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGNvbnN0cmFpbnRzW2ldLmF4aXNGaWVsZHMuQ291bnQ7ICsraikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgTG9jYXRlZEFjdGl2ZUF4aXMgbGF4aXMgPSAoTG9jYXRlZEFjdGl2ZUF4aXMpY29uc3RyYWludHNbaV0uYXhpc0ZpZWxkc1tqXTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgZmllbGQgZnJvbSBoZXJlDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGF4aXMuTW92ZVRvQXR0cmlidXRlKG5hbWUsIG5zKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Xcml0ZUxpbmUoIkF0dHJpYnV0ZSBGaWVsZCBNYXRjaCEiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2F0dHJpYnV0ZSBpcyBvbmx5IHNpbXBsZXR5cGUsIHNvIG5lZWRuJ3QgY2hlY2tpbmcuLi4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYW4gZmlsbCB2YWx1ZSBoZXJlLCB5ZWFoISENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Xcml0ZUxpbmUoIkF0dHJpYnV0ZSBGaWVsZCBGaWxsaW5nIFZhbHVlISIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLldyaXRlTGluZSgiTmFtZTogIiArIG5hbWUgKyAiXHR8XHRVUkk6ICIgKyBucyArICJcdHxcdFZhbHVlOiAiICsgb2JqICsgIlxuIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxheGlzLktzW2xheGlzLkNvbHVtbl0gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3VsZCBiZSBldmFsdWF0ZWQgdG8gZWl0aGVyIGFuIGVtcHR5IG5vZGUtc2V0IG9yIGEgbm9kZS1zZXQgd2l0aCBleGFjdGx5IG9uZSBtZW1iZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHdvIG1hdGNoZXMuLi4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRmllbGRTaW5nbGVWYWx1ZUV4cGVjdGVkLCBuYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKGF0dGRlZiAhPSBudWxsKSAmJiAoYXR0ZGVmLkRhdGF0eXBlICE9IG51bGwpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF4aXMuS3NbbGF4aXMuQ29sdW1uXSA9IG5ldyBUeXBlZE9iamVjdChvYmosIHNvYmosIGF0dGRlZi5EYXRhdHlwZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBvYmplY3QgVW5XcmFwVW5pb24ob2JqZWN0IHR5cGVkVmFsdWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhzZFNpbXBsZVZhbHVlIHNpbXBsZVZhbHVlID0gdHlwZWRWYWx1ZSBhcyBYc2RTaW1wbGVWYWx1ZTsNCiAgICAgICAgICAgIGlmIChzaW1wbGVWYWx1ZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHR5cGVkVmFsdWUgPSBzaW1wbGVWYWx1ZS5UeXBlZFZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHR5cGVkVmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgRW5kRWxlbWVudElkZW50aXR5Q29uc3RyYWludHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBmb3IgKGludCBjaSA9IF92YWxpZGF0aW9uU3RhY2suTGVuZ3RoIC0gMTsgY2kgPj0gX3N0YXJ0SURDb25zdHJhaW50OyBjaS0tKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIG5vIGNvbnN0cmFpbnQgZm9yIHRoaXMgbGV2ZWwNCiAgICAgICAgICAgICAgICBpZiAoKChWYWxpZGF0aW9uU3RhdGUpKF92YWxpZGF0aW9uU3RhY2tbY2ldKSkuQ29uc3RyID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBlbHNlDQogICAgICAgICAgICAgICAgQ29uc3RyYWludFN0cnVjdFtdIGNvbnN0cmFpbnRzID0gKChWYWxpZGF0aW9uU3RhdGUpX3ZhbGlkYXRpb25TdGFja1tjaV0pLkNvbnN0cjsNCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbnN0cmFpbnRzLkxlbmd0aDsgKytpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gRW5kQ2hpbGRyZW4NCiAgICAgICAgICAgICAgICAgICAgLy8gYXhpc0ZpZWxkcyBpcyBub3QgbnVsbCwgYnV0IG1heSBiZSBlbXB0eQ0KICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGNvbnN0cmFpbnRzW2ldLmF4aXNGaWVsZHMuQ291bnQ7ICsraikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgTG9jYXRlZEFjdGl2ZUF4aXMgbGF4aXMgPSAoTG9jYXRlZEFjdGl2ZUF4aXMpY29uc3RyYWludHNbaV0uYXhpc0ZpZWxkc1tqXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZpZWxkIGZyb20gaGVyZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXNNYXRjaGVkIGlzIGZhbHNlIHdoZW4gbmV4dEVsZW1lbnQgaXMgbnVsbC4gc28gbmVlZG4ndCBjaGFuZ2UgdGhpcyBwYXJ0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxheGlzLmlzTWF0Y2hlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Xcml0ZUxpbmUoIkVsZW1lbnQgRmllbGQgRmlsbGluZyBWYWx1ZSEiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Xcml0ZUxpbmUoIk5hbWU6ICIgKyByZWFkZXIuTG9jYWxOYW1lICsgIlx0fFx0VVJJOiAiICsgcmVhZGVyLk5hbWVzcGFjZVVSSSArICJcdHxcdFZhbHVlOiAiICsgcmVhZGVyLlR5cGVkVmFsdWVPYmplY3QgKyAiXG4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmaWxsIHZhbHVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF4aXMuaXNNYXRjaGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxheGlzLktzW2xheGlzLkNvbHVtbl0gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFtmaWVsZC4uLl0gc2hvdWxkIGJlIGV2YWx1YXRlZCB0byBlaXRoZXIgYW4gZW1wdHkgbm9kZS1zZXQgb3IgYSBub2RlLXNldCB3aXRoIGV4YWN0bHkgb25lIG1lbWJlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0d28gbWF0Y2hlcy4uLiBhbHJlYWR5IGV4aXN0aW5nIGZpZWxkIHZhbHVlIGluIHRoZSB0YWJsZS4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChTUi5TY2hfRmllbGRTaW5nbGVWYWx1ZUV4cGVjdGVkLCByZWFkZXIuTG9jYWxOYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGVsZW1lbnQsIHJlYWRlci5WYWx1ZSA9ICIiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgc3RyaW5nVmFsdWUgPSAhaGFzU2libGluZyA/IHRleHRTdHJpbmcgOiB0ZXh0VmFsdWUuVG9TdHJpbmcoKTsgIC8vIG9ubHkgZm9yIGlkZW50aXR5LWNvbnN0cmFpbnQgZXhjZXB0aW9uIHJlcG9ydGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhZGVyLlR5cGVkVmFsdWVPYmplY3QgIT0gbnVsbCAmJiBzdHJpbmdWYWx1ZS5MZW5ndGggIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF4aXMuS3NbbGF4aXMuQ29sdW1uXSA9IG5ldyBUeXBlZE9iamVjdChyZWFkZXIuVHlwZWRWYWx1ZU9iamVjdCwgc3RyaW5nVmFsdWUsIGNvbnRleHQuRWxlbWVudERlY2wuRGF0YXR5cGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRW5kQ2hpbGRyZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGxheGlzLkVuZEVsZW1lbnQocmVhZGVyLkxvY2FsTmFtZSwgcmVhZGVyLk5hbWVzcGFjZVVSSSk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3RyYWludHNbaV0uYXhpc1NlbGVjdG9yLkVuZEVsZW1lbnQocmVhZGVyLkxvY2FsTmFtZSwgcmVhZGVyLk5hbWVzcGFjZVVSSSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluc2VydCBrZXkgc2VxdWVuY2UgaW50byBoYXNoICgrIGxvY2F0ZWQgYWN0aXZlIGF4aXMgdHVwbGUgbGVhdmUgZm9yIGxhdGVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgS2V5U2VxdWVuY2Uga3MgPSBjb25zdHJhaW50c1tpXS5heGlzU2VsZWN0b3IuUG9wS1MoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVucXVhbGlmaWVkIGtleXNlcXVlbmNlIGFyZSBub3QgYWxsb3dlZA0KICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjb25zdHJhaW50c1tpXS5jb25zdHJhaW50LlJvbGUpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb21waWxlZElkZW50aXR5Q29uc3RyYWludC5Db25zdHJhaW50Um9sZS5LZXk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgha3MuSXNRdWFsaWZpZWQoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9LZXkncyBmaWVsZHMgY2FuJ3QgYmUgbnVsbC4uLiAgaWYgd2UgY2FuIHJldHVybiBjb250ZXh0IG5vZGUncyBsaW5lIGluZm8gbWF5YmUgaXQgd2lsbCBiZSBiZXR0ZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb25seSBrZXltaXNzaW5nICYga2V5ZHVwbGljYXRlIHJlcG9ydGluZyBjYXNlcyBhcmUgbmVjZXNzYXJ5IHRvIGJlIGRlYWx0IHdpdGguLi4gMyBwbGFjZXMuLi4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQobmV3IFhtbFNjaGVtYUV4Y2VwdGlvbihTUi5TY2hfTWlzc2luZ0tleSwgY29uc3RyYWludHNbaV0uY29uc3RyYWludC5uYW1lLlRvU3RyaW5nKCksIHJlYWRlci5CYXNlVVJJLCBrcy5Qb3NMaW5lLCBrcy5Qb3NDb2wpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb25zdHJhaW50c1tpXS5xdWFsaWZpZWRUYWJsZS5Db250YWlucyhrcykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVuaXF1ZSBvciBrZXkgY2hlY2tpbmcgdmFsdWUgY29uZmxpY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciByZWR1bmRhbnQga2V5LCByZXBvcnRpbmcgYm90aCBvY2N1cmluZ3MNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3Qgd29yay4uLiBob3cgY2FuIGkgcmV0cmlldmUgdmFsdWUgb3V0Pz8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQobmV3IFhtbFNjaGVtYUV4Y2VwdGlvbihTUi5TY2hfRHVwbGljYXRlS2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBzdHJpbmdbMl0geyBrcy5Ub1N0cmluZygpLCBjb25zdHJhaW50c1tpXS5jb25zdHJhaW50Lm5hbWUuVG9TdHJpbmcoKSB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5CYXNlVVJJLCBrcy5Qb3NMaW5lLCBrcy5Qb3NDb2wpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzW2ldLnF1YWxpZmllZFRhYmxlLkFkZChrcywga3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29tcGlsZWRJZGVudGl0eUNvbnN0cmFpbnQuQ29uc3RyYWludFJvbGUuVW5pcXVlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWtzLklzUXVhbGlmaWVkKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25zdHJhaW50c1tpXS5xdWFsaWZpZWRUYWJsZS5Db250YWlucyhrcykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVuaXF1ZSBvciBrZXkgY2hlY2tpbmcgY29uZmxpY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRWYWxpZGF0aW9uRXZlbnQobmV3IFhtbFNjaGVtYUV4Y2VwdGlvbihTUi5TY2hfRHVwbGljYXRlS2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBzdHJpbmdbMl0geyBrcy5Ub1N0cmluZygpLCBjb25zdHJhaW50c1tpXS5jb25zdHJhaW50Lm5hbWUuVG9TdHJpbmcoKSB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5CYXNlVVJJLCBrcy5Qb3NMaW5lLCBrcy5Qb3NDb2wpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzW2ldLnF1YWxpZmllZFRhYmxlLkFkZChrcywga3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29tcGlsZWRJZGVudGl0eUNvbnN0cmFpbnQuQ29uc3RyYWludFJvbGUuS2V5cmVmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpcyB0aGVyZSBhbnkgcG9zc2liaWxpdHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIga2V5cmVmczogdmFsdWUgaXMgZXF1YWwsIHR5cGUgaXMgbm90DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJvdGggcHV0IGluIHRoZSBoYXNodGFibGUsIDEgcmVmZXJlbmNlLCAxIG5vdA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3RyYWludHNbaV0ucXVhbGlmaWVkVGFibGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAvL1dpbGwgYmUgbnVsbCBpbiBjYXNlcyB3aGVuIHRoZSBrZXlyZWYgaXMgb3V0c2lkZSB0aGUgc2NvcGUgb2YgdGhlIGtleSwgdGhhdCBpcyBub3QgYWxsb3dlZCBieSBvdXIgaW1wbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFrcy5Jc1F1YWxpZmllZCgpIHx8IGNvbnN0cmFpbnRzW2ldLnF1YWxpZmllZFRhYmxlLkNvbnRhaW5zKGtzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzW2ldLnF1YWxpZmllZFRhYmxlLkFkZChrcywga3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBjdXJyZW50IGxldmVsJ3MgY29uc3RyYWludCBzdHJ1Y3QNCiAgICAgICAgICAgIENvbnN0cmFpbnRTdHJ1Y3RbXSB2Y3MgPSAoKFZhbGlkYXRpb25TdGF0ZSkoX3ZhbGlkYXRpb25TdGFja1tfdmFsaWRhdGlvblN0YWNrLkxlbmd0aCAtIDFdKSkuQ29uc3RyOw0KICAgICAgICAgICAgaWYgKHZjcyAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRpbmcgYWxsIHJlZmVyZW5jaW5nIHRhYmxlcy4uLg0KICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdmNzLkxlbmd0aDsgKytpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCh2Y3NbaV0uY29uc3RyYWludC5Sb2xlID09IENvbXBpbGVkSWRlbnRpdHlDb25zdHJhaW50LkNvbnN0cmFpbnRSb2xlLktleXJlZikNCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICh2Y3NbaV0ua2V5cmVmVGFibGUgPT0gbnVsbCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKEtleVNlcXVlbmNlIGtzIGluIHZjc1tpXS5rZXlyZWZUYWJsZS5LZXlzKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZjc1tpXS5xdWFsaWZpZWRUYWJsZS5Db250YWlucyhrcykpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZFZhbGlkYXRpb25FdmVudChuZXcgWG1sU2NoZW1hRXhjZXB0aW9uKFNSLlNjaF9VbnJlc29sdmVkS2V5cmVmLCBuZXcgc3RyaW5nWzJdIHsga3MuVG9TdHJpbmcoKSwgdmNzW2ldLmNvbnN0cmFpbnQubmFtZS5Ub1N0cmluZygpIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5CYXNlVVJJLCBrcy5Qb3NMaW5lLCBrcy5Qb3NDb2wpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDYxOA0KfQ0KDQo="
        },
        "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/XPath/XPathNavigator.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db21wb25lbnRNb2RlbDsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9uczsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkdsb2JhbGl6YXRpb247DQp1c2luZyBTeXN0ZW0uWG1sLlNjaGVtYTsNCnVzaW5nIFN5c3RlbS5EaWFnbm9zdGljczsNCnVzaW5nIFN5c3RlbS5TZWN1cml0eTsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlhtbDsNCnVzaW5nIE1TLkludGVybmFsLlhtbC5DYWNoZTsNCnVzaW5nIE1TLkludGVybmFsLlhtbC5YUGF0aDsNCg0KbmFtZXNwYWNlIFN5c3RlbS5YbWwuWFBhdGgNCnsNCiAgICAvLyBQcm92aWRlcyBhIG5hdmlnYXRpb24gaW50ZXJmYWNlIEFQSSB1c2luZyBYUGF0aCBkYXRhIG1vZGVsLg0KICAgIFtEZWJ1Z2dlckRpc3BsYXkoIntkZWJ1Z2dlckRpc3BsYXlQcm94eX0iKV0NCiAgICBwdWJsaWMgYWJzdHJhY3QgY2xhc3MgWFBhdGhOYXZpZ2F0b3IgOiBYUGF0aEl0ZW0sIElDbG9uZWFibGUsIElYUGF0aE5hdmlnYWJsZSwgSVhtbE5hbWVzcGFjZVJlc29sdmVyDQogICAgew0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgcmVhZG9ubHkgWFBhdGhOYXZpZ2F0b3JLZXlDb21wYXJlciBjb21wYXJlciA9IG5ldyBYUGF0aE5hdmlnYXRvcktleUNvbXBhcmVyKCk7DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBPYmplY3QNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgVG9TdHJpbmcoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gVmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIFhQYXRoSXRlbQ0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHNlYWxlZCBib29sIElzTm9kZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gdHJ1ZTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFhtbFNjaGVtYVR5cGUgWG1sVHlwZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJWG1sU2NoZW1hSW5mbyBzY2hlbWFJbmZvID0gU2NoZW1hSW5mbzsNCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hSW5mbyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8uVmFsaWRpdHkgPT0gWG1sU2NoZW1hVmFsaWRpdHkuVmFsaWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVR5cGUgbWVtYmVyVHlwZSA9IHNjaGVtYUluZm8uTWVtYmVyVHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZW1iZXJUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lbWJlclR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBTZXRWYWx1ZShzdHJpbmcgdmFsdWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBOb3RTdXBwb3J0ZWRFeGNlcHRpb24oKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBvYmplY3QgVHlwZWRWYWx1ZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJWG1sU2NoZW1hSW5mbyBzY2hlbWFJbmZvID0gU2NoZW1hSW5mbzsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFUeXBlIHNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZGF0YXR5cGU7DQogICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvLlZhbGlkaXR5ID09IFhtbFNjaGVtYVZhbGlkaXR5LlZhbGlkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5NZW1iZXJUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhdHlwZSA9IHNjaGVtYVR5cGUuRGF0YXR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGF0eXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5WYWx1ZUNvbnZlcnRlci5DaGFuZ2VUeXBlKFZhbHVlLCBkYXRhdHlwZS5WYWx1ZVR5cGUsIHRoaXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF0eXBlID0gc2NoZW1hVHlwZS5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YXR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWFUeXBlLlZhbHVlQ29udmVydGVyLkNoYW5nZVR5cGUoZGF0YXR5cGUuUGFyc2VWYWx1ZShWYWx1ZSwgTmFtZVRhYmxlLCB0aGlzKSwgZGF0YXR5cGUuVmFsdWVUeXBlLCB0aGlzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIFZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBTZXRUeXBlZFZhbHVlKG9iamVjdCB0eXBlZFZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAodHlwZWRWYWx1ZSA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24obmFtZW9mKHR5cGVkVmFsdWUpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHN3aXRjaCAoTm9kZVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLkVsZW1lbnQ6DQogICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLkF0dHJpYnV0ZToNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWHBuX0JhZFBvc2l0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHN0cmluZyB2YWx1ZSA9IG51bGw7DQogICAgICAgICAgICBJWG1sU2NoZW1hSW5mbyBzY2hlbWFJbmZvID0gU2NoZW1hSW5mbzsNCiAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hVHlwZSBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWFUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHNjaGVtYVR5cGUuVmFsdWVDb252ZXJ0ZXIuVG9TdHJpbmcodHlwZWRWYWx1ZSwgdGhpcyk7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYURhdGF0eXBlIGRhdGF0eXBlID0gc2NoZW1hVHlwZS5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGF0eXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF0eXBlLlBhcnNlVmFsdWUodmFsdWUsIE5hbWVUYWJsZSwgdGhpcyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YWx1ZSA9IFhtbFVudHlwZWRDb252ZXJ0ZXIuVW50eXBlZC5Ub1N0cmluZyh0eXBlZFZhbHVlLCB0aGlzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFNldFZhbHVlKHZhbHVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBUeXBlIFZhbHVlVHlwZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJWG1sU2NoZW1hSW5mbyBzY2hlbWFJbmZvID0gU2NoZW1hSW5mbzsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFUeXBlIHNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZGF0YXR5cGU7DQogICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvLlZhbGlkaXR5ID09IFhtbFNjaGVtYVZhbGlkaXR5LlZhbGlkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5NZW1iZXJUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhdHlwZSA9IHNjaGVtYVR5cGUuRGF0YXR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGF0eXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXR5cGUuVmFsdWVUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF0eXBlID0gc2NoZW1hVHlwZS5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YXR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhdHlwZS5WYWx1ZVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2Yoc3RyaW5nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIFZhbHVlQXNCb29sZWFuDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIElYbWxTY2hlbWFJbmZvIHNjaGVtYUluZm8gPSBTY2hlbWFJbmZvOw0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYVR5cGUgc2NoZW1hVHlwZTsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFEYXRhdHlwZSBkYXRhdHlwZTsNCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hSW5mbyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8uVmFsaWRpdHkgPT0gWG1sU2NoZW1hVmFsaWRpdHkuVmFsaWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLk1lbWJlclR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWFUeXBlLlZhbHVlQ29udmVydGVyLlRvQm9vbGVhbihWYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhdHlwZSA9IHNjaGVtYVR5cGUuRGF0YXR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGF0eXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5WYWx1ZUNvbnZlcnRlci5Ub0Jvb2xlYW4oZGF0YXR5cGUuUGFyc2VWYWx1ZShWYWx1ZSwgTmFtZVRhYmxlLCB0aGlzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBYbWxVbnR5cGVkQ29udmVydGVyLlVudHlwZWQuVG9Cb29sZWFuKFZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBEYXRlVGltZSBWYWx1ZUFzRGF0ZVRpbWUNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgSVhtbFNjaGVtYUluZm8gc2NoZW1hSW5mbyA9IFNjaGVtYUluZm87DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hVHlwZSBzY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYURhdGF0eXBlIGRhdGF0eXBlOw0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hSW5mby5WYWxpZGl0eSA9PSBYbWxTY2hlbWFWYWxpZGl0eS5WYWxpZCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hVHlwZSA9IHNjaGVtYUluZm8uTWVtYmVyVHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWFUeXBlID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hVHlwZSA9IHNjaGVtYUluZm8uU2NoZW1hVHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWFUeXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjaGVtYVR5cGUuVmFsdWVDb252ZXJ0ZXIuVG9EYXRlVGltZShWYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhdHlwZSA9IHNjaGVtYVR5cGUuRGF0YXR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGF0eXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5WYWx1ZUNvbnZlcnRlci5Ub0RhdGVUaW1lKGRhdGF0eXBlLlBhcnNlVmFsdWUoVmFsdWUsIE5hbWVUYWJsZSwgdGhpcykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gWG1sVW50eXBlZENvbnZlcnRlci5VbnR5cGVkLlRvRGF0ZVRpbWUoVmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGRvdWJsZSBWYWx1ZUFzRG91YmxlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIElYbWxTY2hlbWFJbmZvIHNjaGVtYUluZm8gPSBTY2hlbWFJbmZvOw0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYVR5cGUgc2NoZW1hVHlwZTsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFEYXRhdHlwZSBkYXRhdHlwZTsNCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hSW5mbyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8uVmFsaWRpdHkgPT0gWG1sU2NoZW1hVmFsaWRpdHkuVmFsaWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLk1lbWJlclR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWFUeXBlLlZhbHVlQ29udmVydGVyLlRvRG91YmxlKFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF0eXBlID0gc2NoZW1hVHlwZS5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YXR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWFUeXBlLlZhbHVlQ29udmVydGVyLlRvRG91YmxlKGRhdGF0eXBlLlBhcnNlVmFsdWUoVmFsdWUsIE5hbWVUYWJsZSwgdGhpcykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gWG1sVW50eXBlZENvbnZlcnRlci5VbnR5cGVkLlRvRG91YmxlKFZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgVmFsdWVBc0ludA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJWG1sU2NoZW1hSW5mbyBzY2hlbWFJbmZvID0gU2NoZW1hSW5mbzsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFUeXBlIHNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZGF0YXR5cGU7DQogICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvLlZhbGlkaXR5ID09IFhtbFNjaGVtYVZhbGlkaXR5LlZhbGlkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5NZW1iZXJUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5WYWx1ZUNvbnZlcnRlci5Ub0ludDMyKFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF0eXBlID0gc2NoZW1hVHlwZS5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YXR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWFUeXBlLlZhbHVlQ29udmVydGVyLlRvSW50MzIoZGF0YXR5cGUuUGFyc2VWYWx1ZShWYWx1ZSwgTmFtZVRhYmxlLCB0aGlzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBYbWxVbnR5cGVkQ29udmVydGVyLlVudHlwZWQuVG9JbnQzMihWYWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgbG9uZyBWYWx1ZUFzTG9uZw0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBJWG1sU2NoZW1hSW5mbyBzY2hlbWFJbmZvID0gU2NoZW1hSW5mbzsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFUeXBlIHNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZGF0YXR5cGU7DQogICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvLlZhbGlkaXR5ID09IFhtbFNjaGVtYVZhbGlkaXR5LlZhbGlkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5NZW1iZXJUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5WYWx1ZUNvbnZlcnRlci5Ub0ludDY0KFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF0eXBlID0gc2NoZW1hVHlwZS5EYXRhdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YXR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWFUeXBlLlZhbHVlQ29udmVydGVyLlRvSW50NjQoZGF0YXR5cGUuUGFyc2VWYWx1ZShWYWx1ZSwgTmFtZVRhYmxlLCB0aGlzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBYbWxVbnR5cGVkQ29udmVydGVyLlVudHlwZWQuVG9JbnQ2NChWYWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgb2JqZWN0IFZhbHVlQXMoVHlwZSByZXR1cm5UeXBlLCBJWG1sTmFtZXNwYWNlUmVzb2x2ZXIgbnNSZXNvbHZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG5zUmVzb2x2ZXIgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBuc1Jlc29sdmVyID0gdGhpczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIElYbWxTY2hlbWFJbmZvIHNjaGVtYUluZm8gPSBTY2hlbWFJbmZvOw0KICAgICAgICAgICAgWG1sU2NoZW1hVHlwZSBzY2hlbWFUeXBlOw0KICAgICAgICAgICAgWG1sU2NoZW1hRGF0YXR5cGUgZGF0YXR5cGU7DQogICAgICAgICAgICBpZiAoc2NoZW1hSW5mbyAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvLlZhbGlkaXR5ID09IFhtbFNjaGVtYVZhbGlkaXR5LlZhbGlkKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc2NoZW1hVHlwZSA9IHNjaGVtYUluZm8uTWVtYmVyVHlwZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hVHlwZSA9IHNjaGVtYUluZm8uU2NoZW1hVHlwZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5WYWx1ZUNvbnZlcnRlci5DaGFuZ2VUeXBlKFZhbHVlLCByZXR1cm5UeXBlLCBuc1Jlc29sdmVyKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hSW5mby5TY2hlbWFUeXBlOw0KICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhdHlwZSA9IHNjaGVtYVR5cGUuRGF0YXR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YXR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5WYWx1ZUNvbnZlcnRlci5DaGFuZ2VUeXBlKGRhdGF0eXBlLlBhcnNlVmFsdWUoVmFsdWUsIE5hbWVUYWJsZSwgbnNSZXNvbHZlciksIHJldHVyblR5cGUsIG5zUmVzb2x2ZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIFhtbFVudHlwZWRDb252ZXJ0ZXIuVW50eXBlZC5DaGFuZ2VUeXBlKFZhbHVlLCByZXR1cm5UeXBlLCBuc1Jlc29sdmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gSUNsb25lYWJsZQ0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCiAgICAgICAgb2JqZWN0IElDbG9uZWFibGUuQ2xvbmUoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gQ2xvbmUoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gSVhQYXRoTmF2aWdhYmxlDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYUGF0aE5hdmlnYXRvciBDcmVhdGVOYXZpZ2F0b3IoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gQ2xvbmUoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gSVhtbE5hbWVzcGFjZVJlc29sdmVyDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgICAgICBwdWJsaWMgYWJzdHJhY3QgWG1sTmFtZVRhYmxlIE5hbWVUYWJsZSB7IGdldDsgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHN0cmluZyBMb29rdXBOYW1lc3BhY2Uoc3RyaW5nIHByZWZpeCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHByZWZpeCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KDQogICAgICAgICAgICBpZiAoTm9kZVR5cGUgIT0gWFBhdGhOb2RlVHlwZS5FbGVtZW50KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIG5hdlNhdmUgPSBDbG9uZSgpOw0KDQogICAgICAgICAgICAgICAgLy8gSWYgY3VycmVudCBpdGVtIGlzIG5vdCBhbiBlbGVtZW50LCB0aGVuIHRyeSBwYXJlbnQNCiAgICAgICAgICAgICAgICBpZiAobmF2U2F2ZS5Nb3ZlVG9QYXJlbnQoKSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdlNhdmUuTG9va3VwTmFtZXNwYWNlKHByZWZpeCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChNb3ZlVG9OYW1lc3BhY2UocHJlZml4KSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgbmFtZXNwYWNlVVJJID0gVmFsdWU7DQogICAgICAgICAgICAgICAgTW92ZVRvUGFyZW50KCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVzcGFjZVVSSTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gQ2hlY2sgZm9yICIiLCAieG1sIiwgYW5kICJ4bWxucyIgcHJlZml4ZXMNCiAgICAgICAgICAgIGlmIChwcmVmaXguTGVuZ3RoID09IDApDQogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHByZWZpeCA9PSAieG1sIikNCiAgICAgICAgICAgICAgICByZXR1cm4gWG1sUmVzZXJ2ZWROcy5Oc1htbDsNCiAgICAgICAgICAgIGVsc2UgaWYgKHByZWZpeCA9PSAieG1sbnMiKQ0KICAgICAgICAgICAgICAgIHJldHVybiBYbWxSZXNlcnZlZE5zLk5zWG1sTnM7DQoNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgc3RyaW5nIExvb2t1cFByZWZpeChzdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAobmFtZXNwYWNlVVJJID09IG51bGwpDQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIG5hdkNsb25lID0gQ2xvbmUoKTsNCg0KICAgICAgICAgICAgaWYgKE5vZGVUeXBlICE9IFhQYXRoTm9kZVR5cGUuRWxlbWVudCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBJZiBjdXJyZW50IGl0ZW0gaXMgbm90IGFuIGVsZW1lbnQsIHRoZW4gdHJ5IHBhcmVudA0KICAgICAgICAgICAgICAgIGlmIChuYXZDbG9uZS5Nb3ZlVG9QYXJlbnQoKSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdkNsb25lLkxvb2t1cFByZWZpeChuYW1lc3BhY2VVUkkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChuYXZDbG9uZS5Nb3ZlVG9GaXJzdE5hbWVzcGFjZShYUGF0aE5hbWVzcGFjZVNjb3BlLkFsbCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBMb29wIHVudGlsIGEgbWF0Y2hpbmcgbmFtZXNwYWNlIGlzIGZvdW5kDQogICAgICAgICAgICAgICAgICAgIGRvDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuYW1lc3BhY2VVUkkgPT0gbmF2Q2xvbmUuVmFsdWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdkNsb25lLkxvY2FsTmFtZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAobmF2Q2xvbmUuTW92ZVRvTmV4dE5hbWVzcGFjZShYUGF0aE5hbWVzcGFjZVNjb3BlLkFsbCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGRlZmF1bHQsICJ4bWwiLCBhbmQgInhtbG5zIiBuYW1lc3BhY2VzDQogICAgICAgICAgICBpZiAobmFtZXNwYWNlVVJJID09IExvb2t1cE5hbWVzcGFjZShzdHJpbmcuRW1wdHkpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmcuRW1wdHk7DQogICAgICAgICAgICBlbHNlIGlmIChuYW1lc3BhY2VVUkkgPT0gWG1sUmVzZXJ2ZWROcy5Oc1htbCkNCiAgICAgICAgICAgICAgICByZXR1cm4gInhtbCI7DQogICAgICAgICAgICBlbHNlIGlmIChuYW1lc3BhY2VVUkkgPT0gWG1sUmVzZXJ2ZWROcy5Oc1htbE5zKQ0KICAgICAgICAgICAgICAgIHJldHVybiAieG1sbnMiOw0KDQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIElEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBHZXROYW1lc3BhY2VzSW5TY29wZShYbWxOYW1lc3BhY2VTY29wZSBzY29wZSkNCiAgICAgICAgew0KICAgICAgICAgICAgWFBhdGhOb2RlVHlwZSBudCA9IE5vZGVUeXBlOw0KICAgICAgICAgICAgaWYgKChudCAhPSBYUGF0aE5vZGVUeXBlLkVsZW1lbnQgJiYgc2NvcGUgIT0gWG1sTmFtZXNwYWNlU2NvcGUuTG9jYWwpIHx8IG50ID09IFhQYXRoTm9kZVR5cGUuQXR0cmlidXRlIHx8IG50ID09IFhQYXRoTm9kZVR5cGUuTmFtZXNwYWNlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIG5hdlNhdmUgPSBDbG9uZSgpOw0KDQogICAgICAgICAgICAgICAgLy8gSWYgY3VycmVudCBpdGVtIGlzIG5vdCBhbiBlbGVtZW50LCB0aGVuIHRyeSBwYXJlbnQNCiAgICAgICAgICAgICAgICBpZiAobmF2U2F2ZS5Nb3ZlVG9QYXJlbnQoKSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdlNhdmUuR2V0TmFtZXNwYWNlc0luU2NvcGUoc2NvcGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBkaWN0ID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+KCk7DQoNCiAgICAgICAgICAgIC8vICJ4bWwiIHByZWZpeCBhbHdheXMgaW4gc2NvcGUNCiAgICAgICAgICAgIGlmIChzY29wZSA9PSBYbWxOYW1lc3BhY2VTY29wZS5BbGwpDQogICAgICAgICAgICAgICAgZGljdFsieG1sIl0gPSBYbWxSZXNlcnZlZE5zLk5zWG1sOw0KDQogICAgICAgICAgICAvLyBOb3cgYWRkIGFsbCBpbi1zY29wZSBuYW1lc3BhY2VzDQogICAgICAgICAgICBpZiAoTW92ZVRvRmlyc3ROYW1lc3BhY2UoKFhQYXRoTmFtZXNwYWNlU2NvcGUpc2NvcGUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGRvDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcHJlZml4ID0gTG9jYWxOYW1lOw0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgbnMgPSBWYWx1ZTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBFeGNsdWRlIHhtbG5zPSIiIGRlY2xhcmF0aW9ucyB1bmxlc3Mgc2NvcGUgPSBMb2NhbA0KICAgICAgICAgICAgICAgICAgICBpZiAocHJlZml4Lkxlbmd0aCAhPSAwIHx8IG5zLkxlbmd0aCAhPSAwIHx8IHNjb3BlID09IFhtbE5hbWVzcGFjZVNjb3BlLkxvY2FsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZGljdFtwcmVmaXhdID0gbnM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHdoaWxlIChNb3ZlVG9OZXh0TmFtZXNwYWNlKChYUGF0aE5hbWVzcGFjZVNjb3BlKXNjb3BlKSk7DQoNCiAgICAgICAgICAgICAgICBNb3ZlVG9QYXJlbnQoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGRpY3Q7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIFhQYXRoTmF2aWdhdG9yDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgICAgICAvLyBSZXR1cm5zIGFuIG9iamVjdCBvZiB0eXBlIElLZXlDb21wYXJlci4gVXNpbmcgdGhpcyB0aGUgbmF2aWdhdG9ycyBjYW4gYmUgaGFzaGVkDQogICAgICAgIC8vIG9uIHRoZSBiYXNpcyBvZiBhY3R1YWwgcG9zaXRpb24gaXQgcmVwcmVzZW50cyByYXRoZXIgdGhhbiB0aGUgY2xyIHJlZmVyZW5jZSBvZiANCiAgICAgICAgLy8gdGhlIG5hdmlnYXRvciBvYmplY3QuDQogICAgICAgIHB1YmxpYyBzdGF0aWMgSUVxdWFsaXR5Q29tcGFyZXIgTmF2aWdhdG9yQ29tcGFyZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIGNvbXBhcmVyOyB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgYWJzdHJhY3QgWFBhdGhOYXZpZ2F0b3IgQ2xvbmUoKTsNCg0KICAgICAgICBwdWJsaWMgYWJzdHJhY3QgWFBhdGhOb2RlVHlwZSBOb2RlVHlwZSB7IGdldDsgfQ0KDQogICAgICAgIHB1YmxpYyBhYnN0cmFjdCBzdHJpbmcgTG9jYWxOYW1lIHsgZ2V0OyB9DQoNCiAgICAgICAgcHVibGljIGFic3RyYWN0IHN0cmluZyBOYW1lIHsgZ2V0OyB9DQoNCiAgICAgICAgcHVibGljIGFic3RyYWN0IHN0cmluZyBOYW1lc3BhY2VVUkkgeyBnZXQ7IH0NCg0KICAgICAgICBwdWJsaWMgYWJzdHJhY3Qgc3RyaW5nIFByZWZpeCB7IGdldDsgfQ0KDQogICAgICAgIHB1YmxpYyBhYnN0cmFjdCBzdHJpbmcgQmFzZVVSSSB7IGdldDsgfQ0KDQogICAgICAgIHB1YmxpYyBhYnN0cmFjdCBib29sIElzRW1wdHlFbGVtZW50IHsgZ2V0OyB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgc3RyaW5nIFhtbExhbmcNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgbmF2Q2xvbmUgPSBDbG9uZSgpOw0KICAgICAgICAgICAgICAgIGRvDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAobmF2Q2xvbmUuTW92ZVRvQXR0cmlidXRlKCJsYW5nIiwgWG1sUmVzZXJ2ZWROcy5Oc1htbCkpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2Q2xvbmUuVmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHdoaWxlIChuYXZDbG9uZS5Nb3ZlVG9QYXJlbnQoKSk7DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sUmVhZGVyIFJlYWRTdWJ0cmVlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3dpdGNoIChOb2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuUm9vdDoNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuRWxlbWVudDoNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWHBuX0JhZFBvc2l0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBDcmVhdGVSZWFkZXIoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgV3JpdGVTdWJ0cmVlKFhtbFdyaXRlciB3cml0ZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChudWxsID09IHdyaXRlcikNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZih3cml0ZXIpKTsNCiAgICAgICAgICAgIHdyaXRlci5Xcml0ZU5vZGUodGhpcywgdHJ1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBvYmplY3QgVW5kZXJseWluZ09iamVjdA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBIYXNBdHRyaWJ1dGVzDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICghTW92ZVRvRmlyc3RBdHRyaWJ1dGUoKSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICAgICAgTW92ZVRvUGFyZW50KCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBzdHJpbmcgR2V0QXR0cmlidXRlKHN0cmluZyBsb2NhbE5hbWUsIHN0cmluZyBuYW1lc3BhY2VVUkkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyB2YWx1ZTsNCg0KICAgICAgICAgICAgaWYgKCFNb3ZlVG9BdHRyaWJ1dGUobG9jYWxOYW1lLCBuYW1lc3BhY2VVUkkpKQ0KICAgICAgICAgICAgICAgIHJldHVybiAiIjsNCg0KICAgICAgICAgICAgdmFsdWUgPSBWYWx1ZTsNCiAgICAgICAgICAgIE1vdmVUb1BhcmVudCgpOw0KDQogICAgICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBib29sIE1vdmVUb0F0dHJpYnV0ZShzdHJpbmcgbG9jYWxOYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTW92ZVRvRmlyc3RBdHRyaWJ1dGUoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBkbw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsTmFtZSA9PSBMb2NhbE5hbWUgJiYgbmFtZXNwYWNlVVJJID09IE5hbWVzcGFjZVVSSSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB3aGlsZSAoTW92ZVRvTmV4dEF0dHJpYnV0ZSgpKTsNCg0KICAgICAgICAgICAgICAgIE1vdmVUb1BhcmVudCgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgYWJzdHJhY3QgYm9vbCBNb3ZlVG9GaXJzdEF0dHJpYnV0ZSgpOw0KDQogICAgICAgIHB1YmxpYyBhYnN0cmFjdCBib29sIE1vdmVUb05leHRBdHRyaWJ1dGUoKTsNCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBzdHJpbmcgR2V0TmFtZXNwYWNlKHN0cmluZyBuYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgdmFsdWU7DQoNCiAgICAgICAgICAgIGlmICghTW92ZVRvTmFtZXNwYWNlKG5hbWUpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChuYW1lID09ICJ4bWwiKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWG1sUmVzZXJ2ZWROcy5Oc1htbDsNCiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSAieG1sbnMiKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWG1sUmVzZXJ2ZWROcy5Oc1htbE5zOw0KICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmcuRW1wdHk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhbHVlID0gVmFsdWU7DQogICAgICAgICAgICBNb3ZlVG9QYXJlbnQoKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBNb3ZlVG9OYW1lc3BhY2Uoc3RyaW5nIG5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChNb3ZlVG9GaXJzdE5hbWVzcGFjZShYUGF0aE5hbWVzcGFjZVNjb3BlLkFsbCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZG8NCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lID09IExvY2FsTmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB3aGlsZSAoTW92ZVRvTmV4dE5hbWVzcGFjZShYUGF0aE5hbWVzcGFjZVNjb3BlLkFsbCkpOw0KDQogICAgICAgICAgICAgICAgTW92ZVRvUGFyZW50KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBhYnN0cmFjdCBib29sIE1vdmVUb0ZpcnN0TmFtZXNwYWNlKFhQYXRoTmFtZXNwYWNlU2NvcGUgbmFtZXNwYWNlU2NvcGUpOw0KDQogICAgICAgIHB1YmxpYyBhYnN0cmFjdCBib29sIE1vdmVUb05leHROYW1lc3BhY2UoWFBhdGhOYW1lc3BhY2VTY29wZSBuYW1lc3BhY2VTY29wZSk7DQoNCiAgICAgICAgcHVibGljIGJvb2wgTW92ZVRvRmlyc3ROYW1lc3BhY2UoKSB7IHJldHVybiBNb3ZlVG9GaXJzdE5hbWVzcGFjZShYUGF0aE5hbWVzcGFjZVNjb3BlLkFsbCk7IH0NCg0KICAgICAgICBwdWJsaWMgYm9vbCBNb3ZlVG9OZXh0TmFtZXNwYWNlKCkgeyByZXR1cm4gTW92ZVRvTmV4dE5hbWVzcGFjZShYUGF0aE5hbWVzcGFjZVNjb3BlLkFsbCk7IH0NCg0KICAgICAgICBwdWJsaWMgYWJzdHJhY3QgYm9vbCBNb3ZlVG9OZXh0KCk7DQoNCiAgICAgICAgcHVibGljIGFic3RyYWN0IGJvb2wgTW92ZVRvUHJldmlvdXMoKTsNCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBib29sIE1vdmVUb0ZpcnN0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3dpdGNoIChOb2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuQXR0cmlidXRlOg0KICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5OYW1lc3BhY2U6DQogICAgICAgICAgICAgICAgICAgIC8vIE1vdmVUb0ZpcnN0IHNob3VsZCBvbmx5IHN1Y2NlZWQgZm9yIGNvbnRlbnQtdHlwZWQgbm9kZXMNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoIU1vdmVUb1BhcmVudCgpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCg0KICAgICAgICAgICAgcmV0dXJuIE1vdmVUb0ZpcnN0Q2hpbGQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBhYnN0cmFjdCBib29sIE1vdmVUb0ZpcnN0Q2hpbGQoKTsNCg0KICAgICAgICBwdWJsaWMgYWJzdHJhY3QgYm9vbCBNb3ZlVG9QYXJlbnQoKTsNCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIE1vdmVUb1Jvb3QoKQ0KICAgICAgICB7DQogICAgICAgICAgICB3aGlsZSAoTW92ZVRvUGFyZW50KCkpDQogICAgICAgICAgICAgICAgOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGFic3RyYWN0IGJvb2wgTW92ZVRvKFhQYXRoTmF2aWdhdG9yIG90aGVyKTsNCg0KICAgICAgICBwdWJsaWMgYWJzdHJhY3QgYm9vbCBNb3ZlVG9JZChzdHJpbmcgaWQpOw0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIGJvb2wgTW92ZVRvQ2hpbGQoc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKE1vdmVUb0ZpcnN0Q2hpbGQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBkbw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKE5vZGVUeXBlID09IFhQYXRoTm9kZVR5cGUuRWxlbWVudCAmJiBsb2NhbE5hbWUgPT0gTG9jYWxOYW1lICYmIG5hbWVzcGFjZVVSSSA9PSBOYW1lc3BhY2VVUkkpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgd2hpbGUgKE1vdmVUb05leHQoKSk7DQogICAgICAgICAgICAgICAgTW92ZVRvUGFyZW50KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIGJvb2wgTW92ZVRvQ2hpbGQoWFBhdGhOb2RlVHlwZSB0eXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTW92ZVRvRmlyc3RDaGlsZCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGludCBtYXNrID0gR2V0Q29udGVudEtpbmRNYXNrKHR5cGUpOw0KICAgICAgICAgICAgICAgIGRvDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoKCgxIDw8IChpbnQpTm9kZVR5cGUpICYgbWFzaykgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB3aGlsZSAoTW92ZVRvTmV4dCgpKTsNCg0KICAgICAgICAgICAgICAgIE1vdmVUb1BhcmVudCgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBib29sIE1vdmVUb0ZvbGxvd2luZyhzdHJpbmcgbG9jYWxOYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gTW92ZVRvRm9sbG93aW5nKGxvY2FsTmFtZSwgbmFtZXNwYWNlVVJJLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIGJvb2wgTW92ZVRvRm9sbG93aW5nKHN0cmluZyBsb2NhbE5hbWUsIHN0cmluZyBuYW1lc3BhY2VVUkksIFhQYXRoTmF2aWdhdG9yIGVuZCkNCiAgICAgICAgew0KICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgbmF2U2F2ZSA9IENsb25lKCk7DQoNCiAgICAgICAgICAgIGlmIChlbmQgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGVuZC5Ob2RlVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5BdHRyaWJ1dGU6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5OYW1lc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTY2FuIHVudGlsIHdlIGNvbWUgdG8gdGhlIG5leHQgY29udGVudC10eXBlZCBub2RlIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgdGhlIGF0dHJpYnV0ZSBvciBuYW1lc3BhY2Ugbm9kZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gZW5kLkNsb25lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbmQuTW92ZVRvTm9uRGVzY2VuZGFudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3dpdGNoIChOb2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuQXR0cmlidXRlOg0KICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5OYW1lc3BhY2U6DQogICAgICAgICAgICAgICAgICAgIGlmICghTW92ZVRvUGFyZW50KCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRvDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFNb3ZlVG9GaXJzdENoaWxkKCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBMb29rIGZvciBuZXh0IHNpYmxpbmcNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNb3ZlVG9OZXh0KCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghTW92ZVRvUGFyZW50KCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBwcmV2aW91cyBwb3NpdGlvbiBhbmQgcmV0dXJuIGZhbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW92ZVRvKG5hdlNhdmUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIEhhdmUgd2UgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBzY2FuPw0KICAgICAgICAgICAgICAgIGlmIChlbmQgIT0gbnVsbCAmJiBJc1NhbWVQb3NpdGlvbihlbmQpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBwcmV2aW91cyBwb3NpdGlvbiBhbmQgcmV0dXJuIGZhbHNlDQogICAgICAgICAgICAgICAgICAgIE1vdmVUbyhuYXZTYXZlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHdoaWxlIChOb2RlVHlwZSAhPSBYUGF0aE5vZGVUeXBlLkVsZW1lbnQNCiAgICAgICAgICAgICAgICAgICB8fCBsb2NhbE5hbWUgIT0gTG9jYWxOYW1lDQogICAgICAgICAgICAgICAgICAgfHwgbmFtZXNwYWNlVVJJICE9IE5hbWVzcGFjZVVSSSk7DQoNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBNb3ZlVG9Gb2xsb3dpbmcoWFBhdGhOb2RlVHlwZSB0eXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gTW92ZVRvRm9sbG93aW5nKHR5cGUsIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBNb3ZlVG9Gb2xsb3dpbmcoWFBhdGhOb2RlVHlwZSB0eXBlLCBYUGF0aE5hdmlnYXRvciBlbmQpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIG5hdlNhdmUgPSBDbG9uZSgpOw0KICAgICAgICAgICAgaW50IG1hc2sgPSBHZXRDb250ZW50S2luZE1hc2sodHlwZSk7DQoNCiAgICAgICAgICAgIGlmIChlbmQgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGVuZC5Ob2RlVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5BdHRyaWJ1dGU6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5OYW1lc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTY2FuIHVudGlsIHdlIGNvbWUgdG8gdGhlIG5leHQgY29udGVudC10eXBlZCBub2RlIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgdGhlIGF0dHJpYnV0ZSBvciBuYW1lc3BhY2Ugbm9kZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gZW5kLkNsb25lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbmQuTW92ZVRvTm9uRGVzY2VuZGFudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3dpdGNoIChOb2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuQXR0cmlidXRlOg0KICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5OYW1lc3BhY2U6DQogICAgICAgICAgICAgICAgICAgIGlmICghTW92ZVRvUGFyZW50KCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRvDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFNb3ZlVG9GaXJzdENoaWxkKCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBMb29rIGZvciBuZXh0IHNpYmxpbmcNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNb3ZlVG9OZXh0KCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghTW92ZVRvUGFyZW50KCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBwcmV2aW91cyBwb3NpdGlvbiBhbmQgcmV0dXJuIGZhbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW92ZVRvKG5hdlNhdmUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIEhhdmUgd2UgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBzY2FuPw0KICAgICAgICAgICAgICAgIGlmIChlbmQgIT0gbnVsbCAmJiBJc1NhbWVQb3NpdGlvbihlbmQpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBwcmV2aW91cyBwb3NpdGlvbiBhbmQgcmV0dXJuIGZhbHNlDQogICAgICAgICAgICAgICAgICAgIE1vdmVUbyhuYXZTYXZlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHdoaWxlICgoKDEgPDwgKGludClOb2RlVHlwZSkgJiBtYXNrKSA9PSAwKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBib29sIE1vdmVUb05leHQoc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSkNCiAgICAgICAgew0KICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgbmF2Q2xvbmUgPSBDbG9uZSgpOw0KDQogICAgICAgICAgICB3aGlsZSAoTW92ZVRvTmV4dCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChOb2RlVHlwZSA9PSBYUGF0aE5vZGVUeXBlLkVsZW1lbnQgJiYgbG9jYWxOYW1lID09IExvY2FsTmFtZSAmJiBuYW1lc3BhY2VVUkkgPT0gTmFtZXNwYWNlVVJJKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIE1vdmVUbyhuYXZDbG9uZSk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBib29sIE1vdmVUb05leHQoWFBhdGhOb2RlVHlwZSB0eXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBYUGF0aE5hdmlnYXRvciBuYXZDbG9uZSA9IENsb25lKCk7DQogICAgICAgICAgICBpbnQgbWFzayA9IEdldENvbnRlbnRLaW5kTWFzayh0eXBlKTsNCg0KICAgICAgICAgICAgd2hpbGUgKE1vdmVUb05leHQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoKCgxIDw8IChpbnQpTm9kZVR5cGUpICYgbWFzaykgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIE1vdmVUbyhuYXZDbG9uZSk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBib29sIEhhc0NoaWxkcmVuDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChNb3ZlVG9GaXJzdENoaWxkKCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBNb3ZlVG9QYXJlbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBhYnN0cmFjdCBib29sIElzU2FtZVBvc2l0aW9uKFhQYXRoTmF2aWdhdG9yIG90aGVyKTsNCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBib29sIElzRGVzY2VuZGFudChYUGF0aE5hdmlnYXRvciBuYXYpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChuYXYgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBuYXYgPSBuYXYuQ2xvbmUoKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAobmF2Lk1vdmVUb1BhcmVudCgpKQ0KICAgICAgICAgICAgICAgICAgICBpZiAobmF2LklzU2FtZVBvc2l0aW9uKHRoaXMpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxOb2RlT3JkZXIgQ29tcGFyZVBvc2l0aW9uKFhQYXRoTmF2aWdhdG9yIG5hdikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG5hdiA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBYbWxOb2RlT3JkZXIuVW5rbm93bjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKElzU2FtZVBvc2l0aW9uKG5hdikpDQogICAgICAgICAgICAgICAgcmV0dXJuIFhtbE5vZGVPcmRlci5TYW1lOw0KDQogICAgICAgICAgICBYUGF0aE5hdmlnYXRvciBuMSA9IHRoaXMuQ2xvbmUoKTsNCiAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIG4yID0gbmF2LkNsb25lKCk7DQoNCiAgICAgICAgICAgIGludCBkZXB0aDEgPSBHZXREZXB0aChuMS5DbG9uZSgpKTsNCiAgICAgICAgICAgIGludCBkZXB0aDIgPSBHZXREZXB0aChuMi5DbG9uZSgpKTsNCg0KICAgICAgICAgICAgaWYgKGRlcHRoMSA+IGRlcHRoMikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAoZGVwdGgxID4gZGVwdGgyKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgbjEuTW92ZVRvUGFyZW50KCk7DQogICAgICAgICAgICAgICAgICAgIGRlcHRoMS0tOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobjEuSXNTYW1lUG9zaXRpb24objIpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWG1sTm9kZU9yZGVyLkFmdGVyOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoZGVwdGgyID4gZGVwdGgxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHdoaWxlIChkZXB0aDIgPiBkZXB0aDEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBuMi5Nb3ZlVG9QYXJlbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgZGVwdGgyLS07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChuMS5Jc1NhbWVQb3NpdGlvbihuMikpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBYbWxOb2RlT3JkZXIuQmVmb3JlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBYUGF0aE5hdmlnYXRvciBwYXJlbnQxID0gbjEuQ2xvbmUoKTsNCiAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIHBhcmVudDIgPSBuMi5DbG9uZSgpOw0KDQogICAgICAgICAgICB3aGlsZSAodHJ1ZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIXBhcmVudDEuTW92ZVRvUGFyZW50KCkgfHwgIXBhcmVudDIuTW92ZVRvUGFyZW50KCkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBYbWxOb2RlT3JkZXIuVW5rbm93bjsNCg0KICAgICAgICAgICAgICAgIGlmIChwYXJlbnQxLklzU2FtZVBvc2l0aW9uKHBhcmVudDIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG4xLkdldFR5cGUoKS5Ub1N0cmluZygpICE9ICJNaWNyb3NvZnQuVmlzdWFsU3R1ZGlvLk1vZGVsaW5nLlN0b3JlTmF2aWdhdG9yIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcuQXNzZXJ0KENvbXBhcmVTaWJsaW5ncyhuMS5DbG9uZSgpLCBuMi5DbG9uZSgpKSAhPSBDb21wYXJlU2libGluZ3MobjIuQ2xvbmUoKSwgbjEuQ2xvbmUoKSksICJJc1NhbWVQb3NpdGlvbigpIG9uIGN1c3RvbSBuYXZpZ2F0b3IgcmV0dXJucyBpbmNvbnNpc3RlbnQgcmVzdWx0cyIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb21wYXJlU2libGluZ3MobjEsIG4yKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBuMS5Nb3ZlVG9QYXJlbnQoKTsNCiAgICAgICAgICAgICAgICBuMi5Nb3ZlVG9QYXJlbnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIElYbWxTY2hlbWFJbmZvIFNjaGVtYUluZm8NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIHRoaXMgYXMgSVhtbFNjaGVtYUluZm87IH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIGJvb2wgQ2hlY2tWYWxpZGl0eShYbWxTY2hlbWFTZXQgc2NoZW1hcywgVmFsaWRhdGlvbkV2ZW50SGFuZGxlciB2YWxpZGF0aW9uRXZlbnRIYW5kbGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBJWG1sU2NoZW1hSW5mbyBzY2hlbWFJbmZvOw0KICAgICAgICAgICAgWG1sU2NoZW1hVHlwZSBzY2hlbWFUeXBlID0gbnVsbDsNCiAgICAgICAgICAgIFhtbFNjaGVtYUVsZW1lbnQgc2NoZW1hRWxlbWVudCA9IG51bGw7DQogICAgICAgICAgICBYbWxTY2hlbWFBdHRyaWJ1dGUgc2NoZW1hQXR0cmlidXRlID0gbnVsbDsNCg0KICAgICAgICAgICAgc3dpdGNoIChOb2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuUm9vdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYXMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWFBhdGhEb2N1bWVudF9NaXNzaW5nU2NoZW1hcyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgc2NoZW1hVHlwZSA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5FbGVtZW50Og0KICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hcyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YUGF0aERvY3VtZW50X01pc3NpbmdTY2hlbWFzKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBzY2hlbWFJbmZvID0gU2NoZW1hSW5mbzsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYUluZm8gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hVHlwZSA9IHNjaGVtYUluZm8uU2NoZW1hVHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYUVsZW1lbnQgPSBzY2hlbWFJbmZvLlNjaGVtYUVsZW1lbnQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYVR5cGUgPT0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgc2NoZW1hRWxlbWVudCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5Gb3JtYXQoU1IuWFBhdGhEb2N1bWVudF9Ob3RFbm91Z2hTY2hlbWFJbmZvLCBudWxsKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLkF0dHJpYnV0ZToNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjaGVtYXMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuWFBhdGhEb2N1bWVudF9NaXNzaW5nU2NoZW1hcyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgc2NoZW1hSW5mbyA9IFNjaGVtYUluZm87DQogICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWFJbmZvICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVR5cGUgPSBzY2hlbWFJbmZvLlNjaGVtYVR5cGU7DQogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFBdHRyaWJ1dGUgPSBzY2hlbWFJbmZvLlNjaGVtYUF0dHJpYnV0ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVHlwZSA9PSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAmJiBzY2hlbWFBdHRyaWJ1dGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oU1IuRm9ybWF0KFNSLlhQYXRoRG9jdW1lbnRfTm90RW5vdWdoU2NoZW1hSW5mbywgbnVsbCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLkZvcm1hdChTUi5YUGF0aERvY3VtZW50X1ZhbGlkYXRlSW52YWxpZE5vZGVUeXBlLCBudWxsKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIERlYnVnLkFzc2VydChzY2hlbWFUeXBlICE9IG51bGwgfHwgdGhpcy5Ob2RlVHlwZSA9PSBYUGF0aE5vZGVUeXBlLlJvb3QsICJzY2hlbWFUeXBlICE9IG51bGwgIHx8IHRoaXMuTm9kZVR5cGUgPT0gWFBhdGhOb2RlVHlwZS5Sb290Iik7DQoNCiAgICAgICAgICAgIFhtbFJlYWRlciByZWFkZXIgPSBDcmVhdGVSZWFkZXIoKTsNCg0KICAgICAgICAgICAgQ2hlY2tWYWxpZGl0eUhlbHBlciB2YWxpZGl0eVRyYWNrZXIgPSBuZXcgQ2hlY2tWYWxpZGl0eUhlbHBlcih2YWxpZGF0aW9uRXZlbnRIYW5kbGVyLCByZWFkZXIgYXMgWFBhdGhOYXZpZ2F0b3JSZWFkZXIpOw0KICAgICAgICAgICAgdmFsaWRhdGlvbkV2ZW50SGFuZGxlciA9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKHZhbGlkaXR5VHJhY2tlci5WYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgWG1sUmVhZGVyIHZhbGlkYXRpbmdSZWFkZXIgPSBHZXRWYWxpZGF0aW5nUmVhZGVyKHJlYWRlciwgc2NoZW1hcywgdmFsaWRhdGlvbkV2ZW50SGFuZGxlciwgc2NoZW1hVHlwZSwgc2NoZW1hRWxlbWVudCwgc2NoZW1hQXR0cmlidXRlKTsNCg0KICAgICAgICAgICAgd2hpbGUgKHZhbGlkYXRpbmdSZWFkZXIuUmVhZCgpKQ0KICAgICAgICAgICAgICAgIDsNCg0KICAgICAgICAgICAgcmV0dXJuIHZhbGlkaXR5VHJhY2tlci5Jc1ZhbGlkOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxSZWFkZXIgR2V0VmFsaWRhdGluZ1JlYWRlcihYbWxSZWFkZXIgcmVhZGVyLCBYbWxTY2hlbWFTZXQgc2NoZW1hcywgVmFsaWRhdGlvbkV2ZW50SGFuZGxlciB2YWxpZGF0aW9uRXZlbnQsIFhtbFNjaGVtYVR5cGUgc2NoZW1hVHlwZSwgWG1sU2NoZW1hRWxlbWVudCBzY2hlbWFFbGVtZW50LCBYbWxTY2hlbWFBdHRyaWJ1dGUgc2NoZW1hQXR0cmlidXRlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoc2NoZW1hQXR0cmlidXRlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNjaGVtYUF0dHJpYnV0ZS5WYWxpZGF0ZShyZWFkZXIsIG51bGwsIHNjaGVtYXMsIHZhbGlkYXRpb25FdmVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChzY2hlbWFFbGVtZW50ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNjaGVtYUVsZW1lbnQuVmFsaWRhdGUocmVhZGVyLCBudWxsLCBzY2hlbWFzLCB2YWxpZGF0aW9uRXZlbnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoc2NoZW1hVHlwZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWFUeXBlLlZhbGlkYXRlKHJlYWRlciwgbnVsbCwgc2NoZW1hcywgdmFsaWRhdGlvbkV2ZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIERlYnVnLkFzc2VydChzY2hlbWFzICE9IG51bGwsICJzY2hlbWFzICE9IG51bGwiKTsNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHJlYWRlclNldHRpbmdzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQogICAgICAgICAgICByZWFkZXJTZXR0aW5ncy5Db25mb3JtYW5jZUxldmVsID0gQ29uZm9ybWFuY2VMZXZlbC5BdXRvOw0KICAgICAgICAgICAgcmVhZGVyU2V0dGluZ3MuVmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5TY2hlbWE7DQogICAgICAgICAgICByZWFkZXJTZXR0aW5ncy5TY2hlbWFzID0gc2NoZW1hczsNCiAgICAgICAgICAgIHJlYWRlclNldHRpbmdzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gdmFsaWRhdGlvbkV2ZW50Ow0KICAgICAgICAgICAgcmV0dXJuIFhtbFJlYWRlci5DcmVhdGUocmVhZGVyLCByZWFkZXJTZXR0aW5ncyk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGNsYXNzIENoZWNrVmFsaWRpdHlIZWxwZXINCiAgICAgICAgew0KICAgICAgICAgICAgcHJpdmF0ZSBib29sIF9pc1ZhbGlkOw0KICAgICAgICAgICAgcHJpdmF0ZSBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyIF9uZXh0RXZlbnRIYW5kbGVyOw0KICAgICAgICAgICAgcHJpdmF0ZSBYUGF0aE5hdmlnYXRvclJlYWRlciBfcmVhZGVyOw0KDQogICAgICAgICAgICBpbnRlcm5hbCBDaGVja1ZhbGlkaXR5SGVscGVyKFZhbGlkYXRpb25FdmVudEhhbmRsZXIgbmV4dEV2ZW50SGFuZGxlciwgWFBhdGhOYXZpZ2F0b3JSZWFkZXIgcmVhZGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9pc1ZhbGlkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBfbmV4dEV2ZW50SGFuZGxlciA9IG5leHRFdmVudEhhbmRsZXI7DQogICAgICAgICAgICAgICAgX3JlYWRlciA9IHJlYWRlcjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaW50ZXJuYWwgdm9pZCBWYWxpZGF0aW9uQ2FsbGJhY2sob2JqZWN0IHNlbmRlciwgVmFsaWRhdGlvbkV2ZW50QXJncyBhcmdzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIERlYnVnLkFzc2VydChhcmdzICE9IG51bGwpOw0KICAgICAgICAgICAgICAgIGlmIChhcmdzLlNldmVyaXR5ID09IFhtbFNldmVyaXR5VHlwZS5FcnJvcikNCiAgICAgICAgICAgICAgICAgICAgX2lzVmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFWYWxpZGF0aW9uRXhjZXB0aW9uIGV4Y2VwdGlvbiA9IGFyZ3MuRXhjZXB0aW9uIGFzIFhtbFNjaGVtYVZhbGlkYXRpb25FeGNlcHRpb247DQogICAgICAgICAgICAgICAgaWYgKGV4Y2VwdGlvbiAhPSBudWxsICYmIF9yZWFkZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0aW9uLlNldFNvdXJjZU9iamVjdChfcmVhZGVyLlVuZGVybHlpbmdPYmplY3QpOw0KDQogICAgICAgICAgICAgICAgaWYgKF9uZXh0RXZlbnRIYW5kbGVyICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfbmV4dEV2ZW50SGFuZGxlcihzZW5kZXIsIGFyZ3MpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChleGNlcHRpb24gIT0gbnVsbCAmJiBhcmdzLlNldmVyaXR5ID09IFhtbFNldmVyaXR5VHlwZS5FcnJvcikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IGV4Y2VwdGlvbjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGludGVybmFsIGJvb2wgSXNWYWxpZA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGdldCB7IHJldHVybiBfaXNWYWxpZDsgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWFBhdGhFeHByZXNzaW9uIENvbXBpbGUoc3RyaW5nIHhwYXRoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gWFBhdGhFeHByZXNzaW9uLkNvbXBpbGUoeHBhdGgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWFBhdGhOYXZpZ2F0b3IgU2VsZWN0U2luZ2xlTm9kZShzdHJpbmcgeHBhdGgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBTZWxlY3RTaW5nbGVOb2RlKFhQYXRoRXhwcmVzc2lvbi5Db21waWxlKHhwYXRoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYUGF0aE5hdmlnYXRvciBTZWxlY3RTaW5nbGVOb2RlKHN0cmluZyB4cGF0aCwgSVhtbE5hbWVzcGFjZVJlc29sdmVyIHJlc29sdmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gU2VsZWN0U2luZ2xlTm9kZShYUGF0aEV4cHJlc3Npb24uQ29tcGlsZSh4cGF0aCwgcmVzb2x2ZXIpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhQYXRoTmF2aWdhdG9yIFNlbGVjdFNpbmdsZU5vZGUoWFBhdGhFeHByZXNzaW9uIGV4cHJlc3Npb24pDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIFBFUkYgQlVHOiB0aGlzIGFjdHVhbGx5IGNhY2hlcyBfYWxsXyBtYXRjaGluZyBub2Rlcy4uLg0KICAgICAgICAgICAgWFBhdGhOb2RlSXRlcmF0b3IgaXRlciA9IHRoaXMuU2VsZWN0KGV4cHJlc3Npb24pOw0KICAgICAgICAgICAgaWYgKGl0ZXIuTW92ZU5leHQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gaXRlci5DdXJyZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYUGF0aE5vZGVJdGVyYXRvciBTZWxlY3Qoc3RyaW5nIHhwYXRoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5TZWxlY3QoWFBhdGhFeHByZXNzaW9uLkNvbXBpbGUoeHBhdGgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhQYXRoTm9kZUl0ZXJhdG9yIFNlbGVjdChzdHJpbmcgeHBhdGgsIElYbWxOYW1lc3BhY2VSZXNvbHZlciByZXNvbHZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuU2VsZWN0KFhQYXRoRXhwcmVzc2lvbi5Db21waWxlKHhwYXRoLCByZXNvbHZlcikpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWFBhdGhOb2RlSXRlcmF0b3IgU2VsZWN0KFhQYXRoRXhwcmVzc2lvbiBleHByKQ0KICAgICAgICB7DQogICAgICAgICAgICBYUGF0aE5vZGVJdGVyYXRvciByZXN1bHQgPSBFdmFsdWF0ZShleHByKSBhcyBYUGF0aE5vZGVJdGVyYXRvcjsNCiAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBYUGF0aEV4Y2VwdGlvbi5DcmVhdGUoU1IuWHBfTm9kZVNldEV4cGVjdGVkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBvYmplY3QgRXZhbHVhdGUoc3RyaW5nIHhwYXRoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gRXZhbHVhdGUoWFBhdGhFeHByZXNzaW9uLkNvbXBpbGUoeHBhdGgpLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIG9iamVjdCBFdmFsdWF0ZShzdHJpbmcgeHBhdGgsIElYbWxOYW1lc3BhY2VSZXNvbHZlciByZXNvbHZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuRXZhbHVhdGUoWFBhdGhFeHByZXNzaW9uLkNvbXBpbGUoeHBhdGgsIHJlc29sdmVyKSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBvYmplY3QgRXZhbHVhdGUoWFBhdGhFeHByZXNzaW9uIGV4cHIpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBFdmFsdWF0ZShleHByLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIG9iamVjdCBFdmFsdWF0ZShYUGF0aEV4cHJlc3Npb24gZXhwciwgWFBhdGhOb2RlSXRlcmF0b3IgY29udGV4dCkNCiAgICAgICAgew0KICAgICAgICAgICAgQ29tcGlsZWRYcGF0aEV4cHIgY2V4cHIgPSBleHByIGFzIENvbXBpbGVkWHBhdGhFeHByOw0KICAgICAgICAgICAgaWYgKGNleHByID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgWFBhdGhFeGNlcHRpb24uQ3JlYXRlKFNSLlhwX0JhZFF1ZXJ5T2JqZWN0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFF1ZXJ5IHF1ZXJ5ID0gUXVlcnkuQ2xvbmUoY2V4cHIuUXVlcnlUcmVlKTsNCiAgICAgICAgICAgIHF1ZXJ5LlJlc2V0KCk7DQoNCiAgICAgICAgICAgIGlmIChjb250ZXh0ID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY29udGV4dCA9IG5ldyBYUGF0aFNpbmdsZXRvbkl0ZXJhdG9yKHRoaXMuQ2xvbmUoKSwgLyptb3ZlZDoqL3RydWUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBvYmplY3QgcmVzdWx0ID0gcXVlcnkuRXZhbHVhdGUoY29udGV4dCk7DQoNCiAgICAgICAgICAgIGlmIChyZXN1bHQgaXMgWFBhdGhOb2RlSXRlcmF0b3IpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBYUGF0aFNlbGVjdGlvbkl0ZXJhdG9yKGNvbnRleHQuQ3VycmVudCwgcXVlcnkpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBNYXRjaGVzKFhQYXRoRXhwcmVzc2lvbiBleHByKQ0KICAgICAgICB7DQogICAgICAgICAgICBDb21waWxlZFhwYXRoRXhwciBjZXhwciA9IGV4cHIgYXMgQ29tcGlsZWRYcGF0aEV4cHI7DQogICAgICAgICAgICBpZiAoY2V4cHIgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBYUGF0aEV4Y2VwdGlvbi5DcmVhdGUoU1IuWHBfQmFkUXVlcnlPYmplY3QpOw0KDQogICAgICAgICAgICAvLyBXZSBzaG91bGQgY2xvbmUgcXVlcnkgYmVjYXVzZSBzb21lIFF1ZXJ5Lk1hdGNoTm9kZSgpIGFsdGVyIGV4cHJlc3Npb24gc3RhdGUgYW5kIHRoaXMgbWF5IGJyYWtlDQogICAgICAgICAgICAvLyBTZWxlY3Rpb25JdGVyYXRvcnMgdGhhdCBhcmUgcnVubmluZyB1c2luZyB0aGlzIFF1ZXJ5DQogICAgICAgICAgICAvLyBFeGFtcGxlIG9mIE1hdGNoTm9kZSgpIHRoYXQgYWxlcnQgdGhlIHN0YXRlIGlzIEZpbHRlclF1ZXJ5Lk1hdGNoTm9kZSgpDQogICAgICAgICAgICBRdWVyeSBxdWVyeSA9IFF1ZXJ5LkNsb25lKGNleHByLlF1ZXJ5VHJlZSk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeS5NYXRjaE5vZGUodGhpcykgIT0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYUGF0aEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBYUGF0aEV4Y2VwdGlvbi5DcmVhdGUoU1IuWHBfSW52YWxpZFBhdHRlcm4sIGNleHByLkV4cHJlc3Npb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBNYXRjaGVzKHN0cmluZyB4cGF0aCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIE1hdGNoZXMoQ29tcGlsZU1hdGNoUGF0dGVybih4cGF0aCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWFBhdGhOb2RlSXRlcmF0b3IgU2VsZWN0Q2hpbGRyZW4oWFBhdGhOb2RlVHlwZSB0eXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhQYXRoQ2hpbGRJdGVyYXRvcih0aGlzLkNsb25lKCksIHR5cGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWFBhdGhOb2RlSXRlcmF0b3IgU2VsZWN0Q2hpbGRyZW4oc3RyaW5nIG5hbWUsIHN0cmluZyBuYW1lc3BhY2VVUkkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgWFBhdGhDaGlsZEl0ZXJhdG9yKHRoaXMuQ2xvbmUoKSwgbmFtZSwgbmFtZXNwYWNlVVJJKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhQYXRoTm9kZUl0ZXJhdG9yIFNlbGVjdEFuY2VzdG9ycyhYUGF0aE5vZGVUeXBlIHR5cGUsIGJvb2wgbWF0Y2hTZWxmKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhQYXRoQW5jZXN0b3JJdGVyYXRvcih0aGlzLkNsb25lKCksIHR5cGUsIG1hdGNoU2VsZik7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYUGF0aE5vZGVJdGVyYXRvciBTZWxlY3RBbmNlc3RvcnMoc3RyaW5nIG5hbWUsIHN0cmluZyBuYW1lc3BhY2VVUkksIGJvb2wgbWF0Y2hTZWxmKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhQYXRoQW5jZXN0b3JJdGVyYXRvcih0aGlzLkNsb25lKCksIG5hbWUsIG5hbWVzcGFjZVVSSSwgbWF0Y2hTZWxmKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhQYXRoTm9kZUl0ZXJhdG9yIFNlbGVjdERlc2NlbmRhbnRzKFhQYXRoTm9kZVR5cGUgdHlwZSwgYm9vbCBtYXRjaFNlbGYpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgWFBhdGhEZXNjZW5kYW50SXRlcmF0b3IodGhpcy5DbG9uZSgpLCB0eXBlLCBtYXRjaFNlbGYpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWFBhdGhOb2RlSXRlcmF0b3IgU2VsZWN0RGVzY2VuZGFudHMoc3RyaW5nIG5hbWUsIHN0cmluZyBuYW1lc3BhY2VVUkksIGJvb2wgbWF0Y2hTZWxmKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFhQYXRoRGVzY2VuZGFudEl0ZXJhdG9yKHRoaXMuQ2xvbmUoKSwgbmFtZSwgbmFtZXNwYWNlVVJJLCBtYXRjaFNlbGYpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgYm9vbCBDYW5FZGl0DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIFhtbFdyaXRlciBQcmVwZW5kQ2hpbGQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxXcml0ZXIgQXBwZW5kQ2hpbGQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxXcml0ZXIgSW5zZXJ0QWZ0ZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxXcml0ZXIgSW5zZXJ0QmVmb3JlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdGhyb3cgbmV3IE5vdFN1cHBvcnRlZEV4Y2VwdGlvbigpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgWG1sV3JpdGVyIENyZWF0ZUF0dHJpYnV0ZXMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCBYbWxXcml0ZXIgUmVwbGFjZVJhbmdlKFhQYXRoTmF2aWdhdG9yIGxhc3RTaWJsaW5nVG9SZXBsYWNlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIFJlcGxhY2VTZWxmKHN0cmluZyBuZXdOb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxSZWFkZXIgcmVhZGVyID0gQ3JlYXRlQ29udGV4dFJlYWRlcihuZXdOb2RlLCBmYWxzZSk7DQogICAgICAgICAgICBSZXBsYWNlU2VsZihyZWFkZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBSZXBsYWNlU2VsZihYbWxSZWFkZXIgbmV3Tm9kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG5ld05vZGUgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihuZXdOb2RlKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBYUGF0aE5vZGVUeXBlIHR5cGUgPSBOb2RlVHlwZTsNCiAgICAgICAgICAgIGlmICh0eXBlID09IFhQYXRoTm9kZVR5cGUuUm9vdA0KICAgICAgICAgICAgICAgIHx8IHR5cGUgPT0gWFBhdGhOb2RlVHlwZS5BdHRyaWJ1dGUNCiAgICAgICAgICAgICAgICB8fCB0eXBlID09IFhQYXRoTm9kZVR5cGUuTmFtZXNwYWNlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLlhwbl9CYWRQb3NpdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBYbWxXcml0ZXIgd3JpdGVyID0gUmVwbGFjZVJhbmdlKHRoaXMpOw0KICAgICAgICAgICAgQnVpbGRTdWJ0cmVlKG5ld05vZGUsIHdyaXRlcik7DQogICAgICAgICAgICB3cml0ZXIuQ2xvc2UoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgUmVwbGFjZVNlbGYoWFBhdGhOYXZpZ2F0b3IgbmV3Tm9kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG5ld05vZGUgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihuZXdOb2RlKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBYbWxSZWFkZXIgcmVhZGVyID0gbmV3Tm9kZS5DcmVhdGVSZWFkZXIoKTsNCiAgICAgICAgICAgIFJlcGxhY2VTZWxmKHJlYWRlcik7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSBtYXJrdXAgcmVwcmVzZW50aW5nIHRoZSBjdXJyZW50IG5vZGUgYW5kIGFsbCBvZiBpdHMgY2hpbGRyZW4uDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHN0cmluZyBPdXRlclhtbA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTdHJpbmdXcml0ZXIgc3RyaW5nV3JpdGVyOw0KICAgICAgICAgICAgICAgIFhtbFdyaXRlclNldHRpbmdzIHdyaXRlclNldHRpbmdzOw0KICAgICAgICAgICAgICAgIFhtbFdyaXRlciB4bWxXcml0ZXI7DQoNCiAgICAgICAgICAgICAgICAvLyBBdHRyaWJ1dGVzIGFuZCBuYW1lc3BhY2VzIGFyZSBub3QgYWxsb3dlZCBhdCB0aGUgdG9wLWxldmVsIGJ5IHRoZSB3ZWxsLWZvcm1lZCB3cml0ZXINCiAgICAgICAgICAgICAgICBpZiAoTm9kZVR5cGUgPT0gWFBhdGhOb2RlVHlwZS5BdHRyaWJ1dGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkNvbmNhdChOYW1lLCAiPVwiIiwgVmFsdWUsICJcIiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChOb2RlVHlwZSA9PSBYUGF0aE5vZGVUeXBlLk5hbWVzcGFjZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChMb2NhbE5hbWUuTGVuZ3RoID09IDApDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkNvbmNhdCgieG1sbnM9XCIiLCBWYWx1ZSwgIlwiIik7DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmcuQ29uY2F0KCJ4bWxuczoiLCBMb2NhbE5hbWUsICI9XCIiLCBWYWx1ZSwgIlwiIik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgc3RyaW5nV3JpdGVyID0gbmV3IFN0cmluZ1dyaXRlcihDdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlKTsNCg0KICAgICAgICAgICAgICAgIHdyaXRlclNldHRpbmdzID0gbmV3IFhtbFdyaXRlclNldHRpbmdzKCk7DQogICAgICAgICAgICAgICAgd3JpdGVyU2V0dGluZ3MuSW5kZW50ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB3cml0ZXJTZXR0aW5ncy5PbWl0WG1sRGVjbGFyYXRpb24gPSB0cnVlOw0KICAgICAgICAgICAgICAgIHdyaXRlclNldHRpbmdzLkNvbmZvcm1hbmNlTGV2ZWwgPSBDb25mb3JtYW5jZUxldmVsLkF1dG87DQoNCiAgICAgICAgICAgICAgICB4bWxXcml0ZXIgPSBYbWxXcml0ZXIuQ3JlYXRlKHN0cmluZ1dyaXRlciwgd3JpdGVyU2V0dGluZ3MpOw0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeG1sV3JpdGVyLldyaXRlTm9kZSh0aGlzLCB0cnVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeG1sV3JpdGVyLkNsb3NlKCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZ1dyaXRlci5Ub1N0cmluZygpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBSZXBsYWNlU2VsZih2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSBtYXJrdXAgcmVwcmVzZW50aW5nIGp1c3QgdGhlIGNoaWxkcmVuIG9mIHRoZSBjdXJyZW50IG5vZGUuDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHN0cmluZyBJbm5lclhtbA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKE5vZGVUeXBlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLlJvb3Q6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5FbGVtZW50Og0KICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nV3JpdGVyIHN0cmluZ1dyaXRlcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFdyaXRlclNldHRpbmdzIHdyaXRlclNldHRpbmdzOw0KICAgICAgICAgICAgICAgICAgICAgICAgWG1sV3JpdGVyIHhtbFdyaXRlcjsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nV3JpdGVyID0gbmV3IFN0cmluZ1dyaXRlcihDdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyU2V0dGluZ3MgPSBuZXcgWG1sV3JpdGVyU2V0dGluZ3MoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlclNldHRpbmdzLkluZGVudCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXJTZXR0aW5ncy5PbWl0WG1sRGVjbGFyYXRpb24gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyU2V0dGluZ3MuQ29uZm9ybWFuY2VMZXZlbCA9IENvbmZvcm1hbmNlTGV2ZWwuQXV0bzsNCiAgICAgICAgICAgICAgICAgICAgICAgIHhtbFdyaXRlciA9IFhtbFdyaXRlci5DcmVhdGUoc3RyaW5nV3JpdGVyLCB3cml0ZXJTZXR0aW5ncyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNb3ZlVG9GaXJzdENoaWxkKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4bWxXcml0ZXIuV3JpdGVOb2RlKHRoaXMsIHRydWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChNb3ZlVG9OZXh0KCkpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgcG9zaXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW92ZVRvUGFyZW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhtbFdyaXRlci5DbG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZ1dyaXRlci5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuQXR0cmlidXRlOg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuTmFtZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHNldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2YodmFsdWUpKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKE5vZGVUeXBlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLlJvb3Q6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5FbGVtZW50Og0KICAgICAgICAgICAgICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgZWRpdCA9IENyZWF0ZU5hdmlnYXRvcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGVkaXQuTW92ZVRvRmlyc3RDaGlsZCgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXQuRGVsZXRlU2VsZigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLkxlbmd0aCAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXQuQXBwZW5kQ2hpbGQodmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5BdHRyaWJ1dGU6DQogICAgICAgICAgICAgICAgICAgICAgICBTZXRWYWx1ZSh2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKFNSLlhwbl9CYWRQb3NpdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBBcHBlbmRDaGlsZChzdHJpbmcgbmV3Q2hpbGQpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFJlYWRlciByZWFkZXIgPSBDcmVhdGVDb250ZXh0UmVhZGVyKG5ld0NoaWxkLCB0cnVlKTsNCiAgICAgICAgICAgIEFwcGVuZENoaWxkKHJlYWRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEFwcGVuZENoaWxkKFhtbFJlYWRlciBuZXdDaGlsZCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG5ld0NoaWxkID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2YobmV3Q2hpbGQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFhtbFdyaXRlciB3cml0ZXIgPSBBcHBlbmRDaGlsZCgpOw0KICAgICAgICAgICAgQnVpbGRTdWJ0cmVlKG5ld0NoaWxkLCB3cml0ZXIpOw0KICAgICAgICAgICAgd3JpdGVyLkNsb3NlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEFwcGVuZENoaWxkKFhQYXRoTmF2aWdhdG9yIG5ld0NoaWxkKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAobmV3Q2hpbGQgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihuZXdDaGlsZCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFJc1ZhbGlkQ2hpbGRUeXBlKG5ld0NoaWxkLk5vZGVUeXBlKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YcG5fQmFkUG9zaXRpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IG5ld0NoaWxkLkNyZWF0ZVJlYWRlcigpOw0KICAgICAgICAgICAgQXBwZW5kQ2hpbGQocmVhZGVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgUHJlcGVuZENoaWxkKHN0cmluZyBuZXdDaGlsZCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IENyZWF0ZUNvbnRleHRSZWFkZXIobmV3Q2hpbGQsIHRydWUpOw0KICAgICAgICAgICAgUHJlcGVuZENoaWxkKHJlYWRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIFByZXBlbmRDaGlsZChYbWxSZWFkZXIgbmV3Q2hpbGQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZCA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24obmFtZW9mKG5ld0NoaWxkKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBYbWxXcml0ZXIgd3JpdGVyID0gUHJlcGVuZENoaWxkKCk7DQogICAgICAgICAgICBCdWlsZFN1YnRyZWUobmV3Q2hpbGQsIHdyaXRlcik7DQogICAgICAgICAgICB3cml0ZXIuQ2xvc2UoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgUHJlcGVuZENoaWxkKFhQYXRoTmF2aWdhdG9yIG5ld0NoaWxkKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAobmV3Q2hpbGQgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihuZXdDaGlsZCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFJc1ZhbGlkQ2hpbGRUeXBlKG5ld0NoaWxkLk5vZGVUeXBlKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YcG5fQmFkUG9zaXRpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IG5ld0NoaWxkLkNyZWF0ZVJlYWRlcigpOw0KICAgICAgICAgICAgUHJlcGVuZENoaWxkKHJlYWRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEluc2VydEJlZm9yZShzdHJpbmcgbmV3U2libGluZykNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IENyZWF0ZUNvbnRleHRSZWFkZXIobmV3U2libGluZywgZmFsc2UpOw0KICAgICAgICAgICAgSW5zZXJ0QmVmb3JlKHJlYWRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEluc2VydEJlZm9yZShYbWxSZWFkZXIgbmV3U2libGluZykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG5ld1NpYmxpbmcgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihuZXdTaWJsaW5nKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBYbWxXcml0ZXIgd3JpdGVyID0gSW5zZXJ0QmVmb3JlKCk7DQogICAgICAgICAgICBCdWlsZFN1YnRyZWUobmV3U2libGluZywgd3JpdGVyKTsNCiAgICAgICAgICAgIHdyaXRlci5DbG9zZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBJbnNlcnRCZWZvcmUoWFBhdGhOYXZpZ2F0b3IgbmV3U2libGluZykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG5ld1NpYmxpbmcgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihuZXdTaWJsaW5nKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIUlzVmFsaWRTaWJsaW5nVHlwZShuZXdTaWJsaW5nLk5vZGVUeXBlKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YcG5fQmFkUG9zaXRpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IG5ld1NpYmxpbmcuQ3JlYXRlUmVhZGVyKCk7DQogICAgICAgICAgICBJbnNlcnRCZWZvcmUocmVhZGVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgSW5zZXJ0QWZ0ZXIoc3RyaW5nIG5ld1NpYmxpbmcpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFJlYWRlciByZWFkZXIgPSBDcmVhdGVDb250ZXh0UmVhZGVyKG5ld1NpYmxpbmcsIGZhbHNlKTsNCiAgICAgICAgICAgIEluc2VydEFmdGVyKHJlYWRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEluc2VydEFmdGVyKFhtbFJlYWRlciBuZXdTaWJsaW5nKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAobmV3U2libGluZyA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24obmFtZW9mKG5ld1NpYmxpbmcpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFhtbFdyaXRlciB3cml0ZXIgPSBJbnNlcnRBZnRlcigpOw0KICAgICAgICAgICAgQnVpbGRTdWJ0cmVlKG5ld1NpYmxpbmcsIHdyaXRlcik7DQogICAgICAgICAgICB3cml0ZXIuQ2xvc2UoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgSW5zZXJ0QWZ0ZXIoWFBhdGhOYXZpZ2F0b3IgbmV3U2libGluZykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG5ld1NpYmxpbmcgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKG5hbWVvZihuZXdTaWJsaW5nKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIUlzVmFsaWRTaWJsaW5nVHlwZShuZXdTaWJsaW5nLk5vZGVUeXBlKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihTUi5YcG5fQmFkUG9zaXRpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IG5ld1NpYmxpbmcuQ3JlYXRlUmVhZGVyKCk7DQogICAgICAgICAgICBJbnNlcnRBZnRlcihyZWFkZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBEZWxldGVSYW5nZShYUGF0aE5hdmlnYXRvciBsYXN0U2libGluZ1RvRGVsZXRlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIERlbGV0ZVNlbGYoKQ0KICAgICAgICB7DQogICAgICAgICAgICBEZWxldGVSYW5nZSh0aGlzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgUHJlcGVuZENoaWxkRWxlbWVudChzdHJpbmcgcHJlZml4LCBzdHJpbmcgbG9jYWxOYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJLCBzdHJpbmcgdmFsdWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFdyaXRlciB3cml0ZXIgPSBQcmVwZW5kQ2hpbGQoKTsNCiAgICAgICAgICAgIHdyaXRlci5Xcml0ZVN0YXJ0RWxlbWVudChwcmVmaXgsIGxvY2FsTmFtZSwgbmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZVN0cmluZyh2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB3cml0ZXIuV3JpdGVFbmRFbGVtZW50KCk7DQogICAgICAgICAgICB3cml0ZXIuQ2xvc2UoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgQXBwZW5kQ2hpbGRFbGVtZW50KHN0cmluZyBwcmVmaXgsIHN0cmluZyBsb2NhbE5hbWUsIHN0cmluZyBuYW1lc3BhY2VVUkksIHN0cmluZyB2YWx1ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sV3JpdGVyIHdyaXRlciA9IEFwcGVuZENoaWxkKCk7DQogICAgICAgICAgICB3cml0ZXIuV3JpdGVTdGFydEVsZW1lbnQocHJlZml4LCBsb2NhbE5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVTdHJpbmcodmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgd3JpdGVyLldyaXRlRW5kRWxlbWVudCgpOw0KICAgICAgICAgICAgd3JpdGVyLkNsb3NlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEluc2VydEVsZW1lbnRCZWZvcmUoc3RyaW5nIHByZWZpeCwgc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSwgc3RyaW5nIHZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxXcml0ZXIgd3JpdGVyID0gSW5zZXJ0QmVmb3JlKCk7DQogICAgICAgICAgICB3cml0ZXIuV3JpdGVTdGFydEVsZW1lbnQocHJlZml4LCBsb2NhbE5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVTdHJpbmcodmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgd3JpdGVyLldyaXRlRW5kRWxlbWVudCgpOw0KICAgICAgICAgICAgd3JpdGVyLkNsb3NlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEluc2VydEVsZW1lbnRBZnRlcihzdHJpbmcgcHJlZml4LCBzdHJpbmcgbG9jYWxOYW1lLCBzdHJpbmcgbmFtZXNwYWNlVVJJLCBzdHJpbmcgdmFsdWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFdyaXRlciB3cml0ZXIgPSBJbnNlcnRBZnRlcigpOw0KICAgICAgICAgICAgd3JpdGVyLldyaXRlU3RhcnRFbGVtZW50KHByZWZpeCwgbG9jYWxOYW1lLCBuYW1lc3BhY2VVUkkpOw0KICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlU3RyaW5nKHZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHdyaXRlci5Xcml0ZUVuZEVsZW1lbnQoKTsNCiAgICAgICAgICAgIHdyaXRlci5DbG9zZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBDcmVhdGVBdHRyaWJ1dGUoc3RyaW5nIHByZWZpeCwgc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSwgc3RyaW5nIHZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxXcml0ZXIgd3JpdGVyID0gQ3JlYXRlQXR0cmlidXRlcygpOw0KICAgICAgICAgICAgd3JpdGVyLldyaXRlU3RhcnRBdHRyaWJ1dGUocHJlZml4LCBsb2NhbE5hbWUsIG5hbWVzcGFjZVVSSSk7DQogICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVTdHJpbmcodmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgd3JpdGVyLldyaXRlRW5kQXR0cmlidXRlKCk7DQogICAgICAgICAgICB3cml0ZXIuQ2xvc2UoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gSW50ZXJuYWwNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgTW92ZVRvUHJldmlvdXMoc3RyaW5nIGxvY2FsTmFtZSwgc3RyaW5nIG5hbWVzcGFjZVVSSSkNCiAgICAgICAgew0KICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgbmF2Q2xvbmUgPSBDbG9uZSgpOw0KDQogICAgICAgICAgICBsb2NhbE5hbWUgPSAobG9jYWxOYW1lICE9IG51bGwpID8gTmFtZVRhYmxlLkdldChsb2NhbE5hbWUpIDogbnVsbDsNCiAgICAgICAgICAgIHdoaWxlIChNb3ZlVG9QcmV2aW91cygpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChOb2RlVHlwZSA9PSBYUGF0aE5vZGVUeXBlLkVsZW1lbnQgJiYgKG9iamVjdClsb2NhbE5hbWUgPT0gKG9iamVjdClMb2NhbE5hbWUgJiYgbmFtZXNwYWNlVVJJID09IE5hbWVzcGFjZVVSSSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIE1vdmVUbyhuYXZDbG9uZSk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBib29sIE1vdmVUb1ByZXZpb3VzKFhQYXRoTm9kZVR5cGUgdHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgbmF2Q2xvbmUgPSBDbG9uZSgpOw0KICAgICAgICAgICAgaW50IG1hc2sgPSBHZXRDb250ZW50S2luZE1hc2sodHlwZSk7DQoNCiAgICAgICAgICAgIHdoaWxlIChNb3ZlVG9QcmV2aW91cygpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICgoKDEgPDwgKGludClOb2RlVHlwZSkgJiBtYXNrKSAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgTW92ZVRvKG5hdkNsb25lKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGJvb2wgTW92ZVRvTm9uRGVzY2VuZGFudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIElmIGN1cnJlbnQgbm9kZSBpcyBkb2N1bWVudCwgdGhlcmUgaXMgbm8gbmV4dCBub24tZGVzY2VuZGFudA0KICAgICAgICAgICAgaWYgKE5vZGVUeXBlID09IFhQYXRoTm9kZVR5cGUuUm9vdCkNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgICAgIC8vIElmIHNpYmxpbmcgZXhpc3RzLCBpdCBpcyB0aGUgbmV4dCBub24tZGVzY2VuZGFudA0KICAgICAgICAgICAgaWYgKE1vdmVUb05leHQoKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgLy8gVGhlIGN1cnJlbnQgbm9kZSBpcyBlaXRoZXIgYW4gYXR0cmlidXRlLCBuYW1lc3BhY2UsIG9yIGxhc3QgY2hpbGQgbm9kZQ0KICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgbmF2U2F2ZSA9IENsb25lKCk7DQoNCiAgICAgICAgICAgIGlmICghTW92ZVRvUGFyZW50KCkpDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICBzd2l0Y2ggKG5hdlNhdmUuTm9kZVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLkF0dHJpYnV0ZToNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuTmFtZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICAvLyBOZXh0IG5vZGUgaW4gZG9jdW1lbnQgb3JkZXIgaXMgZmlyc3QgY29udGVudC1jaGlsZCBvZiBwYXJlbnQNCiAgICAgICAgICAgICAgICAgICAgaWYgKE1vdmVUb0ZpcnN0Q2hpbGQoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2hpbGUgKCFNb3ZlVG9OZXh0KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFNb3ZlVG9QYXJlbnQoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgb3JpZ2luYWwgcG9zaXRpb24gYW5kIHJldHVybiBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICBNb3ZlVG8obmF2U2F2ZSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIDxzdW1tYXJ5Pg0KICAgICAgICAvLy8gUmV0dXJucyBvcmRpbmFsIG51bWJlciBvZiBhdHRyaWJ1dGUsIG5hbWVzcGFjZSBvciBjaGlsZCBub2RlIHdpdGhpbiBpdHMgcGFyZW50Lg0KICAgICAgICAvLy8gT3JkZXIgaXMgcmV2ZXJzZWQgZm9yIGF0dHJpYnV0ZXMgYW5kIGNoaWxkIG5vZGVzIHRvIGF2b2lkIE8oTioqMikgcnVubmluZyB0aW1lLg0KICAgICAgICAvLy8gVGhpcyBwcm9wZXJ0eSBpcyB1c2VmdWwgZm9yIGRlYnVnZ2luZywgYW5kIGFsc28gdXNlZCBpbiBVbmlxdWVJZCBpbXBsZW1lbnRhdGlvbi4NCiAgICAgICAgLy8vIDwvc3VtbWFyeT4NCiAgICAgICAgaW50ZXJuYWwgdWludCBJbmRleEluUGFyZW50DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIG5hdiA9IHRoaXMuQ2xvbmUoKTsNCiAgICAgICAgICAgICAgICB1aW50IGlkeCA9IDA7DQoNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKE5vZGVUeXBlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLkF0dHJpYnV0ZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChuYXYuTW92ZVRvTmV4dEF0dHJpYnV0ZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5OYW1lc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobmF2Lk1vdmVUb05leHROYW1lc3BhY2UoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHgrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5hdi5Nb3ZlVG9OZXh0KCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4Kys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGlkeDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyByZWFkb25seSBjaGFyW10gTm9kZVR5cGVMZXR0ZXIgPSBuZXcgY2hhcltdIHsNCiAgICAgICAgICAgICdSJywgICAgLy8gUm9vdA0KICAgICAgICAgICAgJ0UnLCAgICAvLyBFbGVtZW50DQogICAgICAgICAgICAnQScsICAgIC8vIEF0dHJpYnV0ZQ0KICAgICAgICAgICAgJ04nLCAgICAvLyBOYW1lc3BhY2UNCiAgICAgICAgICAgICdUJywgICAgLy8gVGV4dA0KICAgICAgICAgICAgJ1MnLCAgICAvLyBTaWduaWZpY2FudFdoaXRlc3BhY2UNCiAgICAgICAgICAgICdXJywgICAgLy8gV2hpdGVzcGFjZQ0KICAgICAgICAgICAgJ1AnLCAgICAvLyBQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24NCiAgICAgICAgICAgICdDJywgICAgLy8gQ29tbWVudA0KICAgICAgICAgICAgJ1gnLCAgICAvLyBBbGwNCiAgICAgICAgfTsNCg0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgcmVhZG9ubHkgY2hhcltdIFVuaXF1ZUlkVGJsID0gbmV3IGNoYXJbXSB7DQogICAgICAgICAgICAnQScsICAnQicsICAnQycsICAnRCcsICAnRScsICAnRicsICAnRycsICAnSCcsICAnSScsICAnSicsDQogICAgICAgICAgICAnSycsICAnTCcsICAnTScsICAnTicsICAnTycsICAnUCcsICAnUScsICAnUicsICAnUycsICAnVCcsDQogICAgICAgICAgICAnVScsICAnVicsICAnVycsICAnWCcsICAnWScsICAnWicsICAnMScsICAnMicsICAnMycsICAnNCcsDQogICAgICAgICAgICAnNScsICAnNicNCiAgICAgICAgfTsNCg0KICAgICAgICAvLyBSZXF1aXJlbWVudHMgZm9yIGlkOg0KICAgICAgICAvLyAgMS4gbXVzdCBjb25zaXN0IG9mIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzIG9ubHkNCiAgICAgICAgLy8gIDIuIG11c3QgYmVnaW4gd2l0aCBhbiBhbHBoYWJldGljIGNoYXJhY3Rlcg0KICAgICAgICAvLyAgMy4gc2FtZSBpZCBpcyBnZW5lcmF0ZWQgZm9yIHRoZSBzYW1lIG5vZGUNCiAgICAgICAgLy8gIDQuIGlkcyBhcmUgdW5pcXVlDQogICAgICAgIC8vDQogICAgICAgIC8vICBpZCA9IG5vZGUgdHlwZSBsZXR0ZXIgKyByZXZlcnNlIHBhdGggdG8gcm9vdCBpbiB0ZXJtcyBvZiBlbmNvZGVkIEluZGV4SW5QYXJlbnQgaW50ZWdlcnMgZnJvbSBub2RlIHRvIHJvb3Qgc2VwYXJhdGVkIGJ5IDAncyBpZiBuZWVkZWQNCiAgICAgICAgaW50ZXJuYWwgdmlydHVhbCBzdHJpbmcgVW5pcXVlSWQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgbmF2ID0gdGhpcy5DbG9uZSgpOw0KICAgICAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOw0KDQogICAgICAgICAgICAgICAgLy8gRW5zdXJlIGRpc3Rpbmd1aXNoaW5nIGF0dHJpYnV0ZXMsIG5hbWVzcGFjZXMgYW5kIGNoaWxkIG5vZGVzDQogICAgICAgICAgICAgICAgc2IuQXBwZW5kKE5vZGVUeXBlTGV0dGVyWyhpbnQpTm9kZVR5cGVdKTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdWludCBpZHggPSBuYXYuSW5kZXhJblBhcmVudDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFuYXYuTW92ZVRvUGFyZW50KCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChpZHggPD0gMHgxZikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKFVuaXF1ZUlkVGJsW2lkeF0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCcwJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZChVbmlxdWVJZFRibFtpZHggJiAweDFmXSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID4+PSA1Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoaWR4ICE9IDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCcwJyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHNiLlRvU3RyaW5nKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBYUGF0aEV4cHJlc3Npb24gQ29tcGlsZU1hdGNoUGF0dGVybihzdHJpbmcgeHBhdGgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJvb2wgaGFzUHJlZml4Ow0KICAgICAgICAgICAgUXVlcnkgcXVlcnkgPSBuZXcgUXVlcnlCdWlsZGVyKCkuQnVpbGRQYXR0ZXJuUXVlcnkoeHBhdGgsIG91dCBoYXNQcmVmaXgpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDb21waWxlZFhwYXRoRXhwcihxdWVyeSwgeHBhdGgsIGhhc1ByZWZpeCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBpbnQgR2V0RGVwdGgoWFBhdGhOYXZpZ2F0b3IgbmF2KQ0KICAgICAgICB7DQogICAgICAgICAgICBpbnQgZGVwdGggPSAwOw0KICAgICAgICAgICAgd2hpbGUgKG5hdi5Nb3ZlVG9QYXJlbnQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBkZXB0aCsrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGRlcHRoOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gWFBhdGggYmFzZWQgY29tcGFyaXNvbiBmb3IgbmFtZXNwYWNlcywgYXR0cmlidXRlcyBhbmQgb3RoZXIgDQogICAgICAgIC8vIGl0ZW1zIHdpdGggdGhlIHNhbWUgcGFyZW50IGVsZW1lbnQuDQogICAgICAgIC8vDQogICAgICAgIC8vICAgICAgICAgICAgICAgICBuMg0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgbmFtZXNwYWNlKDApICAgIGF0dHJpYnV0ZSgtMSkgICBvdGhlcigtMikNCiAgICAgICAgLy8gbjENCiAgICAgICAgLy8gbmFtZXNwYWNlKDApICAgID8oMCkgICAgICAgICAgICBiZWZvcmUoLTEpICAgICAgYmVmb3JlKC0yKQ0KICAgICAgICAvLyBhdHRyaWJ1dGUoMSkgICAgYWZ0ZXIoMSkgICAgICAgID8oMCkgICAgICAgICAgICBiZWZvcmUoLTEpDQogICAgICAgIC8vIG90aGVyICAgICgyKSAgICBhZnRlcigyKSAgICAgICAgYWZ0ZXIoMSkgICAgICAgID8oMCkNCiAgICAgICAgcHJpdmF0ZSBYbWxOb2RlT3JkZXIgQ29tcGFyZVNpYmxpbmdzKFhQYXRoTmF2aWdhdG9yIG4xLCBYUGF0aE5hdmlnYXRvciBuMikNCiAgICAgICAgew0KICAgICAgICAgICAgaW50IGNtcCA9IDA7DQoNCiNpZiBERUJVRw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KCFuMS5Jc1NhbWVQb3NpdGlvbihuMikpOw0KICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgcDEgPSBuMS5DbG9uZSgpLCBwMiA9IG4yLkNsb25lKCk7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQocDEuTW92ZVRvUGFyZW50KCkgJiYgcDIuTW92ZVRvUGFyZW50KCkgJiYgcDEuSXNTYW1lUG9zaXRpb24ocDIpKTsNCiNlbmRpZg0KICAgICAgICAgICAgc3dpdGNoIChuMS5Ob2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuTmFtZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuQXR0cmlidXRlOg0KICAgICAgICAgICAgICAgICAgICBjbXAgKz0gMTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgY21wICs9IDI7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3dpdGNoIChuMi5Ob2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuTmFtZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICBpZiAoY21wID09IDApDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChuMS5Nb3ZlVG9OZXh0TmFtZXNwYWNlKCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4xLklzU2FtZVBvc2l0aW9uKG4yKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBYbWxOb2RlT3JkZXIuQmVmb3JlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuQXR0cmlidXRlOg0KICAgICAgICAgICAgICAgICAgICBjbXAgLT0gMTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNtcCA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobjEuTW92ZVRvTmV4dEF0dHJpYnV0ZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuMS5Jc1NhbWVQb3NpdGlvbihuMikpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWG1sTm9kZU9yZGVyLkJlZm9yZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgY21wIC09IDI7DQogICAgICAgICAgICAgICAgICAgIGlmIChjbXAgPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG4xLk1vdmVUb05leHQoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobjEuSXNTYW1lUG9zaXRpb24objIpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFhtbE5vZGVPcmRlci5CZWZvcmU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNtcCA8IDAgPyBYbWxOb2RlT3JkZXIuQmVmb3JlIDogWG1sTm9kZU9yZGVyLkFmdGVyOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgc3RhdGljIFhtbE5hbWVzcGFjZU1hbmFnZXIgR2V0TmFtZXNwYWNlcyhJWG1sTmFtZXNwYWNlUmVzb2x2ZXIgcmVzb2x2ZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbE5hbWVzcGFjZU1hbmFnZXIgbW5nciA9IG5ldyBYbWxOYW1lc3BhY2VNYW5hZ2VyKG5ldyBOYW1lVGFibGUoKSk7DQogICAgICAgICAgICBJRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gZGljdGlvbmFyeSA9IHJlc29sdmVyLkdldE5hbWVzcGFjZXNJblNjb3BlKFhtbE5hbWVzcGFjZVNjb3BlLkFsbCk7DQogICAgICAgICAgICBmb3JlYWNoIChLZXlWYWx1ZVBhaXI8c3RyaW5nLCBzdHJpbmc+IHBhaXIgaW4gZGljdGlvbmFyeSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyJ4bWxucyAiIGlzIGFsd2F5cyBpbiB0aGUgbmFtZXNwYWNlIG1hbmFnZXIgc28gYWRkaW5nIGl0IHdvdWxkIHRocm93IGFuIGV4Y2VwdGlvbg0KICAgICAgICAgICAgICAgIGlmIChwYWlyLktleSAhPSAieG1sbnMiKQ0KICAgICAgICAgICAgICAgICAgICBtbmdyLkFkZE5hbWVzcGFjZShwYWlyLktleSwgcGFpci5WYWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbW5ncjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEdldCBtYXNrIHRoYXQgd2lsbCBhbGxvdyBYUGF0aE5vZGVUeXBlIGNvbnRlbnQgbWF0Y2hpbmcgdG8gYmUgcGVyZm9ybWVkIHVzaW5nIG9ubHkgYSBzaGlmdCBhbmQgYW4gYW5kIG9wZXJhdGlvbg0KICAgICAgICBpbnRlcm5hbCBjb25zdCBpbnQgQWxsTWFzayA9IDB4N0ZGRkZGRkY7DQogICAgICAgIGludGVybmFsIGNvbnN0IGludCBOb0F0dHJObXNwTWFzayA9IEFsbE1hc2sgJiB+KDEgPDwgKGludClYUGF0aE5vZGVUeXBlLkF0dHJpYnV0ZSkgJiB+KDEgPDwgKGludClYUGF0aE5vZGVUeXBlLk5hbWVzcGFjZSk7DQogICAgICAgIGludGVybmFsIGNvbnN0IGludCBUZXh0TWFzayA9ICgxIDw8IChpbnQpWFBhdGhOb2RlVHlwZS5UZXh0KSB8ICgxIDw8IChpbnQpWFBhdGhOb2RlVHlwZS5TaWduaWZpY2FudFdoaXRlc3BhY2UpIHwgKDEgPDwgKGludClYUGF0aE5vZGVUeXBlLldoaXRlc3BhY2UpOw0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgcmVhZG9ubHkgaW50W10gQ29udGVudEtpbmRNYXNrcyA9IHsNCiAgICAgICAgICAgICgxIDw8IChpbnQpIFhQYXRoTm9kZVR5cGUuUm9vdCksICAgICAgICAgICAgICAgICAgICAgICAgLy8gUm9vdA0KICAgICAgICAgICAgKDEgPDwgKGludCkgWFBhdGhOb2RlVHlwZS5FbGVtZW50KSwgICAgICAgICAgICAgICAgICAgICAvLyBFbGVtZW50DQogICAgICAgICAgICAwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF0dHJpYnV0ZSAobm90IGNvbnRlbnQpDQogICAgICAgICAgICAwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5hbWVzcGFjZSAobm90IGNvbnRlbnQpDQogICAgICAgICAgICBUZXh0TWFzaywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRleHQNCiAgICAgICAgICAgICgxIDw8IChpbnQpIFhQYXRoTm9kZVR5cGUuU2lnbmlmaWNhbnRXaGl0ZXNwYWNlKSwgICAgICAgLy8gU2lnbmlmaWNhbnRXaGl0ZXNwYWNlDQogICAgICAgICAgICAoMSA8PCAoaW50KSBYUGF0aE5vZGVUeXBlLldoaXRlc3BhY2UpLCAgICAgICAgICAgICAgICAgIC8vIFdoaXRlc3BhY2UNCiAgICAgICAgICAgICgxIDw8IChpbnQpIFhQYXRoTm9kZVR5cGUuUHJvY2Vzc2luZ0luc3RydWN0aW9uKSwgICAgICAgLy8gUHJvY2Vzc2luZ0luc3RydWN0aW9uDQogICAgICAgICAgICAoMSA8PCAoaW50KSBYUGF0aE5vZGVUeXBlLkNvbW1lbnQpLCAgICAgICAgICAgICAgICAgICAgIC8vIENvbW1lbnQNCiAgICAgICAgICAgIE5vQXR0ck5tc3BNYXNrLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWxsDQogICAgICAgIH07DQoNCiAgICAgICAgaW50ZXJuYWwgc3RhdGljIGludCBHZXRDb250ZW50S2luZE1hc2soWFBhdGhOb2RlVHlwZSB0eXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gQ29udGVudEtpbmRNYXNrc1soaW50KXR5cGVdOw0KICAgICAgICB9DQoNCiAgICAgICAgaW50ZXJuYWwgc3RhdGljIGludCBHZXRLaW5kTWFzayhYUGF0aE5vZGVUeXBlIHR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh0eXBlID09IFhQYXRoTm9kZVR5cGUuQWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybiBBbGxNYXNrOw0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PSBYUGF0aE5vZGVUeXBlLlRleHQpDQogICAgICAgICAgICAgICAgcmV0dXJuIFRleHRNYXNrOw0KDQogICAgICAgICAgICByZXR1cm4gKDEgPDwgKGludCl0eXBlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIHN0YXRpYyBib29sIElzVGV4dChYUGF0aE5vZGVUeXBlIHR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vcmV0dXJuICgoMSA8PCAoaW50KSB0eXBlKSAmIFRleHRNYXNrKSAhPSAwOw0KICAgICAgICAgICAgcmV0dXJuIHVuY2hlY2tlZCgodWludCkodHlwZSAtIFhQYXRoTm9kZVR5cGUuVGV4dCkpIDw9IChYUGF0aE5vZGVUeXBlLldoaXRlc3BhY2UgLSBYUGF0aE5vZGVUeXBlLlRleHQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTGF4IGNoZWNrIGZvciBwb3RlbnRpYWwgY2hpbGQgaXRlbS4NCiAgICAgICAgcHJpdmF0ZSBib29sIElzVmFsaWRDaGlsZFR5cGUoWFBhdGhOb2RlVHlwZSB0eXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzd2l0Y2ggKE5vZGVUeXBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5Sb290Og0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5FbGVtZW50Og0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5XaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLlByb2Nlc3NpbmdJbnN0cnVjdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5Db21tZW50Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5FbGVtZW50Og0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5FbGVtZW50Og0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLlRleHQ6DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuU2lnbmlmaWNhbnRXaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLldoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuUHJvY2Vzc2luZ0luc3RydWN0aW9uOg0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLkNvbW1lbnQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBMYXggY2hlY2sgZm9yIHBvdGVudGlhbCBzaWJsaW5nIGl0ZW0uIA0KICAgICAgICBwcml2YXRlIGJvb2wgSXNWYWxpZFNpYmxpbmdUeXBlKFhQYXRoTm9kZVR5cGUgdHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3dpdGNoIChOb2RlVHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuRWxlbWVudDoNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuVGV4dDoNCiAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuU2lnbmlmaWNhbnRXaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5XaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5Qcm9jZXNzaW5nSW5zdHJ1Y3Rpb246DQogICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLkNvbW1lbnQ6DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLkVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuVGV4dDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5TaWduaWZpY2FudFdoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuV2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5Qcm9jZXNzaW5nSW5zdHJ1Y3Rpb246DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuQ29tbWVudDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgWG1sUmVhZGVyIENyZWF0ZVJlYWRlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBYUGF0aE5hdmlnYXRvclJlYWRlci5DcmVhdGUodGhpcyk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFhtbFJlYWRlciBDcmVhdGVDb250ZXh0UmVhZGVyKHN0cmluZyB4bWwsIGJvb2wgZnJvbUN1cnJlbnROb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoeG1sID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbihuYW1lb2YoeG1sKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFdlIGhhdmUgdG8gc2V0IHRoZSBuYW1lc3BhY2UgY29udGV4dCBmb3IgdGhlIHJlYWRlci4NCiAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIGVkaXRvciA9IENyZWF0ZU5hdmlnYXRvcigpOw0KICAgICAgICAgICAgLy8gc2NvcGUgc3RhcnRzIGZyb20gcGFyZW50Lg0KICAgICAgICAgICAgWG1sTmFtZXNwYWNlTWFuYWdlciBtZ3IgPSBuZXcgWG1sTmFtZXNwYWNlTWFuYWdlcihOYW1lVGFibGUpOw0KICAgICAgICAgICAgaWYgKCFmcm9tQ3VycmVudE5vZGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZWRpdG9yLk1vdmVUb1BhcmVudCgpOyAvLyBzaG91bGQgYWx3YXlzIHN1Y2NlZWQuDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZWRpdG9yLk1vdmVUb0ZpcnN0TmFtZXNwYWNlKFhQYXRoTmFtZXNwYWNlU2NvcGUuQWxsKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBkbw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgbWdyLkFkZE5hbWVzcGFjZShlZGl0b3IuTG9jYWxOYW1lLCBlZGl0b3IuVmFsdWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB3aGlsZSAoZWRpdG9yLk1vdmVUb05leHROYW1lc3BhY2UoWFBhdGhOYW1lc3BhY2VTY29wZS5BbGwpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIEJVR0JVRzogSG93IGNhbiB3ZSBwcmVzZXJ2ZSB0aGUgd2hpdGVzcGFjZSBzZXR0aW5nDQogICAgICAgICAgICBYbWxQYXJzZXJDb250ZXh0IGNvbnRleHQgPSBuZXcgWG1sUGFyc2VyQ29udGV4dChOYW1lVGFibGUsIG1nciwgbnVsbCwgWG1sU3BhY2UuRGVmYXVsdCk7DQogICAgICAgICAgICBYbWxUZXh0UmVhZGVyIHJlYWRlciA9IG5ldyBYbWxUZXh0UmVhZGVyKHhtbCwgWG1sTm9kZVR5cGUuRWxlbWVudCwgY29udGV4dCk7DQogICAgICAgICAgICAvLyBCVUdCVUc6IFdoaXRlc3BhY2UgaGFuZGxpbmc/Pw0KICAgICAgICAgICAgcmVhZGVyLldoaXRlc3BhY2VIYW5kbGluZyA9IFdoaXRlc3BhY2VIYW5kbGluZy5TaWduaWZpY2FudDsNCiAgICAgICAgICAgIHJldHVybiByZWFkZXI7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCB2b2lkIEJ1aWxkU3VidHJlZShYbWxSZWFkZXIgcmVhZGVyLCBYbWxXcml0ZXIgd3JpdGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBpbXBvcnRhbnQgKHBlcmYpIHN0cmluZyBsaXRlcmFsLi4uDQogICAgICAgICAgICBzdHJpbmcgeG1sbnNVcmkgPSBYbWxSZXNlcnZlZE5zLk5zWG1sTnM7IC8vIGh0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvDQogICAgICAgICAgICBSZWFkU3RhdGUgcmVhZFN0YXRlID0gcmVhZGVyLlJlYWRTdGF0ZTsNCg0KICAgICAgICAgICAgaWYgKHJlYWRTdGF0ZSAhPSBSZWFkU3RhdGUuSW5pdGlhbA0KICAgICAgICAgICAgICAgICYmIHJlYWRTdGF0ZSAhPSBSZWFkU3RhdGUuSW50ZXJhY3RpdmUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uKFNSLlhtbF9JbnZhbGlkT3BlcmF0aW9uLCBuYW1lb2YocmVhZGVyKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpbnQgbGV2ZWwgPSAwOw0KICAgICAgICAgICAgaWYgKHJlYWRTdGF0ZSA9PSBSZWFkU3RhdGUuSW5pdGlhbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIXJlYWRlci5SZWFkKCkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICBsZXZlbCsrOyAvLyBpZiBzdGFydCBpbiBpbml0aWFsLCByZWFkIGV2ZXJ5dGhpbmcgKG5vdCBqdXN0IGZpcnN0KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZG8NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlYWRlci5Ob2RlVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRWxlbWVudDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZVN0YXJ0RWxlbWVudChyZWFkZXIuUHJlZml4LCByZWFkZXIuTG9jYWxOYW1lLCByZWFkZXIuTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgaXNFbXB0eUVsZW1lbnQgPSByZWFkZXIuSXNFbXB0eUVsZW1lbnQ7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWFkZXIuTW92ZVRvTmV4dEF0dHJpYnV0ZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgob2JqZWN0KXJlYWRlci5OYW1lc3BhY2VVUkkgPT0gKG9iamVjdCl4bWxuc1VyaSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIuUHJlZml4Lkxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IG5hbWVzcGFjZSBkZWNsYXJhdGlvbiAieG1sbnMiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQocmVhZGVyLkxvY2FsTmFtZSA9PSAieG1sbnMiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZUF0dHJpYnV0ZVN0cmluZygiIiwgInhtbG5zIiwgeG1sbnNVcmksIHJlYWRlci5WYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQocmVhZGVyLlByZWZpeCA9PSAieG1sbnMiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZUF0dHJpYnV0ZVN0cmluZygieG1sbnMiLCByZWFkZXIuTG9jYWxOYW1lLCB4bWxuc1VyaSwgcmVhZGVyLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVTdGFydEF0dHJpYnV0ZShyZWFkZXIuUHJlZml4LCByZWFkZXIuTG9jYWxOYW1lLCByZWFkZXIuTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlU3RyaW5nKHJlYWRlci5WYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZUVuZEF0dHJpYnV0ZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLk1vdmVUb0VsZW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0VtcHR5RWxlbWVudCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGVyZSBtaWdodCBzdGlsbCBiZSBhIHZhbHVlLCBpZiB0aGVyZSBpcyBhIGRlZmF1bHQgdmFsdWUgc3BlY2lmaWVkIGluIHRoZSBzY2hlbWENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVFbmRFbGVtZW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWwrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVuZEVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVGdWxsRW5kRWxlbWVudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy9zaG91bGQgbm90IHJlYWQgYmV5b25kIHRoZSBsZXZlbCBvZiB0aGUgcmVhZGVyJ3Mgb3JpZ2luYWwgcG9zaXRpb24uDQogICAgICAgICAgICAgICAgICAgICAgICBsZXZlbC0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuVGV4dDoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5DREFUQToNCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5Xcml0ZVN0cmluZyhyZWFkZXIuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuU2lnbmlmaWNhbnRXaGl0ZXNwYWNlOg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLldoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVTdHJpbmcocmVhZGVyLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNvbW1lbnQ6DQogICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVDb21tZW50KHJlYWRlci5WYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Qcm9jZXNzaW5nSW5zdHJ1Y3Rpb246DQogICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24ocmVhZGVyLkxvY2FsTmFtZSwgcmVhZGVyLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVudGl0eVJlZmVyZW5jZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5SZXNvbHZlRW50aXR5KCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5FbmRFbnRpdHk6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuTm9uZToNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Eb2N1bWVudFR5cGU6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuWG1sRGVjbGFyYXRpb246DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5BdHRyaWJ1dGU6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9iamVjdClyZWFkZXIuTmFtZXNwYWNlVVJJID09IChvYmplY3QpeG1sbnNVcmkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWRlci5QcmVmaXguTGVuZ3RoID09IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IG5hbWVzcGFjZSBkZWNsYXJhdGlvbiAieG1sbnMiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLkFzc2VydChyZWFkZXIuTG9jYWxOYW1lID09ICJ4bWxucyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVBdHRyaWJ1dGVTdHJpbmcoIiIsICJ4bWxucyIsIHhtbG5zVXJpLCByZWFkZXIuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQocmVhZGVyLlByZWZpeCA9PSAieG1sbnMiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlQXR0cmlidXRlU3RyaW5nKCJ4bWxucyIsIHJlYWRlci5Mb2NhbE5hbWUsIHhtbG5zVXJpLCByZWFkZXIuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVTdGFydEF0dHJpYnV0ZShyZWFkZXIuUHJlZml4LCByZWFkZXIuTG9jYWxOYW1lLCByZWFkZXIuTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVTdHJpbmcocmVhZGVyLlZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVFbmRBdHRyaWJ1dGUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHdoaWxlIChyZWFkZXIuUmVhZCgpICYmIChsZXZlbCA+IDApKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgb2JqZWN0IGRlYnVnZ2VyRGlzcGxheVByb3h5IHsgZ2V0IHsgcmV0dXJuIG5ldyBEZWJ1Z2dlckRpc3BsYXlQcm94eSh0aGlzKTsgfSB9DQoNCiAgICAgICAgW0RlYnVnZ2VyRGlzcGxheSgie1RvU3RyaW5nKCl9IildDQogICAgICAgIGludGVybmFsIHN0cnVjdCBEZWJ1Z2dlckRpc3BsYXlQcm94eQ0KICAgICAgICB7DQogICAgICAgICAgICBwcml2YXRlIFhQYXRoTmF2aWdhdG9yIF9uYXY7DQogICAgICAgICAgICBwdWJsaWMgRGVidWdnZXJEaXNwbGF5UHJveHkoWFBhdGhOYXZpZ2F0b3IgbmF2KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9uYXYgPSBuYXY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgc3RyaW5nIFRvU3RyaW5nKCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgcmVzdWx0ID0gX25hdi5Ob2RlVHlwZS5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgIHN3aXRjaCAoX25hdi5Ob2RlVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5FbGVtZW50Og0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICIsIE5hbWU9XCIiICsgX25hdi5OYW1lICsgJyInOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5BdHRyaWJ1dGU6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5OYW1lc3BhY2U6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5Qcm9jZXNzaW5nSW5zdHJ1Y3Rpb246DQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gIiwgTmFtZT1cIiIgKyBfbmF2Lk5hbWUgKyAnIic7DQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gIiwgVmFsdWU9XCIiICsgWG1sQ29udmVydC5Fc2NhcGVWYWx1ZUZvckRlYnVnZ2VyRGlzcGxheShfbmF2LlZhbHVlKSArICciJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFhQYXRoTm9kZVR5cGUuVGV4dDoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBYUGF0aE5vZGVUeXBlLldoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5TaWduaWZpY2FudFdoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgWFBhdGhOb2RlVHlwZS5Db21tZW50Og0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICIsIFZhbHVlPVwiIiArIFhtbENvbnZlcnQuRXNjYXBlVmFsdWVGb3JEZWJ1Z2dlckRpc3BsYXkoX25hdi5WYWx1ZSkgKyAnIic7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/XmlReader/Tests/BaseUriTests.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBYdW5pdDsNCg0KbmFtZXNwYWNlIFN5c3RlbS5YbWwuVGVzdHMNCnsNCiAgICBwdWJsaWMgY2xhc3MgQmFzZVVyaVRlc3RzIDogRmlsZUNsZWFudXBUZXN0QmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBzdHJpbmcgRHVtbXlYbWwgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+IjsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIElFbnVtZXJhYmxlPG9iamVjdFtdPiBHZXRYbWxSZWFkZXJVcmxDcmVhdGVNZXRob2RzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBbXSB7IG5ldyBGdW5jPHN0cmluZywgWG1sUmVhZGVyPihzID0+IFhtbFJlYWRlci5DcmVhdGUocykpIH07DQogICAgICAgICAgICB5aWVsZCByZXR1cm4gbmV3IFtdIHsgbmV3IEZ1bmM8c3RyaW5nLCBYbWxSZWFkZXI+KHMgPT4gWG1sUmVhZGVyLkNyZWF0ZShGaWxlLk9wZW5SZWFkKHMpLCBuZXcgWG1sUmVhZGVyU2V0dGluZ3MgeyBDbG9zZUlucHV0ID0gdHJ1ZSB9LCBzKSkgfTsNCiAgICAgICAgICAgIHlpZWxkIHJldHVybiBuZXcgW10geyBuZXcgRnVuYzxzdHJpbmcsIFhtbFJlYWRlcj4ocyA9PiBYbWxSZWFkZXIuQ3JlYXRlKG5ldyBTdHJlYW1SZWFkZXIoRmlsZS5PcGVuUmVhZChzKSksIG5ldyBYbWxSZWFkZXJTZXR0aW5ncyB7IENsb3NlSW5wdXQgPSB0cnVlIH0sIHMpKSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBbXSB7IG5ldyBGdW5jPHN0cmluZywgWG1sUmVhZGVyPihzID0+IG5ldyBYbWxUZXh0UmVhZGVyKHMpKSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBbXSB7IG5ldyBGdW5jPHN0cmluZywgWG1sUmVhZGVyPihzID0+IG5ldyBYbWxUZXh0UmVhZGVyKHMsIEZpbGUuT3BlblJlYWQocykpKSB9Ow0KICAgICAgICAgICAgeWllbGQgcmV0dXJuIG5ldyBbXSB7IG5ldyBGdW5jPHN0cmluZywgWG1sUmVhZGVyPihzID0+IG5ldyBYbWxUZXh0UmVhZGVyKHMsIG5ldyBTdHJlYW1SZWFkZXIoRmlsZS5PcGVuUmVhZChzKSkpKSB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgW01lbWJlckRhdGEobmFtZW9mKEdldFhtbFJlYWRlclVybENyZWF0ZU1ldGhvZHMpKV0NCiAgICAgICAgcHVibGljIHZvaWQgQ3JlYXRlV2l0aEFic29sdXRlUGF0aEdpdmVzQWJzb2x1dGVCYXNlVXJpKEZ1bmM8c3RyaW5nLCBYbWxSZWFkZXI+IGZhY3RvcnkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyB0ZW1wUGF0aCA9IEdldFRlc3RGaWxlUGF0aCgpOw0KICAgICAgICAgICAgRmlsZS5Xcml0ZUFsbFRleHQodGVtcFBhdGgsIER1bW15WG1sKTsNCiAgICAgICAgICAgIHVzaW5nIChYbWxSZWFkZXIgcmVhZGVyID0gZmFjdG9yeSh0ZW1wUGF0aCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUobmV3IFVyaShyZWFkZXIuQmFzZVVSSSwgVXJpS2luZC5SZWxhdGl2ZU9yQWJzb2x1dGUpLklzQWJzb2x1dGVVcmkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5YbWwuU2NoZW1hOw0KdXNpbmcgWHVuaXQ7DQp1c2luZyBYdW5pdC5BYnN0cmFjdGlvbnM7DQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzDQp7DQogICAgcHVibGljIGNsYXNzIFRDX1NjaGVtYVNldF9BZGRfUmVhZGVyIDogVENfU2NoZW1hU2V0QmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KDQogICAgICAgIHB1YmxpYyBUQ19TY2hlbWFTZXRfQWRkX1JlYWRlcihJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgTnVsbE5hbWVzcGFjZUFuZE51bGxSZWFkZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PEFyZ3VtZW50TnVsbEV4Y2VwdGlvbj4oKCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICAgICAgc2MuQWRkKChzdHJpbmcpbnVsbCwgKFhtbFJlYWRlciludWxsKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIE51bGxOYW1lc3BhY2VWYWxpZFJlYWRlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgUmVhZGVyID0gbmV3IFhtbFRleHRSZWFkZXIoVGVzdERhdGEuX1hzZEF1dGhvcik7DQogICAgICAgICAgICBYbWxTY2hlbWEgU2NoZW1hID0gc2MuQWRkKG51bGwsIFJlYWRlcik7DQoNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCBzYy5Db3VudCk7DQogICAgICAgICAgICBBc3NlcnQuTm90TnVsbChTY2hlbWEpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFZhbGlkTmFtZXNwYWNlVmFsaWRSZWFkZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBYbWxUZXh0UmVhZGVyIFJlYWRlciA9IG5ldyBYbWxUZXh0UmVhZGVyKFRlc3REYXRhLl9Yc2RBdXRob3IpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIFNjaGVtYSA9IHNjLkFkZCgieHNkYXV0aG9yIiwgUmVhZGVyKTsNCg0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHNjLkNvdW50KTsNCiAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKFNjaGVtYSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgVmFsaWROYW1lc3BhY2VSZWFkZXJQb3NpdGlvbmVkT25FbGVtZW50QnV0Tm9Yc2RTY2hlbWFUYWcoKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuVGhyb3dzQW55PFhtbFNjaGVtYUV4Y2VwdGlvbj4oKCkgPT4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICAgICAgWG1sVGV4dFJlYWRlciBSZWFkZXIgPSBuZXcgWG1sVGV4dFJlYWRlcihUZXN0RGF0YS5fWHNkQXV0aG9yKTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlIChSZWFkZXIuUmVhZCgpKSB7IH0NCg0KICAgICAgICAgICAgICAgIHNjLkFkZCgieHNkYXV0aG9yIiwgUmVhZGVyKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIE5hbWVzcGFjZVVubWF0Y2hpbmdSZWFkZXJWYWxpZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5UaHJvd3NBbnk8WG1sU2NoZW1hRXhjZXB0aW9uPigoKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgICAgICBYbWxUZXh0UmVhZGVyIFJlYWRlciA9IG5ldyBYbWxUZXh0UmVhZGVyKFRlc3REYXRhLl9Yc2RBdXRob3IpOw0KICAgICAgICAgICAgICAgIHNjLkFkZCgiIiwgUmVhZGVyKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIEFkZGluZzJSZWFkZXJzT25TY2hlbWFXaXRoTm9OYW1lc3BhY2VzQWRkV2l0aERpZmZOYW1lc3BhY2UoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBYbWxUZXh0UmVhZGVyIFJlYWRlcjEgPSBuZXcgWG1sVGV4dFJlYWRlcihUZXN0RGF0YS5fWHNkTm9Ocyk7DQogICAgICAgICAgICBYbWxUZXh0UmVhZGVyIFJlYWRlcjIgPSBuZXcgWG1sVGV4dFJlYWRlcihUZXN0RGF0YS5fWHNkTm9Ocyk7DQogICAgICAgICAgICBYbWxTY2hlbWEgU2NoZW1hMSA9IHNjLkFkZCgieHNkYXV0aG9yMSIsIFJlYWRlcjEpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIFNjaGVtYTIgPSBzYy5BZGQoInhzZGF1dGhvcjIiLCBSZWFkZXIyKTsNCg0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDIsIHNjLkNvdW50KTsNCiAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKFNjaGVtYTEpOw0KICAgICAgICAgICAgQXNzZXJ0Lk5vdEVxdWFsKFNjaGVtYTEsIFNjaGVtYTIpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIEFkZGluZ1NhbWVSZWFkZXJGb3JOdWxsTmFtZXNwYWNlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciBSZWFkZXIxID0gbmV3IFhtbFRleHRSZWFkZXIoVGVzdERhdGEuX1hzZEF1dGhvcik7DQogICAgICAgICAgICBYbWxUZXh0UmVhZGVyIFJlYWRlcjIgPSBuZXcgWG1sVGV4dFJlYWRlcihUZXN0RGF0YS5fWHNkQXV0aG9yKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBTY2hlbWExID0gc2MuQWRkKG51bGwsIFJlYWRlcjEpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIFNjaGVtYTIgPSBzYy5BZGQobnVsbCwgUmVhZGVyMik7DQoNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCgxLCBzYy5Db3VudCk7DQogICAgICAgICAgICBBc3NlcnQuTm90TnVsbChTY2hlbWExKTsNCiAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKFNjaGVtYTIpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFNjaGVtYTEsIFNjaGVtYTIpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIEFkZGluZ1JlYWRlck9uWERSU2NoZW1hKCkNCiAgICAgICAgew0KICAgICAgICAgICAgQXNzZXJ0LlRocm93c0FueTxYbWxTY2hlbWFFeGNlcHRpb24+KCgpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgUmVhZGVyMSA9IG5ldyBYbWxUZXh0UmVhZGVyKFRlc3REYXRhLl9TY2hlbWFYZHIpOw0KICAgICAgICAgICAgICAgIHNjLkFkZChudWxsLCBSZWFkZXIxKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFZhbGlkTmFtZXNwYWNlUmVhZGVyUG9zaXRpb25lZE9uQU5vbkVsZW1lbnROb2RlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgQXNzZXJ0LlRocm93c0FueTxYbWxTY2hlbWFFeGNlcHRpb24+KCgpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgcmVhZGVyID0gbmV3IFhtbFRleHRSZWFkZXIoVGVzdERhdGEuX0ZpbGVYU0QxKTsNCg0KICAgICAgICAgICAgICAgIC8vIHBvc2l0aW9ucyBvbiBhIG5vbiBlbGVtZW50IChhbm5vdGF0aW9uKSBub2RlDQogICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5Mb2NhbE5hbWUgIT0gImFubm90YXRpb24iKQ0KICAgICAgICAgICAgICAgICAgICByZWFkZXIuUmVhZCgpOw0KICAgICAgICAgICAgICAgIHNjLkFkZChudWxsLCByZWFkZXIpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgVmFsaWROYW1lc3BhY2VWYWxpZFJlYWRlcldpdGhSZXNvbHZlclNldFRvTnVsbCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgUmVhZGVyID0gbmV3IFhtbFRleHRSZWFkZXIoVGVzdERhdGEuX1hzZEF1dGhvcik7DQogICAgICAgICAgICBSZWFkZXIuWG1sUmVzb2x2ZXIgPSBudWxsOw0KICAgICAgICAgICAgWG1sU2NoZW1hIFNjaGVtYSA9IHNjLkFkZCgieHNkYXV0aG9yIiwgUmVhZGVyKTsNCg0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHNjLkNvdW50KTsNCiAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKFNjaGVtYSk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgU2NoZW1hc1dpdGhOb1NvdXJjZVVSSU9uZUxvYWRlZEZyb21YbWxTY2hlbWFSZWFkT3RoZXJGcm9tRE9NRGlmZlROUygpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIC8vZmlyc3Qgc2NoZW1hDQogICAgICAgICAgICBYbWxTY2hlbWEgc2NoZW1hID0gWG1sU2NoZW1hLlJlYWQobmV3IFN0cmluZ1JlYWRlcihAIjx4c2Q6c2NoZW1hIHhtbG5zOnhzZD0naHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEnIHRhcmdldE5hbWVzcGFjZT0nYmFyJz48eHNkOmVsZW1lbnQgbmFtZT0nYXV0aG9yMScgdHlwZT0neHNkOnN0cmluZycvPjwveHNkOnNjaGVtYT4iKSwgbnVsbCk7DQogICAgICAgICAgICBYbWxTY2hlbWEgdGVtcCA9IHNjLkFkZChzY2hlbWEpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJiYXIiLCB0ZW1wLlRhcmdldE5hbWVzcGFjZSk7DQoNCiAgICAgICAgICAgIC8vc2Vjb25kIHNjaGVtYQ0KICAgICAgICAgICAgWG1sRG9jdW1lbnQgZG9jID0gbmV3IFhtbERvY3VtZW50KCk7DQogICAgICAgICAgICBkb2MuTG9hZFhtbCgiPHhzZDpzY2hlbWEgeG1sbnM6eHNkPSdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYScgdGFyZ2V0TmFtZXNwYWNlPSdmb28nPjx4c2Q6ZWxlbWVudCBuYW1lPSdhdXRob3IyJyB0eXBlPSd4c2Q6Ym9vbGVhbicvPjwveHNkOnNjaGVtYT4iKTsNCiAgICAgICAgICAgIFhtbE5vZGUgcm9vdCA9IGRvYy5GaXJzdENoaWxkOw0KICAgICAgICAgICAgWG1sTm9kZVJlYWRlciByZWFkZXIgPSBuZXcgWG1sTm9kZVJlYWRlcihyb290KTsNCiAgICAgICAgICAgIHRlbXAgPSBzYy5BZGQobnVsbCwgcmVhZGVyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCgiZm9vIiwgdGVtcC5UYXJnZXROYW1lc3BhY2UpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDIsIHNjLkNvdW50KTsNCg0KICAgICAgICAgICAgc2MuQ29tcGlsZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFNjaGVtYXNXaXRoTm9Tb3VyY2VVUklPbmVMb2FkZWRGcm9tWG1sU2NoZW1hUmVhZE90aGVyRnJvbURPTVNhbWVUTlMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQoNCiAgICAgICAgICAgIC8vZmlyc3Qgc2NoZW1hDQogICAgICAgICAgICBYbWxTY2hlbWEgc2NoZW1hID0gWG1sU2NoZW1hLlJlYWQobmV3IFN0cmluZ1JlYWRlcihAIjx4c2Q6c2NoZW1hIHhtbG5zOnhzZD0naHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEnIHRhcmdldE5hbWVzcGFjZT0nZm9vJz48eHNkOmVsZW1lbnQgbmFtZT0nYXV0aG9yMScgdHlwZT0neHNkOnN0cmluZycvPjwveHNkOnNjaGVtYT4iKSwgbnVsbCk7DQoNCiAgICAgICAgICAgIFhtbFNjaGVtYSB0ZW1wID0gc2MuQWRkKHNjaGVtYSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoImZvbyIsIHRlbXAuVGFyZ2V0TmFtZXNwYWNlKTsNCg0KICAgICAgICAgICAgLy9zZWNvbmQgc2NoZW1hDQogICAgICAgICAgICBYbWxEb2N1bWVudCBkb2MgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCg0KICAgICAgICAgICAgZG9jLkxvYWRYbWwoIjx4c2Q6c2NoZW1hIHhtbG5zOnhzZD0naHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEnIHRhcmdldE5hbWVzcGFjZT0nZm9vJz48eHNkOmVsZW1lbnQgbmFtZT0nYXV0aG9yMicgdHlwZT0neHNkOmJvb2xlYW4nLz48L3hzZDpzY2hlbWE+Iik7DQoNCiAgICAgICAgICAgIFhtbE5vZGUgcm9vdCA9IGRvYy5GaXJzdENoaWxkOw0KICAgICAgICAgICAgWG1sTm9kZVJlYWRlciByZWFkZXIgPSBuZXcgWG1sTm9kZVJlYWRlcihyb290KTsNCg0KICAgICAgICAgICAgdGVtcCA9IHNjLkFkZChudWxsLCByZWFkZXIpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJmb28iLCB0ZW1wLlRhcmdldE5hbWVzcGFjZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoMiwgc2MuQ291bnQpOw0KICAgICAgICAgICAgc2MuQ29tcGlsZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFNjaGVtYXNXaXRoTm9Tb3VyY2VVUklPbmVMb2FkZWRGcm9tWG1sU2NoZW1hUmVhZE90aGVyRnJvbURPTVNhbWVOb1ROUygpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCg0KICAgICAgICAgICAgLy9maXJzdCBzY2hlbWENCiAgICAgICAgICAgIFhtbFNjaGVtYSBzY2hlbWEgPSBYbWxTY2hlbWEuUmVhZChuZXcgU3RyaW5nUmVhZGVyKEAiPHhzZDpzY2hlbWEgeG1sbnM6eHNkPSdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSc+PHhzZDplbGVtZW50IG5hbWU9J2F1dGhvcjEnIHR5cGU9J3hzZDpzdHJpbmcnLz48L3hzZDpzY2hlbWE+IiksIG51bGwpOw0KDQogICAgICAgICAgICBYbWxTY2hlbWEgdGVtcCA9IHNjLkFkZChzY2hlbWEpOw0KICAgICAgICAgICAgQXNzZXJ0Lk51bGwodGVtcC5UYXJnZXROYW1lc3BhY2UpOw0KDQogICAgICAgICAgICAvL3NlY29uZCBzY2hlbWENCiAgICAgICAgICAgIFhtbERvY3VtZW50IGRvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KDQogICAgICAgICAgICBkb2MuTG9hZFhtbCgiPHhzZDpzY2hlbWEgeG1sbnM6eHNkPSdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSc+PHhzZDplbGVtZW50IG5hbWU9J2F1dGhvcjInIHR5cGU9J3hzZDpib29sZWFuJy8+PC94c2Q6c2NoZW1hPiIpOw0KDQogICAgICAgICAgICBYbWxOb2RlIHJvb3QgPSBkb2MuRmlyc3RDaGlsZDsNCiAgICAgICAgICAgIFhtbE5vZGVSZWFkZXIgcmVhZGVyID0gbmV3IFhtbE5vZGVSZWFkZXIocm9vdCk7DQoNCiAgICAgICAgICAgIHRlbXAgPSBzYy5BZGQobnVsbCwgcmVhZGVyKTsNCiAgICAgICAgICAgIEFzc2VydC5OdWxsKHRlbXAuVGFyZ2V0TmFtZXNwYWNlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCgyLCBzYy5Db3VudCk7DQogICAgICAgICAgICBzYy5Db21waWxlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgUmVncmVzc2lvblRlc3QxKCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KDQogICAgICAgICAgICAvL2ZpcnN0IHNjaGVtYQ0KICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYSA9IFhtbFNjaGVtYS5SZWFkKG5ldyBTdHJpbmdSZWFkZXIoQCI8eHNkOnNjaGVtYSB4bWxuczp4c2Q9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJyB0YXJnZXROYW1lc3BhY2U9J2Jhcic+PHhzZDplbGVtZW50IG5hbWU9J2F1dGhvcjEnIHR5cGU9J3hzZDpzdHJpbmcnLz48L3hzZDpzY2hlbWE+IiksIG51bGwpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJiYXIiLCBzYy5BZGQoc2NoZW1hKS5UYXJnZXROYW1lc3BhY2UpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIHNjLkNvdW50KTsNCg0KICAgICAgICAgICAgLy9zZWNvbmQgc2NoZW1hDQogICAgICAgICAgICBYbWxEb2N1bWVudCBkb2MgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIGRvYy5Mb2FkWG1sKCI8eHNkOnNjaGVtYSB4bWxuczp4c2Q9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJyB0YXJnZXROYW1lc3BhY2U9J2Zvbyc+PHhzZDplbGVtZW50IG5hbWU9J2F1dGhvcjInIHR5cGU9J3hzZDpib29sZWFuJy8+PC94c2Q6c2NoZW1hPiIpOw0KDQogICAgICAgICAgICBYbWxOb2RlIHJvb3QgPSBkb2MuRmlyc3RDaGlsZDsNCiAgICAgICAgICAgIFhtbE5vZGVSZWFkZXIgcmVhZGVyID0gbmV3IFhtbE5vZGVSZWFkZXIocm9vdCk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoImZvbyIsIHNjLkFkZChudWxsLCByZWFkZXIpLlRhcmdldE5hbWVzcGFjZSk7DQogICAgICAgICAgICBzYy5Db21waWxlKCk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoMiwgc2MuQ291bnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFJlZ3Jlc3Npb25UZXN0MigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyB4c2QgPQ0KQCI8eHNkOnNjaGVtYSB0YXJnZXROYW1lc3BhY2U9J3gnIHhtbG5zPSdTTUlUX1BlcmZfVG9wTGV2ZWxTZXR0aW5nc19MaXN0VHlwZXNfTGFyZ2UnIHhtbG5zOnhzZD0naHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEnPg0KICA8eHNkOmNvbXBsZXhUeXBlIG5hbWU9J1NldHRpbmdfdHlwZV9zY2FsYXJsaXN0X2ludF82Jz4NCgk8eHNkOnNlcXVlbmNlPg0KCSAgPHhzZDplbGVtZW50IG5hbWU9J1NldHRpbmdfNF9pbnQnIHR5cGU9J3hzZDppbnQnIG1pbk9jY3Vycz0nMCcgbWF4T2NjdXJzPSdHMFhOaVVKRlVKdkJjNlV1ZVlXNzVPOUhiNlZLTjM0RkFsWlNTTWFzYktKSmlqb2xPSlhBZXQxMjBQd2w5ODFiUHFBMGhCYlI4b2d2RjBqMlN1NkRnM2tSdWdjRGF5c2NTcjMxaXhFTXNGQ3pORng5cTNTUEJ5NVZGdEdBalgxSjVEZFg3clVmcHVWYTF1RG90Y1dnZ2RiZHdpd3lyRW5VTzI0Sm1hQzlqeGpSY2ZkVXBiUkhCVW5ibTlsWTRneWxHQk05MDRDU2FYN3M0SkJRRmJJUHdnVDNPZGhuem5FRDk4S2JUZGV2Wjhyblg1aGM4VVRkWGl5a3NTdVdXWWR3VDRzNTlqN2w3WHp5enBnVDZFb2VVbHBhS2p0QXRIWUFlNFVjTWxkWldzZ0F0OXZDd2FhU3Q4Y3JPU3ZaejYxejh5VDRVREhVbFBJbEVvckt4cU9TcUdRZ2NtTzN6RGpaMHFDNHAxc3NTRnFlMDBuamtsbElzakkxaHhicnpOZmhxc3ZYbXdlNjhmOWxhd3BtOW9UT2JiclJpS1gyWkIyRmtJeElGUDZ5R3BLTWpoYnVJenJMNFFHUEFkemNabWg3bjRBUjlnaHVyZkl3UWVzQnNtdGpUcktVQ2lIbFplWWRITWpvaEt2bFM2ZFpIVDhmdnl0eDM3bjV0cFBhWjZVTUdwb0Q1RGRpMElSV052TXRrbHpsdWxrS2pvNTE1Vk1XbVJTY280a3NVTDZ1cFFyOGRmMHhHdGNmRWVlUkltbmY2NXU2Y3RFcEJHUmlwemVTNjZZWmZZUDN5eFlLWlRrcmlheXVndmZ0Ykt3QWIzME85TFVMTk5BaHAxSHBWNFFyZmpBT0J0d0xibzhVbVBiNTdKS044WmRVYVFGb256WGc0RWUxMmxOUVpKdGpQcDVaWkxzTXVDc0dGcHl2b0lobFFiYWh2akNWNTR5enE0RnVWcE9iSEx3MlZYdk54Y2xSbEhTeU9YbzBJV1EwTjNhTGtEYTgzR2VGb2lNWHl6aWRTaE5pbVFmN0JZU3U0Nm9jN2tudUNuWGZuTUpxTFFCVHl3aHFxMWlUaGM3Znh1S3M0dVpOTXhib0pyNWFIend1Vzk1SFk4dkZCVE1qcTJzM0Nid2ExeUhBVjJnODZJTXNwTUl5eUNUNThVTDJsMThSOUNYcENWM2kyNHdmYnhKM0hlNGR0NEU5SDBjZ21PWmQ0UDg0dWdwVFRrNTNReWVLS1N2SDZmaEY3WWlNM1c1bmZTbEx5T0lreWxKSjhMdFRWUldVZFNnWXMzNlc4Y1o3b1NZN01TVjZKS1NWV1hId3BQMGxBbEtNJyAvPg0KCTwveHNkOnNlcXVlbmNlPg0KICA8L3hzZDpjb21wbGV4VHlwZT4NCjwveHNkOnNjaGVtYT4iOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHMgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICB1c2luZyAoWG1sUmVhZGVyIHIgPSBYbWxSZWFkZXIuQ3JlYXRlKG5ldyBTdHJpbmdSZWFkZXIoeHNkKSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzLkFkZChudWxsLCByKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFhtbFNjaGVtYUV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkZhbHNlKGUuTWVzc2FnZS5FbmRzV2l0aCgiLi4iKSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgIH0NCn0="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlhtbC5TY2hlbWE7DQp1c2luZyBYdW5pdDsNCnVzaW5nIFh1bml0LkFic3RyYWN0aW9uczsNCg0KbmFtZXNwYWNlIFN5c3RlbS5YbWwuVGVzdHMNCnsNCiAgICBwdWJsaWMgY2xhc3MgVENfU2NoZW1hU2V0X0FkZF9TY2hlbWEgOiBUQ19TY2hlbWFTZXRCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQoNCiAgICAgICAgcHVibGljIFRDX1NjaGVtYVNldF9BZGRfU2NoZW1hKElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjEgLSBzYyA9IG51bGwiLCBQcmlvcml0eSA9IDApXQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgdjEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzYy5BZGQoKFhtbFNjaGVtYSludWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ291bnQsIDApOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ29udGFpbnMoKFhtbFNjaGVtYSludWxsKSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoQXJndW1lbnROdWxsRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvbnRhaW5zKChzdHJpbmcpbnVsbCksIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLklzQ29tcGlsZWQsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIgLSBzYyA9IHZhbGlkIHNjaGVtYSIpXQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgdjIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBYbWxTY2hlbWEgU2NoZW1hID0gWG1sU2NoZW1hLlJlYWQobmV3IFN0cmVhbVJlYWRlcihuZXcgRmlsZVN0cmVhbShUZXN0RGF0YS5fRmlsZVhTRDEsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpLCBudWxsKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBTY2hlbWFOZXcgPSBzYy5BZGQoU2NoZW1hKTsNCg0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvdW50LCAxKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db250YWlucyhTY2hlbWFOZXcpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Jc0NvbXBpbGVkLCBmYWxzZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoU2NoZW1hID09IFNjaGVtYU5ldywgdHJ1ZSk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjMgLSBzYyA9IHZhbGlkIHNjaGVtYSwgYWRkIHR3aWNlLCBzZWNvbmQgYWRkIHNob3VsZCBiZSBpZ25vcmVkLiIsIFByaW9yaXR5ID0gMCldDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MygpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBTY2hlbWEgPSBYbWxTY2hlbWEuUmVhZChuZXcgU3RyZWFtUmVhZGVyKG5ldyBGaWxlU3RyZWFtKFRlc3REYXRhLl9GaWxlWFNEMSwgRmlsZU1vZGUuT3BlbiwgRmlsZUFjY2Vzcy5SZWFkKSksIG51bGwpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIFNjaGVtYU5ldzEgPSBzYy5BZGQoU2NoZW1hKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBTY2hlbWFOZXcyID0gc2MuQWRkKFNjaGVtYSk7DQoNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db3VudCwgMSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ29udGFpbnMoU2NoZW1hTmV3MSksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvbnRhaW5zKFNjaGVtYU5ldzIpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Jc0NvbXBpbGVkLCBmYWxzZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoU2NoZW1hID09IFNjaGVtYU5ldzEsIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFNjaGVtYSA9PSBTY2hlbWFOZXcyLCB0cnVlKTsNCg0KICAgICAgICAgICAgc2MuQ29tcGlsZSgpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvdW50LCAxKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db250YWlucyhTY2hlbWFOZXcxKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ29udGFpbnMoU2NoZW1hTmV3MiksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLklzQ29tcGlsZWQsIHRydWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2NCAtIHNjID0gdmFsaWQgc2NoZW1hLCBhZGQgdXJsIGZvciBzYW1lIHNjaGVtYSwgY2FsbCBjb21waWxlIiwgUHJpb3JpdHkgPSAwKV0NCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIHY0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIFNjaGVtYSA9IFhtbFNjaGVtYS5SZWFkKG5ldyBTdHJlYW1SZWFkZXIobmV3IEZpbGVTdHJlYW0oVGVzdERhdGEuX0ZpbGVYU0QxLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQpKSwgbnVsbCk7DQogICAgICAgICAgICBYbWxTY2hlbWEgU2NoZW1hTmV3MSA9IHNjLkFkZChTY2hlbWEpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIFNjaGVtYU5ldzIgPSBzYy5BZGQoInNjaGVtYTEueHNkIiwgVGVzdERhdGEuX0ZpbGVYU0QxKTsNCg0KICAgICAgICAgICAgLy8gYm90aCBzY2hlbWFzIGFyZSBhZGRlZCBidXQgdGhleSBhcmUgZHVwDQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ291bnQsIDIpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvbnRhaW5zKFNjaGVtYU5ldzEpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db250YWlucyhTY2hlbWFOZXcyKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuSXNDb21waWxlZCwgZmFsc2UpOw0KDQogICAgICAgICAgICAvLyBjaGVjayBpdHMgbm90IHRoZSBzYW1lIHNjaGVtYSBhcyBmaXJzdA0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKFNjaGVtYSA9PSBTY2hlbWFOZXcxLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChTY2hlbWEgPT0gU2NoZW1hTmV3MiwgZmFsc2UpOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzYy5Db21waWxlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db3VudCwgMik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvbnRhaW5zKFNjaGVtYU5ldzEpLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ29udGFpbnMoU2NoZW1hTmV3MiksIHRydWUpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Jc0NvbXBpbGVkLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInY1IC0gc2MgPSBzY2hlbWEgd2l0aG91dCBucywgYWRkIHVybCBmb3Igc2FtZSBzY2hlbWEgd2l0aCBucywgY2FsbCBjb21waWxlIildDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2NSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBTY2hlbWEgPSBYbWxTY2hlbWEuUmVhZChuZXcgU3RyZWFtUmVhZGVyKG5ldyBGaWxlU3RyZWFtKFRlc3REYXRhLl9Yc2RBdXRob3IsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpLCBudWxsKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBTY2hlbWFOZXcxID0gc2MuQWRkKFNjaGVtYSk7DQogICAgICAgICAgICBYbWxTY2hlbWEgU2NoZW1hTmV3MiA9IHNjLkFkZChudWxsLCBUZXN0RGF0YS5fWHNkQXV0aG9yTm9Ocyk7DQoNCiAgICAgICAgICAgIC8vIGJvdGggc2NoZW1hcyBhcmUgYWRkZWQgYnV0IHRoZXkgYXJlIGR1cA0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvdW50LCAyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db250YWlucyhTY2hlbWFOZXcxKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ29udGFpbnMoU2NoZW1hTmV3MiksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLklzQ29tcGlsZWQsIGZhbHNlKTsNCg0KICAgICAgICAgICAgLy8gY2hlY2sgaXRzIG5vdCB0aGUgc2FtZSBzY2hlbWEgYXMgZmlyc3QNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChTY2hlbWEgPT0gU2NoZW1hTmV3MSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoU2NoZW1hID09IFNjaGVtYU5ldzIsIGZhbHNlKTsNCg0KICAgICAgICAgICAgc2MuQ29tcGlsZSgpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvdW50LCAyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db250YWlucyhTY2hlbWFOZXcxKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ29udGFpbnMoU2NoZW1hTmV3MiksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLklzQ29tcGlsZWQsIHRydWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2NiAtIHNjID0gc2NoZW1hIHdpdGhvdXQgbnMsIGFkZCB1cmwgZm9yIHNhbWUgc2NoZW1hLCBjYWxsIGNvbXBpbGUiKV0NCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIHY2KCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIFNjaGVtYSA9IFhtbFNjaGVtYS5SZWFkKG5ldyBTdHJlYW1SZWFkZXIobmV3IEZpbGVTdHJlYW0oVGVzdERhdGEuX1hzZE5vTnMsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpLCBudWxsKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBTY2hlbWFOZXcxID0gc2MuQWRkKFNjaGVtYSk7DQogICAgICAgICAgICBYbWxTY2hlbWEgU2NoZW1hTmV3MiA9IHNjLkFkZChudWxsLCBUZXN0RGF0YS5fWHNkTm9Ocyk7DQoNCiAgICAgICAgICAgIC8vIGJvdGggc2NoZW1hcyBhcmUgYWRkZWQgYnV0IHRoZXkgYXJlIGR1cA0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvdW50LCAyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db250YWlucyhTY2hlbWFOZXcxKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ29udGFpbnMoU2NoZW1hTmV3MiksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLklzQ29tcGlsZWQsIGZhbHNlKTsNCg0KICAgICAgICAgICAgLy8gY2hlY2sgaXRzIG5vdCB0aGUgc2FtZSBzY2hlbWEgYXMgZmlyc3QNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChTY2hlbWEgPT0gU2NoZW1hTmV3MSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoU2NoZW1hID09IFNjaGVtYU5ldzIsIGZhbHNlKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNjLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxTY2hlbWFFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLkNvdW50LCAyKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2MuQ29udGFpbnMoU2NoZW1hTmV3MSksIHRydWUpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChzYy5Db250YWlucyhTY2hlbWFOZXcyKSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNjLklzQ29tcGlsZWQsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInY3IC0gNDMwMTY0X2ltcG9ydCBBZGQoWG1sU2NoZW1hKSBkb2VzIG5vdCBjaGVjayBpZiBsb2NhdGlvbiBhbHJlYWR5IGV4aXN0cyIpXQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgdjcoKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgQWRkU2NoZW1hKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgIkJ1ZzQzMDE2NF9jX2ltcG9ydC54c2QiKSwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiQnVnNDMwMTY0LnhzZCIpLCAyKSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2OCAtIDQzMDE2NF9pbmNsdWRlIEFkZChYbWxTY2hlbWEpIildDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2OCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCgwLCBBZGRTY2hlbWEoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiQnVnNDMwMTY0X2JfaW5jbHVkZS54c2QiKSwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiQnVnNDMwMTY0LnhzZCIpLCAxKSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2OSAtIDQzMDE2NF9yZWRlZmluZSBBZGQoWG1sU2NoZW1hKSIpXQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgdjkoKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoMCwgQWRkU2NoZW1hKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgIkJ1ZzQzMDE2NF9hX3JlZGVmaW5lLnhzZCIpLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJCdWc0MzAxNjQueHNkIiksIDEpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgaW50IEFkZFNjaGVtYShzdHJpbmcgcGF0aDEsIHN0cmluZyBwYXRoMiwgaW50IGV4cENvdW50KQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHMuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hIGFTY2hlbWEgPSBYbWxTY2hlbWEuUmVhZChuZXcgWG1sVGV4dFJlYWRlcihwYXRoMSksIG51bGwpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIGJTY2hlbWEgPSBYbWxTY2hlbWEuUmVhZChuZXcgWG1sVGV4dFJlYWRlcihwYXRoMiksIG51bGwpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHMuQ291bnQsIDApOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHMuQ29udGFpbnMoYVNjaGVtYSksIGZhbHNlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzLkNvbnRhaW5zKGJTY2hlbWEpLCBmYWxzZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwocy5Jc0NvbXBpbGVkLCBmYWxzZSk7DQoNCiAgICAgICAgICAgIHMuQWRkKGFTY2hlbWEpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHMuQ291bnQsIGV4cENvdW50KTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzLkNvbnRhaW5zKGFTY2hlbWEpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzLkNvbnRhaW5zKGJTY2hlbWEpLCBmYWxzZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwocy5Jc0NvbXBpbGVkLCBmYWxzZSk7DQoNCiAgICAgICAgICAgIHMuQWRkKGJTY2hlbWEpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHMuQ291bnQsIGV4cENvdW50ICsgMSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwocy5Db250YWlucyhhU2NoZW1hKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwocy5Db250YWlucyhiU2NoZW1hKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwocy5Jc0NvbXBpbGVkLCBmYWxzZSk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzLkNvbXBpbGUoKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTm8gZXhjZXB0aW9uIHRocm93biIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxTY2hlbWFFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChzLkNvdW50LCBleHBDb3VudCArIDEpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChzLkNvbnRhaW5zKGFTY2hlbWEpLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuRXF1YWwocy5Db250YWlucyhiU2NoZW1hKSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHMuSXNDb21waWxlZCwgZmFsc2UpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIjUyNTQ3N2E6IFhTRCBSZWRlZmluZSBkb2Vzbid0IHdvcmsiKV0NCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIHYxMCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbENhY2hlZFNjaGVtYVNldFJlc29sdmVyIHJlc29sdmVyID0gbmV3IFhtbENhY2hlZFNjaGVtYVNldFJlc29sdmVyKCk7DQogICAgICAgICAgICBYbWxUZXh0UmVhZGVyIHIgPSBuZXcgWG1sVGV4dFJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIEAiUmVkZWZpbmVFbXBsb3llZS54c2QiKSk7DQogICAgICAgICAgICBYbWxTY2hlbWEgcyA9IFhtbFNjaGVtYS5SZWFkKHIsIG51bGwpOw0KICAgICAgICAgICAgcmVzb2x2ZXIuQWRkKG5ldyBVcmkocy5Tb3VyY2VVcmkpLCBzKTsNCg0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciByMiA9IG5ldyBYbWxUZXh0UmVhZGVyKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgQCJCYXNlRW1wbG95ZWUyLnhzZCIpKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzMiA9IFhtbFNjaGVtYS5SZWFkKHIyLCBudWxsKTsNCiAgICAgICAgICAgIHJlc29sdmVyLkFkZChuZXcgVXJpKHMyLlNvdXJjZVVyaSksIHMyKTsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNldCA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNldC5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKGNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNldC5YbWxSZXNvbHZlciA9IHJlc29sdmVyOw0KDQogICAgICAgICAgICBzZXQuQWRkKHMyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQuQ291bnQsIDEpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldC5Db250YWlucyhzMiksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldC5Jc0NvbXBpbGVkLCBmYWxzZSk7DQoNCiAgICAgICAgICAgIHNldC5BZGQocyk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0LkNvdW50LCAyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQuQ29udGFpbnMocyksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldC5Jc0NvbXBpbGVkLCBmYWxzZSk7DQoNCiAgICAgICAgICAgIHNldC5Db21waWxlKCk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0LkNvdW50LCAyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQuQ29udGFpbnMoczIpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQuQ29udGFpbnMocyksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldC5Jc0NvbXBpbGVkLCB0cnVlKTsNCg0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciByMyA9IG5ldyBYbWxUZXh0UmVhZGVyKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgQCJCYXNlRW1wbG95ZWUyLnhzZCIpKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzMyA9IFhtbFNjaGVtYS5SZWFkKHIzLCBudWxsKTsNCiAgICAgICAgICAgIHJlc29sdmVyLkFkZChuZXcgVXJpKHMzLlNvdXJjZVVyaSksIHMzKTsNCg0KICAgICAgICAgICAgLy9DbGVhciBpbmNsdWRlcyBpbiBTDQogICAgICAgICAgICBmb3JlYWNoIChYbWxTY2hlbWFFeHRlcm5hbCBleHQgaW4gcy5JbmNsdWRlcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBleHQuU2NoZW1hID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzZXQyID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc2V0Mi5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKGNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNldDIuWG1sUmVzb2x2ZXIgPSByZXNvbHZlcjsNCiAgICAgICAgICAgIHNldDIuQWRkKHMzKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvdW50LCAxKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvbnRhaW5zKHMyKSwgZmFsc2UpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ29udGFpbnMocyksIGZhbHNlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvbnRhaW5zKHMzKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0Mi5Jc0NvbXBpbGVkLCBmYWxzZSk7DQoNCiAgICAgICAgICAgIHNldDIuQWRkKHMpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ291bnQsIDIpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ29udGFpbnMoczIpLCBmYWxzZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0Mi5Db250YWlucyhzKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0Mi5Db250YWlucyhzMyksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuSXNDb21waWxlZCwgZmFsc2UpOw0KDQogICAgICAgICAgICBzZXQyLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvdW50LCAyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvbnRhaW5zKHMyKSwgZmFsc2UpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ29udGFpbnMocyksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ29udGFpbnMoczMpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLklzQ29tcGlsZWQsIHRydWUpOw0KDQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoZXJyb3JDb3VudCwgMCk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICI1MjU0NzdiOiBYU0QgUmVkZWZpbmUgZG9lc24ndCB3b3JrIildDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxDYWNoZWRTY2hlbWFTZXRSZXNvbHZlciByZXNvbHZlciA9IG5ldyBYbWxDYWNoZWRTY2hlbWFTZXRSZXNvbHZlcigpOw0KDQogICAgICAgICAgICBYbWxUZXh0UmVhZGVyIHIgPSBuZXcgWG1sVGV4dFJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIEAiUmVkZWZpbmVFbXBsb3llZS54c2QiKSk7DQogICAgICAgICAgICBYbWxTY2hlbWEgcyA9IFhtbFNjaGVtYS5SZWFkKHIsIG51bGwpOw0KICAgICAgICAgICAgcmVzb2x2ZXIuQWRkKG5ldyBVcmkocy5Tb3VyY2VVcmkpLCBzKTsNCg0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciByMiA9IG5ldyBYbWxUZXh0UmVhZGVyKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgQCJCYXNlRW1wbG95ZWUyLnhzZCIpKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzMiA9IFhtbFNjaGVtYS5SZWFkKHIyLCBudWxsKTsNCiAgICAgICAgICAgIHJlc29sdmVyLkFkZChuZXcgVXJpKHMyLlNvdXJjZVVyaSksIHMyKTsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNldCA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNldC5YbWxSZXNvbHZlciA9IHJlc29sdmVyOw0KICAgICAgICAgICAgc2V0LkFkZChzMik7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0LkNvdW50LCAxKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQuQ29udGFpbnMoczIpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQuSXNDb21waWxlZCwgZmFsc2UpOw0KDQogICAgICAgICAgICBzZXQuQWRkKHMpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldC5Db3VudCwgMik7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0LkNvbnRhaW5zKHMpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQuSXNDb21waWxlZCwgZmFsc2UpOw0KDQogICAgICAgICAgICBzZXQuQ29tcGlsZSgpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldC5Db3VudCwgMik7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0LkNvbnRhaW5zKHMyKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0LkNvbnRhaW5zKHMpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQuSXNDb21waWxlZCwgdHJ1ZSk7DQoNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHNldHRpbmdzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQogICAgICAgICAgICBzZXR0aW5ncy5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLlNjaGVtYTsNCiAgICAgICAgICAgIHNldHRpbmdzLlNjaGVtYXMgPSBzZXQ7DQoNCiAgICAgICAgICAgIHVzaW5nIChYbWxSZWFkZXIgcmVhZGVyID0gWG1sUmVhZGVyLkNyZWF0ZShQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJFbXBsb3llZXNEZWZhdWx0UHJlZml4LnhtbCIpLCBzZXR0aW5ncykpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5SZWFkKCkpIDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgcjMgPSBuZXcgWG1sVGV4dFJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIEAiQmFzZUVtcGxveWVlMi54c2QiKSk7DQogICAgICAgICAgICBYbWxTY2hlbWEgczMgPSBYbWxTY2hlbWEuUmVhZChyMywgbnVsbCk7DQogICAgICAgICAgICByZXNvbHZlci5BZGQobmV3IFVyaShzMy5Tb3VyY2VVcmkpLCBzMyk7DQoNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzZXQyID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc2V0Mi5YbWxSZXNvbHZlciA9IHJlc29sdmVyOw0KICAgICAgICAgICAgc2V0Mi5BZGQoczMpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ291bnQsIDEpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ29udGFpbnMoczIpLCBmYWxzZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0Mi5Db250YWlucyhzKSwgZmFsc2UpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ29udGFpbnMoczMpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLklzQ29tcGlsZWQsIGZhbHNlKTsNCg0KICAgICAgICAgICAgZm9yZWFjaCAoWG1sU2NoZW1hUmVkZWZpbmUgcmVkZWZpbmUgaW4gcy5JbmNsdWRlcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZWRlZmluZS5TY2hlbWEgPSBudWxsOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzZXQyLkFkZChzKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvdW50LCAyKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvbnRhaW5zKHMyKSwgZmFsc2UpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ29udGFpbnMocyksIHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHNldDIuQ29udGFpbnMoczMpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLklzQ29tcGlsZWQsIGZhbHNlKTsNCg0KICAgICAgICAgICAgc2V0Mi5Db21waWxlKCk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0Mi5Db3VudCwgMik7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0Mi5Db250YWlucyhzMiksIGZhbHNlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvbnRhaW5zKHMpLCB0cnVlKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChzZXQyLkNvbnRhaW5zKHMzKSwgdHJ1ZSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoc2V0Mi5Jc0NvbXBpbGVkLCB0cnVlKTsNCg0KICAgICAgICAgICAgc2V0dGluZ3MuU2NoZW1hcyA9IHNldDI7DQoNCiAgICAgICAgICAgIHVzaW5nIChYbWxSZWFkZXIgcmVhZGVyID0gWG1sUmVhZGVyLkNyZWF0ZShQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJFbXBsb3llZXNEZWZhdWx0UHJlZml4LnhtbCIpLCBzZXR0aW5ncykpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5SZWFkKCkpIDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChlcnJvckNvdW50LCAwKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIjY0OTk2N2EuWG1sU2NoZW1hU2V0LlJlcHJvY2VzcygpIGZpeCBpcyBjaGFuZ2luZyBhIGNvbGxlY3Rpb24gd2hlcmUgc2NoZW1hcyBhcmUgc3RvcmVkIildDQogICAgICAgIFtGYWN0XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTJhKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKFhtbFJlYWRlciByID0gWG1sUmVhZGVyLkNyZWF0ZShQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIEAiYnVnMjY0OTA4X3YxLnhzZCIpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWEgcyA9IFhtbFNjaGVtYS5SZWFkKHIsIG51bGwpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChYbWxSZWFkZXIgcjIgPSBYbWxSZWFkZXIuQ3JlYXRlKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgQCJidWcyNjQ5MDhfdjFhLnhzZCIpKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYSBzMiA9IFhtbFNjaGVtYS5SZWFkKHIyLCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNldCA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCg0KICAgICAgICAgICAgICAgICAgICBzZXQuWG1sUmVzb2x2ZXIgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICBzZXQuQWRkKHMpOw0KICAgICAgICAgICAgICAgICAgICBzZXQuQWRkKHMyKTsNCiAgICAgICAgICAgICAgICAgICAgc2V0LkNvbXBpbGUoKTsNCg0KICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChYbWxTY2hlbWEgc2NoZW1hIGluIHNldC5TY2hlbWFzKCkpDQogICAgICAgICAgICAgICAgICAgICAgICBzZXQuUmVwcm9jZXNzKHNjaGVtYSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBlcnJvckNvdW50Ow0KDQogICAgICAgIHByaXZhdGUgdm9pZCBjYWxsYmFjayhvYmplY3Qgc2VuZGVyLCBWYWxpZGF0aW9uRXZlbnRBcmdzIGFyZ3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIGVycm9yQ291bnQrKzsNCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGFyZ3MuTWVzc2FnZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgWG1sQ2FjaGVkU2NoZW1hU2V0UmVzb2x2ZXIgOiBYbWxSZXNvbHZlcg0KICAgICAgICB7DQogICAgICAgICAgICBwcml2YXRlIERpY3Rpb25hcnk8VXJpLCBYbWxTY2hlbWE+IHNjaGVtYXMgPSBuZXcgRGljdGlvbmFyeTxVcmksIFhtbFNjaGVtYT4oKTsNCg0KICAgICAgICAgICAgcHVibGljIHZvaWQgQWRkKFVyaSB1cmksIFhtbFNjaGVtYSBzY2hlbWEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2NoZW1hc1t1cmldID0gc2NoZW1hOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgb2JqZWN0IEdldEVudGl0eShVcmkgYWJzb2x1dGVVcmksIHN0cmluZyByb2xlLCBUeXBlIG9mT2JqZWN0VG9SZXR1cm4pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG9mT2JqZWN0VG9SZXR1cm4gPT0gbnVsbCB8fCBvZk9iamVjdFRvUmV0dXJuID09IHR5cGVvZihYbWxTY2hlbWEpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NoZW1hcy5UcnlHZXRWYWx1ZShhYnNvbHV0ZVVyaSwgb3V0IHNjaGVtYSkpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1hOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Misc.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlhtbC5TY2hlbWE7DQp1c2luZyBTeXN0ZW0uWG1sLlhQYXRoOw0KDQpuYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cw0Kew0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiVENfU2NoZW1hU2V0X01pc2MiLCBEZXNjID0gIiIpXQ0KICAgIHB1YmxpYyBjbGFzcyBUQ19TY2hlbWFTZXRfTWlzYyA6IFRDX1NjaGVtYVNldEJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCg0KICAgICAgICBwdWJsaWMgVENfU2NoZW1hU2V0X01pc2MoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwdWJsaWMgYm9vbCBiV2FybmluZ0NhbGxiYWNrOw0KDQogICAgICAgIHB1YmxpYyBib29sIGJFcnJvckNhbGxiYWNrOw0KICAgICAgICBwdWJsaWMgaW50IGVycm9yQ291bnQ7DQogICAgICAgIHB1YmxpYyBpbnQgd2FybmluZ0NvdW50Ow0KICAgICAgICBwdWJsaWMgYm9vbCBXYXJuaW5nSW5uZXJFeGNlcHRpb25TZXQgPSBmYWxzZTsNCiAgICAgICAgcHVibGljIGJvb2wgRXJyb3JJbm5lckV4Y2VwdGlvblNldCA9IGZhbHNlOw0KDQogICAgICAgIHB1YmxpYyB2b2lkIEluaXRpYWxpemUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBiV2FybmluZ0NhbGxiYWNrID0gYkVycm9yQ2FsbGJhY2sgPSBmYWxzZTsNCiAgICAgICAgICAgIGVycm9yQ291bnQgPSB3YXJuaW5nQ291bnQgPSAwOw0KICAgICAgICAgICAgV2FybmluZ0lubmVyRXhjZXB0aW9uU2V0ID0gRXJyb3JJbm5lckV4Y2VwdGlvblNldCA9IGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9ob29rIHVwIHZhbGlkYXRvbiBjYWxsYmFjaw0KICAgICAgICBwdWJsaWMgdm9pZCBWYWxpZGF0aW9uQ2FsbGJhY2sob2JqZWN0IHNlbmRlciwgVmFsaWRhdGlvbkV2ZW50QXJncyBhcmdzKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoYXJncy5TZXZlcml0eSA9PSBYbWxTZXZlcml0eVR5cGUuV2FybmluZykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiV0FSTklORzogIik7DQogICAgICAgICAgICAgICAgYldhcm5pbmdDYWxsYmFjayA9IHRydWU7DQogICAgICAgICAgICAgICAgd2FybmluZ0NvdW50Kys7DQogICAgICAgICAgICAgICAgV2FybmluZ0lubmVyRXhjZXB0aW9uU2V0ID0gKGFyZ3MuRXhjZXB0aW9uLklubmVyRXhjZXB0aW9uICE9IG51bGwpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJcbklubmVyRXhjZXB0aW9uU2V0IDogIiArIFdhcm5pbmdJbm5lckV4Y2VwdGlvblNldCArICJcbiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoYXJncy5TZXZlcml0eSA9PSBYbWxTZXZlcml0eVR5cGUuRXJyb3IpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkVSUk9SOiAiKTsNCiAgICAgICAgICAgICAgICBiRXJyb3JDYWxsYmFjayA9IHRydWU7DQogICAgICAgICAgICAgICAgZXJyb3JDb3VudCsrOw0KICAgICAgICAgICAgICAgIEVycm9ySW5uZXJFeGNlcHRpb25TZXQgPSAoYXJncy5FeGNlcHRpb24uSW5uZXJFeGNlcHRpb24gIT0gbnVsbCk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlxuSW5uZXJFeGNlcHRpb25TZXQgOiAiICsgRXJyb3JJbm5lckV4Y2VwdGlvblNldCArICJcbiIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShhcmdzLk1lc3NhZ2UpOyAvLyBQcmludCB0aGUgZXJyb3IgdG8gdGhlIHNjcmVlbi4NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjEgLSBCdWcxMTA4MjMgLSBTY2hlbWFTZXQuQWRkIGlzIGhvbGRpbmcgb250byBzb21lIG9mIHRoZSBzY2hlbWEgZmlsZXMgYWZ0ZXIgYWRkaW5nIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgeHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgeHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICB1c2luZyAoWG1sVGV4dFJlYWRlciB4dHIgPSBuZXcgWG1sVGV4dFJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWcxMTA4MjMueHNkIikpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzcy5BZGQoWG1sU2NoZW1hLlJlYWQoeHRyLCBudWxsKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MiAtIEJ1ZzExNTA0OSAtIFhTRDogY29udGVudCBtb2RlbCB2YWxpZGF0aW9uIGZvciBhbiBpbnZhbGlkIHJvb3QgZWxlbWVudCBzaG91bGQgYmUgYWJhbmRvbmVkIiwgUHJpb3JpdHkgPSAyKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgc3MuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzExNTA0OS54c2QiKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIC8vY3JlYXRlIHJlYWRlcg0KICAgICAgICAgICAgWG1sUmVhZGVyU2V0dGluZ3Mgc2V0dGluZ3MgPSBuZXcgWG1sUmVhZGVyU2V0dGluZ3MoKTsNCiAgICAgICAgICAgIHNldHRpbmdzLlZhbGlkYXRpb25UeXBlID0gVmFsaWRhdGlvblR5cGUuU2NoZW1hOw0KICAgICAgICAgICAgc2V0dGluZ3MuVmFsaWRhdGlvbkZsYWdzIHw9IFhtbFNjaGVtYVZhbGlkYXRpb25GbGFncy5SZXBvcnRWYWxpZGF0aW9uV2FybmluZ3MgfA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hVmFsaWRhdGlvbkZsYWdzLlByb2Nlc3NTY2hlbWFMb2NhdGlvbiB8DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFWYWxpZGF0aW9uRmxhZ3MuUHJvY2Vzc0lubGluZVNjaGVtYTsNCiAgICAgICAgICAgIHNldHRpbmdzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNldHRpbmdzLlNjaGVtYXMuQWRkKHNzKTsNCiAgICAgICAgICAgIFhtbFJlYWRlciB2ciA9IFhtbFJlYWRlci5DcmVhdGUoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMTE1MDQ5LnhtbCIpLCBzZXR0aW5ncyk7DQogICAgICAgICAgICB3aGlsZSAodnIuUmVhZCgpKSA7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShlcnJvckNvdW50LCAxLCAiRXJyb3IgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2NCAtIDI0MzMwMCAtIFdlIGFyZSBub3QgY29ycmVjdGx5IGhhbmRsaW5nIHhzOmFueVR5cGUgYXMgeHNpOnR5cGUgaW4gdGhlIGluc3RhbmNlIiwgUHJpb3JpdHkgPSAyKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgeG1sID0gQCI8YSB4bWxuczp4c2k9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlJyB4bWxuczp4c2Q9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJyB4c2k6dHlwZT0neHNkOmFueVR5cGUnPjEyNDI8Yi8+PC9hPiI7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxSZWFkZXJTZXR0aW5ncyBzZXR0aW5ncyA9IG5ldyBYbWxSZWFkZXJTZXR0aW5ncygpOw0KICAgICAgICAgICAgc2V0dGluZ3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNldHRpbmdzLlZhbGlkYXRpb25UeXBlID0gVmFsaWRhdGlvblR5cGUuU2NoZW1hOw0KICAgICAgICAgICAgc2V0dGluZ3MuVmFsaWRhdGlvbkZsYWdzIHw9IFhtbFNjaGVtYVZhbGlkYXRpb25GbGFncy5SZXBvcnRWYWxpZGF0aW9uV2FybmluZ3MgfA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hVmFsaWRhdGlvbkZsYWdzLlByb2Nlc3NTY2hlbWFMb2NhdGlvbiB8DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFWYWxpZGF0aW9uRmxhZ3MuUHJvY2Vzc0lubGluZVNjaGVtYTsNCiAgICAgICAgICAgIHNldHRpbmdzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIFhtbFJlYWRlciB2ciA9IFhtbFJlYWRlci5DcmVhdGUobmV3IFN0cmluZ1JlYWRlcih4bWwpLCBzZXR0aW5ncywgKHN0cmluZyludWxsKTsNCiAgICAgICAgICAgIHdoaWxlICh2ci5SZWFkKCkpIDsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDAsICJFcnJvciBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHdhcm5pbmdDb3VudCwgMSwgIldhcm5pbmcgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvKiBQYXJhbWV0ZXJzID0gZmlsZSBuYW1lICwgaXMgY3VzdG9tIHhtbCBuYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cyAqLw0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYyMCAtIERDUiAyNjQ5MDggLSBYU0Q6IFN1cHBvcnQgdXNlciBzcGVjaWZpZWQgc2NoZW1hIGZvciBodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cyIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzI2NDkwOF92MTAueHNkIiwgMiwgZmFsc2UgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWcyNjQ5MDhfdjEwLnhzZCIsIDIsIGZhbHNlKV0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjE5IC0gRENSIDI2NDkwOCAtIFhTRDogU3VwcG9ydCB1c2VyIHNwZWNpZmllZCBzY2hlbWEgZm9yIGh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMjY0OTA4X3Y5LnhzZCIsIDUsIHRydWUgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWcyNjQ5MDhfdjkueHNkIiwgNSwgdHJ1ZSldDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxOCAtIERDUiAyNjQ5MDggLSBYU0Q6IFN1cHBvcnQgdXNlciBzcGVjaWZpZWQgc2NoZW1hIGZvciBodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cyIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzI2NDkwOF92OC54c2QiLCA1LCBmYWxzZSB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzI2NDkwOF92OC54c2QiLCA1LCBmYWxzZSldDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxNyAtIERDUiAyNjQ5MDggLSBYU0Q6IFN1cHBvcnQgdXNlciBzcGVjaWZpZWQgc2NoZW1hIGZvciBodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cyIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzI2NDkwOF92Ny54c2QiLCA0LCBmYWxzZSB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzI2NDkwOF92Ny54c2QiLCA0LCBmYWxzZSldDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxNiAtIERDUiAyNjQ5MDggLSBYU0Q6IFN1cHBvcnQgdXNlciBzcGVjaWZpZWQgc2NoZW1hIGZvciBodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cyIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzI2NDkwOF92Ni54c2QiLCA0LCB0cnVlIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgiYnVnMjY0OTA4X3Y2LnhzZCIsIDQsIHRydWUpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTUgLSBEQ1IgMjY0OTA4IC0gWFNEOiBTdXBwb3J0IHVzZXIgc3BlY2lmaWVkIHNjaGVtYSBmb3IgaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIFN5c3RlbS5YbWwuVGVzdHMiLCBQcmlvcml0eSA9IDEsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJidWcyNjQ5MDhfdjUueHNkIiwgNCwgZmFsc2UgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWcyNjQ5MDhfdjUueHNkIiwgNCwgZmFsc2UpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTQgLSBEQ1IgMjY0OTA4IC0gWFNEOiBTdXBwb3J0IHVzZXIgc3BlY2lmaWVkIHNjaGVtYSBmb3IgaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIFN5c3RlbS5YbWwuVGVzdHMiLCBQcmlvcml0eSA9IDEsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJidWcyNjQ5MDhfdjQueHNkIiwgNCwgdHJ1ZSB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzI2NDkwOF92NC54c2QiLCA0LCB0cnVlKV0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjEzIC0gRENSIDI2NDkwOCAtIFhTRDogU3VwcG9ydCB1c2VyIHNwZWNpZmllZCBzY2hlbWEgZm9yIGh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMjY0OTA4X3YzLnhzZCIsIDEsIHRydWUgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWcyNjQ5MDhfdjMueHNkIiwgMSwgdHJ1ZSldDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMiAtIERDUiAyNjQ5MDggLSBYU0Q6IFN1cHBvcnQgdXNlciBzcGVjaWZpZWQgc2NoZW1hIGZvciBodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cyIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzI2NDkwOF92Mi54c2QiLCAxLCB0cnVlIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgiYnVnMjY0OTA4X3YyLnhzZCIsIDEsIHRydWUpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTEgLSBEQ1IgMjY0OTA4IC0gWFNEOiBTdXBwb3J0IHVzZXIgc3BlY2lmaWVkIHNjaGVtYSBmb3IgaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIFN5c3RlbS5YbWwuVGVzdHMiLCBQcmlvcml0eSA9IDEsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJidWcyNjQ5MDhfdjEueHNkIiwgMywgdHJ1ZSB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzI2NDkwOF92MS54c2QiLCAzLCB0cnVlKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjEwKG9iamVjdCBwYXJhbTAsIG9iamVjdCBwYXJhbTEsIG9iamVjdCBwYXJhbTIpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyB4bWxGaWxlID0gcGFyYW0wLlRvU3RyaW5nKCk7DQogICAgICAgICAgICBpbnQgY291bnQgPSAoaW50KXBhcmFtMTsNCiAgICAgICAgICAgIGJvb2wgY3VzdG9tID0gKGJvb2wpcGFyYW0yOw0KICAgICAgICAgICAgc3RyaW5nIGF0dE5hbWUgPSAiYmxhaCI7DQoNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzcy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCB4bWxGaWxlKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIC8vdGVzdCB0aGUgY291bnQNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNzLkNvdW50LCBjb3VudCwgIkNvdW50IG9mIFNjaGVtYVNldCBub3QgbWF0Y2hlZCEiKTsNCg0KICAgICAgICAgICAgLy9tYWtlIHN1cmUgdGhlIGNvcnJlY3Qgc2NoZW1hIGlzIGluIHRoZSBzZXQNCiAgICAgICAgICAgIGlmIChjdXN0b20pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoWG1sU2NoZW1hQXR0cmlidXRlIGEgaW4gc3MuR2xvYmFsQXR0cmlidXRlcy5WYWx1ZXMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoYS5RdWFsaWZpZWROYW1lLk5hbWUgPT0gYXR0TmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIxIC0gQnVnIDMxOTM0NiAtIENoYW1lbGVvbiBhZGQgb2YgYSBzY2hlbWEgaW50byB0aGUgeG1sIG5hbWVzcGFjZSIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYyMCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyB4bWxucyA9IEAiaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIjsNCiAgICAgICAgICAgIHN0cmluZyBhdHROYW1lID0gImJsYWgiOw0KDQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgc3MuQWRkKHhtbG5zLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWcyNjQ5MDhfdjExLnhzZCIpKTsNCiAgICAgICAgICAgIHNzLkNvbXBpbGUoKTsNCg0KICAgICAgICAgICAgLy90ZXN0IHRoZSBjb3VudA0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoc3MuQ291bnQsIDMsICJDb3VudCBvZiBTY2hlbWFTZXQgbm90IG1hdGNoZWQhIik7DQoNCiAgICAgICAgICAgIC8vbWFrZSBzdXJlIHRoZSBjb3JyZWN0IHNjaGVtYSBpcyBpbiB0aGUgc2V0DQoNCiAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYUF0dHJpYnV0ZSBhIGluIHNzLkdsb2JhbEF0dHJpYnV0ZXMuVmFsdWVzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChhLlF1YWxpZmllZE5hbWUuTmFtZSA9PSBhdHROYW1lKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MjIgLSBCdWcgMzM4MDM4IC0gQ29tcG9uZW50IHNob3VsZCBiZSBhZGRpdGl2ZSBpbnRvIHRoZSBYbWwgbmFtZXNwYWNlIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjIxKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHhtbG5zID0gQCJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiOw0KICAgICAgICAgICAgc3RyaW5nIGF0dE5hbWUgPSAiYmxhaDEiOw0KDQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgc3MuQWRkKHhtbG5zLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczMzgwMzhfdjEueHNkIikpOw0KICAgICAgICAgICAgc3MuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICAvL3Rlc3QgdGhlIGNvdW50DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShzcy5Db3VudCwgNCwgIkNvdW50IG9mIFNjaGVtYVNldCBub3QgbWF0Y2hlZCEiKTsNCg0KICAgICAgICAgICAgLy9tYWtlIHN1cmUgdGhlIGNvcnJlY3Qgc2NoZW1hIGlzIGluIHRoZSBzZXQNCg0KICAgICAgICAgICAgZm9yZWFjaCAoWG1sU2NoZW1hQXR0cmlidXRlIGEgaW4gc3MuR2xvYmFsQXR0cmlidXRlcy5WYWx1ZXMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGEuUXVhbGlmaWVkTmFtZS5OYW1lID09IGF0dE5hbWUpDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYyMyAtIEJ1ZyAzMzgwMzggLSBDb25mbGljdGluZyBjb21wb25lbnRzIGluIGN1c3RvbWUgeG1sIG5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzIGJlIGNhdWdodCIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYyMigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyB4bWxucyA9IEAiaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIjsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzcy5BZGQoeG1sbnMsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzMzODAzOF92Mi54c2QiKSk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNzLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxTY2hlbWFFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNzLkNvdW50LCA0LCAiQ291bnQgb2YgU2NoZW1hU2V0IG5vdCBtYXRjaGVkISIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjI0IC0gQnVnIDMzODAzOCAtIENoYW5nZSB0eXBlIG9mIHhtbDpsYW5nIHRvIGRlY2ltYWwgaW4gY3VzdG9tZSB4bWwgbmFtZXNwYWNlIFN5c3RlbS5YbWwuVGVzdHMiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MjQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgYXR0TmFtZSA9ICJsYW5nIjsNCiAgICAgICAgICAgIHN0cmluZyBuZXd0eXBlID0gImRlY2ltYWwiOw0KDQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzMzODAzOF92My54c2QiKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzM4MDM4X3YzYS54c2QiKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNzLkNvdW50LCA0LCAiQ291bnQgb2YgU2NoZW1hU2V0IG5vdCBtYXRjaGVkISIpOw0KDQogICAgICAgICAgICBmb3JlYWNoIChYbWxTY2hlbWFBdHRyaWJ1dGUgYSBpbiBzcy5HbG9iYWxBdHRyaWJ1dGVzLlZhbHVlcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoYS5RdWFsaWZpZWROYW1lLk5hbWUgPT0gYXR0TmFtZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGEuQXR0cmlidXRlU2NoZW1hVHlwZS5RdWFsaWZpZWROYW1lLk5hbWUsIG5ld3R5cGUsICJJbmNvcnJlY3QgdHlwZSBmb3IgeG1sOmxhbmciKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjI1IC0gQnVnIDMzODAzOCAtIENvbmZsaWN0aW5nIGRlZmluaXRpb25zIGZvciB4bWwgYXR0cmlidXRlcyBpbiB0d28gc2NoZW1hcyIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYyNSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzM4MDM4X3YzLnhzZCIpKTsNCiAgICAgICAgICAgIHNzLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczMzgwMzhfdjNhLnhzZCIpKTsNCiAgICAgICAgICAgIHNzLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczMzgwMzhfdjNiLnhzZCIpKTsNCiAgICAgICAgICAgICAgICBzcy5Db21waWxlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShzcy5Db3VudCwgNiwgIkNvdW50IG9mIFNjaGVtYVNldCBub3QgbWF0Y2hlZCEiKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYyNiAtIEJ1ZyAzMzgwMzggLSBDaGFuZ2UgdHlwZSBvZiB4bWw6bGFuZyB0byBkZWNpbWFsIGFuZCB4bWw6YmFzZSB0byBzaG9ydCBpbiB0d28gc3RlcHMiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MjYoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzMzODAzOF92My54c2QiKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzM4MDM4X3Y0YS54c2QiKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzM4MDM4X3Y0Yi54c2QiKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYUF0dHJpYnV0ZSBhIGluIHNzLkdsb2JhbEF0dHJpYnV0ZXMuVmFsdWVzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChhLlF1YWxpZmllZE5hbWUuTmFtZSA9PSAibGFuZyIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShhLkF0dHJpYnV0ZVNjaGVtYVR5cGUuUXVhbGlmaWVkTmFtZS5OYW1lLCAiZGVjaW1hbCIsICJJbmNvcnJlY3QgdHlwZSBmb3IgeG1sOmxhbmciKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGEuUXVhbGlmaWVkTmFtZS5OYW1lID09ICJiYXNlIikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGEuQXR0cmlidXRlU2NoZW1hVHlwZS5RdWFsaWZpZWROYW1lLk5hbWUsICJzaG9ydCIsICJJbmNvcnJlY3QgdHlwZSBmb3IgeG1sOmJhc2UiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNzLkNvdW50LCA2LCAiQ291bnQgb2YgU2NoZW1hU2V0IG5vdCBtYXRjaGVkISIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjI3IC0gQnVnIDMzODAzOCAtIEFkZCBuZXcgYXR0cmlidXRlcyB0byB0aGUgYWxyZWFkeSBwcmVzZW50IHhtbCBuYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cyIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYyNygpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzM4MDM4X3YzLnhzZCIpKTsNCiAgICAgICAgICAgIHNzLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczMzgwMzhfdjRhLnhzZCIpKTsNCiAgICAgICAgICAgIHNzLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczMzgwMzhfdjViLnhzZCIpKTsNCiAgICAgICAgICAgIHNzLkNvbXBpbGUoKTsNCg0KICAgICAgICAgICAgZm9yZWFjaCAoWG1sU2NoZW1hQXR0cmlidXRlIGEgaW4gc3MuR2xvYmFsQXR0cmlidXRlcy5WYWx1ZXMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGEuUXVhbGlmaWVkTmFtZS5OYW1lID09ICJibGFoIikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGEuQXR0cmlidXRlU2NoZW1hVHlwZS5RdWFsaWZpZWROYW1lLk5hbWUsICJpbnQiLCAiSW5jb3JyZWN0IHR5cGUgZm9yIHhtbDpsYW5nIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoc3MuQ291bnQsIDYsICJDb3VudCBvZiBTY2hlbWFTZXQgbm90IG1hdGNoZWQhIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MjggLSBCdWcgMzM4MDM4IC0gQWRkIG5ldyBhdHRyaWJ1dGVzIHRvIHRoZSBhbHJlYWR5IHByZXNlbnQgeG1sIG5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzLCByZW1vdmUgZGVmYXVsdCBucyBzY2hlbWEiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MjgoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgeG1sbnMgPSBAImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSI7DQogICAgICAgICAgICBYbWxTY2hlbWEgc2NoZW1hID0gbnVsbDsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczMzgwMzhfdjMueHNkIikpOw0KICAgICAgICAgICAgc3MuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICBmb3JlYWNoIChYbWxTY2hlbWEgcyBpbiBzcy5TY2hlbWFzKHhtbG5zKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzY2hlbWEgPSBzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzM4MDM4X3Y0YS54c2QiKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzM4MDM4X3Y1Yi54c2QiKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIHNzLlJlbW92ZShzY2hlbWEpOw0KICAgICAgICAgICAgc3MuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICBmb3JlYWNoIChYbWxTY2hlbWFBdHRyaWJ1dGUgYSBpbiBzcy5HbG9iYWxBdHRyaWJ1dGVzLlZhbHVlcykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoYS5RdWFsaWZpZWROYW1lLk5hbWUgPT0gImJsYWgiKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoYS5BdHRyaWJ1dGVTY2hlbWFUeXBlLlF1YWxpZmllZE5hbWUuTmFtZSwgImludCIsICJJbmNvcnJlY3QgdHlwZSBmb3IgeG1sOmxhbmciKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShzcy5Db3VudCwgNSwgIkNvdW50IG9mIFNjaGVtYVNldCBub3QgbWF0Y2hlZCEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vUmVncmVzc2lvbnMgLSBCdWcgRml4ZXMNCiAgICAgICAgcHVibGljIHZvaWQgQ2FsbGJhY2sxKG9iamVjdCBzZW5kZXIsIFZhbGlkYXRpb25FdmVudEFyZ3MgYXJncykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGFyZ3MuU2V2ZXJpdHkgPT0gWG1sU2V2ZXJpdHlUeXBlLldhcm5pbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIldBUk5JTkcgUmVjaWV2ZWQiKTsNCiAgICAgICAgICAgICAgICBiV2FybmluZ0NhbGxiYWNrID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB3YXJuaW5nQ291bnQrKzsNCiAgICAgICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShhcmdzLkV4Y2VwdGlvbi5Jbm5lckV4Y2VwdGlvbiA9PSBudWxsLCBmYWxzZSwgIklubmVyIEV4Y2VwdGlvbiBub3Qgc2V0Iik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTAwIC0gQnVnIDMyMDUwMiAtIFhtbFNjaGVtYVNldDogd2hpbGUgdGhyb3dpbmcgYSB3YXJuaW5nIGZvciBpbnZhbGlkIGV4dGVybmFscyB3ZSBkbyBub3Qgc2V0IHRoZSBpbm5lciBleGNlcHRpb24iLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTAwKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHhzZCA9IEAiPHhzOnNjaGVtYSB4bWxuczp4cz0naHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEnPjx4czppbmNsdWRlIHNjaGVtYUxvY2F0aW9uPSdib2d1cycvPjwveHM6c2NoZW1hPiI7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihDYWxsYmFjazEpOw0KICAgICAgICAgICAgc3MuQWRkKG51bGwsIG5ldyBYbWxUZXh0UmVhZGVyKG5ldyBTdHJpbmdSZWFkZXIoeHNkKSkpOw0KICAgICAgICAgICAgc3MuQ29tcGlsZSgpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAxLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMDEgLSBCdWcgMzM5NzA2IC0gWG1sU2NoZW1hU2V0OiBDb21waWxlIG9uIHRoZSBzZXQgZmFpbHMgd2hlbiBhIGNvbXBpbGVkIHNjaGVtYSBjb250YWluaW5nIG5vdGF0aW9uIGlzIGFscmVhZHkgcHJlc2VudCIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYxMDEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgeHNkMSA9IEAiPHhzOnNjaGVtYSB4bWxuczp4cz0naHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEnPjx4czpub3RhdGlvbiBuYW1lPSdhJyBwdWJsaWM9J2EnLz48L3hzOnNjaGVtYT4iOw0KICAgICAgICAgICAgc3RyaW5nIHhzZDIgPSBAIjx4czpzY2hlbWEgeG1sbnM6eHM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJz48eHM6ZWxlbWVudCBuYW1lPSdyb290Jy8+PC94czpzY2hlbWE+IjsNCg0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoQ2FsbGJhY2sxKTsNCiAgICAgICAgICAgIHNzLkFkZChudWxsLCBuZXcgWG1sVGV4dFJlYWRlcihuZXcgU3RyaW5nUmVhZGVyKHhzZDEpKSk7DQogICAgICAgICAgICBzcy5Db21waWxlKCk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgbmV3IFhtbFRleHRSZWFkZXIobmV3IFN0cmluZ1JlYWRlcih4c2QyKSkpOw0KICAgICAgICAgICAgc3MuQ29tcGlsZSgpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDAsICJFcnJvciBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMDIgLSBCdWcgMzM3ODUwIC0gWG1sU2NoZW1hU2V0OiBUeXBlIGFscmVhZHkgZGVjbGFyZWQgZXJyb3Igd2hlbiByZWRlZmluZWQgc2NoZW1hIGlzIGFkZGVkIHRvIHRoZSBzZXQgYmVmb3JlIHRoZSByZWRlZmluaW5nIHNjaGVtYS4iLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTAyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJzY2haMDEzYy54c2QiKSk7DQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAic2NoWjAxM2EueHNkIikpOw0KICAgICAgICAgICAgc3MuQ29tcGlsZSgpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDAsICJFcnJvciBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMDQgLSBDb2RlQ292ZXJhZ2UtIFhtbFNjaGVtYVNldDogYWRkIHByZWNvbXBpbGVkIHN1YnMgZ3JvdXBzLCBnbG9iYWwgZWxlbWVudHMsIGF0dHJpYnV0ZXMgYW5kIHR5cGVzIHRvIGFub3RoZXIgY29tcGlsZWQgU09NLiIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgZmFsc2UgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKGZhbHNlKV0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjEwMyAtIENvZGVDb3ZlcmFnZS0gWG1sU2NoZW1hU2V0OiBhZGQgcHJlY29tcGlsZWQgc3VicyBncm91cHMsIGdsb2JhbCBlbGVtZW50cywgYXR0cmlidXRlcyBhbmQgdHlwZXMgdG8gYW5vdGhlciBjb21waWxlZCBzZXQuIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyB0cnVlIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSh0cnVlKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjEwMyhvYmplY3QgcGFyYW0wKQ0KICAgICAgICB7DQogICAgICAgICAgICBib29sIGFkZHNldCA9IChib29sKXBhcmFtMDsNCg0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNzMSA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzMS5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MxLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNzMS5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiTWlzYzEwM194LnhzZCIpKTsNCiAgICAgICAgICAgIHNzMS5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNzMS5Db3VudCwgMSwgIlNjaGVtYSBTZXQgMSBDb3VudCBtaXNtYXRjaCEiKTsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNzMiA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzMi5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MyLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzID0gc3MyLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJNaXNjMTAzX2EueHNkIikpOw0KICAgICAgICAgICAgc3MyLkNvbXBpbGUoKTsNCg0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoc3MxLkNvdW50LCAxLCAiU2NoZW1hIFNldCAxIENvdW50IG1pc21hdGNoISIpOw0KDQogICAgICAgICAgICBpZiAoYWRkc2V0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNzMS5BZGQoc3MyKTsNCg0KICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNzMS5HbG9iYWxFbGVtZW50cy5Db3VudCwgNywgIlNjaGVtYSBTZXQgMSBHbG9iYWxFbGVtZW50cyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShzczEuR2xvYmFsQXR0cmlidXRlcy5Db3VudCwgMiwgIlNjaGVtYSBTZXQgMSBHbG9iYWxBdHRyaWJ1dGVzIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNzMS5HbG9iYWxUeXBlcy5Db3VudCwgNiwgIlNjaGVtYSBTZXQgMSBHbG9iYWxUeXBlcyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzczEuQWRkKHMpOw0KDQogICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoc3MxLkdsb2JhbEVsZW1lbnRzLkNvdW50LCAyLCAiU2NoZW1hIFNldCAxIEdsb2JhbEVsZW1lbnRzIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNzMS5HbG9iYWxBdHRyaWJ1dGVzLkNvdW50LCAwLCAiU2NoZW1hIFNldCAxIEdsb2JhbEF0dHJpYnV0ZXMgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoc3MxLkdsb2JhbFR5cGVzLkNvdW50LCAyLCAiU2NoZW1hIFNldCAxIEdsb2JhbFR5cGVzIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzczMgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzczMuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNzMy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICBzczMuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgIk1pc2MxMDNfYy54c2QiKSk7DQogICAgICAgICAgICBzczMuQ29tcGlsZSgpOw0KICAgICAgICAgICAgc3MxLkFkZChzczMpOw0KDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShzczEuR2xvYmFsRWxlbWVudHMuQ291bnQsIDgsICJTY2hlbWEgU2V0IDEgR2xvYmFsRWxlbWVudHMgQ291bnQgbWlzbWF0Y2ghIik7DQoNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMDMgLSBSZWZlcmVuY2UgdG8gYSBjb21wb25lbnQgZnJvbSBubyBuYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cyBhbiBleHBsaWNpdCBpbXBvcnQgb2Ygbm8gbmFtZXNwYWNlIFN5c3RlbS5YbWwuVGVzdHMgdGhyb3cgYSB2YWxpZGF0aW9uIHdhcm5pbmciLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTA1KCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjaGVtYVNldCA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNjaGVtYVNldC5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc2NoZW1hU2V0LlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNjaGVtYVNldC5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiTWlzYzEwNS54c2QiKSk7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDEsICJXYXJuaW5nIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIkVycm9yIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjEwNiAtIEFkZGluZyBhIGNvbXBpbGVkIFNvUyhzY2hlbWEgZm9yIHNjaGVtYSkgdG8gYSBzZXQgY2F1c2VzIHR5cGUgY29sbGlzaW9uIGVycm9yIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjEwNigpDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNzMSA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzMS5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MxLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHNldHRpbmdzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICBzZXR0aW5ncy5Qcm9oaWJpdER0ZCA9IGZhbHNlOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgWG1sUmVhZGVyIHIgPSBYbWxSZWFkZXIuQ3JlYXRlKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgIlhNTFNjaGVtYS54c2QiKSwgc2V0dGluZ3MpOw0KICAgICAgICAgICAgc3MxLkFkZChudWxsLCByKTsNCiAgICAgICAgICAgIHNzMS5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzcy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQoNCiAgICAgICAgICAgIGZvcmVhY2ggKFhtbFNjaGVtYSBzIGluIHNzMS5TY2hlbWFzKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3MuQWRkKHMpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzcy5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAieHNkYXV0aG9yLnhzZCIpKTsNCiAgICAgICAgICAgIHNzLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHdhcm5pbmdDb3VudCwgMCwgIldhcm5pbmcgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShlcnJvckNvdW50LCAwLCAiRXJyb3IgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTA3IC0gWHNkVmFsaWRhdGluZ1JlYWRlcjogSW5uZXJFeGNlcHRpb24gbm90IHNldCBvbiB2YWxpZGF0aW9uIHdhcm5pbmcgb2YgYSBzY2hlbWFMb2NhdGlvbiBub3QgbG9hZGVkLiIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYxMDcoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgc3RyWG1sID0gQCI8cm9vdCB4bWxuczp4c2k9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlJyB4c2k6c2NoZW1hTG9jYXRpb249J2EgYnVnMzU2NzExX2EueHNkJyB4bWxuczphPSdhJz48L3Jvb3Q+IjsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzY2hlbWFTZXQgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzY2hlbWFTZXQuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNjaGVtYVNldC5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICBzY2hlbWFTZXQuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzM1NjcxMV9yb290LnhzZCIpKTsNCg0KICAgICAgICAgICAgWG1sUmVhZGVyU2V0dGluZ3Mgc2V0dGluZ3MgPSBuZXcgWG1sUmVhZGVyU2V0dGluZ3MoKTsNCiAgICAgICAgICAgIHNldHRpbmdzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzZXR0aW5ncy5WYWxpZGF0aW9uRmxhZ3MgfD0gWG1sU2NoZW1hVmFsaWRhdGlvbkZsYWdzLlJlcG9ydFZhbGlkYXRpb25XYXJuaW5ncyB8IFhtbFNjaGVtYVZhbGlkYXRpb25GbGFncy5Qcm9jZXNzU2NoZW1hTG9jYXRpb247DQogICAgICAgICAgICBzZXR0aW5ncy5TY2hlbWFzLkFkZChzY2hlbWFTZXQpOw0KICAgICAgICAgICAgc2V0dGluZ3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgc2V0dGluZ3MuVmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5TY2hlbWE7DQogICAgICAgICAgICBYbWxSZWFkZXIgdnIgPSBYbWxSZWFkZXIuQ3JlYXRlKG5ldyBTdHJpbmdSZWFkZXIoc3RyWG1sKSwgc2V0dGluZ3MpOw0KDQogICAgICAgICAgICB3aGlsZSAodnIuUmVhZCgpKSA7DQoNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHdhcm5pbmdDb3VudCwgMSwgIldhcm5pbmcgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShXYXJuaW5nSW5uZXJFeGNlcHRpb25TZXQsIHRydWUsICJJbm5lciBFeGNlcHRpb24gbm90IHNldCEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMDggLSBYbWxTY2hlbWFTZXQuQWRkKCkgc2hvdWxkIG5vdCB0cnVzdCBjb21waWxlZCBzdGF0ZSBvZiB0aGUgc2NoZW1hIGJlaW5nIGFkZGVkIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjEwOCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBzdHJTY2hlbWExID0gQCINCjx4czpzY2hlbWEgdGFyZ2V0TmFtZXNwYWNlPSdodHRwOi8vYmFyJw0KICAgICAgICAgICB4bWxucz0naHR0cDovL2JhcicgeG1sbnM6eD0naHR0cDovL2ZvbycNCiAgICAgICAgICAgZWxlbWVudEZvcm1EZWZhdWx0PSdxdWFsaWZpZWQnDQogICAgICAgICAgIGF0dHJpYnV0ZUZvcm1EZWZhdWx0PSd1bnF1YWxpZmllZCcNCiAgICAgICAgICAgeG1sbnM6eHM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJz4NCiAgPHhzOmltcG9ydCBuYW1lc3BhY2U9J2h0dHA6Ly9mb28nLz4NCiAgPHhzOmVsZW1lbnQgbmFtZT0nYmFyJz4NCiAgICA8eHM6Y29tcGxleFR5cGU+DQogICAgICA8eHM6c2VxdWVuY2U+DQogICAgICAgIDx4czplbGVtZW50IHJlZj0neDpmb28nLz4NCiAgICAgIDwveHM6c2VxdWVuY2U+DQogICAgPC94czpjb21wbGV4VHlwZT4NCiAgPC94czplbGVtZW50Pg0KPC94czpzY2hlbWE+DQoiOw0KICAgICAgICAgICAgc3RyaW5nIHN0clNjaGVtYTIgPSBAIjx4czpzY2hlbWEgdGFyZ2V0TmFtZXNwYWNlPSdodHRwOi8vZm9vJw0KICAgICAgICAgICB4bWxucz0naHR0cDovL2ZvbycgeG1sbnM6eD0naHR0cDovL2JhcicNCiAgICAgICAgICAgZWxlbWVudEZvcm1EZWZhdWx0PSdxdWFsaWZpZWQnDQogICAgICAgICAgIGF0dHJpYnV0ZUZvcm1EZWZhdWx0PSd1bnF1YWxpZmllZCcNCiAgICAgICAgICAgeG1sbnM6eHM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJz4NCiAgPHhzOmltcG9ydCBuYW1lc3BhY2U9J2h0dHA6Ly9iYXInLz4NCiAgPHhzOmVsZW1lbnQgbmFtZT0nZm9vJz4NCiAgICA8eHM6Y29tcGxleFR5cGU+DQogICAgICA8eHM6c2VxdWVuY2U+DQogICAgICAgIDx4czplbGVtZW50IHJlZj0neDpiYXInLz4NCiAgICAgIDwveHM6c2VxdWVuY2U+DQogICAgPC94czpjb21wbGV4VHlwZT4NCiAgPC94czplbGVtZW50Pg0KPC94czpzY2hlbWE+IjsNCg0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNldCA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNldC5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgVmFsaWRhdGlvbkV2ZW50SGFuZGxlciBoYW5kbGVyID0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNldC5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IGhhbmRsZXI7DQogICAgICAgICAgICBYbWxTY2hlbWEgczEgPSBudWxsOw0KICAgICAgICAgICAgdXNpbmcgKFhtbFJlYWRlciByID0gWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKHN0clNjaGVtYTEpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzMSA9IFhtbFNjaGVtYS5SZWFkKHIsIGhhbmRsZXIpOw0KICAgICAgICAgICAgICAgIHNldC5BZGQoczEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0LkNvbXBpbGUoKTsNCg0KICAgICAgICAgICAgLy8gTm93IGxvYWQgc2V0IDINCiAgICAgICAgICAgIHNldCA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNldC5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICBYbWxTY2hlbWEgczIgPSBudWxsOw0KICAgICAgICAgICAgdXNpbmcgKFhtbFJlYWRlciByID0gWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKHN0clNjaGVtYTIpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzMiA9IFhtbFNjaGVtYS5SZWFkKHIsIGhhbmRsZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgWG1sU2NoZW1hSW1wb3J0IGltcG9ydCA9IChYbWxTY2hlbWFJbXBvcnQpczIuSW5jbHVkZXNbMF07DQogICAgICAgICAgICBpbXBvcnQuU2NoZW1hID0gczE7DQogICAgICAgICAgICBpbXBvcnQgPSAoWG1sU2NoZW1hSW1wb3J0KXMxLkluY2x1ZGVzWzBdOw0KICAgICAgICAgICAgaW1wb3J0LlNjaGVtYSA9IHMyOw0KICAgICAgICAgICAgc2V0LkFkZChzMSk7DQogICAgICAgICAgICBzZXQuUmVwcm9jZXNzKHMxKTsNCiAgICAgICAgICAgIHNldC5BZGQoczIpOw0KICAgICAgICAgICAgc2V0LlJlcHJvY2VzcyhzMik7DQogICAgICAgICAgICBzZXQuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICBzMiA9IG51bGw7DQogICAgICAgICAgICB1c2luZyAoWG1sUmVhZGVyIHIgPSBYbWxSZWFkZXIuQ3JlYXRlKG5ldyBTdHJpbmdSZWFkZXIoc3RyU2NoZW1hMikpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHMyID0gWG1sU2NoZW1hLlJlYWQociwgaGFuZGxlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXQgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzZXQuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgaW1wb3J0ID0gKFhtbFNjaGVtYUltcG9ydClzMi5JbmNsdWRlc1swXTsNCiAgICAgICAgICAgIGltcG9ydC5TY2hlbWEgPSBzMTsNCiAgICAgICAgICAgIGltcG9ydCA9IChYbWxTY2hlbWFJbXBvcnQpczEuSW5jbHVkZXNbMF07DQogICAgICAgICAgICBpbXBvcnQuU2NoZW1hID0gczI7DQogICAgICAgICAgICBzZXQuQWRkKHMxKTsNCiAgICAgICAgICAgIHNldC5SZXByb2Nlc3MoczEpOw0KICAgICAgICAgICAgc2V0LkFkZChzMik7DQogICAgICAgICAgICBzZXQuUmVwcm9jZXNzKHMyKTsNCiAgICAgICAgICAgIHNldC5Db21waWxlKCk7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDAsICJXYXJuaW5nIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMSwgIkVycm9yIENvdW50IG1pc21hdGNoIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTA5IC0gMzg2MjQzLCBBZGRpbmcgYSBjaGFtZWxlb24gc2NoZW1hIGFnc2luc3QgdG8gbm8gbmFtYWVzcGFjZSB0aHJvd3MgdW5leHBlY3RlZCB3YXJuaW5ncyIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYxMDkoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgc3MuQWRkKCJodHRwOi8vRW1wbG95ZWVUZXN0Lm9yZyIsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgIkVtcGxveWVlVHlwZXMueHNkIikpOw0KICAgICAgICAgICAgc3MuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgIkVtcGxveWVlVHlwZXMueHNkIikpOw0KDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDAsICJXYXJuaW5nIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIkVycm9yIENvdW50IG1pc21hdGNoISIpOw0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTEwIC0gMzg2MjQ2LCAgQXJndW1lbnRFeGNlcHRpb24gJ2l0ZW0gYXJsZWFkeSBhZGRlZCcgZXJyb3Igb24gYSBjaGFtZWxlb24gYWRkIGRvbmUgdHdpY2UiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTEwKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzMSA9IHNzLkFkZCgiaHR0cDovL0VtcGxveWVlVGVzdC5vcmciLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJFbXBsb3llZVR5cGVzLnhzZCIpKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzMiA9IHNzLkFkZCgiaHR0cDovL0VtcGxveWVlVGVzdC5vcmciLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJFbXBsb3llZVR5cGVzLnhzZCIpKTsNCg0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDAsICJFcnJvciBDb3VudCBtaXNtYXRjaCEiKTsNCg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjExMSAtIDM4MDgwNSwgIENoYW1lbGVvbiBpbmNsdWRlIGNvbXBpbGVkIGluIG9uZSBzZXQgYWRkZWQgdG8gYW5vdGhlciIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYxMTEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQoNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBuZXdTZXQgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBuZXdTZXQuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIG5ld1NldC5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICBYbWxTY2hlbWEgY2hhbWVsZW9uID0gbmV3U2V0LkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJFbXBsb3llZVR5cGVzLnhzZCIpKTsNCiAgICAgICAgICAgIG5ld1NldC5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKG5ld1NldC5HbG9iYWxUeXBlcy5Db3VudCwgMTAsICJHbG9iYWxUeXBlcyBjb3VudCBtaXNtYXRjaCEiKTsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc2MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNjLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNjLkFkZChjaGFtZWxlb24pOw0KICAgICAgICAgICAgc2MuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJhc2VFbXBsb3llZS54c2QiKSk7DQogICAgICAgICAgICBzYy5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHdhcm5pbmdDb3VudCwgMCwgIldhcm5pbmcgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShlcnJvckNvdW50LCAwLCAiRXJyb3IgQ291bnQgbWlzbWF0Y2ghIik7DQoNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMTIgLSAzODIwMzUsICBzY2hlbWEgc2V0IHRhYmxlcyBub3QgY2xlYXJlZCBhcyBleHBlY3RlZCBvbiByZXByb2Nlc3MiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTEyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KDQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2V0MiA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNldDIuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbGJhY2spOw0KICAgICAgICAgICAgWG1sU2NoZW1hIGluY2x1ZGVkU2NoZW1hID0gc2V0Mi5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzgyMDM1YTEueHNkIikpOw0KICAgICAgICAgICAgc2V0Mi5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzZXQgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzZXQuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNldC5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICBYbWxTY2hlbWEgbWFpblNjaGVtYSA9IHNldC5BZGQobnVsbCwgUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzgyMDM1YS54c2QiKSk7DQogICAgICAgICAgICBzZXQuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICBYbWxSZWFkZXIgciA9IFhtbFJlYWRlci5DcmVhdGUoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzgyMDM1YTEueHNkIikpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIHJlUGFyc2VkSW5jbHVkZSA9IFhtbFNjaGVtYS5SZWFkKHIsIG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjaykpOw0KDQogICAgICAgICAgICAoKFhtbFNjaGVtYUV4dGVybmFsKW1haW5TY2hlbWEuSW5jbHVkZXNbMF0pLlNjaGVtYSA9IHJlUGFyc2VkSW5jbHVkZTsNCiAgICAgICAgICAgIHNldC5SZXByb2Nlc3MobWFpblNjaGVtYSk7DQogICAgICAgICAgICBzZXQuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDAsICJXYXJuaW5nIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIkVycm9yIENvdW50IG1pc21hdGNoISIpOw0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTEzIC0gU2V0IElubmVyRXhjZXB0aW9uIG9uIFhtbFNjaGVtYVZhbGlkYXRpb25FeGNlcHRpb24gd2hpbGUgcGFyc2luZyB0eXBlZCB2YWx1ZXMiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTEzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHN0clhtbCA9IEAiPHJvb3QgeG1sbnM6eHNpPSdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZScgeG1sbnM6eHM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJyB4c2k6dHlwZT0neHM6aW50Jz5hPC9yb290PiI7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQoNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHNldHRpbmdzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQogICAgICAgICAgICBzZXR0aW5ncy5WYWxpZGF0aW9uRmxhZ3MgfD0gWG1sU2NoZW1hVmFsaWRhdGlvbkZsYWdzLlJlcG9ydFZhbGlkYXRpb25XYXJuaW5ncyB8IFhtbFNjaGVtYVZhbGlkYXRpb25GbGFncy5Qcm9jZXNzU2NoZW1hTG9jYXRpb247DQogICAgICAgICAgICBzZXR0aW5ncy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICBzZXR0aW5ncy5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLlNjaGVtYTsNCiAgICAgICAgICAgIFhtbFJlYWRlciB2ciA9IFhtbFJlYWRlci5DcmVhdGUobmV3IFN0cmluZ1JlYWRlcihzdHJYbWwpLCBzZXR0aW5ncyk7DQoNCiAgICAgICAgICAgIHdoaWxlICh2ci5SZWFkKCkpIDsNCg0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDEsICJFcnJvciBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKEVycm9ySW5uZXJFeGNlcHRpb25TZXQsIHRydWUsICJJbm5lciBFeGNlcHRpb24gbm90IHNldCEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMTQgLSBYbWxTY2hlbWFTZXQ6IElubmVyRXhjZXB0aW9uIG5vdCBzZXQgb24gcGFyc2UgZXJyb3JzIGR1cmluZyBzY2hlbWEgY29tcGlsYXRpb24iLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTE0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHN0clhzZCA9IEAiPHhzOnNjaGVtYSBlbGVtZW50Rm9ybURlZmF1bHQ9J3F1YWxpZmllZCcgeG1sbnM6eHM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJz4NCiA8eHM6ZWxlbWVudCBuYW1lPSdkYXRlJyB0eXBlPSdkYXRlJy8+DQogPHhzOnNpbXBsZVR5cGUgbmFtZT0nZGF0ZSc+DQogIDx4czpyZXN0cmljdGlvbiBiYXNlPSd4czppbnQnPg0KICAgPHhzOmVudW1lcmF0aW9uIHZhbHVlPSdhJy8+DQogIDwveHM6cmVzdHJpY3Rpb24+DQogPC94czpzaW1wbGVUeXBlPg0KPC94czpzY2hlbWE+IjsNCg0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiAgICAgICAgICAgIHNzLkFkZChYbWxTY2hlbWEuUmVhZChuZXcgU3RyaW5nUmVhZGVyKHN0clhzZCksIG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjaykpKTsNCg0KICAgICAgICAgICAgc3MuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDAsICJXYXJuaW5nIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMSwgIkVycm9yIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoRXJyb3JJbm5lckV4Y2VwdGlvblNldCwgdHJ1ZSwgIklubmVyIEV4Y2VwdGlvbiBub3Qgc2V0ISIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjExNiAtIDQwNTMyNyBOdWxsUmVmZXJlbmNlRXhjZXB0aW9ucyB3aGlsZSBhY2Nlc3Npbmcgb2Jzb2xldGUgcHJvcGVydGllcyBpbiB0aGUgU09NIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjExNigpDQogICAgICAgIHsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIFhtbFNjaGVtYUF0dHJpYnV0ZSBhdHRyaWJ1dGUgPSBuZXcgWG1sU2NoZW1hQXR0cmlidXRlKCk7DQogICAgICAgICAgICBPYmplY3QgYXR0cmlidXRlVHlwZSA9IGF0dHJpYnV0ZS5BdHRyaWJ1dGVUeXBlOw0KICAgICAgICAgICAgWG1sU2NoZW1hRWxlbWVudCBlbGVtZW50ID0gbmV3IFhtbFNjaGVtYUVsZW1lbnQoKTsNCiAgICAgICAgICAgIE9iamVjdCBlbGVtZW50VHlwZSA9IGVsZW1lbnQuRWxlbWVudFR5cGU7DQogICAgICAgICAgICBYbWxTY2hlbWFUeXBlIHNjaGVtYVR5cGUgPSBuZXcgWG1sU2NoZW1hVHlwZSgpOw0KICAgICAgICAgICAgT2JqZWN0IEJhc2VTY2hlbWFUeXBlID0gc2NoZW1hVHlwZS5CYXNlU2NoZW1hVHlwZTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMTcgLSAzOTg0NzQgSW5uZXJFeGNlcHRpb24gbm90IHNldCBvbiBYbWxTY2hlbWFFeGNlcHRpb24sIHdoZW4geHM6cGF0dGVybiBoYXMgYW4gaW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb24iLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTE3KCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHN0clhzZHYxMTcgPQ0KICAgICAgICAgICAgQCI8P3htbCB2ZXJzaW9uPScxLjAnIGVuY29kaW5nPSd1dGYtOCcgPz4NCiAgICAgICAgICAgICAgICAgIDx4czpzY2hlbWEgIHhtbG5zOnhzPSdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSc+DQogICAgICAgICAgICAgICAgICAgIDx4czplbGVtZW50IG5hbWU9J2RvYyc+DQogICAgICAgICAgICAgICAgICAgICAgPHhzOmNvbXBsZXhUeXBlPg0KICAgICAgICAgICAgICAgICAgICAgICAgIDx4czpzZXF1ZW5jZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHM6ZWxlbWVudCBuYW1lPSd2YWx1ZScgbWF4T2NjdXJzPSd1bmJvdW5kZWQnPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzOnNpbXBsZVR5cGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHM6cmVzdHJpY3Rpb24gYmFzZT0neHM6c3RyaW5nJz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4czpwYXR0ZXJuIHZhbHVlPScoP3I6Zm9vKScvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94czpyZXN0cmljdGlvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHM6c2ltcGxlVHlwZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgPC94czpzZXF1ZW5jZT4NCiAgICAgICAgICAgICAgICAgICAgICA8L3hzOmNvbXBsZXhUeXBlPg0KICAgICAgICAgICAgICAgICAgICA8L3hzOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgICA8L3hzOnNjaGVtYT4iOw0KDQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQoNCiAgICAgICAgICAgIHVzaW5nIChTdHJpbmdSZWFkZXIgcmVhZGVyID0gbmV3IFN0cmluZ1JlYWRlcihzdHJYc2R2MTE3KSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFTZXQgc3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICAgICAgc3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgICAgICBzcy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICAgICAgc3MuQWRkKFhtbFNjaGVtYS5SZWFkKHJlYWRlciwgVmFsaWRhdGlvbkNhbGxiYWNrKSk7DQogICAgICAgICAgICAgICAgc3MuQ29tcGlsZSgpOw0KICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKEVycm9ySW5uZXJFeGNlcHRpb25TZXQsIHRydWUsICJcbklubmVyIEV4Y2VwdGlvbiBub3Qgc2V0XG4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMTggLSA0MjQ5MDQgTm90IGdldHRpbmcgdW5oYW5kbGVkIGF0dHJpYnV0ZXMgb24gcGFydGljbGUiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTE4KCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKFhtbFJlYWRlciByID0gbmV3IFhtbFRleHRSZWFkZXIoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiQnVnNDI0OTA0LnhzZCIpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWEgcyA9IFhtbFNjaGVtYS5SZWFkKHIsIG51bGwpOw0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzZXQgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICAgICAgc2V0LlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICAgICAgc2V0LkFkZChzKTsNCiAgICAgICAgICAgICAgICBzZXQuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICAgICAgWG1sUXVhbGlmaWVkTmFtZSBuYW1lID0gbmV3IFhtbFF1YWxpZmllZE5hbWUoInRlc3QyIiwgImh0dHA6Ly9mb28iKTsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFDb21wbGV4VHlwZSB0ZXN0MnR5cGUgPSBzLlNjaGVtYVR5cGVzW25hbWVdIGFzIFhtbFNjaGVtYUNvbXBsZXhUeXBlOw0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYVBhcnRpY2xlIHAgPSB0ZXN0MnR5cGUuQ29udGVudFR5cGVQYXJ0aWNsZTsNCiAgICAgICAgICAgICAgICBYbWxBdHRyaWJ1dGVbXSBhdHQgPSBwLlVuaGFuZGxlZEF0dHJpYnV0ZXM7DQoNCiAgICAgICAgICAgICAgICBBc3NlcnQuRmFsc2UoYXR0ID09IG51bGwgfHwgYXR0Lkxlbmd0aCA8IDEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjEyMCAtIDM5NzYzMyBsaW5lIG51bWJlciBhbmQgcG9zaXRpb24gbm90IHNldCBvbiB0aGUgdmFsaWRhdGlvbiBlcnJvciBmb3IgYW4gaW52YWxpZCB4c2k6dHlwZSB2YWx1ZSIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYxMjAoKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoWG1sUmVhZGVyIHNjaGVtYVJlYWRlciA9IFhtbFJlYWRlci5DcmVhdGUoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiQnVnMzk3NjMzLnhzZCIpKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICAgICAgc2MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgICAgICBzYy5BZGQoIiIsIHNjaGVtYVJlYWRlcik7DQogICAgICAgICAgICAgICAgc2MuQ29tcGlsZSgpOw0KDQogICAgICAgICAgICAgICAgWG1sUmVhZGVyU2V0dGluZ3MgcmVhZGVyU2V0dGluZ3MgPSBuZXcgWG1sUmVhZGVyU2V0dGluZ3MoKTsNCiAgICAgICAgICAgICAgICByZWFkZXJTZXR0aW5ncy5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLlNjaGVtYTsNCiAgICAgICAgICAgICAgICByZWFkZXJTZXR0aW5ncy5TY2hlbWFzID0gc2M7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoWG1sUmVhZGVyIGRvY1ZhbGlkYXRpbmdSZWFkZXIgPSBYbWxSZWFkZXIuQ3JlYXRlKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgIkJ1ZzM5NzYzMy54bWwiKSwgcmVhZGVyU2V0dGluZ3MpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgWG1sRG9jdW1lbnQgZG9jID0gbmV3IFhtbERvY3VtZW50KCk7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBkb2MuTG9hZChkb2NWYWxpZGF0aW5nUmVhZGVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5WYWxpZGF0ZShudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hVmFsaWRhdGlvbkV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4LkxpbmVOdW1iZXIgPT0gMSAmJiBleC5MaW5lUG9zaXRpb24gPT0gMiAmJiAhU3RyaW5nLklzTnVsbE9yRW1wdHkoZXguU291cmNlVXJpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTIwYS5YbWxEb2N1bWVudC5Mb2FkIG5vbi12YWxpZGF0aW5nIHJlYWRlci5FeHBlY3QgSU9FLiIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTIwYSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHJlYWRlclNldHRpbmdzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQogICAgICAgICAgICByZWFkZXJTZXR0aW5ncy5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLlNjaGVtYTsNCiAgICAgICAgICAgIHVzaW5nIChYbWxSZWFkZXIgcmVhZGVyID0gWG1sUmVhZGVyLkNyZWF0ZShQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJCdWczOTc2MzMueG1sIiksIHJlYWRlclNldHRpbmdzKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxEb2N1bWVudCBkb2MgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGRvYy5Mb2FkKHJlYWRlcik7DQogICAgICAgICAgICAgICAgICAgIGRvYy5WYWxpZGF0ZShudWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFhtbFNjaGVtYVZhbGlkYXRpb25FeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShleC5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIjQ0NDE5NjogWG1sUmVhZGVyLk1vdmVUb05leHRBdHRyaWJ1dGUgcmV0dXJucyBpbmNvcnJlY3QgcmVzdWx0cyIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTI0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgc3RyaW5nIFhhbWxQcmVzZW50YXRpb25OYW1lc3BhY2UgPQ0KICAgICAgICAiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwvcHJlc2VudGF0aW9uIjsNCiAgICAgICAgICAgIHN0cmluZyBYYW1sVG9QYXJzZSA9DQogICAgICAgICI8cGZ4MDpEcmF3aW5nQnJ1c2ggVGlsZU1vZGU9XCJUaWxlXCIgVmlld2JveD1cImZvb2JhclwiIC8+IjsNCg0KICAgICAgICAgICAgc3RyaW5nIHhtbCA9DQogICAgICAgICIJPHhzOnNjaGVtYSAiICsNCiAgICAgICAgIgkJeG1sbnM9XCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dpbmZ4LzIwMDYveGFtbC9wcmVzZW50YXRpb25cIiIgKw0KICAgICAgICAiCQl4bWxuczp4cz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIiICsNCiAgICAgICAgIgkJdGFyZ2V0TmFtZXNwYWNlPVwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwvcHJlc2VudGF0aW9uXCIgIiArDQogICAgICAgICIJCWVsZW1lbnRGb3JtRGVmYXVsdD1cInF1YWxpZmllZFwiICIgKw0KICAgICAgICAiCQlhdHRyaWJ1dGVGb3JtRGVmYXVsdD1cInVucXVhbGlmaWVkXCIiICsNCiAgICAgICAgIgk+IiArDQogICAgICAgICIiICsNCiAgICAgICAgIgkJPHhzOmVsZW1lbnQgbmFtZT1cIkRyYXdpbmdCcnVzaFwiIHR5cGU9XCJEcmF3aW5nQnJ1c2hUeXBlXCIgLz4iICsNCiAgICAgICAgIiIgKw0KICAgICAgICAiCQk8eHM6Y29tcGxleFR5cGUgbmFtZT1cIkRyYXdpbmdCcnVzaFR5cGVcIj4iICsNCiAgICAgICAgIgkJCTx4czphdHRyaWJ1dGUgbmFtZT1cIlZpZXdib3hcIiB0eXBlPVwieHM6c3RyaW5nXCIgLz4iICsNCiAgICAgICAgIgkJCTx4czphdHRyaWJ1dGUgbmFtZT1cIlRpbGVNb2RlXCIgdHlwZT1cInhzOnN0cmluZ1wiIC8+IiArDQogICAgICAgICIJCTwveHM6Y29tcGxleFR5cGU+IiArDQogICAgICAgICIJPC94czpzY2hlbWE+IjsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYSA9IFhtbFNjaGVtYS5SZWFkKG5ldyBTdHJpbmdSZWFkZXIoeG1sKSwgbnVsbCk7DQogICAgICAgICAgICBzY2hlbWEuVGFyZ2V0TmFtZXNwYWNlID0gWGFtbFByZXNlbnRhdGlvbk5hbWVzcGFjZTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzY2hlbWFTZXQgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzY2hlbWFTZXQuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNjaGVtYVNldC5BZGQoc2NoZW1hKTsNCiAgICAgICAgICAgIHNjaGVtYVNldC5Db21waWxlKCk7DQoNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHJlYWRlclNldHRpbmdzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQogICAgICAgICAgICByZWFkZXJTZXR0aW5ncy5Db25mb3JtYW5jZUxldmVsID0gQ29uZm9ybWFuY2VMZXZlbC5GcmFnbWVudDsNCiAgICAgICAgICAgIHJlYWRlclNldHRpbmdzLlZhbGlkYXRpb25UeXBlID0gVmFsaWRhdGlvblR5cGUuU2NoZW1hOw0KICAgICAgICAgICAgcmVhZGVyU2V0dGluZ3MuU2NoZW1hcyA9IHNjaGVtYVNldDsNCg0KICAgICAgICAgICAgTmFtZVRhYmxlIG5hbWVUYWJsZSA9IG5ldyBOYW1lVGFibGUoKTsNCiAgICAgICAgICAgIFhtbE5hbWVzcGFjZU1hbmFnZXIgbmFtZXNwYWNlcyA9IG5ldyBYbWxOYW1lc3BhY2VNYW5hZ2VyKG5hbWVUYWJsZSk7DQogICAgICAgICAgICBuYW1lc3BhY2VzLkFkZE5hbWVzcGFjZSgicGZ4MCIsIFhhbWxQcmVzZW50YXRpb25OYW1lc3BhY2UpOw0KICAgICAgICAgICAgbmFtZXNwYWNlcy5BZGROYW1lc3BhY2Uoc3RyaW5nLkVtcHR5LCBYYW1sUHJlc2VudGF0aW9uTmFtZXNwYWNlKTsNCiAgICAgICAgICAgIFhtbFBhcnNlckNvbnRleHQgcGFyc2VyQ29udGV4dCA9IG5ldyBYbWxQYXJzZXJDb250ZXh0KG5hbWVUYWJsZSwgbmFtZXNwYWNlcywgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgWG1sU3BhY2UuTm9uZSk7DQoNCiAgICAgICAgICAgIHVzaW5nIChYbWxSZWFkZXIgeG1sUmVhZGVyID0gWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKFhhbWxUb1BhcnNlKSwgcmVhZGVyU2V0dGluZ3MsIHBhcnNlckNvbnRleHQpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhtbFJlYWRlci5SZWFkKCk7DQogICAgICAgICAgICAgICAgeG1sUmVhZGVyLk1vdmVUb0F0dHJpYnV0ZSgwKTsNCiAgICAgICAgICAgICAgICB4bWxSZWFkZXIuTW92ZVRvTmV4dEF0dHJpYnV0ZSgpOw0KICAgICAgICAgICAgICAgIHhtbFJlYWRlci5Nb3ZlVG9OZXh0QXR0cmlidXRlKCk7DQogICAgICAgICAgICAgICAgeG1sUmVhZGVyLk1vdmVUb05leHRBdHRyaWJ1dGUoKTsNCg0KICAgICAgICAgICAgICAgIHhtbFJlYWRlci5Nb3ZlVG9BdHRyaWJ1dGUoMCk7DQogICAgICAgICAgICAgICAgaWYgKHhtbFJlYWRlci5Nb3ZlVG9OZXh0QXR0cmlidXRlKCkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIjYxNTQ0NCBYbWxTY2hlbWEuV3JpdGUgKChYbWxXcml0ZXIpbnVsbCkgdGhyb3dzIEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24gaW5zdGVhZCBvZiBBcmd1bWVuTnVsbEV4Y2VwdGlvbiIpXQ0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgdjEyNSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYSB4cyA9IG5ldyBYbWxTY2hlbWEoKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzLldyaXRlKChYbWxXcml0ZXIpbnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbikgeyByZXR1cm47IH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIkRldjEwXzQwNTYxIFJlZGVmaW5lIENoYW1lbGVvbjogVW5leHBlY3RlZCBxdWFsaWZpZWQgbmFtZSBvbiBsb2NhbCBwYXJ0aWNsZSIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBEZXYxMF80MDU2MSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCiAgICAgICAgICAgIHN0cmluZyB4bWwgPSBAIjw/eG1sIHZlcnNpb249JzEuMCcgZW5jb2Rpbmc9J3V0Zi04Jz8+PGUxIHhtbG5zPSducy1hJz4gIDxjMjMgeG1sbnM9J25zLWInLz48L2UxPiI7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2V0ID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc2V0LlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzdHJpbmcgcGF0aCA9IFBhdGguQ29tYmluZShUZXN0RGF0YS5TdGFuZGFyZFBhdGgsICJ4c2QxMCIsICJTQ0hFTUEiLCAic2NoTjExX2EueHNkIik7DQogICAgICAgICAgICBzZXQuQWRkKG51bGwsIHBhdGgpOw0KICAgICAgICAgICAgc2V0LkNvbXBpbGUoKTsNCg0KICAgICAgICAgICAgWG1sUmVhZGVyU2V0dGluZ3Mgc2V0dGluZ3MgPSBuZXcgWG1sUmVhZGVyU2V0dGluZ3MoKTsNCiAgICAgICAgICAgIHNldHRpbmdzLlZhbGlkYXRpb25UeXBlID0gVmFsaWRhdGlvblR5cGUuU2NoZW1hOw0KICAgICAgICAgICAgc2V0dGluZ3MuU2NoZW1hcyA9IHNldDsNCg0KICAgICAgICAgICAgdXNpbmcgKFhtbFJlYWRlciByZWFkZXIgPSBYbWxSZWFkZXIuQ3JlYXRlKG5ldyBTdHJpbmdSZWFkZXIoeG1sKSwgc2V0dGluZ3MpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5SZWFkKCkpIDsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlhtbFNjaGVtYVZhbGlkYXRpb25FeGNlcHRpb24gd2FzIG5vdCB0aHJvd24iKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoWG1sU2NoZW1hVmFsaWRhdGlvbkV4Y2VwdGlvbiBlKSB7IF9vdXRwdXQuV3JpdGVMaW5lKGUuTWVzc2FnZSk7IH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHdhcm5pbmdDb3VudCwgMCwgIldhcm5pbmcgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShlcnJvckNvdW50LCAwLCAiRXJyb3IgQ291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyBUZXN0IGZhaWx1cmUgb24gSUxDOiBUZXN0IGRlcGVuZHMgb24gWG1sIFNlcmlhbGl6YXRpb24gYW5kIHJlcXVpcmVzIHJlZmxlY3Rpb24gb24gYSBMT1Qgb2YgdHlwZXMgdW5kZXIgU3lzdGVtLlhtbC5TY2hlbWEgbmFtZXNwYWNlLg0KICAgICAgICAvLyBSZC54bWwgd2l0aCAiPE5hbWVzcGFjZSBOYW1lPSJTeXN0ZW0uWG1sLlNjaGVtYSIgRHluYW1pYz0iUmVxdWlyZWQgUHVibGljIiAvPiIgbGV0cyB0aGlzIHRlc3QgcGFzcyBidXQgd2Ugc2hvdWxkIHByb2JhYmx5IGJlDQogICAgICAgIC8vIGZpeGluZyB1cCBYbWxTZXJpYWxpemVyJ3Mgb3duIHJkLnhtbCByYXRoZXIgdGhhbiB0aGUgdGVzdCBoZXJlLg0KICAgICAgICBbRmFjdF0NCiAgICAgICAgcHVibGljIHZvaWQgR2V0QnVpbHRpblNpbXBsZVR5cGVXb3Jrc0FzRWNwZWN0ZWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBzdHJpbmcgeG1sID0gIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi0xNlwiPz4iICsgRW52aXJvbm1lbnQuTmV3TGluZSArDQogIjx4czpzY2hlbWEgeG1sbnM6eHM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPiIgKyBFbnZpcm9ubWVudC5OZXdMaW5lICsNCiAiICA8eHM6c2ltcGxlVHlwZT4iICsgRW52aXJvbm1lbnQuTmV3TGluZSArDQogIiAgICA8eHM6cmVzdHJpY3Rpb24gYmFzZT1cInhzOmFueVNpbXBsZVR5cGVcIiAvPiIgKyBFbnZpcm9ubWVudC5OZXdMaW5lICsNCiAiICA8L3hzOnNpbXBsZVR5cGU+IiArIEVudmlyb25tZW50Lk5ld0xpbmUgKw0KICI8L3hzOnNjaGVtYT4iOw0KICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYSA9IG5ldyBYbWxTY2hlbWEoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNpbXBsZVR5cGUgc3RyaW5nVHlwZSA9IFhtbFNjaGVtYVR5cGUuR2V0QnVpbHRJblNpbXBsZVR5cGUoWG1sVHlwZUNvZGUuU3RyaW5nKTsNCiAgICAgICAgICAgIHNjaGVtYS5JdGVtcy5BZGQoc3RyaW5nVHlwZSk7DQogICAgICAgICAgICBTdHJpbmdXcml0ZXIgc3cgPSBuZXcgU3RyaW5nV3JpdGVyKCk7DQogICAgICAgICAgICBzY2hlbWEuV3JpdGUoc3cpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoc3cuVG9TdHJpbmcoKSwgeG1sLCAiTWlzbWF0Y2giKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIkRldjEwXzQwNTA5IEFzc2VydCBhbmQgTlJFIHdoZW4gdmFsaWRhdGUgdGhlIFhNTCBhZ2FpbnN0IHRoZSBYU0QiKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgRGV2MTBfNDA1MDkoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBzdHJpbmcgeG1sID0gUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnNTExMjE3LnhtbCIpOw0KICAgICAgICAgICAgc3RyaW5nIHhzZCA9IFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzUxMTIxNy54c2QiKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgWG1sUmVhZGVyIHIgPSBYbWxSZWFkZXIuQ3JlYXRlKHhzZCk7DQogICAgICAgICAgICBzLkFkZChudWxsLCByKTsNCiAgICAgICAgICAgIHMuQ29tcGlsZSgpOw0KICAgICAgICAgICAgWG1sUmVhZGVyU2V0dGluZ3MgcnMgPSBuZXcgWG1sUmVhZGVyU2V0dGluZ3MoKTsNCiAgICAgICAgICAgIHJzLlZhbGlkYXRpb25UeXBlID0gVmFsaWRhdGlvblR5cGUuU2NoZW1hOw0KICAgICAgICAgICAgdXNpbmcgKFhtbFJlYWRlciBkb2NWYWxpZGF0aW5nUmVhZGVyID0gWG1sUmVhZGVyLkNyZWF0ZSh4bWwsIHJzKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYbWxEb2N1bWVudCBkb2MgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICBkb2MuTG9hZChkb2NWYWxpZGF0aW5nUmVhZGVyKTsNCiAgICAgICAgICAgICAgICBkb2MuU2NoZW1hcyA9IHM7DQogICAgICAgICAgICAgICAgZG9jLlZhbGlkYXRlKG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDAsICJFcnJvciBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIkRldjEwXzQwNTExIFhtbFNjaGVtYVNldDo6Q29tcGlsZSB0aHJvd3MgWG1sU2NoZW1hRXhjZXB0aW9uIGZvciB2YWxpZCBzY2hlbWEiKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgRGV2MTBfNDA1MTEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBzdHJpbmcgeHNkID0gQCI8eHM6c2NoZW1hIHhtbG5zOnhzPSdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSc+DQo8eHM6c2ltcGxlVHlwZSBuYW1lPSd0ZXh0VHlwZSc+DQogICAgPHhzOnJlc3RyaWN0aW9uIGJhc2U9J3hzOnN0cmluZyc+DQogICAgICA8eHM6bWluTGVuZ3RoIHZhbHVlPScxJyAvPg0KICAgIDwveHM6cmVzdHJpY3Rpb24+DQogIDwveHM6c2ltcGxlVHlwZT4NCiAgPHhzOnNpbXBsZVR5cGUgbmFtZT0nc3RhdHVzQ29kZVR5cGUnPg0KICAgIDx4czpyZXN0cmljdGlvbiBiYXNlPSd0ZXh0VHlwZSc+DQogICAgICA8eHM6bGVuZ3RoIHZhbHVlPSc2JyAvPg0KICAgIDwveHM6cmVzdHJpY3Rpb24+DQogIDwveHM6c2ltcGxlVHlwZT4NCjwveHM6c2NoZW1hPiI7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzYy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc2MuQWRkKCJ4cyIsIFhtbFJlYWRlci5DcmVhdGUobmV3IFN0cmluZ1JlYWRlcih4c2QpKSk7DQogICAgICAgICAgICBzYy5Db21waWxlKCk7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDAsICJXYXJuaW5nIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIkVycm9yIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAiRGV2MTBfNDA0OTUgVW5kZWZpbmVkIENvbXBsZXhUeXBlIGVycm9yIHdoZW4gbG9hZGluZyBzY2hlbWFzIGZyb20gaW4gbWVtb3J5IHN0cmluZ3MiKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgRGV2MTBfNDA0OTUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBjb25zdCBzdHJpbmcgc2NoZW1hMVN0ciA9IEAiPHhzOnNjaGVtYSB4bWxuczp0bnM9IiJodHRwOi8vQml6VGFsa19TZXJ2ZXJfUHJvamVjdDIuU2NoZW1hMSIiIHhtbG5zOmI9IiJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL0JpelRhbGsvMjAwMyIiIGF0dHJpYnV0ZUZvcm1EZWZhdWx0PSIidW5xdWFsaWZpZWQiIiBlbGVtZW50Rm9ybURlZmF1bHQ9IiJxdWFsaWZpZWQiIiB0YXJnZXROYW1lc3BhY2U9IiJodHRwOi8vQml6VGFsa19TZXJ2ZXJfUHJvamVjdDIuU2NoZW1hMSIiIHhtbG5zOnhzPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPHhzOmluY2x1ZGUgc2NoZW1hTG9jYXRpb249IiJTMyIiIC8+DQogIDx4czppbmNsdWRlIHNjaGVtYUxvY2F0aW9uPSIiUzIiIiAvPg0KICA8eHM6ZWxlbWVudCBuYW1lPSIiUm9vdCIiPg0KICAgIDx4czpjb21wbGV4VHlwZT4NCiAgICAgIDx4czpzZXF1ZW5jZT4NCiAgICAgICAgPHhzOmVsZW1lbnQgbmFtZT0iIkZ4VHlwZUVsZW1lbnQiIj4NCiAgICAgICAgICA8eHM6Y29tcGxleFR5cGU+DQogICAgICAgICAgICA8eHM6Y29tcGxleENvbnRlbnQgbWl4ZWQ9IiJmYWxzZSIiPg0KICAgICAgICAgICAgICA8eHM6ZXh0ZW5zaW9uIGJhc2U9IiJ0bnM6RnhUeXBlIiI+DQogICAgICAgICAgICAgICAgPHhzOmF0dHJpYnV0ZSBuYW1lPSIiRmllbGQiIiB0eXBlPSIieHM6c3RyaW5nIiIgLz4NCiAgICAgICAgICAgICAgPC94czpleHRlbnNpb24+DQogICAgICAgICAgICA8L3hzOmNvbXBsZXhDb250ZW50Pg0KICAgICAgICAgIDwveHM6Y29tcGxleFR5cGU+DQogICAgICAgIDwveHM6ZWxlbWVudD4NCiAgICAgIDwveHM6c2VxdWVuY2U+DQogICAgPC94czpjb21wbGV4VHlwZT4NCiAgPC94czplbGVtZW50Pg0KPC94czpzY2hlbWE+IjsNCg0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIHNjaGVtYTJTdHIgPSBAIjx4czpzY2hlbWEgeG1sbnM6Yj0iImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vQml6VGFsay8yMDAzIiIgYXR0cmlidXRlRm9ybURlZmF1bHQ9IiJ1bnF1YWxpZmllZCIiIGVsZW1lbnRGb3JtRGVmYXVsdD0iInF1YWxpZmllZCIiIHhtbG5zOnhzPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPHhzOmNvbXBsZXhUeXBlIG5hbWU9IiJGeFR5cGUiIj4NCiAgICA8eHM6YXR0cmlidXRlIG5hbWU9IiJGeDIiIiB0eXBlPSIieHM6c3RyaW5nIiIgLz4NCiAgPC94czpjb21wbGV4VHlwZT4NCjwveHM6c2NoZW1hPiI7DQoNCiAgICAgICAgICAgIGNvbnN0IHN0cmluZyBzY2hlbWEzU3RyID0gQCI8eHM6c2NoZW1hIHhtbG5zOmI9IiJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL0JpelRhbGsvMjAwMyIiIGF0dHJpYnV0ZUZvcm1EZWZhdWx0PSIidW5xdWFsaWZpZWQiIiBlbGVtZW50Rm9ybURlZmF1bHQ9IiJxdWFsaWZpZWQiIiB4bWxuczp4cz0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDx4czpjb21wbGV4VHlwZSBuYW1lPSIiVGVzdFR5cGUiIj4NCiAgICA8eHM6YXR0cmlidXRlIG5hbWU9IiJGeDIiIiB0eXBlPSIieHM6c3RyaW5nIiIgLz4NCiAgPC94czpjb21wbGV4VHlwZT4NCjwveHM6c2NoZW1hPiI7DQogICAgICAgICAgICBYbWxTY2hlbWEgc2NoZW1hMSA9IFhtbFNjaGVtYS5SZWFkKG5ldyBTdHJpbmdSZWFkZXIoc2NoZW1hMVN0ciksIG51bGwpOw0KICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYTIgPSBYbWxTY2hlbWEuUmVhZChuZXcgU3RyaW5nUmVhZGVyKHNjaGVtYTJTdHIpLCBudWxsKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzY2hlbWEzID0gWG1sU2NoZW1hLlJlYWQobmV3IFN0cmluZ1JlYWRlcihzY2hlbWEzU3RyKSwgbnVsbCk7DQoNCiAgICAgICAgICAgIC8vc2NoZW1hMSBoYXMgc29tZSB4czppbmNsdWRlcyBpbiBpdC4gU2luY2UgYWxsIHNjaGVtYXMgYXJlIHN0cmluZyBiYXNlZCwgWG1sU2NoZW1hIG9uIGl0cyBvd24gY2Fubm90IGxvYWQgYXV0b21hdGljYWxseQ0KICAgICAgICAgICAgLy9sb2FkIHRoZXNlIGluY2x1ZGVkIHNjaGVtYXMuIFdlIHdpbGwgcmVzb2x2ZSB0aGVzZSBzY2hlbWEgbG9jYXRpb25zIHNjaGVtYTEgYW5kIG1ha2UgdGhlbSBwb2ludCB0byB0aGUgY29ycmVjdA0KICAgICAgICAgICAgLy9pbiBtZW1vcnkgWG1sU2NoZW1hIG9iamVjdHMNCiAgICAgICAgICAgICgoWG1sU2NoZW1hRXh0ZXJuYWwpc2NoZW1hMS5JbmNsdWRlc1swXSkuU2NoZW1hID0gc2NoZW1hMzsNCiAgICAgICAgICAgICgoWG1sU2NoZW1hRXh0ZXJuYWwpc2NoZW1hMS5JbmNsdWRlc1sxXSkuU2NoZW1hID0gc2NoZW1hMjsNCg0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjaGVtYVNldCA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNjaGVtYVNldC5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgc2NoZW1hU2V0LlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCg0KICAgICAgICAgICAgaWYgKHNjaGVtYVNldC5BZGQoc2NoZW1hMSkgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvL1RoaXMgY29tcGlsZSB3aWxsIGNvbXBsYWluIGFib3V0IFVuZGVmaW5lZCBjb21wbGV4IFR5cGUgdG5zOkZ4VHlwZSBhbmQgc2NoZW1hU2V0X1ZhbGlkYXRpb25FdmVudEhhbmRsZXIgd2lsbCBiZQ0KICAgICAgICAgICAgICAgIC8vY2FsbGVkIHdpdGggdGhpcyBlcnJvci4NCiAgICAgICAgICAgICAgICBzY2hlbWFTZXQuQ29tcGlsZSgpOw0KICAgICAgICAgICAgICAgIHNjaGVtYVNldC5SZXByb2Nlc3Moc2NoZW1hMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDAsICJXYXJuaW5nIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIkVycm9yIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAiRGV2MTBfNjQ3NjUgWG1sU2NoZW1hVmFsaWRhdGlvbkV4Y2VwdGlvbi5Tb3VyY2VPYmplY3QgaXMgYWx3YXlzIG51bGwgd2hlbiB1c2luZyBYUGF0aE5hdmlnYXRvci5DaGVja1ZhbGlkaXR5IG1ldGhvZCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBEZXYxMF82NDc2NSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCiAgICAgICAgICAgIHN0cmluZyB4c2QgPQ0KICAgICAgICAgICAgICAgICI8eHNkOnNjaGVtYSB4bWxuczp4c2Q9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJz4iICsNCiAgICAgICAgICAgICAgICAgICAgIjx4c2Q6ZWxlbWVudCBuYW1lPSdzb21lJz4iICsNCiAgICAgICAgICAgICAgICAgICAgIjwveHNkOmVsZW1lbnQ+IiArDQogICAgICAgICAgICAgICAgIjwveHNkOnNjaGVtYT4iOw0KICAgICAgICAgICAgc3RyaW5nIHhtbCA9ICI8cm9vdC8+IjsNCg0KICAgICAgICAgICAgWG1sRG9jdW1lbnQgZG9jID0gbmV3IFhtbERvY3VtZW50KCk7DQogICAgICAgICAgICBkb2MuTG9hZFhtbCh4bWwpOw0KICAgICAgICAgICAgVmFsaWRhdGVYUGF0aE5hdmlnYXRvcih4bWwsIENvbXBpbGVTY2hlbWFTZXQoeHNkKSk7DQoNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBWYWxpZGF0ZVhQYXRoTmF2aWdhdG9yKHN0cmluZyB4bWwsIFhtbFNjaGVtYVNldCBzY2hlbWFTZXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhQYXRoRG9jdW1lbnQgZG9jID0gbmV3IFhQYXRoRG9jdW1lbnQobmV3IFN0cmluZ1JlYWRlcih4bWwpKTsNCiAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIG5hdiA9IGRvYy5DcmVhdGVOYXZpZ2F0b3IoKTsNCiAgICAgICAgICAgIFZhbGlkYXRlWFBhdGhOYXZpZ2F0b3IobmF2LCBzY2hlbWFTZXQpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIFZhbGlkYXRlWFBhdGhOYXZpZ2F0b3IoWFBhdGhOYXZpZ2F0b3IgbmF2LCBYbWxTY2hlbWFTZXQgc2NoZW1hU2V0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShuYXYuQ2hlY2tWYWxpZGl0eShzY2hlbWFTZXQsIE9uVmFsaWRhdGlvbkV2ZW50KSA/ICJWYWxpZGF0aW9uIHN1Y2NlZWRlZC4iIDogIlZhbGlkYXRpb24gZmFpbGVkLiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxTY2hlbWFTZXQgQ29tcGlsZVNjaGVtYVNldChzdHJpbmcgeHNkKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2NoZW1hU2V0ID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc2NoZW1hU2V0LlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzY2hlbWFTZXQuQWRkKFhtbFNjaGVtYS5SZWFkKG5ldyBTdHJpbmdSZWFkZXIoeHNkKSwgT25WYWxpZGF0aW9uRXZlbnQpKTsNCiAgICAgICAgICAgIHNjaGVtYVNldC5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IE9uVmFsaWRhdGlvbkV2ZW50Ow0KICAgICAgICAgICAgc2NoZW1hU2V0LkNvbXBpbGUoKTsNCiAgICAgICAgICAgIHJldHVybiBzY2hlbWFTZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgT25WYWxpZGF0aW9uRXZlbnQob2JqZWN0IHNlbmRlciwgVmFsaWRhdGlvbkV2ZW50QXJncyBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFWYWxpZGF0aW9uRXhjZXB0aW9uIGV4Y2VwdGlvbiA9IGUuRXhjZXB0aW9uIGFzIFhtbFNjaGVtYVZhbGlkYXRpb25FeGNlcHRpb247DQoNCiAgICAgICAgICAgIGlmIChleGNlcHRpb24gPT0gbnVsbCB8fCBleGNlcHRpb24uU291cmNlT2JqZWN0ID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXhjZXB0aW9uICE9IG51bGwsICJleGNlcHRpb24gPT0gbnVsbCIpOw0KICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGV4Y2VwdGlvbi5Tb3VyY2VPYmplY3QgIT0gbnVsbCwgIlNvdXJjZU9iamVjdCA9PSBudWxsIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFQbGF0Zm9ybURldGVjdGlvbi5Jc05ldE5hdGl2ZSkgLy8gQ2Fubm90IGdldCBuYW1lcyBvZiBpbnRlcm5hbCBmcmFtZXdvcmsgdHlwZXMNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShleGNlcHRpb24uU291cmNlT2JqZWN0LkdldFR5cGUoKS5Ub1N0cmluZygpLCAiTVMuSW50ZXJuYWwuWG1sLkNhY2hlLlhQYXRoRG9jdW1lbnROYXZpZ2F0b3IiLCAiU291cmNlT2JqZWN0LkdldFR5cGUiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGM6ICIgKyBleGNlcHRpb24pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAiRGV2MTBfNDA1NjMgWG1sU2NoZW1hU2V0OiBBc3NlcnQgRmFpbHVyZSB3aXRoIENoayBCdWlsZC4iKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgRGV2MTBfNDA1NjMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBzdHJpbmcgeHNkID0NCiAgICAgICAgICAgICAgICAiPHhzZDpzY2hlbWEgeG1sbnM6eHNkPSdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSc+IiArDQogICAgICAgICAgICAgICAgICAgICI8eHNkOmVsZW1lbnQgbmFtZT0nc29tZSc+IiArDQogICAgICAgICAgICAgICAgICAgICI8L3hzZDplbGVtZW50PiIgKw0KICAgICAgICAgICAgICAgICI8L3hzZDpzY2hlbWE+IjsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzcy5BZGQoImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiwgWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKHhzZCkpKTsNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHJzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQogICAgICAgICAgICBycy5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLlNjaGVtYTsNCiAgICAgICAgICAgIHJzLlNjaGVtYXMgPSBzczsNCiAgICAgICAgICAgIHN0cmluZyBpbnB1dCA9ICI8cm9vdCB4bWw6c3BhY2U9J2RlZmF1bHQnLz4iOw0KICAgICAgICAgICAgdXNpbmcgKFhtbFJlYWRlciByMSA9IFhtbFJlYWRlci5DcmVhdGUobmV3IFN0cmluZ1JlYWRlcihpbnB1dCksIHJzKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1c2luZyAoWG1sUmVhZGVyIHIyID0gWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKGlucHV0KSwgcnMpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHIxLlJlYWQoKSkgOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAocjIuUmVhZCgpKSA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDAsICJFcnJvciBDb3VudCBtaXNtYXRjaCEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIlRGU180NzAwMjAgU2NoZW1hIHdpdGggc3Vic3RpdHV0aW9uIGdyb3VwcyBkb2VzIG5vdCB0aHJvdyB3aGVuIGNvbnRlbnQgbW9kZWwgaXMgYW1iaWd1b3VzIildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRGU180NzAwMjAoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBzdHJpbmcgeG1sID0gQCI8P3htbCB2ZXJzaW9uPScxLjAnIGVuY29kaW5nPSd1dGYtOCcgPz4NCiAgICAgICAgICAgIDxlMz4NCiAgICAgICAgICAgIDxlMj4xPC9lMj4NCiAgICAgICAgICAgIDxlMj4xPC9lMj4NCiAgICAgICAgICAgIDwvZTM+IjsNCg0KICAgICAgICAgICAgc3RyaW5nIHhzZCA9IEAiPHhzOnNjaGVtYSB4bWxuczp4cz0naHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEnIGVsZW1lbnRGb3JtRGVmYXVsdD0ncXVhbGlmaWVkJz4NCiAgICAgICAgICAgICAgPHhzOmVsZW1lbnQgbmFtZT0nZTEnIHR5cGU9J3hzOmludCcvPg0KICAgICAgICAgICAgICA8eHM6ZWxlbWVudCBuYW1lPSdlMicgdHlwZT0neHM6aW50JyBzdWJzdGl0dXRpb25Hcm91cD0nZTEnLz4NCiAgICAgICAgICAgICAgPHhzOmNvbXBsZXhUeXBlIG5hbWU9J3QzJz4NCiAgICAgICAgICAgICAgICA8eHM6c2VxdWVuY2U+DQogICAgICAgICAgICAgICAgICA8eHM6ZWxlbWVudCByZWY9J2UxJyBtaW5PY2N1cnM9JzAnIG1heE9jY3Vycz0nMScvPg0KICAgICAgICAgICAgICAgICAgPHhzOmVsZW1lbnQgbmFtZT0nZTInIHR5cGU9J3hzOmludCcgbWluT2NjdXJzPScwJyBtYXhPY2N1cnM9JzEnLz4NCiAgICAgICAgICAgICAgICA8L3hzOnNlcXVlbmNlPg0KICAgICAgICAgICAgICA8L3hzOmNvbXBsZXhUeXBlPg0KICAgICAgICAgICAgICA8eHM6ZWxlbWVudCBuYW1lPSdlMycgdHlwZT0ndDMnLz4NCiAgICAgICAgICAgIDwveHM6c2NoZW1hPiI7DQoNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzZXQgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzZXQuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNldC5BZGQobnVsbCwgWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKHhzZCkpKTsNCiAgICAgICAgICAgIFhtbERvY3VtZW50IGRvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICAgICAgZG9jLkxvYWRYbWwoeG1sKTsNCiAgICAgICAgICAgIGRvYy5TY2hlbWFzID0gc2V0Ow0KICAgICAgICAgICAgZG9jLlZhbGlkYXRlKFZhbGlkYXRpb25DYWxsYmFjayk7DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDAsICJXYXJuaW5nIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMSwgIkVycm9yIENvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_ProhibitDTD.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlhtbC5TY2hlbWE7DQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzDQp7DQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJUQ19TY2hlbWFTZXRfUHJvaGliaXREVEQiLCBEZXNjID0gIiIpXQ0KICAgIHB1YmxpYyBjbGFzcyBUQ19TY2hlbWFTZXRfUHJvaGliaXREVEQgOiBUQ19TY2hlbWFTZXRCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQoNCiAgICAgICAgcHVibGljIFRDX1NjaGVtYVNldF9Qcm9oaWJpdERURChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgYm9vbCBiV2FybmluZ0NhbGxiYWNrOw0KDQogICAgICAgIHB1YmxpYyBib29sIGJFcnJvckNhbGxiYWNrOw0KICAgICAgICBwdWJsaWMgaW50IGVycm9yQ291bnQ7DQogICAgICAgIHB1YmxpYyBpbnQgd2FybmluZ0NvdW50Ow0KDQogICAgICAgIHB1YmxpYyB2b2lkIEluaXRpYWxpemUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBiV2FybmluZ0NhbGxiYWNrID0gYkVycm9yQ2FsbGJhY2sgPSBmYWxzZTsNCiAgICAgICAgICAgIGVycm9yQ291bnQgPSB3YXJuaW5nQ291bnQgPSAwOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9ob29rIHVwIHZhbGlkYXRvbiBjYWxsYmFjaw0KICAgICAgICBwdWJsaWMgdm9pZCBWYWxpZGF0aW9uQ2FsbGJhY2sob2JqZWN0IHNlbmRlciwgVmFsaWRhdGlvbkV2ZW50QXJncyBhcmdzKQ0KICAgICAgICB7DQogICAgICAgICAgICBzd2l0Y2ggKGFyZ3MuU2V2ZXJpdHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYbWxTZXZlcml0eVR5cGUuV2FybmluZzoNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIldBUk5JTkc6ICIpOw0KICAgICAgICAgICAgICAgICAgICBiV2FybmluZ0NhbGxiYWNrID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgd2FybmluZ0NvdW50Kys7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxTZXZlcml0eVR5cGUuRXJyb3I6DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFUlJPUjogIik7DQogICAgICAgICAgICAgICAgICAgIGJFcnJvckNhbGxiYWNrID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JDb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBNZXNzYWdlOiIgKyBhcmdzLkV4Y2VwdGlvbi5NZXNzYWdlICsgIlxuIik7DQoNCiAgICAgICAgICAgIGlmIChhcmdzLkV4Y2VwdGlvbi5Jbm5lckV4Y2VwdGlvbiAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJJbm5lckV4Y2VwdGlvbiBNZXNzYWdlOiIgKyBhcmdzLkV4Y2VwdGlvbi5Jbm5lckV4Y2VwdGlvbi5NZXNzYWdlICsgIlxuIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIklubmVyIEV4Y2VwdGlvbiBpcyBOVUxMXG4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgWG1sUmVhZGVyU2V0dGluZ3MgR2V0U2V0dGluZ3MoYm9vbCBwcm9oaWJpdER0ZCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxSZWFkZXJTZXR0aW5ncw0KICAgICAgICAgICAgew0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgICAgIFByb2hpYml0RHRkID0gcHJvaGliaXREdGQsDQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICAgICAgWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgWG1sUmVhZGVyIENyZWF0ZVJlYWRlcihzdHJpbmcgeG1sRmlsZSwgYm9vbCBwcm9oaWJpdER0ZCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFhtbFJlYWRlci5DcmVhdGUoeG1sRmlsZSwgR2V0U2V0dGluZ3MocHJvaGliaXREdGQpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgWG1sUmVhZGVyIENyZWF0ZVJlYWRlcihzdHJpbmcgeG1sRmlsZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFhtbFJlYWRlci5DcmVhdGUoeG1sRmlsZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFhtbFJlYWRlciBDcmVhdGVSZWFkZXIoWG1sUmVhZGVyIHJlYWRlciwgYm9vbCBwcm9oaWJpdER0ZCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFhtbFJlYWRlci5DcmVhdGUocmVhZGVyLCBHZXRTZXR0aW5ncyhwcm9oaWJpdER0ZCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBYbWxSZWFkZXIgQ3JlYXRlUmVhZGVyKHN0cmluZyB4bWxGaWxlLCBYbWxTY2hlbWFTZXQgc3MsIGJvb2wgcHJvaGliaXREVEQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IEdldFNldHRpbmdzKHByb2hpYml0RFREKTsNCg0KICAgICAgICAgICAgc2V0dGluZ3MuU2NoZW1hcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNldHRpbmdzLlNjaGVtYXMuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHNldHRpbmdzLlNjaGVtYXMuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBWYWxpZGF0aW9uQ2FsbGJhY2s7DQogICAgICAgICAgICBzZXR0aW5ncy5TY2hlbWFzLkFkZChzcyk7DQogICAgICAgICAgICBzZXR0aW5ncy5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLlNjaGVtYTsNCiAgICAgICAgICAgIHNldHRpbmdzLlZhbGlkYXRpb25GbGFncyA9IFhtbFNjaGVtYVZhbGlkYXRpb25GbGFncy5SZXBvcnRWYWxpZGF0aW9uV2FybmluZ3MgfA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVZhbGlkYXRpb25GbGFncy5Qcm9jZXNzU2NoZW1hTG9jYXRpb24gfA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVZhbGlkYXRpb25GbGFncy5Qcm9jZXNzSWRlbnRpdHlDb25zdHJhaW50cyB8DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sU2NoZW1hVmFsaWRhdGlvbkZsYWdzLlByb2Nlc3NJbmxpbmVTY2hlbWE7DQoNCiAgICAgICAgICAgIHNldHRpbmdzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KDQogICAgICAgICAgICByZXR1cm4gWG1sUmVhZGVyLkNyZWF0ZSh4bWxGaWxlLCBzZXR0aW5ncyk7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIFhtbFJlYWRlciBDcmVhdGVSZWFkZXIoWG1sUmVhZGVyIHJlYWRlciwgWG1sU2NoZW1hU2V0IHNzLCBib29sIHByb2hpYml0RFREKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSBHZXRTZXR0aW5ncyhwcm9oaWJpdERURCk7DQoNCiAgICAgICAgICAgIHNldHRpbmdzLlNjaGVtYXMgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzZXR0aW5ncy5TY2hlbWFzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBzZXR0aW5ncy5TY2hlbWFzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KICAgICAgICAgICAgc2V0dGluZ3MuU2NoZW1hcy5BZGQoc3MpOw0KICAgICAgICAgICAgc2V0dGluZ3MuVmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5TY2hlbWE7DQogICAgICAgICAgICBzZXR0aW5ncy5WYWxpZGF0aW9uRmxhZ3MgPSBYbWxTY2hlbWFWYWxpZGF0aW9uRmxhZ3MuUmVwb3J0VmFsaWRhdGlvbldhcm5pbmdzIHwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFWYWxpZGF0aW9uRmxhZ3MuUHJvY2Vzc1NjaGVtYUxvY2F0aW9uIHwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxTY2hlbWFWYWxpZGF0aW9uRmxhZ3MuUHJvY2Vzc0lkZW50aXR5Q29uc3RyYWludHMgfA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFNjaGVtYVZhbGlkYXRpb25GbGFncy5Qcm9jZXNzSW5saW5lU2NoZW1hOw0KICAgICAgICAgICAgc2V0dGluZ3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBWYWxpZGF0aW9uQ2FsbGJhY2s7DQogICAgICAgICAgICByZXR1cm4gWG1sUmVhZGVyLkNyZWF0ZShyZWFkZXIsIHNldHRpbmdzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vVEVTVCBERUZBVUxUIFZBTFVFIEZPUiBTQ0hFTUEgQ09NUElMQVRJT04NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjEtIFRlc3QgRGVmYXVsdCB2YWx1ZSBvZiBQcm9oaWJpdERURCBmb3IgQWRkKFVSTCkgb2Ygc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgeHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgeHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczNTY3MTFfYS54c2QiKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZS5NZXNzYWdlLkNvbnRhaW5zKCJEVEQiKSwgdHJ1ZSwgIlNvbWUgb3RoZXIgZXJyb3IgdGhyb3duIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjItIFRlc3QgRGVmYXVsdCB2YWx1ZSBvZiBQcm9oaWJpdERURCBmb3IgQWRkKFhtbFJlYWRlcikgb2Ygc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgeHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgeHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KICAgICAgICAgICAgWG1sUmVhZGVyIHIgPSBDcmVhdGVSZWFkZXIoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzU2NzExX2EueHNkIikpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNzLkFkZChudWxsLCByKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShlLk1lc3NhZ2UuQ29udGFpbnMoIkRURCIpLCB0cnVlLCAiU29tZSBvdGhlciBlcnJvciB0aHJvd24iKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2My0gVGVzdCBEZWZhdWx0IHZhbHVlIG9mIFByb2hpYml0RFREIGZvciBBZGQoVVJMKSBjb250YWluaW5nIHhzOmltcG9ydCBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgeHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgeHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICB4c3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBWYWxpZGF0aW9uQ2FsbGJhY2s7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c3MuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzM1NjcxMS54c2QiKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsgLy9leHBlY3QgYSB2YWxpZGF0aW9uIHdhcm5pbmcgZm9yIHVucmVzb2x2YWJsZSBzY2hlbWEgbG9jYXRpb24NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHdhcm5pbmdDb3VudCwgMSwgIldhcm5pbmcgQ291bnQgbWlzbWF0Y2giKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInY0LSBUZXN0IERlZmF1bHQgdmFsdWUgb2YgUHJvaGliaXREVEQgZm9yIEFkZChYbWxSZWFkZXIpIGNvbnRhaW5pbmcgeHM6aW1wb3J0IGZvciBzY2VobWEgd2l0aCBEVEQiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2NCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCB4c3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICB4c3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHhzcy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IFZhbGlkYXRpb25DYWxsYmFjazsNCiAgICAgICAgICAgIFhtbFJlYWRlciByID0gQ3JlYXRlUmVhZGVyKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzM1NjcxMS54c2QiKSk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c3MuQWRkKG51bGwsIHIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7IC8vZXhwZWN0IGEgdmFsaWRhdGlvbiB3YXJuaW5nIGZvciB1bnJlc29sdmFibGUgc2NoZW1hIGxvY2F0aW9uDQogICAgICAgICAgICB9DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDEsICJXYXJuaW5nIENvdW50IG1pc21hdGNoIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2NS4yLSBUZXN0IERlZmF1bHQgdmFsdWUgb2YgUHJvaGliaXREVEQgZm9yIEFkZChUZXh0UmVhZGVyKSBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExX2EueHNkIiwgMCB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV9hLnhzZCIsIDApXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2NS4xLSBUZXN0IERlZmF1bHQgdmFsdWUgb2YgUHJvaGliaXREVEQgZm9yIEFkZChUZXh0UmVhZGVyKSB3aXRoIGFuIHhzOmltcG9ydCBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExLnhzZCIsIDAgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWczNTY3MTEueHNkIiwgMCldDQogICAgICAgIHB1YmxpYyB2b2lkIHY1KG9iamVjdCBwYXJhbTAsIG9iamVjdCBwYXJhbTEpDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCB4c3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICB4c3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHhzcy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IFZhbGlkYXRpb25DYWxsYmFjazsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzY2hlbWEgPSBYbWxTY2hlbWEuUmVhZChuZXcgU3RyZWFtUmVhZGVyKG5ldyBGaWxlU3RyZWFtKFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgcGFyYW0wLlRvU3RyaW5nKCkpLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQpKSwgVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIHNjaGVtYS5Db21waWxlKFZhbGlkYXRpb25DYWxsYmFjaywgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNzLkFkZChzY2hlbWEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7IC8vZXhwZWN0IGEgdmFsaWRhdGlvbiB3YXJuaW5nIGZvciB1bnJlc29sdmFibGUgc2NoZW1hIGxvY2F0aW9uDQogICAgICAgICAgICB9DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIChpbnQpcGFyYW0xLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIkVycm9yIENvdW50IG1pc21hdGNoIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2Ni4yLSBUZXN0IERlZmF1bHQgdmFsdWUgb2YgUHJvaGliaXREVEQgZm9yIEFkZChYbWxUZXh0UmVhZGVyKSBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExX2EueHNkIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV9hLnhzZCIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2Ni4xLSBUZXN0IERlZmF1bHQgdmFsdWUgb2YgUHJvaGliaXREVEQgZm9yIEFkZChYbWxUZXh0UmVhZGVyKSB3aXRoIGFuIHhzOmltcG9ydCBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExLnhzZCIgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWczNTY3MTEueHNkIildDQogICAgICAgIHB1YmxpYyB2b2lkIHY2KG9iamVjdCBwYXJhbTApDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCB4c3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICB4c3MuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIHhzcy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IFZhbGlkYXRpb25DYWxsYmFjazsNCiAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgWG1sVGV4dFJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIHBhcmFtMC5Ub1N0cmluZygpKSk7DQogICAgICAgICAgICByZWFkZXIuWG1sUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYSBzY2hlbWEgPSBYbWxTY2hlbWEuUmVhZChyZWFkZXIsIFZhbGlkYXRpb25DYWxsYmFjayk7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICBzY2hlbWEuQ29tcGlsZShWYWxpZGF0aW9uQ2FsbGJhY2spOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KDQogICAgICAgICAgICB4c3MuQWRkKHNjaGVtYSk7DQoNCiAgICAgICAgICAgIC8vIGV4cGVjdCBhIHZhbGlkYXRpb24gd2FybmluZyBmb3IgdW5yZXNvbHZhYmxlIHNjaGVtYSBsb2NhdGlvbg0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIkVycm9yIENvdW50IG1pc21hdGNoIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2Ny0gVGVzdCBEZWZhdWx0IHZhbHVlIG9mIFByb2hpYml0RFREIGZvciBBZGQoWG1sUmVhZGVyKSBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExX2EueHNkIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV9hLnhzZCIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2NyhvYmplY3QgcGFyYW0wKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFNjaGVtYSBzY2hlbWEgPSBYbWxTY2hlbWEuUmVhZChDcmVhdGVSZWFkZXIoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCBwYXJhbTAuVG9TdHJpbmcoKSkpLCBWYWxpZGF0aW9uQ2FsbGJhY2spOw0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgICAgIHNjaGVtYS5Db21waWxlKFZhbGlkYXRpb25DYWxsYmFjayk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZS5NZXNzYWdlLkNvbnRhaW5zKCJEVEQiKSwgdHJ1ZSwgIlNvbWUgb3RoZXIgZXJyb3IgdGhyb3duIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2OC0gVGVzdCBEZWZhdWx0IHZhbHVlIG9mIFByb2hpYml0RFREIGZvciBBZGQoWG1sUmVhZGVyKSB3aXRoIHhzOmltcG9ydCBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExLnhzZCIgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWczNTY3MTEueHNkIildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHY4KG9iamVjdCBwYXJhbTApDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYSA9IFhtbFNjaGVtYS5SZWFkKENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIHBhcmFtMC5Ub1N0cmluZygpKSksIFZhbGlkYXRpb25DYWxsYmFjayk7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgc2NoZW1hLkNvbXBpbGUoVmFsaWRhdGlvbkNhbGxiYWNrKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOyAvL2V4cGVjdCBhIHZhbGlkYXRpb24gd2FybmluZyBmb3IgdW5yZXNvbHZhYmxlIHNjaGVtYSBsb2NhdGlvbg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDAsICJXYXJuaW5nIENvdW50IG1pc21hdGNoIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1RFU1QgQ1VTVE9NIFZBTFVFIEZPUiBTQ0hFTUEgQ09NUElMQVRJT04NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjEwLjEtIFRlc3QgQ3VzdG9tIHZhbHVlIG9mIFByb2hpYml0RFREIGZvciBTY2hlbWFTZXQuQWRkKFhtbFJlYWRlcikgd2l0aCB4czppbXBvcnQgZm9yIHNjaGVtYSB3aXRoIERURCIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzM1NjcxMS54c2QiIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgiYnVnMzU2NzExLnhzZCIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MTAuMi0gVGVzdCBDdXN0b20gdmFsdWUgb2YgUHJvaGliaXREVEQgZm9yIFNjaGVtYVNldC5BZGQoWG1sUmVhZGVyKSBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExX2EueHNkIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV9hLnhzZCIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTAob2JqZWN0IHBhcmFtMCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHhzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHhzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgeHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KDQogICAgICAgICAgICBYbWxSZWFkZXIgciA9IENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIHBhcmFtMC5Ub1N0cmluZygpKSwgZmFsc2UpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNzLkFkZChudWxsLCByKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIldhcm5pbmcgQ291bnQgbWlzbWF0Y2giKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMS4yLSBUZXN0IEN1c3RvbSB2YWx1ZSBvZiBQcm9oaWJpdERURCBmb3IgWG1sU2NoZW1hLkFkZChYbWxSZWFkZXIpIGZvciBzY2hlbWEgd2l0aCBEVEQiLCBQcmlvcml0eSA9IDEsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJidWczNTY3MTFfYS54c2QiIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgiYnVnMzU2NzExX2EueHNkIildDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMS4xLSBUZXN0IEN1c3RvbSB2YWx1ZSBvZiBQcm9oaWJpdERURCBmb3IgWG1sU2NoZW1hLkFkZChYbWxSZWFkZXIpIHdpdGggYW4geHM6aW1wb3J0IGZvciBzY2hlbWEgd2l0aCBEVEQiLCBQcmlvcml0eSA9IDEsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJidWczNTY3MTEueHNkIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMS54c2QiKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjExKG9iamVjdCBwYXJhbTApDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sU2NoZW1hIHNjaGVtYSA9IFhtbFNjaGVtYS5SZWFkKENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIHBhcmFtMC5Ub1N0cmluZygpKSwgZmFsc2UpLCBWYWxpZGF0aW9uQ2FsbGJhY2spOw0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgICAgIHNjaGVtYS5Db21waWxlKFZhbGlkYXRpb25DYWxsYmFjayk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAwLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCIpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZXJyb3JDb3VudCwgMCwgIldhcm5pbmcgQ291bnQgbWlzbWF0Y2giKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMi0gVGVzdCB3aXRoIHVuZGVybHlpbmcgcmVhZGVyIHdpdGggUHJvaGliaXREVEQ9dHJ1ZSwgYW5kIG5ldyBTZXR0aW5nIHdpdGggVHJ1ZSBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExX2EueHNkIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV9hLnhzZCIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTIob2JqZWN0IHBhcmFtMCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHhzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHhzcy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IFZhbGlkYXRpb25DYWxsYmFjazsNCg0KICAgICAgICAgICAgWG1sUmVhZGVyIHIgPSBDcmVhdGVSZWFkZXIoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCBwYXJhbTAuVG9TdHJpbmcoKSksIGZhbHNlKTsNCiAgICAgICAgICAgIFhtbFJlYWRlciByMiA9IENyZWF0ZVJlYWRlcihyLCB0cnVlKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzcy5BZGQobnVsbCwgcjIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGUuTWVzc2FnZS5Db250YWlucygiRFREIiksIHRydWUsICJTb21lIG90aGVyIGVycm9yIHRocm93biIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYxMy0gVGVzdCB3aXRoIHVuZGVybHlpbmcgcmVhZGVyIHdpdGggUHJvaGliaXREVEQ9dHJ1ZSwgYW5kIG5ldyBTZXR0aW5nIHdpdGggVHJ1ZSBmb3IgYSBzY2hlbWEgd2l0aCB4czppbXBvcnQgZm9yIHNjaGVtYSB3aXRoIERURCIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzM1NjcxMS54c2QiIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgiYnVnMzU2NzExLnhzZCIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MTMob2JqZWN0IHBhcmFtMCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHhzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHhzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgeHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KDQogICAgICAgICAgICBYbWxSZWFkZXIgciA9IENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIHBhcmFtMC5Ub1N0cmluZygpKSwgZmFsc2UpOw0KICAgICAgICAgICAgWG1sUmVhZGVyIHIyID0gQ3JlYXRlUmVhZGVyKHIsIHRydWUpOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c3MuQWRkKG51bGwsIHIyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOyAvL2V4cGVjdCBhIHZhbGlkYXRpb24gd2FybmluZyBmb3IgdW5yZXNvbHZhYmxlIHNjaGVtYSBsb2NhdGlvbg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiQ291bnQ6ICIgKyB4c3MuQ291bnQpOw0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUod2FybmluZ0NvdW50LCAxLCAiV2FybmluZyBDb3VudCBtaXNtYXRjaCIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjE0IC0gU2NoZW1hU2V0LkFkZChYbWxSZWFkZXIpIHdpdGggcERURCBGYWxzZSAsdGhlbiBhIFNjaGVtYVNldC5BZGQoVVJMKSBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjE0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHhzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHhzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgeHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KDQogICAgICAgICAgICBYbWxSZWFkZXIgciA9IENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczNTY3MTEueHNkIiksIGZhbHNlKTsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNzLkFkZChudWxsLCByKTsNCiAgICAgICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh4c3MuQ291bnQsIDIsICJTY2hlbWFTZXQgY291bnQgbWlzbWF0Y2ghIik7DQogICAgICAgICAgICAgICAgeHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczNTY3MTFfYi54c2QiKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZS5NZXNzYWdlLkNvbnRhaW5zKCJEVEQiKSwgdHJ1ZSwgIlNvbWUgb3RoZXIgZXJyb3IgdGhyb3duIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjE1IC0gU2NoZW1hU2V0LkFkZChYbWxSZWFkZXIpIHdpdGggcERURCBUcnVlICx0aGVuIGEgU2NoZW1hU2V0LkFkZChYbWxSZWFkZXIpIHdpdGggcERURCBGYWxzZSB3aXRoIERURCIsIFByaW9yaXR5ID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYxNSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEluaXRpYWxpemUoKTsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCB4c3MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICB4c3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBWYWxpZGF0aW9uQ2FsbGJhY2s7DQoNCiAgICAgICAgICAgIFhtbFJlYWRlciByMSA9IENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczNTY3MTFfYS54c2QiKSk7DQogICAgICAgICAgICBYbWxSZWFkZXIgcjIgPSBDcmVhdGVSZWFkZXIoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCAiYnVnMzU2NzExX2IueHNkIiksIGZhbHNlKTsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNzLkFkZChudWxsLCByMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoZS5NZXNzYWdlLkNvbnRhaW5zKCJEVEQiKSwgdHJ1ZSwgIlNvbWUgb3RoZXIgZXJyb3IgdGhyb3duIik7DQogICAgICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoeHNzLkNvdW50LCAwLCAiU2NoZW1hU2V0IGNvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c3MuQWRkKG51bGwsIHIyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoeHNzLkNvdW50LCAxLCAiU2NoZW1hU2V0IGNvdW50IG1pc21hdGNoISIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9URVNUIERFRkFVTFQgVkFMVUUgRk9SIElOU1RBTkNFIFZBTElEQVRJT04NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIwLjEtIFRlc3QgRGVmYXVsdCB2YWx1ZSBvZiBQcm9oaWJpdERURCBmb3IgWE1MIGNvbnRhaW5pbmcgbm9OYW1lc3BhY2VTY2hlbWFMb2NhdGlvbiBmb3Igc2NoZW1hIHdoaWNoIGNvbnRhaW5zIHhzOmltcG9ydCBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExXzEueG1sIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV8xLnhtbCIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MjAuMi0gVGVzdCBEZWZhdWx0IHZhbHVlIG9mIFByb2hpYml0RFREIGZvciBYTUwgY29udGFpbmluZyBzY2hlbWFMb2NhdGlvbiBmb3Igc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExXzIueG1sIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV8yLnhtbCIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MjAuMy0gVGVzdCBEZWZhdWx0IHZhbHVlIG9mIFByb2hpYml0RFREIGZvciBYTUwgY29udGFpbmluZyBJbmxpbmUgc2NoZW1hIGNvbnRhaW5pbmcgeHM6aW1wb3J0IG9mIGEgc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExXzMueG1sIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV8zLnhtbCIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MjAuNC0gVGVzdCBEZWZhdWx0IHZhbHVlIG9mIFByb2hpYml0RFREIGZvciBYTUwgY29udGFpbmluZyBJbmxpbmUgc2NoZW1hIGNvbnRhaW5pbmcgeHM6aW1wb3J0IG9mIGEgc2NoZW1hIHdoaWNoIGhhcyBhIHhzOmltcG9ydCBvZiBzY2hlbWEgd2l0aCBEVEQiLCBQcmlvcml0eSA9IDEsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJidWczNTY3MTFfNC54bWwiIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgiYnVnMzU2NzExXzQueG1sIildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYyMChvYmplY3QgcGFyYW0wKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgeHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgeHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICB4c3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBWYWxpZGF0aW9uQ2FsbGJhY2s7DQogICAgICAgICAgICB4c3MuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzM1NjcxMV9yb290LnhzZCIpKTsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsIHBhcmFtMC5Ub1N0cmluZygpKSwgeHNzLCB0cnVlKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAocmVhZGVyLlJlYWQoKSkgOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZSh3YXJuaW5nQ291bnQsIDIsICJQcm9oaWJpdERURCBkaWQgbm90IHdvcmsgd2l0aCBzY2hlbWFMb2NhdGlvbiIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIxLSBVbmRlcmx5aW5nIFhtbFJlYWRlciB3aXRoIFByb2hpYml0RFREPUZhbHNlIGFuZCBDcmVhdGUgbmV3IFJlYWRlciB3aXRoIFByb2hpYml0RFREPVRydWUiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MjEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICB2YXIgeHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgeHNzLlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICB4c3MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBWYWxpZGF0aW9uQ2FsbGJhY2s7DQogICAgICAgICAgICB4c3MuQWRkKG51bGwsIFBhdGguQ29tYmluZShUZXN0RGF0YS5fUm9vdCwgImJ1ZzM1NjcxMV9yb290LnhzZCIpKTsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciByMSA9IENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczNTY3MTFfMS54bWwiKSwgZmFsc2UpKQ0KICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgcjIgPSBDcmVhdGVSZWFkZXIocjEsIHhzcywgdHJ1ZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAocjIuUmVhZCgpKSB7IH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHdhcm5pbmdDb3VudCwgMiwgIlByb2hpYml0RFREIGRpZCBub3Qgd29yayB3aXRoIHNjaGVtYUxvY2F0aW9uIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1RFU1QgQ1VTVE9NIFZBTFVFIEZPUiBJTlNUQU5DRSBWQUxJREFUSU9ODQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInYyMi4xLSBUZXN0IERlZmF1bHQgdmFsdWUgb2YgUHJvaGliaXREVEQgZm9yIFhNTCBjb250YWluaW5nIG5vTmFtZXNwYWNlU2NoZW1hTG9jYXRpb24gZm9yIHNjaGVtYSB3aGljaCBjb250YWlucyB4czppbXBvcnQgZm9yIHNjaGVtYSB3aXRoIERURCIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzM1NjcxMV8xLnhtbCIgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWczNTY3MTFfMS54bWwiKV0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIyLjItIFRlc3QgRGVmYXVsdCB2YWx1ZSBvZiBQcm9oaWJpdERURCBmb3IgWE1MIGNvbnRhaW5pbmcgc2NoZW1hTG9jYXRpb24gZm9yIHNjaGVtYSB3aXRoIERURCIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzM1NjcxMV8yLnhtbCIgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWczNTY3MTFfMi54bWwiKV0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIyLjMtIFRlc3QgRGVmYXVsdCB2YWx1ZSBvZiBQcm9oaWJpdERURCBmb3IgWE1MIGNvbnRhaW5pbmcgSW5saW5lIHNjaGVtYSBjb250YWluaW5nIHhzOmltcG9ydCBvZiBhIHNjaGVtYSB3aXRoIERURCIsIFByaW9yaXR5ID0gMSwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgImJ1ZzM1NjcxMV8zLnhtbCIgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJidWczNTY3MTFfMy54bWwiKV0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIyLjQtIFRlc3QgRGVmYXVsdCB2YWx1ZSBvZiBQcm9oaWJpdERURCBmb3IgWE1MIGNvbnRhaW5pbmcgSW5saW5lIHNjaGVtYSBjb250YWluaW5nIHhzOmltcG9ydCBvZiBhIHNjaGVtYSB3aGljaCBoYXMgYSB4czppbXBvcnQgb2Ygc2NoZW1hIHdpdGggRFREIiwgUHJpb3JpdHkgPSAxLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiYnVnMzU2NzExXzQueG1sIiB9KV0NCiAgICAgICAgW0lubGluZURhdGEoImJ1ZzM1NjcxMV80LnhtbCIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MjIob2JqZWN0IHBhcmFtMCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHhzcyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHhzcy5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgeHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KICAgICAgICAgICAgeHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczNTY3MTFfcm9vdC54c2QiKSk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFJlYWRlciByZWFkZXIgPSBDcmVhdGVSZWFkZXIoUGF0aC5Db21iaW5lKFRlc3REYXRhLl9Sb290LCBwYXJhbTAuVG9TdHJpbmcoKSksIHhzcywgZmFsc2UpOw0KICAgICAgICAgICAgICAgIHdoaWxlIChyZWFkZXIuUmVhZCgpKSA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDAsICJQcm9oaWJpdERURCBkaWQgbm90IHdvcmsgd2l0aCBzY2hlbWFMb2NhdGlvbiIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIzLSBVbmRlcmx5aW5nIFhtbFJlYWRlciB3aXRoIFByb2hpYml0RFREPVRydWUgYW5kIENyZWF0ZSBuZXcgUmVhZGVyIHdpdGggUHJvaGliaXREVEQ9RmFsc2UiLCBQcmlvcml0eSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2MjMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbml0aWFsaXplKCk7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgeHNzID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgeHNzLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gVmFsaWRhdGlvbkNhbGxiYWNrOw0KICAgICAgICAgICAgeHNzLkFkZChudWxsLCBQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczNTY3MTFfcm9vdC54c2QiKSk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFJlYWRlciByMSA9IENyZWF0ZVJlYWRlcihQYXRoLkNvbWJpbmUoVGVzdERhdGEuX1Jvb3QsICJidWczNTY3MTFfMS54bWwiKSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgWG1sUmVhZGVyIHIyID0gQ3JlYXRlUmVhZGVyKHIxLCB4c3MsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAocjIuUmVhZCgpKSA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKGVycm9yQ291bnQsIDAsICJQcm9oaWJpdERURCBkaWQgbm90IHdvcmsgd2l0aCBzY2hlbWFMb2NhdGlvbiIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_ValidationEventHandler.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zOw0KdXNpbmcgU3lzdGVtLlhtbC5TY2hlbWE7DQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzDQp7DQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJUQ19TY2hlbWFTZXRfVmFsaWRhdGlvbkV2ZW50SGFuZGxlciIsIERlc2MgPSAiIildDQogICAgcHVibGljIGNsYXNzIFRDX1NjaGVtYVNldF9WYWxpZGF0aW9uRXZlbnRIYW5kbGVyIDogVENfU2NoZW1hU2V0QmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KDQogICAgICAgIHB1YmxpYyBUQ19TY2hlbWFTZXRfVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KDQogICAgICAgIHByaXZhdGUgQXJyYXlMaXN0IF9WYWxpZGF0aW9uRXJyb3JzID0gbmV3IEFycmF5TGlzdCgpOw0KDQogICAgICAgIHB1YmxpYyB2b2lkIFZhbGlkYXRpb25DYWxsQmFjayhvYmplY3Qgc2VuZGVyLCBWYWxpZGF0aW9uRXZlbnRBcmdzIGFyZ3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCIqKip7MH0iLCBhcmdzLk1lc3NhZ2UpOw0KICAgICAgICAgICAgX1ZhbGlkYXRpb25FcnJvcnMuQWRkKGFyZ3MpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2MSAtIFZhbGlkYXRpb25FdmVudEhhbmRsZXIsIGFkZCBpbnZhbGlkIFhEUiBzY2hlbWEiKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzYy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsQmFjayk7DQogICAgICAgICAgICBfVmFsaWRhdGlvbkVycm9ycy5DbGVhcigpOw0KICAgICAgICAgICAgc2MuQWRkKCJ4ZHJlcnJvciIsIFRlc3REYXRhLl9YZHJFcnJvcik7DQoNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNjLkNvdW50LCAwLCAic2MgY291bnQiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKF9WYWxpZGF0aW9uRXJyb3JzLkNvdW50LCAxLCAiZXJyIGNvdW50Iik7DQoNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjIgLSBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyLCBhZGQgaW52YWxpZCBYU0Qgc2NoZW1hIiwgUHJpb3JpdHkgPSAwKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzYy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsQmFjayk7DQogICAgICAgICAgICBfVmFsaWRhdGlvbkVycm9ycy5DbGVhcigpOw0KICAgICAgICAgICAgc2MuQWRkKCJ4ZHJlcnJvciIsIFRlc3REYXRhLl9Yc2RFcnJvcik7DQoNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKHNjLkNvdW50LCAwLCAic2MgY291bnQiKTsNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKF9WYWxpZGF0aW9uRXJyb3JzLkNvdW50LCAxLCAiZXJyIGNvdW50Iik7DQoNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAidjMgLSBWYWxpZGF0aW9uRXZlbnRBcmdzIGFjY3VyYWN5IildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHYzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sU2NoZW1hU2V0IHNjID0gbmV3IFhtbFNjaGVtYVNldCgpOw0KICAgICAgICAgICAgc2MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbEJhY2spOw0KICAgICAgICAgICAgX1ZhbGlkYXRpb25FcnJvcnMuQ2xlYXIoKTsNCiAgICAgICAgICAgIHNjLkFkZCgieHNkZXJyb3IiLCBUZXN0RGF0YS5fWHNkRXJyb3IpOw0KICAgICAgICAgICAgc2MuQWRkKCJ4c2RlcnJvciIsIFRlc3REYXRhLl9Yc2RFcnJvcjIpOw0KDQogICAgICAgICAgICAvLyBzaG91bGQgb25seSBiZSBvbmUgZXJyb3IgYmVmb3JlIGNvbXBpbGUoKQ0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoX1ZhbGlkYXRpb25FcnJvcnMuQ291bnQsIDEsICJlcnIgY291bnQiKTsNCiAgICAgICAgICAgIHNjLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIC8vIHNob3VsZCBiZSB0d28gZXJyb3JzIGJlZm9yZSBjb21waWxlKCkNCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKF9WYWxpZGF0aW9uRXJyb3JzLkNvdW50LCAyLCAiZXJyIGNvdW50Iik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInY0IC0gQWRkKFhtbFNjaGVtYSkgYW5kIHZlcmlmeSBoYW5kbGVyIGlzIGNhbGxlZCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2NCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNjLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxCYWNrKTsNCiAgICAgICAgICAgIF9WYWxpZGF0aW9uRXJyb3JzLkNsZWFyKCk7DQogICAgICAgICAgICBzYy5BZGQoWG1sU2NoZW1hLlJlYWQobmV3IFhtbFRleHRSZWFkZXIoVGVzdERhdGEuX1hzZEVycm9yMiksIG51bGwpKTsNCg0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoc2MuQ291bnQsIDEsICJzYyBjb3VudCIpOw0KICAgICAgICAgICAgLy8gc2NoZW1hIHNob3VsZCBzdGlsbCBiZSBhZGRlZCBhbmQgdGhlIGVycm9yIGNvdW5kIHNob3VsZCBiZSAwDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShfVmFsaWRhdGlvbkVycm9ycy5Db3VudCwgMCwgImVyciBjb3VudCIpOw0KICAgICAgICAgICAgc2MuQ29tcGlsZSgpOw0KICAgICAgICAgICAgLy8gc2NoZW1hIHNob3VsZCBzdGlsbCBiZSBhZGRlZCBhbmQgdGhlIGVycm9yIGNvdW5kIHNob3VsZCBiZSAxDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShfVmFsaWRhdGlvbkVycm9ycy5Db3VudCwgMSwgImVyciBjb3VudCIpOw0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInY1IC0gQWRkKFhtbFNjaGVtYSkgYW5kIHZlcmlmeSBoYW5kbGVyIGlzIGNhbGxlZCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2NSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbFNjaGVtYVNldCBzYyA9IG5ldyBYbWxTY2hlbWFTZXQoKTsNCiAgICAgICAgICAgIHNjLlZhbGlkYXRpb25FdmVudEhhbmRsZXIgKz0gbmV3IFZhbGlkYXRpb25FdmVudEhhbmRsZXIoVmFsaWRhdGlvbkNhbGxCYWNrKTsNCiAgICAgICAgICAgIF9WYWxpZGF0aW9uRXJyb3JzLkNsZWFyKCk7DQogICAgICAgICAgICBzYy5BZGQoInhzZGVycm9yIiwgbmV3IFhtbFRleHRSZWFkZXIoVGVzdERhdGEuX1hzZEVycm9yMikpOw0KDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShzYy5Db3VudCwgMSwgInNjIGNvdW50Iik7DQoNCiAgICAgICAgICAgIC8vIHNjaGVtYSBzaG91bGQgc3RpbGwgYmUgYWRkZWQgYW5kIHRoZSBlcnJvciBjb3VuZCBzaG91bGQgYmUgMA0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoX1ZhbGlkYXRpb25FcnJvcnMuQ291bnQsIDAsICJlcnIgY291bnQiKTsNCiAgICAgICAgICAgIHNjLkNvbXBpbGUoKTsNCiAgICAgICAgICAgIC8vIHNjaGVtYSBzaG91bGQgc3RpbGwgYmUgYWRkZWQgYW5kIHRoZSBlcnJvciBjb3VuZCBzaG91bGQgYmUgMQ0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoX1ZhbGlkYXRpb25FcnJvcnMuQ291bnQsIDEsICJlcnIgY291bnQiKTsNCg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJ2NiAtIEFkZChVUkwpIGFuZCB2ZXJpZnkgaGFuZGxlciBpcyBjYWxsZWQiKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjYoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzYy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsQmFjayk7DQogICAgICAgICAgICBfVmFsaWRhdGlvbkVycm9ycy5DbGVhcigpOw0KICAgICAgICAgICAgc2MuQWRkKCJ4c2RlcnJvciIsIFRlc3REYXRhLl9Yc2RFcnJvcjIpOw0KDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShzYy5Db3VudCwgMSwgInNjIGNvdW50Iik7DQogICAgICAgICAgICAvLyBzY2hlbWEgc2hvdWxkIHN0aWxsIGJlIGFkZGVkIGFuZCB0aGUgZXJyb3IgY291bmQgc2hvdWxkIGJlIDANCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKF9WYWxpZGF0aW9uRXJyb3JzLkNvdW50LCAwLCAiZXJyIGNvdW50Iik7DQogICAgICAgICAgICBzYy5Db21waWxlKCk7DQogICAgICAgICAgICAvLyBzY2hlbWEgc2hvdWxkIHN0aWxsIGJlIGFkZGVkIGFuZCB0aGUgZXJyb3IgY291bmQgc2hvdWxkIGJlIDENCiAgICAgICAgICAgIENFcnJvci5Db21wYXJlKF9WYWxpZGF0aW9uRXJyb3JzLkNvdW50LCAxLCAiZXJyIGNvdW50Iik7DQoNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gInY3IC0gcmVtb3ZlIFZhbGlkYXRpb25FdmVudEhhbmRsZXIiKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdjcoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxTY2hlbWFTZXQgc2MgPSBuZXcgWG1sU2NoZW1hU2V0KCk7DQogICAgICAgICAgICBzYy5WYWxpZGF0aW9uRXZlbnRIYW5kbGVyICs9IG5ldyBWYWxpZGF0aW9uRXZlbnRIYW5kbGVyKFZhbGlkYXRpb25DYWxsQmFjayk7DQogICAgICAgICAgICBfVmFsaWRhdGlvbkVycm9ycy5DbGVhcigpOw0KICAgICAgICAgICAgc2MuQWRkKCJ4c2RlcnJvciIsIFRlc3REYXRhLl9Yc2RFcnJvcik7DQogICAgICAgICAgICBzYy5BZGQoInhzZGVycm9yIiwgVGVzdERhdGEuX1hzZEVycm9yMik7DQoNCiAgICAgICAgICAgIC8vIHNob3VsZCBvbmx5IGJlIG9uZSBlcnJvciBiZWZvcmUgY29tcGlsZSgpDQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShfVmFsaWRhdGlvbkVycm9ycy5Db3VudCwgMSwgImVyciBjb3VudCIpOw0KICAgICAgICAgICAgc2MuQ29tcGlsZSgpOw0KICAgICAgICAgICAgLy8gc2hvdWxkIGJlIHR3byBlcnJvcnMgYmVmb3JlIGNvbXBpbGUoKQ0KICAgICAgICAgICAgQ0Vycm9yLkNvbXBhcmUoX1ZhbGlkYXRpb25FcnJvcnMuQ291bnQsIDIsICJlcnIgY291bnQiKTsNCg0KICAgICAgICAgICAgc2MuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciAtPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcihWYWxpZGF0aW9uQ2FsbEJhY2spOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2MuQWRkKCJ4c2RlcnJvciIsIFRlc3REYXRhLl9Yc2RFcnJvcik7DQogICAgICAgICAgICAgICAgc2MuQWRkKCJ4c2RlcnJvciIsIFRlc3REYXRhLl9Yc2RFcnJvcjIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhtbFNjaGVtYUV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuTWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBDRXJyb3IuQ29tcGFyZShfVmFsaWRhdGlvbkVycm9ycy5Db3VudCwgMiwgImVyciBjb3VudCIpOw0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICB9DQp9"
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/XmlSerializer/XmlSerializerTests.RuntimeOnly.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFNlcmlhbGl6YXRpb25UeXBlczsNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkdsb2JhbGl6YXRpb247DQp1c2luZyBTeXN0ZW0uSU87DQp1c2luZyBTeXN0ZW0uTGlucTsNCnVzaW5nIFN5c3RlbS5SZWZsZWN0aW9uOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KdXNpbmcgU3lzdGVtLlhtbDsNCnVzaW5nIFN5c3RlbS5YbWwuTGlucTsNCnVzaW5nIFN5c3RlbS5YbWwuU2NoZW1hOw0KdXNpbmcgU3lzdGVtLlhtbC5TZXJpYWxpemF0aW9uOw0KdXNpbmcgWHVuaXQ7DQoNCnB1YmxpYyBzdGF0aWMgcGFydGlhbCBjbGFzcyBYbWxTZXJpYWxpemVyVGVzdHMNCnsNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0Jvb2xBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGJvb2w+KHRydWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8Ym9vbGVhbj50cnVlPC9ib29sZWFuPiIpLCB0cnVlKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGJvb2w+KGZhbHNlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGJvb2xlYW4+ZmFsc2U8L2Jvb2xlYW4+IiksIGZhbHNlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0J5dGVBcnJheUFzUm9vdCgpDQogICAgew0KICAgICAgICBBc3NlcnQuTnVsbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxieXRlW10+KG51bGwsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8YmFzZTY0QmluYXJ5IGQxcDE6bmlsPSIidHJ1ZSIiIHhtbG5zOmQxcDE9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIC8+IikpOw0KICAgICAgICBieXRlW10geCA9IG5ldyBieXRlW10geyAxLCAyIH07DQogICAgICAgIGJ5dGVbXSB5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8Ynl0ZVtdPih4LA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGJhc2U2NEJpbmFyeT5BUUk9PC9iYXNlNjRCaW5hcnk+Iik7DQogICAgICAgIEFzc2VydC5FcXVhbCh4LCB5KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0NoYXJBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGNoYXI+KGNoYXIuTWluVmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8Y2hhcj4wPC9jaGFyPiIpLCBjaGFyLk1pblZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGNoYXI+KGNoYXIuTWF4VmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8Y2hhcj42NTUzNTwvY2hhcj4iKSwgY2hhci5NYXhWYWx1ZSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxjaGFyPignYScsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8Y2hhcj45NzwvY2hhcj4iKSwgJ2EnKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGNoYXI+KCfDsScsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8Y2hhcj4yNDE8L2NoYXI+IiksICfDsScpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8Y2hhcj4oJ+a8oicsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8Y2hhcj4yODQ1MDwvY2hhcj4iKSwgJ+a8oicpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfQnl0ZUFzUm9vdCgpDQogICAgew0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8Ynl0ZT4oMTAsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8dW5zaWduZWRCeXRlPjEwPC91bnNpZ25lZEJ5dGU+IiksIDEwKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGJ5dGU+KGJ5dGUuTWluVmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8dW5zaWduZWRCeXRlPjA8L3Vuc2lnbmVkQnl0ZT4iKSwgYnl0ZS5NaW5WYWx1ZSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxieXRlPihieXRlLk1heFZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPHVuc2lnbmVkQnl0ZT4yNTU8L3Vuc2lnbmVkQnl0ZT4iKSwgYnl0ZS5NYXhWYWx1ZSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9EYXRlVGltZUFzUm9vdCgpDQogICAgew0KICAgICAgICAvLyBBc3N1bWUgdGhhdCBVVEMgb2Zmc2V0IGRvZXNuJ3QgY2hhbmdlIG1vcmUgb2Z0ZW4gdGhhbiBvbmNlIGluIHRoZSBkYXkgMjAxMy0wMS0wMg0KICAgICAgICAvLyBETyBOT1QgVVNFIFRpbWVab25lSW5mby5Mb2NhbC5CYXNlVXRjT2Zmc2V0ICENCiAgICAgICAgdmFyIG9mZnNldE1pbnV0ZXMgPSAoaW50KVRpbWVab25lSW5mby5Mb2NhbC5HZXRVdGNPZmZzZXQobmV3IERhdGVUaW1lKDIwMTMsIDEsIDIpKS5Ub3RhbE1pbnV0ZXM7DQogICAgICAgIHZhciB0aW1lWm9uZVN0cmluZyA9IHN0cmluZy5Gb3JtYXQoInswOis7LX17MX0iLCBvZmZzZXRNaW51dGVzLCBuZXcgVGltZVNwYW4oMCwgb2Zmc2V0TWludXRlcywgMCkuVG9TdHJpbmcoQCJoaFw6bW0iKSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxEYXRlVGltZT4obmV3IERhdGVUaW1lKDIwMTMsIDEsIDIpLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGRhdGVUaW1lPjIwMTMtMDEtMDJUMDA6MDA6MDA8L2RhdGVUaW1lPiIpLCBuZXcgRGF0ZVRpbWUoMjAxMywgMSwgMikpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8RGF0ZVRpbWU+KG5ldyBEYXRlVGltZSgyMDEzLCAxLCAyLCAzLCA0LCA1LCA2LCBEYXRlVGltZUtpbmQuTG9jYWwpLCBzdHJpbmcuRm9ybWF0KEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxkYXRlVGltZT4yMDEzLTAxLTAyVDAzOjA0OjA1LjAwNnswfTwvZGF0ZVRpbWU+IiwgdGltZVpvbmVTdHJpbmcpKSwgbmV3IERhdGVUaW1lKDIwMTMsIDEsIDIsIDMsIDQsIDUsIDYsIERhdGVUaW1lS2luZC5Mb2NhbCkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8RGF0ZVRpbWU+KG5ldyBEYXRlVGltZSgyMDEzLCAxLCAyLCAzLCA0LCA1LCA2LCBEYXRlVGltZUtpbmQuVW5zcGVjaWZpZWQpLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGRhdGVUaW1lPjIwMTMtMDEtMDJUMDM6MDQ6MDUuMDA2PC9kYXRlVGltZT4iKSwgbmV3IERhdGVUaW1lKDIwMTMsIDEsIDIsIDMsIDQsIDUsIDYsIERhdGVUaW1lS2luZC5VbnNwZWNpZmllZCkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8RGF0ZVRpbWU+KG5ldyBEYXRlVGltZSgyMDEzLCAxLCAyLCAzLCA0LCA1LCA2LCBEYXRlVGltZUtpbmQuVXRjKSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxkYXRlVGltZT4yMDEzLTAxLTAyVDAzOjA0OjA1LjAwNlo8L2RhdGVUaW1lPiIpLCBuZXcgRGF0ZVRpbWUoMjAxMywgMSwgMiwgMywgNCwgNSwgNiwgRGF0ZVRpbWVLaW5kLlV0YykpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8RGF0ZVRpbWU+KERhdGVUaW1lLlNwZWNpZnlLaW5kKERhdGVUaW1lLk1pblZhbHVlLCBEYXRlVGltZUtpbmQuVXRjKSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxkYXRlVGltZT4wMDAxLTAxLTAxVDAwOjAwOjAwWjwvZGF0ZVRpbWU+IiksIERhdGVUaW1lLlNwZWNpZnlLaW5kKERhdGVUaW1lLk1pblZhbHVlLCBEYXRlVGltZUtpbmQuVXRjKSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxEYXRlVGltZT4oRGF0ZVRpbWUuU3BlY2lmeUtpbmQoRGF0ZVRpbWUuTWF4VmFsdWUsIERhdGVUaW1lS2luZC5VdGMpLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGRhdGVUaW1lPjk5OTktMTItMzFUMjM6NTk6NTkuOTk5OTk5OVo8L2RhdGVUaW1lPiIpLCBEYXRlVGltZS5TcGVjaWZ5S2luZChEYXRlVGltZS5NYXhWYWx1ZSwgRGF0ZVRpbWVLaW5kLlV0YykpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfRGVjaW1hbEFzUm9vdCgpDQogICAgew0KICAgICAgICBmb3JlYWNoIChkZWNpbWFsIHZhbHVlIGluIG5ldyBkZWNpbWFsW10geyAoZGVjaW1hbCktMS4yLCAoZGVjaW1hbCkwLCAoZGVjaW1hbCkyLjMsIGRlY2ltYWwuTWluVmFsdWUsIGRlY2ltYWwuTWF4VmFsdWUgfSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGRlY2ltYWw+KHZhbHVlLCBzdHJpbmcuRm9ybWF0KEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxkZWNpbWFsPnswfTwvZGVjaW1hbD4iLCB2YWx1ZS5Ub1N0cmluZyhDdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlKSkpLCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0RvdWJsZUFzUm9vdCgpDQogICAgew0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8ZG91YmxlPigtMS4yLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGRvdWJsZT4tMS4yPC9kb3VibGU+IiksIC0xLjIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8ZG91YmxlPigwLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGRvdWJsZT4wPC9kb3VibGU+IiksIDApOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8ZG91YmxlPigyLjMsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8ZG91YmxlPjIuMzwvZG91YmxlPiIpLCAyLjMpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8ZG91YmxlPihkb3VibGUuTWluVmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8ZG91YmxlPi0xLjc5NzY5MzEzNDg2MjMxNTdFKzMwODwvZG91YmxlPiIpLCBkb3VibGUuTWluVmFsdWUpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8ZG91YmxlPihkb3VibGUuTWF4VmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8ZG91YmxlPjEuNzk3NjkzMTM0ODYyMzE1N0UrMzA4PC9kb3VibGU+IiksIGRvdWJsZS5NYXhWYWx1ZSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9GbG9hdEFzUm9vdCgpDQogICAgew0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8ZmxvYXQ+KChmbG9hdCktMS4yLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGZsb2F0Pi0xLjI8L2Zsb2F0PiIpLCAoZmxvYXQpLTEuMik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxmbG9hdD4oKGZsb2F0KTAsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8ZmxvYXQ+MDwvZmxvYXQ+IiksIChmbG9hdCkwKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGZsb2F0PigoZmxvYXQpMi4zLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGZsb2F0PjIuMzwvZmxvYXQ+IiksIChmbG9hdCkyLjMpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8ZmxvYXQ+KGZsb2F0Lk1pblZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGZsb2F0Pi0zLjQwMjgyMzQ3RSszODwvZmxvYXQ+IiksIGZsb2F0Lk1pblZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPGZsb2F0PihmbG9hdC5NYXhWYWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxmbG9hdD4zLjQwMjgyMzQ3RSszODwvZmxvYXQ+IiksIGZsb2F0Lk1heFZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0d1aWRBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgWG1sX0d1aWRBc1Jvb3QobmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKEd1aWQpKSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBYbWxfR3VpZEFzUm9vdChYbWxTZXJpYWxpemVyIHNlcmlhbGl6ZXIpDQogICAgew0KICAgICAgICBmb3JlYWNoIChHdWlkIHZhbHVlIGluIG5ldyBHdWlkW10geyBHdWlkLk5ld0d1aWQoKSwgR3VpZC5FbXB0eSB9KQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8R3VpZD4odmFsdWUsIHN0cmluZy5Gb3JtYXQoQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGd1aWQ+ezB9PC9ndWlkPiIsIHZhbHVlLlRvU3RyaW5nKCkpKSwgdmFsdWUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9JbnRBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgZm9yZWFjaCAoaW50IHZhbHVlIGluIG5ldyBpbnRbXSB7IC0xLCAwLCAyLCBpbnQuTWluVmFsdWUsIGludC5NYXhWYWx1ZSB9KQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8aW50Pih2YWx1ZSwgc3RyaW5nLkZvcm1hdChAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8aW50PnswfTwvaW50PiIsIHZhbHVlKSksIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfTG9uZ0FzUm9vdCgpDQogICAgew0KICAgICAgICBmb3JlYWNoIChsb25nIHZhbHVlIGluIG5ldyBsb25nW10geyAobG9uZyktMSwgKGxvbmcpMCwgKGxvbmcpMiwgbG9uZy5NaW5WYWx1ZSwgbG9uZy5NYXhWYWx1ZSB9KQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8bG9uZz4odmFsdWUsIHN0cmluZy5Gb3JtYXQoQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGxvbmc+ezB9PC9sb25nPiIsIHZhbHVlKSksIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfT2JqZWN0QXNSb290KCkNCiAgICB7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxvYmplY3Q+KDEsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8YW55VHlwZSB4bWxuczpxMT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgZDFwMTp0eXBlPSIicTE6aW50IiIgeG1sbnM6ZDFwMT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiI+MTwvYW55VHlwZT4iKSwgMSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxvYmplY3Q+KHRydWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8YW55VHlwZSB4bWxuczpxMT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgZDFwMTp0eXBlPSIicTE6Ym9vbGVhbiIiIHhtbG5zOmQxcDE9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiPnRydWU8L2FueVR5cGU+IiksIHRydWUpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8b2JqZWN0PigiYWJjIiwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxhbnlUeXBlIHhtbG5zOnExPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIiBkMXAxOnR5cGU9IiJxMTpzdHJpbmciIiB4bWxuczpkMXAxPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIj5hYmM8L2FueVR5cGU+IiksICJhYmMiKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPG9iamVjdD4obnVsbCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz48YW55VHlwZSB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeHNpOm5pbD0iInRydWUiIiAvPiIpLCBudWxsKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1htbFF1YWxpZmllZE5hbWVBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFhtbFF1YWxpZmllZE5hbWU+KG5ldyBYbWxRdWFsaWZpZWROYW1lKCJhYmMiLCAiZGVmIiksDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8UU5hbWUgeG1sbnM6cTE9IiJkZWYiIj5xMTphYmM8L1FOYW1lPiIpLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgiYWJjIiwgImRlZiIpKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFhtbFF1YWxpZmllZE5hbWU+KFhtbFF1YWxpZmllZE5hbWUuRW1wdHksDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+PFFOYW1lIHhtbG5zPSIiIiIgLz4iKSwgWG1sUXVhbGlmaWVkTmFtZS5FbXB0eSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9TaG9ydEFzUm9vdCgpDQogICAgew0KICAgICAgICBmb3JlYWNoIChzaG9ydCB2YWx1ZSBpbiBuZXcgc2hvcnRbXSB7IChzaG9ydCktMS4yLCAoc2hvcnQpMCwgKHNob3J0KTIuMywgc2hvcnQuTWluVmFsdWUsIHNob3J0Lk1heFZhbHVlIH0pDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxzaG9ydD4odmFsdWUsIHN0cmluZy5Gb3JtYXQoQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPHNob3J0PnswfTwvc2hvcnQ+IiwgdmFsdWUpKSwgdmFsdWUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9TYnl0ZUFzUm9vdCgpDQogICAgew0KICAgICAgICBmb3JlYWNoIChzYnl0ZSB2YWx1ZSBpbiBuZXcgc2J5dGVbXSB7IChzYnl0ZSkzLCAoc2J5dGUpMCwgc2J5dGUuTWluVmFsdWUsIHNieXRlLk1heFZhbHVlIH0pDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxzYnl0ZT4odmFsdWUsIHN0cmluZy5Gb3JtYXQoQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGJ5dGU+ezB9PC9ieXRlPiIsIHZhbHVlKSksIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU3RyaW5nQXNSb290KCkNCiAgICB7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxzdHJpbmc+KCJhYmMiLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPHN0cmluZz5hYmM8L3N0cmluZz4iKSwgImFiYyIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8c3RyaW5nPigiICBhIGIgICIsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8c3RyaW5nPiAgYSBiICA8L3N0cmluZz4iKSwgIiAgYSBiICAiKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPHN0cmluZz4obnVsbCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxzdHJpbmcgZDFwMTpuaWw9IiJ0cnVlIiIgeG1sbnM6ZDFwMT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgLz4iKSwgbnVsbCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxzdHJpbmc+KCIiLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPHN0cmluZyAvPiIpLCAiIik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxzdHJpbmc+KCIgIiwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxzdHJpbmc+IDwvc3RyaW5nPiIpLCBzdHJpbmcuRW1wdHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8c3RyaW5nPigiSGVsbG8gV29ybGQhIOa8oiDDsSIsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8c3RyaW5nPkhlbGxvIFdvcmxkISDmvKIgw7E8L3N0cmluZz4iKSwgIkhlbGxvIFdvcmxkISDmvKIgw7EiKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1VpbnRBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgZm9yZWFjaCAodWludCB2YWx1ZSBpbiBuZXcgdWludFtdIHsgKHVpbnQpMywgKHVpbnQpMCwgdWludC5NaW5WYWx1ZSwgdWludC5NYXhWYWx1ZSB9KQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8dWludD4odmFsdWUsIHN0cmluZy5Gb3JtYXQoQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPHVuc2lnbmVkSW50PnswfTwvdW5zaWduZWRJbnQ+IiwgdmFsdWUpKSwgdmFsdWUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9VbG9uZ0FzUm9vdCgpDQogICAgew0KICAgICAgICBmb3JlYWNoICh1bG9uZyB2YWx1ZSBpbiBuZXcgdWxvbmdbXSB7ICh1bG9uZykzLCAodWxvbmcpMCwgdWxvbmcuTWluVmFsdWUsIHVsb25nLk1heFZhbHVlIH0pDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTx1bG9uZz4odmFsdWUsIHN0cmluZy5Gb3JtYXQoQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPHVuc2lnbmVkTG9uZz57MH08L3Vuc2lnbmVkTG9uZz4iLCB2YWx1ZSkpLCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1VzaG9ydEFzUm9vdCgpDQogICAgew0KICAgICAgICBmb3JlYWNoICh1c2hvcnQgdmFsdWUgaW4gbmV3IHVzaG9ydFtdIHsgKHVzaG9ydCkzLCAodXNob3J0KTAsIHVzaG9ydC5NaW5WYWx1ZSwgdXNob3J0Lk1heFZhbHVlIH0pDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTx1c2hvcnQ+KHZhbHVlLCBzdHJpbmcuRm9ybWF0KEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjx1bnNpZ25lZFNob3J0PnswfTwvdW5zaWduZWRTaG9ydD4iLCB2YWx1ZSkpLCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0FycmF5QXNSb290KCkNCiAgICB7DQogICAgICAgIFNpbXBsZVR5cGVbXSB4ID0gbmV3IFNpbXBsZVR5cGVbXSB7IG5ldyBTaW1wbGVUeXBlIHsgUDEgPSAiYWJjIiwgUDIgPSAxMSB9LCBuZXcgU2ltcGxlVHlwZSB7IFAxID0gImRlZiIsIFAyID0gMTIgfSB9Ow0KICAgICAgICBTaW1wbGVUeXBlW10geSA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFNpbXBsZVR5cGVbXT4oeCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxBcnJheU9mU2ltcGxlVHlwZSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxTaW1wbGVUeXBlPg0KICAgIDxQMT5hYmM8L1AxPg0KICAgIDxQMj4xMTwvUDI+DQogIDwvU2ltcGxlVHlwZT4NCiAgPFNpbXBsZVR5cGU+DQogICAgPFAxPmRlZjwvUDE+DQogICAgPFAyPjEyPC9QMj4NCiAgPC9TaW1wbGVUeXBlPg0KPC9BcnJheU9mU2ltcGxlVHlwZT4iKTsNCg0KICAgICAgICBVdGlscy5FcXVhbCh4LCB5LCAoYSwgYikgPT4geyByZXR1cm4gU2ltcGxlVHlwZS5BcmVFcXVhbChhLCBiKTsgfSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9MaXN0R2VuZXJpY1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgWG1sX0xpc3RHZW5lcmljUm9vdChuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoTGlzdDxzdHJpbmc+KSkpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgWG1sX0xpc3RHZW5lcmljUm9vdChYbWxTZXJpYWxpemVyIHNlcmlhbGl6ZXIpDQogICAgew0KICAgICAgICBMaXN0PHN0cmluZz4geCA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgeC5BZGQoInplcm8iKTsNCiAgICAgICAgeC5BZGQoIm9uZSIpOw0KDQogICAgICAgIExpc3Q8c3RyaW5nPiB5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8TGlzdDxzdHJpbmc+Pih4LA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEFycmF5T2ZTdHJpbmcgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8c3RyaW5nPnplcm88L3N0cmluZz4NCiAgPHN0cmluZz5vbmU8L3N0cmluZz4NCjwvQXJyYXlPZlN0cmluZz4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbCh5KTsNCiAgICAgICAgQXNzZXJ0LlRydWUoeS5Db3VudCA9PSAyKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoeVswXSA9PSAiemVybyIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZSh5WzFdID09ICJvbmUiKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0NvbGxlY3Rpb25HZW5lcmljUm9vdCgpDQogICAgew0KICAgICAgICBNeUNvbGxlY3Rpb248c3RyaW5nPiB4ID0gbmV3IE15Q29sbGVjdGlvbjxzdHJpbmc+KCJhMSIsICJhMiIpOw0KICAgICAgICBNeUNvbGxlY3Rpb248c3RyaW5nPiB5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8TXlDb2xsZWN0aW9uPHN0cmluZz4+KHgsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8QXJyYXlPZlN0cmluZyB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxzdHJpbmc+YTE8L3N0cmluZz4NCiAgPHN0cmluZz5hMjwvc3RyaW5nPg0KPC9BcnJheU9mU3RyaW5nPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKHkpOw0KICAgICAgICBBc3NlcnQuVHJ1ZSh5LkNvdW50ID09IDIpOw0KICAgICAgICBmb3JlYWNoIChzdHJpbmcgaXRlbSBpbiB4KQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZSh5LkNvbnRhaW5zKGl0ZW0pKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfRW51bWVyYWJsZUdlbmVyaWNSb290KCkNCiAgICB7DQogICAgICAgIE15RW51bWVyYWJsZTxzdHJpbmc+IHggPSBuZXcgTXlFbnVtZXJhYmxlPHN0cmluZz4oImExIiwgImEyIik7DQogICAgICAgIE15RW51bWVyYWJsZTxzdHJpbmc+IHkgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxNeUVudW1lcmFibGU8c3RyaW5nPj4oeCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxBcnJheU9mU3RyaW5nIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPHN0cmluZz5hMTwvc3RyaW5nPg0KICA8c3RyaW5nPmEyPC9zdHJpbmc+DQo8L0FycmF5T2ZTdHJpbmc+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoeSk7DQogICAgICAgIEFzc2VydC5UcnVlKHkuQ291bnQgPT0gMik7DQoNCiAgICAgICAgc3RyaW5nIGl0ZW1zSW5ZID0gc3RyaW5nLkpvaW4oIiIsIHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoImExYTIiLCBpdGVtc0luWSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Db2xsZWN0aW9uUm9vdCgpDQogICAgew0KICAgICAgICBNeUNvbGxlY3Rpb24geCA9IG5ldyBNeUNvbGxlY3Rpb24oJ2EnLCA0NSk7DQogICAgICAgIE15Q29sbGVjdGlvbiB5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8TXlDb2xsZWN0aW9uPih4LA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEFycmF5T2ZBbnlUeXBlIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPGFueVR5cGUgeG1sbnM6cTE9IiJodHRwOi8vbWljcm9zb2Z0LmNvbS93c2RsL3R5cGVzLyIiIHhzaTp0eXBlPSIicTE6Y2hhciIiPjk3PC9hbnlUeXBlPg0KICA8YW55VHlwZSB4c2k6dHlwZT0iInhzZDppbnQiIj40NTwvYW55VHlwZT4NCjwvQXJyYXlPZkFueVR5cGU+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoeSk7DQogICAgICAgIEFzc2VydC5UcnVlKHkuQ291bnQgPT0gMik7DQogICAgICAgIEFzc2VydC5UcnVlKChjaGFyKXlbMF0gPT0gJ2EnKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoKGludCl5WzFdID09IDQ1KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0VudW1lcmFibGVSb290KCkNCiAgICB7DQogICAgICAgIE15RW51bWVyYWJsZSB4ID0gbmV3IE15RW51bWVyYWJsZSgiYWJjIiwgMyk7DQogICAgICAgIE15RW51bWVyYWJsZSB5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8TXlFbnVtZXJhYmxlPih4LA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEFycmF5T2ZBbnlUeXBlIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPGFueVR5cGUgeHNpOnR5cGU9IiJ4c2Q6c3RyaW5nIiI+YWJjPC9hbnlUeXBlPg0KICA8YW55VHlwZSB4c2k6dHlwZT0iInhzZDppbnQiIj4zPC9hbnlUeXBlPg0KPC9BcnJheU9mQW55VHlwZT4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbCh5KTsNCiAgICAgICAgQXNzZXJ0LlRydWUoeS5Db3VudCA9PSAyKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoKHN0cmluZyl5WzBdID09ICJhYmMiKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoKGludCl5WzFdID09IDMpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfR2VuZXJpY0Jhc2UoKQ0KICAgIHsNCiAgICAgICAgU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8R2VuZXJpY0Jhc2UyPFNpbXBsZUJhc2VEZXJpdmVkLCBTaW1wbGVCYXNlRGVyaXZlZDI+PihuZXcgR2VuZXJpY0Jhc2UyPFNpbXBsZUJhc2VEZXJpdmVkLCBTaW1wbGVCYXNlRGVyaXZlZDI+KHRydWUpLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEdlbmVyaWNCYXNlMk9mU2ltcGxlQmFzZURlcml2ZWRTaW1wbGVCYXNlRGVyaXZlZDIgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8Z2VuZXJpY0RhdGExPg0KICAgIDxCYXNlRGF0YSAvPg0KICAgIDxEZXJpdmVkRGF0YSAvPg0KICA8L2dlbmVyaWNEYXRhMT4NCiAgPGdlbmVyaWNEYXRhMj4NCiAgICA8QmFzZURhdGEgLz4NCiAgICA8RGVyaXZlZERhdGEgLz4NCiAgPC9nZW5lcmljRGF0YTI+DQo8L0dlbmVyaWNCYXNlMk9mU2ltcGxlQmFzZURlcml2ZWRTaW1wbGVCYXNlRGVyaXZlZDI+Iik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9YRWxlbWVudEFzUm9vdCgpDQogICAgew0KICAgICAgICB2YXIgb3JpZ2luYWwgPSBuZXcgWEVsZW1lbnQoIkVsZW1lbnROYW1lMSIpOw0KICAgICAgICBvcmlnaW5hbC5TZXRBdHRyaWJ1dGVWYWx1ZShYTmFtZS5HZXQoIkF0dHJpYnV0ZTEiKSwgIkF0dHJpYnV0ZVZhbHVlMSIpOw0KICAgICAgICBvcmlnaW5hbC5TZXRWYWx1ZSgiVmFsdWUxIik7DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxYRWxlbWVudD4ob3JpZ2luYWwsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8RWxlbWVudE5hbWUxIEF0dHJpYnV0ZTE9IiJBdHRyaWJ1dGVWYWx1ZTEiIj5WYWx1ZTE8L0VsZW1lbnROYW1lMT4iKTsNCg0KICAgICAgICBWZXJpZnlYRWxlbWVudE9iamVjdChvcmlnaW5hbCwgYWN0dWFsKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1dpdGhYRWxlbWVudCgpDQogICAgew0KICAgICAgICB2YXIgb3JpZ2luYWwgPSBuZXcgV2l0aFhFbGVtZW50KHRydWUpOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8V2l0aFhFbGVtZW50PihvcmlnaW5hbCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxXaXRoWEVsZW1lbnQgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8ZT4NCiAgICA8RWxlbWVudE5hbWUxIEF0dHJpYnV0ZTE9IiJBdHRyaWJ1dGVWYWx1ZTEiIj5WYWx1ZTE8L0VsZW1lbnROYW1lMT4NCiAgPC9lPg0KPC9XaXRoWEVsZW1lbnQ+Iik7DQoNCiAgICAgICAgVmVyaWZ5WEVsZW1lbnRPYmplY3Qob3JpZ2luYWwuZSwgYWN0dWFsLmUpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgVmVyaWZ5WEVsZW1lbnRPYmplY3QoWEVsZW1lbnQgeDEsIFhFbGVtZW50IHgyLCBib29sIGNoZWNrRmlyc3RBdHRyaWJ1dGUgPSB0cnVlKQ0KICAgIHsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHgxLlZhbHVlLCB4Mi5WYWx1ZSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh4MS5OYW1lLCB4Mi5OYW1lKTsNCiAgICAgICAgaWYgKGNoZWNrRmlyc3RBdHRyaWJ1dGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh4MS5GaXJzdEF0dHJpYnV0ZS5OYW1lLCB4Mi5GaXJzdEF0dHJpYnV0ZS5OYW1lKTsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh4MS5GaXJzdEF0dHJpYnV0ZS5WYWx1ZSwgeDIuRmlyc3RBdHRyaWJ1dGUuVmFsdWUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9XaXRoWEVsZW1lbnRXaXRoTmVzdGVkWEVsZW1lbnQoKQ0KICAgIHsNCiAgICAgICAgdmFyIG9yaWdpbmFsID0gbmV3IFdpdGhYRWxlbWVudFdpdGhOZXN0ZWRYRWxlbWVudCh0cnVlKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFdpdGhYRWxlbWVudFdpdGhOZXN0ZWRYRWxlbWVudD4ob3JpZ2luYWwsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8V2l0aFhFbGVtZW50V2l0aE5lc3RlZFhFbGVtZW50IHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPGUxPg0KICAgIDxFbGVtZW50TmFtZTEgQXR0cmlidXRlMT0iIkF0dHJpYnV0ZVZhbHVlMSIiPg0KICAgICAgPEVsZW1lbnROYW1lMiBBdHRyaWJ1dGUyPSIiQXR0cmlidXRlVmFsdWUyIiI+VmFsdWUyPC9FbGVtZW50TmFtZTI+DQogICAgPC9FbGVtZW50TmFtZTE+DQogIDwvZTE+DQo8L1dpdGhYRWxlbWVudFdpdGhOZXN0ZWRYRWxlbWVudD4iKTsNCg0KICAgICAgICBWZXJpZnlYRWxlbWVudE9iamVjdChvcmlnaW5hbC5lMSwgYWN0dWFsLmUxKTsNCiAgICAgICAgVmVyaWZ5WEVsZW1lbnRPYmplY3QoKFhFbGVtZW50KW9yaWdpbmFsLmUxLkZpcnN0Tm9kZSwgKFhFbGVtZW50KWFjdHVhbC5lMS5GaXJzdE5vZGUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfV2l0aEFycmF5T2ZYRWxlbWVudCgpDQogICAgew0KICAgICAgICB2YXIgb3JpZ2luYWwgPSBuZXcgV2l0aEFycmF5T2ZYRWxlbWVudCh0cnVlKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFdpdGhBcnJheU9mWEVsZW1lbnQ+KG9yaWdpbmFsLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPFdpdGhBcnJheU9mWEVsZW1lbnQgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8YT4NCiAgICA8WEVsZW1lbnQ+DQogICAgICA8aXRlbSB4bWxucz0iImh0dHA6Ly9wLmNvbS8iIj5pdGVtMDwvaXRlbT4NCiAgICA8L1hFbGVtZW50Pg0KICAgIDxYRWxlbWVudD4NCiAgICAgIDxpdGVtIHhtbG5zPSIiaHR0cDovL3AuY29tLyIiPml0ZW0xPC9pdGVtPg0KICAgIDwvWEVsZW1lbnQ+DQogICAgPFhFbGVtZW50Pg0KICAgICAgPGl0ZW0geG1sbnM9IiJodHRwOi8vcC5jb20vIiI+aXRlbTI8L2l0ZW0+DQogICAgPC9YRWxlbWVudD4NCiAgPC9hPg0KPC9XaXRoQXJyYXlPZlhFbGVtZW50PiIpOw0KDQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChvcmlnaW5hbC5hLkxlbmd0aCwgYWN0dWFsLmEuTGVuZ3RoKTsNCiAgICAgICAgVmVyaWZ5WEVsZW1lbnRPYmplY3Qob3JpZ2luYWwuYVswXSwgYWN0dWFsLmFbMF0sIGNoZWNrRmlyc3RBdHRyaWJ1dGU6IGZhbHNlKTsNCiAgICAgICAgVmVyaWZ5WEVsZW1lbnRPYmplY3Qob3JpZ2luYWwuYVsxXSwgYWN0dWFsLmFbMV0sIGNoZWNrRmlyc3RBdHRyaWJ1dGU6IGZhbHNlKTsNCiAgICAgICAgVmVyaWZ5WEVsZW1lbnRPYmplY3Qob3JpZ2luYWwuYVsyXSwgYWN0dWFsLmFbMl0sIGNoZWNrRmlyc3RBdHRyaWJ1dGU6IGZhbHNlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1dpdGhMaXN0T2ZYRWxlbWVudCgpDQogICAgew0KICAgICAgICB2YXIgb3JpZ2luYWwgPSBuZXcgV2l0aExpc3RPZlhFbGVtZW50KHRydWUpOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8V2l0aExpc3RPZlhFbGVtZW50PihvcmlnaW5hbCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxXaXRoTGlzdE9mWEVsZW1lbnQgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8bGlzdD4NCiAgICA8WEVsZW1lbnQ+DQogICAgICA8aXRlbSB4bWxucz0iImh0dHA6Ly9wLmNvbS8iIj5pdGVtMDwvaXRlbT4NCiAgICA8L1hFbGVtZW50Pg0KICAgIDxYRWxlbWVudD4NCiAgICAgIDxpdGVtIHhtbG5zPSIiaHR0cDovL3AuY29tLyIiPml0ZW0xPC9pdGVtPg0KICAgIDwvWEVsZW1lbnQ+DQogICAgPFhFbGVtZW50Pg0KICAgICAgPGl0ZW0geG1sbnM9IiJodHRwOi8vcC5jb20vIiI+aXRlbTI8L2l0ZW0+DQogICAgPC9YRWxlbWVudD4NCiAgPC9saXN0Pg0KPC9XaXRoTGlzdE9mWEVsZW1lbnQ+Iik7DQoNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKG9yaWdpbmFsLmxpc3QuQ291bnQsIGFjdHVhbC5saXN0LkNvdW50KTsNCiAgICAgICAgVmVyaWZ5WEVsZW1lbnRPYmplY3Qob3JpZ2luYWwubGlzdFswXSwgYWN0dWFsLmxpc3RbMF0sIGNoZWNrRmlyc3RBdHRyaWJ1dGU6IGZhbHNlKTsNCiAgICAgICAgVmVyaWZ5WEVsZW1lbnRPYmplY3Qob3JpZ2luYWwubGlzdFsxXSwgYWN0dWFsLmxpc3RbMV0sIGNoZWNrRmlyc3RBdHRyaWJ1dGU6IGZhbHNlKTsNCiAgICAgICAgVmVyaWZ5WEVsZW1lbnRPYmplY3Qob3JpZ2luYWwubGlzdFsyXSwgYWN0dWFsLmxpc3RbMl0sIGNoZWNrRmlyc3RBdHRyaWJ1dGU6IGZhbHNlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0phZ2dlZEFycmF5QXNSb290KCkNCiAgICB7DQogICAgICAgIGludFtdW10gamFnZ2VkSW50ZWdlckFycmF5ID0gbmV3IGludFtdW10geyBuZXcgaW50W10geyAxLCAzLCA1LCA3LCA5IH0sIG5ldyBpbnRbXSB7IDAsIDIsIDQsIDYgfSwgbmV3IGludFtdIHsgMTEsIDIyIH0gfTsNCiAgICAgICAgaW50W11bXSBhY3R1YWxKYWdnZWRJbnRlZ2VyQXJyYXkgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxpbnRbXVtdPihqYWdnZWRJbnRlZ2VyQXJyYXksDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8QXJyYXlPZkFycmF5T2ZJbnQgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8QXJyYXlPZkludD4NCiAgICA8aW50PjE8L2ludD4NCiAgICA8aW50PjM8L2ludD4NCiAgICA8aW50PjU8L2ludD4NCiAgICA8aW50Pjc8L2ludD4NCiAgICA8aW50Pjk8L2ludD4NCiAgPC9BcnJheU9mSW50Pg0KICA8QXJyYXlPZkludD4NCiAgICA8aW50PjA8L2ludD4NCiAgICA8aW50PjI8L2ludD4NCiAgICA8aW50PjQ8L2ludD4NCiAgICA8aW50PjY8L2ludD4NCiAgPC9BcnJheU9mSW50Pg0KICA8QXJyYXlPZkludD4NCiAgICA8aW50PjExPC9pbnQ+DQogICAgPGludD4yMjwvaW50Pg0KICA8L0FycmF5T2ZJbnQ+DQo8L0FycmF5T2ZBcnJheU9mSW50PiIpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoamFnZ2VkSW50ZWdlckFycmF5WzBdLCBhY3R1YWxKYWdnZWRJbnRlZ2VyQXJyYXlbMF0pOw0KICAgICAgICBBc3NlcnQuRXF1YWwoamFnZ2VkSW50ZWdlckFycmF5WzFdLCBhY3R1YWxKYWdnZWRJbnRlZ2VyQXJyYXlbMV0pOw0KICAgICAgICBBc3NlcnQuRXF1YWwoamFnZ2VkSW50ZWdlckFycmF5WzJdLCBhY3R1YWxKYWdnZWRJbnRlZ2VyQXJyYXlbMl0pOw0KDQoNCiAgICAgICAgc3RyaW5nW11bXSBqYWdnZWRTdHJpbmdBcnJheSA9IG5ldyBzdHJpbmdbXVtdIHsgbmV3IHN0cmluZ1tdIHsgIjEiLCAiMyIsICI1IiwgIjciLCAiOSIgfSwgbmV3IHN0cmluZ1tdIHsgIjAiLCAiMiIsICI0IiwgIjYiIH0sIG5ldyBzdHJpbmdbXSB7ICIxMSIsICIyMiIgfSB9Ow0KICAgICAgICBzdHJpbmdbXVtdIGFjdHVhbEphZ2dlZFN0cmluZ0FycmF5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8c3RyaW5nW11bXT4oamFnZ2VkU3RyaW5nQXJyYXksDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8QXJyYXlPZkFycmF5T2ZTdHJpbmcgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8QXJyYXlPZlN0cmluZz4NCiAgICA8c3RyaW5nPjE8L3N0cmluZz4NCiAgICA8c3RyaW5nPjM8L3N0cmluZz4NCiAgICA8c3RyaW5nPjU8L3N0cmluZz4NCiAgICA8c3RyaW5nPjc8L3N0cmluZz4NCiAgICA8c3RyaW5nPjk8L3N0cmluZz4NCiAgPC9BcnJheU9mU3RyaW5nPg0KICA8QXJyYXlPZlN0cmluZz4NCiAgICA8c3RyaW5nPjA8L3N0cmluZz4NCiAgICA8c3RyaW5nPjI8L3N0cmluZz4NCiAgICA8c3RyaW5nPjQ8L3N0cmluZz4NCiAgICA8c3RyaW5nPjY8L3N0cmluZz4NCiAgPC9BcnJheU9mU3RyaW5nPg0KICA8QXJyYXlPZlN0cmluZz4NCiAgICA8c3RyaW5nPjExPC9zdHJpbmc+DQogICAgPHN0cmluZz4yMjwvc3RyaW5nPg0KICA8L0FycmF5T2ZTdHJpbmc+DQo8L0FycmF5T2ZBcnJheU9mU3RyaW5nPiIpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoamFnZ2VkU3RyaW5nQXJyYXlbMF0sIGFjdHVhbEphZ2dlZFN0cmluZ0FycmF5WzBdKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGphZ2dlZFN0cmluZ0FycmF5WzFdLCBhY3R1YWxKYWdnZWRTdHJpbmdBcnJheVsxXSk7DQogICAgICAgIEFzc2VydC5FcXVhbChqYWdnZWRTdHJpbmdBcnJheVsyXSwgYWN0dWFsSmFnZ2VkU3RyaW5nQXJyYXlbMl0pOw0KDQoNCiAgICAgICAgb2JqZWN0W10gb2JqZWN0QXJyYXkgPSBuZXcgb2JqZWN0W10geyAxLCAxLjBGLCAxLjAsICJzdHJpbmciLCBHdWlkLlBhcnNlKCIyMDU0ZmQzZS1lMTE4LTQ3NmEtOTk2Mi0xYTg4MmJlNTE4NjAiKSwgbmV3IERhdGVUaW1lKDIwMTMsIDEsIDIpIH07DQogICAgICAgIG9iamVjdFtdIGFjdHVhbE9iamVjdEFycmF5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8b2JqZWN0W10+KG9iamVjdEFycmF5LA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEFycmF5T2ZBbnlUeXBlIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPGFueVR5cGUgeHNpOnR5cGU9IiJ4c2Q6aW50IiI+MTwvYW55VHlwZT4NCiAgPGFueVR5cGUgeHNpOnR5cGU9IiJ4c2Q6ZmxvYXQiIj4xPC9hbnlUeXBlPg0KICA8YW55VHlwZSB4c2k6dHlwZT0iInhzZDpkb3VibGUiIj4xPC9hbnlUeXBlPg0KICA8YW55VHlwZSB4c2k6dHlwZT0iInhzZDpzdHJpbmciIj5zdHJpbmc8L2FueVR5cGU+DQogIDxhbnlUeXBlIHhtbG5zOnExPSIiaHR0cDovL21pY3Jvc29mdC5jb20vd3NkbC90eXBlcy8iIiB4c2k6dHlwZT0iInExOmd1aWQiIj4yMDU0ZmQzZS1lMTE4LTQ3NmEtOTk2Mi0xYTg4MmJlNTE4NjA8L2FueVR5cGU+DQogIDxhbnlUeXBlIHhzaTp0eXBlPSIieHNkOmRhdGVUaW1lIiI+MjAxMy0wMS0wMlQwMDowMDowMDwvYW55VHlwZT4NCjwvQXJyYXlPZkFueVR5cGU+Iik7DQogICAgICAgIEFzc2VydC5UcnVlKDEgPT0gKGludClhY3R1YWxPYmplY3RBcnJheVswXSk7DQogICAgICAgIEFzc2VydC5UcnVlKDEuMEYgPT0gKGZsb2F0KWFjdHVhbE9iamVjdEFycmF5WzFdKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoMS4wID09IChkb3VibGUpYWN0dWFsT2JqZWN0QXJyYXlbMl0pOw0KICAgICAgICBBc3NlcnQuVHJ1ZSgic3RyaW5nIiA9PSAoc3RyaW5nKWFjdHVhbE9iamVjdEFycmF5WzNdKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoR3VpZC5QYXJzZSgiMjA1NGZkM2UtZTExOC00NzZhLTk5NjItMWE4ODJiZTUxODYwIikgPT0gKEd1aWQpYWN0dWFsT2JqZWN0QXJyYXlbNF0pOw0KICAgICAgICBBc3NlcnQuVHJ1ZShuZXcgRGF0ZVRpbWUoMjAxMywgMSwgMikgPT0gKERhdGVUaW1lKWFjdHVhbE9iamVjdEFycmF5WzVdKTsNCg0KDQogICAgICAgIGludFtdW11bXSBqYWdnZWRJbnRlZ2VyQXJyYXkyID0gbmV3IGludFtdW11bXSB7IG5ldyBpbnRbXVtdIHsgbmV3IGludFtdIHsgMSB9LCBuZXcgaW50W10geyAzIH0gfSwgbmV3IGludFtdW10geyBuZXcgaW50W10geyAwIH0gfSwgbmV3IGludFtdW10geyBuZXcgaW50W10geyB9IH0gfTsNCiAgICAgICAgaW50W11bXVtdIGFjdHVhbEphZ2dlZEludGVnZXJBcnJheTIgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxpbnRbXVtdW10+KGphZ2dlZEludGVnZXJBcnJheTIsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8QXJyYXlPZkFycmF5T2ZBcnJheU9mSW50IHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPEFycmF5T2ZBcnJheU9mSW50Pg0KICAgIDxBcnJheU9mSW50Pg0KICAgICAgPGludD4xPC9pbnQ+DQogICAgPC9BcnJheU9mSW50Pg0KICAgIDxBcnJheU9mSW50Pg0KICAgICAgPGludD4zPC9pbnQ+DQogICAgPC9BcnJheU9mSW50Pg0KICA8L0FycmF5T2ZBcnJheU9mSW50Pg0KICA8QXJyYXlPZkFycmF5T2ZJbnQ+DQogICAgPEFycmF5T2ZJbnQ+DQogICAgICA8aW50PjA8L2ludD4NCiAgICA8L0FycmF5T2ZJbnQ+DQogIDwvQXJyYXlPZkFycmF5T2ZJbnQ+DQogIDxBcnJheU9mQXJyYXlPZkludD4NCiAgICA8QXJyYXlPZkludCAvPg0KICA8L0FycmF5T2ZBcnJheU9mSW50Pg0KPC9BcnJheU9mQXJyYXlPZkFycmF5T2ZJbnQ+Iik7DQoNCiAgICAgICAgQXNzZXJ0LlRydWUoYWN0dWFsSmFnZ2VkSW50ZWdlckFycmF5Mi5MZW5ndGggPT0gMyk7DQogICAgICAgIEFzc2VydC5UcnVlKGFjdHVhbEphZ2dlZEludGVnZXJBcnJheTJbMF1bMF1bMF0gPT0gMSk7DQogICAgICAgIEFzc2VydC5UcnVlKGFjdHVhbEphZ2dlZEludGVnZXJBcnJheTJbMF1bMV1bMF0gPT0gMyk7DQogICAgICAgIEFzc2VydC5UcnVlKGFjdHVhbEphZ2dlZEludGVnZXJBcnJheTJbMV1bMF1bMF0gPT0gMCk7DQogICAgICAgIEFzc2VydC5UcnVlKGFjdHVhbEphZ2dlZEludGVnZXJBcnJheTJbMl1bMF0uTGVuZ3RoID09IDApOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfRGVmYXVsdE5hbWVzcGFjZUNoYW5nZVRlc3QoKQ0KICAgIHsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKA0KICAgICAgICBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxzdHJpbmc+KCJUZXN0c3RyaW5nIiwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxzdHJpbmcgeG1sbnM9IiJNeWN1c3RvbURlZmF1bHROYW1lc3BhY2UiIj5UZXN0c3RyaW5nPC9zdHJpbmc+IiwNCiAgICAgICAgKCkgPT4geyByZXR1cm4gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKHN0cmluZyksICJNeWN1c3RvbURlZmF1bHROYW1lc3BhY2UiKTsgfSksDQogICAgICAgICJUZXN0c3RyaW5nIik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9EZWZhdWx0TmFtZXNwYWNlQ2hhbmdlX1NpbXBsZVR5cGVBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFNpbXBsZVR5cGUgeyBQMSA9ICJhYmMiLCBQMiA9IDExIH07DQogICAgICAgIHZhciBvID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8U2ltcGxlVHlwZT4odmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8U2ltcGxlVHlwZSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgeG1sbnM9IiJNeWN1c3RvbURlZmF1bHROYW1lc3BhY2UiIj4NCiAgPFAxPmFiYzwvUDE+DQogIDxQMj4xMTwvUDI+DQo8L1NpbXBsZVR5cGU+IiwNCiAgICAgICAgKCkgPT4geyByZXR1cm4gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKFNpbXBsZVR5cGUpLCAiTXljdXN0b21EZWZhdWx0TmFtZXNwYWNlIik7IH0pOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuUDEsIG8uUDEpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuUDIsIG8uUDIpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfRGVmYXVsdE5hbWVzcGFjZUNoYW5nZV9TaW1wbGVUeXBlQXNSb290X1dpdGhYbWxTZXJpYWxpemVyTmFtZXNwYWNlcygpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgU2ltcGxlVHlwZSB7IFAxID0gImFiYyIsIFAyID0gMTEgfTsNCiAgICAgICAgWG1sU2VyaWFsaXplck5hbWVzcGFjZXMgeG5zID0gbmV3IFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzKCk7DQogICAgICAgIHhucy5BZGQoImFhIiwgInRlc3ROcyIpOw0KICAgICAgICB2YXIgbyA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFNpbXBsZVR5cGU+KHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPFNpbXBsZVR5cGUgeG1sbnM6YWE9IiJ0ZXN0TnMiIiB4bWxucz0iIk15Y3VzdG9tRGVmYXVsdE5hbWVzcGFjZSIiPg0KICA8UDE+YWJjPC9QMT4NCiAgPFAyPjExPC9QMj4NCjwvU2ltcGxlVHlwZT4iLA0KICAgICAgICAgICAgKCkgPT4geyByZXR1cm4gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKFNpbXBsZVR5cGUpLCAiTXljdXN0b21EZWZhdWx0TmFtZXNwYWNlIik7IH0sIHhuczogeG5zKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlAxLCBvLlAxKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlAyLCBvLlAyKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0RlZmF1bHROYW1lc3BhY2VDaGFuZ2VfQXJyYXlBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgU2ltcGxlVHlwZVtdIHggPSBuZXcgU2ltcGxlVHlwZVtdIHsgbmV3IFNpbXBsZVR5cGUgeyBQMSA9ICJhYmMiLCBQMiA9IDExIH0sIG5ldyBTaW1wbGVUeXBlIHsgUDEgPSAiZGVmIiwgUDIgPSAxMiB9IH07DQogICAgICAgIFNpbXBsZVR5cGVbXSB5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8U2ltcGxlVHlwZVtdPih4LA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEFycmF5T2ZTaW1wbGVUeXBlIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIiB4bWxucz0iIk15Y3VzdG9tRGVmYXVsdE5hbWVzcGFjZSIiPg0KICA8U2ltcGxlVHlwZT4NCiAgICA8UDE+YWJjPC9QMT4NCiAgICA8UDI+MTE8L1AyPg0KICA8L1NpbXBsZVR5cGU+DQogIDxTaW1wbGVUeXBlPg0KICAgIDxQMT5kZWY8L1AxPg0KICAgIDxQMj4xMjwvUDI+DQogIDwvU2ltcGxlVHlwZT4NCjwvQXJyYXlPZlNpbXBsZVR5cGU+IiwNCiAgICAgICAgICAgICgpID0+IHsgcmV0dXJuIG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihTaW1wbGVUeXBlW10pLCAiTXljdXN0b21EZWZhdWx0TmFtZXNwYWNlIik7IH0pOw0KDQogICAgICAgIFV0aWxzLkVxdWFsKHgsIHksIChhLCBiKSA9PiB7IHJldHVybiBTaW1wbGVUeXBlLkFyZUVxdWFsKGEsIGIpOyB9KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWE1MX0VudW1lcmFibGVDb2xsZWN0aW9uKCkNCiAgICB7DQogICAgICAgIEVudW1lcmFibGVDb2xsZWN0aW9uIG9yaWdpbmFsID0gbmV3IEVudW1lcmFibGVDb2xsZWN0aW9uKCk7DQogICAgICAgIG9yaWdpbmFsLkFkZChuZXcgRGF0ZVRpbWUoMTAwKSk7DQogICAgICAgIG9yaWdpbmFsLkFkZChuZXcgRGF0ZVRpbWUoMjAwKSk7DQogICAgICAgIG9yaWdpbmFsLkFkZChuZXcgRGF0ZVRpbWUoMzAwKSk7DQogICAgICAgIEVudW1lcmFibGVDb2xsZWN0aW9uIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPEVudW1lcmFibGVDb2xsZWN0aW9uPihvcmlnaW5hbCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz48QXJyYXlPZkRhdGVUaW1lIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIj48ZGF0ZVRpbWU+MDAwMS0wMS0wMVQwMDowMDowMC4wMDAwMTwvZGF0ZVRpbWU+PGRhdGVUaW1lPjAwMDEtMDEtMDFUMDA6MDA6MDAuMDAwMDI8L2RhdGVUaW1lPjxkYXRlVGltZT4wMDAxLTAxLTAxVDAwOjAwOjAwLjAwMDAzPC9kYXRlVGltZT48L0FycmF5T2ZEYXRlVGltZT4iKTsNCg0KICAgICAgICBBc3NlcnQuRXF1YWwoYWN0dWFsLCBvcmlnaW5hbCk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9TaW1wbGVDb2xsZWN0aW9uRGF0YUNvbnRyYWN0KCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBTaW1wbGVDREModHJ1ZSk7DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxTaW1wbGVDREM+KHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEFycmF5T2ZTdHJpbmcgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8c3RyaW5nPk9uZTwvc3RyaW5nPg0KICA8c3RyaW5nPlR3bzwvc3RyaW5nPg0KICA8c3RyaW5nPlRocmVlPC9zdHJpbmc+DQo8L0FycmF5T2ZTdHJpbmc+Iik7DQoNCiAgICAgICAgQXNzZXJ0LlRydWUodmFsdWUuQ291bnQgPT0gYWN0dWFsLkNvdW50KTsNCg0KICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiB2YWx1ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoYWN0dWFsLkNvbnRhaW5zKGl0ZW0pKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYTUxfVHlwZVdpdGhNZW1iZXJXaXRoWG1sTmFtZXNwYWNlRGVjbGFyYXRpb25zQXR0cmlidXRlKCkNCiAgICB7DQogICAgICAgIHZhciBvcmlnaW5hbCA9IG5ldyBUeXBlV2l0aE1lbWJlcldpdGhYbWxOYW1lc3BhY2VEZWNsYXJhdGlvbnNBdHRyaWJ1dGUoKSB7IGhlYWRlciA9ICJmb28iLCBib2R5ID0gImJhciIgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhNZW1iZXJXaXRoWG1sTmFtZXNwYWNlRGVjbGFyYXRpb25zQXR0cmlidXRlPihvcmlnaW5hbCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxFbnZlbG9wZSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgeG1sbnM9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAzLzA1L3NvYXAtZW52ZWxvcGUiIj4NCiAgPGhlYWRlcj5mb288L2hlYWRlcj4NCiAgPGJvZHk+YmFyPC9ib2R5Pg0KPC9FbnZlbG9wZT4iKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKG9yaWdpbmFsLmhlYWRlciwgYWN0dWFsLmhlYWRlcik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChvcmlnaW5hbC5ib2R5LCBhY3R1YWwuYm9keSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhNTF9UeXBlV2l0aE1lbWJlcldpdGhYbWxOYW1lc3BhY2VEZWNsYXJhdGlvbnNBdHRyaWJ1dGVfV2l0aEluaXRpYWxWYWx1ZSgpDQogICAgew0KICAgICAgICB2YXIgbnMgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZSgibnMiLCAiaHR0cDovL3RlbXB1cmkub3JnIik7DQogICAgICAgIHZhciBvcmlnaW5hbCA9IG5ldyBUeXBlV2l0aE1lbWJlcldpdGhYbWxOYW1lc3BhY2VEZWNsYXJhdGlvbnNBdHRyaWJ1dGUoKSB7IGhlYWRlciA9ICJmb28iLCBib2R5ID0gImJhciIsIHhtbG5zID0gbmV3IFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzKG5ld1tdIHsgbnMgfSkgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhNZW1iZXJXaXRoWG1sTmFtZXNwYWNlRGVjbGFyYXRpb25zQXR0cmlidXRlPihvcmlnaW5hbCwNCiAgICAgICAgICAgIEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxFbnZlbG9wZSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgeG1sbnM9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAzLzA1L3NvYXAtZW52ZWxvcGUiIiB4bWxuczpucz0iImh0dHA6Ly90ZW1wdXJpLm9yZyIiPg0KICA8aGVhZGVyPmZvbzwvaGVhZGVyPg0KICA8Ym9keT5iYXI8L2JvZHk+DQo8L0VudmVsb3BlPiIpOw0KDQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChvcmlnaW5hbC5oZWFkZXIsIGFjdHVhbC5oZWFkZXIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwob3JpZ2luYWwuYm9keSwgYWN0dWFsLmJvZHkpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwueG1sbnMpOw0KICAgICAgICBBc3NlcnQuQ29udGFpbnMobnMsIGFjdHVhbC54bWxucy5Ub0FycmF5KCkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYTUxfWG1sU2NoZW1hV2l0aE5hbWVzcGFjZXNXcml0ZVdpdGhOYW1lc3BhY2VNYW5hZ2VyKCkNCiAgICB7DQogICAgICAgIHZhciBzY2hlbWEgPSBuZXcgWG1sU2NoZW1hKCk7DQogICAgICAgIHNjaGVtYS5OYW1lc3BhY2VzID0gbmV3IFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzKCk7DQoNCiAgICAgICAgdXNpbmcgKHZhciBtZW1TdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICBzY2hlbWEuV3JpdGUobWVtU3RyZWFtLCBuZXcgWG1sTmFtZXNwYWNlTWFuYWdlcihuZXcgTmFtZVRhYmxlKCkpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1htbEVsZW1lbnRBc1Jvb3QoKQ0KICAgIHsNCiAgICAgICAgWG1sRG9jdW1lbnQgeERvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICB4RG9jLkxvYWRYbWwoQCI8aHRtbD48L2h0bWw+Iik7DQogICAgICAgIFhtbEVsZW1lbnQgZXhwZWN0ZWQgPSB4RG9jLkNyZWF0ZUVsZW1lbnQoIkVsZW1lbnQiKTsNCiAgICAgICAgZXhwZWN0ZWQuSW5uZXJUZXh0ID0gIkVsZW1lbnQgaW5uZXJ0ZXh0IjsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKGV4cGVjdGVkLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48RWxlbWVudD5FbGVtZW50IGlubmVydGV4dDwvRWxlbWVudD4iKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGV4cGVjdGVkLklubmVyVGV4dCwgYWN0dWFsLklubmVyVGV4dCk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9YbWxEb2N1bWVudEFzUm9vdCgpDQogICAgew0KICAgICAgICBYbWxEb2N1bWVudCBleHBlY3RlZCA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICBleHBlY3RlZC5Mb2FkWG1sKEAiPGh0bWw+PGhlYWQ+SGVhZCBjb250ZW50PC9oZWFkPjxib2R5PjxoMT5IZWFkaW5nMTwvaDE+PGRpdj5UZXh0IGluIGJvZHk8L2Rpdj48L2JvZHk+PC9odG1sPiIpOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoZXhwZWN0ZWQsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxodG1sPjxoZWFkPkhlYWQgY29udGVudDwvaGVhZD48Ym9keT48aDE+SGVhZGluZzE8L2gxPjxkaXY+VGV4dCBpbiBib2R5PC9kaXY+PC9ib2R5PjwvaHRtbD4iKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGV4cGVjdGVkLk91dGVyWG1sLCBhY3R1YWwuT3V0ZXJYbWwpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVGVzdFR5cGVXaXRoTGlzdFByb3BlcnRpZXNXaXRob3V0UHVibGljU2V0dGVycygpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhMaXN0UHJvcGVydGllc1dpdGhvdXRQdWJsaWNTZXR0ZXJzKCk7DQogICAgICAgIHZhbHVlLlByb3BlcnR5V2l0aFhtbEVsZW1lbnRBdHRyaWJ1dGUuQWRkKCJJdGVtMSIpOw0KICAgICAgICB2YWx1ZS5Qcm9wZXJ0eVdpdGhYbWxFbGVtZW50QXR0cmlidXRlLkFkZCgiSXRlbTIiKTsNCiAgICAgICAgdmFsdWUuSW50TGlzdC5BZGQoMTIzKTsNCiAgICAgICAgdmFsdWUuU3RyaW5nTGlzdC5BZGQoIkZvbyIpOw0KICAgICAgICB2YWx1ZS5TdHJpbmdMaXN0LkFkZCgiQmFyIik7DQogICAgICAgIHZhbHVlLkFub3RoZXJTdHJpbmdMaXN0LkFkZCgiQW5vdGhlckZvbyIpOw0KICAgICAgICB2YWx1ZS5QdWJsaWNJbnRMaXN0RmllbGQuQWRkKDQ1Nik7DQogICAgICAgIHZhbHVlLlB1YmxpY0ludExpc3RGaWVsZFdpdGhYbWxFbGVtZW50QXR0cmlidXRlLkFkZCg3ODkpOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhMaXN0UHJvcGVydGllc1dpdGhvdXRQdWJsaWNTZXR0ZXJzPih2YWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxUeXBlV2l0aExpc3RQcm9wZXJ0aWVzV2l0aG91dFB1YmxpY1NldHRlcnMgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8UHVibGljSW50TGlzdEZpZWxkPg0KICAgIDxpbnQ+NDU2PC9pbnQ+DQogIDwvUHVibGljSW50TGlzdEZpZWxkPg0KICA8RmllbGRXaXRoWG1sRWxlbWVudEF0dHI+Nzg5PC9GaWVsZFdpdGhYbWxFbGVtZW50QXR0cj4NCiAgPFByb3BXaXRoWG1sRWxlbWVudEF0dHI+SXRlbTE8L1Byb3BXaXRoWG1sRWxlbWVudEF0dHI+DQogIDxQcm9wV2l0aFhtbEVsZW1lbnRBdHRyPkl0ZW0yPC9Qcm9wV2l0aFhtbEVsZW1lbnRBdHRyPg0KICA8SW50TGlzdD4NCiAgICA8aW50PjEyMzwvaW50Pg0KICA8L0ludExpc3Q+DQogIDxTdHJpbmdMaXN0Pg0KICAgIDxzdHJpbmc+Rm9vPC9zdHJpbmc+DQogICAgPHN0cmluZz5CYXI8L3N0cmluZz4NCiAgPC9TdHJpbmdMaXN0Pg0KICA8QW5vdGhlclN0cmluZ0xpc3Q+DQogICAgPHN0cmluZz5Bbm90aGVyRm9vPC9zdHJpbmc+DQogIDwvQW5vdGhlclN0cmluZ0xpc3Q+DQo8L1R5cGVXaXRoTGlzdFByb3BlcnRpZXNXaXRob3V0UHVibGljU2V0dGVycz4iKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlByb3BlcnR5V2l0aFhtbEVsZW1lbnRBdHRyaWJ1dGUuQ291bnQsIGFjdHVhbC5Qcm9wZXJ0eVdpdGhYbWxFbGVtZW50QXR0cmlidXRlLkNvdW50KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlByb3BlcnR5V2l0aFhtbEVsZW1lbnRBdHRyaWJ1dGVbMF0sIGFjdHVhbC5Qcm9wZXJ0eVdpdGhYbWxFbGVtZW50QXR0cmlidXRlWzBdKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlByb3BlcnR5V2l0aFhtbEVsZW1lbnRBdHRyaWJ1dGVbMV0sIGFjdHVhbC5Qcm9wZXJ0eVdpdGhYbWxFbGVtZW50QXR0cmlidXRlWzFdKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkludExpc3QuQ291bnQsIGFjdHVhbC5JbnRMaXN0LkNvdW50KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkludExpc3RbMF0sIGFjdHVhbC5JbnRMaXN0WzBdKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlN0cmluZ0xpc3QuQ291bnQsIGFjdHVhbC5TdHJpbmdMaXN0LkNvdW50KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlN0cmluZ0xpc3RbMF0sIGFjdHVhbC5TdHJpbmdMaXN0WzBdKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlN0cmluZ0xpc3RbMV0sIGFjdHVhbC5TdHJpbmdMaXN0WzFdKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkFub3RoZXJTdHJpbmdMaXN0LkNvdW50LCBhY3R1YWwuQW5vdGhlclN0cmluZ0xpc3QuQ291bnQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuQW5vdGhlclN0cmluZ0xpc3RbMF0sIGFjdHVhbC5Bbm90aGVyU3RyaW5nTGlzdFswXSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5QdWJsaWNJbnRMaXN0RmllbGRbMF0sIGFjdHVhbC5QdWJsaWNJbnRMaXN0RmllbGRbMF0pOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuUHVibGljSW50TGlzdEZpZWxkV2l0aFhtbEVsZW1lbnRBdHRyaWJ1dGVbMF0sIGFjdHVhbC5QdWJsaWNJbnRMaXN0RmllbGRXaXRoWG1sRWxlbWVudEF0dHJpYnV0ZVswXSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9IaWdoU2NvcmVNYW5hZ2VyKCkNCiAgICB7DQogICAgICAgIExpc3Q8SGlnaFNjb3Jlcy5CcmlkZ2VHYW1lSGlnaFNjb3JlPiB2YWx1ZSA9IG5ldyBMaXN0PEhpZ2hTY29yZXMuQnJpZGdlR2FtZUhpZ2hTY29yZT4oKTsNCiAgICAgICAgSGlnaFNjb3Jlcy5CcmlkZ2VHYW1lSGlnaFNjb3JlIGJnaHMgPSBuZXcgSGlnaFNjb3Jlcy5CcmlkZ2VHYW1lSGlnaFNjb3JlKCkgeyBJZCA9IDEyMywgTmFtZSA9ICJGb28iIH07DQogICAgICAgIHZhbHVlLkFkZChiZ2hzKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPExpc3Q8SGlnaFNjb3Jlcy5CcmlkZ2VHYW1lSGlnaFNjb3JlPj4odmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8QXJyYXlPZkJyaWRnZUdhbWVIaWdoU2NvcmUgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8QnJpZGdlR2FtZUhpZ2hTY29yZT4NCiAgICA8SWQ+MTIzPC9JZD4NCiAgICA8TmFtZT5Gb288L05hbWU+DQogIDwvQnJpZGdlR2FtZUhpZ2hTY29yZT4NCjwvQXJyYXlPZkJyaWRnZUdhbWVIaWdoU2NvcmU+Iik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCgxLCBhY3R1YWwuQ291bnQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWVbMF0uSWQsIGFjdHVhbFswXS5JZCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZVswXS5OYW1lLCBhY3R1YWxbMF0uTmFtZSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aE5lc3RlZFB1YmxpY1R5cGUoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IExpc3Q8VHlwZVdpdGhOZXN0ZWRQdWJsaWNUeXBlLkxldmVsRGF0YT4oKTsNCiAgICAgICAgdmFsdWUuQWRkKG5ldyBUeXBlV2l0aE5lc3RlZFB1YmxpY1R5cGUuTGV2ZWxEYXRhKCkgeyBOYW1lID0gIkZvbyIgfSk7DQogICAgICAgIHZhbHVlLkFkZChuZXcgVHlwZVdpdGhOZXN0ZWRQdWJsaWNUeXBlLkxldmVsRGF0YSgpIHsgTmFtZSA9ICJCYXIiIH0pOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8QXJyYXlPZkxldmVsRGF0YSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxMZXZlbERhdGE+DQogICAgPE5hbWU+Rm9vPC9OYW1lPg0KICA8L0xldmVsRGF0YT4NCiAgPExldmVsRGF0YT4NCiAgICA8TmFtZT5CYXI8L05hbWU+DQogIDwvTGV2ZWxEYXRhPg0KPC9BcnJheU9mTGV2ZWxEYXRhPiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoMiwgYWN0dWFsLkNvdW50KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlWzBdLk5hbWUsIGFjdHVhbFswXS5OYW1lKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlWzFdLk5hbWUsIGFjdHVhbFsxXS5OYW1lKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1B1YmxpY1R5cGVXaXRoTmVzdGVkUHVibGljVHlwZVdpdGhOZXN0ZWRQdWJsaWNUeXBlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBMaXN0PFB1YmxpY1R5cGVXaXRoTmVzdGVkUHVibGljVHlwZVdpdGhOZXN0ZWRQdWJsaWNUeXBlLk5lc3RlZFB1YmxpY1R5cGUuTGV2ZWxEYXRhPigpOw0KICAgICAgICB2YWx1ZS5BZGQobmV3IFB1YmxpY1R5cGVXaXRoTmVzdGVkUHVibGljVHlwZVdpdGhOZXN0ZWRQdWJsaWNUeXBlLk5lc3RlZFB1YmxpY1R5cGUuTGV2ZWxEYXRhKCkgeyBOYW1lID0gIkZvbyIgfSk7DQogICAgICAgIHZhbHVlLkFkZChuZXcgUHVibGljVHlwZVdpdGhOZXN0ZWRQdWJsaWNUeXBlV2l0aE5lc3RlZFB1YmxpY1R5cGUuTmVzdGVkUHVibGljVHlwZS5MZXZlbERhdGEoKSB7IE5hbWUgPSAiQmFyIiB9KTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEFycmF5T2ZMZXZlbERhdGEgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8TGV2ZWxEYXRhPg0KICAgIDxOYW1lPkZvbzwvTmFtZT4NCiAgPC9MZXZlbERhdGE+DQogIDxMZXZlbERhdGE+DQogICAgPE5hbWU+QmFyPC9OYW1lPg0KICA8L0xldmVsRGF0YT4NCjwvQXJyYXlPZkxldmVsRGF0YT4iKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKDIsIGFjdHVhbC5Db3VudCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZVswXS5OYW1lLCBhY3R1YWxbMF0uTmFtZSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZVsxXS5OYW1lLCBhY3R1YWxbMV0uTmFtZSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UZXN0RGVzZXJpYWxpemluZ1Vua25vd25Ob2RlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyB4bWxGaWxlQ29udGVudCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIiA/Pg0KPEFycmF5T2ZTZXJpYWxpemFibGVTbGlkZT4NCiAgPFNlcmlhbGl6YWJsZVNsaWRlPg0KICAgIDxJbWFnZU5hbWU+U2Vjb25kQWR2ZW50dXJlSW1hZ2U8L0ltYWdlTmFtZT4NCiAgICA8SW1hZ2VQYXRoPjwvSW1hZ2VQYXRoPg0KICAgIDxEZXNjcmlwdGlvbj4NCiAgICAgIEF2YWlsYWJsZSBOb3chDQogICAgICBFcGlzb2RlIDINCiAgICA8L0Rlc2NyaXB0aW9uPg0KICAgIDxFdmVudFR5cGU+TGF1bmNoU2VjdGlvbjwvRXZlbnRUeXBlPg0KICAgIDxFdmVudERhdGE+QWR2ZW50dXJlcy5FcGlzb2RlMi5EZXRhaWxzPC9FdmVudERhdGE+DQogIDwvU2VyaWFsaXphYmxlU2xpZGU+DQogIDxTZXJpYWxpemFibGVTbGlkZT4NCiAgICA8SW1hZ2VOYW1lPlNlY29uZEFkdmVudHVyZUltYWdlPC9JbWFnZU5hbWU+DQogICAgPEltYWdlUGF0aD48L0ltYWdlUGF0aD4NCiAgICA8RGVzY3JpcHRpb24+DQogICAgICBBdmFpbGFibGUgTm93IQ0KICAgICAgRXBpc29kZSAyDQogICAgPC9EZXNjcmlwdGlvbj4NCiAgICA8RXZlbnRUeXBlPkxhdW5jaFNlY3Rpb248L0V2ZW50VHlwZT4NCiAgICA8RXZlbnREYXRhPkFkdmVudHVyZXMuRXBpc29kZTIuRGV0YWlsczwvRXZlbnREYXRhPg0KICA8L1NlcmlhbGl6YWJsZVNsaWRlPg0KPC9BcnJheU9mU2VyaWFsaXphYmxlU2xpZGU+IjsNCiAgICAgICAgTWVtb3J5U3RyZWFtIHN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKTsNCiAgICAgICAgU3RyZWFtV3JpdGVyIHN3ID0gbmV3IFN0cmVhbVdyaXRlcihzdHJlYW0pOw0KICAgICAgICBzdy5Xcml0ZUxpbmUoeG1sRmlsZUNvbnRlbnQpOw0KICAgICAgICBzdy5GbHVzaCgpOw0KICAgICAgICBYbWxTZXJpYWxpemVyIHNlcmlhbGl6ZXIgPSBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoTGlzdDxTZXJpYWxpemFibGVTbGlkZT4pKTsNCiAgICAgICAgc3RyZWFtLlNlZWsoMCwgU2Vla09yaWdpbi5CZWdpbik7DQogICAgICAgIExpc3Q8U2VyaWFsaXphYmxlU2xpZGU+IGFjdHVhbCA9IChMaXN0PFNlcmlhbGl6YWJsZVNsaWRlPilzZXJpYWxpemVyLkRlc2VyaWFsaXplKHN0cmVhbSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCgyLCBhY3R1YWwuQ291bnQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoIlNlY29uZEFkdmVudHVyZUltYWdlIiwgYWN0dWFsWzBdLkltYWdlTmFtZSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTbGlkZUV2ZW50VHlwZS5MYXVuY2hTZWN0aW9uLCBhY3R1YWxbMF0uRXZlbnRUeXBlKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKCJBZHZlbnR1cmVzLkVwaXNvZGUyLkRldGFpbHMiLCBhY3R1YWxbMF0uRXZlbnREYXRhKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGFjdHVhbFswXS5JbWFnZU5hbWUsIGFjdHVhbFsxXS5JbWFnZU5hbWUpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoYWN0dWFsWzBdLkV2ZW50VHlwZSwgYWN0dWFsWzFdLkV2ZW50VHlwZSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChhY3R1YWxbMF0uRXZlbnREYXRhLCBhY3R1YWxbMV0uRXZlbnREYXRhKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVXaXRoTm9uUGFyYW1ldGVybGVzc0NvbnN0cnVjdG9yKCkNCiAgICB7DQogICAgICAgIHZhciBvYmogPSBuZXcgVHlwZVdpdGhOb25QYXJhbWV0ZXJsZXNzQ29uc3RydWN0b3IoInN0cmluZyB2YWx1ZSIpOw0KICAgICAgICBBc3NlcnQuVGhyb3dzPEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCgpID0+IHsgU2VyaWFsaXplQW5kRGVzZXJpYWxpemUob2JqLCBzdHJpbmcuRW1wdHkpOyB9KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0Zyb21UeXBlcygpDQogICAgew0KICAgICAgICB2YXIgc2VyaWFsaXplcnMgPSBYbWxTZXJpYWxpemVyLkZyb21UeXBlcyhuZXcgVHlwZVtdIHsgdHlwZW9mKEd1aWQpLCB0eXBlb2YoTGlzdDxzdHJpbmc+KSB9KTsNCiAgICAgICAgWG1sX0d1aWRBc1Jvb3Qoc2VyaWFsaXplcnNbMF0pOw0KICAgICAgICBYbWxfTGlzdEdlbmVyaWNSb290KHNlcmlhbGl6ZXJzWzFdKTsNCg0KICAgICAgICBzZXJpYWxpemVycyA9IFhtbFNlcmlhbGl6ZXIuRnJvbVR5cGVzKG51bGwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoMCwgc2VyaWFsaXplcnMuTGVuZ3RoKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0NvbnN0cnVjdG9yV2l0aFhtbFJvb3RBdHRyKCkNCiAgICB7DQogICAgICAgIHZhciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mIChMaXN0PHN0cmluZz4pLCBuZXcgWG1sUm9vdEF0dHJpYnV0ZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEVsZW1lbnROYW1lID0gIlBsYWNlcyIsDQogICAgICAgICAgICBOYW1lc3BhY2UgPSAiaHR0cDovL3d3dy5taWNyb3NvZnQuY29tIiwNCiAgICAgICAgfSk7DQogICAgICAgIHZhciBleHBlY3RlZCA9IG5ldyBMaXN0PHN0cmluZz4oKSB7ICJNYWRpc29uIiwgIlJvY2hlc3RlciIsIG51bGwsICJBcmxpbmd0b24iIH07DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZShleHBlY3RlZCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PFBsYWNlcyB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgeG1sbnM9IiJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20iIj48c3RyaW5nPk1hZGlzb248L3N0cmluZz48c3RyaW5nPlJvY2hlc3Rlcjwvc3RyaW5nPjxzdHJpbmcgeHNpOm5pbD0iInRydWUiIiAvPjxzdHJpbmc+QXJsaW5ndG9uPC9zdHJpbmc+PC9QbGFjZXM+IiwNCiAgICAgICAgICAgICgpID0+IHNlcmlhbGl6ZXIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShleHBlY3RlZC5TZXF1ZW5jZUVxdWFsKGFjdHVhbCkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfQ29uc3RydWN0b3JXaXRoWG1sQXR0cmlidXRlT3ZlcnJpZGVzKCkNCiAgICB7DQogICAgICAgIHZhciBleHBlY3RlZCA9IG5ldyBNdXNpYy5PcmNoZXN0cmEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbnN0cnVtZW50cyA9IG5ldyBNdXNpYy5JbnN0cnVtZW50W10NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBuZXcgTXVzaWMuQnJhc3MoKSB7IE5hbWUgPSAiVHJ1bXBldCIsIElzVmFsdmVkID0gdHJ1ZSB9LA0KICAgICAgICAgICAgICAgIG5ldyBNdXNpYy5CcmFzcygpIHsgTmFtZSA9ICJDb3JuZXQiLCBJc1ZhbHZlZCA9IHRydWUgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICB2YXIgb3ZlcnJpZGVzID0gbmV3IFhtbEF0dHJpYnV0ZU92ZXJyaWRlcygpOw0KICAgICAgICBvdmVycmlkZXMuQWRkKHR5cGVvZiAoTXVzaWMuT3JjaGVzdHJhKSwgIkluc3RydW1lbnRzIiwgbmV3IFhtbEF0dHJpYnV0ZXMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxFbGVtZW50cyA9IHtuZXcgWG1sRWxlbWVudEF0dHJpYnV0ZSgiQnJhc3MiLCB0eXBlb2YgKE11c2ljLkJyYXNzKSl9DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIFhtbFNlcmlhbGl6ZXIoVHlwZSwgWG1sQXR0cmlidXRlT3ZlcnJpZGVzKQ0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZiAoTXVzaWMuT3JjaGVzdHJhKSwgb3ZlcnJpZGVzKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKGV4cGVjdGVkLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48T3JjaGVzdHJhIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj48QnJhc3M+PE5hbWU+VHJ1bXBldDwvTmFtZT48SXNWYWx2ZWQ+dHJ1ZTwvSXNWYWx2ZWQ+PC9CcmFzcz48QnJhc3M+PE5hbWU+Q29ybmV0PC9OYW1lPjxJc1ZhbHZlZD50cnVlPC9Jc1ZhbHZlZD48L0JyYXNzPjwvT3JjaGVzdHJhPiIsDQogICAgICAgICAgICAoKSA9PiBzZXJpYWxpemVyKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGV4cGVjdGVkLkluc3RydW1lbnRzWzBdLk5hbWUsIGFjdHVhbC5JbnN0cnVtZW50c1swXS5OYW1lKTsNCg0KICAgICAgICAvLyBYbWxTZXJpYWxpemVyKFR5cGUsIFhtbEF0dHJpYnV0ZU92ZXJyaWRlcywgVHlwZVtdLCBYbWxSb290QXR0cmlidXRlLCBTdHJpbmcpDQogICAgICAgIHZhciByb290ID0gbmV3IFhtbFJvb3RBdHRyaWJ1dGUoIkNvbGxlY3Rpb24iKTsNCiAgICAgICAgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihNdXNpYy5PcmNoZXN0cmEpLCBvdmVycmlkZXMsIG5ldyBUeXBlWzBdLCByb290LCAiZGVmYXVsdE5hbWVzcGFjZSIpOw0KICAgICAgICBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZShleHBlY3RlZCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PENvbGxlY3Rpb24geG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiICB4bWxucz0iImRlZmF1bHROYW1lc3BhY2UiIj48QnJhc3M+PE5hbWU+VHJ1bXBldDwvTmFtZT48SXNWYWx2ZWQ+dHJ1ZTwvSXNWYWx2ZWQ+PC9CcmFzcz48QnJhc3M+PE5hbWU+Q29ybmV0PC9OYW1lPjxJc1ZhbHZlZD50cnVlPC9Jc1ZhbHZlZD48L0JyYXNzPjwvQ29sbGVjdGlvbj4iLA0KICAgICAgICAgICAgKCkgPT4gc2VyaWFsaXplcik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChleHBlY3RlZC5JbnN0cnVtZW50c1swXS5OYW1lLCBhY3R1YWwuSW5zdHJ1bWVudHNbMF0uTmFtZSk7DQoNCiAgICAgICAgQXNzZXJ0LlRocm93czxBcmd1bWVudE51bGxFeGNlcHRpb24+KCgpID0+DQogICAgICAgIHsNCiAgICAgICAgICAgIG5ldyBYbWxTZXJpYWxpemVyKG51bGwsIG92ZXJyaWRlcyk7DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIFtDb25kaXRpb25hbEZhY3QobmFtZW9mKElzVGltZVNwYW5TZXJpYWxpemF0aW9uQXZhaWxhYmxlKSldDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UaW1lU3BhbkFzUm9vdCgpDQogICAgew0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwobmV3IFRpbWVTcGFuKDEsIDIsIDMpLCBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxUaW1lU3Bhbj4obmV3IFRpbWVTcGFuKDEsIDIsIDMpLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz4NCjxUaW1lU3Bhbj5QVDFIMk0zUzwvVGltZVNwYW4+IikpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoVGltZVNwYW4uWmVybywgU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VGltZVNwYW4+KFRpbWVTcGFuLlplcm8sDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/Pg0KPFRpbWVTcGFuPlBUMFM8L1RpbWVTcGFuPiIpKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFRpbWVTcGFuLk1pblZhbHVlLCBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxUaW1lU3Bhbj4oVGltZVNwYW4uTWluVmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/Pg0KPFRpbWVTcGFuPi1QMTA2NzUxOTlEVDJINDhNNS40Nzc1ODA4UzwvVGltZVNwYW4+IikpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoVGltZVNwYW4uTWF4VmFsdWUsIFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFRpbWVTcGFuPihUaW1lU3Bhbi5NYXhWYWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+DQo8VGltZVNwYW4+UDEwNjc1MTk5RFQySDQ4TTUuNDc3NTgwN1M8L1RpbWVTcGFuPiIpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1htbEF0dHJpYnV0ZXNfUmVtb3ZlWG1sRWxlbWVudEF0dHJpYnV0ZV9UaHJvd3NPbk1pc3NpbmdJdGVtKCkNCiAgICB7DQogICAgICAgIFhtbEF0dHJpYnV0ZXMgYXR0cnMgPSBuZXcgWG1sQXR0cmlidXRlcygpOw0KDQogICAgICAgIFhtbEVsZW1lbnRBdHRyaWJ1dGUgaXRlbTEgPSBuZXcgWG1sRWxlbWVudEF0dHJpYnV0ZSgiZWxlbTEiKTsNCiAgICAgICAgYXR0cnMuWG1sRWxlbWVudHMuQWRkKGl0ZW0xKTsNCg0KICAgICAgICBYbWxFbGVtZW50QXR0cmlidXRlIGl0ZW0yID0gbmV3IFhtbEVsZW1lbnRBdHRyaWJ1dGUoImVsZW0yIik7DQogICAgICAgIGF0dHJzLlhtbEVsZW1lbnRzLkFkZChpdGVtMik7DQogICAgICAgIEFzc2VydC5UcnVlKGF0dHJzLlhtbEVsZW1lbnRzLkNvbnRhaW5zKGl0ZW0xKSk7DQogICAgICAgIEFzc2VydC5UcnVlKGF0dHJzLlhtbEVsZW1lbnRzLkNvbnRhaW5zKGl0ZW0yKSk7DQoNCiAgICAgICAgYXR0cnMuWG1sRWxlbWVudHMuUmVtb3ZlKGl0ZW0yKTsNCiAgICAgICAgQXNzZXJ0LkZhbHNlKGF0dHJzLlhtbEVsZW1lbnRzLkNvbnRhaW5zKGl0ZW0yKSk7DQoNCiAgICAgICAgQXNzZXJ0RXh0ZW5zaW9ucy5UaHJvd3M8QXJndW1lbnRFeGNlcHRpb24+KG51bGwsICgpID0+IHsgYXR0cnMuWG1sRWxlbWVudHMuUmVtb3ZlKGl0ZW0yKTsgfSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9YbWxBdHRyaWJ1dGVzX1JlbW92ZVhtbEFycmF5SXRlbUF0dHJpYnV0ZSgpDQogICAgew0KICAgICAgICBYbWxBdHRyaWJ1dGVzIGF0dHJzID0gbmV3IFhtbEF0dHJpYnV0ZXMoKTsNCg0KICAgICAgICBYbWxBcnJheUl0ZW1BdHRyaWJ1dGUgaXRlbSA9IG5ldyBYbWxBcnJheUl0ZW1BdHRyaWJ1dGUoIml0ZW0xIik7DQogICAgICAgIGF0dHJzLlhtbEFycmF5SXRlbXMuQWRkKGl0ZW0pOw0KICAgICAgICBBc3NlcnQuVHJ1ZShhdHRycy5YbWxBcnJheUl0ZW1zLkNvbnRhaW5zKGl0ZW0pKTsNCg0KICAgICAgICBhdHRycy5YbWxBcnJheUl0ZW1zLlJlbW92ZShpdGVtKTsNCiAgICAgICAgQXNzZXJ0LkZhbHNlKGF0dHJzLlhtbEFycmF5SXRlbXMuQ29udGFpbnMoaXRlbSkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfWG1sQXR0cmlidXRlc19SZW1vdmVYbWxBcnJheUl0ZW1BdHRyaWJ1dGVfVGhyb3dzT25NaXNzaW5nSXRlbSgpDQogICAgew0KICAgICAgICBYbWxBdHRyaWJ1dGVzIGF0dHJzID0gbmV3IFhtbEF0dHJpYnV0ZXMoKTsNCg0KICAgICAgICBYbWxBcnJheUl0ZW1BdHRyaWJ1dGUgaXRlbTEgPSBuZXcgWG1sQXJyYXlJdGVtQXR0cmlidXRlKCJpdGVtMSIpOw0KICAgICAgICBhdHRycy5YbWxBcnJheUl0ZW1zLkFkZChpdGVtMSk7DQoNCiAgICAgICAgWG1sQXJyYXlJdGVtQXR0cmlidXRlIGl0ZW0yID0gbmV3IFhtbEFycmF5SXRlbUF0dHJpYnV0ZSgiaXRlbTIiKTsNCiAgICAgICAgYXR0cnMuWG1sQXJyYXlJdGVtcy5BZGQoaXRlbTIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShhdHRycy5YbWxBcnJheUl0ZW1zLkNvbnRhaW5zKGl0ZW0xKSk7DQogICAgICAgIEFzc2VydC5UcnVlKGF0dHJzLlhtbEFycmF5SXRlbXMuQ29udGFpbnMoaXRlbTIpKTsNCg0KICAgICAgICBhdHRycy5YbWxBcnJheUl0ZW1zLlJlbW92ZShpdGVtMik7DQogICAgICAgIEFzc2VydC5GYWxzZShhdHRycy5YbWxBcnJheUl0ZW1zLkNvbnRhaW5zKGl0ZW0yKSk7DQoNCiAgICAgICAgQXNzZXJ0RXh0ZW5zaW9ucy5UaHJvd3M8QXJndW1lbnRFeGNlcHRpb24+KG51bGwsICgpID0+IHsgYXR0cnMuWG1sQXJyYXlJdGVtcy5SZW1vdmUoaXRlbTIpOyB9KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1htbEF0dHJpYnV0ZXNfUmVtb3ZlWG1sQW55RWxlbWVudEF0dHJpYnV0ZSgpDQogICAgew0KICAgICAgICBYbWxBdHRyaWJ1dGVzIGF0dHJzID0gbmV3IFhtbEF0dHJpYnV0ZXMoKTsNCg0KICAgICAgICBYbWxBbnlFbGVtZW50QXR0cmlidXRlIGl0ZW0gPSBuZXcgWG1sQW55RWxlbWVudEF0dHJpYnV0ZSgiZWxlbTEiKTsNCiAgICAgICAgYXR0cnMuWG1sQW55RWxlbWVudHMuQWRkKGl0ZW0pOw0KICAgICAgICBBc3NlcnQuVHJ1ZShhdHRycy5YbWxBbnlFbGVtZW50cy5Db250YWlucyhpdGVtKSk7DQoNCiAgICAgICAgYXR0cnMuWG1sQW55RWxlbWVudHMuUmVtb3ZlKGl0ZW0pOw0KICAgICAgICBBc3NlcnQuRmFsc2UoYXR0cnMuWG1sQW55RWxlbWVudHMuQ29udGFpbnMoaXRlbSkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfWG1sQXR0cmlidXRlc19SZW1vdmVYbWxBbnlFbGVtZW50QXR0cmlidXRlVGhyb3dzT25NaXNzaW5nSXRlbSgpDQogICAgew0KICAgICAgICBYbWxBdHRyaWJ1dGVzIGF0dHJzID0gbmV3IFhtbEF0dHJpYnV0ZXMoKTsNCg0KICAgICAgICBYbWxBbnlFbGVtZW50QXR0cmlidXRlIGl0ZW0xID0gbmV3IFhtbEFueUVsZW1lbnRBdHRyaWJ1dGUoImVsZW0xIik7DQogICAgICAgIGF0dHJzLlhtbEFueUVsZW1lbnRzLkFkZChpdGVtMSk7DQoNCiAgICAgICAgWG1sQW55RWxlbWVudEF0dHJpYnV0ZSBpdGVtMiA9IG5ldyBYbWxBbnlFbGVtZW50QXR0cmlidXRlKCJlbGVtMiIpOw0KICAgICAgICBhdHRycy5YbWxBbnlFbGVtZW50cy5BZGQoaXRlbTIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShhdHRycy5YbWxBbnlFbGVtZW50cy5Db250YWlucyhpdGVtMSkpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShhdHRycy5YbWxBbnlFbGVtZW50cy5Db250YWlucyhpdGVtMikpOw0KDQogICAgICAgIGF0dHJzLlhtbEFueUVsZW1lbnRzLlJlbW92ZShpdGVtMik7DQogICAgICAgIEFzc2VydC5GYWxzZShhdHRycy5YbWxBbnlFbGVtZW50cy5Db250YWlucyhpdGVtMikpOw0KDQogICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPEFyZ3VtZW50RXhjZXB0aW9uPihudWxsLCAoKSA9PiB7IGF0dHJzLlhtbEFueUVsZW1lbnRzLlJlbW92ZShpdGVtMik7IH0pOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhUd29EaW1lbnNpb25hbEFycmF5UHJvcGVydHkxKCkNCiAgICB7DQogICAgICAgIFNpbXBsZVR5cGVbXVtdIHNpbXBsZVR5cGUyRCA9IEdldE9iamVjdHdpdGgyREFycmF5T2ZTaW1wbGVUeXBlKCk7DQoNCiAgICAgICAgdmFyIG9iaiA9IG5ldyBUeXBlV2l0aDJEQXJyYXlQcm9wZXJ0eTEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBUd29EQXJyYXlPZlNpbXBsZVR5cGUgPSBzaW1wbGVUeXBlMkQNCiAgICAgICAgfTsNCg0KICAgICAgICBzdHJpbmcgYmFzZWxpbmUgPSAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+XHJcbjxUeXBlV2l0aDJEQXJyYXlQcm9wZXJ0eTEgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDxUd29EQXJyYXlPZlNpbXBsZVR5cGU+XHJcbiAgICA8QXJyYXlPZlNpbXBsZVR5cGU+XHJcbiAgICAgIDxTaW1wbGVUeXBlPlxyXG4gICAgICAgIDxQMT4wIDAgdmFsdWU8L1AxPlxyXG4gICAgICAgIDxQMj4xPC9QMj5cclxuICAgICAgPC9TaW1wbGVUeXBlPlxyXG4gICAgICA8U2ltcGxlVHlwZT5cclxuICAgICAgICA8UDE+MCAxIHZhbHVlPC9QMT5cclxuICAgICAgICA8UDI+MjwvUDI+XHJcbiAgICAgIDwvU2ltcGxlVHlwZT5cclxuICAgIDwvQXJyYXlPZlNpbXBsZVR5cGU+XHJcbiAgICA8QXJyYXlPZlNpbXBsZVR5cGU+XHJcbiAgICAgIDxTaW1wbGVUeXBlPlxyXG4gICAgICAgIDxQMT4xIDAgdmFsdWU8L1AxPlxyXG4gICAgICAgIDxQMj4zPC9QMj5cclxuICAgICAgPC9TaW1wbGVUeXBlPlxyXG4gICAgICA8U2ltcGxlVHlwZT5cclxuICAgICAgICA8UDE+MSAxIHZhbHVlPC9QMT5cclxuICAgICAgICA8UDI+NDwvUDI+XHJcbiAgICAgIDwvU2ltcGxlVHlwZT5cclxuICAgIDwvQXJyYXlPZlNpbXBsZVR5cGU+XHJcbiAgPC9Ud29EQXJyYXlPZlNpbXBsZVR5cGU+XHJcbjwvVHlwZVdpdGgyREFycmF5UHJvcGVydHkxPiI7DQogICAgICAgIFR5cGVXaXRoMkRBcnJheVByb3BlcnR5MSBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZShvYmosIGJhc2VsaW5lKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoU2ltcGxlVHlwZS5BcmVFcXVhbChzaW1wbGVUeXBlMkRbMF1bMF0sIGFjdHVhbC5Ud29EQXJyYXlPZlNpbXBsZVR5cGVbMF1bMF0pKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoU2ltcGxlVHlwZS5BcmVFcXVhbChzaW1wbGVUeXBlMkRbMF1bMV0sIGFjdHVhbC5Ud29EQXJyYXlPZlNpbXBsZVR5cGVbMF1bMV0pKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoU2ltcGxlVHlwZS5BcmVFcXVhbChzaW1wbGVUeXBlMkRbMV1bMF0sIGFjdHVhbC5Ud29EQXJyYXlPZlNpbXBsZVR5cGVbMV1bMF0pKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoU2ltcGxlVHlwZS5BcmVFcXVhbChzaW1wbGVUeXBlMkRbMV1bMV0sIGFjdHVhbC5Ud29EQXJyYXlPZlNpbXBsZVR5cGVbMV1bMV0pKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVXaXRoWG1sRWxlbWVudHNBbmRVbm5hbWVkWG1sQW55KCkNCiAgICB7DQogICAgICAgIFhtbERvY3VtZW50IHhEb2MgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCiAgICAgICAgeERvYy5Mb2FkWG1sKEAiPGh0bWw+PC9odG1sPiIpOw0KICAgICAgICBYbWxFbGVtZW50IGVsZW1lbnQgPSB4RG9jLkNyZWF0ZUVsZW1lbnQoIkVsZW1lbnQiKTsNCiAgICAgICAgZWxlbWVudC5Jbm5lclRleHQgPSAiRWxlbWVudCBpbm5lcnRleHQiOw0KDQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFhtbEVsZW1lbnRzQW5kVW5uYW1lZFhtbEFueSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFRoaW5ncyA9IG5ldyBvYmplY3RbXSB7IDEsICIyIiwgZWxlbWVudH0NCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQogICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiPz5cclxuPE15WG1sVHlwZSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCI+XHJcbiAgPGludD4xPC9pbnQ+XHJcbiAgPHN0cmluZz4yPC9zdHJpbmc+XHJcbiAgPEVsZW1lbnQ+RWxlbWVudCBpbm5lcnRleHQ8L0VsZW1lbnQ+XHJcbjwvTXlYbWxUeXBlPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbC5UaGluZ3MpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuVGhpbmdzLkxlbmd0aCwgYWN0dWFsLlRoaW5ncy5MZW5ndGgpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShhY3R1YWwuVGhpbmdzWzJdIGlzIFhtbEVsZW1lbnQpOw0KDQogICAgICAgIHZhciBleHBlY3RlZEVsZW0gPSAoWG1sRWxlbWVudCl2YWx1ZS5UaGluZ3NbMl07DQogICAgICAgIHZhciBhY3R1YWxFbGVtID0gKFhtbEVsZW1lbnQpYWN0dWFsLlRoaW5nc1syXTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGV4cGVjdGVkRWxlbS5OYW1lLCBhY3R1YWxFbGVtLk5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZXhwZWN0ZWRFbGVtLk5hbWVzcGFjZVVSSSwgYWN0dWFsRWxlbS5OYW1lc3BhY2VVUkkpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZXhwZWN0ZWRFbGVtLklubmVyVGV4dCwgYWN0dWFsRWxlbS5Jbm5lclRleHQpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhNdWx0aVhtbEFueUVsZW1lbnQoKQ0KICAgIHsNCiAgICAgICAgWG1sRG9jdW1lbnQgeERvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICB4RG9jLkxvYWRYbWwoQCI8aHRtbD48L2h0bWw+Iik7DQogICAgICAgIFhtbEVsZW1lbnQgZWxlbWVudDEgPSB4RG9jLkNyZWF0ZUVsZW1lbnQoIm5hbWUxIiwgIm5zMSIpOw0KICAgICAgICBlbGVtZW50MS5Jbm5lclRleHQgPSAiRWxlbWVudCBpbm5lcnRleHQxIjsNCiAgICAgICAgWG1sRWxlbWVudCBlbGVtZW50MiA9IHhEb2MuQ3JlYXRlRWxlbWVudCgibmFtZTIiLCAibnMyIik7DQogICAgICAgIGVsZW1lbnQyLklubmVyVGV4dCA9ICJFbGVtZW50IGlubmVydGV4dDIiOw0KDQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aE11bHRpTmFtZWRYbWxBbnlFbGVtZW50KCkNCiAgICAgICAgew0KICAgICAgICAgICAgVGhpbmdzID0gbmV3IG9iamVjdFtdIHsgZWxlbWVudDEsIGVsZW1lbnQyIH0NCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQogICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiPz5cclxuPE15WG1sVHlwZSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCI+XHJcbiAgPG5hbWUxIHhtbG5zPVwibnMxXCI+RWxlbWVudCBpbm5lcnRleHQxPC9uYW1lMT5cclxuICA8bmFtZTIgeG1sbnM9XCJuczJcIj5FbGVtZW50IGlubmVydGV4dDI8L25hbWUyPlxyXG48L015WG1sVHlwZT4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwuVGhpbmdzKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlRoaW5ncy5MZW5ndGgsIGFjdHVhbC5UaGluZ3MuTGVuZ3RoKTsNCg0KICAgICAgICB2YXIgZXhwZWN0ZWRFbGVtID0gKFhtbEVsZW1lbnQpdmFsdWUuVGhpbmdzWzFdOw0KICAgICAgICB2YXIgYWN0dWFsRWxlbSA9IChYbWxFbGVtZW50KWFjdHVhbC5UaGluZ3NbMV07DQogICAgICAgIEFzc2VydC5FcXVhbChleHBlY3RlZEVsZW0uTmFtZSwgYWN0dWFsRWxlbS5OYW1lKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGV4cGVjdGVkRWxlbS5OYW1lc3BhY2VVUkksIGFjdHVhbEVsZW0uTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGV4cGVjdGVkRWxlbS5Jbm5lclRleHQsIGFjdHVhbEVsZW0uSW5uZXJUZXh0KTsNCg0KICAgICAgICBYbWxFbGVtZW50IGVsZW1lbnQzID0geERvYy5DcmVhdGVFbGVtZW50KCJuYW1lMyIsICJuczMiKTsNCiAgICAgICAgZWxlbWVudDMuSW5uZXJUZXh0ID0gIkVsZW1lbnQgaW5uZXJ0ZXh0MyI7DQogICAgICAgIHZhbHVlID0gbmV3IFR5cGVXaXRoTXVsdGlOYW1lZFhtbEFueUVsZW1lbnQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBUaGluZ3MgPSBuZXcgb2JqZWN0W10geyBlbGVtZW50MyB9DQogICAgICAgIH07DQoNCiAgICAgICAgQXNzZXJ0LlRocm93czxJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uPigoKSA9PiBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwgc3RyaW5nLkVtcHR5LCBza2lwU3RyaW5nQ29tcGFyZTogdHJ1ZSkpOw0KICAgIH0NCg0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aE11bHRpTmFtZWRYbWxBbnlFbGVtZW50QW5kT3RoZXJGaWVsZHMoKQ0KICAgIHsNCiAgICAgICAgWG1sRG9jdW1lbnQgeERvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICB4RG9jLkxvYWRYbWwoQCI8aHRtbD48L2h0bWw+Iik7DQogICAgICAgIFhtbEVsZW1lbnQgZWxlbWVudDEgPSB4RG9jLkNyZWF0ZUVsZW1lbnQoIm5hbWUxIiwgIm5zMSIpOw0KICAgICAgICBlbGVtZW50MS5Jbm5lclRleHQgPSAiRWxlbWVudCBpbm5lcnRleHQxIjsNCiAgICAgICAgWG1sRWxlbWVudCBlbGVtZW50MiA9IHhEb2MuQ3JlYXRlRWxlbWVudCgibmFtZTIiLCAibnMyIik7DQogICAgICAgIGVsZW1lbnQyLklubmVyVGV4dCA9ICJFbGVtZW50IGlubmVydGV4dDIiOw0KDQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aE11bHRpTmFtZWRYbWxBbnlFbGVtZW50QW5kT3RoZXJGaWVsZHMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBUaGluZ3MgPSBuZXcgb2JqZWN0W10geyBlbGVtZW50MSwgZWxlbWVudDIgfSwNCiAgICAgICAgICAgIFN0cmluZ0ZpZWxkID0gImZvbyIsDQogICAgICAgICAgICBJbnRGaWVsZCA9IDEyMw0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwNCiAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48TXlYbWxUeXBlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5cclxuICA8bmFtZTEgeG1sbnM9XCJuczFcIj5FbGVtZW50IGlubmVydGV4dDE8L25hbWUxPlxyXG4gIDxuYW1lMiB4bWxucz1cIm5zMlwiPkVsZW1lbnQgaW5uZXJ0ZXh0MjwvbmFtZTI+XHJcbiAgPFN0cmluZ0ZpZWxkPmZvbzwvU3RyaW5nRmllbGQ+XHJcbiAgPEludEZpZWxkPjEyMzwvSW50RmllbGQ+XHJcbjwvTXlYbWxUeXBlPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbC5UaGluZ3MpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuVGhpbmdzLkxlbmd0aCwgYWN0dWFsLlRoaW5ncy5MZW5ndGgpOw0KDQogICAgICAgIHZhciBleHBlY3RlZEVsZW0gPSAoWG1sRWxlbWVudCl2YWx1ZS5UaGluZ3NbMV07DQogICAgICAgIHZhciBhY3R1YWxFbGVtID0gKFhtbEVsZW1lbnQpYWN0dWFsLlRoaW5nc1sxXTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGV4cGVjdGVkRWxlbS5OYW1lLCBhY3R1YWxFbGVtLk5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZXhwZWN0ZWRFbGVtLk5hbWVzcGFjZVVSSSwgYWN0dWFsRWxlbS5OYW1lc3BhY2VVUkkpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZXhwZWN0ZWRFbGVtLklubmVyVGV4dCwgYWN0dWFsRWxlbS5Jbm5lclRleHQpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYTUxfVHlwZVdpdGhBcnJheUxpa2VYbWxBdHRyaWJ1dGUoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFR5cGVXaXRoU3RyaW5nQXJyYXlBc1htbEF0dHJpYnV0ZSgpIHsgWG1sQXR0cmlidXRlRm9ybXMgPSBuZXcgc3RyaW5nW10geyAiU29tZVZhbHVlMSIsICJTb21lVmFsdWUyIiB9IH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48TXlYbWxUeXBlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBYbWxBdHRyaWJ1dGVGb3Jtcz1cIlNvbWVWYWx1ZTEgU29tZVZhbHVlMlwiIC8+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoRW51bWVyYWJsZS5TZXF1ZW5jZUVxdWFsKHZhbHVlLlhtbEF0dHJpYnV0ZUZvcm1zLCBhY3R1YWwuWG1sQXR0cmlidXRlRm9ybXMpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWE1MX1R5cGVXaXRoQXJyYXlMaWtlWG1sQXR0cmlidXRlV2l0aEZpZWxkcygpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhBcnJheUxpa2VYbWxBdHRyaWJ1dGVXaXRoRmllbGRzKCkgeyBYbWxBdHRyaWJ1dGVGb3JtcyA9IG5ldyBzdHJpbmdbXSB7ICJTb21lVmFsdWUxIiwgIlNvbWVWYWx1ZTIiIH0sIFN0cmluZ0ZpZWxkID0gImZvbyIsIEludEZpZWxkID0gMTIzIH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48TXlYbWxUeXBlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBYbWxBdHRyaWJ1dGVGb3Jtcz1cIlNvbWVWYWx1ZTEgU29tZVZhbHVlMlwiPlxyXG4gIDxTdHJpbmdGaWVsZD5mb288L1N0cmluZ0ZpZWxkPlxyXG4gIDxJbnRGaWVsZD4xMjM8L0ludEZpZWxkPlxyXG48L015WG1sVHlwZT4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuU3RyaW5nRmllbGQsIGFjdHVhbC5TdHJpbmdGaWVsZCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5JbnRGaWVsZCwgYWN0dWFsLkludEZpZWxkKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoRW51bWVyYWJsZS5TZXF1ZW5jZUVxdWFsKHZhbHVlLlhtbEF0dHJpYnV0ZUZvcm1zLCBhY3R1YWwuWG1sQXR0cmlidXRlRm9ybXMpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWE1MX1R5cGVXaXRoQnl0ZUFycmF5QXNYbWxBdHRyaWJ1dGUoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFR5cGVXaXRoQnl0ZUFycmF5QXNYbWxBdHRyaWJ1dGUoKSB7IFhtbEF0dHJpYnV0ZUZvcm1zID0gbmV3IGJ5dGVbXSB7IDAsIDEsIDIgfSB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiPz5cclxuPE15WG1sVHlwZSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgWG1sQXR0cmlidXRlRm9ybXM9XCJBQUVDXCIgLz4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShFbnVtZXJhYmxlLlNlcXVlbmNlRXF1YWwodmFsdWUuWG1sQXR0cmlidXRlRm9ybXMsIGFjdHVhbC5YbWxBdHRyaWJ1dGVGb3JtcykpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYTUxfVHlwZVdpdGhCeXRlQXJyYXlBcnJheUFzWG1sQXR0cmlidXRlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aEJ5dGVBcnJheUFycmF5QXNYbWxBdHRyaWJ1dGUoKSB7IFhtbEF0dHJpYnV0ZUZvcm1zID0gbmV3IGJ5dGVbXVtdIHsgbmV3IGJ5dGVbXSB7IDEgfSwgbmV3IGJ5dGVbXSB7IDIgfSB9IH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48TXlYbWxUeXBlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBYbWxBdHRyaWJ1dGVGb3Jtcz1cIkFRPT0gQWc9PVwiIC8+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlhtbEF0dHJpYnV0ZUZvcm1zWzBdWzBdLCBhY3R1YWwuWG1sQXR0cmlidXRlRm9ybXNbMF1bMF0pOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuWG1sQXR0cmlidXRlRm9ybXNbMV1bMF0sIGFjdHVhbC5YbWxBdHRyaWJ1dGVGb3Jtc1sxXVswXSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhNTF9UeXBlV2l0aFFOYW1lQXJyYXlBc1htbEF0dHJpYnV0ZSgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhRTmFtZUFycmF5QXNYbWxBdHRyaWJ1dGUoKSB7IFhtbEF0dHJpYnV0ZUZvcm1zID0gbmV3IFhtbFF1YWxpZmllZE5hbWVbXSB7IG5ldyBYbWxRdWFsaWZpZWROYW1lKCJTb21lVmFsdWUxIiwgIm5zMSIpLCBuZXcgWG1sUXVhbGlmaWVkTmFtZSgiU29tZVZhbHVlMiIsICJuczIiKSB9IH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48TXlYbWxUeXBlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiB4bWxuczpxMT1cIm5zMVwiIHhtbG5zOnEyPVwibnMyXCIgWG1sQXR0cmlidXRlRm9ybXM9XCJxMTpTb21lVmFsdWUxIHEyOlNvbWVWYWx1ZTJcIiAvPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5UcnVlKEVudW1lcmFibGUuU2VxdWVuY2VFcXVhbCh2YWx1ZS5YbWxBdHRyaWJ1dGVGb3JtcywgYWN0dWFsLlhtbEF0dHJpYnV0ZUZvcm1zKSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhNTF9UeXBlV2l0aEVudW1BcnJheUFzWG1sQXR0cmlidXRlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aEVudW1BcnJheUFzWG1sQXR0cmlidXRlKCkgeyBYbWxBdHRyaWJ1dGVGb3JtcyA9IG5ldyBJbnRFbnVtW10geyBJbnRFbnVtLk9wdGlvbjEsIEludEVudW0uT3B0aW9uMiB9IH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48TXlYbWxUeXBlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBYbWxBdHRyaWJ1dGVGb3Jtcz1cIk9wdGlvbjEgT3B0aW9uMlwiIC8+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoRW51bWVyYWJsZS5TZXF1ZW5jZUVxdWFsKHZhbHVlLlhtbEF0dHJpYnV0ZUZvcm1zLCBhY3R1YWwuWG1sQXR0cmlidXRlRm9ybXMpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sU2NoZW1hVGVzdCgpDQogICAgew0KICAgICAgICB2YXIgc2NoZW1hcyA9IG5ldyBYbWxTY2hlbWFzKCk7DQogICAgICAgIHZhciBleHBvcnRlciA9IG5ldyBYbWxTY2hlbWFFeHBvcnRlcihzY2hlbWFzKTsNCiAgICAgICAgLy9JbXBvcnQgdGhlIHR5cGUgYXMgYW4gWE1MIG1hcHBpbmcNCiAgICAgICAgWG1sVHlwZU1hcHBpbmcgb3JpZ2luYWxtYXBwaW5nID0gbmV3IFhtbFJlZmxlY3Rpb25JbXBvcnRlcigpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihEb2cpKTsNCiAgICAgICAgLy9FeHBvcnQgdGhlIFhNTCBtYXBwaW5nIGludG8gc2NoZW1hcw0KICAgICAgICBleHBvcnRlci5FeHBvcnRUeXBlTWFwcGluZyhvcmlnaW5hbG1hcHBpbmcpOw0KICAgICAgICAvL1ByaW50IG91dCB0aGUgc2NoZW1hcw0KICAgICAgICB2YXIgc2NoZW1hRW51bWVyYXRvciA9IG5ldyBYbWxTY2hlbWFFbnVtZXJhdG9yKHNjaGVtYXMpOw0KICAgICAgICB2YXIgbXMgPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQogICAgICAgIHN0cmluZyBiYXNlbGluZSA9ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48eHM6c2NoZW1hIGVsZW1lbnRGb3JtRGVmYXVsdD1cInF1YWxpZmllZFwiIHhtbG5zOnhzPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5cclxuICA8eHM6ZWxlbWVudCBuYW1lPVwiRG9nXCIgbmlsbGFibGU9XCJ0cnVlXCIgdHlwZT1cIkRvZ1wiIC8+XHJcbiAgPHhzOmNvbXBsZXhUeXBlIG5hbWU9XCJEb2dcIj5cclxuICAgIDx4czpjb21wbGV4Q29udGVudCBtaXhlZD1cImZhbHNlXCI+XHJcbiAgICAgIDx4czpleHRlbnNpb24gYmFzZT1cIkFuaW1hbFwiPlxyXG4gICAgICAgIDx4czpzZXF1ZW5jZT5cclxuICAgICAgICAgIDx4czplbGVtZW50IG1pbk9jY3Vycz1cIjFcIiBtYXhPY2N1cnM9XCIxXCIgbmFtZT1cImJyZWVkXCIgdHlwZT1cIkRvZ0JyZWVkXCIgLz5cclxuICAgICAgICA8L3hzOnNlcXVlbmNlPlxyXG4gICAgICA8L3hzOmV4dGVuc2lvbj5cclxuICAgIDwveHM6Y29tcGxleENvbnRlbnQ+XHJcbiAgPC94czpjb21wbGV4VHlwZT5cclxuICA8eHM6Y29tcGxleFR5cGUgbmFtZT1cIkFuaW1hbFwiPlxyXG4gICAgPHhzOnNlcXVlbmNlPlxyXG4gICAgICA8eHM6ZWxlbWVudCBtaW5PY2N1cnM9XCIxXCIgbWF4T2NjdXJzPVwiMVwiIG5hbWU9XCJhZ2VcIiB0eXBlPVwieHM6aW50XCIgLz5cclxuICAgICAgPHhzOmVsZW1lbnQgbWluT2NjdXJzPVwiMFwiIG1heE9jY3Vycz1cIjFcIiBuYW1lPVwibmFtZVwiIHR5cGU9XCJ4czpzdHJpbmdcIiAvPlxyXG4gICAgPC94czpzZXF1ZW5jZT5cclxuICA8L3hzOmNvbXBsZXhUeXBlPlxyXG4gIDx4czpzaW1wbGVUeXBlIG5hbWU9XCJEb2dCcmVlZFwiPlxyXG4gICAgPHhzOnJlc3RyaWN0aW9uIGJhc2U9XCJ4czpzdHJpbmdcIj5cclxuICAgICAgPHhzOmVudW1lcmF0aW9uIHZhbHVlPVwiR2VybWFuU2hlcGhlcmRcIiAvPlxyXG4gICAgICA8eHM6ZW51bWVyYXRpb24gdmFsdWU9XCJMYWJyYWRvclJldHJpZXZlclwiIC8+XHJcbiAgICA8L3hzOnJlc3RyaWN0aW9uPlxyXG4gIDwveHM6c2ltcGxlVHlwZT5cclxuPC94czpzY2hlbWE+IjsNCiAgICAgICAgc2NoZW1hRW51bWVyYXRvci5Nb3ZlTmV4dCgpOw0KICAgICAgICBzY2hlbWFFbnVtZXJhdG9yLkN1cnJlbnQuV3JpdGUobXMpOw0KICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQogICAgICAgIHN0cmluZyBhY3R1YWxPdXRwdXQgPSBuZXcgU3RyZWFtUmVhZGVyKG1zKS5SZWFkVG9FbmQoKTsNCiAgICAgICAgVXRpbHMuQ29tcGFyZVJlc3VsdCByZXN1bHQgPSBVdGlscy5Db21wYXJlKGJhc2VsaW5lLCBhY3R1YWxPdXRwdXQpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShyZXN1bHQuRXF1YWwsIHN0cmluZy5Gb3JtYXQoInsxfXswfVRlc3QgZmFpbGVkIGZvciB3cm9uZyBvdXRwdXQgZnJvbSBzY2hlbWE6IHswfUV4cGVjdGVkOiB7Mn17MH1BY3R1YWw6IHszfSIsDQogICAgICAgICAgICAgICAgRW52aXJvbm1lbnQuTmV3TGluZSwgcmVzdWx0LkVycm9yTWVzc2FnZSwgYmFzZWxpbmUsIGFjdHVhbE91dHB1dCkpOw0KICAgICAgICBBc3NlcnQuRmFsc2Uoc2NoZW1hRW51bWVyYXRvci5Nb3ZlTmV4dCgpKTsNCiAgICAgICAgc2NoZW1hcy5Db21waWxlKChvLCBhcmdzKSA9PiB7DQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbihzdHJpbmcuRm9ybWF0KCJ7MX17MH0gVGVzdCBmYWlsZWQgYmVjYXVzZSBzY2hlbWEgY29tcGlsZSBmYWlsZWQiLCBFbnZpcm9ubWVudC5OZXdMaW5lLCBhcmdzLk1lc3NhZ2UpKTsNCiAgICAgICAgfSwgdHJ1ZSk7DQogICAgICAgIHZhciBpbXBvcnRlciA9IG5ldyBYbWxTY2hlbWFJbXBvcnRlcihzY2hlbWFzKTsNCiAgICAgICAgLy8vL0ltcG9ydCB0aGUgc2NoZW1hIGVsZW1lbnQgYmFjayBpbnRvIGFuIFhNTCBtYXBwaW5nDQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG5ld21hcHBpbmcgPSBpbXBvcnRlci5JbXBvcnRUeXBlTWFwcGluZyhuZXcgWG1sUXVhbGlmaWVkTmFtZShvcmlnaW5hbG1hcHBpbmcuRWxlbWVudE5hbWUsIG9yaWdpbmFsbWFwcGluZy5OYW1lc3BhY2UpKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwobmV3bWFwcGluZyk7DQogICAgICAgIEFzc2VydC5FcXVhbChvcmlnaW5hbG1hcHBpbmcuRWxlbWVudE5hbWUsIG5ld21hcHBpbmcuRWxlbWVudE5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwob3JpZ2luYWxtYXBwaW5nLlR5cGVGdWxsTmFtZSwgbmV3bWFwcGluZy5UeXBlRnVsbE5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwob3JpZ2luYWxtYXBwaW5nLlhzZFR5cGVOYW1lLCBuZXdtYXBwaW5nLlhzZFR5cGVOYW1lKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKG9yaWdpbmFsbWFwcGluZy5Yc2RUeXBlTmFtZXNwYWNlLCBuZXdtYXBwaW5nLlhzZFR5cGVOYW1lc3BhY2UpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiZG90bmV0L2NvcmVmeCAjMTg5NjQiKV0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgIFNvYXBBdHRyaWJ1dGVUZXN0cygpDQogICAgew0KICAgICAgICBTb2FwQXR0cmlidXRlcyBzb2FwQXR0cnMgPSBuZXcgU29hcEF0dHJpYnV0ZXMoKTsNCiAgICAgICAgU29hcEF0dHJpYnV0ZU92ZXJyaWRlcyBzb2FwT3ZlcnJpZGVzID0gbmV3IFNvYXBBdHRyaWJ1dGVPdmVycmlkZXMoKTsNCiAgICAgICAgU29hcEVsZW1lbnRBdHRyaWJ1dGUgc29hcEVsZW1lbnQxID0gbmV3IFNvYXBFbGVtZW50QXR0cmlidXRlKCJUcnVjayIpOw0KICAgICAgICBzb2FwQXR0cnMuU29hcEVsZW1lbnQgPSBzb2FwRWxlbWVudDE7DQogICAgICAgIHNvYXBPdmVycmlkZXMuQWRkKHR5cGVvZihTb2FwRW5jb2RlZFRlc3RUeXBlMiksICJWZWhpY2xlIiwgc29hcEF0dHJzKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX0NvbXBsZXhGaWVsZCgpDQogICAgew0KICAgICAgICBYbWxUeXBlTWFwcGluZyB0eXBlTWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKFNvYXBFbmNvZGVkVGVzdFR5cGUyKSk7DQogICAgICAgIHZhciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZU1hcHBpbmcpOw0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgU29hcEVuY29kZWRUZXN0VHlwZTIoKTsNCiAgICAgICAgdmFsdWUuVGVzdFR5cGUzID0gbmV3IFNvYXBFbmNvZGVkVGVzdFR5cGUzKCkgeyBTdHJpbmdWYWx1ZSA9ICJmb28iIH07DQogICAgICAgIHN0cmluZyBiYXNlbGluZSA9ICI8cm9vdD48U29hcEVuY29kZWRUZXN0VHlwZTIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGlkPVwiaWQxXCI+PFRlc3RUeXBlMyBocmVmPVwiI2lkMlwiIC8+PC9Tb2FwRW5jb2RlZFRlc3RUeXBlMj48U29hcEVuY29kZWRUZXN0VHlwZTMgaWQ9XCJpZDJcIiBkMnAxOnR5cGU9XCJTb2FwRW5jb2RlZFRlc3RUeXBlM1wiIHhtbG5zOmQycDE9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiPjxTdHJpbmdWYWx1ZSB4bWxuczpxMT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgZDJwMTp0eXBlPVwicTE6c3RyaW5nXCI+Zm9vPC9TdHJpbmdWYWx1ZT48L1NvYXBFbmNvZGVkVGVzdFR5cGUzPjwvcm9vdD4iOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemVXaXRoV3JhcHBlcih2YWx1ZSwgc2VyaWFsaXplciwgYmFzZWxpbmUpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbC5UZXN0VHlwZTMpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuVGVzdFR5cGUzLlN0cmluZ1ZhbHVlLCBhY3R1YWwuVGVzdFR5cGUzLlN0cmluZ1ZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX0Jhc2ljKCkNCiAgICB7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcigpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihTb2FwRW5jb2RlZFRlc3RUeXBlMSkpOw0KICAgICAgICB2YXIgc2VyID0gbmV3IFhtbFNlcmlhbGl6ZXIobXlUeXBlTWFwcGluZyk7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBTb2FwRW5jb2RlZFRlc3RUeXBlMSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEludFZhbHVlID0gMTEsDQogICAgICAgICAgICBEb3VibGVWYWx1ZSA9IDEyLjAsDQogICAgICAgICAgICBTdHJpbmdWYWx1ZSA9ICJhYmMiLA0KICAgICAgICAgICAgRGF0ZVRpbWVWYWx1ZSA9IG5ldyBEYXRlVGltZSgxMDAwKQ0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgIGJhc2VsaW5lOiAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFNvYXBFbmNvZGVkVGVzdFR5cGUxIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiPlxyXG4gIDxJbnRWYWx1ZSB4c2k6dHlwZT1cInhzZDppbnRcIj4xMTwvSW50VmFsdWU+XHJcbiAgPERvdWJsZVZhbHVlIHhzaTp0eXBlPVwieHNkOmRvdWJsZVwiPjEyPC9Eb3VibGVWYWx1ZT5cclxuICA8U3RyaW5nVmFsdWUgeHNpOnR5cGU9XCJ4c2Q6c3RyaW5nXCI+YWJjPC9TdHJpbmdWYWx1ZT5cclxuICA8RGF0ZVRpbWVWYWx1ZSB4c2k6dHlwZT1cInhzZDpkYXRlVGltZVwiPjAwMDEtMDEtMDFUMDA6MDA6MDAuMDAwMTwvRGF0ZVRpbWVWYWx1ZT5cclxuPC9Tb2FwRW5jb2RlZFRlc3RUeXBlMT4iLA0KICAgICAgICAgICAgc2VyaWFsaXplckZhY3Rvcnk6ICgpID0+IHNlcik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkludFZhbHVlLCBhY3R1YWwuSW50VmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuRG91YmxlVmFsdWUsIGFjdHVhbC5Eb3VibGVWYWx1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TdHJpbmdWYWx1ZSwgYWN0dWFsLlN0cmluZ1ZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkRhdGVUaW1lVmFsdWUsIGFjdHVhbC5EYXRlVGltZVZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX1R5cGVXaXRoTnVsbGFibGVGaWVsZHMoKQ0KICAgIHsNCiAgICAgICAgWG1sVHlwZU1hcHBpbmcgbXlUeXBlTWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKFNvYXBFbmNvZGVkVGVzdFR5cGU0KSk7DQogICAgICAgIHZhciBzZXIgPSBuZXcgWG1sU2VyaWFsaXplcihteVR5cGVNYXBwaW5nKTsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFNvYXBFbmNvZGVkVGVzdFR5cGU0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW50VmFsdWUgPSAxMSwNCiAgICAgICAgICAgIERvdWJsZVZhbHVlID0gMTIuMA0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgIGJhc2VsaW5lOiAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFNvYXBFbmNvZGVkVGVzdFR5cGU0IHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiPlxyXG4gIDxJbnRWYWx1ZSB4c2k6dHlwZT1cInhzZDppbnRcIj4xMTwvSW50VmFsdWU+XHJcbiAgPERvdWJsZVZhbHVlIHhzaTp0eXBlPVwieHNkOmRvdWJsZVwiPjEyPC9Eb3VibGVWYWx1ZT5cclxuPC9Tb2FwRW5jb2RlZFRlc3RUeXBlND4iLA0KICAgICAgICAgICAgc2VyaWFsaXplckZhY3Rvcnk6ICgpID0+IHNlcik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkludFZhbHVlLCBhY3R1YWwuSW50VmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuRG91YmxlVmFsdWUsIGFjdHVhbC5Eb3VibGVWYWx1ZSk7DQoNCiAgICAgICAgdmFsdWUgPSBuZXcgU29hcEVuY29kZWRUZXN0VHlwZTQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbnRWYWx1ZSA9IG51bGwsDQogICAgICAgICAgICBEb3VibGVWYWx1ZSA9IG51bGwNCiAgICAgICAgfTsNCg0KICAgICAgICBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgIGJhc2VsaW5lOiAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFNvYXBFbmNvZGVkVGVzdFR5cGU0IHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiPlxyXG4gIDxJbnRWYWx1ZSB4c2k6bmlsPVwidHJ1ZVwiIC8+XHJcbiAgPERvdWJsZVZhbHVlIHhzaTpuaWw9XCJ0cnVlXCIgLz5cclxuPC9Tb2FwRW5jb2RlZFRlc3RUeXBlND4iLA0KICAgICAgICAgICAgc2VyaWFsaXplckZhY3Rvcnk6ICgpID0+IHNlcik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkludFZhbHVlLCBhY3R1YWwuSW50VmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuRG91YmxlVmFsdWUsIGFjdHVhbC5Eb3VibGVWYWx1ZSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU29hcF9OdWxsYWJsZSgpDQogICAgew0KICAgICAgICBYbWxUeXBlTWFwcGluZyBpbnRNYXBwaW5nID0gbmV3IFNvYXBSZWZsZWN0aW9uSW1wb3J0ZXIoKS5JbXBvcnRUeXBlTWFwcGluZyh0eXBlb2YoaW50PykpOw0KICAgICAgICBpbnQ/IHZhbHVlID0gMTE7DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKA0KICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgYmFzZWxpbmU6ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48aW50IGQxcDE6dHlwZT1cImludFwiIHhtbG5zOmQxcDE9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj4xMTwvaW50PiIsDQogICAgICAgICAgICBzZXJpYWxpemVyRmFjdG9yeTogKCkgPT4gbmV3IFhtbFNlcmlhbGl6ZXIoaW50TWFwcGluZykpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUsIGFjdHVhbCk7DQoNCiAgICAgICAgWG1sVHlwZU1hcHBpbmcgc3RydWN0TWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKFNvbWVTdHJ1Y3Q/KSk7DQogICAgICAgIFNvbWVTdHJ1Y3Q/IHN0cnVjdFZhbHVlID0gbmV3IFNvbWVTdHJ1Y3QoKSB7IEEgPSAxLCBCID0gMiB9Ow0KDQogICAgICAgIHZhciBzdHJ1Y3RBY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlOiBzdHJ1Y3RWYWx1ZSwNCiAgICAgICAgICAgIGJhc2VsaW5lOiAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFNvbWVTdHJ1Y3QgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGlkPVwiaWQxXCI+XHJcbiAgPEEgeHNpOnR5cGU9XCJ4c2Q6aW50XCI+MTwvQT5cclxuICA8QiB4c2k6dHlwZT1cInhzZDppbnRcIj4yPC9CPlxyXG48L1NvbWVTdHJ1Y3Q+IiwNCiAgICAgICAgICAgIHNlcmlhbGl6ZXJGYWN0b3J5OiAoKSA9PiBuZXcgWG1sU2VyaWFsaXplcihzdHJ1Y3RNYXBwaW5nKSk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKHN0cnVjdEFjdHVhbCk7DQogICAgICAgIEFzc2VydC5FcXVhbChzdHJ1Y3RWYWx1ZS5WYWx1ZS5BLCBzdHJ1Y3RBY3R1YWwuVmFsdWUuQSk7DQogICAgICAgIEFzc2VydC5FcXVhbChzdHJ1Y3RWYWx1ZS5WYWx1ZS5CLCBzdHJ1Y3RBY3R1YWwuVmFsdWUuQik7DQoNCiAgICAgICAgc3RydWN0QWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoDQogICAgICAgICAgICB2YWx1ZTogKFNvbWVTdHJ1Y3Q/KW51bGwsDQogICAgICAgICAgICBiYXNlbGluZTogIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxTb21lU3RydWN0IHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiAvPiIsDQogICAgICAgICAgICBzZXJpYWxpemVyRmFjdG9yeTogKCkgPT4gbmV3IFhtbFNlcmlhbGl6ZXIoc3RydWN0TWFwcGluZykpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChzdHJ1Y3RBY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoMCwgc3RydWN0QWN0dWFsLlZhbHVlLkEpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoMCwgc3RydWN0QWN0dWFsLlZhbHVlLkIpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiZG90bmV0L2NvcmVmeCAjMTg5NjQiKV0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1NvYXBfQmFzaWNfRnJvbU1hcHBpbmdzKCkNCiAgICB7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcigpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihTb2FwRW5jb2RlZFRlc3RUeXBlMSkpOw0KICAgICAgICB2YXIgc2VyID0gWG1sU2VyaWFsaXplci5Gcm9tTWFwcGluZ3MobmV3IFhtbE1hcHBpbmdbXSB7IG15VHlwZU1hcHBpbmcgfSk7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBTb2FwRW5jb2RlZFRlc3RUeXBlMSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEludFZhbHVlID0gMTEsDQogICAgICAgICAgICBEb3VibGVWYWx1ZSA9IDEyLjAsDQogICAgICAgICAgICBTdHJpbmdWYWx1ZSA9ICJhYmMiLA0KICAgICAgICAgICAgRGF0ZVRpbWVWYWx1ZSA9IG5ldyBEYXRlVGltZSgxMDAwKQ0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxTb2FwRW5jb2RlZFRlc3RUeXBlMSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgaWQ9XCJpZDFcIj5cclxuICA8SW50VmFsdWUgeHNpOnR5cGU9XCJ4c2Q6aW50XCI+MTE8L0ludFZhbHVlPlxyXG4gIDxEb3VibGVWYWx1ZSB4c2k6dHlwZT1cInhzZDpkb3VibGVcIj4xMjwvRG91YmxlVmFsdWU+XHJcbiAgPFN0cmluZ1ZhbHVlIHhzaTp0eXBlPVwieHNkOnN0cmluZ1wiPmFiYzwvU3RyaW5nVmFsdWU+XHJcbiAgPERhdGVUaW1lVmFsdWUgeHNpOnR5cGU9XCJ4c2Q6ZGF0ZVRpbWVcIj4wMDAxLTAxLTAxVDAwOjAwOjAwLjAwMDE8L0RhdGVUaW1lVmFsdWU+XHJcbjwvU29hcEVuY29kZWRUZXN0VHlwZTE+IiwNCiAgICAgICAgICAgICgpID0+IHNlclswXSk7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkludFZhbHVlLCBhY3R1YWwuSW50VmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuRG91YmxlVmFsdWUsIGFjdHVhbC5Eb3VibGVWYWx1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TdHJpbmdWYWx1ZSwgYWN0dWFsLlN0cmluZ1ZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkRhdGVUaW1lVmFsdWUsIGFjdHVhbC5EYXRlVGltZVZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX1dpdGhfU29hcElnbm9yZSgpDQogICAgew0KICAgICAgICB2YXIgc29hcEF0dHJpYnV0ZXMgPSBuZXcgU29hcEF0dHJpYnV0ZXMoKTsNCiAgICAgICAgc29hcEF0dHJpYnV0ZXMuU29hcElnbm9yZSA9IHRydWU7DQoNCiAgICAgICAgdmFyIHNvYXBPdmVycmlkZXMgPSBuZXcgU29hcEF0dHJpYnV0ZU92ZXJyaWRlcygpOw0KICAgICAgICBzb2FwT3ZlcnJpZGVzLkFkZCh0eXBlb2YoU29hcEVuY29kZWRUZXN0VHlwZTEpLCAiSW50VmFsdWUiLCBzb2FwQXR0cmlidXRlcyk7DQoNCiAgICAgICAgWG1sVHlwZU1hcHBpbmcgbXlUeXBlTWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKHNvYXBPdmVycmlkZXMpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihTb2FwRW5jb2RlZFRlc3RUeXBlMSkpOw0KICAgICAgICB2YXIgc2VyID0gbmV3IFhtbFNlcmlhbGl6ZXIobXlUeXBlTWFwcGluZyk7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBTb2FwRW5jb2RlZFRlc3RUeXBlMSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEludFZhbHVlID0gMTEsDQogICAgICAgICAgICBEb3VibGVWYWx1ZSA9IDEyLjAsDQogICAgICAgICAgICBTdHJpbmdWYWx1ZSA9ICJhYmMiLA0KICAgICAgICAgICAgRGF0ZVRpbWVWYWx1ZSA9IG5ldyBEYXRlVGltZSgxMDAwKQ0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgIGJhc2VsaW5lOiAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFNvYXBFbmNvZGVkVGVzdFR5cGUxIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiPlxyXG4gIDxEb3VibGVWYWx1ZSB4c2k6dHlwZT1cInhzZDpkb3VibGVcIj4xMjwvRG91YmxlVmFsdWU+XHJcbiAgPFN0cmluZ1ZhbHVlIHhzaTp0eXBlPVwieHNkOnN0cmluZ1wiPmFiYzwvU3RyaW5nVmFsdWU+XHJcbiAgPERhdGVUaW1lVmFsdWUgeHNpOnR5cGU9XCJ4c2Q6ZGF0ZVRpbWVcIj4wMDAxLTAxLTAxVDAwOjAwOjAwLjAwMDE8L0RhdGVUaW1lVmFsdWU+XHJcbjwvU29hcEVuY29kZWRUZXN0VHlwZTE+IiwNCiAgICAgICAgICAgIHNlcmlhbGl6ZXJGYWN0b3J5OiAoKSA9PiBzZXIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5Ob3RFcXVhbCh2YWx1ZS5JbnRWYWx1ZSwgYWN0dWFsLkludFZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkRvdWJsZVZhbHVlLCBhY3R1YWwuRG91YmxlVmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuU3RyaW5nVmFsdWUsIGFjdHVhbC5TdHJpbmdWYWx1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5EYXRlVGltZVZhbHVlLCBhY3R1YWwuRGF0ZVRpbWVWYWx1ZSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU29hcF9XaXRoX1NvYXBFbGVtZW50KCkNCiAgICB7DQogICAgICAgIHZhciBzb2FwQXR0cmlidXRlcyA9IG5ldyBTb2FwQXR0cmlidXRlcygpOw0KICAgICAgICB2YXIgc29hcEVsZW1lbnQgPSBuZXcgU29hcEVsZW1lbnRBdHRyaWJ1dGUoIk15U3RyaW5nVmFsdWUiKTsNCiAgICAgICAgc29hcEF0dHJpYnV0ZXMuU29hcEVsZW1lbnQgPSBzb2FwRWxlbWVudDsNCg0KICAgICAgICB2YXIgc29hcE92ZXJyaWRlcyA9IG5ldyBTb2FwQXR0cmlidXRlT3ZlcnJpZGVzKCk7DQogICAgICAgIHNvYXBPdmVycmlkZXMuQWRkKHR5cGVvZihTb2FwRW5jb2RlZFRlc3RUeXBlMSksICJTdHJpbmdWYWx1ZSIsIHNvYXBBdHRyaWJ1dGVzKTsNCg0KICAgICAgICBYbWxUeXBlTWFwcGluZyBteVR5cGVNYXBwaW5nID0gbmV3IFNvYXBSZWZsZWN0aW9uSW1wb3J0ZXIoc29hcE92ZXJyaWRlcykuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKFNvYXBFbmNvZGVkVGVzdFR5cGUxKSk7DQogICAgICAgIHZhciBzZXIgPSBuZXcgWG1sU2VyaWFsaXplcihteVR5cGVNYXBwaW5nKTsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFNvYXBFbmNvZGVkVGVzdFR5cGUxKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW50VmFsdWUgPSAxMSwNCiAgICAgICAgICAgIERvdWJsZVZhbHVlID0gMTIuMCwNCiAgICAgICAgICAgIFN0cmluZ1ZhbHVlID0gImFiYyIsDQogICAgICAgICAgICBEYXRlVGltZVZhbHVlID0gbmV3IERhdGVUaW1lKDEwMDApDQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKA0KICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgYmFzZWxpbmU6ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48U29hcEVuY29kZWRUZXN0VHlwZTEgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGlkPVwiaWQxXCI+XHJcbiAgPEludFZhbHVlIHhzaTp0eXBlPVwieHNkOmludFwiPjExPC9JbnRWYWx1ZT5cclxuICA8RG91YmxlVmFsdWUgeHNpOnR5cGU9XCJ4c2Q6ZG91YmxlXCI+MTI8L0RvdWJsZVZhbHVlPlxyXG4gIDxNeVN0cmluZ1ZhbHVlIHhzaTp0eXBlPVwieHNkOnN0cmluZ1wiPmFiYzwvTXlTdHJpbmdWYWx1ZT5cclxuICA8RGF0ZVRpbWVWYWx1ZSB4c2k6dHlwZT1cInhzZDpkYXRlVGltZVwiPjAwMDEtMDEtMDFUMDA6MDA6MDAuMDAwMTwvRGF0ZVRpbWVWYWx1ZT5cclxuPC9Tb2FwRW5jb2RlZFRlc3RUeXBlMT4iLA0KICAgICAgICAgICAgc2VyaWFsaXplckZhY3Rvcnk6ICgpID0+IHNlcik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkludFZhbHVlLCBhY3R1YWwuSW50VmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuRG91YmxlVmFsdWUsIGFjdHVhbC5Eb3VibGVWYWx1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TdHJpbmdWYWx1ZSwgYWN0dWFsLlN0cmluZ1ZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkRhdGVUaW1lVmFsdWUsIGFjdHVhbC5EYXRlVGltZVZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX1dpdGhfU29hcFR5cGUoKQ0KICAgIHsNCiAgICAgICAgdmFyIHNvYXBBdHRyaWJ1dGVzID0gbmV3IFNvYXBBdHRyaWJ1dGVzKCk7DQogICAgICAgIHZhciBzb2FwVHlwZSA9IG5ldyBTb2FwVHlwZUF0dHJpYnV0ZSgpOw0KICAgICAgICBzb2FwVHlwZS5UeXBlTmFtZSA9ICJNeVR5cGUiOw0KICAgICAgICBzb2FwQXR0cmlidXRlcy5Tb2FwVHlwZSA9IHNvYXBUeXBlOw0KDQogICAgICAgIHZhciBzb2FwT3ZlcnJpZGVzID0gbmV3IFNvYXBBdHRyaWJ1dGVPdmVycmlkZXMoKTsNCiAgICAgICAgc29hcE92ZXJyaWRlcy5BZGQodHlwZW9mKFNvYXBFbmNvZGVkVGVzdFR5cGUxKSwgc29hcEF0dHJpYnV0ZXMpOw0KDQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcihzb2FwT3ZlcnJpZGVzKS5JbXBvcnRUeXBlTWFwcGluZyh0eXBlb2YoU29hcEVuY29kZWRUZXN0VHlwZTEpKTsNCiAgICAgICAgdmFyIHNlciA9IG5ldyBYbWxTZXJpYWxpemVyKG15VHlwZU1hcHBpbmcpOw0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgU29hcEVuY29kZWRUZXN0VHlwZTEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJbnRWYWx1ZSA9IDExLA0KICAgICAgICAgICAgRG91YmxlVmFsdWUgPSAxMi4wLA0KICAgICAgICAgICAgU3RyaW5nVmFsdWUgPSAiYWJjIiwNCiAgICAgICAgICAgIERhdGVUaW1lVmFsdWUgPSBuZXcgRGF0ZVRpbWUoMTAwMCkNCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoDQogICAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgICBiYXNlbGluZTogIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxNeVR5cGUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGlkPVwiaWQxXCI+XHJcbiAgPEludFZhbHVlIHhzaTp0eXBlPVwieHNkOmludFwiPjExPC9JbnRWYWx1ZT5cclxuICA8RG91YmxlVmFsdWUgeHNpOnR5cGU9XCJ4c2Q6ZG91YmxlXCI+MTI8L0RvdWJsZVZhbHVlPlxyXG4gIDxTdHJpbmdWYWx1ZSB4c2k6dHlwZT1cInhzZDpzdHJpbmdcIj5hYmM8L1N0cmluZ1ZhbHVlPlxyXG4gIDxEYXRlVGltZVZhbHVlIHhzaTp0eXBlPVwieHNkOmRhdGVUaW1lXCI+MDAwMS0wMS0wMVQwMDowMDowMC4wMDAxPC9EYXRlVGltZVZhbHVlPlxyXG48L015VHlwZT4iLA0KICAgICAgICAgICAgc2VyaWFsaXplckZhY3Rvcnk6ICgpID0+IHNlcik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkludFZhbHVlLCBhY3R1YWwuSW50VmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuRG91YmxlVmFsdWUsIGFjdHVhbC5Eb3VibGVWYWx1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TdHJpbmdWYWx1ZSwgYWN0dWFsLlN0cmluZ1ZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkRhdGVUaW1lVmFsdWUsIGFjdHVhbC5EYXRlVGltZVZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX0VudW0oKQ0KICAgIHsNCiAgICAgICAgWG1sVHlwZU1hcHBpbmcgbXlUeXBlTWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKFNvYXBFbmNvZGVkVGVzdEVudW0pKTsNCiAgICAgICAgdmFyIHNlciA9IG5ldyBYbWxTZXJpYWxpemVyKG15VHlwZU1hcHBpbmcpOw0KICAgICAgICB2YXIgdmFsdWUgPSBTb2FwRW5jb2RlZFRlc3RFbnVtLkE7DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKA0KICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgYmFzZWxpbmU6ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48U29hcEVuY29kZWRUZXN0RW51bSBkMXAxOnR5cGU9XCJTb2FwRW5jb2RlZFRlc3RFbnVtXCIgeG1sbnM6ZDFwMT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCI+U21hbGw8L1NvYXBFbmNvZGVkVGVzdEVudW0+IiwNCiAgICAgICAgICAgIHNlcmlhbGl6ZXJGYWN0b3J5OiAoKSA9PiBzZXIpOw0KDQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZSwgYWN0dWFsKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX0VudW1fV2l0aF9Tb2FwRW51bU92ZXJyaWRlcygpDQogICAgew0KICAgICAgICB2YXIgc29hcEF0dHMgPSBuZXcgU29hcEF0dHJpYnV0ZXMoKTsNCiAgICAgICAgdmFyIHNvYXBFbnVtID0gbmV3IFNvYXBFbnVtQXR0cmlidXRlKCk7DQogICAgICAgIHNvYXBFbnVtLk5hbWUgPSAiVGlueSI7DQogICAgICAgIHNvYXBBdHRzLlNvYXBFbnVtID0gc29hcEVudW07DQoNCiAgICAgICAgdmFyIHNvYXBBdHRyaWJ1dGVPdmVycmlkZXMgPSBuZXcgU29hcEF0dHJpYnV0ZU92ZXJyaWRlcygpOw0KICAgICAgICBzb2FwQXR0cmlidXRlT3ZlcnJpZGVzLkFkZCh0eXBlb2YoU29hcEVuY29kZWRUZXN0RW51bSksICJBIiwgc29hcEF0dHMpOw0KDQoNCiAgICAgICAgWG1sVHlwZU1hcHBpbmcgbXlUeXBlTWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKHNvYXBBdHRyaWJ1dGVPdmVycmlkZXMpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihTb2FwRW5jb2RlZFRlc3RFbnVtKSk7DQogICAgICAgIHZhciBzZXIgPSBuZXcgWG1sU2VyaWFsaXplcihteVR5cGVNYXBwaW5nKTsNCiAgICAgICAgdmFyIHZhbHVlID0gU29hcEVuY29kZWRUZXN0RW51bS5BOw0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgIGJhc2VsaW5lOiAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFNvYXBFbmNvZGVkVGVzdEVudW0gZDFwMTp0eXBlPVwiU29hcEVuY29kZWRUZXN0RW51bVwiIHhtbG5zOmQxcDE9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiPlRpbnk8L1NvYXBFbmNvZGVkVGVzdEVudW0+IiwNCiAgICAgICAgICAgIHNlcmlhbGl6ZXJGYWN0b3J5OiAoKSA9PiBzZXIpOw0KDQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZSwgYWN0dWFsKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFNvYXBFbmNvZGVkU2VyaWFsaXphdGlvbl9Tb2FwQXR0cmlidXRlKCkNCiAgICB7DQogICAgICAgIHZhciBzb2FwQXR0czEgPSBuZXcgU29hcEF0dHJpYnV0ZXMoKTsNCiAgICAgICAgdmFyIHNvYXBBdHQxID0gbmV3IFNvYXBBdHRyaWJ1dGVBdHRyaWJ1dGUoKTsNCiAgICAgICAgc29hcEF0dDEuTmFtZXNwYWNlID0gImh0dHA6Ly93d3cuY3BhbmRsLmNvbSI7DQogICAgICAgIHNvYXBBdHRzMS5Tb2FwQXR0cmlidXRlID0gc29hcEF0dDE7DQogICAgICAgIHZhciBzb2FwQXR0czIgPSBuZXcgU29hcEF0dHJpYnV0ZXMoKTsNCiAgICAgICAgdmFyIHNvYXBBdHQyID0gbmV3IFNvYXBBdHRyaWJ1dGVBdHRyaWJ1dGUoKTsNCiAgICAgICAgc29hcEF0dDIuRGF0YVR5cGUgPSAiZGF0ZSI7DQogICAgICAgIHNvYXBBdHQyLkF0dHJpYnV0ZU5hbWUgPSAiQ3JlYXRpb25EYXRlIjsNCiAgICAgICAgc29hcEF0dHMyLlNvYXBBdHRyaWJ1dGUgPSBzb2FwQXR0MjsNCiAgICAgICAgdmFyIHNvYXBBdHRyaWJ1dGVPdmVycmlkZXMgPSBuZXcgU29hcEF0dHJpYnV0ZU92ZXJyaWRlcygpOw0KICAgICAgICBzb2FwQXR0cmlidXRlT3ZlcnJpZGVzLkFkZCh0eXBlb2YoU29hcEVuY29kZWRUZXN0VHlwZTUpLCAiTmFtZSIsIHNvYXBBdHRzMSk7DQogICAgICAgIHNvYXBBdHRyaWJ1dGVPdmVycmlkZXMuQWRkKHR5cGVvZihTb2FwRW5jb2RlZFRlc3RUeXBlNSksICJUb2RheSIsIHNvYXBBdHRzMik7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcihzb2FwQXR0cmlidXRlT3ZlcnJpZGVzKS5JbXBvcnRUeXBlTWFwcGluZyh0eXBlb2YoU29hcEVuY29kZWRUZXN0VHlwZTUpKTsNCiAgICAgICAgdmFyIHNlciA9IG5ldyBYbWxTZXJpYWxpemVyKG15VHlwZU1hcHBpbmcpOw0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgU29hcEVuY29kZWRUZXN0VHlwZTUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBOYW1lID0gIk15TmFtZSIsDQogICAgICAgICAgICBQb3N0aXRpdmVJbnQgPSAiMTAiLA0KICAgICAgICAgICAgVG9kYXkgPSBuZXcgRGF0ZVRpbWUoMjAxMiwgMTAsIDEwKQ0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgIGJhc2VsaW5lOiAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFNvYXBFbmNvZGVkVGVzdFR5cGU1IHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiIGQxcDE6TmFtZT1cIk15TmFtZVwiIENyZWF0aW9uRGF0ZT1cIjIwMTctMDEtMjdcIiB4bWxuczpkMXAxPVwiaHR0cDovL3d3dy5jcGFuZGwuY29tXCI+XHJcbiAgPFBvc0ludCB4c2k6dHlwZT1cInhzZDpub25OZWdhdGl2ZUludGVnZXJcIj4xMDwvUG9zSW50PlxyXG48L1NvYXBFbmNvZGVkVGVzdFR5cGU1PiIsDQogICAgICAgICAgICBzZXJpYWxpemVyRmFjdG9yeTogKCkgPT4gc2VyKTsNCg0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuTmFtZSwgYWN0dWFsLk5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuUG9zdGl0aXZlSW50LCBhY3R1YWwuUG9zdGl0aXZlSW50KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlRvZGF5LCBhY3R1YWwuVG9kYXkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiZG90bmV0L2NvcmVmeCAjMTg5NjQiKV0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgU29hcEVuY29kZWRTZXJpYWxpemF0aW9uX0luY2x1ZGVUeXBlKCkNCiAgICB7DQogICAgICAgIHZhciBzb2FwSW1wb3J0ZXIgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcigpOw0KICAgICAgICBzb2FwSW1wb3J0ZXIuSW5jbHVkZVR5cGUodHlwZW9mKE15U3BlY2lhbE9yZGVyKSk7DQogICAgICAgIHNvYXBJbXBvcnRlci5JbmNsdWRlVHlwZSh0eXBlb2YoTXlTcGVjaWFsT3JkZXIyKSk7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBzb2FwSW1wb3J0ZXIuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKE15T3JkZXIpKTsNCiAgICAgICAgdmFyIHNlciA9IG5ldyBYbWxTZXJpYWxpemVyKG15VHlwZU1hcHBpbmcpOw0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgTXlTcGVjaWFsT3JkZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJRCA9IDEwLA0KICAgICAgICAgICAgTmFtZSA9ICJNeU5hbWUiLA0KICAgICAgICAgICAgU2Vjb25kYXJ5SUQgPSAxMDAwDQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKA0KICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgYmFzZWxpbmU6ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48TXlPcmRlciB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgaWQ9XCJpZDFcIiB4c2k6dHlwZT1cIk15U3BlY2lhbE9yZGVyXCI+XHJcbiAgPElEIHhzaTp0eXBlPVwieHNkOmludFwiPjEwPC9JRD5cclxuICA8TmFtZSB4c2k6dHlwZT1cInhzZDpzdHJpbmdcIj5NeU5hbWU8L05hbWU+XHJcbiAgPFNlY29uZGFyeUlEIHhzaTp0eXBlPVwieHNkOmludFwiPjEwMDA8L1NlY29uZGFyeUlEPlxyXG48L015T3JkZXI+IiwNCiAgICAgICAgICAgIHNlcmlhbGl6ZXJGYWN0b3J5OiAoKSA9PiBzZXIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5JRCwgYWN0dWFsLklEKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLk5hbWUsIGFjdHVhbC5OYW1lKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlNlY29uZGFyeUlELCBhY3R1YWwuU2Vjb25kYXJ5SUQpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiZG90bmV0L2NvcmVmeCAjMTg5NjQiKV0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgU29hcEVuY29kZWRTZXJpYWxpemF0aW9uX0NpcmN1bGFyTGluaygpDQogICAgew0KICAgICAgICBYbWxUeXBlTWFwcGluZyBteVR5cGVNYXBwaW5nID0gbmV3IFNvYXBSZWZsZWN0aW9uSW1wb3J0ZXIoKS5JbXBvcnRUeXBlTWFwcGluZyh0eXBlb2YoTXlDaXJjdWxhckxpbmspKTsNCiAgICAgICAgdmFyIHNlciA9IG5ldyBYbWxTZXJpYWxpemVyKG15VHlwZU1hcHBpbmcpOw0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgTXlDaXJjdWxhckxpbmsodHJ1ZSk7DQoNCiAgICAgICAgc3RyaW5nIGJhc2VsaW5lID0gIjxyb290PlxyXG4gIDxNeUNpcmN1bGFyTGluayB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgaWQ9XCJpZDFcIj5cclxuICAgIDxMaW5rIGhyZWY9XCIjaWQyXCIgLz5cclxuICAgIDxJbnRWYWx1ZSB4c2k6dHlwZT1cInhzZDppbnRcIj4wPC9JbnRWYWx1ZT5cclxuICA8L015Q2lyY3VsYXJMaW5rPlxyXG4gIDxNeUNpcmN1bGFyTGluayBpZD1cImlkMlwiIGQycDE6dHlwZT1cIk15Q2lyY3VsYXJMaW5rXCIgeG1sbnM6ZDJwMT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCI+XHJcbiAgICA8TGluayBocmVmPVwiI2lkM1wiIC8+XHJcbiAgICA8SW50VmFsdWUgeG1sbnM6cTE9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGQycDE6dHlwZT1cInExOmludFwiPjE8L0ludFZhbHVlPlxyXG4gIDwvTXlDaXJjdWxhckxpbms+XHJcbiAgPE15Q2lyY3VsYXJMaW5rIGlkPVwiaWQzXCIgZDJwMTp0eXBlPVwiTXlDaXJjdWxhckxpbmtcIiB4bWxuczpkMnAxPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIj5cclxuICAgIDxMaW5rIGhyZWY9XCIjaWQxXCIgLz5cclxuICAgIDxJbnRWYWx1ZSB4bWxuczpxMj1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgZDJwMTp0eXBlPVwicTI6aW50XCI+MjwvSW50VmFsdWU+XHJcbiAgPC9NeUNpcmN1bGFyTGluaz5cclxuPC9yb290PiI7DQogICAgICAgIHZhciBkZXNlcmlhbGl6ZWQgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZVdpdGhXcmFwcGVyKHZhbHVlLCBzZXIsIGJhc2VsaW5lKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoZGVzZXJpYWxpemVkKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkxpbmsuSW50VmFsdWUsIGRlc2VyaWFsaXplZC5MaW5rLkludFZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkxpbmsuTGluay5JbnRWYWx1ZSwgZGVzZXJpYWxpemVkLkxpbmsuTGluay5JbnRWYWx1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5MaW5rLkxpbmsuTGluay5JbnRWYWx1ZSwgZGVzZXJpYWxpemVkLkxpbmsuTGluay5MaW5rLkludFZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX0FycmF5KCkNCiAgICB7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcigpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihNeUdyb3VwKSk7DQogICAgICAgIFhtbFNlcmlhbGl6ZXIgc2VyID0gbmV3IFhtbFNlcmlhbGl6ZXIobXlUeXBlTWFwcGluZyk7DQogICAgICAgIE15SXRlbVtdIHRoaW5ncyA9IG5ldyBNeUl0ZW1bXSB7IG5ldyBNeUl0ZW0oKSB7IEl0ZW1OYW1lID0gIkFBQSIgfSwgbmV3IE15SXRlbSgpIHsgSXRlbU5hbWUgPSAiQkJCIiB9IH07DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBNeUdyb3VwKCkNCiAgICAgICAgew0KICAgICAgICAgICAgR3JvdXBOYW1lID0gIk15TmFtZSIsDQogICAgICAgICAgICBNeUl0ZW1zID0gdGhpbmdzDQogICAgICAgIH07DQoNCiAgICAgICAgc3RyaW5nIGJhc2VsaW5lID0gIjxyb290PlxyXG4gIDxNeUdyb3VwIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiPlxyXG4gICAgPEdyb3VwTmFtZSB4c2k6dHlwZT1cInhzZDpzdHJpbmdcIj5NeU5hbWU8L0dyb3VwTmFtZT5cclxuICAgIDxNeUl0ZW1zIGhyZWY9XCIjaWQyXCIgLz5cclxuICA8L015R3JvdXA+XHJcbiAgPHExOkFycmF5IGlkPVwiaWQyXCIgcTE6YXJyYXlUeXBlPVwiTXlJdGVtWzJdXCIgeG1sbnM6cTE9XCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9zb2FwL2VuY29kaW5nL1wiPlxyXG4gICAgPEl0ZW0gaHJlZj1cIiNpZDNcIiAvPlxyXG4gICAgPEl0ZW0gaHJlZj1cIiNpZDRcIiAvPlxyXG4gIDwvcTE6QXJyYXk+XHJcbiAgPE15SXRlbSBpZD1cImlkM1wiIGQycDE6dHlwZT1cIk15SXRlbVwiIHhtbG5zOmQycDE9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiPlxyXG4gICAgPEl0ZW1OYW1lIHhtbG5zOnEyPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBkMnAxOnR5cGU9XCJxMjpzdHJpbmdcIj5BQUE8L0l0ZW1OYW1lPlxyXG4gIDwvTXlJdGVtPlxyXG4gIDxNeUl0ZW0gaWQ9XCJpZDRcIiBkMnAxOnR5cGU9XCJNeUl0ZW1cIiB4bWxuczpkMnAxPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIj5cclxuICAgIDxJdGVtTmFtZSB4bWxuczpxMz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgZDJwMTp0eXBlPVwicTM6c3RyaW5nXCI+QkJCPC9JdGVtTmFtZT5cclxuICA8L015SXRlbT5cclxuPC9yb290PiI7DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZVdpdGhXcmFwcGVyKHZhbHVlLCBzZXIsIGJhc2VsaW5lKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkdyb3VwTmFtZSwgYWN0dWFsLkdyb3VwTmFtZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5NeUl0ZW1zLkNvdW50KCksIGFjdHVhbC5NeUl0ZW1zLkNvdW50KCkpOw0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHZhbHVlLk15SXRlbXMuQ291bnQoKTsgaSsrKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuTXlJdGVtc1tpXS5JdGVtTmFtZSwgYWN0dWFsLk15SXRlbXNbaV0uSXRlbU5hbWUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU29hcF9MaXN0KCkNCiAgICB7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcigpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihNeUdyb3VwMikpOw0KICAgICAgICB2YXIgc2VyID0gbmV3IFhtbFNlcmlhbGl6ZXIobXlUeXBlTWFwcGluZyk7DQogICAgICAgIExpc3Q8TXlJdGVtPiB0aGluZ3MgPSBuZXcgTGlzdDxNeUl0ZW0+KCkgeyBuZXcgTXlJdGVtKCkgeyBJdGVtTmFtZSA9ICJBQUEiIH0sIG5ldyBNeUl0ZW0oKSB7IEl0ZW1OYW1lID0gIkJCQiIgfSB9Ow0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgTXlHcm91cDIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBHcm91cE5hbWUgPSAiTXlOYW1lIiwNCiAgICAgICAgICAgIE15SXRlbXMgPSB0aGluZ3MNCiAgICAgICAgfTsNCg0KICAgICAgICBzdHJpbmcgYmFzZWxpbmUgPSAiPHJvb3Q+XHJcbiAgPE15R3JvdXAyIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiPlxyXG4gICAgPEdyb3VwTmFtZSB4c2k6dHlwZT1cInhzZDpzdHJpbmdcIj5NeU5hbWU8L0dyb3VwTmFtZT5cclxuICAgIDxNeUl0ZW1zIGhyZWY9XCIjaWQyXCIgLz5cclxuICA8L015R3JvdXAyPlxyXG4gIDxxMTpBcnJheSBpZD1cImlkMlwiIHExOmFycmF5VHlwZT1cIk15SXRlbVsyXVwiIHhtbG5zOnExPVwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbmNvZGluZy9cIj5cclxuICAgIDxJdGVtIGhyZWY9XCIjaWQzXCIgLz5cclxuICAgIDxJdGVtIGhyZWY9XCIjaWQ0XCIgLz5cclxuICA8L3ExOkFycmF5PlxyXG4gIDxNeUl0ZW0gaWQ9XCJpZDNcIiBkMnAxOnR5cGU9XCJNeUl0ZW1cIiB4bWxuczpkMnAxPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIj5cclxuICAgIDxJdGVtTmFtZSB4bWxuczpxMj1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgZDJwMTp0eXBlPVwicTI6c3RyaW5nXCI+QUFBPC9JdGVtTmFtZT5cclxuICA8L015SXRlbT5cclxuICA8TXlJdGVtIGlkPVwiaWQ0XCIgZDJwMTp0eXBlPVwiTXlJdGVtXCIgeG1sbnM6ZDJwMT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCI+XHJcbiAgICA8SXRlbU5hbWUgeG1sbnM6cTM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGQycDE6dHlwZT1cInEzOnN0cmluZ1wiPkJCQjwvSXRlbU5hbWU+XHJcbiAgPC9NeUl0ZW0+XHJcbjwvcm9vdD4iOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemVXaXRoV3JhcHBlcih2YWx1ZSwgc2VyLCBiYXNlbGluZSk7DQoNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkdyb3VwTmFtZSwgYWN0dWFsLkdyb3VwTmFtZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5NeUl0ZW1zLkNvdW50KCksIGFjdHVhbC5NeUl0ZW1zLkNvdW50KCkpOw0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHZhbHVlLk15SXRlbXMuQ291bnQoKTsgaSsrKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuTXlJdGVtc1tpXS5JdGVtTmFtZSwgYWN0dWFsLk15SXRlbXNbaV0uSXRlbU5hbWUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU29hcF9NeUNvbGxlY3Rpb24oKQ0KICAgIHsNCiAgICAgICAgWG1sVHlwZU1hcHBpbmcgbXlUeXBlTWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKE15Q29sbGVjdGlvbjxzdHJpbmc+KSk7DQogICAgICAgIHZhciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIobXlUeXBlTWFwcGluZyk7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBNeUNvbGxlY3Rpb248c3RyaW5nPigiYTEiLCAiYTIiKTsNCg0KICAgICAgICBzdHJpbmcgYmFzZWxpbmUgPSAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+PEFycmF5T2ZTdHJpbmcgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGQxcDE6aWQ9XCJpZDFcIiBkMXAxOml0ZW1UeXBlPVwieHNkOnN0cmluZ1wiIHhtbG5zOmQxcDE9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAzLzA1L3NvYXAtZW5jb2RpbmdcIj48SXRlbT5hMTwvSXRlbT48SXRlbT5hMjwvSXRlbT48L0FycmF5T2ZTdHJpbmc+IjsNCiAgICAgICAgTXlDb2xsZWN0aW9uPHN0cmluZz4gYWN0dWFsOw0KDQogICAgICAgIHVzaW5nICh2YXIgbXMgPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciB3cml0ZXIgPSBuZXcgWG1sVGV4dFdyaXRlcihtcywgRW5jb2RpbmcuVVRGOCk7DQogICAgICAgICAgICBzZXJpYWxpemVyLlNlcmlhbGl6ZSh3cml0ZXIsIHZhbHVlLCBudWxsLCAiaHR0cDovL3d3dy53My5vcmcvMjAwMy8wNS9zb2FwLWVuY29kaW5nIik7DQoNCiAgICAgICAgICAgIG1zLlBvc2l0aW9uID0gMDsNCiAgICAgICAgICAgIHN0cmluZyBhY3R1YWxPdXRwdXQgPSBuZXcgU3RyZWFtUmVhZGVyKG1zKS5SZWFkVG9FbmQoKTsNCg0KICAgICAgICAgICAgVXRpbHMuQ29tcGFyZVJlc3VsdCByZXN1bHQgPSBVdGlscy5Db21wYXJlKGJhc2VsaW5lLCBhY3R1YWxPdXRwdXQpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUocmVzdWx0LkVxdWFsLCBzdHJpbmcuRm9ybWF0KCJ7MX17MH1UZXN0IGZhaWxlZCBmb3IgaW5wdXQ6IHsyfXswfUV4cGVjdGVkOiB7M317MH1BY3R1YWw6IHs0fSIsDQogICAgICAgICAgICAgICAgRW52aXJvbm1lbnQuTmV3TGluZSwgcmVzdWx0LkVycm9yTWVzc2FnZSwgdmFsdWUsIGJhc2VsaW5lLCBhY3R1YWxPdXRwdXQpKTsNCg0KICAgICAgICAgICAgbXMuUG9zaXRpb24gPSAwOw0KICAgICAgICAgICAgdXNpbmcgKHZhciByZWFkZXIgPSBuZXcgWG1sVGV4dFJlYWRlcihtcykpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYWN0dWFsID0gKE15Q29sbGVjdGlvbjxzdHJpbmc+KXNlcmlhbGl6ZXIuRGVzZXJpYWxpemUocmVhZGVyLCAiaHR0cDovL3d3dy53My5vcmcvMjAwMy8wNS9zb2FwLWVuY29kaW5nIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuQ291bnQsIGFjdHVhbC5Db3VudCk7DQogICAgICAgIEFzc2VydC5UcnVlKHZhbHVlLlNlcXVlbmNlRXF1YWwoYWN0dWFsKSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU29hcF9XaXRoTnVsbGFibGVzKCkNCiAgICB7DQogICAgICAgIHZhciBtYXBwaW5nID0gbmV3IFNvYXBSZWZsZWN0aW9uSW1wb3J0ZXIoKS5JbXBvcnRUeXBlTWFwcGluZyh0eXBlb2YoV2l0aE51bGxhYmxlcykpOw0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKG1hcHBpbmcpOw0KDQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBXaXRoTnVsbGFibGVzKCkgeyBPcHRpb25hbCA9IEludEVudW0uT3B0aW9uMSwgT3B0aW9uYWxJbnQgPSA0MiwgU3RydWN0MSA9IG5ldyBTb21lU3RydWN0IHsgQSA9IDEsIEIgPSAyIH0gfTsNCiAgICAgICAgc3RyaW5nIGJhc2VsaW5lID0gIjxyb290PjxXaXRoTnVsbGFibGVzIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiPjxPcHRpb25hbCB4c2k6dHlwZT1cIkludEVudW1cIj5PcHRpb24xPC9PcHRpb25hbD48T3B0aW9uYWxJbnQgeHNpOnR5cGU9XCJ4c2Q6aW50XCI+NDI8L09wdGlvbmFsSW50PjxTdHJ1Y3QxIGhyZWY9XCIjaWQyXCIgLz48L1dpdGhOdWxsYWJsZXM+PFNvbWVTdHJ1Y3QgaWQ9XCJpZDJcIiBkMnAxOnR5cGU9XCJTb21lU3RydWN0XCIgeG1sbnM6ZDJwMT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCI+PEEgeG1sbnM6cTE9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGQycDE6dHlwZT1cInExOmludFwiPjE8L0E+PEIgeG1sbnM6cTI9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGQycDE6dHlwZT1cInEyOmludFwiPjI8L0I+PC9Tb21lU3RydWN0Pjwvcm9vdD4iOw0KDQogICAgICAgIFdpdGhOdWxsYWJsZXMgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemVXaXRoV3JhcHBlcih2YWx1ZSwgc2VyaWFsaXplciwgYmFzZWxpbmUpOw0KDQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5PcHRpb25hbEludCwgYWN0dWFsLk9wdGlvbmFsSW50KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLk9wdGlvbmFsLCBhY3R1YWwuT3B0aW9uYWwpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuT3B0aW9udWxsLCBhY3R1YWwuT3B0aW9udWxsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLk9wdGlvbnVsbEludCwgYWN0dWFsLk9wdGlvbnVsbEludCk7DQogICAgICAgIEFzc2VydC5OdWxsKGFjdHVhbC5TdHJ1Y3QyKTsNCiAgICAgICAgQXNzZXJ0Lk51bGwoYWN0dWFsLlN0cnVjdDEpOyAvLyBUaGlzIGJlaGF2aW9yIGRvZXNuJ3Qgc2VlbSByaWdodC4gQnV0IHRoaXMgaXMgdGhlIGJlaGF2aW9yIG9uIGRlc2t0b3AuDQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU29hcF9FbnVtcygpDQogICAgew0KICAgICAgICB2YXIgbWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKFdpdGhFbnVtcykpOw0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKG1hcHBpbmcpOw0KICAgICAgICB2YXIgaXRlbSA9IG5ldyBXaXRoRW51bXMoKSB7IEludCA9IEludEVudW0uT3B0aW9uMSwgU2hvcnQgPSBTaG9ydEVudW0uT3B0aW9uMiB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoDQogICAgICAgICAgICBpdGVtLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxXaXRoRW51bXMgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGlkPVwiaWQxXCI+XHJcbiAgPEludCB4c2k6dHlwZT1cIkludEVudW1cIj5PcHRpb24xPC9JbnQ+XHJcbiAgPFNob3J0IHhzaTp0eXBlPVwiU2hvcnRFbnVtXCI+T3B0aW9uMjwvU2hvcnQ+XHJcbjwvV2l0aEVudW1zPiIsDQogICAgICAgICAgICAoKSA9PiBzZXJpYWxpemVyKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGl0ZW0uU2hvcnQsIGFjdHVhbC5TaG9ydCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChpdGVtLkludCwgYWN0dWFsLkludCk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU29hcF9EaWN0aW9uYXJ5KCkNCiAgICB7DQogICAgICAgIEFzc2VydC5UaHJvd3M8Tm90U3VwcG9ydGVkRXhjZXB0aW9uPigoKSA9PiB7IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKE15R3JvdXAzKSk7IH0pOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiZG90bmV0L2NvcmVmeCAjMTg5NjQiKV0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1NvYXBfTmVzdGVkUHVibGljVHlwZSgpDQogICAgew0KICAgICAgICBYbWxUeXBlTWFwcGluZyBteVR5cGVNYXBwaW5nID0gbmV3IFNvYXBSZWZsZWN0aW9uSW1wb3J0ZXIoKS5JbXBvcnRUeXBlTWFwcGluZyh0eXBlb2YoVHlwZVdpdGhOZXN0ZWRQdWJsaWNUeXBlLkxldmVsRGF0YSkpOw0KICAgICAgICB2YXIgc2VyID0gbmV3IFhtbFNlcmlhbGl6ZXIobXlUeXBlTWFwcGluZyk7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aE5lc3RlZFB1YmxpY1R5cGUuTGV2ZWxEYXRhKCkgeyBOYW1lID0gIkFBIiB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICBiYXNlbGluZTogIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxMZXZlbERhdGEgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGlkPVwiaWQxXCI+XHJcbiAgPE5hbWUgeHNpOnR5cGU9XCJ4c2Q6c3RyaW5nXCI+QUE8L05hbWU+XHJcbjwvTGV2ZWxEYXRhPiIsDQogICAgICAgICAgIHNlcmlhbGl6ZXJGYWN0b3J5OiAoKSA9PiBzZXIpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuTmFtZSwgYWN0dWFsLk5hbWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiZG90bmV0L2NvcmVmeCAjMTg5NjQiKV0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1NvYXBfT2JqZWN0QXNSb290KCkNCiAgICB7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcigpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihvYmplY3QpKTsNCiAgICAgICAgdmFyIHNlciA9IG5ldyBYbWxTZXJpYWxpemVyKG15VHlwZU1hcHBpbmcpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoDQogICAgICAgICAgICAxLA0KICAgICAgICAgICAgU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8b2JqZWN0PigNCiAgICAgICAgICAgICAgICAxLA0KICAgICAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48YW55VHlwZSBkMXAxOnR5cGU9XCJpbnRcIiB4bWxuczpkMXAxPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCI+MTwvYW55VHlwZT4iLA0KICAgICAgICAgICAgICAgICgpID0+IHNlcikpOw0KDQogICAgICAgIEFzc2VydC5FcXVhbCgNCiAgICAgICAgICAgIHRydWUsDQogICAgICAgICAgICBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxvYmplY3Q+KA0KICAgICAgICAgICAgICAgIHRydWUsDQogICAgICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxhbnlUeXBlIGQxcDE6dHlwZT1cImJvb2xlYW5cIiB4bWxuczpkMXAxPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCI+dHJ1ZTwvYW55VHlwZT4iLA0KICAgICAgICAgICAgICAgICgpID0+IHNlcikpOw0KDQogICAgICAgIEFzc2VydC5FcXVhbCgNCiAgICAgICAgICAgICJhYmMiLA0KICAgICAgICAgICAgU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8b2JqZWN0PigNCiAgICAgICAgICAgICAgICAiYWJjIiwNCiAgICAgICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPGFueVR5cGUgZDFwMTp0eXBlPVwic3RyaW5nXCIgeG1sbnM6ZDFwMT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPmFiYzwvYW55VHlwZT4iLA0KICAgICAgICAgICAgICAgICgpID0+IHNlcikpOw0KDQogICAgICAgIHZhciBudWxsRGVzZXJpYWxpemVkID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8b2JqZWN0PigNCiAgICAgICAgICAgICAgICBudWxsLA0KICAgICAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48eHNkOmFueVR5cGUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIC8+IiwNCiAgICAgICAgICAgICAgICAoKSA9PiBzZXIpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChudWxsRGVzZXJpYWxpemVkKTsNCiAgICAgICAgQXNzZXJ0LlRydWUodHlwZW9mKG9iamVjdCkgPT0gbnVsbERlc2VyaWFsaXplZC5HZXRUeXBlKCkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiZG90bmV0L2NvcmVmeCAjMTg5NjQiKV0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1NvYXBfT2JqZWN0QXNSb290X051bGxhYmxlKCkNCiAgICB7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG51bGxhYmxlVHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcigpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihUeXBlV2l0aE51bGxhYmxlT2JqZWN0KSk7DQogICAgICAgIHZhciBzZXIgPSBuZXcgWG1sU2VyaWFsaXplcihudWxsYWJsZVR5cGVNYXBwaW5nKTsNCg0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhOdWxsYWJsZU9iamVjdCB7IE15T2JqZWN0ID0gbnVsbCB9Ow0KICAgICAgICBUeXBlV2l0aE51bGxhYmxlT2JqZWN0IGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKA0KICAgICAgICAgICAgICAgIHZhbHVlLA0KICAgICAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48VHlwZVdpdGhOdWxsYWJsZU9iamVjdCB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgaWQ9XCJpZDFcIj5cclxuICA8TXlPYmplY3QgeHNpOm5pbD1cInRydWVcIiAvPlxyXG48L1R5cGVXaXRoTnVsbGFibGVPYmplY3Q+IiwNCiAgICAgICAgICAgICAgICAoKSA9PiBzZXIpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuTnVsbChhY3R1YWwuTXlPYmplY3QpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxTZXJpYWxpemF0aW9uUmVhZGVyV3JpdGVyVGVzdCgpDQogICAgew0KICAgICAgICBzdHJpbmcgcyA9ICJYbWxTZXJpYWxpemF0aW9uUmVhZGVyV3JpdGVyVGVzdCI7DQogICAgICAgIGJ5dGVbXSBvcmlnaW5hbCA9IFN5c3RlbS5UZXh0LkVuY29kaW5nLkRlZmF1bHQuR2V0Qnl0ZXMocyk7DQogICAgICAgIGJ5dGVbXSBjb252ZXJ0ZWQgPSBNeVJlYWRlci5IZXhUb0J5dGVzKE15V3JpdGVyLkJ5dGVzVG9IZXgob3JpZ2luYWwpKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKG9yaWdpbmFsLCBjb252ZXJ0ZWQpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxSZWZsZWN0aW9uSW1wb3J0ZXJUZXN0KCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJuYW1lID0gIkFjdGlvbiI7DQogICAgICAgIFhtbFJlZmxlY3Rpb25JbXBvcnRlciBpbXBvcnRlciA9IG5ldyBYbWxSZWZsZWN0aW9uSW1wb3J0ZXIoImh0dHA6Ly93d3cuY29udG9zby5jb20vIik7DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXJbXSBtZW1iZXJzID0gbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXJbMV07DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyID0gbWVtYmVyc1swXSA9IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyKCk7DQogICAgICAgIG1lbWJlci5NZW1iZXJUeXBlID0gdHlwZW9mKEF0dHJpYnV0ZWRVUkkpOw0KICAgICAgICBtZW1iZXIuTWVtYmVyTmFtZSA9IG1lbWJlcm5hbWU7DQogICAgICAgIFhtbE1lbWJlcnNNYXBwaW5nIG1hcHBpbmdzID0gaW1wb3J0ZXIuSW1wb3J0TWVtYmVyc01hcHBpbmcoInJvb3QiLCAiIiwgbWVtYmVycywgdHJ1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCgxLCBtYXBwaW5ncy5Db3VudCk7DQogICAgICAgIFhtbE1lbWJlck1hcHBpbmcgeG1wID0gbWFwcGluZ3NbMF07DQogICAgICAgIEFzc2VydC5FcXVhbChtZW1iZXJuYW1lLCB4bXAuRWxlbWVudE5hbWUpOw0KICAgICAgICBBc3NlcnQuRmFsc2UoeG1wLkNoZWNrU3BlY2lmaWVkKTsNCiAgICB9DQoNCiAgICBbRmFjdF0gICAgICAgDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbFNjaGVtYUV4cG9ydGVyX0V4cG9ydE1lbWJlcnNNYXBwaW5nX05vdFN1cHBvcnRlZERlZmF1bHRWYWx1ZSgpDQogICAgew0KICAgICAgICBYbWxSZWZsZWN0aW9uSW1wb3J0ZXIgaW1wb3J0ZXIgPSBuZXcgWG1sUmVmbGVjdGlvbkltcG9ydGVyKCJodHRwOi8vd3d3LmNvbnRvc28uY29tLyIpOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyW10gbWVtYmVycyA9IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyWzFdOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlciA9IG1lbWJlcnNbMF0gPSBuZXcgWG1sUmVmbGVjdGlvbk1lbWJlcigpOw0KICAgICAgICBtZW1iZXIuTWVtYmVyVHlwZSA9IHR5cGVvZihUeXBlV2l0aFFOYW1lQXJyYXlBc1htbEF0dHJpYnV0ZUludmFsaWREZWZhdWx0VmFsdWUpOw0KICAgICAgICBYbWxNZW1iZXJzTWFwcGluZyBtYXBwaW5ncyA9IGltcG9ydGVyLkltcG9ydE1lbWJlcnNNYXBwaW5nKCJyb290IiwgIiIsIG1lbWJlcnMsIHRydWUpOw0KICAgICAgICBYbWxNZW1iZXJNYXBwaW5nIHhtcCA9IG1hcHBpbmdzWzBdOw0KICAgICAgICBYbWxTY2hlbWFzIHNjaGVtYSA9IG5ldyBYbWxTY2hlbWFzKCk7DQogICAgICAgIFhtbFNjaGVtYUV4cG9ydGVyIGV4cG9ydGVyID0gbmV3IFhtbFNjaGVtYUV4cG9ydGVyKHNjaGVtYSk7DQogICAgICAgIEFzc2VydEV4dGVuc2lvbnMuVGhyb3dzPFhtbEV4Y2VwdGlvbixFeGNlcHRpb24+KCgpID0+IGV4cG9ydGVyLkV4cG9ydE1lbWJlcnNNYXBwaW5nKG1hcHBpbmdzKSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbFNlcmlhbGl6ZXJWZXJzaW9uQXR0cmlidXRlVGVzdCgpDQogICAgew0KICAgICAgICBYbWxTZXJpYWxpemVyVmVyc2lvbkF0dHJpYnV0ZSBhdHRyID0gbmV3IFhtbFNlcmlhbGl6ZXJWZXJzaW9uQXR0cmlidXRlKCk7DQogICAgICAgIEFzc2VydC5OdWxsKGF0dHIuVHlwZSk7DQogICAgICAgIFhtbFNlcmlhbGl6ZXJWZXJzaW9uQXR0cmlidXRlIGF0dHIyID0gbmV3IFhtbFNlcmlhbGl6ZXJWZXJzaW9uQXR0cmlidXRlKHR5cGVvZihFbXBsb3llZSkpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodHlwZW9mKEVtcGxveWVlKSwgYXR0cjIuVHlwZSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbFNlcmlhbGl6ZXJBc3NlbWJseUF0dHJpYnV0ZVRlc3QoKQ0KICAgIHsNCiAgICAgICAgb2JqZWN0W10gYXR0cnMgPSB0eXBlb2YoQXNzZW1ibHlBdHRyVGVzdENsYXNzKS5HZXRDdXN0b21BdHRyaWJ1dGVzKHR5cGVvZihYbWxTZXJpYWxpemVyQXNzZW1ibHlBdHRyaWJ1dGUpLCBmYWxzZSk7DQogICAgICAgIFhtbFNlcmlhbGl6ZXJBc3NlbWJseUF0dHJpYnV0ZSBhdHRyID0gKFhtbFNlcmlhbGl6ZXJBc3NlbWJseUF0dHJpYnV0ZSlhdHRyc1swXTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYXR0cik7DQogICAgICAgIEFzc2VydC5FcXVhbCgiQXNzZW1ibHlBdHRyVGVzdENsYXNzIiwgYXR0ci5Bc3NlbWJseU5hbWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBDb2RlSWRlbnRpZmllclRlc3QoKQ0KICAgIHsNCiAgICAgICAgQ29kZUlkZW50aWZpZXJzIGNkcyA9IG5ldyBDb2RlSWRlbnRpZmllcnModHJ1ZSk7DQogICAgICAgIGNkcy5BZGRSZXNlcnZlZCh0eXBlb2YoRW1wbG95ZWUpLk5hbWUpOw0KICAgICAgICBjZHMuQWRkKCJ0ZXN0IiwgbmV3IFRlc3REYXRhKCkpOw0KICAgICAgICBjZHMuQWRkVW5pcXVlKCJ0ZXN0MiIsIG5ldyBUZXN0RGF0YSgpKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKCJjYW1lbFRleHQiLCBDb2RlSWRlbnRpZmllci5NYWtlQ2FtZWwoIkNhbWVsIFRleHQiKSk7DQogICAgICAgIEFzc2VydC5FcXVhbCgiUGFzY2FsVGV4dCIsIENvZGVJZGVudGlmaWVyLk1ha2VQYXNjYWwoIlBhc2NhbCBUZXh0IikpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoIlZhbGlkVGV4dCIsIENvZGVJZGVudGlmaWVyLk1ha2VWYWxpZCgiVmFsaWQgIFRleHQhIikpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBJWG1sVGV4dFBhcnNlclRlc3QoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIHhtbEZpbGVDb250ZW50ID0gQCI8cm9vdD48ZGF0ZT4yMDAzLTAxLTA4VDE1OjAwOjAwLTAwOjAwPC9kYXRlPjwvcm9vdD4iOw0KICAgICAgICBTdHJlYW0gc20gPSBHZW5lcmF0ZVN0cmVhbUZyb21TdHJpbmcoeG1sRmlsZUNvbnRlbnQpOw0KICAgICAgICBYbWxUZXh0UmVhZGVyIHJlYWRlciA9IG5ldyBYbWxUZXh0UmVhZGVyKHNtKTsNCiAgICAgICAgTXlYbWxUZXh0UGFyc2VyIHRleHQgPSBuZXcgTXlYbWxUZXh0UGFyc2VyKHJlYWRlcik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBTb2FwU2NoZW1hTWVtYmVyVGVzdCgpDQogICAgew0KICAgICAgICBzdHJpbmcgbnMgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiOw0KICAgICAgICBTb2FwU2NoZW1hTWVtYmVyIG1lbWJlciA9IG5ldyBTb2FwU2NoZW1hTWVtYmVyKCk7DQogICAgICAgIG1lbWJlci5NZW1iZXJOYW1lID0gIlN5c3RlbS5EYXRlVGltZSI7DQogICAgICAgIG1lbWJlci5NZW1iZXJUeXBlID0gbmV3IFhtbFF1YWxpZmllZE5hbWUoImRhdGVUaW1lIiwgbnMpOw0KICAgICAgICBTb2FwU2NoZW1hTWVtYmVyW10gbWVtYmVycyA9IG5ldyBTb2FwU2NoZW1hTWVtYmVyW10geyBtZW1iZXIgfTsNCiAgICAgICAgdmFyIHNjaGVtYXMgPSBuZXcgWG1sU2NoZW1hcygpOw0KICAgICAgICBYbWxTY2hlbWFJbXBvcnRlciBpbXBvcnRlciA9IG5ldyBYbWxTY2hlbWFJbXBvcnRlcihzY2hlbWFzKTsNCiAgICAgICAgc3RyaW5nIG5hbWUgPSAibXlkYXRldGltZSI7DQogICAgICAgIHZhciBtYXBwaW5nID0gaW1wb3J0ZXIuSW1wb3J0TWVtYmVyc01hcHBpbmcobmFtZSwgbnMsIG1lbWJlcnMpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChtYXBwaW5nKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKG5hbWUsIG1hcHBpbmcuRWxlbWVudE5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwobmFtZSwgbWFwcGluZy5Yc2RFbGVtZW50TmFtZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCgxLCBtYXBwaW5nLkNvdW50KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sU2VyaWFsaXphdGlvbkdlbmVyYXRlZENvZGVUZXN0KCkNCiAgICB7DQogICAgICAgIHZhciBjZyA9IG5ldyBNeWNvZGVHZW5lcmF0b3IoKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoY2cpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19QcmltaXRpdmVWYWx1ZSgpDQogICAgew0KICAgICAgICBzdHJpbmcgbWVtYmVyTmFtZSA9ICJ2YWx1ZSI7DQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHlWYWx1ZSA9IDM7DQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmc8aW50PihnZXREYXRhUmVxdWVzdEJvZHlWYWx1ZSwgbWVtYmVyTmFtZSwgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjx2YWx1ZSB4bWxucz1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIj4zPC92YWx1ZT4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZ2V0RGF0YVJlcXVlc3RCb2R5VmFsdWUsIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX1NpbXBsZVR5cGUoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUgPSAiR2V0RGF0YSI7DQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHlWYWx1ZSA9IG5ldyBHZXREYXRhUmVxdWVzdEJvZHkoMyk7DQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmc8R2V0RGF0YVJlcXVlc3RCb2R5PihnZXREYXRhUmVxdWVzdEJvZHlWYWx1ZSwgbWVtYmVyTmFtZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48R2V0RGF0YSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgeG1sbnM9XCJodHRwOi8vdGVtcHVyaS5vcmcvXCI+XHJcbiAgPHZhbHVlPjM8L3ZhbHVlPlxyXG48L0dldERhdGE+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGdldERhdGFSZXF1ZXN0Qm9keVZhbHVlLnZhbHVlLCBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwudmFsdWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19Db21wb3NpdGVUeXBlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lID0gIkdldERhdGFVc2luZ0RhdGFDb250cmFjdCI7DQogICAgICAgIHZhciByZXF1ZXN0Qm9keVZhbHVlID0gbmV3IEdldERhdGFVc2luZ0RhdGFDb250cmFjdFJlcXVlc3RCb2R5KCkgeyBjb21wb3NpdGUgPSBuZXcgQ29tcG9zaXRlVHlwZUZvclhtbE1lbWJlcnNNYXBwaW5nKCkgeyBCb29sVmFsdWUgPSB0cnVlLCBTdHJpbmdWYWx1ZSA9ICJmb28iIH0gfTsNCiAgICAgICAgdmFyIHJlcXVlc3RCb2R5QWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nPEdldERhdGFVc2luZ0RhdGFDb250cmFjdFJlcXVlc3RCb2R5PihyZXF1ZXN0Qm9keVZhbHVlLCBtZW1iZXJOYW1lLCAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPEdldERhdGFVc2luZ0RhdGFDb250cmFjdCB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgeG1sbnM9XCJodHRwOi8vdGVtcHVyaS5vcmcvXCI+XHJcbiAgPGNvbXBvc2l0ZT5cclxuICAgIDxCb29sVmFsdWU+dHJ1ZTwvQm9vbFZhbHVlPlxyXG4gICAgPFN0cmluZ1ZhbHVlPmZvbzwvU3RyaW5nVmFsdWU+XHJcbiAgPC9jb21wb3NpdGU+XHJcbjwvR2V0RGF0YVVzaW5nRGF0YUNvbnRyYWN0PiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKHJlcXVlc3RCb2R5QWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHJlcXVlc3RCb2R5VmFsdWUuY29tcG9zaXRlLkJvb2xWYWx1ZSwgcmVxdWVzdEJvZHlBY3R1YWwuY29tcG9zaXRlLkJvb2xWYWx1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbChyZXF1ZXN0Qm9keVZhbHVlLmNvbXBvc2l0ZS5TdHJpbmdWYWx1ZSwgcmVxdWVzdEJvZHlBY3R1YWwuY29tcG9zaXRlLlN0cmluZ1ZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sTWVtYmVyc01hcHBpbmdfU2ltcGxlVHlwZV9IYXNXcmFwcGVyRWxlbWVudCgpDQogICAgew0KICAgICAgICBzdHJpbmcgbWVtYmVyTmFtZSA9ICJHZXREYXRhIjsNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keVZhbHVlID0gbmV3IEdldERhdGFSZXF1ZXN0Qm9keSgzKTsNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZzxHZXREYXRhUmVxdWVzdEJvZHk+KGdldERhdGFSZXF1ZXN0Qm9keVZhbHVlLCBtZW1iZXJOYW1lLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjx3cmFwcGVyIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiB4bWxucz1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIj5cclxuICA8R2V0RGF0YT5cclxuICAgIDx2YWx1ZT4zPC92YWx1ZT5cclxuICA8L0dldERhdGE+XHJcbjwvd3JhcHBlcj4iLA0KICAgICAgICAgICAgd3JhcHBlck5hbWU6ICJ3cmFwcGVyIik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGdldERhdGFSZXF1ZXN0Qm9keVZhbHVlLnZhbHVlLCBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwudmFsdWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19TaW1wbGVUeXBlX1NwZWNpZmllZEZpZWxkX01pc3NpbmdTcGVjaWZpZWRWYWx1ZSgpDQogICAgew0KICAgICAgICB2YXIgbWVtYmVyMSA9IEdldFJlZmxlY3Rpb25NZW1iZXI8R2V0RGF0YVJlcXVlc3RCb2R5PigiR2V0RGF0YSIpOw0KICAgICAgICB2YXIgbWVtYmVyMiA9IEdldFJlZmxlY3Rpb25NZW1iZXI8Ym9vbD4oIkdldERhdGFTcGVjaWZpZWQiKTsNCg0KICAgICAgICB2YXIgZ2V0RGF0YVJlcXVlc3RCb2R5ID0gbmV3IEdldERhdGFSZXF1ZXN0Qm9keSgpIHsgdmFsdWUgPSAzIH07DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBvYmplY3RbXSB7IGdldERhdGFSZXF1ZXN0Qm9keSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nKA0KICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPEdldERhdGEgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDx2YWx1ZT4zPC92YWx1ZT5cclxuPC9HZXREYXRhPiIsDQogICAgICAgICAgICBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UsDQogICAgICAgICAgICBtZW1iZXJzOiBuZXcgWG1sUmVmbGVjdGlvbk1lbWJlcltdIHsgbWVtYmVyMSwgbWVtYmVyMiB9LA0KICAgICAgICAgICAgd3JhcHBlck5hbWU6IG51bGwpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQoNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCA9IChHZXREYXRhUmVxdWVzdEJvZHkpYWN0dWFsWzBdOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZ2V0RGF0YVJlcXVlc3RCb2R5LnZhbHVlLCBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwudmFsdWUpOw0KICAgICAgICBBc3NlcnQuVHJ1ZSgoYm9vbClhY3R1YWxbMV0pOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19TaW1wbGVUeXBlX1NwZWNpZmllZEZpZWxkX1RydWVfV3JhcHBlcigpDQogICAgew0KICAgICAgICB2YXIgbWVtYmVyMSA9IEdldFJlZmxlY3Rpb25NZW1iZXI8R2V0RGF0YVJlcXVlc3RCb2R5PigiR2V0RGF0YSIpOw0KICAgICAgICB2YXIgbWVtYmVyMiA9IEdldFJlZmxlY3Rpb25NZW1iZXI8Ym9vbD4oIkdldERhdGFTcGVjaWZpZWQiKTsNCg0KICAgICAgICB2YXIgZ2V0RGF0YVJlcXVlc3RCb2R5ID0gbmV3IEdldERhdGFSZXF1ZXN0Qm9keSgpIHsgdmFsdWUgPSAzIH07DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBvYmplY3RbXSB7IGdldERhdGFSZXF1ZXN0Qm9keSwgdHJ1ZSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nKA0KICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDxHZXREYXRhPlxyXG4gICAgPHZhbHVlPjM8L3ZhbHVlPlxyXG4gIDwvR2V0RGF0YT5cclxuICA8R2V0RGF0YVNwZWNpZmllZD50cnVlPC9HZXREYXRhU3BlY2lmaWVkPlxyXG48L3dyYXBwZXI+IiwNCiAgICAgICAgICAgIHNraXBTdHJpbmdDb21wYXJlOiBmYWxzZSwNCiAgICAgICAgICAgIG1lbWJlcnM6IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIxLCBtZW1iZXIyIH0sDQogICAgICAgICAgICB3cmFwcGVyTmFtZTogIndyYXBwZXIiKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KDQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwgPSAoR2V0RGF0YVJlcXVlc3RCb2R5KWFjdHVhbFswXTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGdldERhdGFSZXF1ZXN0Qm9keS52YWx1ZSwgZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsLnZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoKGJvb2wpYWN0dWFsWzFdKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sTWVtYmVyc01hcHBpbmdfU2ltcGxlVHlwZV9TcGVjaWZpZWRGaWVsZF9UcnVlX0lnbm9yZVNwZWNpZmllZEZpZWxkX1dyYXBwZXIoKQ0KICAgIHsNCiAgICAgICAgdmFyIG1lbWJlcjEgPSBHZXRSZWZsZWN0aW9uTWVtYmVyPEdldERhdGFSZXF1ZXN0Qm9keT4oIkdldERhdGEiKTsNCiAgICAgICAgdmFyIG1lbWJlcjIgPSBHZXRSZWZsZWN0aW9uTWVtYmVyPGJvb2w+KCJHZXREYXRhU3BlY2lmaWVkIik7DQogICAgICAgIG1lbWJlcjIuWG1sQXR0cmlidXRlcy5YbWxJZ25vcmUgPSB0cnVlOw0KDQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHkgPSBuZXcgR2V0RGF0YVJlcXVlc3RCb2R5KCkgeyB2YWx1ZSA9IDMgfTsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IG9iamVjdFtdIHsgZ2V0RGF0YVJlcXVlc3RCb2R5LCB0cnVlIH07DQogICAgICAgIHZhciBhY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmcoDQogICAgICAgICAgICB2YWx1ZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48d3JhcHBlciB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgeG1sbnM9XCJodHRwOi8vdGVtcHVyaS5vcmcvXCI+XHJcbiAgPEdldERhdGE+XHJcbiAgICA8dmFsdWU+MzwvdmFsdWU+XHJcbiAgPC9HZXREYXRhPlxyXG4gPC93cmFwcGVyPiIsDQogICAgICAgICAgICBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UsDQogICAgICAgICAgICBtZW1iZXJzOiBuZXcgWG1sUmVmbGVjdGlvbk1lbWJlcltdIHsgbWVtYmVyMSwgbWVtYmVyMiB9LA0KICAgICAgICAgICAgd3JhcHBlck5hbWU6ICJ3cmFwcGVyIik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCg0KICAgICAgICB2YXIgZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsID0gKEdldERhdGFSZXF1ZXN0Qm9keSlhY3R1YWxbMF07DQogICAgICAgIEFzc2VydC5FcXVhbChnZXREYXRhUmVxdWVzdEJvZHkudmFsdWUsIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbC52YWx1ZSk7DQogICAgICAgIEFzc2VydC5UcnVlKChib29sKWFjdHVhbFsxXSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX1NpbXBsZVR5cGVfU3BlY2lmaWVkRmllbGRfRmFsc2VfV3JhcHBlcigpDQogICAgew0KICAgICAgICB2YXIgbWVtYmVyMSA9IEdldFJlZmxlY3Rpb25NZW1iZXI8R2V0RGF0YVJlcXVlc3RCb2R5PigidmFsdWUiKTsNCiAgICAgICAgdmFyIG1lbWJlcjIgPSBHZXRSZWZsZWN0aW9uTWVtYmVyPGJvb2w+KCJ2YWx1ZVNwZWNpZmllZCIpOw0KDQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHkgPSBuZXcgR2V0RGF0YVJlcXVlc3RCb2R5KCkgeyB2YWx1ZSA9IDMgfTsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IG9iamVjdFtdIHsgZ2V0RGF0YVJlcXVlc3RCb2R5LCBmYWxzZSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nKA0KICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDx2YWx1ZVNwZWNpZmllZD5mYWxzZTwvdmFsdWVTcGVjaWZpZWQ+XHJcbjwvd3JhcHBlcj4iLA0KICAgICAgICAgICAgc2tpcFN0cmluZ0NvbXBhcmU6IGZhbHNlLA0KICAgICAgICAgICAgbWVtYmVyczogbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXJbXSB7IG1lbWJlcjEsIG1lbWJlcjIgfSwNCiAgICAgICAgICAgIHdyYXBwZXJOYW1lOiAid3JhcHBlciIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5OdWxsKGFjdHVhbFswXSk7DQogICAgICAgIEFzc2VydC5GYWxzZSgoYm9vbClhY3R1YWxbMV0pOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19TaW1wbGVUeXBlX1NwZWNpZmllZEZpZWxkX0ZhbHNlKCkNCiAgICB7DQogICAgICAgIHZhciBtZW1iZXIxID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxHZXREYXRhUmVxdWVzdEJvZHk+KCJ2YWx1ZSIpOw0KICAgICAgICB2YXIgbWVtYmVyMiA9IEdldFJlZmxlY3Rpb25NZW1iZXI8Ym9vbD4oInZhbHVlU3BlY2lmaWVkIik7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBvYmplY3RbXSB7IG5ldyBHZXREYXRhUmVxdWVzdEJvZHkoKSB7IHZhbHVlID0gMyB9LCBmYWxzZSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nKA0KICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHZhbHVlU3BlY2lmaWVkIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPmZhbHNlPC92YWx1ZVNwZWNpZmllZD4iLA0KICAgICAgICAgICAgc2tpcFN0cmluZ0NvbXBhcmU6IGZhbHNlLA0KICAgICAgICAgICAgbWVtYmVyczogbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXJbXSB7IG1lbWJlcjEsIG1lbWJlcjIgfSwNCiAgICAgICAgICAgIHdyYXBwZXJOYW1lOiBudWxsKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuTnVsbChhY3R1YWxbMF0pOw0KICAgICAgICBBc3NlcnQuRmFsc2UoKGJvb2wpYWN0dWFsWzFdKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sTWVtYmVyc01hcHBpbmdfSW50QXJyYXkoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUgPSAiSW50QXJyYXkiOw0KICAgICAgICB2YXIgcmVxdWVzdEJvZHlWYWx1ZSA9IG5ldyBpbnRbXSB7IDEsIDIsIDMgfTsNCiAgICAgICAgdmFyIHJlcXVlc3RCb2R5QWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nPGludFtdPihyZXF1ZXN0Qm9keVZhbHVlLCBtZW1iZXJOYW1lLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjx3cmFwcGVyIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiB4bWxucz1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIj5cclxuICA8SW50QXJyYXk+MTwvSW50QXJyYXk+XHJcbiAgPEludEFycmF5PjI8L0ludEFycmF5PlxyXG4gIDxJbnRBcnJheT4zPC9JbnRBcnJheT5cclxuPC93cmFwcGVyPiIsDQogICAgICAgICAgICB3cmFwcGVyTmFtZTogIndyYXBwZXIiKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChyZXF1ZXN0Qm9keUFjdHVhbCk7DQogICAgICAgIEFzc2VydC5FcXVhbChyZXF1ZXN0Qm9keVZhbHVlLkxlbmd0aCwgcmVxdWVzdEJvZHlBY3R1YWwuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoRW51bWVyYWJsZS5TZXF1ZW5jZUVxdWFsKHJlcXVlc3RCb2R5VmFsdWUsIHJlcXVlc3RCb2R5QWN0dWFsKSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX0ludExpc3QoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUgPSAiSW50QXJyYXkiOw0KICAgICAgICBMaXN0PGludD4gcmVxdWVzdEJvZHlWYWx1ZSA9IG5ldyBMaXN0PGludD4geyAxLCAyLCAzIH07DQogICAgICAgIHZhciByZXF1ZXN0Qm9keUFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZzxMaXN0PGludD4+KHJlcXVlc3RCb2R5VmFsdWUsIG1lbWJlck5hbWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDxJbnRBcnJheT4xPC9JbnRBcnJheT5cclxuICA8SW50QXJyYXk+MjwvSW50QXJyYXk+XHJcbiAgPEludEFycmF5PjM8L0ludEFycmF5PlxyXG48L3dyYXBwZXI+IiwNCiAgICAgICAgICAgIHdyYXBwZXJOYW1lOiAid3JhcHBlciIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKHJlcXVlc3RCb2R5QWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHJlcXVlc3RCb2R5VmFsdWUuQ291bnQoKSwgcmVxdWVzdEJvZHlBY3R1YWwuQ291bnQoKSk7DQogICAgICAgIEFzc2VydC5UcnVlKEVudW1lcmFibGUuU2VxdWVuY2VFcXVhbChyZXF1ZXN0Qm9keVZhbHVlLCByZXF1ZXN0Qm9keUFjdHVhbCkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19UeXBlSGF2aW5nSW50QXJyYXkoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUgPSAiZGF0YSI7DQogICAgICAgIHZhciByZXF1ZXN0Qm9keVZhbHVlID0gbmV3IFhtbE1lbWJlcnNNYXBwaW5nVHlwZUhhdmluZ0ludEFycmF5KCkgeyBJbnRBcnJheSA9IG5ldyBpbnRbXSB7IDEsIDIsIDMgfSB9Ow0KICAgICAgICB2YXIgcmVxdWVzdEJvZHlBY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmc8WG1sTWVtYmVyc01hcHBpbmdUeXBlSGF2aW5nSW50QXJyYXk+KHJlcXVlc3RCb2R5VmFsdWUsIG1lbWJlck5hbWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDxkYXRhPlxyXG4gICAgPEludEFycmF5PlxyXG4gICAgICA8aW50PjE8L2ludD5cclxuICAgICAgPGludD4yPC9pbnQ+XHJcbiAgICAgIDxpbnQ+MzwvaW50PlxyXG4gICAgPC9JbnRBcnJheT5cclxuICA8L2RhdGE+XHJcbjwvd3JhcHBlcj4iLA0KICAgICAgICAgICAgd3JhcHBlck5hbWU6ICJ3cmFwcGVyIik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwocmVxdWVzdEJvZHlBY3R1YWwpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChyZXF1ZXN0Qm9keUFjdHVhbC5JbnRBcnJheSk7DQogICAgICAgIEFzc2VydC5FcXVhbChyZXF1ZXN0Qm9keVZhbHVlLkludEFycmF5Lkxlbmd0aCwgcmVxdWVzdEJvZHlBY3R1YWwuSW50QXJyYXkuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoRW51bWVyYWJsZS5TZXF1ZW5jZUVxdWFsKHJlcXVlc3RCb2R5VmFsdWUuSW50QXJyYXksIHJlcXVlc3RCb2R5QWN0dWFsLkludEFycmF5KSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX1R5cGVXaXRoWG1sQXR0cmlidXRlcygpDQogICAgew0KICAgICAgICBzdHJpbmcgbWVtYmVyTmFtZSA9ICJkYXRhIjsNCiAgICAgICAgc3RyaW5nIG5zID0gc19kZWZhdWx0TnM7DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxUeXBlV2l0aFhtbEF0dHJpYnV0ZXM+KG1lbWJlck5hbWUsIG5zKTsNCiAgICAgICAgdmFyIG1lbWJlcnMgPSBuZXcgWG1sUmVmbGVjdGlvbk1lbWJlcltdIHsgbWVtYmVyIH07DQoNCiAgICAgICAgVHlwZVdpdGhYbWxBdHRyaWJ1dGVzIHZhbHVlID0gbmV3IFR5cGVXaXRoWG1sQXR0cmlidXRlcyB7IE15TmFtZSA9ICJmb29uYW1lIiwgVG9kYXkgPSBEYXRlVGltZS5Ob3cgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZzxUeXBlV2l0aFhtbEF0dHJpYnV0ZXM+KHZhbHVlLA0KICAgICAgICAgICAgbWVtYmVyTmFtZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48d3JhcHBlciB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgeG1sbnM9XCJodHRwOi8vdGVtcHVyaS5vcmcvXCI+XHJcbiAgPGRhdGEgZDJwMTpNeU5hbWU9XCJmb29uYW1lXCIgQ3JlYXRpb25EYXRlPVwiMjAxNy0wMy0yNFwiIHhtbG5zOmQycDE9XCJodHRwOi8vd3d3Lk15TnMub3JnXCIgLz5cclxuPC93cmFwcGVyPiIsDQogICAgICAgICAgICBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UsDQogICAgICAgICAgICB3cmFwcGVyTmFtZTogIndyYXBwZXIiKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19YbWxuc19UcnVlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lID0gIk15WG1sTnMiOw0KICAgICAgICBzdHJpbmcgbnMgPSBzX2RlZmF1bHROczsNCiAgICAgICAgWG1sUmVmbGVjdGlvbk1lbWJlciBtZW1iZXIgPSBHZXRSZWZsZWN0aW9uTWVtYmVyTm9YbWxFbGVtZW50PFhtbFNlcmlhbGl6ZXJOYW1lc3BhY2VzPihtZW1iZXJOYW1lLCBucyk7DQogICAgICAgIG1lbWJlci5YbWxBdHRyaWJ1dGVzLlhtbG5zID0gdHJ1ZTsNCiAgICAgICAgdmFyIG1lbWJlcnMgPSBuZXcgWG1sUmVmbGVjdGlvbk1lbWJlcltdIHsgbWVtYmVyIH07DQogICAgICAgIHZhciB4bWxucyA9IG5ldyBYbWxTZXJpYWxpemVyTmFtZXNwYWNlcygpOw0KICAgICAgICB4bWxucy5BZGQoIk15TlMiLCAibXlOUy50ZW1wdXJpLm9yZyIpOw0KICAgICAgICB4bWxucy5BZGQoImNvbW1vbiIsICJjb21tb24udGVtcHVyaS5vcmciKTsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IG9iamVjdFtdIHsgeG1sbnMgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZygNCiAgICAgICAgICAgIHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjx3cmFwcGVyIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiB4bWxuczpNeU5TPVwibXlOUy50ZW1wdXJpLm9yZ1wiIHhtbG5zOmNvbW1vbj1cImNvbW1vbi50ZW1wdXJpLm9yZ1wiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiIC8+IiwNCiAgICAgICAgICAgIHNraXBTdHJpbmdDb21wYXJlOiBmYWxzZSwNCiAgICAgICAgICAgIG1lbWJlcnM6IG1lbWJlcnMsDQogICAgICAgICAgICB3cmFwcGVyTmFtZTogIndyYXBwZXIiKTsNCg0KICAgICAgICB2YXIgeG1sbnNBY3R1YWwgPSAoWG1sU2VyaWFsaXplck5hbWVzcGFjZXMpYWN0dWFsWzBdOw0KICAgICAgICBBc3NlcnQuTm90TnVsbCh4bWxuc0FjdHVhbCk7DQogICAgICAgIHZhciB4bWxuc0FjdHVhbEFycmF5ID0geG1sbnNBY3R1YWwuVG9BcnJheSgpOw0KICAgICAgICBmb3JlYWNoICh2YXIgbnNTdHJpbmcgaW4geG1sbnMuVG9BcnJheSgpKQ0KICAgICAgICB7DQogICAgICAgICAgICBib29sIGV4aXN0SW5BY3R1YWxBcnJheSA9IGZhbHNlOw0KICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFjdHVhbE5zIGluIHhtbG5zQWN0dWFsQXJyYXkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG5zU3RyaW5nLkVxdWFscyhhY3R1YWxOcykpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBleGlzdEluQWN0dWFsQXJyYXkgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGV4aXN0SW5BY3R1YWxBcnJheSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sTWVtYmVyc01hcHBpbmdfTWVtYmVyX1dpdGhfWG1sQW55QXR0cmlidXRlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lMSA9ICJTdHJpbmdNZW1iZXIiOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlcjEgPSBHZXRSZWZsZWN0aW9uTWVtYmVyPHN0cmluZz4obWVtYmVyTmFtZTEsIHNfZGVmYXVsdE5zKTsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUyID0gIlhtbEF0dHJpYnV0ZXMiOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlcjIgPSBHZXRSZWZsZWN0aW9uTWVtYmVyTm9YbWxFbGVtZW50PFhtbEF0dHJpYnV0ZVtdPihtZW1iZXJOYW1lMiwgc19kZWZhdWx0TnMpOw0KICAgICAgICBtZW1iZXIyLlhtbEF0dHJpYnV0ZXMuWG1sQW55QXR0cmlidXRlID0gbmV3IFhtbEFueUF0dHJpYnV0ZUF0dHJpYnV0ZSgpOw0KDQogICAgICAgIHZhciBtZW1iZXJzID0gbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXJbXSB7IG1lbWJlcjEsIG1lbWJlcjIgfTsNCg0KICAgICAgICB2YXIgaW1wb3J0ZXIgPSBuZXcgWG1sUmVmbGVjdGlvbkltcG9ydGVyKG51bGwsIHNfZGVmYXVsdE5zKTsNCiAgICAgICAgdmFyIG1lbWJlcnNNYXBwaW5nID0gaW1wb3J0ZXIuSW1wb3J0TWVtYmVyc01hcHBpbmcoIndyYXBwZXIiLCBzX2RlZmF1bHROcywgbWVtYmVycywgdHJ1ZSk7DQogICAgICAgIHZhciBzZXJpYWxpemVyID0gWG1sU2VyaWFsaXplci5Gcm9tTWFwcGluZ3MobmV3IFhtbE1hcHBpbmdbXSB7IG1lbWJlcnNNYXBwaW5nIH0pWzBdOw0KICAgICAgICB2YXIgbXMgPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQoNCiAgICAgICAgc3RyaW5nIG91dHB1dCA9DQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIG15YXR0cmlidXRlMT1cIm15QXR0cmlidXRlMVwiIG15YXR0cmlidXRlMj1cIm15QXR0cmlidXRlMlwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiID5cclxuICA8U3RyaW5nTWVtYmVyPnN0cmluZyB2YWx1ZTwvU3RyaW5nTWVtYmVyPlxyXG4gPC93cmFwcGVyPiI7DQogICAgICAgIHZhciBzdyA9IG5ldyBTdHJlYW1Xcml0ZXIobXMpOw0KICAgICAgICBzdy5Xcml0ZShvdXRwdXQpOw0KICAgICAgICBzdy5GbHVzaCgpOw0KICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQogICAgICAgIHZhciBkZXNlcmlhbGl6ZWQgPSBzZXJpYWxpemVyLkRlc2VyaWFsaXplKG1zKSBhcyBvYmplY3RbXTsNCiAgICAgICAgQXNzZXJ0LlRydWUoZGVzZXJpYWxpemVkICE9IG51bGwsICJkZXNlcmlhbGl6ZWQgd2FzIG51bGwuIik7DQogICAgICAgIEFzc2VydC5FcXVhbCgic3RyaW5nIHZhbHVlIiwgKHN0cmluZylkZXNlcmlhbGl6ZWRbMF0pOw0KICAgICAgICB2YXIgeG1sQXR0cmlidXRlcyA9IGRlc2VyaWFsaXplZFsxXSBhcyBYbWxBdHRyaWJ1dGVbXTsNCiAgICAgICAgQXNzZXJ0LlRydWUoeG1sQXR0cmlidXRlcyAhPSBudWxsLCAieG1sQXR0cmlidXRlcyB3YXMgbnVsbC4iKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKDIsIHhtbEF0dHJpYnV0ZXMuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKCJteWF0dHJpYnV0ZTEiLCB4bWxBdHRyaWJ1dGVzWzBdLk5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoIm15YXR0cmlidXRlMiIsIHhtbEF0dHJpYnV0ZXNbMV0uTmFtZSk7DQoNCiAgICAgICAgbXMgPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQogICAgICAgIHNlcmlhbGl6ZXIuU2VyaWFsaXplKG1zLCBkZXNlcmlhbGl6ZWQpOw0KICAgICAgICBtcy5GbHVzaCgpOw0KICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQogICAgICAgIHN0cmluZyBhY3R1YWxPdXRwdXQgPSBuZXcgU3RyZWFtUmVhZGVyKG1zKS5SZWFkVG9FbmQoKTsNCg0KICAgICAgICBVdGlscy5Db21wYXJlUmVzdWx0IHJlc3VsdCA9IFV0aWxzLkNvbXBhcmUob3V0cHV0LCBhY3R1YWxPdXRwdXQpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShyZXN1bHQuRXF1YWwsIHN0cmluZy5Gb3JtYXQoInsxfXswfVRlc3QgZmFpbGVkIGZvciBpbnB1dDogezJ9ezB9RXhwZWN0ZWQ6IHszfXswfUFjdHVhbDogezR9IiwNCiAgICAgICAgICAgIEVudmlyb25tZW50Lk5ld0xpbmUsIHJlc3VsdC5FcnJvck1lc3NhZ2UsIGRlc2VyaWFsaXplZCwgb3V0cHV0LCBhY3R1YWxPdXRwdXQpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sTWVtYmVyc01hcHBpbmdfTWVtYmVyX1dpdGhfWG1sQW55QXR0cmlidXRlX1NwZWNpZmllZF9UcnVlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lMSA9ICJTdHJpbmdNZW1iZXIiOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlcjEgPSBHZXRSZWZsZWN0aW9uTWVtYmVyPHN0cmluZz4obWVtYmVyTmFtZTEsIHNfZGVmYXVsdE5zKTsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUyID0gIlhtbEF0dHJpYnV0ZXMiOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlcjIgPSBHZXRSZWZsZWN0aW9uTWVtYmVyTm9YbWxFbGVtZW50PFhtbEF0dHJpYnV0ZVtdPihtZW1iZXJOYW1lMiwgc19kZWZhdWx0TnMpOw0KICAgICAgICBtZW1iZXIyLlhtbEF0dHJpYnV0ZXMuWG1sQW55QXR0cmlidXRlID0gbmV3IFhtbEFueUF0dHJpYnV0ZUF0dHJpYnV0ZSgpOw0KICAgICAgICBzdHJpbmcgbWVtYmVyTmFtZTMgPSAiWG1sQXR0cmlidXRlc1NwZWNpZmllZCI7DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyMyA9IEdldFJlZmxlY3Rpb25NZW1iZXJOb1htbEVsZW1lbnQ8Ym9vbD4obWVtYmVyTmFtZTMsIHNfZGVmYXVsdE5zKTsNCg0KICAgICAgICB2YXIgbWVtYmVycyA9IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIxLCBtZW1iZXIyLCBtZW1iZXIzIH07DQoNCiAgICAgICAgdmFyIGltcG9ydGVyID0gbmV3IFhtbFJlZmxlY3Rpb25JbXBvcnRlcihudWxsLCBzX2RlZmF1bHROcyk7DQogICAgICAgIHZhciBtZW1iZXJzTWFwcGluZyA9IGltcG9ydGVyLkltcG9ydE1lbWJlcnNNYXBwaW5nKCJ3cmFwcGVyIiwgc19kZWZhdWx0TnMsIG1lbWJlcnMsIHRydWUpOw0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IFhtbFNlcmlhbGl6ZXIuRnJvbU1hcHBpbmdzKG5ldyBYbWxNYXBwaW5nW10geyBtZW1iZXJzTWFwcGluZyB9KVswXTsNCiAgICAgICAgdmFyIG1zID0gbmV3IE1lbW9yeVN0cmVhbSgpOw0KDQogICAgICAgIHN0cmluZyBvdXRwdXQgPQ0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjx3cmFwcGVyIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBteWF0dHJpYnV0ZTE9XCJteUF0dHJpYnV0ZTFcIiBteWF0dHJpYnV0ZTI9XCJteUF0dHJpYnV0ZTJcIiB4bWxucz1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIiA+XHJcbiAgPFN0cmluZ01lbWJlcj5zdHJpbmcgdmFsdWU8L1N0cmluZ01lbWJlcj5cclxuIDxYbWxBdHRyaWJ1dGVzU3BlY2lmaWVkPnRydWU8L1htbEF0dHJpYnV0ZXNTcGVjaWZpZWQ+PC93cmFwcGVyPiI7DQogICAgICAgIHZhciBzdyA9IG5ldyBTdHJlYW1Xcml0ZXIobXMpOw0KICAgICAgICBzdy5Xcml0ZShvdXRwdXQpOw0KICAgICAgICBzdy5GbHVzaCgpOw0KICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQogICAgICAgIHZhciBkZXNlcmlhbGl6ZWQgPSBzZXJpYWxpemVyLkRlc2VyaWFsaXplKG1zKSBhcyBvYmplY3RbXTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoZGVzZXJpYWxpemVkKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKCJzdHJpbmcgdmFsdWUiLCAoc3RyaW5nKWRlc2VyaWFsaXplZFswXSk7DQogICAgICAgIHZhciB4bWxBdHRyaWJ1dGVzID0gZGVzZXJpYWxpemVkWzFdIGFzIFhtbEF0dHJpYnV0ZVtdOw0KICAgICAgICBBc3NlcnQuTm90TnVsbCh4bWxBdHRyaWJ1dGVzKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKDIsIHhtbEF0dHJpYnV0ZXMuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKCJteWF0dHJpYnV0ZTEiLCB4bWxBdHRyaWJ1dGVzWzBdLk5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoIm15YXR0cmlidXRlMiIsIHhtbEF0dHJpYnV0ZXNbMV0uTmFtZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh0cnVlLCBkZXNlcmlhbGl6ZWRbMl0pOw0KDQogICAgICAgIG1zID0gbmV3IE1lbW9yeVN0cmVhbSgpOw0KICAgICAgICBzZXJpYWxpemVyLlNlcmlhbGl6ZShtcywgZGVzZXJpYWxpemVkKTsNCiAgICAgICAgbXMuRmx1c2goKTsNCiAgICAgICAgbXMuUG9zaXRpb24gPSAwOw0KICAgICAgICBzdHJpbmcgYWN0dWFsT3V0cHV0ID0gbmV3IFN0cmVhbVJlYWRlcihtcykuUmVhZFRvRW5kKCk7DQoNCiAgICAgICAgVXRpbHMuQ29tcGFyZVJlc3VsdCByZXN1bHQgPSBVdGlscy5Db21wYXJlKG91dHB1dCwgYWN0dWFsT3V0cHV0KTsNCiAgICAgICAgQXNzZXJ0LlRydWUocmVzdWx0LkVxdWFsLCBzdHJpbmcuRm9ybWF0KCJ7MX17MH1UZXN0IGZhaWxlZCBmb3IgaW5wdXQ6IHsyfXswfUV4cGVjdGVkOiB7M317MH1BY3R1YWw6IHs0fSIsDQogICAgICAgICAgICBFbnZpcm9ubWVudC5OZXdMaW5lLCByZXN1bHQuRXJyb3JNZXNzYWdlLCBkZXNlcmlhbGl6ZWQsIG91dHB1dCwgYWN0dWFsT3V0cHV0KSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX01lbWJlcl9XaXRoX1htbEFueUF0dHJpYnV0ZV9TcGVjaWZpZWRfRmFsc2UoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUxID0gIlN0cmluZ01lbWJlciI7DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyMSA9IEdldFJlZmxlY3Rpb25NZW1iZXI8c3RyaW5nPihtZW1iZXJOYW1lMSwgc19kZWZhdWx0TnMpOw0KICAgICAgICBzdHJpbmcgbWVtYmVyTmFtZTIgPSAiWG1sQXR0cmlidXRlcyI7DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyMiA9IEdldFJlZmxlY3Rpb25NZW1iZXJOb1htbEVsZW1lbnQ8WG1sQXR0cmlidXRlW10+KG1lbWJlck5hbWUyLCBzX2RlZmF1bHROcyk7DQogICAgICAgIG1lbWJlcjIuWG1sQXR0cmlidXRlcy5YbWxBbnlBdHRyaWJ1dGUgPSBuZXcgWG1sQW55QXR0cmlidXRlQXR0cmlidXRlKCk7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lMyA9ICJYbWxBdHRyaWJ1dGVzU3BlY2lmaWVkIjsNCiAgICAgICAgWG1sUmVmbGVjdGlvbk1lbWJlciBtZW1iZXIzID0gR2V0UmVmbGVjdGlvbk1lbWJlck5vWG1sRWxlbWVudDxib29sPihtZW1iZXJOYW1lMywgc19kZWZhdWx0TnMpOw0KDQogICAgICAgIHZhciBtZW1iZXJzID0gbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXJbXSB7IG1lbWJlcjEsIG1lbWJlcjIsIG1lbWJlcjMgfTsNCg0KICAgICAgICB2YXIgaW1wb3J0ZXIgPSBuZXcgWG1sUmVmbGVjdGlvbkltcG9ydGVyKG51bGwsIHNfZGVmYXVsdE5zKTsNCiAgICAgICAgdmFyIG1lbWJlcnNNYXBwaW5nID0gaW1wb3J0ZXIuSW1wb3J0TWVtYmVyc01hcHBpbmcoIndyYXBwZXIiLCBzX2RlZmF1bHROcywgbWVtYmVycywgdHJ1ZSk7DQogICAgICAgIHZhciBzZXJpYWxpemVyID0gWG1sU2VyaWFsaXplci5Gcm9tTWFwcGluZ3MobmV3IFhtbE1hcHBpbmdbXSB7IG1lbWJlcnNNYXBwaW5nIH0pWzBdOw0KICAgICAgICB2YXIgbXMgPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQoNCiAgICAgICAgc3RyaW5nIG91dHB1dCA9DQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIG15YXR0cmlidXRlMT1cIm15QXR0cmlidXRlMVwiIG15YXR0cmlidXRlMj1cIm15QXR0cmlidXRlMlwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiID5cclxuICA8U3RyaW5nTWVtYmVyPnN0cmluZyB2YWx1ZTwvU3RyaW5nTWVtYmVyPlxyXG4gPFhtbEF0dHJpYnV0ZXNTcGVjaWZpZWQ+ZmFsc2U8L1htbEF0dHJpYnV0ZXNTcGVjaWZpZWQ+PC93cmFwcGVyPiI7DQogICAgICAgIHZhciBzdyA9IG5ldyBTdHJlYW1Xcml0ZXIobXMpOw0KICAgICAgICBzdy5Xcml0ZShvdXRwdXQpOw0KICAgICAgICBzdy5GbHVzaCgpOw0KICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQogICAgICAgIHZhciBkZXNlcmlhbGl6ZWQgPSBzZXJpYWxpemVyLkRlc2VyaWFsaXplKG1zKSBhcyBvYmplY3RbXTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoZGVzZXJpYWxpemVkKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKCJzdHJpbmcgdmFsdWUiLCAoc3RyaW5nKWRlc2VyaWFsaXplZFswXSk7DQogICAgICAgIHZhciB4bWxBdHRyaWJ1dGVzID0gZGVzZXJpYWxpemVkWzFdIGFzIFhtbEF0dHJpYnV0ZVtdOw0KICAgICAgICBBc3NlcnQuTm90TnVsbCh4bWxBdHRyaWJ1dGVzKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKDIsIHhtbEF0dHJpYnV0ZXMuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKCJteWF0dHJpYnV0ZTEiLCB4bWxBdHRyaWJ1dGVzWzBdLk5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoIm15YXR0cmlidXRlMiIsIHhtbEF0dHJpYnV0ZXNbMV0uTmFtZSk7DQogICAgICAgIEFzc2VydC5FcXVhbChmYWxzZSwgZGVzZXJpYWxpemVkWzJdKTsNCg0KICAgICAgICBtcyA9IG5ldyBNZW1vcnlTdHJlYW0oKTsNCiAgICAgICAgc2VyaWFsaXplci5TZXJpYWxpemUobXMsIGRlc2VyaWFsaXplZCk7DQogICAgICAgIG1zLkZsdXNoKCk7DQogICAgICAgIG1zLlBvc2l0aW9uID0gMDsNCiAgICAgICAgc3RyaW5nIGFjdHVhbE91dHB1dCA9IG5ldyBTdHJlYW1SZWFkZXIobXMpLlJlYWRUb0VuZCgpOw0KDQogICAgICAgIHN0cmluZyBleHBlY3RlZE91dHB1dCA9DQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDxTdHJpbmdNZW1iZXI+c3RyaW5nIHZhbHVlPC9TdHJpbmdNZW1iZXI+XHJcbiAgPFhtbEF0dHJpYnV0ZXNTcGVjaWZpZWQ+ZmFsc2U8L1htbEF0dHJpYnV0ZXNTcGVjaWZpZWQ+XHJcbjwvd3JhcHBlcj4iOw0KICAgICAgICBVdGlscy5Db21wYXJlUmVzdWx0IHJlc3VsdCA9IFV0aWxzLkNvbXBhcmUoZXhwZWN0ZWRPdXRwdXQsIGFjdHVhbE91dHB1dCk7DQogICAgICAgIEFzc2VydC5UcnVlKHJlc3VsdC5FcXVhbCwgc3RyaW5nLkZvcm1hdCgiezF9ezB9VGVzdCBmYWlsZWQgZm9yIGlucHV0OiB7Mn17MH1FeHBlY3RlZDogezN9ezB9QWN0dWFsOiB7NH0iLA0KICAgICAgICAgICAgRW52aXJvbm1lbnQuTmV3TGluZSwgcmVzdWx0LkVycm9yTWVzc2FnZSwgZGVzZXJpYWxpemVkLCBleHBlY3RlZE91dHB1dCwgYWN0dWFsT3V0cHV0KSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX1dpdGhfQ2hvaWNlSWRlbnRpZmllcigpDQogICAgew0KICAgICAgICBzdHJpbmcgbnMgPSBzX2RlZmF1bHROczsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUxID0gIml0ZW1zIjsNCiAgICAgICAgWG1sUmVmbGVjdGlvbk1lbWJlciBtZW1iZXIxID0gR2V0UmVmbGVjdGlvbk1lbWJlck5vWG1sRWxlbWVudDxvYmplY3RbXT4obWVtYmVyTmFtZTEsIG5zKTsNCiAgICAgICAgUHJvcGVydHlJbmZvIGl0ZW1Qcm9wZXJ0eSA9IHR5cGVvZihUeXBlV2l0aFByb3BlcnR5SGF2aW5nQ2hvaWNlKS5HZXRQcm9wZXJ0eSgiTWFueUNob2ljZXMiKTsNCiAgICAgICAgbWVtYmVyMS5YbWxBdHRyaWJ1dGVzID0gbmV3IFhtbEF0dHJpYnV0ZXMoaXRlbVByb3BlcnR5KTsNCg0KICAgICAgICBzdHJpbmcgbWVtYmVyTmFtZTIgPSAiQ2hvaWNlQXJyYXkiOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlcjIgPSBHZXRSZWZsZWN0aW9uTWVtYmVyTm9YbWxFbGVtZW50PE1vcmVDaG9pY2VzW10+KG1lbWJlck5hbWUyLCBucyk7DQogICAgICAgIG1lbWJlcjIuWG1sQXR0cmlidXRlcy5YbWxJZ25vcmUgPSB0cnVlOw0KDQogICAgICAgIHZhciBtZW1iZXJzID0gbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXJbXSB7IG1lbWJlcjEsIG1lbWJlcjIgfTsNCg0KICAgICAgICBvYmplY3RbXSBpdGVtcyA9IHsgIkZvb2QiLCA1IH07DQogICAgICAgIHZhciBpdGVtQ2hvaWNlcyA9IG5ldyBNb3JlQ2hvaWNlc1tdIHsgTW9yZUNob2ljZXMuSXRlbSwgTW9yZUNob2ljZXMuQW1vdW50IH07DQogICAgICAgIG9iamVjdFtdIHZhbHVlID0geyBpdGVtcywgaXRlbUNob2ljZXMgfTsNCg0KICAgICAgICBvYmplY3RbXSBhY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmcodmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDxJdGVtPkZvb2Q8L0l0ZW0+XHJcbiAgPEFtb3VudD41PC9BbW91bnQ+XHJcbjwvd3JhcHBlcj4iLA0KICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICBtZW1iZXJzLA0KICAgICAgICAgICAgd3JhcHBlck5hbWU6ICJ3cmFwcGVyIik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgdmFyIGFjdHVhbEl0ZW1zID0gYWN0dWFsWzBdIGFzIG9iamVjdFtdOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWxJdGVtcyk7DQogICAgICAgIEFzc2VydC5UcnVlKGl0ZW1zLlNlcXVlbmNlRXF1YWwoYWN0dWFsSXRlbXMpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sTWVtYmVyc01hcHBpbmdfTXVsdGlwbGVNZW1iZXJzKCkNCiAgICB7DQogICAgICAgIHZhciBtZW1iZXIxID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxHZXREYXRhUmVxdWVzdEJvZHk+KCJHZXREYXRhIik7DQogICAgICAgIHZhciBtZW1iZXIyID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxpbnQ+KCJJbnRWYWx1ZSIpOw0KDQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHkgPSBuZXcgR2V0RGF0YVJlcXVlc3RCb2R5KCkgeyB2YWx1ZSA9IDMgfTsNCiAgICAgICAgaW50IGludFZhbHVlID0gMTE7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBvYmplY3RbXSB7IGdldERhdGFSZXF1ZXN0Qm9keSwgaW50VmFsdWUgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZygNCiAgICAgICAgICAgIHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjx3cmFwcGVyIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiB4bWxucz1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIj5cclxuICA8R2V0RGF0YT5cclxuICAgIDx2YWx1ZT4zPC92YWx1ZT5cclxuICA8L0dldERhdGE+XHJcbiAgPEludFZhbHVlPjExPC9JbnRWYWx1ZT5cclxuPC93cmFwcGVyPiIsDQogICAgICAgICAgICBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UsDQogICAgICAgICAgICBtZW1iZXJzOiBuZXcgWG1sUmVmbGVjdGlvbk1lbWJlcltdIHsgbWVtYmVyMSwgbWVtYmVyMiB9LA0KICAgICAgICAgICAgd3JhcHBlck5hbWU6ICJ3cmFwcGVyIik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCg0KICAgICAgICB2YXIgZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsID0gKEdldERhdGFSZXF1ZXN0Qm9keSlhY3R1YWxbMF07DQogICAgICAgIEFzc2VydC5FcXVhbChnZXREYXRhUmVxdWVzdEJvZHkudmFsdWUsIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbC52YWx1ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbChpbnRWYWx1ZSwgKGludClhY3R1YWxbMV0pOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19Tb2FwX1ByaW1pdGl2ZVZhbHVlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lID0gInZhbHVlIjsNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keVZhbHVlID0gMzsNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZ1NvYXA8aW50PihnZXREYXRhUmVxdWVzdEJvZHlWYWx1ZSwgbWVtYmVyTmFtZSwgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxpbnQgZDFwMTp0eXBlPVwiaW50XCIgeG1sbnM6ZDFwMT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPjM8L2ludD4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZ2V0RGF0YVJlcXVlc3RCb2R5VmFsdWUsIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19Tb2FwX1NpbXBsZVR5cGUoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUgPSAiR2V0RGF0YSI7DQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHlWYWx1ZSA9IG5ldyBHZXREYXRhUmVxdWVzdEJvZHkoMyk7DQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmdTb2FwPEdldERhdGFSZXF1ZXN0Qm9keT4oZ2V0RGF0YVJlcXVlc3RCb2R5VmFsdWUsIG1lbWJlck5hbWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHExOkdldERhdGFSZXF1ZXN0Qm9keSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgaWQ9XCJpZDFcIiB4bWxuczpxMT1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIj5cclxuICA8dmFsdWUgeHNpOnR5cGU9XCJ4c2Q6aW50XCI+MzwvdmFsdWU+XHJcbjwvcTE6R2V0RGF0YVJlcXVlc3RCb2R5PiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCk7DQogICAgICAgIEFzc2VydC5FcXVhbChnZXREYXRhUmVxdWVzdEJvZHlWYWx1ZS52YWx1ZSwgZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsLnZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX1NvYXBfQ29tcG9zaXRlVHlwZSgpDQogICAgew0KICAgICAgICBzdHJpbmcgbWVtYmVyTmFtZSA9ICJHZXREYXRhVXNpbmdEYXRhQ29udHJhY3QiOw0KICAgICAgICB2YXIgcmVxdWVzdEJvZHlWYWx1ZSA9IG5ldyBDb21wb3NpdGVUeXBlRm9yWG1sTWVtYmVyc01hcHBpbmcoKSB7IEJvb2xWYWx1ZSA9IHRydWUsIFN0cmluZ1ZhbHVlID0gImZvbyIgfTsNCiAgICAgICAgdmFyIHJlcXVlc3RCb2R5QWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nU29hcDxDb21wb3NpdGVUeXBlRm9yWG1sTWVtYmVyc01hcHBpbmc+KHJlcXVlc3RCb2R5VmFsdWUsIG1lbWJlck5hbWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHExOkNvbXBvc2l0ZVR5cGVGb3JYbWxNZW1iZXJzTWFwcGluZyB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgaWQ9XCJpZDFcIiB4bWxuczpxMT1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIj5cclxuICA8Qm9vbFZhbHVlIHhzaTp0eXBlPVwieHNkOmJvb2xlYW5cIj50cnVlPC9Cb29sVmFsdWU+XHJcbiAgPFN0cmluZ1ZhbHVlIHhzaTp0eXBlPVwieHNkOnN0cmluZ1wiPmZvbzwvU3RyaW5nVmFsdWU+XHJcbjwvcTE6Q29tcG9zaXRlVHlwZUZvclhtbE1lbWJlcnNNYXBwaW5nPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKHJlcXVlc3RCb2R5QWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHJlcXVlc3RCb2R5VmFsdWUuQm9vbFZhbHVlLCByZXF1ZXN0Qm9keUFjdHVhbC5Cb29sVmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwocmVxdWVzdEJvZHlWYWx1ZS5TdHJpbmdWYWx1ZSwgcmVxdWVzdEJvZHlBY3R1YWwuU3RyaW5nVmFsdWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19Tb2FwX1ByaW1pdGl2ZVZhbHVlX0hhc1dyYXBwZXJFbGVtZW50KCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lID0gInZhbHVlIjsNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keVZhbHVlID0gMzsNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZ1NvYXA8aW50PihnZXREYXRhUmVxdWVzdEJvZHlWYWx1ZSwNCiAgICAgICAgICAgIG1lbWJlck5hbWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHExOndyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zOnExPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDx2YWx1ZSB4c2k6dHlwZT1cInhzZDppbnRcIj4zPC92YWx1ZT5cclxuPC9xMTp3cmFwcGVyPiIsDQogICAgICAgICAgICB3cmFwcGVyTmFtZTogIndyYXBwZXIiKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZ2V0RGF0YVJlcXVlc3RCb2R5VmFsdWUsIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX1NvYXBfUHJpbWl0aXZlVmFsdWVfSGFzV3JhcHBlckVsZW1lbnRfVmFsaWRhdGUoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUgPSAidmFsdWUiOw0KICAgICAgICB2YXIgZ2V0RGF0YVJlcXVlc3RCb2R5VmFsdWUgPSAzOw0KICAgICAgICB2YXIgZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nU29hcDxpbnQ+KGdldERhdGFSZXF1ZXN0Qm9keVZhbHVlLA0KICAgICAgICAgICAgbWVtYmVyTmFtZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48cTE6d3JhcHBlciB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgeG1sbnM6cTE9XCJodHRwOi8vdGVtcHVyaS5vcmcvXCI+XHJcbiAgPHZhbHVlIHhzaTp0eXBlPVwieHNkOmludFwiPjM8L3ZhbHVlPlxyXG48L3ExOndyYXBwZXI+IiwNCiAgICAgICAgICAgIHdyYXBwZXJOYW1lOiAid3JhcHBlciIsDQogICAgICAgICAgICB2YWxpZGF0ZTogdHJ1ZSk7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGdldERhdGFSZXF1ZXN0Qm9keVZhbHVlLCBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19Tb2FwX01lbWJlclNwZWNpZmllZF9UcnVlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lMSA9ICJTdHJpbmdNZW1iZXIiOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlcjEgPSBHZXRSZWZsZWN0aW9uTWVtYmVyPHN0cmluZz4obWVtYmVyTmFtZTEsIHNfZGVmYXVsdE5zKTsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUyID0gIlN0cmluZ01lbWJlclNwZWNpZmllZCI7DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyMiA9IEdldFJlZmxlY3Rpb25NZW1iZXJOb1htbEVsZW1lbnQ8Ym9vbD4obWVtYmVyTmFtZTIsIHNfZGVmYXVsdE5zKTsNCg0KICAgICAgICB2YXIgbWVtYmVycyA9IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIxLCBtZW1iZXIyIH07DQoNCiAgICAgICAgb2JqZWN0W10gdmFsdWUgPSB7ICJzdHJpbmcgdmFsdWUiLCB0cnVlIH07DQogICAgICAgIG9iamVjdFtdIGFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZ1NvYXAoDQogICAgICAgICAgICB2YWx1ZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48cTE6d3JhcHBlciB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgeG1sbnM6cTE9XCJodHRwOi8vdGVtcHVyaS5vcmcvXCI+XHJcbiAgPFN0cmluZ01lbWJlciB4c2k6dHlwZT1cInhzZDpzdHJpbmdcIj5zdHJpbmcgdmFsdWU8L1N0cmluZ01lbWJlcj5cclxuICA8U3RyaW5nTWVtYmVyU3BlY2lmaWVkIHhzaTp0eXBlPVwieHNkOmJvb2xlYW5cIj50cnVlPC9TdHJpbmdNZW1iZXJTcGVjaWZpZWQ+XHJcbjwvcTE6d3JhcHBlcj4iLA0KICAgICAgICAgICAgc2tpcFN0cmluZ0NvbXBhcmU6IGZhbHNlLA0KICAgICAgICAgICAgbWVtYmVyczogbWVtYmVycywNCiAgICAgICAgICAgIHdyYXBwZXJOYW1lOiAid3JhcHBlciIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5MZW5ndGgsIGFjdHVhbC5MZW5ndGgpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWVbMF0sIGFjdHVhbFswXSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX1NvYXBfTWVtYmVyU3BlY2lmaWVkX0ZhbHNlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lMSA9ICJTdHJpbmdNZW1iZXIiOw0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlcjEgPSBHZXRSZWZsZWN0aW9uTWVtYmVyPHN0cmluZz4obWVtYmVyTmFtZTEsIHNfZGVmYXVsdE5zKTsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUyID0gIlN0cmluZ01lbWJlclNwZWNpZmllZCI7DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyMiA9IEdldFJlZmxlY3Rpb25NZW1iZXJOb1htbEVsZW1lbnQ8Ym9vbD4obWVtYmVyTmFtZTIsIHNfZGVmYXVsdE5zKTsNCg0KICAgICAgICB2YXIgbWVtYmVycyA9IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIxLCBtZW1iZXIyIH07DQoNCiAgICAgICAgb2JqZWN0W10gdmFsdWUgPSB7ICJzdHJpbmcgdmFsdWUiLCBmYWxzZSB9Ow0KICAgICAgICBvYmplY3RbXSBhY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmdTb2FwKA0KICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHExOndyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zOnExPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gPFN0cmluZ01lbWJlclNwZWNpZmllZCB4c2k6dHlwZT1cInhzZDpib29sZWFuXCI+ZmFsc2U8L1N0cmluZ01lbWJlclNwZWNpZmllZD5cclxuPC9xMTp3cmFwcGVyPiIsDQogICAgICAgICAgICBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UsDQogICAgICAgICAgICBtZW1iZXJzOiBtZW1iZXJzLA0KICAgICAgICAgICAgd3JhcHBlck5hbWU6ICJ3cmFwcGVyIik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkxlbmd0aCwgYWN0dWFsLkxlbmd0aCk7DQogICAgICAgIEFzc2VydC5OdWxsKGFjdHVhbFswXSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX011bHRpcGxlTWVtYmVyc19YbWxBbnlFbGVtZW50KCkNCiAgICB7DQogICAgICAgIHZhciBtZW1iZXIxID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxHZXREYXRhUmVxdWVzdEJvZHk+KCJHZXREYXRhIik7DQogICAgICAgIHZhciBtZW1iZXIyID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxpbnQ+KCJJbnRWYWx1ZSIpOw0KICAgICAgICB2YXIgbWVtYmVyMyA9IEdldFJlZmxlY3Rpb25NZW1iZXI8WG1sRWxlbWVudFtdPigiWG1sRWxlbWVudEFycmF5Iik7DQogICAgICAgIG1lbWJlcjMuWG1sQXR0cmlidXRlcy5YbWxBbnlFbGVtZW50cy5BZGQobmV3IFhtbEFueUVsZW1lbnRBdHRyaWJ1dGUoKSk7DQoNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keSA9IG5ldyBHZXREYXRhUmVxdWVzdEJvZHkoKSB7IHZhbHVlID0gMyB9Ow0KICAgICAgICBpbnQgaW50VmFsdWUgPSAxMTsNCg0KICAgICAgICBYbWxEb2N1bWVudCB4RG9jID0gbmV3IFhtbERvY3VtZW50KCk7DQogICAgICAgIHhEb2MuTG9hZFhtbChAIjxodG1sPjwvaHRtbD4iKTsNCiAgICAgICAgWG1sRWxlbWVudCBlbGVtZW50MSA9IHhEb2MuQ3JlYXRlRWxlbWVudCgibmFtZTEiLCAibnMxIik7DQogICAgICAgIGVsZW1lbnQxLklubmVyVGV4dCA9ICJFbGVtZW50IGlubmVydGV4dDEiOw0KICAgICAgICBYbWxFbGVtZW50IGVsZW1lbnQyID0geERvYy5DcmVhdGVFbGVtZW50KCJuYW1lMiIsICJuczIiKTsNCiAgICAgICAgZWxlbWVudDIuSW5uZXJUZXh0ID0gIkVsZW1lbnQgaW5uZXJ0ZXh0MiI7DQoNCiAgICAgICAgWG1sRWxlbWVudFtdIHhtbEVsZW1lbnRBcnJheSA9IHsgZWxlbWVudDEsIGVsZW1lbnQyIH07DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBvYmplY3RbXSB7IGdldERhdGFSZXF1ZXN0Qm9keSwgaW50VmFsdWUsIHhtbEVsZW1lbnRBcnJheSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nKA0KICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHdyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDxHZXREYXRhPlxyXG4gICAgPHZhbHVlPjM8L3ZhbHVlPlxyXG4gIDwvR2V0RGF0YT5cclxuICA8SW50VmFsdWU+MTE8L0ludFZhbHVlPlxyXG4gIDxYbWxFbGVtZW50QXJyYXk+XHJcbiAgICA8bmFtZTEgeG1sbnM9XCJuczFcIj5FbGVtZW50IGlubmVydGV4dDE8L25hbWUxPlxyXG4gIDwvWG1sRWxlbWVudEFycmF5PlxyXG4gIDxYbWxFbGVtZW50QXJyYXk+XHJcbiAgICA8bmFtZTIgeG1sbnM9XCJuczJcIj5FbGVtZW50IGlubmVydGV4dDI8L25hbWUyPlxyXG4gIDwvWG1sRWxlbWVudEFycmF5PlxyXG48L3dyYXBwZXI+IiwNCiAgICAgICAgICAgIHNraXBTdHJpbmdDb21wYXJlOiBmYWxzZSwNCiAgICAgICAgICAgIG1lbWJlcnM6IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIxLCBtZW1iZXIyLCBtZW1iZXIzIH0sDQogICAgICAgICAgICB3cmFwcGVyTmFtZTogIndyYXBwZXIiKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KDQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwgPSAoR2V0RGF0YVJlcXVlc3RCb2R5KWFjdHVhbFswXTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGdldERhdGFSZXF1ZXN0Qm9keS52YWx1ZSwgZ2V0RGF0YVJlcXVlc3RCb2R5QWN0dWFsLnZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGludFZhbHVlLCAoaW50KWFjdHVhbFsxXSk7DQogICAgICAgIFhtbEVsZW1lbnRbXSBhY3R1YWxYbWxFbGVtZW50QXJyYXkgPSBhY3R1YWxbMl0gYXMgWG1sRWxlbWVudFtdOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWxYbWxFbGVtZW50QXJyYXkpOw0KDQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgeG1sRWxlbWVudEFycmF5Lkxlbmd0aDsgaSsrKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoeG1sRWxlbWVudEFycmF5W2ldLk5hbWUsIGFjdHVhbFhtbEVsZW1lbnRBcnJheVtpXS5OYW1lKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCh4bWxFbGVtZW50QXJyYXlbaV0uTmFtZXNwYWNlVVJJLCBhY3R1YWxYbWxFbGVtZW50QXJyYXlbaV0uTmFtZXNwYWNlVVJJKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCh4bWxFbGVtZW50QXJyYXlbaV0uSW5uZXJUZXh0LCBhY3R1YWxYbWxFbGVtZW50QXJyYXlbaV0uSW5uZXJUZXh0KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxNZW1iZXJzTWFwcGluZ19NdWx0aXBsZU1lbWJlcnNfSXNSZXR1cm5WYWx1ZSgpDQogICAgew0KICAgICAgICB2YXIgbWVtYmVyMSA9IEdldFJlZmxlY3Rpb25NZW1iZXI8R2V0RGF0YVJlcXVlc3RCb2R5PigiR2V0RGF0YSIsIG51bGwpOw0KICAgICAgICBtZW1iZXIxLklzUmV0dXJuVmFsdWUgPSB0cnVlOw0KDQogICAgICAgIHZhciBtZW1iZXIyID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxpbnQ+KCJJbnRWYWx1ZSIsIG51bGwpOw0KDQogICAgICAgIHZhciBnZXREYXRhUmVxdWVzdEJvZHkgPSBuZXcgR2V0RGF0YVJlcXVlc3RCb2R5KCkgeyB2YWx1ZSA9IDMgfTsNCiAgICAgICAgaW50IGludFZhbHVlID0gMTE7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBvYmplY3RbXSB7IGdldERhdGFSZXF1ZXN0Qm9keSwgaW50VmFsdWUgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZygNCiAgICAgICAgICAgIHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjx3cmFwcGVyIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiB4bWxucz1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIj5cclxuICA8R2V0RGF0YSB4bWxucz1cIlwiPlxyXG4gICAgPHZhbHVlIHhtbG5zPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPjM8L3ZhbHVlPlxyXG4gIDwvR2V0RGF0YT5cclxuICA8SW50VmFsdWUgeG1sbnM9XCJcIj4xMTwvSW50VmFsdWU+XHJcbjwvd3JhcHBlcj4iLA0KICAgICAgICAgICAgc2tpcFN0cmluZ0NvbXBhcmU6IGZhbHNlLA0KICAgICAgICAgICAgbWVtYmVyczogbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXJbXSB7IG1lbWJlcjEsIG1lbWJlcjIgfSwNCiAgICAgICAgICAgIHdyYXBwZXJOYW1lOiAid3JhcHBlciIsDQogICAgICAgICAgICBycGM6IHRydWUpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQoNCiAgICAgICAgdmFyIGdldERhdGFSZXF1ZXN0Qm9keUFjdHVhbCA9IChHZXREYXRhUmVxdWVzdEJvZHkpYWN0dWFsWzBdOw0KICAgICAgICBBc3NlcnQuRXF1YWwoZ2V0RGF0YVJlcXVlc3RCb2R5LnZhbHVlLCBnZXREYXRhUmVxdWVzdEJvZHlBY3R1YWwudmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoaW50VmFsdWUsIChpbnQpYWN0dWFsWzFdKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sTWVtYmVyc01hcHBpbmdfU29hcF9NdWx0aXBsZU1lbWJlcnNfSXNSZXR1cm5WYWx1ZSgpDQogICAgew0KICAgICAgICB2YXIgbWVtYmVyMSA9IEdldFJlZmxlY3Rpb25NZW1iZXI8aW50PigiSW50UmV0dXJuVmFsdWUiLCBudWxsKTsNCiAgICAgICAgbWVtYmVyMS5Jc1JldHVyblZhbHVlID0gdHJ1ZTsNCg0KICAgICAgICB2YXIgbWVtYmVyMiA9IEdldFJlZmxlY3Rpb25NZW1iZXI8aW50PigiSW50VmFsdWUiLCBudWxsKTsNCg0KICAgICAgICBpbnQgaW50UmV0dXJuVmFsdWUgPSAzOw0KICAgICAgICBpbnQgaW50VmFsdWUgPSAxMTsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IG9iamVjdFtdIHsgaW50UmV0dXJuVmFsdWUsIGludFZhbHVlIH07DQogICAgICAgIHZhciBhY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmdTb2FwKA0KICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHExOndyYXBwZXIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zOnExPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPlxyXG4gIDxJbnRSZXR1cm5WYWx1ZSB4c2k6dHlwZT1cInhzZDppbnRcIj4zPC9JbnRSZXR1cm5WYWx1ZT5cclxuICA8SW50VmFsdWUgeHNpOnR5cGU9XCJ4c2Q6aW50XCI+MTE8L0ludFZhbHVlPlxyXG48L3ExOndyYXBwZXI+IiwNCiAgICAgICAgICAgIHNraXBTdHJpbmdDb21wYXJlOiBmYWxzZSwNCiAgICAgICAgICAgIG1lbWJlcnM6IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIxLCBtZW1iZXIyIH0sDQogICAgICAgICAgICB3cmFwcGVyTmFtZTogIndyYXBwZXIiLA0KICAgICAgICAgICAgd3JpdGVBY2Nlc3NvcnM6IHRydWUpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQoNCiAgICAgICAgdmFyIGludFJldHVyblZhbHVlQWN0dWFsID0gKGludClhY3R1YWxbMF07DQogICAgICAgIEFzc2VydC5FcXVhbChpbnRSZXR1cm5WYWx1ZSwgaW50UmV0dXJuVmFsdWVBY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoaW50VmFsdWUsIChpbnQpYWN0dWFsWzFdKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVXaXRoUmVhZE9ubHlNeUNvbGxlY3Rpb25Qcm9wZXJ0eSgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhSZWFkT25seU15Q29sbGVjdGlvblByb3BlcnR5KCk7DQogICAgICAgIHZhbHVlLkNvbGxlY3Rpb24uQWRkKCJzMSIpOw0KICAgICAgICB2YWx1ZS5Db2xsZWN0aW9uLkFkZCgiczIiKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplV2l0aFdyYXBwZXIodmFsdWUsIG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihUeXBlV2l0aFJlYWRPbmx5TXlDb2xsZWN0aW9uUHJvcGVydHkpKSwgIjxyb290PjxUeXBlV2l0aFJlYWRPbmx5TXlDb2xsZWN0aW9uUHJvcGVydHkgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPjxDb2xsZWN0aW9uPjxzdHJpbmc+czE8L3N0cmluZz48c3RyaW5nPnMyPC9zdHJpbmc+PC9Db2xsZWN0aW9uPjwvVHlwZVdpdGhSZWFkT25seU15Q29sbGVjdGlvblByb3BlcnR5Pjwvcm9vdD4iKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsLkNvbGxlY3Rpb24pOw0KICAgICAgICBBc3NlcnQuVHJ1ZSh2YWx1ZS5Db2xsZWN0aW9uLlNlcXVlbmNlRXF1YWwoYWN0dWFsLkNvbGxlY3Rpb24pKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX1R5cGVXaXRoUmVhZE9ubHlNeUNvbGxlY3Rpb25Qcm9wZXJ0eSgpDQogICAgew0KICAgICAgICBYbWxUeXBlTWFwcGluZyBteVR5cGVNYXBwaW5nID0gbmV3IFNvYXBSZWZsZWN0aW9uSW1wb3J0ZXIoKS5JbXBvcnRUeXBlTWFwcGluZyh0eXBlb2YoVHlwZVdpdGhSZWFkT25seU15Q29sbGVjdGlvblByb3BlcnR5KSk7DQogICAgICAgIHZhciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIobXlUeXBlTWFwcGluZyk7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFJlYWRPbmx5TXlDb2xsZWN0aW9uUHJvcGVydHkoKTsNCiAgICAgICAgdmFsdWUuQ29sbGVjdGlvbi5BZGQoInMxIik7DQogICAgICAgIHZhbHVlLkNvbGxlY3Rpb24uQWRkKCJzMiIpOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemVXaXRoV3JhcHBlcih2YWx1ZSwgc2VyaWFsaXplciwgIjxyb290PjxUeXBlV2l0aFJlYWRPbmx5TXlDb2xsZWN0aW9uUHJvcGVydHkgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGlkPVwiaWQxXCI+PENvbGxlY3Rpb24gaHJlZj1cIiNpZDJcIiAvPjwvVHlwZVdpdGhSZWFkT25seU15Q29sbGVjdGlvblByb3BlcnR5PjxxMTpBcnJheSBpZD1cImlkMlwiIHhtbG5zOnEyPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBxMTphcnJheVR5cGU9XCJxMjpzdHJpbmdbXVwiIHhtbG5zOnExPVwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbmNvZGluZy9cIj48SXRlbT5zMTwvSXRlbT48SXRlbT5zMjwvSXRlbT48L3ExOkFycmF5Pjwvcm9vdD4iKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsLkNvbGxlY3Rpb24pOw0KICAgICAgICBBc3NlcnQuVHJ1ZSh2YWx1ZS5Db2xsZWN0aW9uLlNlcXVlbmNlRXF1YWwoYWN0dWFsLkNvbGxlY3Rpb24pKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbE1lbWJlcnNNYXBwaW5nX1NvYXBfU29hcENvbXBsZXhUeXBlKCkNCiAgICB7DQogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lID0gIkVjaG9Db21vc2l0ZVR5cGVYbWxTZXJpYWxpemVyRm9ybWF0U29hcFJlc3VsdCI7DQogICAgICAgIHZhciByZXF1ZXN0Qm9keVZhbHVlID0gbmV3IFNvYXBDb21wbGV4VHlwZSgpIHsgQm9vbFZhbHVlID0gdHJ1ZSwgU3RyaW5nVmFsdWUgPSAiaGVsbG8iIH07DQoNCiAgICAgICAgc3RyaW5nIGJhc2VsaW5lID0gIjxyb290PjxxMTpFY2hvQ29tb3NpdGVUeXBlWG1sU2VyaWFsaXplckZvcm1hdFNvYXBSZXNwb25zZSB4bWxuczpxMT1cImh0dHA6Ly90ZW1wdXJpLm9yZy9cIiB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCI+PEVjaG9Db21vc2l0ZVR5cGVYbWxTZXJpYWxpemVyRm9ybWF0U29hcFJlc3VsdCBocmVmPVwiI2lkMVwiLz48L3ExOkVjaG9Db21vc2l0ZVR5cGVYbWxTZXJpYWxpemVyRm9ybWF0U29hcFJlc3BvbnNlPjxxMjpTb2FwQ29tcGxleFR5cGUgaWQ9XCJpZDFcIiBhOnR5cGU9XCJxMjpTb2FwQ29tcGxleFR5cGVcIiB4bWxuczpxMj1cImh0dHA6Ly90ZW1wdXJpLm9yZy9lbmNvZGVkXCIgeG1sbnM6YT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCI+PEJvb2xWYWx1ZSBhOnR5cGU9XCJxMzpib29sZWFuXCIgeG1sbnM6cTM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPnRydWU8L0Jvb2xWYWx1ZT48U3RyaW5nVmFsdWUgYTp0eXBlPVwicTQ6c3RyaW5nXCIgeG1sbnM6cTQ9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPmhlbGxvPC9TdHJpbmdWYWx1ZT48L3EyOlNvYXBDb21wbGV4VHlwZT48L3Jvb3Q+IjsNCiAgICAgICAgc3RyaW5nIG5zID0gc19kZWZhdWx0TnM7DQogICAgICAgIHN0cmluZyB3cmFwcGVyTmFtZSA9ICJFY2hvQ29tb3NpdGVUeXBlWG1sU2VyaWFsaXplckZvcm1hdFNvYXBSZXNwb25zZSI7DQoNCiAgICAgICAgb2JqZWN0W10gdmFsdWUgPSBuZXcgb2JqZWN0W10geyByZXF1ZXN0Qm9keVZhbHVlIH07DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxTb2FwQ29tcGxleFR5cGU+KG1lbWJlck5hbWUsIG5zKTsNCiAgICAgICAgbWVtYmVyLlNvYXBBdHRyaWJ1dGVzLlNvYXBFbGVtZW50ID0gbmV3IFNvYXBFbGVtZW50QXR0cmlidXRlKG1lbWJlck5hbWUpOw0KICAgICAgICB2YXIgbWVtYmVycyA9IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIgfTsgICAgICAgIA0KDQogICAgICAgIHZhciBpbXBvcnRlciA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKG51bGwsICJodHRwOi8vdGVtcHVyaS5vcmcvZW5jb2RlZCIpOw0KICAgICAgICB2YXIgbWVtYmVyc01hcHBpbmcgPSBpbXBvcnRlci5JbXBvcnRNZW1iZXJzTWFwcGluZyh3cmFwcGVyTmFtZSwgbnMsIG1lbWJlcnMsIGhhc1dyYXBwZXJFbGVtZW50OiB0cnVlLCB3cml0ZUFjY2Vzc29yczogdHJ1ZSk7DQogICAgICAgIHZhciBzZXJpYWxpemVyID0gWG1sU2VyaWFsaXplci5Gcm9tTWFwcGluZ3MobmV3IFhtbE1hcHBpbmdbXSB7IG1lbWJlcnNNYXBwaW5nIH0pWzBdOw0KDQogICAgICAgIG9iamVjdFtdIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplV2l0aFdyYXBwZXIodmFsdWUsIHNlcmlhbGl6ZXIsIGJhc2VsaW5lKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkxlbmd0aCwgYWN0dWFsLkxlbmd0aCk7DQoNCiAgICAgICAgdmFyIHJlcXVlc3RCb2R5QWN0dWFsID0gKFNvYXBDb21wbGV4VHlwZSlhY3R1YWxbMF07DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKHJlcXVlc3RCb2R5QWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHJlcXVlc3RCb2R5VmFsdWUuQm9vbFZhbHVlLCByZXF1ZXN0Qm9keUFjdHVhbC5Cb29sVmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwocmVxdWVzdEJvZHlWYWx1ZS5TdHJpbmdWYWx1ZSwgcmVxdWVzdEJvZHlBY3R1YWwuU3RyaW5nVmFsdWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiZG90bmV0L2NvcmVmeCAjMTg5NjQiKV0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sTWVtYmVyc01hcHBpbmdfU29hcF9Tb2FwQ29tcGxleFR5cGVXaXRoQXJyYXkoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG1lbWJlck5hbWUgPSAiRWNob0NvbW9zaXRlVHlwZVhtbFNlcmlhbGl6ZXJGb3JtYXRTb2FwUmVzdWx0IjsNCiAgICAgICAgdmFyIHJlcXVlc3RCb2R5VmFsdWUgPSBuZXcgU29hcENvbXBsZXhUeXBlV2l0aEFycmF5KCkNCiAgICAgICAgew0KICAgICAgICAgICAgSW50QXJyYXkgPSBuZXcgaW50W10geyAxLCAyIH0sDQogICAgICAgICAgICBTdHJpbmdBcnJheSA9IG5ldyBzdHJpbmdbXSB7ICJmb28iLCAiYmFyIiB9LA0KICAgICAgICAgICAgSW50TGlzdCA9IG5ldyBMaXN0PGludD4oKSB7IDEsIDIgfSwNCiAgICAgICAgICAgIFN0cmluZ0xpc3QgPSBuZXcgTGlzdDxzdHJpbmc+KCkgeyAiZm9vIiwgImJhciIgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIHN0cmluZyBiYXNlbGluZSA9ICI8cm9vdD48cTE6RWNob0NvbW9zaXRlVHlwZVhtbFNlcmlhbGl6ZXJGb3JtYXRTb2FwUmVzcG9uc2UgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIHhtbG5zOnExPVwiaHR0cDovL3RlbXB1cmkub3JnL1wiPjxFY2hvQ29tb3NpdGVUeXBlWG1sU2VyaWFsaXplckZvcm1hdFNvYXBSZXN1bHQgaHJlZj1cIiNpZDFcIiAvPjwvcTE6RWNob0NvbW9zaXRlVHlwZVhtbFNlcmlhbGl6ZXJGb3JtYXRTb2FwUmVzcG9uc2U+PHEyOlNvYXBDb21wbGV4VHlwZVdpdGhBcnJheSBpZD1cImlkMVwiIGQycDE6dHlwZT1cInEyOlNvYXBDb21wbGV4VHlwZVdpdGhBcnJheVwiIHhtbG5zOmQycDE9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnEyPVwiaHR0cDovL3RlbXB1cmkub3JnL2VuY29kZWRcIj48SW50QXJyYXkgaHJlZj1cIiNpZDJcIiAvPjxTdHJpbmdBcnJheSBocmVmPVwiI2lkM1wiIC8+PEludExpc3QgaHJlZj1cIiNpZDRcIiAvPjxTdHJpbmdMaXN0IGhyZWY9XCIjaWQ1XCIgLz48L3EyOlNvYXBDb21wbGV4VHlwZVdpdGhBcnJheT48cTM6QXJyYXkgaWQ9XCJpZDJcIiB4bWxuczpxND1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgcTM6YXJyYXlUeXBlPVwicTQ6aW50WzJdXCIgeG1sbnM6cTM9XCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9zb2FwL2VuY29kaW5nL1wiPjxJdGVtPjE8L0l0ZW0+PEl0ZW0+MjwvSXRlbT48L3EzOkFycmF5PjxxNTpBcnJheSBpZD1cImlkM1wiIHhtbG5zOnE2PVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBxNTphcnJheVR5cGU9XCJxNjpzdHJpbmdbMl1cIiB4bWxuczpxNT1cImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3NvYXAvZW5jb2RpbmcvXCI+PEl0ZW0+Zm9vPC9JdGVtPjxJdGVtPmJhcjwvSXRlbT48L3E1OkFycmF5PjxxNzpBcnJheSBpZD1cImlkNFwiIHhtbG5zOnE4PVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBxNzphcnJheVR5cGU9XCJxODppbnRbMl1cIiB4bWxuczpxNz1cImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3NvYXAvZW5jb2RpbmcvXCI+PEl0ZW0+MTwvSXRlbT48SXRlbT4yPC9JdGVtPjwvcTc6QXJyYXk+PHE5OkFycmF5IGlkPVwiaWQ1XCIgeG1sbnM6cTEwPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBxOTphcnJheVR5cGU9XCJxMTA6c3RyaW5nWzJdXCIgeG1sbnM6cTk9XCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9zb2FwL2VuY29kaW5nL1wiPjxJdGVtPmZvbzwvSXRlbT48SXRlbT5iYXI8L0l0ZW0+PC9xOTpBcnJheT48L3Jvb3Q+IjsNCiAgICAgICAgc3RyaW5nIG5zID0gc19kZWZhdWx0TnM7DQogICAgICAgIHN0cmluZyB3cmFwcGVyTmFtZSA9ICJFY2hvQ29tb3NpdGVUeXBlWG1sU2VyaWFsaXplckZvcm1hdFNvYXBSZXNwb25zZSI7DQoNCiAgICAgICAgb2JqZWN0W10gdmFsdWUgPSBuZXcgb2JqZWN0W10geyByZXF1ZXN0Qm9keVZhbHVlIH07DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxTb2FwQ29tcGxleFR5cGVXaXRoQXJyYXk+KG1lbWJlck5hbWUsIG5zKTsNCiAgICAgICAgbWVtYmVyLlNvYXBBdHRyaWJ1dGVzLlNvYXBFbGVtZW50ID0gbmV3IFNvYXBFbGVtZW50QXR0cmlidXRlKG1lbWJlck5hbWUpOw0KICAgICAgICB2YXIgbWVtYmVycyA9IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIgfTsNCg0KICAgICAgICB2YXIgaW1wb3J0ZXIgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcihudWxsLCAiaHR0cDovL3RlbXB1cmkub3JnL2VuY29kZWQiKTsNCiAgICAgICAgdmFyIG1lbWJlcnNNYXBwaW5nID0gaW1wb3J0ZXIuSW1wb3J0TWVtYmVyc01hcHBpbmcod3JhcHBlck5hbWUsIG5zLCBtZW1iZXJzLCBoYXNXcmFwcGVyRWxlbWVudDogdHJ1ZSwgd3JpdGVBY2Nlc3NvcnM6IHRydWUpOw0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IFhtbFNlcmlhbGl6ZXIuRnJvbU1hcHBpbmdzKG5ldyBYbWxNYXBwaW5nW10geyBtZW1iZXJzTWFwcGluZyB9KVswXTsNCg0KICAgICAgICBvYmplY3RbXSBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZVdpdGhXcmFwcGVyKHZhbHVlLCBzZXJpYWxpemVyLCBiYXNlbGluZSk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5MZW5ndGgsIGFjdHVhbC5MZW5ndGgpOw0KDQogICAgICAgIHZhciByZXF1ZXN0Qm9keUFjdHVhbCA9IChTb2FwQ29tcGxleFR5cGVXaXRoQXJyYXkpYWN0dWFsWzBdOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChyZXF1ZXN0Qm9keUFjdHVhbCk7DQogICAgICAgIEFzc2VydC5UcnVlKHJlcXVlc3RCb2R5VmFsdWUuSW50QXJyYXkuU2VxdWVuY2VFcXVhbChyZXF1ZXN0Qm9keUFjdHVhbC5JbnRBcnJheSkpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShyZXF1ZXN0Qm9keVZhbHVlLlN0cmluZ0FycmF5LlNlcXVlbmNlRXF1YWwocmVxdWVzdEJvZHlBY3R1YWwuU3RyaW5nQXJyYXkpKTsNCiAgICAgICAgQXNzZXJ0LlRydWUocmVxdWVzdEJvZHlWYWx1ZS5JbnRMaXN0LlNlcXVlbmNlRXF1YWwocmVxdWVzdEJvZHlBY3R1YWwuSW50TGlzdCkpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShyZXF1ZXN0Qm9keVZhbHVlLlN0cmluZ0xpc3QuU2VxdWVuY2VFcXVhbChyZXF1ZXN0Qm9keUFjdHVhbC5TdHJpbmdMaXN0KSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9YbWxUZXh0QXR0cmlidXRlVGVzdCgpDQogICAgew0KICAgICAgICB2YXIgbXlHcm91cDEgPSBuZXcgR3JvdXAxV2l0aFhtbFRleHRBdHRyKCk7DQogICAgICAgIHZhciBhY3R1YWwxID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUobXlHcm91cDEsIEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz48R3JvdXAxV2l0aFhtbFRleHRBdHRyIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj48aW50PjMyMTwvaW50Pk9uZTxpbnQ+MjwvaW50Pjxkb3VibGU+MzwvZG91YmxlPlR3bzwvR3JvdXAxV2l0aFhtbFRleHRBdHRyPiIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShFbnVtZXJhYmxlLlNlcXVlbmNlRXF1YWwobXlHcm91cDEuQWxsLCBhY3R1YWwxLkFsbCkpOw0KDQogICAgICAgIHZhciBteUdyb3VwMiA9IG5ldyBHcm91cDJXaXRoWG1sVGV4dEF0dHIoKTsNCiAgICAgICAgbXlHcm91cDIuVHlwZU9mR3JvdXAgPSBHcm91cFR5cGUuTWVkaXVtOw0KICAgICAgICB2YXIgYWN0dWFsMiA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKG15R3JvdXAyLCBAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+PEdyb3VwMldpdGhYbWxUZXh0QXR0ciB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+TWVkaXVtPC9Hcm91cDJXaXRoWG1sVGV4dEF0dHI+Iik7DQogICAgICAgIEFzc2VydC5FcXVhbChteUdyb3VwMi5UeXBlT2ZHcm91cCwgYWN0dWFsMi5UeXBlT2ZHcm91cCk7DQoNCiAgICAgICAgdmFyIG15R3JvdXAzID0gbmV3IEdyb3VwM1dpdGhYbWxUZXh0QXR0cigpOw0KICAgICAgICB2YXIgYWN0dWFsMyA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKG15R3JvdXAzLCBAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+PEdyb3VwM1dpdGhYbWxUZXh0QXR0ciB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+MjAxNy0wNC0yMFQwMzowODoxNVo8L0dyb3VwM1dpdGhYbWxUZXh0QXR0cj4iKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKG15R3JvdXAzLkNyZWF0aW9uVGltZSwgYWN0dWFsMy5DcmVhdGlvblRpbWUpOw0KDQogICAgICAgIHZhciBteUdyb3VwNCA9IG5ldyBHcm91cDRXaXRoWG1sVGV4dEF0dHIoKTsNCiAgICAgICAgQXNzZXJ0LlRocm93czxJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uPigoKSA9PiB7IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKG15R3JvdXA0LCBudWxsLCBudWxsLCB0cnVlKTsgfSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9EZWZhdWx0TmFtZXNwYWNlQ2hhbmdlX1htbEF0dHJpYnV0ZXNUZXN0QXNSb290KCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBYbWxTZXJpYWxpemVyQXR0cmlidXRlcygpOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQogICAgICAgIDxBdHRyaWJ1dGVUZXN0aW5nIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIiBYbWxBdHRyaWJ1dGVOYW1lPSIiMiIiIHhtbG5zPSIiTXljdXN0b21EZWZhdWx0TmFtZXNwYWNlIiI+DQogICAgICAgICAgPFdvcmQ+U3RyaW5nIGNob2ljZSB2YWx1ZTwvV29yZD4NCiAgICAgICAgICA8WG1sSW5jbHVkZVByb3BlcnR5IHhzaTp0eXBlPSIiSXRlbUNob2ljZVR5cGUiIj5EZWNpbWFsTnVtYmVyPC9YbWxJbmNsdWRlUHJvcGVydHk+DQogICAgICAgICAgPFhtbEVudW1Qcm9wZXJ0eT4NCiAgICAgICAgICAgIDxJdGVtQ2hvaWNlVHlwZT5EZWNpbWFsTnVtYmVyPC9JdGVtQ2hvaWNlVHlwZT4NCiAgICAgICAgICAgIDxJdGVtQ2hvaWNlVHlwZT5OdW1iZXI8L0l0ZW1DaG9pY2VUeXBlPg0KICAgICAgICAgICAgPEl0ZW1DaG9pY2VUeXBlPldvcmQ8L0l0ZW1DaG9pY2VUeXBlPg0KICAgICAgICAgICAgPEl0ZW1DaG9pY2VUeXBlPk5vbmU8L0l0ZW1DaG9pY2VUeXBlPg0KICAgICAgICAgIDwvWG1sRW51bVByb3BlcnR5PiZsdDt4bWwmZ3Q7SGVsbG8gWE1MJmx0Oy94bWwmZ3Q7PFhtbE5hbWVzcGFjZURlY2xhcmF0aW9uc1Byb3BlcnR5PlhtbE5hbWVzcGFjZURlY2xhcmF0aW9uc1Byb3BlcnR5VmFsdWU8L1htbE5hbWVzcGFjZURlY2xhcmF0aW9uc1Byb3BlcnR5PjxYbWxFbGVtZW50UHJvcGVydHlOb2RlIHhtbG5zPSIiaHR0cDovL2VsZW1lbnQiIj4xPC9YbWxFbGVtZW50UHJvcGVydHlOb2RlPjxDdXN0b21YbWxBcnJheVByb3BlcnR5IHhtbG5zPSIiaHR0cDovL215bmFtZXNwYWNlIiI+PHN0cmluZz5vbmU8L3N0cmluZz48c3RyaW5nPnR3bzwvc3RyaW5nPjxzdHJpbmc+dGhyZWU8L3N0cmluZz48L0N1c3RvbVhtbEFycmF5UHJvcGVydHk+PC9BdHRyaWJ1dGVUZXN0aW5nPiIsDQogICAgICAgICAgICAoKSA9PiB7IHJldHVybiBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoWG1sU2VyaWFsaXplckF0dHJpYnV0ZXMpLCAiTXljdXN0b21EZWZhdWx0TmFtZXNwYWNlIik7IH0pOw0KDQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5FbnVtVHlwZSwgYWN0dWFsLkVudW1UeXBlKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLk15Q2hvaWNlLCBhY3R1YWwuTXlDaG9pY2UpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuWG1sQXJyYXlQcm9wZXJ0eVswXSwgYWN0dWFsLlhtbEFycmF5UHJvcGVydHlbMF0pOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuWG1sQXJyYXlQcm9wZXJ0eVsxXSwgYWN0dWFsLlhtbEFycmF5UHJvcGVydHlbMV0pOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuWG1sQXJyYXlQcm9wZXJ0eVsyXSwgYWN0dWFsLlhtbEFycmF5UHJvcGVydHlbMl0pOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuWG1sQXR0cmlidXRlUHJvcGVydHksIGFjdHVhbC5YbWxBdHRyaWJ1dGVQcm9wZXJ0eSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5YbWxFbGVtZW50UHJvcGVydHksIGFjdHVhbC5YbWxFbGVtZW50UHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuWG1sRW51bVByb3BlcnR5LCBhY3R1YWwuWG1sRW51bVByb3BlcnR5KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlhtbEluY2x1ZGVQcm9wZXJ0eSwgYWN0dWFsLlhtbEluY2x1ZGVQcm9wZXJ0eSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5YbWxOYW1lc3BhY2VEZWNsYXJhdGlvbnNQcm9wZXJ0eSwgYWN0dWFsLlhtbE5hbWVzcGFjZURlY2xhcmF0aW9uc1Byb3BlcnR5KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlhtbFRleHRQcm9wZXJ0eSwgYWN0dWFsLlhtbFRleHRQcm9wZXJ0eSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aEluZGlyZWN0UmVmZXJlbmNlZEFzc2VtYmx5KCkNCiAgICB7DQogICAgICAgIC8vIFR5cGVXaXRoSW5kaXJlY3RSZWYgY2xhc3MgaGFzIGEgZGVwZW5kZW5jeSBvbiBUYXNrLCB3aGljaCBpcyBpbiBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzLCBhbiBhc3NlbWJseSB0aGF0J3MgaW5kaXJlY3RseSByZWZlcmVuY2VkLg0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgRGlyZWN0UmVmLlR5cGVXaXRoSW5kaXJlY3RSZWYoKSB7IE5hbWUgPSAiRm9vIiB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsIEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCiAgICA8VHlwZVdpdGhJbmRpcmVjdFJlZiB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogICAgICA8TmFtZT5Gb288L05hbWU+DQogICAgPC9UeXBlV2l0aEluZGlyZWN0UmVmPiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuTmFtZSwgYWN0dWFsLk5hbWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfTm9va1R5cGVzKCkNCiAgICB7DQogICAgICAgIE5vb2tBcHBMb2NhbFN0YXRlIHZhbHVlID0gbmV3IE5vb2tBcHBMb2NhbFN0YXRlKCkgeyBBcnRpY2xlVmlld0NvdW50ID0gMSwgQ3VycmVudGx5UmVhZGluZ1Byb2R1Y3RFQU4gPSAiQ3VycmVudCIsIEN1cnJlbnRQYXltZW50VHlwZSA9IE5vb2tBcHBMb2NhbFN0YXRlLlBheW1lbnRUeXBlLk1pY3Jvc29mdCwgSXNGaXJzdFJ1biA9IHRydWUsIFByZXZpb3VzU2VhcmNoUXVlcmllcyA9IG5ldyBMaXN0PHN0cmluZz4obmV3IHN0cmluZ1tdIHsgIm9uZSIsICJ0d28iIH0pLCBUZXh0Q29sb3IgPSBTeXN0ZW0uRHJhd2luZy5Db2xvci5Gcm9tQXJnYigzLCA0LCA1LCA2KSB9Ow0KICAgICAgICB2YWx1ZS5Mb2NhbFJlYWRpbmdQb3NpdGlvblN0YXRlID0gbmV3IExpc3Q8TG9jYWxSZWFkaW5nUG9zaXRpb24+KCk7DQogICAgICAgIHZhbHVlLkxvY2FsUmVhZGluZ1Bvc2l0aW9uU3RhdGUuQWRkKG5ldyBMb2NhbFJlYWRpbmdQb3NpdGlvbigpIHsgRWFuID0gIkVhbiIsIExhc3RSZWFkVGltZSA9IG5ldyBEYXRlVGltZSgyMDEzLCAxLCAyKSwgUGFnZUNvdW50ID0gMSwgUGFnZU51bWJlciA9ICIxIiwgUGxhdGZvcm1PZmZzZXQgPSAib2Zmc2V0IiB9KTsNCg0KICAgICAgICB2YXIgZGVzZXJpYWxpemVkVmFsdWUgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxOb29rQXBwTG9jYWxTdGF0ZT4odmFsdWUsICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48Tm9va0FwcExvY2FsU3RhdGUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDxUZXh0Q29sb3I+XHJcbiAgICA8QT4zPC9BPlxyXG4gICAgPEI+NjwvQj5cclxuICAgIDxHPjU8L0c+XHJcbiAgICA8Uj40PC9SPlxyXG4gIDwvVGV4dENvbG9yPlxyXG4gIDxBcnRpY2xlVmlld0NvdW50PjE8L0FydGljbGVWaWV3Q291bnQ+XHJcbiAgPEN1cnJlbnRseVJlYWRpbmdQcm9kdWN0RUFOPkN1cnJlbnQ8L0N1cnJlbnRseVJlYWRpbmdQcm9kdWN0RUFOPlxyXG4gIDxDdXJyZW50UGF5bWVudFR5cGU+TWljcm9zb2Z0PC9DdXJyZW50UGF5bWVudFR5cGU+XHJcbiAgPElzRmlyc3RSdW4+dHJ1ZTwvSXNGaXJzdFJ1bj5cclxuICA8TG9jYWxSZWFkaW5nUG9zaXRpb25TdGF0ZT5cclxuICAgIDxMb2NhbFJlYWRpbmdQb3NpdGlvbj5cclxuICAgICAgPEVhbj5FYW48L0Vhbj5cclxuICAgICAgPExhc3RSZWFkVGltZT4yMDEzLTAxLTAyVDAwOjAwOjAwPC9MYXN0UmVhZFRpbWU+XHJcbiAgICAgIDxQYWdlQ291bnQ+MTwvUGFnZUNvdW50PlxyXG4gICAgICA8UGFnZU51bWJlcj4xPC9QYWdlTnVtYmVyPlxyXG4gICAgICA8UGxhdGZvcm1PZmZzZXQ+b2Zmc2V0PC9QbGF0Zm9ybU9mZnNldD5cclxuICAgIDwvTG9jYWxSZWFkaW5nUG9zaXRpb24+XHJcbiAgPC9Mb2NhbFJlYWRpbmdQb3NpdGlvblN0YXRlPlxyXG4gIDxQcmV2aW91c1NlYXJjaFF1ZXJpZXM+XHJcbiAgICA8c3RyaW5nPm9uZTwvc3RyaW5nPlxyXG4gICAgPHN0cmluZz50d288L3N0cmluZz5cclxuICA8L1ByZXZpb3VzU2VhcmNoUXVlcmllcz5cclxuICA8SXNGaXJzdFJ1bkR1cGxpY2F0ZT5mYWxzZTwvSXNGaXJzdFJ1bkR1cGxpY2F0ZT5cclxuPC9Ob29rQXBwTG9jYWxTdGF0ZT4iLCBudWxsLCB0cnVlKTsNCg0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoZGVzZXJpYWxpemVkVmFsdWUuQXJ0aWNsZVZpZXdDb3VudCwgdmFsdWUuQXJ0aWNsZVZpZXdDb3VudCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChkZXNlcmlhbGl6ZWRWYWx1ZS5DdXJyZW50bHlSZWFkaW5nUHJvZHVjdEVBTiwgdmFsdWUuQ3VycmVudGx5UmVhZGluZ1Byb2R1Y3RFQU4pOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoZGVzZXJpYWxpemVkVmFsdWUuQ3VycmVudFBheW1lbnRUeXBlLCB2YWx1ZS5DdXJyZW50UGF5bWVudFR5cGUpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoZGVzZXJpYWxpemVkVmFsdWUuSXNGaXJzdFJ1biwgdmFsdWUuSXNGaXJzdFJ1bik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMyMTcyNCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEZXJpdmVkVHlwZVdpdGhEaWZmZXJlbnRPdmVycmlkZXMoKQ0KICAgIHsNCiAgICAgICAgRGVyaXZlZFR5cGVXaXRoRGlmZmVyZW50T3ZlcnJpZGVzIHZhbHVlID0gbmV3IERlcml2ZWRUeXBlV2l0aERpZmZlcmVudE92ZXJyaWRlcygpIHsgTmFtZTEgPSAiTmFtZTEiLCBOYW1lMiA9ICJOYW1lMiIsIE5hbWUzID0gIk5hbWUzIiwgTmFtZTQgPSAiTmFtZTQiLCBOYW1lNSA9ICJOYW1lNSIgfTsNCiAgICAgICAgRGVyaXZlZFR5cGVXaXRoRGlmZmVyZW50T3ZlcnJpZGVzIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPERlcml2ZWRUeXBlV2l0aERpZmZlcmVudE92ZXJyaWRlcz4odmFsdWUsIEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz48RGVyaXZlZFR5cGVXaXRoRGlmZmVyZW50T3ZlcnJpZGVzIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj48TmFtZTE+TmFtZTE8L05hbWUxPjxOYW1lMj5OYW1lMjwvTmFtZTI+PE5hbWUzPk5hbWUzPC9OYW1lMz48TmFtZTU+TmFtZTU8L05hbWU1PjwvRGVyaXZlZFR5cGVXaXRoRGlmZmVyZW50T3ZlcnJpZGVzPiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuTmFtZTEsIGFjdHVhbC5OYW1lMSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5OYW1lMiwgYWN0dWFsLk5hbWUyKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLk5hbWUzLCBhY3R1YWwuTmFtZTMpOw0KICAgICAgICBBc3NlcnQuTnVsbChhY3R1YWwuTmFtZTQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuTmFtZTUsIGFjdHVhbC5OYW1lNSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMyMTcyNCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEZXJpdmVkVHlwZVdpdGhEaWZmZXJlbnRPdmVycmlkZXMyKCkNCiAgICB7DQogICAgICAgIERlcml2ZWRUeXBlV2l0aERpZmZlcmVudE92ZXJyaWRlczIgdmFsdWUgPSBuZXcgRGVyaXZlZFR5cGVXaXRoRGlmZmVyZW50T3ZlcnJpZGVzMigpIHsgTmFtZTEgPSAiTmFtZTEiLCBOYW1lMiA9ICJOYW1lMiIsIE5hbWUzID0gIk5hbWUzIiwgTmFtZTQgPSAiTmFtZTQiLCBOYW1lNSA9ICJOYW1lNSIsIE5hbWU2ID0gIk5hbWU2IiB9Ow0KICAgICAgICAoKERlcml2ZWRUeXBlV2l0aERpZmZlcmVudE92ZXJyaWRlcyl2YWx1ZSkuTmFtZTUgPSAiTWlkTGV2ZWxOYW1lNSI7DQogICAgICAgICgoRGVyaXZlZFR5cGVXaXRoRGlmZmVyZW50T3ZlcnJpZGVzKXZhbHVlKS5OYW1lNCA9ICJNaWRMZXZlbE5hbWU0IjsNCiAgICAgICAgKChTZXJpYWxpemF0aW9uVHlwZXMuQmFzZVR5cGUpdmFsdWUpLk5hbWU0ID0gIkJhc2VMZXZlbE5hbWU0IjsNCiAgICAgICAgKChEZXJpdmVkVHlwZVdpdGhEaWZmZXJlbnRPdmVycmlkZXMpdmFsdWUpLk5hbWU2ID0gIk1pZExldmVsTmFtZTYiOw0KICAgICAgICAoKFNlcmlhbGl6YXRpb25UeXBlcy5CYXNlVHlwZSl2YWx1ZSkuTmFtZTYgPSAiQmFzZUxldmVsTmFtZTYiOw0KICAgICAgICBEZXJpdmVkVHlwZVdpdGhEaWZmZXJlbnRPdmVycmlkZXMyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPERlcml2ZWRUeXBlV2l0aERpZmZlcmVudE92ZXJyaWRlczI+KHZhbHVlLCBAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+PERlcml2ZWRUeXBlV2l0aERpZmZlcmVudE92ZXJyaWRlczIgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPjxOYW1lMT5OYW1lMTwvTmFtZTE+PE5hbWUyPk5hbWUyPC9OYW1lMj48TmFtZTM+TmFtZTM8L05hbWUzPjxOYW1lND5CYXNlTGV2ZWxOYW1lNDwvTmFtZTQ+PE5hbWU1Pk1pZExldmVsTmFtZTU8L05hbWU1PjxOYW1lNj5CYXNlTGV2ZWxOYW1lNjwvTmFtZTY+PC9EZXJpdmVkVHlwZVdpdGhEaWZmZXJlbnRPdmVycmlkZXMyPiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuTmFtZTEsIGFjdHVhbC5OYW1lMSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5OYW1lMiwgYWN0dWFsLk5hbWUyKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLk5hbWUzLCBhY3R1YWwuTmFtZTMpOw0KICAgICAgICBBc3NlcnQuTnVsbChhY3R1YWwuTmFtZTQpOw0KICAgICAgICBBc3NlcnQuTnVsbCgoKERlcml2ZWRUeXBlV2l0aERpZmZlcmVudE92ZXJyaWRlcylhY3R1YWwpLk5hbWU0KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKCgoU2VyaWFsaXphdGlvblR5cGVzLkJhc2VUeXBlKXZhbHVlKS5OYW1lNCwgKChTZXJpYWxpemF0aW9uVHlwZXMuQmFzZVR5cGUpYWN0dWFsKS5OYW1lNCk7DQogICAgICAgIEFzc2VydC5OdWxsKGFjdHVhbC5OYW1lNSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCgoKERlcml2ZWRUeXBlV2l0aERpZmZlcmVudE92ZXJyaWRlcyl2YWx1ZSkuTmFtZTUsICgoRGVyaXZlZFR5cGVXaXRoRGlmZmVyZW50T3ZlcnJpZGVzKWFjdHVhbCkuTmFtZTUpOw0KICAgICAgICBBc3NlcnQuTnVsbCgoKFNlcmlhbGl6YXRpb25UeXBlcy5CYXNlVHlwZSlhY3R1YWwpLk5hbWU1KTsNCiAgICAgICAgQXNzZXJ0Lk51bGwoYWN0dWFsLk5hbWU2KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKCgoRGVyaXZlZFR5cGVXaXRoRGlmZmVyZW50T3ZlcnJpZGVzKWFjdHVhbCkuTmFtZTYsICgoU2VyaWFsaXphdGlvblR5cGVzLkJhc2VUeXBlKWFjdHVhbCkuTmFtZTYpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoKChTZXJpYWxpemF0aW9uVHlwZXMuQmFzZVR5cGUpYWN0dWFsKS5OYW1lNiwgKChTZXJpYWxpemF0aW9uVHlwZXMuQmFzZVR5cGUpYWN0dWFsKS5OYW1lNik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9EZWZhdWx0TmFtZXNwYWNlQ2hhbmdlX1NpbXBsZUFycmF5X09iamVjdEFzUm9vdCgpDQogICAgew0KICAgICAgICBTaW1wbGVUeXBlW10geCA9IG5ldyBTaW1wbGVUeXBlW10geyBuZXcgU2ltcGxlVHlwZSB7IFAxID0gImFiYyIsIFAyID0gMTEgfSwgbmV3IFNpbXBsZVR5cGUgeyBQMSA9ICJkZWYiLCBQMiA9IDEyIH0gfTsNCiAgICAgICAgRnVuYzxYbWxTZXJpYWxpemVyPiBzZXJpYWxpemVyRmFjdG9yeSA9ICgpID0+IHsgcmV0dXJuIG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihvYmplY3QpLCBuZXcgVHlwZVtdIHsgdHlwZW9mKFNpbXBsZVR5cGVbXSkgfSk7IH07DQoNCiAgICAgICAgU2ltcGxlVHlwZVtdIHkgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh4LA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPGFueVR5cGUgZDFwMTp0eXBlPSIiQXJyYXlPZlNpbXBsZVR5cGUiIiB4bWxuczpkMXAxPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiA+DQogIDxTaW1wbGVUeXBlIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogICAgPFAxPmFiYzwvUDE+DQogICAgPFAyPjExPC9QMj4NCiAgPC9TaW1wbGVUeXBlPg0KICA8U2ltcGxlVHlwZT4NCiAgICA8UDE+ZGVmPC9QMT4NCiAgICA8UDI+MTI8L1AyPg0KICA8L1NpbXBsZVR5cGU+DQo8L2FueVR5cGU+Iiwgc2VyaWFsaXplckZhY3RvcnkpOw0KDQogICAgICAgIFV0aWxzLkVxdWFsKHgsIHksIChhLCBiKSA9PiB7IHJldHVybiBTaW1wbGVUeXBlLkFyZUVxdWFsKGEsIGIpOyB9KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1ZhbGlkYXRlRXhjZXB0aW9uT25VbnNwZWNpZmllZFJvb3RTZXJpYWxpemF0aW9uVHlwZSgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVW5zcGVjaWZpZWRSb290U2VyaWFsaXphdGlvblR5cGUoKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLCAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFVuc3BlY2lmaWVkUm9vdFNlcmlhbGl6YXRpb25UeXBlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5cclxuICA8TXlJbnRQcm9wZXJ0eT4wPC9NeUludFByb3BlcnR5PlxyXG48L1Vuc3BlY2lmaWVkUm9vdFNlcmlhbGl6YXRpb25UeXBlPiIsICgpID0+IHsgcmV0dXJuIG5ldyBYbWxTZXJpYWxpemVyKFR5cGUuR2V0VHlwZSh0eXBlb2YoVW5zcGVjaWZpZWRSb290U2VyaWFsaXphdGlvblR5cGUpLkZ1bGxOYW1lKSk7IH0pOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuTXlJbnRQcm9wZXJ0eSwgYWN0dWFsLk15SW50UHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuTXlTdHJpbmdQcm9wZXJ0eSwgYWN0dWFsLk15U3RyaW5nUHJvcGVydHkpOyAgICAgDQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9WZXJpZnlDb21waWxhdGlvbklzc3VlT25seSgpDQogICAgew0KICAgICAgICBBc3NlcnRTZXJpYWxpemF0aW9uRmFpbHVyZTxUeXBlV2l0aEVudW1lcmFibGVNZW1iZXJzLCBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uPigpOw0KICAgICAgICBBc3NlcnRTZXJpYWxpemF0aW9uRmFpbHVyZTxUeXBlV2l0aG91dFB1YmxpY1NldHRlciwgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbj4oKTsNCiAgICAgICAgQXNzZXJ0U2VyaWFsaXphdGlvbkZhaWx1cmU8VHlwZVdpdGhDb21waWxlckdlbmVyYXRlZEF0dHJpYnV0ZUJ1dFdpdGhvdXRQdWJsaWNTZXR0ZXIsIEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCk7DQogICAgICAgIEFzc2VydFNlcmlhbGl6YXRpb25GYWlsdXJlPEludmFsaWREZXJpdmVkQ2xhc3MsIEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCk7DQogICAgICAgIEFzc2VydFNlcmlhbGl6YXRpb25GYWlsdXJlPEFub3RoZXJJbnZhbGlkRGVyaXZlZENsYXNzLCBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uPigpOw0KICAgICAgICBBc3NlcnRTZXJpYWxpemF0aW9uRmFpbHVyZTxJbnRlcm5hbFR5cGVXaXRoTmVzdGVkUHVibGljVHlwZS5MZXZlbERhdGEsIEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCk7DQogICAgICAgIEFzc2VydFNlcmlhbGl6YXRpb25GYWlsdXJlPEludGVybmFsVHlwZVdpdGhOZXN0ZWRQdWJsaWNUeXBlV2l0aE5lc3RlZFB1YmxpY1R5cGUuTmVzdGVkUHVibGljVHlwZS5MZXZlbERhdGEsIEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCk7DQoNCiAgICAgICAgdmFyIHZhbHVlMSA9IG5ldyBEdXBsaWNhdGVUeXBlTmFtZXNUZXN0Lm5zMS5DbGFzc0EoKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlMSwgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxDbGFzc0EgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIC8+Iik7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZTEuTmFtZSwgYWN0dWFsLk5hbWUpOw0KDQogICAgICAgIHZhciB2YWx1ZTIgPSBuZXcgRHVwbGljYXRlVHlwZU5hbWVzVGVzdC5uczIuQ2xhc3NBKCk7DQogICAgICAgIHZhciBhY3R1YWwyID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUyLCAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPENsYXNzQSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgLz4iKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlMi5Ob21icmUsIGFjdHVhbDIuTm9tYnJlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0RlZmF1bHROYW1lc3BhY2VDaGFuZ2VfT2JqZWN0QXNSb290KCkNCiAgICB7DQogICAgICAgIG9iamVjdCB2YWx1ZSA9IEl0ZW1DaG9pY2VUeXBlLkRlY2ltYWxOdW1iZXI7DQogICAgICAgIEZ1bmM8WG1sU2VyaWFsaXplcj4gc2VyaWFsaXplckZhY3RvcnkgPSAoKSA9PiB7IHJldHVybiBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2Yob2JqZWN0KSwgbmV3IFR5cGVbXSB7IHR5cGVvZihJdGVtQ2hvaWNlVHlwZVtdKSB9KTsgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQogICAgICAgICAgICBAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8YW55VHlwZSBkMXAxOnR5cGU9IiJJdGVtQ2hvaWNlVHlwZSIiIHhtbG5zOmQxcDE9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiPkRlY2ltYWxOdW1iZXI8L2FueVR5cGU+IiwgDQogICAgICAgICAgICBzZXJpYWxpemVyRmFjdG9yeSk7DQoNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLCBhY3R1YWwpOw0KICAgIH0NCg0KICAgIFtDb25kaXRpb25hbEZhY3QobmFtZW9mKElzVGltZVNwYW5TZXJpYWxpemF0aW9uQXZhaWxhYmxlKSldDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFZlcmlmeVJlc3RyaWN0aW9uRWxlbWVudEZvclRpbWVTcGFuVGVzdCgpDQogICAgew0KICAgICAgICB2YXIgc2NoZW1hcyA9IG5ldyBYbWxTY2hlbWFzKCk7DQogICAgICAgIHZhciBleHBvcnRlciA9IG5ldyBYbWxTY2hlbWFFeHBvcnRlcihzY2hlbWFzKTsNCiAgICAgICAgWG1sVHlwZU1hcHBpbmcgbWFwcGluZyA9IG5ldyBYbWxSZWZsZWN0aW9uSW1wb3J0ZXIoKS5JbXBvcnRUeXBlTWFwcGluZyh0eXBlb2YoVGltZVNwYW4pKTsNCiAgICAgICAgZXhwb3J0ZXIuRXhwb3J0VHlwZU1hcHBpbmcobWFwcGluZyk7DQogICAgICAgIFhtbFNjaGVtYSBzY2hlbWEgPSBzY2hlbWFzLldoZXJlKHMgPT4gcy5UYXJnZXROYW1lc3BhY2UgPT0gImh0dHA6Ly9taWNyb3NvZnQuY29tL3dzZGwvdHlwZXMvIikuRmlyc3RPckRlZmF1bHQoKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoc2NoZW1hKTsNCiAgICAgICAgdmFyIG1zID0gbmV3IE1lbW9yeVN0cmVhbSgpOw0KICAgICAgICBzY2hlbWEuV3JpdGUobXMpOw0KICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQogICAgICAgIHN0cmluZyBhY3R1YWxPdXRwdXQgPSBuZXcgU3RyZWFtUmVhZGVyKG1zKS5SZWFkVG9FbmQoKTsNCiAgICAgICAgWEVsZW1lbnQgZWxlbWVudCA9IFhFbGVtZW50LlBhcnNlKGFjdHVhbE91dHB1dCk7DQogICAgICAgIHdoaWxlIChlbGVtZW50LkVsZW1lbnRzKCkuQ291bnQoKSAhPSAwKQ0KICAgICAgICB7DQogICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5FbGVtZW50cygpLkZpcnN0KCk7DQogICAgICAgIH0NCg0KICAgICAgICBzdHJpbmcgZXhwZWN0ZWRBdHRyaWJ1dGUgPSAieHM6ZHVyYXRpb24iOw0KICAgICAgICBzdHJpbmcgYmFzZWxpbmUgPSAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPHhzOnNjaGVtYSB4bWxuczp0bnM9XCJodHRwOi8vbWljcm9zb2Z0LmNvbS93c2RsL3R5cGVzL1wiIGVsZW1lbnRGb3JtRGVmYXVsdD1cInF1YWxpZmllZFwiIHRhcmdldE5hbWVzcGFjZT1cImh0dHA6Ly9taWNyb3NvZnQuY29tL3dzZGwvdHlwZXMvXCIgeG1sbnM6eHM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDx4czpzaW1wbGVUeXBlIG5hbWU9XCJUaW1lU3BhblwiPlxyXG4gICAgPHhzOnJlc3RyaWN0aW9uIGJhc2U9XCJ4czpkdXJhdGlvblwiIC8+XHJcbiAgPC94czpzaW1wbGVUeXBlPlxyXG48L3hzOnNjaGVtYT4iOw0KICAgICAgICBBc3NlcnQuVHJ1ZShlbGVtZW50Lkxhc3RBdHRyaWJ1dGUuVmFsdWUgPT0gZXhwZWN0ZWRBdHRyaWJ1dGUsIHN0cmluZy5Gb3JtYXQoInswfVRlc3QgZmFpbGVkIGZvciB3cm9uZyBvdXRwdXQgZnJvbSBzY2hlbWE6IHswfUV4cGVjdGVkIE91dHB1dDogezF9ezB9QWN0dWFsIE91dHB1dDogezJ9IiwNCiAgICAgICAgICAgICAgICBFbnZpcm9ubWVudC5OZXdMaW5lLCBiYXNlbGluZSwgYWN0dWFsT3V0cHV0KSk7DQogICAgfQ0KfQ0K"
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/XmlSerializer/XmlSerializerTests.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFNlcmlhbGl6YXRpb25UeXBlczsNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkdsb2JhbGl6YXRpb247DQp1c2luZyBTeXN0ZW0uSU87DQp1c2luZyBTeXN0ZW0uTGlucTsNCnVzaW5nIFN5c3RlbS5SZWZsZWN0aW9uOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KdXNpbmcgU3lzdGVtLlhtbDsNCnVzaW5nIFN5c3RlbS5YbWwuTGlucTsNCnVzaW5nIFN5c3RlbS5YbWwuU2NoZW1hOw0KdXNpbmcgU3lzdGVtLlhtbC5TZXJpYWxpemF0aW9uOw0KdXNpbmcgWHVuaXQ7DQoNCnB1YmxpYyBzdGF0aWMgcGFydGlhbCBjbGFzcyBYbWxTZXJpYWxpemVyVGVzdHMNCnsNCiNpZiBSZWZsZWN0aW9uT25seXx8IFhNTFNFUklBTElaRVJHRU5FUkFUT1JURVNUUw0KICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IHN0cmluZyBTZXJpYWxpemF0aW9uTW9kZVNldHRlck5hbWUgPSAic2V0X01vZGUiOw0KDQogICAgc3RhdGljIFhtbFNlcmlhbGl6ZXJUZXN0cygpDQogICAgew0KICAgICAgICBpZiAoIVBsYXRmb3JtRGV0ZWN0aW9uLklzRnVsbEZyYW1ld29yaykNCiAgICAgICAgew0KICAgICAgICAgICAgTWV0aG9kSW5mbyBtZXRob2QgPSB0eXBlb2YoWG1sU2VyaWFsaXplcikuR2V0TWV0aG9kKFNlcmlhbGl6YXRpb25Nb2RlU2V0dGVyTmFtZSwgQmluZGluZ0ZsYWdzLlB1YmxpYyB8IEJpbmRpbmdGbGFncy5Ob25QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuU3RhdGljKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKG1ldGhvZCAhPSBudWxsLCAkIk5vIG1ldGhvZCBuYW1lZCB7U2VyaWFsaXphdGlvbk1vZGVTZXR0ZXJOYW1lfSIpOw0KI2lmIFJlZmxlY3Rpb25Pbmx5DQogICAgICAgICAgICBtZXRob2QuSW52b2tlKG51bGwsIG5ldyBvYmplY3RbXSB7IDEgfSk7DQojZW5kaWYNCiNpZiBYTUxTRVJJQUxJWkVSR0VORVJBVE9SVEVTVFMNCiAgICAgICAgICAgIG1ldGhvZC5JbnZva2UobnVsbCwgbmV3IG9iamVjdFtdIHsgMyB9KTsNCiNlbmRpZg0KICAgICAgICB9DQogICAgfQ0KI2VuZGlmDQoNCiAgICBwcml2YXRlIHN0YXRpYyBib29sIElzVGltZVNwYW5TZXJpYWxpemF0aW9uQXZhaWxhYmxlID0+ICFQbGF0Zm9ybURldGVjdGlvbi5Jc0Z1bGxGcmFtZXdvcmsgfHwgKEFwcENvbnRleHQuVHJ5R2V0U3dpdGNoKCJTd2l0Y2guU3lzdGVtLlhtbC5FbmFibGVUaW1lU3BhblNlcmlhbGl6YXRpb24iLCBvdXQgYm9vbCByZXN1bHQpICYmIHJlc3VsdCk7DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVXaXRoRGF0ZVRpbWVQcm9wZXJ0eUFzWG1sVGltZSgpDQogICAgew0KICAgICAgICBEYXRlVGltZSBsb2NhbFRpbWUgPSBuZXcgRGF0ZVRpbWUoNTQ5MjY5ODcwMDAwTCwgRGF0ZVRpbWVLaW5kLkxvY2FsKTsNCiAgICAgICAgVHlwZVdpdGhEYXRlVGltZVByb3BlcnR5QXNYbWxUaW1lIGxvY2FsVGltZU9qYmVjdCA9IG5ldyBUeXBlV2l0aERhdGVUaW1lUHJvcGVydHlBc1htbFRpbWUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBWYWx1ZSA9IGxvY2FsVGltZQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8vIFRoaXMgaXMgaG93IHdlIGNvbnZlcnQgRGF0ZVRpbWUgZnJvbSB0aW1lIHRvIHN0cmluZy4NCiAgICAgICAgdmFyIGxvY2FsVGltZURhdGVUaW1lID0gRGF0ZVRpbWUuTWluVmFsdWUgKyBsb2NhbFRpbWUuVGltZU9mRGF5Ow0KICAgICAgICBzdHJpbmcgbG9jYWxUaW1lU3RyaW5nID0gbG9jYWxUaW1lRGF0ZVRpbWUuVG9TdHJpbmcoIkhIOm1tOnNzLmZmZmZmZmZ6enp6enoiLCBEYXRlVGltZUZvcm1hdEluZm8uSW52YXJpYW50SW5mbyk7DQogICAgICAgIFR5cGVXaXRoRGF0ZVRpbWVQcm9wZXJ0eUFzWG1sVGltZSBsb2NhbFRpbWVPamJlY3RSb3VuZFRyaXAgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZShsb2NhbFRpbWVPamJlY3QsDQpzdHJpbmcuRm9ybWF0KEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+DQo8VHlwZVdpdGhEYXRlVGltZVByb3BlcnR5QXNYbWxUaW1lIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj57MH08L1R5cGVXaXRoRGF0ZVRpbWVQcm9wZXJ0eUFzWG1sVGltZT4iLCBsb2NhbFRpbWVTdHJpbmcpKTsNCg0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwobG9jYWxUaW1lT2piZWN0LlZhbHVlLCBsb2NhbFRpbWVPamJlY3RSb3VuZFRyaXAuVmFsdWUpOw0KDQogICAgICAgIFR5cGVXaXRoRGF0ZVRpbWVQcm9wZXJ0eUFzWG1sVGltZSB1dGNUaW1lT2piZWN0ID0gbmV3IFR5cGVXaXRoRGF0ZVRpbWVQcm9wZXJ0eUFzWG1sVGltZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFZhbHVlID0gbmV3IERhdGVUaW1lKDU0OTI2OTg3MDAwMEwsIERhdGVUaW1lS2luZC5VdGMpDQogICAgICAgIH07DQoNCiAgICAgICAgaWYgKElzVGltZVNwYW5TZXJpYWxpemF0aW9uQXZhaWxhYmxlKQ0KICAgICAgICB7DQogICAgICAgICAgICBUeXBlV2l0aERhdGVUaW1lUHJvcGVydHlBc1htbFRpbWUgdXRjVGltZVJvdW5kVHJpcCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHV0Y1RpbWVPamJlY3QsDQogICAgQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz4NCjxUeXBlV2l0aERhdGVUaW1lUHJvcGVydHlBc1htbFRpbWUgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPjE1OjE1OjI2Ljk4NzAwMDBaPC9UeXBlV2l0aERhdGVUaW1lUHJvcGVydHlBc1htbFRpbWU+Iik7DQoNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh1dGNUaW1lT2piZWN0LlZhbHVlLCB1dGNUaW1lUm91bmRUcmlwLlZhbHVlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfQXJyYXlBc0dldFNldCgpDQogICAgew0KICAgICAgICBUeXBlV2l0aEdldFNldEFycmF5TWVtYmVycyB4ID0gbmV3IFR5cGVXaXRoR2V0U2V0QXJyYXlNZW1iZXJzDQogICAgICAgIHsNCiAgICAgICAgICAgIEYxID0gbmV3IFNpbXBsZVR5cGVbXSB7IG5ldyBTaW1wbGVUeXBlIHsgUDEgPSAiYWIiLCBQMiA9IDEgfSwgbmV3IFNpbXBsZVR5cGUgeyBQMSA9ICJjZCIsIFAyID0gMiB9IH0sDQogICAgICAgICAgICBGMiA9IG5ldyBpbnRbXSB7IC0xLCAzIH0sDQogICAgICAgICAgICBQMSA9IG5ldyBTaW1wbGVUeXBlW10geyBuZXcgU2ltcGxlVHlwZSB7IFAxID0gImVmIiwgUDIgPSA1IH0sIG5ldyBTaW1wbGVUeXBlIHsgUDEgPSAiZ2giLCBQMiA9IDcgfSB9LA0KICAgICAgICAgICAgUDIgPSBuZXcgaW50W10geyAxMSwgMTIgfQ0KICAgICAgICB9Ow0KICAgICAgICBUeXBlV2l0aEdldFNldEFycmF5TWVtYmVycyB5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhHZXRTZXRBcnJheU1lbWJlcnM+KHgsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8VHlwZVdpdGhHZXRTZXRBcnJheU1lbWJlcnMgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8RjE+DQogICAgPFNpbXBsZVR5cGU+DQogICAgICA8UDE+YWI8L1AxPg0KICAgICAgPFAyPjE8L1AyPg0KICAgIDwvU2ltcGxlVHlwZT4NCiAgICA8U2ltcGxlVHlwZT4NCiAgICAgIDxQMT5jZDwvUDE+DQogICAgICA8UDI+MjwvUDI+DQogICAgPC9TaW1wbGVUeXBlPg0KICA8L0YxPg0KICA8RjI+DQogICAgPGludD4tMTwvaW50Pg0KICAgIDxpbnQ+MzwvaW50Pg0KICA8L0YyPg0KICA8UDE+DQogICAgPFNpbXBsZVR5cGU+DQogICAgICA8UDE+ZWY8L1AxPg0KICAgICAgPFAyPjU8L1AyPg0KICAgIDwvU2ltcGxlVHlwZT4NCiAgICA8U2ltcGxlVHlwZT4NCiAgICAgIDxQMT5naDwvUDE+DQogICAgICA8UDI+NzwvUDI+DQogICAgPC9TaW1wbGVUeXBlPg0KICA8L1AxPg0KICA8UDI+DQogICAgPGludD4xMTwvaW50Pg0KICAgIDxpbnQ+MTI8L2ludD4NCiAgPC9QMj4NCjwvVHlwZVdpdGhHZXRTZXRBcnJheU1lbWJlcnM+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoeSk7DQogICAgICAgIFV0aWxzLkVxdWFsPFNpbXBsZVR5cGU+KHguRjEsIHkuRjEsIChhLCBiKSA9PiB7IHJldHVybiBTaW1wbGVUeXBlLkFyZUVxdWFsKGEsIGIpOyB9KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHguRjIsIHkuRjIpOw0KICAgICAgICBVdGlscy5FcXVhbDxTaW1wbGVUeXBlPih4LlAxLCB5LlAxLCAoYSwgYikgPT4geyByZXR1cm4gU2ltcGxlVHlwZS5BcmVFcXVhbChhLCBiKTsgfSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh4LlAyLCB5LlAyKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0FycmF5QXNHZXRPbmx5KCkNCiAgICB7DQogICAgICAgIFR5cGVXaXRoR2V0T25seUFycmF5UHJvcGVydGllcyB4ID0gbmV3IFR5cGVXaXRoR2V0T25seUFycmF5UHJvcGVydGllcygpOw0KICAgICAgICB4LlAxWzBdID0gbmV3IFNpbXBsZVR5cGUgeyBQMSA9ICJhYiIsIFAyID0gMSB9Ow0KICAgICAgICB4LlAxWzFdID0gbmV3IFNpbXBsZVR5cGUgeyBQMSA9ICJjZCIsIFAyID0gMiB9Ow0KICAgICAgICB4LlAyWzBdID0gLTE7DQogICAgICAgIHguUDJbMV0gPSAzOw0KDQogICAgICAgIFR5cGVXaXRoR2V0T25seUFycmF5UHJvcGVydGllcyB5ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhHZXRPbmx5QXJyYXlQcm9wZXJ0aWVzPih4LA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPFR5cGVXaXRoR2V0T25seUFycmF5UHJvcGVydGllcyB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgLz4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbCh5KTsNCiAgICAgICAgLy8gWG1sU2VyaWFsaXplciBzZWVtcyBub3QgY29tcGxhaW4gYWJvdXQgbWlzc2luZyBwdWJsaWMgc2V0dGVyIG9mIEFycmF5IHByb3BlcnR5DQogICAgICAgIC8vIEhvd2V2ZXIsIGl0IGRvZXMgbm90IHNlcmlhbGl6ZSB0aGUgcHJvcGVydHkuIFNvIGZvciB0aGlzIHRlc3QgY2FzZSwgSSdsbCB1c2UgaXQgdG8gdmVyaWZ5IHRoZXJlIGFyZSBubyBjb21wbGFpbnRzIGFib3V0IG1pc3NpbmcgcHVibGljIHNldHRlcg0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfTGlzdFJvb3QoKQ0KICAgIHsNCiAgICAgICAgTXlMaXN0IHggPSBuZXcgTXlMaXN0KCJhMSIsICJhMiIpOw0KICAgICAgICBNeUxpc3QgeSA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPE15TGlzdD4oeCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxBcnJheU9mQW55VHlwZSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxhbnlUeXBlIHhzaTp0eXBlPSIieHNkOnN0cmluZyIiPmExPC9hbnlUeXBlPg0KICA8YW55VHlwZSB4c2k6dHlwZT0iInhzZDpzdHJpbmciIj5hMjwvYW55VHlwZT4NCjwvQXJyYXlPZkFueVR5cGU+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoeSk7DQogICAgICAgIEFzc2VydC5UcnVlKHkuQ291bnQgPT0gMik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCgoc3RyaW5nKXhbMF0sIChzdHJpbmcpeVswXSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCgoc3RyaW5nKXhbMV0sIChzdHJpbmcpeVsxXSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9FbnVtQXNSb290KCkNCiAgICB7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxNeUVudW0+KE15RW51bS5Ud28sDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8TXlFbnVtPlR3bzwvTXlFbnVtPiIpLCBNeUVudW0uVHdvKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPEJ5dGVFbnVtPihCeXRlRW51bS5PcHRpb24xLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEJ5dGVFbnVtPk9wdGlvbjE8L0J5dGVFbnVtPiIpLCBCeXRlRW51bS5PcHRpb24xKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFNCeXRlRW51bT4oU0J5dGVFbnVtLk9wdGlvbjEsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8U0J5dGVFbnVtPk9wdGlvbjE8L1NCeXRlRW51bT4iKSwgU0J5dGVFbnVtLk9wdGlvbjEpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8U2hvcnRFbnVtPihTaG9ydEVudW0uT3B0aW9uMSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxTaG9ydEVudW0+T3B0aW9uMTwvU2hvcnRFbnVtPiIpLCBTaG9ydEVudW0uT3B0aW9uMSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxJbnRFbnVtPihJbnRFbnVtLk9wdGlvbjEsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8SW50RW51bT5PcHRpb24xPC9JbnRFbnVtPiIpLCBJbnRFbnVtLk9wdGlvbjEpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VUludEVudW0+KFVJbnRFbnVtLk9wdGlvbjEsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8VUludEVudW0+T3B0aW9uMTwvVUludEVudW0+IiksIFVJbnRFbnVtLk9wdGlvbjEpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8TG9uZ0VudW0+KExvbmdFbnVtLk9wdGlvbjEsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8TG9uZ0VudW0+T3B0aW9uMTwvTG9uZ0VudW0+IiksIExvbmdFbnVtLk9wdGlvbjEpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VUxvbmdFbnVtPihVTG9uZ0VudW0uT3B0aW9uMSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxVTG9uZ0VudW0+T3B0aW9uMTwvVUxvbmdFbnVtPiIpLCBVTG9uZ0VudW0uT3B0aW9uMSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9FbnVtQXNNZW1iZXIoKQ0KICAgIHsNCiAgICAgICAgVHlwZVdpdGhFbnVtTWVtYmVycyB4ID0gbmV3IFR5cGVXaXRoRW51bU1lbWJlcnMgeyBGMSA9IE15RW51bS5UaHJlZSwgUDEgPSBNeUVudW0uVHdvIH07DQogICAgICAgIFR5cGVXaXRoRW51bU1lbWJlcnMgeSA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFR5cGVXaXRoRW51bU1lbWJlcnM+KHgsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8VHlwZVdpdGhFbnVtTWVtYmVycyB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxGMT5UaHJlZTwvRjE+DQogIDxQMT5Ud288L1AxPg0KPC9UeXBlV2l0aEVudW1NZW1iZXJzPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoeC5GMSwgeS5GMSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh4LlAxLCB5LlAxKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0RDQ2xhc3NXaXRoRW51bUFuZFN0cnVjdCgpDQogICAgew0KICAgICAgICBEQ0NsYXNzV2l0aEVudW1BbmRTdHJ1Y3QgdmFsdWUgPSBuZXcgRENDbGFzc1dpdGhFbnVtQW5kU3RydWN0KHRydWUpOw0KICAgICAgICBEQ0NsYXNzV2l0aEVudW1BbmRTdHJ1Y3QgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8RENDbGFzc1dpdGhFbnVtQW5kU3RydWN0Pih2YWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxEQ0NsYXNzV2l0aEVudW1BbmRTdHJ1Y3QgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8TXlTdHJ1Y3Q+DQogICAgPERhdGE+RGF0YTwvRGF0YT4NCiAgPC9NeVN0cnVjdD4NCiAgPE15RW51bTE+T25lPC9NeUVudW0xPg0KPC9EQ0NsYXNzV2l0aEVudW1BbmRTdHJ1Y3Q+Iik7DQoNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLk15RW51bTEsIGFjdHVhbC5NeUVudW0xKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLk15U3RydWN0LkRhdGEsIGFjdHVhbC5NeVN0cnVjdC5EYXRhKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0J1aWx0SW5UeXBlcygpDQogICAgew0KICAgICAgICBCdWlsdEluVHlwZXMgeCA9IG5ldyBCdWlsdEluVHlwZXMNCiAgICAgICAgew0KICAgICAgICAgICAgQnl0ZUFycmF5ID0gbmV3IGJ5dGVbXSB7IDEsIDIgfQ0KICAgICAgICB9Ow0KICAgICAgICBCdWlsdEluVHlwZXMgeSA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPEJ1aWx0SW5UeXBlcz4oeCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxCdWlsdEluVHlwZXMgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8Qnl0ZUFycmF5PkFRST08L0J5dGVBcnJheT4NCjwvQnVpbHRJblR5cGVzPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKHkpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoeC5CeXRlQXJyYXksIHkuQnl0ZUFycmF5KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVzV2l0aEFycmF5T2ZPdGhlclR5cGVzKCkNCiAgICB7DQogICAgICAgIFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFR5cGVIYXNBcnJheU9mQVNlcmlhbGl6ZWRBc0I+KG5ldyBUeXBlSGFzQXJyYXlPZkFTZXJpYWxpemVkQXNCKHRydWUpLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPFR5cGVIYXNBcnJheU9mQVNlcmlhbGl6ZWRBc0IgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8SXRlbXM+DQogICAgPFR5cGVBPg0KICAgICAgPE5hbWU+dHlwZUFWYWx1ZTwvTmFtZT4NCiAgICA8L1R5cGVBPg0KICAgIDxUeXBlQT4NCiAgICAgIDxOYW1lPnR5cGVCVmFsdWU8L05hbWU+DQogICAgPC9UeXBlQT4NCiAgPC9JdGVtcz4NCjwvVHlwZUhhc0FycmF5T2ZBU2VyaWFsaXplZEFzQj4iKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVOYW1lc1dpdGhTcGVjaWFsQ2hhcmFjdGVycygpDQogICAgew0KICAgICAgICBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZTxfX1R5cGVOYW1lV2l0aFNwZWNpYWxDaGFyYWN0ZXJz5ryiw7E+KG5ldyBfX1R5cGVOYW1lV2l0aFNwZWNpYWxDaGFyYWN0ZXJz5ryiw7EoKSB7IFByb3BlcnR5TmFtZVdpdGhTcGVjaWFsQ2hhcmFjdGVyc+a8osOxID0gIlRlc3QiIH0sDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8X19UeXBlTmFtZVdpdGhTcGVjaWFsQ2hhcmFjdGVyc+a8osOxIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPFByb3BlcnR5TmFtZVdpdGhTcGVjaWFsQ2hhcmFjdGVyc+a8osOxPlRlc3Q8L1Byb3BlcnR5TmFtZVdpdGhTcGVjaWFsQ2hhcmFjdGVyc+a8osOxPg0KPC9fX1R5cGVOYW1lV2l0aFNwZWNpYWxDaGFyYWN0ZXJz5ryiw7E+Iik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Lbm93blR5cGVzVGhyb3VnaENvbnN0cnVjdG9yKCkNCiAgICB7DQogICAgICAgIEtub3duVHlwZXNUaHJvdWdoQ29uc3RydWN0b3IgdmFsdWUgPSBuZXcgS25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3RvcigpIHsgRW51bVZhbHVlID0gTXlFbnVtLk9uZSwgU2ltcGxlVHlwZVZhbHVlID0gbmV3IFNpbXBsZUtub3duVHlwZVZhbHVlKCkgeyBTdHJQcm9wZXJ0eSA9ICJQcm9wZXJ0eVZhbHVlIiB9IH07DQogICAgICAgIEtub3duVHlwZXNUaHJvdWdoQ29uc3RydWN0b3IgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8S25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3Rvcj4odmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8S25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3RvciB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxFbnVtVmFsdWUgeHNpOnR5cGU9IiJNeUVudW0iIj5PbmU8L0VudW1WYWx1ZT4NCiAgPFNpbXBsZVR5cGVWYWx1ZSB4c2k6dHlwZT0iIlNpbXBsZUtub3duVHlwZVZhbHVlIiI+DQogICAgPFN0clByb3BlcnR5PlByb3BlcnR5VmFsdWU8L1N0clByb3BlcnR5Pg0KICA8L1NpbXBsZVR5cGVWYWx1ZT4NCjwvS25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3Rvcj4iLA0KICAgICAgICAgICAgKCkgPT4geyByZXR1cm4gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKEtub3duVHlwZXNUaHJvdWdoQ29uc3RydWN0b3IpLCBuZXcgVHlwZVtdIHsgdHlwZW9mKE15RW51bSksIHR5cGVvZihTaW1wbGVLbm93blR5cGVWYWx1ZSkgfSk7IH0pOw0KDQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCgoTXlFbnVtKXZhbHVlLkVudW1WYWx1ZSwgKE15RW51bSlhY3R1YWwuRW51bVZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKCgoU2ltcGxlS25vd25UeXBlVmFsdWUpdmFsdWUuU2ltcGxlVHlwZVZhbHVlKS5TdHJQcm9wZXJ0eSwgKChTaW1wbGVLbm93blR5cGVWYWx1ZSlhY3R1YWwuU2ltcGxlVHlwZVZhbHVlKS5TdHJQcm9wZXJ0eSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9CYXNlQ2xhc3NBbmREZXJpdmVkQ2xhc3NXaXRoU2FtZVByb3BlcnR5KCkNCiAgICB7DQogICAgICAgIERlcml2ZWRDbGFzc1dpdGhTYW1lUHJvcGVydHkgdmFsdWUgPSBuZXcgRGVyaXZlZENsYXNzV2l0aFNhbWVQcm9wZXJ0eSgpIHsgRGF0ZVRpbWVQcm9wZXJ0eSA9IG5ldyBEYXRlVGltZSgxMDApLCBJbnRQcm9wZXJ0eSA9IDUsIFN0cmluZ1Byb3BlcnR5ID0gIlRlc3RTdHJpbmciLCBMaXN0UHJvcGVydHkgPSBuZXcgTGlzdDxzdHJpbmc+KCkgfTsNCiAgICAgICAgdmFsdWUuTGlzdFByb3BlcnR5LkFkZFJhbmdlKG5ldyBzdHJpbmdbXSB7ICJvbmUiLCAidHdvIiwgInRocmVlIiB9KTsNCg0KICAgICAgICBEZXJpdmVkQ2xhc3NXaXRoU2FtZVByb3BlcnR5IGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPERlcml2ZWRDbGFzc1dpdGhTYW1lUHJvcGVydHk+KHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPERlcml2ZWRDbGFzc1dpdGhTYW1lUHJvcGVydHkgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8U3RyaW5nUHJvcGVydHk+VGVzdFN0cmluZzwvU3RyaW5nUHJvcGVydHk+DQogIDxJbnRQcm9wZXJ0eT41PC9JbnRQcm9wZXJ0eT4NCiAgPERhdGVUaW1lUHJvcGVydHk+MDAwMS0wMS0wMVQwMDowMDowMC4wMDAwMTwvRGF0ZVRpbWVQcm9wZXJ0eT4NCiAgPExpc3RQcm9wZXJ0eT4NCiAgICA8c3RyaW5nPm9uZTwvc3RyaW5nPg0KICAgIDxzdHJpbmc+dHdvPC9zdHJpbmc+DQogICAgPHN0cmluZz50aHJlZTwvc3RyaW5nPg0KICA8L0xpc3RQcm9wZXJ0eT4NCjwvRGVyaXZlZENsYXNzV2l0aFNhbWVQcm9wZXJ0eT4iKTsNCg0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuRGF0ZVRpbWVQcm9wZXJ0eSwgYWN0dWFsLkRhdGVUaW1lUHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuSW50UHJvcGVydHksIGFjdHVhbC5JbnRQcm9wZXJ0eSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5TdHJpbmdQcm9wZXJ0eSwgYWN0dWFsLlN0cmluZ1Byb3BlcnR5KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkxpc3RQcm9wZXJ0eS5Ub0FycmF5KCksIGFjdHVhbC5MaXN0UHJvcGVydHkuVG9BcnJheSgpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0VudW1GbGFncygpDQogICAgew0KICAgICAgICBFbnVtRmxhZ3MgdmFsdWUxID0gRW51bUZsYWdzLk9uZSB8IEVudW1GbGFncy5Gb3VyOw0KICAgICAgICB2YXIgdmFsdWUyID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8RW51bUZsYWdzPih2YWx1ZTEsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8RW51bUZsYWdzPk9uZSBGb3VyPC9FbnVtRmxhZ3M+Iik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZTEsIHZhbHVlMik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9TZXJpYWxpemVDbGFzc1RoYXRJbXBsZW1lbnRzSW50ZWZhY2UoKQ0KICAgIHsNCiAgICAgICAgQ2xhc3NJbXBsZW1lbnRzSW50ZXJmYWNlIHZhbHVlID0gbmV3IENsYXNzSW1wbGVtZW50c0ludGVyZmFjZSgpIHsgQ2xhc3NJRCA9ICJDbGFzc0lEIiwgRGlzcGxheU5hbWUgPSAiRGlzcGxheU5hbWUiLCBJZCA9ICJJZCIsIElzTG9hZGVkID0gdHJ1ZSB9Ow0KICAgICAgICBDbGFzc0ltcGxlbWVudHNJbnRlcmZhY2UgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8Q2xhc3NJbXBsZW1lbnRzSW50ZXJmYWNlPih2YWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxDbGFzc0ltcGxlbWVudHNJbnRlcmZhY2UgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8Q2xhc3NJRD5DbGFzc0lEPC9DbGFzc0lEPg0KICA8RGlzcGxheU5hbWU+RGlzcGxheU5hbWU8L0Rpc3BsYXlOYW1lPg0KICA8SWQ+SWQ8L0lkPg0KICA8SXNMb2FkZWQ+dHJ1ZTwvSXNMb2FkZWQ+DQo8L0NsYXNzSW1wbGVtZW50c0ludGVyZmFjZT4iKTsNCg0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuQ2xhc3NJRCwgYWN0dWFsLkNsYXNzSUQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuRGlzcGxheU5hbWUsIGFjdHVhbC5EaXNwbGF5TmFtZSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5JZCwgYWN0dWFsLklkKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLklzTG9hZGVkLCBhY3R1YWwuSXNMb2FkZWQpOw0KICAgIH0NCg0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9YbWxBdHRyaWJ1dGVzVGVzdCgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgWG1sU2VyaWFsaXplckF0dHJpYnV0ZXMoKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEF0dHJpYnV0ZVRlc3RpbmcgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiIFhtbEF0dHJpYnV0ZU5hbWU9IiIyIiI+DQogIDxXb3JkPlN0cmluZyBjaG9pY2UgdmFsdWU8L1dvcmQ+DQogIDxYbWxJbmNsdWRlUHJvcGVydHkgeHNpOnR5cGU9IiJJdGVtQ2hvaWNlVHlwZSIiPkRlY2ltYWxOdW1iZXI8L1htbEluY2x1ZGVQcm9wZXJ0eT4NCiAgPFhtbEVudW1Qcm9wZXJ0eT4NCiAgICA8SXRlbUNob2ljZVR5cGU+RGVjaW1hbE51bWJlcjwvSXRlbUNob2ljZVR5cGU+DQogICAgPEl0ZW1DaG9pY2VUeXBlPk51bWJlcjwvSXRlbUNob2ljZVR5cGU+DQogICAgPEl0ZW1DaG9pY2VUeXBlPldvcmQ8L0l0ZW1DaG9pY2VUeXBlPg0KICAgIDxJdGVtQ2hvaWNlVHlwZT5Ob25lPC9JdGVtQ2hvaWNlVHlwZT4NCiAgPC9YbWxFbnVtUHJvcGVydHk+Jmx0O3htbCZndDtIZWxsbyBYTUwmbHQ7L3htbCZndDs8WG1sTmFtZXNwYWNlRGVjbGFyYXRpb25zUHJvcGVydHk+WG1sTmFtZXNwYWNlRGVjbGFyYXRpb25zUHJvcGVydHlWYWx1ZTwvWG1sTmFtZXNwYWNlRGVjbGFyYXRpb25zUHJvcGVydHk+PFhtbEVsZW1lbnRQcm9wZXJ0eU5vZGUgeG1sbnM9IiJodHRwOi8vZWxlbWVudCIiPjE8L1htbEVsZW1lbnRQcm9wZXJ0eU5vZGU+PEN1c3RvbVhtbEFycmF5UHJvcGVydHkgeG1sbnM9IiJodHRwOi8vbXluYW1lc3BhY2UiIj48c3RyaW5nPm9uZTwvc3RyaW5nPjxzdHJpbmc+dHdvPC9zdHJpbmc+PHN0cmluZz50aHJlZTwvc3RyaW5nPjwvQ3VzdG9tWG1sQXJyYXlQcm9wZXJ0eT48L0F0dHJpYnV0ZVRlc3Rpbmc+Iik7DQoNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGFjdHVhbC5FbnVtVHlwZSwgdmFsdWUuRW51bVR5cGUpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoYWN0dWFsLk15Q2hvaWNlLCB2YWx1ZS5NeUNob2ljZSk7DQogICAgICAgIG9iamVjdFtdIHN0cmluZ0FycmF5ID0gYWN0dWFsLlhtbEFycmF5UHJvcGVydHkuV2hlcmUoeCA9PiB4ICE9IG51bGwpDQogICAgICAgICAgICAuU2VsZWN0KHggPT4geC5Ub1N0cmluZygpKQ0KICAgICAgICAgICAgLlRvQXJyYXkoKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHN0cmluZ0FycmF5LCB2YWx1ZS5YbWxBcnJheVByb3BlcnR5KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGFjdHVhbC5YbWxBdHRyaWJ1dGVQcm9wZXJ0eSwgdmFsdWUuWG1sQXR0cmlidXRlUHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoYWN0dWFsLlhtbEVsZW1lbnRQcm9wZXJ0eSwgdmFsdWUuWG1sRWxlbWVudFByb3BlcnR5KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGFjdHVhbC5YbWxFbnVtUHJvcGVydHksIHZhbHVlLlhtbEVudW1Qcm9wZXJ0eSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChhY3R1YWwuWG1sSW5jbHVkZVByb3BlcnR5LCB2YWx1ZS5YbWxJbmNsdWRlUHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoYWN0dWFsLlhtbE5hbWVzcGFjZURlY2xhcmF0aW9uc1Byb3BlcnR5LCB2YWx1ZS5YbWxOYW1lc3BhY2VEZWNsYXJhdGlvbnNQcm9wZXJ0eSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChhY3R1YWwuWG1sVGV4dFByb3BlcnR5LCB2YWx1ZS5YbWxUZXh0UHJvcGVydHkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfWG1sQW55QXR0cmlidXRlVGVzdCgpDQogICAgew0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihUeXBlV2l0aEFueUF0dHJpYnV0ZSkpOw0KICAgICAgICBjb25zdCBzdHJpbmcgZm9ybWF0ID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48VHlwZVdpdGhBbnlBdHRyaWJ1dGUgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiIEdyb3VwVHlwZSA9ICd7MH0nIEludFByb3BlcnR5ID0gJ3sxfScgR3JvdXBCYXNlID0gJ3syfSc+PE5hbWU+ezN9PC9OYW1lPjwvVHlwZVdpdGhBbnlBdHRyaWJ1dGU+IjsNCiAgICAgICAgY29uc3QgaW50IGludFByb3BlcnR5ID0gNDI7DQogICAgICAgIGNvbnN0IHN0cmluZyBhdHRyaWJ1dGUxID0gIlRlY2huaWNhbCI7DQogICAgICAgIGNvbnN0IHN0cmluZyBhdHRyaWJ1dGUyID0gIlJlZCI7DQogICAgICAgIGNvbnN0IHN0cmluZyBuYW1lID0gIk15R3JvdXAiOw0KICAgICAgICB1c2luZyAodmFyIHN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHdyaXRlciA9IG5ldyBTdHJlYW1Xcml0ZXIoc3RyZWFtKTsNCiAgICAgICAgICAgIHdyaXRlci5Xcml0ZShmb3JtYXQsIGF0dHJpYnV0ZTEsIGludFByb3BlcnR5LCBhdHRyaWJ1dGUyLCBuYW1lKTsNCiAgICAgICAgICAgIHdyaXRlci5GbHVzaCgpOw0KICAgICAgICAgICAgc3RyZWFtLlBvc2l0aW9uID0gMDsNCiAgICAgICAgICAgIHZhciBvYmogPSAoVHlwZVdpdGhBbnlBdHRyaWJ1dGUpc2VyaWFsaXplci5EZXNlcmlhbGl6ZShzdHJlYW0pOw0KICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwob2JqKTsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChpbnRQcm9wZXJ0eSwgb2JqLkludFByb3BlcnR5KTsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChuYW1lLCBvYmouTmFtZSk7DQogICAgICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoMiwgb2JqLkF0dHJpYnV0ZXMuTGVuZ3RoKTsNCiAgICAgICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChhdHRyaWJ1dGUxLCBvYmouQXR0cmlidXRlc1swXS5WYWx1ZSk7DQogICAgICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoYXR0cmlidXRlMiwgb2JqLkF0dHJpYnV0ZXNbMV0uVmFsdWUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9TdHJ1Y3QoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFdpdGhTdHJ1Y3QgeyBTb21lID0gbmV3IFNvbWVTdHJ1Y3QgeyBBID0gMSwgQiA9IDIgfSB9Ow0KICAgICAgICB2YXIgcmVzdWx0ID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8V2l0aFN0cnVjdCB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxTb21lPg0KICAgIDxBPjE8L0E+DQogICAgPEI+MjwvQj4NCiAgPC9Tb21lPg0KPC9XaXRoU3RydWN0PiIpOw0KDQogICAgICAgIC8vIEFzc2VydA0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwocmVzdWx0LlNvbWUuQSwgdmFsdWUuU29tZS5BKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHJlc3VsdC5Tb21lLkIsIHZhbHVlLlNvbWUuQik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9FbnVtcygpDQogICAgew0KICAgICAgICB2YXIgaXRlbSA9IG5ldyBXaXRoRW51bXMoKSB7IEludCA9IEludEVudW0uT3B0aW9uMSwgU2hvcnQgPSBTaG9ydEVudW0uT3B0aW9uMiB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoaXRlbSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxXaXRoRW51bXMgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8SW50Pk9wdGlvbjE8L0ludD4NCiAgPFNob3J0Pk9wdGlvbjI8L1Nob3J0Pg0KPC9XaXRoRW51bXM+Iik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChpdGVtLlNob3J0LCBhY3R1YWwuU2hvcnQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoaXRlbS5JbnQsIGFjdHVhbC5JbnQpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfTnVsbGFibGVzKCkNCiAgICB7DQogICAgICAgIHZhciBpdGVtID0gbmV3IFdpdGhOdWxsYWJsZXMoKSB7IE9wdGlvbmFsID0gSW50RW51bS5PcHRpb24xLCBPcHRpb25hbEludCA9IDQyLCBTdHJ1Y3QxID0gbmV3IFNvbWVTdHJ1Y3QgeyBBID0gMSwgQiA9IDIgfSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoaXRlbSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxXaXRoTnVsbGFibGVzIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPE9wdGlvbmFsPk9wdGlvbjE8L09wdGlvbmFsPg0KICA8T3B0aW9udWxsIHhzaTpuaWw9IiJ0cnVlIiIgLz4NCiAgPE9wdGlvbmFsSW50PjQyPC9PcHRpb25hbEludD4NCiAgPE9wdGlvbnVsbEludCB4c2k6bmlsPSIidHJ1ZSIiIC8+DQogIDxTdHJ1Y3QxPg0KICAgIDxBPjE8L0E+DQogICAgPEI+MjwvQj4NCiAgPC9TdHJ1Y3QxPg0KICA8U3RydWN0MiB4c2k6bmlsPSIidHJ1ZSIiIC8+DQo8L1dpdGhOdWxsYWJsZXM+Iik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChpdGVtLk9wdGlvbmFsSW50LCBhY3R1YWwuT3B0aW9uYWxJbnQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoaXRlbS5PcHRpb25hbCwgYWN0dWFsLk9wdGlvbmFsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGl0ZW0uT3B0aW9udWxsLCBhY3R1YWwuT3B0aW9udWxsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGl0ZW0uT3B0aW9udWxsSW50LCBhY3R1YWwuT3B0aW9udWxsSW50KTsNCiAgICAgICAgQXNzZXJ0Lk51bGwoYWN0dWFsLlN0cnVjdDIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoaXRlbS5TdHJ1Y3QxLlZhbHVlLkEsIGFjdHVhbC5TdHJ1Y3QxLlZhbHVlLkEpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoaXRlbS5TdHJ1Y3QxLlZhbHVlLkIsIGFjdHVhbC5TdHJ1Y3QxLlZhbHVlLkIpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfQ2xhc3NJbXBsZW1lbnRpbmdJWG1sU2VyaWFsaWFibGUoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IENsYXNzSW1wbGVtZW50aW5nSVhtbFNlcmlhbGlhYmxlKCkgeyBTdHJpbmdWYWx1ZSA9ICJIZWxsbyB3b3JsZCIgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPENsYXNzSW1wbGVtZW50aW5nSVhtbFNlcmlhbGlhYmxlPih2YWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxDbGFzc0ltcGxlbWVudGluZ0lYbWxTZXJpYWxpYWJsZSBTdHJpbmdWYWx1ZT0iIkhlbGxvIHdvcmxkIiIgQm9vbFZhbHVlPSIiVHJ1ZSIiIC8+Iik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5TdHJpbmdWYWx1ZSwgYWN0dWFsLlN0cmluZ1ZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkdldFByaXZhdGVNZW1iZXIoKSwgYWN0dWFsLkdldFByaXZhdGVNZW1iZXIoKSk7DQogICAgICAgIEFzc2VydC5UcnVlKENsYXNzSW1wbGVtZW50aW5nSVhtbFNlcmlhbGlhYmxlLlJlYWRYbWxJbnZva2VkKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoQ2xhc3NJbXBsZW1lbnRpbmdJWG1sU2VyaWFsaWFibGUuV3JpdGVYbWxJbnZva2VkKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVXaXRoRmllbGROYW1lRW5kQnlTcGVjaWZpZWQoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFR5cGVXaXRoUHJvcGVydHlOYW1lU3BlY2lmaWVkKCkgeyBNeUZpZWxkID0gIk15RmllbGQiLCBNeUZpZWxkSWdub3JlZCA9IDk5LCBNeUZpZWxkU3BlY2lmaWVkID0gdHJ1ZSwgTXlGaWVsZElnbm9yZWRTcGVjaWZpZWQgPSBmYWxzZSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhQcm9wZXJ0eU5hbWVTcGVjaWZpZWQ+KHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/PjxUeXBlV2l0aFByb3BlcnR5TmFtZVNwZWNpZmllZCB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+PE15RmllbGQ+TXlGaWVsZDwvTXlGaWVsZD48L1R5cGVXaXRoUHJvcGVydHlOYW1lU3BlY2lmaWVkPiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuTXlGaWVsZCwgYWN0dWFsLk15RmllbGQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoYWN0dWFsLk15RmllbGRJZ25vcmVkLCAwKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWE1MX1R5cGVXaXRoWG1sU2NoZW1hRm9ybUF0dHJpYnV0ZSgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhYbWxTY2hlbWFGb3JtQXR0cmlidXRlKCkgeyBOb25lU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eSA9IG5ldyBMaXN0PHN0cmluZz4geyAiYWJjIiB9LCBRdWFsaWZpZWRTY2hlbWFGb3JtTGlzdFByb3BlcnR5ID0gbmV3IExpc3Q8Ym9vbD4geyB0cnVlIH0sIFVucXVhbGlmaWVkU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eSA9IG5ldyBMaXN0PGludD4geyAxIH0gfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFR5cGVXaXRoWG1sU2NoZW1hRm9ybUF0dHJpYnV0ZT4odmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+PFR5cGVXaXRoWG1sU2NoZW1hRm9ybUF0dHJpYnV0ZSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+PFVucXVhbGlmaWVkU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eT48aW50PjE8L2ludD48L1VucXVhbGlmaWVkU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eT48Tm9uZVNjaGVtYUZvcm1MaXN0UHJvcGVydHk+PE5vbmVQYXJhbWV0ZXI+YWJjPC9Ob25lUGFyYW1ldGVyPjwvTm9uZVNjaGVtYUZvcm1MaXN0UHJvcGVydHk+PFF1YWxpZmllZFNjaGVtYUZvcm1MaXN0UHJvcGVydHk+PFF1YWxpZmllZFBhcmFtZXRlcj50cnVlPC9RdWFsaWZpZWRQYXJhbWV0ZXI+PC9RdWFsaWZpZWRTY2hlbWFGb3JtTGlzdFByb3BlcnR5PjwvVHlwZVdpdGhYbWxTY2hlbWFGb3JtQXR0cmlidXRlPiIpOw0KDQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5Ob25lU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eS5Db3VudCwgYWN0dWFsLk5vbmVTY2hlbWFGb3JtTGlzdFByb3BlcnR5LkNvdW50KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLk5vbmVTY2hlbWFGb3JtTGlzdFByb3BlcnR5WzBdLCBhY3R1YWwuTm9uZVNjaGVtYUZvcm1MaXN0UHJvcGVydHlbMF0pOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuVW5xdWFsaWZpZWRTY2hlbWFGb3JtTGlzdFByb3BlcnR5LkNvdW50LCBhY3R1YWwuVW5xdWFsaWZpZWRTY2hlbWFGb3JtTGlzdFByb3BlcnR5LkNvdW50KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlVucXVhbGlmaWVkU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eVswXSwgYWN0dWFsLlVucXVhbGlmaWVkU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eVswXSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5RdWFsaWZpZWRTY2hlbWFGb3JtTGlzdFByb3BlcnR5LkNvdW50LCBhY3R1YWwuUXVhbGlmaWVkU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eS5Db3VudCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5RdWFsaWZpZWRTY2hlbWFGb3JtTGlzdFByb3BlcnR5WzBdLCBhY3R1YWwuUXVhbGlmaWVkU2NoZW1hRm9ybUxpc3RQcm9wZXJ0eVswXSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhNTF9UeXBlV2l0aFR5cGVOYW1lSW5YbWxUeXBlQXR0cmlidXRlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFR5cGVOYW1lSW5YbWxUeXBlQXR0cmlidXRlKCk7DQoNCiAgICAgICAgU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhUeXBlTmFtZUluWG1sVHlwZUF0dHJpYnV0ZT4odmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+PE15WG1sVHlwZSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgLz4iKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWE1MX1R5cGVXaXRoWG1sVGV4dEF0dHJpYnV0ZU9uQXJyYXkoKQ0KICAgIHsNCiAgICAgICAgdmFyIG9yaWdpbmFsID0gbmV3IFR5cGVXaXRoWG1sVGV4dEF0dHJpYnV0ZU9uQXJyYXkoKSB7IFRleHQgPSBuZXcgc3RyaW5nW10geyAidmFsMSIsICJ2YWwyIiB9IH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPFR5cGVXaXRoWG1sVGV4dEF0dHJpYnV0ZU9uQXJyYXk+KG9yaWdpbmFsLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPFR5cGVXaXRoWG1sVGV4dEF0dHJpYnV0ZU9uQXJyYXkgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiIHhtbG5zPSIiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNC9kaXNjb3ZlcnkiIj52YWwxdmFsMjwvVHlwZVdpdGhYbWxUZXh0QXR0cmlidXRlT25BcnJheT4iKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsLlRleHQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoMSwgYWN0dWFsLlRleHQuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKCJ2YWwxdmFsMiIsIGFjdHVhbC5UZXh0WzBdKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVXaXRoU2NoZW1hRm9ybUluWG1sQXR0cmlidXRlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFNjaGVtYUZvcm1JblhtbEF0dHJpYnV0ZSgpIHsgVGVzdFByb3BlcnR5ID0gImhlbGxvIiB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhTY2hlbWFGb3JtSW5YbWxBdHRyaWJ1dGU+KHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/PjxUeXBlV2l0aFNjaGVtYUZvcm1JblhtbEF0dHJpYnV0ZSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgZDFwMTpUZXN0UHJvcGVydHk9IiJoZWxsbyIiIHhtbG5zOmQxcDE9IiJodHRwOi8vdGVzdC5jb20iIiAvPiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuVGVzdFByb3BlcnR5LCBhY3R1YWwuVGVzdFByb3BlcnR5KTsNCiAgICB9DQoNCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhYbWxFbGVtZW50UHJvcGVydHkoKQ0KICAgIHsNCiAgICAgICAgWG1sRG9jdW1lbnQgeERvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICB4RG9jLkxvYWRYbWwoQCI8aHRtbD48L2h0bWw+Iik7DQogICAgICAgIFhtbEVsZW1lbnQgcHJvZHVjdEVsZW1lbnQgPSB4RG9jLkNyZWF0ZUVsZW1lbnQoIlByb2R1Y3QiKTsNCiAgICAgICAgcHJvZHVjdEVsZW1lbnQuSW5uZXJUZXh0ID0gIlByb2R1Y3QgaW5uZXJ0ZXh0IjsNCiAgICAgICAgWG1sRWxlbWVudCBjYXRlZ29yeUVsZW1lbnQgPSB4RG9jLkNyZWF0ZUVsZW1lbnQoIkNhdGVnb3J5Iik7DQogICAgICAgIGNhdGVnb3J5RWxlbWVudC5Jbm5lclRleHQgPSAiQ2F0ZWdvcnkgaW5uZXJ0ZXh0IjsNCiAgICAgICAgdmFyIGV4cGVjdGVkID0gbmV3IFR5cGVXaXRoWG1sRWxlbWVudFByb3BlcnR5KCkgeyBFbGVtZW50cyA9IG5ld1tdIHsgcHJvZHVjdEVsZW1lbnQsIGNhdGVnb3J5RWxlbWVudCB9IH07DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZShleHBlY3RlZCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PFR5cGVXaXRoWG1sRWxlbWVudFByb3BlcnR5IHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj48UHJvZHVjdD5Qcm9kdWN0IGlubmVydGV4dDwvUHJvZHVjdD48Q2F0ZWdvcnk+Q2F0ZWdvcnkgaW5uZXJ0ZXh0PC9DYXRlZ29yeT48L1R5cGVXaXRoWG1sRWxlbWVudFByb3BlcnR5PiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoZXhwZWN0ZWQuRWxlbWVudHMuTGVuZ3RoLCBhY3R1YWwuRWxlbWVudHMuTGVuZ3RoKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBleHBlY3RlZC5FbGVtZW50cy5MZW5ndGg7ICsraSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKGV4cGVjdGVkLkVsZW1lbnRzW2ldLklubmVyVGV4dCwgYWN0dWFsLkVsZW1lbnRzW2ldLklubmVyVGV4dCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVXaXRoWG1sRG9jdW1lbnRQcm9wZXJ0eSgpDQogICAgew0KICAgICAgICBYbWxEb2N1bWVudCB4bWxEb2MgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCiAgICAgICAgeG1sRG9jLkxvYWRYbWwoQCI8aHRtbD48aGVhZD5IZWFkIGNvbnRlbnQ8L2hlYWQ+PGJvZHk+PGgxPkhlYWRpbmcxPC9oMT48ZGl2PlRleHQgaW4gYm9keTwvZGl2PjwvYm9keT48L2h0bWw+Iik7DQogICAgICAgIHZhciBleHBlY3RlZCA9IG5ldyBUeXBlV2l0aFhtbERvY3VtZW50UHJvcGVydHkoKSB7IERvY3VtZW50ID0geG1sRG9jIH07DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZShleHBlY3RlZCwNCkAiPFR5cGVXaXRoWG1sRG9jdW1lbnRQcm9wZXJ0eSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+PERvY3VtZW50PjxodG1sPjxoZWFkPkhlYWQgY29udGVudDwvaGVhZD48Ym9keT48aDE+SGVhZGluZzE8L2gxPjxkaXY+VGV4dCBpbiBib2R5PC9kaXY+PC9ib2R5PjwvaHRtbD48L0RvY3VtZW50PjwvVHlwZVdpdGhYbWxEb2N1bWVudFByb3BlcnR5PiIpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwuRG9jdW1lbnQpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoZXhwZWN0ZWQuRG9jdW1lbnQuT3V0ZXJYbWwsIGFjdHVhbC5Eb2N1bWVudC5PdXRlclhtbCk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aE5vblB1YmxpY0RlZmF1bHRDb25zdHJ1Y3RvcigpDQogICAgew0KICAgICAgICBTeXN0ZW0uUmVmbGVjdGlvbi5UeXBlSW5mbyB0aSA9IFN5c3RlbS5SZWZsZWN0aW9uLkludHJvc3BlY3Rpb25FeHRlbnNpb25zLkdldFR5cGVJbmZvKHR5cGVvZihUeXBlV2l0aE5vblB1YmxpY0RlZmF1bHRDb25zdHJ1Y3RvcikpOw0KICAgICAgICBUeXBlV2l0aE5vblB1YmxpY0RlZmF1bHRDb25zdHJ1Y3RvciB2YWx1ZSA9IG51bGw7DQogICAgICAgIHZhbHVlID0gKFR5cGVXaXRoTm9uUHVibGljRGVmYXVsdENvbnN0cnVjdG9yKUZpbmREZWZhdWx0Q29uc3RydWN0b3IodGkpLkludm9rZShudWxsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKCJNci4gRm9vTmFtZSIsIHZhbHVlLk5hbWUpOw0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhOb25QdWJsaWNEZWZhdWx0Q29uc3RydWN0b3I+KHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPFR5cGVXaXRoTm9uUHVibGljRGVmYXVsdENvbnN0cnVjdG9yIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPE5hbWU+TXIuIEZvb05hbWU8L05hbWU+DQo8L1R5cGVXaXRoTm9uUHVibGljRGVmYXVsdENvbnN0cnVjdG9yPiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuTmFtZSwgYWN0dWFsLk5hbWUpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIFN5c3RlbS5SZWZsZWN0aW9uLkNvbnN0cnVjdG9ySW5mbyBGaW5kRGVmYXVsdENvbnN0cnVjdG9yKFN5c3RlbS5SZWZsZWN0aW9uLlR5cGVJbmZvIHRpKQ0KICAgIHsNCiAgICAgICAgZm9yZWFjaCAoU3lzdGVtLlJlZmxlY3Rpb24uQ29uc3RydWN0b3JJbmZvIGNpIGluIHRpLkRlY2xhcmVkQ29uc3RydWN0b3JzKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIWNpLklzU3RhdGljICYmIGNpLkdldFBhcmFtZXRlcnMoKS5MZW5ndGggPT0gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gY2k7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UZXN0SWdub3JlV2hpdGVzcGFjZUZvckRlc2VyaWFsaXphdGlvbigpDQogICAgew0KICAgICAgICBzdHJpbmcgeG1sID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz4NCjxTZXJ2ZXJTZXR0aW5ncz4NCiAgPERTMlJvb3Q+DQogICAgPCFbQ0RBVEFbIGh0dHA6Ly93eGRhdGEud2VhdGhlci5jb20vd3hkYXRhL11dPg0KICA8L0RTMlJvb3Q+DQogIDxNZXRyaWNDb25maWdVcmw+PCFbQ0RBVEFbIGh0dHA6Ly9zMy5hbWF6b25hd3MuY29tL3dpbmRvd3MtcHJvZC10d2MvZGVza3RvcDgvYmVhY29ucy54bWwgXV0+PC9NZXRyaWNDb25maWdVcmw+DQo8L1NlcnZlclNldHRpbmdzPiI7DQoNCiAgICAgICAgWG1sU2VyaWFsaXplciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKFNlcnZlclNldHRpbmdzKSk7DQogICAgICAgIFN0cmluZ1JlYWRlciByZWFkZXIgPSBuZXcgU3RyaW5nUmVhZGVyKHhtbCk7DQogICAgICAgIHZhciB2YWx1ZSA9IChTZXJ2ZXJTZXR0aW5ncylzZXJpYWxpemVyLkRlc2VyaWFsaXplKHJlYWRlcik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChAIiBodHRwOi8vczMuYW1hem9uYXdzLmNvbS93aW5kb3dzLXByb2QtdHdjL2Rlc2t0b3A4L2JlYWNvbnMueG1sICIsIHZhbHVlLk1ldHJpY0NvbmZpZ1VybCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChAIiBodHRwOi8vd3hkYXRhLndlYXRoZXIuY29tL3d4ZGF0YS8iLCB2YWx1ZS5EUzJSb290KTsNCiAgICB9DQoNCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhCaW5hcnlQcm9wZXJ0eSgpDQogICAgew0KICAgICAgICB2YXIgb2JqID0gbmV3IFR5cGVXaXRoQmluYXJ5UHJvcGVydHkoKTsNCiAgICAgICAgdmFyIHN0ciA9ICJUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9nLiI7DQogICAgICAgIG9iai5CYXNlNjRDb250ZW50ID0gRW5jb2RpbmcuVW5pY29kZS5HZXRCeXRlcyhzdHIpOw0KICAgICAgICBvYmouQmluYXJ5SGV4Q29udGVudCA9IEVuY29kaW5nLlVuaWNvZGUuR2V0Qnl0ZXMoc3RyKTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKG9iaiwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PFR5cGVXaXRoQmluYXJ5UHJvcGVydHkgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPjxCaW5hcnlIZXhDb250ZW50PjU0MDA2ODAwNjUwMDIwMDA3MTAwNzUwMDY5MDA2MzAwNkIwMDIwMDA2MjAwNzIwMDZGMDA3NzAwNkUwMDIwMDA2NjAwNkYwMDc4MDAyMDAwNkEwMDc1MDA2RDAwNzAwMDczMDAyMDAwNkYwMDc2MDA2NTAwNzIwMDIwMDA3NDAwNjgwMDY1MDAyMDAwNkMwMDYxMDA3QTAwNzkwMDIwMDA2NDAwNkYwMDY3MDAyRTAwPC9CaW5hcnlIZXhDb250ZW50PjxCYXNlNjRDb250ZW50PlZBQm9BR1VBSUFCeEFIVUFhUUJqQUdzQUlBQmlBSElBYndCM0FHNEFJQUJtQUc4QWVBQWdBR29BZFFCdEFIQUFjd0FnQUc4QWRnQmxBSElBSUFCMEFHZ0FaUUFnQUd3QVlRQjZBSGtBSUFCa0FHOEFad0F1QUE9PTwvQmFzZTY0Q29udGVudD48L1R5cGVXaXRoQmluYXJ5UHJvcGVydHk+Iik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh0cnVlLCBFbnVtZXJhYmxlLlNlcXVlbmNlRXF1YWwob2JqLkJhc2U2NENvbnRlbnQsIGFjdHVhbC5CYXNlNjRDb250ZW50KSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh0cnVlLCBFbnVtZXJhYmxlLlNlcXVlbmNlRXF1YWwob2JqLkJpbmFyeUhleENvbnRlbnQsIGFjdHVhbC5CaW5hcnlIZXhDb250ZW50KSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9EaWZmZXJlbnRTZXJpYWxpemVEZXNlcmlhbGl6ZU92ZXJsb2FkcygpDQogICAgew0KICAgICAgICB2YXIgZXhwZWN0ZWQgPSBuZXcgU2ltcGxlVHlwZSgpIHsgUDEgPSAicDEgdmFsdWUiLCBQMiA9IDEyMyB9Ow0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihTaW1wbGVUeXBlKSk7DQogICAgICAgIHZhciB3cml0ZXJUeXBlcyA9IG5ldyBUeXBlW10geyB0eXBlb2YoVGV4dFdyaXRlciksIHR5cGVvZihYbWxXcml0ZXIpIH07DQogICAgICAgIEFzc2VydC5UaHJvd3M8SW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbj4oKCkgPT4NCiAgICAgICAgew0KICAgICAgICAgICAgWG1sV3JpdGVyIHdyaXRlciA9IG51bGw7DQogICAgICAgICAgICBzZXJpYWxpemVyLlNlcmlhbGl6ZSh3cml0ZXIsIGV4cGVjdGVkKTsNCiAgICAgICAgfSk7DQogICAgICAgIEFzc2VydC5UaHJvd3M8SW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbj4oKCkgPT4NCiAgICAgICAgew0KICAgICAgICAgICAgWG1sUmVhZGVyIHJlYWRlciA9IG51bGw7DQogICAgICAgICAgICBzZXJpYWxpemVyLkRlc2VyaWFsaXplKHJlYWRlcik7DQogICAgICAgIH0pOw0KICAgICAgICBmb3JlYWNoICh2YXIgd3JpdGVyVHlwZSBpbiB3cml0ZXJUeXBlcykNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKTsNCg0KICAgICAgICAgICAgaWYgKHdyaXRlclR5cGUgPT0gdHlwZW9mKFRleHRXcml0ZXIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciB3cml0ZXIgPSBuZXcgU3RyZWFtV3JpdGVyKHN0cmVhbSk7DQogICAgICAgICAgICAgICAgc2VyaWFsaXplci5TZXJpYWxpemUod3JpdGVyLCBleHBlY3RlZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIHdyaXRlciA9IFhtbFdyaXRlci5DcmVhdGUoc3RyZWFtKTsNCiAgICAgICAgICAgICAgICBzZXJpYWxpemVyLlNlcmlhbGl6ZSh3cml0ZXIsIGV4cGVjdGVkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHN0cmVhbS5Qb3NpdGlvbiA9IDA7DQogICAgICAgICAgICB2YXIgYWN0dWFsT3V0cHV0ID0gbmV3IFN0cmVhbVJlYWRlcihzdHJlYW0pLlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIGJhc2VsaW5lID0NCiAgICBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxTaW1wbGVUeXBlIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj48UDE+cDEgdmFsdWU8L1AxPjxQMj4xMjM8L1AyPjwvU2ltcGxlVHlwZT4iOw0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFV0aWxzLkNvbXBhcmUoYmFzZWxpbmUsIGFjdHVhbE91dHB1dCk7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShyZXN1bHQuRXF1YWwsIHN0cmluZy5Gb3JtYXQoInsxfXswfVRlc3QgZmFpbGVkIGZvciBpbnB1dDogezJ9ezB9RXhwZWN0ZWQ6IHszfXswfUFjdHVhbDogezR9IiwgRW52aXJvbm1lbnQuTmV3TGluZSwgcmVzdWx0LkVycm9yTWVzc2FnZSwgZXhwZWN0ZWQsIGJhc2VsaW5lLCBhY3R1YWxPdXRwdXQpKTsNCiAgICAgICAgICAgIHN0cmVhbS5Qb3NpdGlvbiA9IDA7DQoNCiAgICAgICAgICAgIC8vIFhtbFNlcmlhbGl6ZXIuQ2FuU2VyaWFsaXplKFhtbFJlYWRlcikNCiAgICAgICAgICAgIFhtbFJlYWRlciByZWFkZXIgPSBYbWxSZWFkZXIuQ3JlYXRlKHN0cmVhbSk7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShzZXJpYWxpemVyLkNhbkRlc2VyaWFsaXplKHJlYWRlcikpOw0KDQogICAgICAgICAgICAvLyBYbWxTZXJpYWxpemVyLkRlc2VyaWFsaXplKFhtbFJlYWRlcikNCiAgICAgICAgICAgIHZhciBhY3R1YWwgPSAoU2ltcGxlVHlwZSlzZXJpYWxpemVyLkRlc2VyaWFsaXplKHJlYWRlcik7DQogICAgICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoZXhwZWN0ZWQuUDEsIGFjdHVhbC5QMSk7DQogICAgICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwoZXhwZWN0ZWQuUDIsIGFjdHVhbC5QMik7DQoNCiAgICAgICAgICAgIHN0cmVhbS5EaXNwb3NlKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBbQ29uZGl0aW9uYWxGYWN0KG5hbWVvZihJc1RpbWVTcGFuU2VyaWFsaXphdGlvbkF2YWlsYWJsZSkpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhUaW1lU3BhblByb3BlcnR5KCkNCiAgICB7DQogICAgICAgIHZhciBvYmogPSBuZXcgVHlwZVdpdGhUaW1lU3BhblByb3BlcnR5IHsgVGltZVNwYW5Qcm9wZXJ0eSA9IFRpbWVTcGFuLkZyb21NaWxsaXNlY29uZHMoMSkgfTsNCiAgICAgICAgdmFyIGRlc2VyaWFsaXplZE9iaiA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKG9iaiwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTE2IiI/Pg0KPFR5cGVXaXRoVGltZVNwYW5Qcm9wZXJ0eSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQo8VGltZVNwYW5Qcm9wZXJ0eT5QVDAuMDAxUzwvVGltZVNwYW5Qcm9wZXJ0eT4NCjwvVHlwZVdpdGhUaW1lU3BhblByb3BlcnR5PiIpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwob2JqLlRpbWVTcGFuUHJvcGVydHksIGRlc2VyaWFsaXplZE9iai5UaW1lU3BhblByb3BlcnR5KTsNCiAgICB9DQoNCiAgICBbQ29uZGl0aW9uYWxGYWN0KG5hbWVvZihJc1RpbWVTcGFuU2VyaWFsaXphdGlvbkF2YWlsYWJsZSkpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhEZWZhdWx0VGltZVNwYW5Qcm9wZXJ0eSgpDQogICAgew0KICAgICAgICB2YXIgb2JqID0gbmV3IFR5cGVXaXRoRGVmYXVsdFRpbWVTcGFuUHJvcGVydHkgeyBUaW1lU3BhblByb3BlcnR5MiA9IG5ldyBUaW1lU3BhbigwLCAxLCAwKSB9Ow0KICAgICAgICB2YXIgZGVzZXJpYWxpemVkT2JqID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUob2JqLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPFR5cGVXaXRoRGVmYXVsdFRpbWVTcGFuUHJvcGVydHkgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPjxUaW1lU3BhblByb3BlcnR5Mj5QVDFNPC9UaW1lU3BhblByb3BlcnR5Mj48L1R5cGVXaXRoRGVmYXVsdFRpbWVTcGFuUHJvcGVydHk+Iik7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGRlc2VyaWFsaXplZE9iaik7DQogICAgICAgIEFzc2VydC5FcXVhbChvYmouVGltZVNwYW5Qcm9wZXJ0eSwgZGVzZXJpYWxpemVkT2JqLlRpbWVTcGFuUHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuRXF1YWwob2JqLlRpbWVTcGFuUHJvcGVydHkyLCBkZXNlcmlhbGl6ZWRPYmouVGltZVNwYW5Qcm9wZXJ0eTIpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhCeXRlUHJvcGVydHkoKQ0KICAgIHsNCiAgICAgICAgdmFyIG9iaiA9IG5ldyBUeXBlV2l0aEJ5dGVQcm9wZXJ0eSgpIHsgQnl0ZVByb3BlcnR5ID0gMTIzIH07DQogICAgICAgIHZhciBkZXNlcmlhbGl6ZWRPYmogPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZShvYmosDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/Pg0KPFR5cGVXaXRoQnl0ZVByb3BlcnR5IHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPEJ5dGVQcm9wZXJ0eT4xMjM8L0J5dGVQcm9wZXJ0eT4NCjwvVHlwZVdpdGhCeXRlUHJvcGVydHk+Iik7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbChvYmouQnl0ZVByb3BlcnR5LCBkZXNlcmlhbGl6ZWRPYmouQnl0ZVByb3BlcnR5KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0Rlc2VyaWFsaXplT3V0T2ZSYW5nZUJ5dGVQcm9wZXJ0eSgpDQogICAgew0KICAgICAgICAvL0Rlc2VyaWFsaXplIGFuIGluc3RhbmNlIHdpdGggb3V0LW9mLXJhbmdlIHZhbHVlIGZvciB0aGUgYnl0ZSBwcm9wZXJ0eSwgZXhwZWN0aW5nIGV4Y2VwdGlvbiBmcm9tIGRlc2VyaWFsaXphdGlvbiBwcm9jZXNzDQogICAgICAgIHZhciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKFR5cGVXaXRoQnl0ZVByb3BlcnR5KSk7DQogICAgICAgIHVzaW5nICh2YXIgc3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgd3JpdGVyID0gbmV3IFN0cmVhbVdyaXRlcihzdHJlYW0pOw0KICAgICAgICAgICAgd3JpdGVyLldyaXRlKA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz4NCjxUeXBlV2l0aEJ5dGVQcm9wZXJ0eSB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxCeXRlUHJvcGVydHk+LTE8L0J5dGVQcm9wZXJ0eT4NCjwvVHlwZVdpdGhCeXRlUHJvcGVydHk+Iik7DQogICAgICAgICAgICB3cml0ZXIuRmx1c2goKTsNCiAgICAgICAgICAgIHN0cmVhbS5Qb3NpdGlvbiA9IDA7DQogICAgICAgICAgICBBc3NlcnQuVGhyb3dzPEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24+KCgpID0+IHsNCiAgICAgICAgICAgICAgICB2YXIgZGVzZXJpYWxpemVkT2JqID0gKFR5cGVXaXRoQnl0ZVByb3BlcnR5KXNlcmlhbGl6ZXIuRGVzZXJpYWxpemUoc3RyZWFtKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9YbWxBdHRyaWJ1dGVzX1JlbW92ZVhtbEVsZW1lbnRBdHRyaWJ1dGUoKQ0KICAgIHsNCiAgICAgICAgWG1sQXR0cmlidXRlcyBhdHRycyA9IG5ldyBYbWxBdHRyaWJ1dGVzKCk7DQoNCiAgICAgICAgWG1sRWxlbWVudEF0dHJpYnV0ZSBpdGVtID0gbmV3IFhtbEVsZW1lbnRBdHRyaWJ1dGUoImVsZW0xIik7DQogICAgICAgIGF0dHJzLlhtbEVsZW1lbnRzLkFkZChpdGVtKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoYXR0cnMuWG1sRWxlbWVudHMuQ29udGFpbnMoaXRlbSkpOw0KDQogICAgICAgIGF0dHJzLlhtbEVsZW1lbnRzLlJlbW92ZShpdGVtKTsNCiAgICAgICAgQXNzZXJ0LkZhbHNlKGF0dHJzLlhtbEVsZW1lbnRzLkNvbnRhaW5zKGl0ZW0pKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0FycmF5T2ZYbWxOb2RlUHJvcGVydHkoKQ0KICAgIHsNCiAgICAgICAgdmFyIG9iaiA9IG5ldyBUeXBlV2l0aFhtbE5vZGVBcnJheVByb3BlcnR5KCkNCiAgICAgICAgew0KICAgICAgICAgICAgQ0RBVEEgPSBuZXdbXSB7IG5ldyBYbWxEb2N1bWVudCgpLkNyZWF0ZUNEYXRhU2VjdGlvbigidGVzdCZ0ZXN0IikgfQ0KICAgICAgICB9Ow0KICAgICAgICB2YXIgZGVzZXJpYWxpemVkT2JqID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VHlwZVdpdGhYbWxOb2RlQXJyYXlQcm9wZXJ0eT4ob2JqLCBAIjxUeXBlV2l0aFhtbE5vZGVBcnJheVByb3BlcnR5IHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj48IVtDREFUQVt0ZXN0JnRlc3RdXT48L1R5cGVXaXRoWG1sTm9kZUFycmF5UHJvcGVydHk+Iik7DQogICAgICAgIEFzc2VydC5FcXVhbChvYmouQ0RBVEEuTGVuZ3RoLCBkZXNlcmlhbGl6ZWRPYmouQ0RBVEEuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKG9iai5DREFUQVswXS5Jbm5lclRleHQsIGRlc2VyaWFsaXplZE9iai5DREFUQVswXS5Jbm5lclRleHQpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhUd29EaW1lbnNpb25hbEFycmF5UHJvcGVydHkyKCkNCiAgICB7DQogICAgICAgIFNpbXBsZVR5cGVbXVtdIHNpbXBsZVR5cGUyRCA9IEdldE9iamVjdHdpdGgyREFycmF5T2ZTaW1wbGVUeXBlKCk7DQoNCiAgICAgICAgdmFyIG9iaiA9IG5ldyBUeXBlV2l0aDJEQXJyYXlQcm9wZXJ0eTIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBUd29EQXJyYXlPZlNpbXBsZVR5cGUgPSBzaW1wbGVUeXBlMkQNCiAgICAgICAgfTsNCg0KICAgICAgICBzdHJpbmcgYmFzZWxpbmUgPSAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmIC0gOFwiPz5cclxuPFR5cGVXaXRoMkRBcnJheVByb3BlcnR5MiB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCI+XHJcbiAgPFR3b0RBcnJheU9mU2ltcGxlVHlwZT5cclxuICAgIDxTaW1wbGVUeXBlPlxyXG4gICAgICA8U2ltcGxlVHlwZT5cclxuICAgICAgICA8UDE+MCAwIHZhbHVlPC9QMT5cclxuICAgICAgICA8UDI+MTwvUDI+XHJcbiAgICAgIDwvU2ltcGxlVHlwZT5cclxuICAgICAgPFNpbXBsZVR5cGU+XHJcbiAgICAgICAgPFAxPjAgMSB2YWx1ZTwvUDE+XHJcbiAgICAgICAgPFAyPjI8L1AyPlxyXG4gICAgICA8L1NpbXBsZVR5cGU+XHJcbiAgICA8L1NpbXBsZVR5cGU+XHJcbiAgICA8U2ltcGxlVHlwZT5cclxuICAgICAgPFNpbXBsZVR5cGU+XHJcbiAgICAgICAgPFAxPjEgMCB2YWx1ZTwvUDE+XHJcbiAgICAgICAgPFAyPjM8L1AyPlxyXG4gICAgICA8L1NpbXBsZVR5cGU+XHJcbiAgICAgIDxTaW1wbGVUeXBlPlxyXG4gICAgICAgIDxQMT4xIDEgdmFsdWU8L1AxPlxyXG4gICAgICAgIDxQMj40PC9QMj5cclxuICAgICAgPC9TaW1wbGVUeXBlPlxyXG4gICAgPC9TaW1wbGVUeXBlPlxyXG4gIDwvVHdvREFycmF5T2ZTaW1wbGVUeXBlPlxyXG48L1R5cGVXaXRoMkRBcnJheVByb3BlcnR5Mj4iOw0KICAgICAgICBUeXBlV2l0aDJEQXJyYXlQcm9wZXJ0eTIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUob2JqLCBiYXNlbGluZSk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5UcnVlKFNpbXBsZVR5cGUuQXJlRXF1YWwoc2ltcGxlVHlwZTJEWzBdWzBdLCBhY3R1YWwuVHdvREFycmF5T2ZTaW1wbGVUeXBlWzBdWzBdKSk7DQogICAgICAgIEFzc2VydC5UcnVlKFNpbXBsZVR5cGUuQXJlRXF1YWwoc2ltcGxlVHlwZTJEWzBdWzFdLCBhY3R1YWwuVHdvREFycmF5T2ZTaW1wbGVUeXBlWzBdWzFdKSk7DQogICAgICAgIEFzc2VydC5UcnVlKFNpbXBsZVR5cGUuQXJlRXF1YWwoc2ltcGxlVHlwZTJEWzFdWzBdLCBhY3R1YWwuVHdvREFycmF5T2ZTaW1wbGVUeXBlWzFdWzBdKSk7DQogICAgICAgIEFzc2VydC5UcnVlKFNpbXBsZVR5cGUuQXJlRXF1YWwoc2ltcGxlVHlwZTJEWzFdWzFdLCBhY3R1YWwuVHdvREFycmF5T2ZTaW1wbGVUeXBlWzFdWzFdKSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgU2ltcGxlVHlwZVtdW10gR2V0T2JqZWN0d2l0aDJEQXJyYXlPZlNpbXBsZVR5cGUoKQ0KICAgIHsNCiAgICAgICAgU2ltcGxlVHlwZVtdW10gc2ltcGxlVHlwZTJEID0gbmV3IFNpbXBsZVR5cGVbMl1bXTsNCiAgICAgICAgc2ltcGxlVHlwZTJEWzBdID0gbmV3IFNpbXBsZVR5cGVbMl07DQogICAgICAgIHNpbXBsZVR5cGUyRFsxXSA9IG5ldyBTaW1wbGVUeXBlWzJdOw0KICAgICAgICBzaW1wbGVUeXBlMkRbMF1bMF0gPSBuZXcgU2ltcGxlVHlwZSgpIHsgUDEgPSAiMCAwIHZhbHVlIiwgUDIgPSAxIH07DQogICAgICAgIHNpbXBsZVR5cGUyRFswXVsxXSA9IG5ldyBTaW1wbGVUeXBlKCkgeyBQMSA9ICIwIDEgdmFsdWUiLCBQMiA9IDIgfTsNCiAgICAgICAgc2ltcGxlVHlwZTJEWzFdWzBdID0gbmV3IFNpbXBsZVR5cGUoKSB7IFAxID0gIjEgMCB2YWx1ZSIsIFAyID0gMyB9Ow0KICAgICAgICBzaW1wbGVUeXBlMkRbMV1bMV0gPSBuZXcgU2ltcGxlVHlwZSgpIHsgUDEgPSAiMSAxIHZhbHVlIiwgUDIgPSA0IH07DQogICAgICAgIHJldHVybiBzaW1wbGVUeXBlMkQ7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aEJ5dGVBcnJheUFzWG1sVGV4dCgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhCeXRlQXJyYXlBc1htbFRleHQoKSB7IFZhbHVlID0gbmV3IGJ5dGVbXSB7IDEsIDIsIDMgfSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiPz5cclxuPFR5cGVXaXRoQnl0ZUFycmF5QXNYbWxUZXh0IHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5BUUlEPC9UeXBlV2l0aEJ5dGVBcnJheUFzWG1sVGV4dD4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwuVmFsdWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuVmFsdWUuTGVuZ3RoLCBhY3R1YWwuVmFsdWUuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoRW51bWVyYWJsZS5TZXF1ZW5jZUVxdWFsKHZhbHVlLlZhbHVlLCBhY3R1YWwuVmFsdWUpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1NpbXBsZVR5cGUoKQ0KICAgIHsNCiAgICAgICAgdmFyIHNlcmlhbGl6ZXIgPSBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoU2ltcGxlVHlwZSkpOw0KICAgICAgICB2YXIgb2JqID0gbmV3IFNpbXBsZVR5cGUgeyBQMSA9ICJmb28iLCBQMiA9IDEgfTsNCiAgICAgICAgdmFyIGRlc2VyaWFsaXplZE9iaiA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKG9iaiwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTE2IiI/Pg0KPFNpbXBsZVR5cGUgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8UDE+Zm9vPC9QMT4NCiAgPFAyPjE8L1AyPg0KPC9TaW1wbGVUeXBlPiIpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChkZXNlcmlhbGl6ZWRPYmopOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwob2JqLlAxLCBkZXNlcmlhbGl6ZWRPYmouUDEpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwob2JqLlAyLCBkZXNlcmlhbGl6ZWRPYmouUDIpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfQmFzZUNsYXNzQW5kRGVyaXZlZENsYXNzMldpdGhTYW1lUHJvcGVydHkoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IERlcml2ZWRDbGFzc1dpdGhTYW1lUHJvcGVydHkyKCkgeyBEYXRlVGltZVByb3BlcnR5ID0gbmV3IERhdGVUaW1lKDEwMCwgRGF0ZVRpbWVLaW5kLlV0YyksIEludFByb3BlcnR5ID0gNSwgU3RyaW5nUHJvcGVydHkgPSAiVGVzdFN0cmluZyIsIExpc3RQcm9wZXJ0eSA9IG5ldyBMaXN0PHN0cmluZz4oKSB9Ow0KICAgICAgICB2YWx1ZS5MaXN0UHJvcGVydHkuQWRkUmFuZ2UobmV3IHN0cmluZ1tdIHsgIm9uZSIsICJ0d28iLCAidGhyZWUiIH0pOw0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxEZXJpdmVkQ2xhc3NXaXRoU2FtZVByb3BlcnR5MiB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiI+DQogIDxTdHJpbmdQcm9wZXJ0eT5UZXN0U3RyaW5nPC9TdHJpbmdQcm9wZXJ0eT4NCiAgPEludFByb3BlcnR5PjU8L0ludFByb3BlcnR5Pg0KICA8RGF0ZVRpbWVQcm9wZXJ0eT4wMDAxLTAxLTAxVDAwOjAwOjAwLjAwMDAxWjwvRGF0ZVRpbWVQcm9wZXJ0eT4NCiAgPExpc3RQcm9wZXJ0eT4NCiAgICA8c3RyaW5nPm9uZTwvc3RyaW5nPg0KICAgIDxzdHJpbmc+dHdvPC9zdHJpbmc+DQogICAgPHN0cmluZz50aHJlZTwvc3RyaW5nPg0KICA8L0xpc3RQcm9wZXJ0eT4NCjwvRGVyaXZlZENsYXNzV2l0aFNhbWVQcm9wZXJ0eTI+Iik7DQoNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkRhdGVUaW1lUHJvcGVydHksIGFjdHVhbC5EYXRlVGltZVByb3BlcnR5KTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkludFByb3BlcnR5LCBhY3R1YWwuSW50UHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuU3RyaW5nUHJvcGVydHksIGFjdHVhbC5TdHJpbmdQcm9wZXJ0eSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5MaXN0UHJvcGVydHkuVG9BcnJheSgpLCBhY3R1YWwuTGlzdFByb3BlcnR5LlRvQXJyYXkoKSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aFByb3BlcnRpZXNIYXZpbmdEZWZhdWx0VmFsdWVfRGVmYXVsdFZhbHVlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFByb3BlcnRpZXNIYXZpbmdEZWZhdWx0VmFsdWUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBTdHJpbmdQcm9wZXJ0eSA9ICJEZWZhdWx0U3RyaW5nIiwNCiAgICAgICAgICAgIEVtcHR5U3RyaW5nUHJvcGVydHkgPSAiIiwNCiAgICAgICAgICAgIEludFByb3BlcnR5ID0gMTEsDQogICAgICAgICAgICBDaGFyUHJvcGVydHkgPSAnbScNCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiPz5cclxuPFR5cGVXaXRoUHJvcGVydGllc0hhdmluZ0RlZmF1bHRWYWx1ZSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCI+XHJcbiAgPENoYXJQcm9wZXJ0eT4xMDk8L0NoYXJQcm9wZXJ0eT5cclxuPC9UeXBlV2l0aFByb3BlcnRpZXNIYXZpbmdEZWZhdWx0VmFsdWU+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlN0cmluZ1Byb3BlcnR5LCBhY3R1YWwuU3RyaW5nUHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuRW1wdHlTdHJpbmdQcm9wZXJ0eSwgYWN0dWFsLkVtcHR5U3RyaW5nUHJvcGVydHkpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuSW50UHJvcGVydHksIGFjdHVhbC5JbnRQcm9wZXJ0eSk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5DaGFyUHJvcGVydHksIGFjdHVhbC5DaGFyUHJvcGVydHkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhTdHJpbmdQcm9wZXJ0eVdpdGhEZWZhdWx0VmFsdWVfTm9uRGVmYXVsdFZhbHVlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFByb3BlcnRpZXNIYXZpbmdEZWZhdWx0VmFsdWUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBTdHJpbmdQcm9wZXJ0eSA9ICJOb25EZWZhdWx0VmFsdWUiLA0KICAgICAgICAgICAgRW1wdHlTdHJpbmdQcm9wZXJ0eSA9ICJOb25FbXB0eSIsDQogICAgICAgICAgICBJbnRQcm9wZXJ0eSA9IDEyLA0KICAgICAgICAgICAgQ2hhclByb3BlcnR5ID0gJ24nDQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLCAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+XHJcbjxUeXBlV2l0aFByb3BlcnRpZXNIYXZpbmdEZWZhdWx0VmFsdWUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDxFbXB0eVN0cmluZ1Byb3BlcnR5Pk5vbkVtcHR5PC9FbXB0eVN0cmluZ1Byb3BlcnR5PlxyXG4gIDxTdHJpbmdQcm9wZXJ0eT5Ob25EZWZhdWx0VmFsdWU8L1N0cmluZ1Byb3BlcnR5PlxyXG4gIDxJbnRQcm9wZXJ0eT4xMjwvSW50UHJvcGVydHk+XHJcbiAgPENoYXJQcm9wZXJ0eT4xMTA8L0NoYXJQcm9wZXJ0eT5cclxuPC9UeXBlV2l0aFByb3BlcnRpZXNIYXZpbmdEZWZhdWx0VmFsdWU+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLlN0cmluZ1Byb3BlcnR5LCBhY3R1YWwuU3RyaW5nUHJvcGVydHkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhFbnVtUHJvcGVydHlIYXZpbmdEZWZhdWx0VmFsdWUoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFR5cGVXaXRoRW51bVByb3BlcnR5SGF2aW5nRGVmYXVsdFZhbHVlKCkgeyBFbnVtUHJvcGVydHkgPSBJbnRFbnVtLk9wdGlvbjAgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48VHlwZVdpdGhFbnVtUHJvcGVydHlIYXZpbmdEZWZhdWx0VmFsdWUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDxFbnVtUHJvcGVydHk+T3B0aW9uMDwvRW51bVByb3BlcnR5PlxyXG48L1R5cGVXaXRoRW51bVByb3BlcnR5SGF2aW5nRGVmYXVsdFZhbHVlPiIsDQogICAgICAgICAgICBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5FbnVtUHJvcGVydHksIGFjdHVhbC5FbnVtUHJvcGVydHkpOw0KDQoNCiAgICAgICAgdmFsdWUgPSBuZXcgVHlwZVdpdGhFbnVtUHJvcGVydHlIYXZpbmdEZWZhdWx0VmFsdWUoKSB7IEVudW1Qcm9wZXJ0eSA9IEludEVudW0uT3B0aW9uMSB9Ow0KICAgICAgICBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiPz5cclxuPFR5cGVXaXRoRW51bVByb3BlcnR5SGF2aW5nRGVmYXVsdFZhbHVlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiAvPiIsDQogICAgICAgICAgICBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5FbnVtUHJvcGVydHksIGFjdHVhbC5FbnVtUHJvcGVydHkpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhFbnVtRmxhZ1Byb3BlcnR5SGF2aW5nRGVmYXVsdFZhbHVlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aEVudW1GbGFnUHJvcGVydHlIYXZpbmdEZWZhdWx0VmFsdWUoKSB7IEVudW1Qcm9wZXJ0eSA9IEVudW1GbGFncy5Ud28gfCBFbnVtRmxhZ3MuVGhyZWUgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48VHlwZVdpdGhFbnVtRmxhZ1Byb3BlcnR5SGF2aW5nRGVmYXVsdFZhbHVlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5cclxuICA8RW51bVByb3BlcnR5PlR3byBUaHJlZTwvRW51bVByb3BlcnR5PlxyXG48L1R5cGVXaXRoRW51bUZsYWdQcm9wZXJ0eUhhdmluZ0RlZmF1bHRWYWx1ZT4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuRW51bVByb3BlcnR5LCBhY3R1YWwuRW51bVByb3BlcnR5KTsNCg0KDQogICAgICAgIHZhbHVlID0gbmV3IFR5cGVXaXRoRW51bUZsYWdQcm9wZXJ0eUhhdmluZ0RlZmF1bHRWYWx1ZSgpOw0KICAgICAgICBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiPz5cclxuPFR5cGVXaXRoRW51bUZsYWdQcm9wZXJ0eUhhdmluZ0RlZmF1bHRWYWx1ZSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgLz4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuRW51bVByb3BlcnR5LCBhY3R1YWwuRW51bVByb3BlcnR5KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX1R5cGVXaXRoRW51bUZsYWdQcm9wZXJ0eUhhdmluZ0RlZmF1bHRWYWx1ZSgpDQogICAgew0KICAgICAgICB2YXIgbWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKFR5cGVXaXRoRW51bUZsYWdQcm9wZXJ0eUhhdmluZ0RlZmF1bHRWYWx1ZSkpOw0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKG1hcHBpbmcpOw0KDQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aEVudW1GbGFnUHJvcGVydHlIYXZpbmdEZWZhdWx0VmFsdWUoKSB7IEVudW1Qcm9wZXJ0eSA9IEVudW1GbGFncy5Ud28gfCBFbnVtRmxhZ3MuVGhyZWUgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKA0KICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiPz5cclxuPFR5cGVXaXRoRW51bUZsYWdQcm9wZXJ0eUhhdmluZ0RlZmF1bHRWYWx1ZSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgaWQ9XCJpZDFcIj5cclxuICA8RW51bVByb3BlcnR5IHhzaTp0eXBlPVwiRW51bUZsYWdzXCI+VHdvIFRocmVlPC9FbnVtUHJvcGVydHk+XHJcbjwvVHlwZVdpdGhFbnVtRmxhZ1Byb3BlcnR5SGF2aW5nRGVmYXVsdFZhbHVlPiIsDQogICAgICAgICAgICAoKSA9PiBzZXJpYWxpemVyKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuRW51bVByb3BlcnR5LCBhY3R1YWwuRW51bVByb3BlcnR5KTsNCg0KDQogICAgICAgIHZhbHVlID0gbmV3IFR5cGVXaXRoRW51bUZsYWdQcm9wZXJ0eUhhdmluZ0RlZmF1bHRWYWx1ZSgpOw0KICAgICAgICBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSgNCiAgICAgICAgICAgIHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XHJcbjxUeXBlV2l0aEVudW1GbGFnUHJvcGVydHlIYXZpbmdEZWZhdWx0VmFsdWUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIGlkPVwiaWQxXCI+XHJcbiAgPEVudW1Qcm9wZXJ0eSB4c2k6dHlwZT1cIkVudW1GbGFnc1wiPk9uZSBGb3VyPC9FbnVtUHJvcGVydHk+XHJcbjwvVHlwZVdpdGhFbnVtRmxhZ1Byb3BlcnR5SGF2aW5nRGVmYXVsdFZhbHVlPiIsDQogICAgICAgICAgICAoKSA9PiBzZXJpYWxpemVyKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuRW51bVByb3BlcnR5LCBhY3R1YWwuRW51bVByb3BlcnR5KTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1R5cGVXaXRoWG1sUXVhbGlmaWVkTmFtZSgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhYbWxRdWFsaWZpZWROYW1lKCkNCiAgICAgICAgew0KICAgICAgICAgICAgVmFsdWUgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZSgiRm9vTmFtZSIpDQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLCAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+XHJcbjxUeXBlV2l0aFhtbFF1YWxpZmllZE5hbWUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDxWYWx1ZSB4bWxucz1cIlwiPkZvb05hbWU8L1ZhbHVlPlxyXG48L1R5cGVXaXRoWG1sUXVhbGlmaWVkTmFtZT4iLCBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5TdHJpY3RFcXVhbCh2YWx1ZS5WYWx1ZSwgYWN0dWFsLlZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLk5ldEZyYW1ld29yaywgImRvdG5ldC9jb3JlZnggIzE4OTY0IildDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Tb2FwX1R5cGVXaXRoWG1sUXVhbGlmaWVkTmFtZSgpDQogICAgew0KICAgICAgICB2YXIgbWFwcGluZyA9IG5ldyBTb2FwUmVmbGVjdGlvbkltcG9ydGVyKCkuSW1wb3J0VHlwZU1hcHBpbmcodHlwZW9mKFR5cGVXaXRoWG1sUXVhbGlmaWVkTmFtZSkpOw0KICAgICAgICB2YXIgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKG1hcHBpbmcpOw0KDQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFhtbFF1YWxpZmllZE5hbWUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBWYWx1ZSA9IG5ldyBYbWxRdWFsaWZpZWROYW1lKCJGb29OYW1lIikNCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoDQogICAgICAgICAgICB2YWx1ZSwNCiAgICAgICAgICAgICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48VHlwZVdpdGhYbWxRdWFsaWZpZWROYW1lIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBpZD1cImlkMVwiPlxyXG4gIDxWYWx1ZSB4bWxucz1cIlwiIHhzaTp0eXBlPVwieHNkOlFOYW1lXCI+Rm9vTmFtZTwvVmFsdWU+XHJcbjwvVHlwZVdpdGhYbWxRdWFsaWZpZWROYW1lPiIsDQogICAgICAgICAgICAoKSA9PiBzZXJpYWxpemVyKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuU3RyaWN0RXF1YWwodmFsdWUuVmFsdWUsIGFjdHVhbC5WYWx1ZSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aFNob3VsZFNlcmlhbGl6ZU1ldGhvZF9XaXRoRGVmYXVsdFZhbHVlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFNob3VsZFNlcmlhbGl6ZU1ldGhvZCgpOw0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48VHlwZVdpdGhTaG91bGRTZXJpYWxpemVNZXRob2QgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIC8+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkZvbywgYWN0dWFsLkZvbyk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aFNob3VsZFNlcmlhbGl6ZU1ldGhvZF9XaXRoTm9uRGVmYXVsdFZhbHVlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFNob3VsZFNlcmlhbGl6ZU1ldGhvZCgpIHsgRm9vID0gIlNvbWVWYWx1ZSIgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiPz5cclxuPFR5cGVXaXRoU2hvdWxkU2VyaWFsaXplTWV0aG9kIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj48Rm9vPlNvbWVWYWx1ZTwvRm9vPjwvVHlwZVdpdGhTaG91bGRTZXJpYWxpemVNZXRob2Q+Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkZvbywgYWN0dWFsLkZvbyk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Lbm93blR5cGVzVGhyb3VnaENvbnN0cnVjdG9yV2l0aEFycmF5UHJvcGVydGllcygpDQogICAgew0KICAgICAgICBpbnRbXSBpbnRBcnJheSA9IG5ldyBpbnRbXSB7IDEsIDIsIDMgfTsNCiAgICAgICAgc3RyaW5nW10gc3RyaW5nQXJyYXkgPSBuZXcgc3RyaW5nW10geyAiYSIsICJiIiB9Ow0KDQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBLbm93blR5cGVzVGhyb3VnaENvbnN0cnVjdG9yV2l0aEFycmF5UHJvcGVydGllcygpIHsgSW50QXJyYXlWYWx1ZSA9IGludEFycmF5LCBTdHJpbmdBcnJheVZhbHVlID0gc3RyaW5nQXJyYXkgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48S25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3RvcldpdGhBcnJheVByb3BlcnRpZXMgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDxTdHJpbmdBcnJheVZhbHVlIHhzaTp0eXBlPVwiQXJyYXlPZlN0cmluZ1wiPlxyXG4gICAgPHN0cmluZz5hPC9zdHJpbmc+XHJcbiAgICA8c3RyaW5nPmI8L3N0cmluZz5cclxuICA8L1N0cmluZ0FycmF5VmFsdWU+XHJcbiAgPEludEFycmF5VmFsdWUgeHNpOnR5cGU9XCJBcnJheU9mSW50XCI+XHJcbiAgICA8aW50PjE8L2ludD5cclxuICAgIDxpbnQ+MjwvaW50PlxyXG4gICAgPGludD4zPC9pbnQ+XHJcbiAgPC9JbnRBcnJheVZhbHVlPlxyXG48L0tub3duVHlwZXNUaHJvdWdoQ29uc3RydWN0b3JXaXRoQXJyYXlQcm9wZXJ0aWVzPiIsDQogICAgICAgICAgICAoKSA9PiB7IHJldHVybiBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoS25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3RvcldpdGhBcnJheVByb3BlcnRpZXMpLCBuZXcgVHlwZVtdIHsgdHlwZW9mKGludFtdKSwgdHlwZW9mKHN0cmluZ1tdKSB9KTsgfSwNCiAgICAgICAgICAgIHNraXBTdHJpbmdDb21wYXJlOiBmYWxzZSk7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCg0KICAgICAgICB2YXIgYWN0dWFsSW50QXJyYXkgPSAoaW50W10pYWN0dWFsLkludEFycmF5VmFsdWU7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbEludEFycmF5KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGludEFycmF5Lkxlbmd0aCwgYWN0dWFsSW50QXJyYXkuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoRW51bWVyYWJsZS5TZXF1ZW5jZUVxdWFsKGludEFycmF5LCBhY3R1YWxJbnRBcnJheSkpOw0KDQogICAgICAgIHZhciBhY3R1YWxTdHJpbmdBcnJheSA9IChzdHJpbmdbXSlhY3R1YWwuU3RyaW5nQXJyYXlWYWx1ZTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsU3RyaW5nQXJyYXkpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShFbnVtZXJhYmxlLlNlcXVlbmNlRXF1YWwoc3RyaW5nQXJyYXksIGFjdHVhbFN0cmluZ0FycmF5KSk7DQogICAgICAgIEFzc2VydC5FcXVhbChzdHJpbmdBcnJheS5MZW5ndGgsIGFjdHVhbFN0cmluZ0FycmF5Lkxlbmd0aCk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9Lbm93blR5cGVzVGhyb3VnaENvbnN0cnVjdG9yV2l0aEVudW1GbGFncygpDQogICAgew0KICAgICAgICB2YXIgZW51bUZsYWdzID0gRW51bUZsYWdzLk9uZSB8IEVudW1GbGFncy5Gb3VyOw0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgS25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3RvcldpdGhWYWx1ZSgpIHsgVmFsdWUgPSBlbnVtRmxhZ3MgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KICAgICAgICAgICAgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48S25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3RvcldpdGhWYWx1ZSB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCI+XHJcbiAgPFZhbHVlIHhzaTp0eXBlPVwiRW51bUZsYWdzXCI+T25lIEZvdXI8L1ZhbHVlPlxyXG48L0tub3duVHlwZXNUaHJvdWdoQ29uc3RydWN0b3JXaXRoVmFsdWU+IiwNCiAgICAgICAgICAgICgpID0+IHsgcmV0dXJuIG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihLbm93blR5cGVzVGhyb3VnaENvbnN0cnVjdG9yV2l0aFZhbHVlKSwgbmV3IFR5cGVbXSB7IHR5cGVvZihFbnVtRmxhZ3MpIH0pOyB9LA0KICAgICAgICAgICAgc2tpcFN0cmluZ0NvbXBhcmU6IGZhbHNlKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoKEVudW1GbGFncyl2YWx1ZS5WYWx1ZSwgKEVudW1GbGFncylhY3R1YWwuVmFsdWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfS25vd25UeXBlc1Rocm91Z2hDb25zdHJ1Y3RvcldpdGhFbnVtRmxhZ3NYbWxRdWFsaWZpZWROYW1lKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBLbm93blR5cGVzVGhyb3VnaENvbnN0cnVjdG9yV2l0aFZhbHVlKCkgeyBWYWx1ZSA9IG5ldyBYbWxRdWFsaWZpZWROYW1lKCJmb28iKSB9Ow0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+XHJcbjxLbm93blR5cGVzVGhyb3VnaENvbnN0cnVjdG9yV2l0aFZhbHVlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5cclxuICA8VmFsdWUgeHNpOnR5cGU9XCJ4c2Q6UU5hbWVcIj5mb288L1ZhbHVlPlxyXG48L0tub3duVHlwZXNUaHJvdWdoQ29uc3RydWN0b3JXaXRoVmFsdWU+IiwNCiAgICAgICAgICAgICgpID0+IHsgcmV0dXJuIG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihLbm93blR5cGVzVGhyb3VnaENvbnN0cnVjdG9yV2l0aFZhbHVlKSwgbmV3IFR5cGVbXSB7IHR5cGVvZihYbWxRdWFsaWZpZWROYW1lKSB9KTsgfSwNCiAgICAgICAgICAgIHNraXBTdHJpbmdDb21wYXJlOiBmYWxzZSk7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKChYbWxRdWFsaWZpZWROYW1lKXZhbHVlLlZhbHVlLCAoWG1sUXVhbGlmaWVkTmFtZSlhY3R1YWwuVmFsdWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHN0YXRpYyB2b2lkIFhtbF9UeXBlV2l0aFR5cGVzSGF2aW5nQ3VzdG9tRm9ybWF0dGVyKCkNCiAgICB7DQogICAgICAgIHZhciBzdHIgPSAiVGhlIHF1aWNrIGJyb3duIGZveCBqdW1wcyBvdmVyIHRoZSBsYXp5IGRvZy4iOw0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhUeXBlc0hhdmluZ0N1c3RvbUZvcm1hdHRlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIERhdGVUaW1lQ29udGVudCA9IG5ldyBEYXRlVGltZSgyMDE2LCA3LCAxOCwgMCwgMCwgMCwgRGF0ZVRpbWVLaW5kLlV0YyksDQogICAgICAgICAgICBRTmFtZUNvbnRlbnQgPSBuZXcgWG1sUXVhbGlmaWVkTmFtZSgiUU5hbWVDb250ZW50IiksDQogICAgICAgICAgICBEYXRlQ29udGVudCA9IG5ldyBEYXRlVGltZSgyMDE2LCA3LCAxOCwgMCwgMCwgMCwgRGF0ZVRpbWVLaW5kLlV0YyksDQogICAgICAgICAgICBOYW1lQ29udGVudCA9ICJOYW1lQ29udGVudCIsDQogICAgICAgICAgICBOQ05hbWVDb250ZW50ID0gIk5DTmFtZUNvbnRlbnQiLA0KICAgICAgICAgICAgTk1UT0tFTkNvbnRlbnQgPSAiTk1UT0tFTkNvbnRlbnQiLA0KICAgICAgICAgICAgTk1UT0tFTlNDb250ZW50ID0gIk5NVE9LRU5TQ29udGVudCIsDQogICAgICAgICAgICBCYXNlNjRCaW5hcnlDb250ZW50ID0gRW5jb2RpbmcuVW5pY29kZS5HZXRCeXRlcyhzdHIpLA0KICAgICAgICAgICAgSGV4QmluYXJ5Q29udGVudCA9IEVuY29kaW5nLlVuaWNvZGUuR2V0Qnl0ZXMoc3RyKSwNCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+XHJcbjxUeXBlV2l0aFR5cGVzSGF2aW5nQ3VzdG9tRm9ybWF0dGVyIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5cclxuICA8RGF0ZVRpbWVDb250ZW50PjIwMTYtMDctMThUMDA6MDA6MDBaPC9EYXRlVGltZUNvbnRlbnQ+XHJcbiAgPFFOYW1lQ29udGVudCB4bWxucz1cIlwiPlFOYW1lQ29udGVudDwvUU5hbWVDb250ZW50PlxyXG4gIDxEYXRlQ29udGVudD4yMDE2LTA3LTE4PC9EYXRlQ29udGVudD5cclxuICA8TmFtZUNvbnRlbnQ+TmFtZUNvbnRlbnQ8L05hbWVDb250ZW50PlxyXG4gIDxOQ05hbWVDb250ZW50Pk5DTmFtZUNvbnRlbnQ8L05DTmFtZUNvbnRlbnQ+XHJcbiAgPE5NVE9LRU5Db250ZW50Pk5NVE9LRU5Db250ZW50PC9OTVRPS0VOQ29udGVudD5cclxuICA8Tk1UT0tFTlNDb250ZW50Pk5NVE9LRU5TQ29udGVudDwvTk1UT0tFTlNDb250ZW50PlxyXG4gIDxCYXNlNjRCaW5hcnlDb250ZW50PlZBQm9BR1VBSUFCeEFIVUFhUUJqQUdzQUlBQmlBSElBYndCM0FHNEFJQUJtQUc4QWVBQWdBR29BZFFCdEFIQUFjd0FnQUc4QWRnQmxBSElBSUFCMEFHZ0FaUUFnQUd3QVlRQjZBSGtBSUFCa0FHOEFad0F1QUE9PTwvQmFzZTY0QmluYXJ5Q29udGVudD5cclxuICA8SGV4QmluYXJ5Q29udGVudD41NDAwNjgwMDY1MDAyMDAwNzEwMDc1MDA2OTAwNjMwMDZCMDAyMDAwNjIwMDcyMDA2RjAwNzcwMDZFMDAyMDAwNjYwMDZGMDA3ODAwMjAwMDZBMDA3NTAwNkQwMDcwMDA3MzAwMjAwMDZGMDA3NjAwNjUwMDcyMDAyMDAwNzQwMDY4MDA2NTAwMjAwMDZDMDA2MTAwN0EwMDc5MDAyMDAwNjQwMDZGMDA2NzAwMkUwMDwvSGV4QmluYXJ5Q29udGVudD5cclxuPC9UeXBlV2l0aFR5cGVzSGF2aW5nQ3VzdG9tRm9ybWF0dGVyPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5UcnVlKHZhbHVlLkRhdGVUaW1lQ29udGVudCA9PSBhY3R1YWwuRGF0ZVRpbWVDb250ZW50LCAkIkFjdHVhbCBEYXRlVGltZUNvbnRlbnQgd2FzIG5vdCBhcyBleHBlY3RlZC4gXHJcbiBFeHBlY3RlZDoge3ZhbHVlLkRhdGVUaW1lQ29udGVudH0gXHJcbiBBY3R1YWw6IHthY3R1YWwuRGF0ZVRpbWVDb250ZW50fSIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZSh2YWx1ZS5RTmFtZUNvbnRlbnQgPT0gYWN0dWFsLlFOYW1lQ29udGVudCwgJCJBY3R1YWwgUU5hbWVDb250ZW50IHdhcyBub3QgYXMgZXhwZWN0ZWQuIFxyXG4gRXhwZWN0ZWQ6IHt2YWx1ZS5RTmFtZUNvbnRlbnR9IFxyXG4gQWN0dWFsOiB7YWN0dWFsLlFOYW1lQ29udGVudH0iKTsNCiAgICAgICAgQXNzZXJ0LlRydWUodmFsdWUuRGF0ZUNvbnRlbnQgPT0gYWN0dWFsLkRhdGVDb250ZW50LCAkIkFjdHVhbCBEYXRlQ29udGVudCB3YXMgbm90IGFzIGV4cGVjdGVkLiBcclxuIEV4cGVjdGVkOiB7dmFsdWUuRGF0ZUNvbnRlbnR9IFxyXG4gQWN0dWFsOiB7YWN0dWFsLkRhdGVDb250ZW50fSIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZSh2YWx1ZS5OYW1lQ29udGVudCA9PSBhY3R1YWwuTmFtZUNvbnRlbnQsICQiQWN0dWFsIE5hbWVDb250ZW50IHdhcyBub3QgYXMgZXhwZWN0ZWQuIFxyXG4gRXhwZWN0ZWQ6IHt2YWx1ZS5OYW1lQ29udGVudH0gXHJcbiBBY3R1YWw6IHthY3R1YWwuTmFtZUNvbnRlbnR9Iik7DQogICAgICAgIEFzc2VydC5UcnVlKHZhbHVlLk5DTmFtZUNvbnRlbnQgPT0gYWN0dWFsLk5DTmFtZUNvbnRlbnQsICQiQWN0dWFsIE5DTmFtZUNvbnRlbnQgd2FzIG5vdCBhcyBleHBlY3RlZC4gXHJcbiBFeHBlY3RlZDoge3ZhbHVlLk5DTmFtZUNvbnRlbnR9IFxyXG4gQWN0dWFsOiB7YWN0dWFsLk5DTmFtZUNvbnRlbnR9Iik7DQogICAgICAgIEFzc2VydC5UcnVlKHZhbHVlLk5NVE9LRU5Db250ZW50ID09IGFjdHVhbC5OTVRPS0VOQ29udGVudCwgJCJBY3R1YWwgTk1UT0tFTkNvbnRlbnQgd2FzIG5vdCBhcyBleHBlY3RlZC4gXHJcbiBFeHBlY3RlZDoge3ZhbHVlLk5NVE9LRU5Db250ZW50fSBcclxuIEFjdHVhbDoge2FjdHVhbC5OTVRPS0VOQ29udGVudH0iKTsNCiAgICAgICAgQXNzZXJ0LlRydWUodmFsdWUuTk1UT0tFTlNDb250ZW50ID09IGFjdHVhbC5OTVRPS0VOU0NvbnRlbnQsICQiQWN0dWFsIE5NVE9LRU5TQ29udGVudCB3YXMgbm90IGFzIGV4cGVjdGVkLiBcclxuIEV4cGVjdGVkOiB7dmFsdWUuTk1UT0tFTlNDb250ZW50fSBcclxuIEFjdHVhbDoge2FjdHVhbC5OTVRPS0VOU0NvbnRlbnR9Iik7DQoNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsLkJhc2U2NEJpbmFyeUNvbnRlbnQpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShFbnVtZXJhYmxlLlNlcXVlbmNlRXF1YWwodmFsdWUuQmFzZTY0QmluYXJ5Q29udGVudCwgYWN0dWFsLkJhc2U2NEJpbmFyeUNvbnRlbnQpLCAiQWN0dWFsIEJhc2U2NEJpbmFyeUNvbnRlbnQgd2FzIG5vdCBhcyBleHBlY3RlZC4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwuSGV4QmluYXJ5Q29udGVudCk7DQogICAgICAgIEFzc2VydC5UcnVlKEVudW1lcmFibGUuU2VxdWVuY2VFcXVhbCh2YWx1ZS5IZXhCaW5hcnlDb250ZW50LCBhY3R1YWwuSGV4QmluYXJ5Q29udGVudCksICJBY3R1YWwgSGV4QmluYXJ5Q29udGVudCB3YXMgbm90IGFzIGV4cGVjdGVkLiIpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhBcnJheVByb3BlcnR5SGF2aW5nQ2hvaWNlKCkNCiAgICB7DQogICAgICAgIG9iamVjdFtdIGNob2ljZXMgPSBuZXcgb2JqZWN0W10geyAiRm9vZCIsIDUgfTsNCg0KICAgICAgICAvLyBGb3IgZWFjaCBpdGVtIGluIHRoZSBjaG9pY2VzIGFycmF5LCBhZGQgYW4NCiAgICAgICAgLy8gZW51bWVyYXRpb24gdmFsdWUuDQogICAgICAgIE1vcmVDaG9pY2VzW10gaXRlbUNob2ljZXMgPSBuZXcgTW9yZUNob2ljZXNbXSB7IE1vcmVDaG9pY2VzLkl0ZW0sIE1vcmVDaG9pY2VzLkFtb3VudCB9Ow0KDQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aEFycmF5UHJvcGVydHlIYXZpbmdDaG9pY2UoKSB7IE1hbnlDaG9pY2VzID0gY2hvaWNlcywgQ2hvaWNlQXJyYXkgPSBpdGVtQ2hvaWNlcyB9Ow0KDQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PlxyXG48VHlwZVdpdGhBcnJheVByb3BlcnR5SGF2aW5nQ2hvaWNlIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5cclxuICA8SXRlbT5Gb29kPC9JdGVtPlxyXG4gIDxBbW91bnQ+NTwvQW1vdW50PlxyXG48L1R5cGVXaXRoQXJyYXlQcm9wZXJ0eUhhdmluZ0Nob2ljZT4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwuTWFueUNob2ljZXMpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuTWFueUNob2ljZXMuTGVuZ3RoLCBhY3R1YWwuTWFueUNob2ljZXMuTGVuZ3RoKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoRW51bWVyYWJsZS5TZXF1ZW5jZUVxdWFsKHZhbHVlLk1hbnlDaG9pY2VzLCBhY3R1YWwuTWFueUNob2ljZXMpKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWE1MX1R5cGVXaXRoVHlwZU5hbWVJblhtbFR5cGVBdHRyaWJ1dGVfV2l0aFZhbHVlKCkNCiAgICB7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aFR5cGVOYW1lSW5YbWxUeXBlQXR0cmlidXRlKCkgeyBYbWxBdHRyaWJ1dGVGb3JtID0gIlNvbWVWYWx1ZSIgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQogICAgICAgICAgICAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+XHJcbjxNeVhtbFR5cGUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiIFhtbEF0dHJpYnV0ZUZvcm09XCJTb21lVmFsdWVcIiAvPiIsDQogICAgICAgICAgICBza2lwU3RyaW5nQ29tcGFyZTogZmFsc2UpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5YbWxBdHRyaWJ1dGVGb3JtLCBhY3R1YWwuWG1sQXR0cmlidXRlRm9ybSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhNTF9UeXBlV2l0aEZpZWxkc09yZGVyZWQoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFR5cGVXaXRoRmllbGRzT3JkZXJlZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEludEZpZWxkMSA9IDEsDQogICAgICAgICAgICBJbnRGaWVsZDIgPSAyLA0KICAgICAgICAgICAgU3RyaW5nRmllbGQxID0gImZvbzEiLA0KICAgICAgICAgICAgU3RyaW5nRmllbGQyID0gImZvbzIiDQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLCAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+XHJcbjxUeXBlV2l0aEZpZWxkc09yZGVyZWQgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDxJbnRGaWVsZDE+MTwvSW50RmllbGQxPlxyXG4gIDxJbnRGaWVsZDI+MjwvSW50RmllbGQyPlxyXG4gIDxTdHJpbmdGaWVsZDI+Zm9vMjwvU3RyaW5nRmllbGQyPlxyXG4gIDxTdHJpbmdGaWVsZDE+Zm9vMTwvU3RyaW5nRmllbGQxPlxyXG48L1R5cGVXaXRoRmllbGRzT3JkZXJlZD4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuSW50RmllbGQxLCBhY3R1YWwuSW50RmllbGQxKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkludEZpZWxkMiwgYWN0dWFsLkludEZpZWxkMik7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TdHJpbmdGaWVsZDEsIGFjdHVhbC5TdHJpbmdGaWVsZDEpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuU3RyaW5nRmllbGQyLCBhY3R1YWwuU3RyaW5nRmllbGQyKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sU2VyaWFsaXplckZhY3RvcnlUZXN0KCkNCiAgICB7DQogICAgICAgIHN0cmluZyBiYXNlbGluZSA9ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48RG9nIHhtbG5zOnhzaT1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIj5cclxuICA8QWdlPjU8L0FnZT5cclxuICA8TmFtZT5CZWFyPC9OYW1lPlxyXG4gIDxCcmVlZD5HZXJtYW5TaGVwaGVyZDwvQnJlZWQ+XHJcbjwvRG9nPiI7DQogICAgICAgIHZhciB4c2YgPSBuZXcgWG1sU2VyaWFsaXplckZhY3RvcnkoKTsNCiAgICAgICAgRnVuYzxYbWxTZXJpYWxpemVyPiBzZXJpYWxpemVyZnVuYyA9ICgpID0+IHhzZi5DcmVhdGVTZXJpYWxpemVyKHR5cGVvZihEb2cpKTsNCiAgICAgICAgdmFyIGRvZzEgPSBuZXcgRG9nKCkgeyBOYW1lID0gIkJlYXIiLCBBZ2UgPSA1LCBCcmVlZCA9IERvZ0JyZWVkLkdlcm1hblNoZXBoZXJkIH07DQogICAgICAgIHZhciBkb2cyID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoZG9nMSwgYmFzZWxpbmUsIHNlcmlhbGl6ZXJmdW5jKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGRvZzEuTmFtZSwgZG9nMi5OYW1lKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGRvZzEuQWdlLCBkb2cyLkFnZSk7DQogICAgICAgIEFzc2VydC5FcXVhbChkb2cxLkJyZWVkLCBkb2cyLkJyZWVkKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sVW5rbm93bkVsZW1lbnRBbmRFdmVudEhhbmRsZXJUZXN0KCkNCiAgICB7DQogICAgICAgIExpc3Q8c3RyaW5nPiBncm91cGxpc3RzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICBpbnQgY291bnQgPSAwOw0KICAgICAgICBYbWxTZXJpYWxpemVyIHNlcmlhbGl6ZXIgPSBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoR3JvdXApKTsNCiAgICAgICAgc2VyaWFsaXplci5Vbmtub3duRWxlbWVudCArPSBuZXcgWG1sRWxlbWVudEV2ZW50SGFuZGxlcigobywgYXJncykgPT4NCiAgICAgICAgew0KICAgICAgICAgICAgR3JvdXAgbXlHcm91cCA9IChHcm91cClhcmdzLk9iamVjdEJlaW5nRGVzZXJpYWxpemVkOw0KICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwobXlHcm91cCk7DQogICAgICAgICAgICBncm91cGxpc3RzLkFkZChhcmdzLkVsZW1lbnQuTmFtZSk7DQogICAgICAgICAgICArK2NvdW50Ow0KICAgICAgICB9KTsNCiAgICAgICAgc3RyaW5nIHhtbEZpbGVDb250ZW50ID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz4NCiAgPEdyb3VwIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkID0gIiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICAgICAgICAgPEdyb3VwTmFtZT5NeUdyb3VwPC9Hcm91cE5hbWU+DQogICAgICAgICA8R3JvdXBTaXplPkxhcmdlPC9Hcm91cFNpemU+DQogICAgICAgICA8R3JvdXBOdW1iZXI+NDQ0PC9Hcm91cE51bWJlcj4NCiAgICAgICAgIDxHcm91cEJhc2U+V2VzdDwvR3JvdXBCYXNlPg0KICAgICAgIDwvR3JvdXAgPiI7DQogICAgICAgIEdyb3VwIGdyb3VwID0gKEdyb3VwKXNlcmlhbGl6ZXIuRGVzZXJpYWxpemUoR2V0U3RyZWFtRnJvbVN0cmluZyh4bWxGaWxlQ29udGVudCkpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChncm91cCk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGdyb3VwLkdyb3VwTmFtZSk7DQogICAgICAgIEFzc2VydC5OdWxsKGdyb3VwLkdyb3VwVmVoaWNsZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCgzLCBjb3VudCk7DQogICAgICAgIEFzc2VydC5FcXVhbCgzLCBncm91cGxpc3RzLkNvdW50KCkpOw0KICAgICAgICBib29sIGIgPSBncm91cGxpc3RzLkNvbnRhaW5zKCJHcm91cFNpemUiKSAmJiBncm91cGxpc3RzLkNvbnRhaW5zKCJHcm91cE51bWJlciIpICYmIGdyb3VwbGlzdHMuQ29udGFpbnMoIkdyb3VwQmFzZSIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShiKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sVW5rbm93bk5vZGVBbmRFdmVudEhhbmRsZXJUZXN0KCkNCiAgICB7DQogICAgICAgIExpc3Q8c3RyaW5nPiBncm91cGxpc3RzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICBpbnQgY291bnQgPSAwOw0KICAgICAgICBYbWxTZXJpYWxpemVyIHNlcmlhbGl6ZXIgPSBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoR3JvdXApKTsNCiAgICAgICAgc2VyaWFsaXplci5Vbmtub3duTm9kZSArPSBuZXcgWG1sTm9kZUV2ZW50SGFuZGxlcigobywgYXJncykgPT4NCiAgICAgICAgew0KICAgICAgICAgICAgR3JvdXAgbXlHcm91cCA9IChHcm91cClhcmdzLk9iamVjdEJlaW5nRGVzZXJpYWxpemVkOw0KICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwobXlHcm91cCk7DQogICAgICAgICAgICBncm91cGxpc3RzLkFkZChhcmdzLkxvY2FsTmFtZSk7DQogICAgICAgICAgICArK2NvdW50Ow0KICAgICAgICB9KTsNCiAgICAgICAgc3RyaW5nIHhtbEZpbGVDb250ZW50ID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz4NCiAgPEdyb3VwIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIiB4bWxuczpjb2hvPSIiaHR0cDovL3d3dy5jb2hvd2luZXJ5LmNvbSIiIHhtbG5zOmNwPSIiaHR0cDovL3d3dy5jcGFuZGwuY29tIiI+DQogICAgICAgICAgICAgIDxjb2hvOkdyb3VwTmFtZT5NeUdyb3VwPC9jb2hvOkdyb3VwTmFtZT4NCiAgICAgICAgICAgICAgPGNwOkdyb3VwU2l6ZT5MYXJnZTwvY3A6R3JvdXBTaXplPg0KICAgICAgICAgICAgICA8Y3A6R3JvdXBOdW1iZXI+NDQ0PC9jcDpHcm91cE51bWJlcj4NCiAgICAgICAgICAgICAgPGNvaG86R3JvdXBCYXNlPldlc3Q8L2NvaG86R3JvdXBCYXNlPg0KICAgICAgICAgICAgICA8Y29obzpUaGluZ0luZm8+DQogICAgICAgICAgICAgICAgICAgIDxOdW1iZXI+MTwvTnVtYmVyPg0KICAgICAgICAgICAgICAgICAgICA8TmFtZT5UaGluZzE8L05hbWU+DQogICAgICAgICAgICAgICAgICAgIDxFbG1vPg0KICAgICAgICAgICAgICAgICAgICAgICAgPEdsdWU+ZWxlbWVudDwvR2x1ZT4NCiAgICAgICAgICAgICAgICAgICAgPC9FbG1vPg0KICAgICAgICAgICAgICA8L2NvaG86VGhpbmdJbmZvPg0KICA8L0dyb3VwPiI7DQogICAgICAgIEdyb3VwIGdyb3VwID0gKEdyb3VwKXNlcmlhbGl6ZXIuRGVzZXJpYWxpemUoR2V0U3RyZWFtRnJvbVN0cmluZyh4bWxGaWxlQ29udGVudCkpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChncm91cCk7DQogICAgICAgIEFzc2VydC5OdWxsKGdyb3VwLkdyb3VwTmFtZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCg1LCBjb3VudCk7DQogICAgICAgIEFzc2VydC5FcXVhbCg1LCBncm91cGxpc3RzLkNvdW50KCkpOw0KICAgICAgICBib29sIGIgPSBncm91cGxpc3RzLkNvbnRhaW5zKCJHcm91cE5hbWUiKSAmJiBncm91cGxpc3RzLkNvbnRhaW5zKCJHcm91cFNpemUiKSAmJiBncm91cGxpc3RzLkNvbnRhaW5zKCJHcm91cE51bWJlciIpICYmIGdyb3VwbGlzdHMuQ29udGFpbnMoIkdyb3VwQmFzZSIpICYmIGdyb3VwbGlzdHMuQ29udGFpbnMoIlRoaW5nSW5mbyIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShiKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sVW5rbm93bkF0dHJpYnV0ZUFuZEV2ZW50SGFuZGxlclRlc3QoKQ0KICAgIHsNCiAgICAgICAgTGlzdDxzdHJpbmc+IGdyb3VwbGlzdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgIGludCBjb3VudCA9IDA7DQogICAgICAgIFhtbFNlcmlhbGl6ZXIgc2VyaWFsaXplciA9IG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihHcm91cCkpOw0KICAgICAgICBzZXJpYWxpemVyLlVua25vd25BdHRyaWJ1dGUgKz0gbmV3IFhtbEF0dHJpYnV0ZUV2ZW50SGFuZGxlcigobywgYXJncykgPT4NCiAgICAgICAgew0KICAgICAgICAgICAgR3JvdXAgbXlHcm91cCA9IChHcm91cClhcmdzLk9iamVjdEJlaW5nRGVzZXJpYWxpemVkOw0KICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwobXlHcm91cCk7DQogICAgICAgICAgICBncm91cGxpc3RzLkFkZChhcmdzLkF0dHIuTG9jYWxOYW1lKTsNCiAgICAgICAgICAgICsrY291bnQ7DQogICAgICAgIH0pOw0KICAgICAgICBzdHJpbmcgeG1sRmlsZUNvbnRlbnQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/Pg0KICAgPEdyb3VwIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIiBHcm91cFR5cGU9J1RlY2huaWNhbCcgR3JvdXBOdW1iZXI9JzQyJyBHcm91cEJhc2U9J1JlZCc+DQogICAgICAgICAgIDxHcm91cE5hbWU+TXlHcm91cDwvR3JvdXBOYW1lPg0KICAgICAgICAgPC9Hcm91cD4iOw0KICAgICAgICBHcm91cCBncm91cCA9IChHcm91cClzZXJpYWxpemVyLkRlc2VyaWFsaXplKEdldFN0cmVhbUZyb21TdHJpbmcoeG1sRmlsZUNvbnRlbnQpKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoZ3JvdXApOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChncm91cC5Hcm91cE5hbWUpOw0KICAgICAgICBBc3NlcnQuTnVsbChncm91cC5Hcm91cFZlaGljbGUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoMywgY291bnQpOw0KICAgICAgICBBc3NlcnQuRXF1YWwoMywgZ3JvdXBsaXN0cy5Db3VudCgpKTsNCiAgICAgICAgYm9vbCBiID0gZ3JvdXBsaXN0cy5Db250YWlucygiR3JvdXBUeXBlIikgJiYgZ3JvdXBsaXN0cy5Db250YWlucygiR3JvdXBOdW1iZXIiKSAmJiBncm91cGxpc3RzLkNvbnRhaW5zKCJHcm91cEJhc2UiKTsNCiAgICAgICAgQXNzZXJ0LlRydWUoYik7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbERlc2VyaWFsaXphdGlvbkV2ZW50c1Rlc3QoKQ0KICAgIHsNCiAgICAgICAgTGlzdDxzdHJpbmc+IGdyb3VwbGlzdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgIGludCBjb3VudCA9IDA7DQogICAgICAgIC8vIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiB0aGUgWG1sU2VyaWFsaXplciBjbGFzcy4NCiAgICAgICAgWG1sU2VyaWFsaXplciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKEdyb3VwKSk7DQogICAgICAgIFhtbERlc2VyaWFsaXphdGlvbkV2ZW50cyBldmVudHMgPSBuZXcgWG1sRGVzZXJpYWxpemF0aW9uRXZlbnRzKCk7DQogICAgICAgIGV2ZW50cy5PblVua25vd25BdHRyaWJ1dGUgKz0gbmV3IFhtbEF0dHJpYnV0ZUV2ZW50SGFuZGxlcigobywgYXJncykgPT4NCiAgICAgICAgew0KICAgICAgICAgICAgR3JvdXAgbXlHcm91cCA9IChHcm91cClhcmdzLk9iamVjdEJlaW5nRGVzZXJpYWxpemVkOw0KICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwobXlHcm91cCk7DQogICAgICAgICAgICBncm91cGxpc3RzLkFkZChhcmdzLkF0dHIuTG9jYWxOYW1lKTsNCiAgICAgICAgICAgICsrY291bnQ7DQogICAgICAgIH0pOw0KICAgICAgICBzdHJpbmcgeG1sRmlsZUNvbnRlbnQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/Pg0KICAgPEdyb3VwIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIiBHcm91cFR5cGU9J1RlY2huaWNhbCcgR3JvdXBOdW1iZXI9JzQyJyBHcm91cEJhc2U9J1JlZCc+DQogICAgICAgICAgIDxHcm91cE5hbWU+TXlHcm91cDwvR3JvdXBOYW1lPg0KICAgICAgICAgPC9Hcm91cD4iOw0KICAgICAgICBHcm91cCBncm91cCA9IChHcm91cClzZXJpYWxpemVyLkRlc2VyaWFsaXplKFhtbFJlYWRlci5DcmVhdGUoR2V0U3RyZWFtRnJvbVN0cmluZyh4bWxGaWxlQ29udGVudCkpLCBldmVudHMpOw0KICAgICAgICBBc3NlcnQuTm90TnVsbChncm91cCk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGdyb3VwLkdyb3VwTmFtZSk7DQogICAgICAgIEFzc2VydC5OdWxsKGdyb3VwLkdyb3VwVmVoaWNsZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCgzLCBjb3VudCk7DQogICAgICAgIEFzc2VydC5FcXVhbCgzLCBncm91cGxpc3RzLkNvdW50KCkpOw0KICAgICAgICBib29sIGIgPSBncm91cGxpc3RzLkNvbnRhaW5zKCJHcm91cFR5cGUiKSAmJiBncm91cGxpc3RzLkNvbnRhaW5zKCJHcm91cE51bWJlciIpICYmIGdyb3VwbGlzdHMuQ29udGFpbnMoIkdyb3VwQmFzZSIpOw0KICAgICAgICBBc3NlcnQuVHJ1ZShiKTsNCiAgICB9DQogICAgcHJpdmF0ZSBzdGF0aWMgU3RyZWFtIEdldFN0cmVhbUZyb21TdHJpbmcoc3RyaW5nIHMpDQogICAgew0KICAgICAgICBNZW1vcnlTdHJlYW0gc3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpOw0KICAgICAgICBTdHJlYW1Xcml0ZXIgd3JpdGVyID0gbmV3IFN0cmVhbVdyaXRlcihzdHJlYW0pOw0KICAgICAgICB3cml0ZXIuV3JpdGUocyk7DQogICAgICAgIHdyaXRlci5GbHVzaCgpOw0KICAgICAgICBzdHJlYW0uUG9zaXRpb24gPSAwOw0KICAgICAgICByZXR1cm4gc3RyZWFtOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxTZXJpYWxpemVySW1wbGVtZW50YXRpb25UZXN0KCkNCiAgICB7DQogICAgICAgIEVtcGxveWVlIGVtcCA9IG5ldyBFbXBsb3llZSgpIHsgRW1wbG95ZWVOYW1lID0gIkFsbGljZSIgfTsNCiAgICAgICAgU2VyaWFsaXplSW0gc20gPSBuZXcgU2VyaWFsaXplSW0oKTsNCiAgICAgICAgRnVuYzxYbWxTZXJpYWxpemVyPiBzZXJpYWxpemVyZnVuYyA9ICgpID0+IHNtLkdldFNlcmlhbGl6ZXIodHlwZW9mKEVtcGxveWVlKSk7DQogICAgICAgIHN0cmluZyBleHBlY3RlZCA9ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PlxyXG48RW1wbG95ZWUgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPlxyXG4gIDxFbXBsb3llZU5hbWU+QWxsaWNlPC9FbXBsb3llZU5hbWU+XHJcbjwvRW1wbG95ZWU+IjsNCiAgICAgICAgU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoZW1wLCBleHBlY3RlZCwgc2VyaWFsaXplcmZ1bmMpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfSGlkZGVuRGVyaXZlZEZpZWxkVGVzdCgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgRGVyaXZlZENsYXNzIHsgdmFsdWUgPSAib24gZGVyaXZlZCIgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplPEJhc2VDbGFzcz4odmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8QmFzZUNsYXNzIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4c2k6dHlwZT0iIkRlcml2ZWRDbGFzcyIiPg0KICA8dmFsdWU+b24gZGVyaXZlZDwvdmFsdWU+DQo8L0Jhc2VDbGFzcz4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuTnVsbChhY3R1YWwuVmFsdWUpOw0KICAgICAgICBBc3NlcnQuTnVsbChhY3R1YWwudmFsdWUpOw0KICAgICAgICBBc3NlcnQuTnVsbCgoKERlcml2ZWRDbGFzcylhY3R1YWwpLlZhbHVlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLnZhbHVlLCAoKERlcml2ZWRDbGFzcylhY3R1YWwpLnZhbHVlKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX051bGxSZWZJblhtbFNlcmlhbGl6ZXJDdG9yVGVzdCgpDQogICAgew0KICAgICAgICBzdHJpbmcgZGVmYXVsdE5hbWVzcGFjZSA9ICJodHRwOi8vd3d3LmNvbnRvc28uY29tIjsNCiAgICAgICAgdmFyIHZhbHVlID0gUHVyY2hhc2VPcmRlci5DcmVhdGVJbnN0YW5jZSgpOw0KICAgICAgICBzdHJpbmcgYmFzZWxpbmUgPQ0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPFB1cmNoYXNlT3JkZXIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIiB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiIHhtbG5zPSIiaHR0cDovL3d3dy5jb250b3NvMS5jb20iIj4NCiAgPFNoaXBUbyBOYW1lPSIiSm9obiBEb2UiIj4NCiAgICA8TGluZTE+MSBNYWluIFN0LjwvTGluZTE+DQogICAgPENpdHk+QW55VG93bjwvQ2l0eT4NCiAgICA8U3RhdGU+V0E8L1N0YXRlPg0KICAgIDxaaXA+MDAwMDA8L1ppcD4NCiAgPC9TaGlwVG8+DQogIDxPcmRlckRhdGU+TW9uZGF5LCAxMCBBcHJpbCAyMDE3PC9PcmRlckRhdGU+DQogIDxJdGVtcz4NCiAgICA8T3JkZXJlZEl0ZW0+DQogICAgICA8SXRlbU5hbWU+V2lkZ2V0IFM8L0l0ZW1OYW1lPg0KICAgICAgPERlc2NyaXB0aW9uPlNtYWxsIHdpZGdldDwvRGVzY3JpcHRpb24+DQogICAgICA8VW5pdFByaWNlPjUuMjM8L1VuaXRQcmljZT4NCiAgICAgIDxRdWFudGl0eT4zPC9RdWFudGl0eT4NCiAgICAgIDxMaW5lVG90YWw+MTUuNjk8L0xpbmVUb3RhbD4NCiAgICA8L09yZGVyZWRJdGVtPg0KICA8L0l0ZW1zPg0KICA8U3ViVG90YWw+MTUuNjk8L1N1YlRvdGFsPg0KICA8U2hpcENvc3Q+MTIuNTE8L1NoaXBDb3N0Pg0KICA8VG90YWxDb3N0PjI4LjIwPC9Ub3RhbENvc3Q+DQo8L1B1cmNoYXNlT3JkZXI+IjsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQogICAgICAgICAgICBiYXNlbGluZSwNCiAgICAgICAgICAgICgpID0+IG5ldyBYbWxTZXJpYWxpemVyKHZhbHVlLkdldFR5cGUoKSwgbnVsbCwgbnVsbCwgbnVsbCwgZGVmYXVsdE5hbWVzcGFjZSkNCiAgICAgICAgICAgICk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5PcmRlckRhdGUsIGFjdHVhbC5PcmRlckRhdGUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuU2hpcENvc3QsIGFjdHVhbC5TaGlwQ29zdCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TdWJUb3RhbCwgYWN0dWFsLlN1YlRvdGFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlRvdGFsQ29zdCwgYWN0dWFsLlRvdGFsQ29zdCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TaGlwVG8uQ2l0eSwgYWN0dWFsLlNoaXBUby5DaXR5KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlNoaXBUby5MaW5lMSwgYWN0dWFsLlNoaXBUby5MaW5lMSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TaGlwVG8uTmFtZSwgYWN0dWFsLlNoaXBUby5OYW1lKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlNoaXBUby5TdGF0ZSwgYWN0dWFsLlNoaXBUby5TdGF0ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TaGlwVG8uWmlwLCBhY3R1YWwuU2hpcFRvLlppcCk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5PcmRlcmVkSXRlbXMuTGVuZ3RoLCBhY3R1YWwuT3JkZXJlZEl0ZW1zLkxlbmd0aCk7DQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdmFsdWUuT3JkZXJlZEl0ZW1zLkxlbmd0aDsgaSsrKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuT3JkZXJlZEl0ZW1zLkVsZW1lbnRBdChpKS5EZXNjcmlwdGlvbiwgYWN0dWFsLk9yZGVyZWRJdGVtcy5FbGVtZW50QXQoaSkuRGVzY3JpcHRpb24pOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLk9yZGVyZWRJdGVtcy5FbGVtZW50QXQoaSkuSXRlbU5hbWUsIGFjdHVhbC5PcmRlcmVkSXRlbXMuRWxlbWVudEF0KGkpLkl0ZW1OYW1lKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5PcmRlcmVkSXRlbXMuRWxlbWVudEF0KGkpLkxpbmVUb3RhbCwgYWN0dWFsLk9yZGVyZWRJdGVtcy5FbGVtZW50QXQoaSkuTGluZVRvdGFsKTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5PcmRlcmVkSXRlbXMuRWxlbWVudEF0KGkpLlF1YW50aXR5LCBhY3R1YWwuT3JkZXJlZEl0ZW1zLkVsZW1lbnRBdChpKS5RdWFudGl0eSk7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuT3JkZXJlZEl0ZW1zLkVsZW1lbnRBdChpKS5Vbml0UHJpY2UsIGFjdHVhbC5PcmRlcmVkSXRlbXMuRWxlbWVudEF0KGkpLlVuaXRQcmljZSk7DQogICAgICAgIH0NCg0KICAgICAgICBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwNCiAgICAgICAgICAgIGJhc2VsaW5lLA0KICAgICAgICAgICAgKCkgPT4gbmV3IFhtbFNlcmlhbGl6ZXIodmFsdWUuR2V0VHlwZSgpLCBudWxsLCBudWxsLCBudWxsLCBkZWZhdWx0TmFtZXNwYWNlLCBudWxsKQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLk9yZGVyRGF0ZSwgYWN0dWFsLk9yZGVyRGF0ZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5TaGlwQ29zdCwgYWN0dWFsLlNoaXBDb3N0KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlN1YlRvdGFsLCBhY3R1YWwuU3ViVG90YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuVG90YWxDb3N0LCBhY3R1YWwuVG90YWxDb3N0KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlNoaXBUby5DaXR5LCBhY3R1YWwuU2hpcFRvLkNpdHkpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuU2hpcFRvLkxpbmUxLCBhY3R1YWwuU2hpcFRvLkxpbmUxKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlNoaXBUby5OYW1lLCBhY3R1YWwuU2hpcFRvLk5hbWUpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuU2hpcFRvLlN0YXRlLCBhY3R1YWwuU2hpcFRvLlN0YXRlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLlNoaXBUby5aaXAsIGFjdHVhbC5TaGlwVG8uWmlwKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLk9yZGVyZWRJdGVtcy5MZW5ndGgsIGFjdHVhbC5PcmRlcmVkSXRlbXMuTGVuZ3RoKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB2YWx1ZS5PcmRlcmVkSXRlbXMuTGVuZ3RoOyBpKyspDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5PcmRlcmVkSXRlbXMuRWxlbWVudEF0KGkpLkRlc2NyaXB0aW9uLCBhY3R1YWwuT3JkZXJlZEl0ZW1zLkVsZW1lbnRBdChpKS5EZXNjcmlwdGlvbik7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuT3JkZXJlZEl0ZW1zLkVsZW1lbnRBdChpKS5JdGVtTmFtZSwgYWN0dWFsLk9yZGVyZWRJdGVtcy5FbGVtZW50QXQoaSkuSXRlbU5hbWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLk9yZGVyZWRJdGVtcy5FbGVtZW50QXQoaSkuTGluZVRvdGFsLCBhY3R1YWwuT3JkZXJlZEl0ZW1zLkVsZW1lbnRBdChpKS5MaW5lVG90YWwpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLk9yZGVyZWRJdGVtcy5FbGVtZW50QXQoaSkuUXVhbnRpdHksIGFjdHVhbC5PcmRlcmVkSXRlbXMuRWxlbWVudEF0KGkpLlF1YW50aXR5KTsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5PcmRlcmVkSXRlbXMuRWxlbWVudEF0KGkpLlVuaXRQcmljZSwgYWN0dWFsLk9yZGVyZWRJdGVtcy5FbGVtZW50QXQoaSkuVW5pdFByaWNlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfQWxpYXNlZFByb3BlcnR5VGVzdCgpDQogICAgew0KICAgICAgICB2YXIgaW5wdXRMaXN0ID0gbmV3IExpc3Q8c3RyaW5nPiB7ICJpdGVtMCIsICJpdGVtMSIsICJpdGVtMiIsICJpdGVtMyIsICJpdGVtNCIgfTsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IEFsaWFzZWRUZXN0VHlwZSB7IEFsaWFzZWQgPSBpbnB1dExpc3QgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKHZhbHVlLA0KQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiI/Pg0KPEFsaWFzZWRUZXN0VHlwZSB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiI+DQogIDxZPg0KICAgIDxzdHJpbmc+aXRlbTA8L3N0cmluZz4NCiAgICA8c3RyaW5nPml0ZW0xPC9zdHJpbmc+DQogICAgPHN0cmluZz5pdGVtMjwvc3RyaW5nPg0KICAgIDxzdHJpbmc+aXRlbTM8L3N0cmluZz4NCiAgICA8c3RyaW5nPml0ZW00PC9zdHJpbmc+DQogIDwvWT4NCjwvQWxpYXNlZFRlc3RUeXBlPiIpOw0KDQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbC5BbGlhc2VkKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGlucHV0TGlzdC5HZXRUeXBlKCksIGFjdHVhbC5BbGlhc2VkLkdldFR5cGUoKSk7DQogICAgICAgIEFzc2VydC5FcXVhbChpbnB1dExpc3QuQ291bnQsICgoTGlzdDxzdHJpbmc+KWFjdHVhbC5BbGlhc2VkKS5Db3VudCk7DQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW5wdXRMaXN0LkNvdW50OyBpKyspDQogICAgICAgIHsNCiAgICAgICAgICAgIEFzc2VydC5FcXVhbChpbnB1dExpc3RbaV0sICgoTGlzdDxzdHJpbmc+KWFjdHVhbC5BbGlhc2VkKS5FbGVtZW50QXQoaSkpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgcHVibGljIHN0YXRpYyB2b2lkIFhtbF9EZXNlcmlhbGl6ZUhpZGRlbk1lbWJlcnNUZXN0KCkNCiAgICB7DQogICAgICAgIHZhciB4bWxTZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKERlcml2ZWRDbGFzczEpKTsNCiAgICAgICAgc3RyaW5nIGlucHV0WG1sID0gIjxEZXJpdmVkQ2xhc3MxPjxQcm9wPjIwMTItMDctMDdUMDA6MTg6MjkuNzUzODYxMlo8L1Byb3A+PC9EZXJpdmVkQ2xhc3MxPiI7DQogICAgICAgIHZhciBkYXRlVGltZSA9IG5ldyBEYXRlVGltZSg2MzQ3NzIxNzEwOTc1Mzg2MTIpOw0KDQogICAgICAgIHVzaW5nICh2YXIgcmVhZGVyID0gbmV3IFN0cmluZ1JlYWRlcihpbnB1dFhtbCkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBkZXJpdmVkQ2xhc3NJbnN0YW5jZSA9IChEZXJpdmVkQ2xhc3MxKXhtbFNlcmlhbGl6ZXIuRGVzZXJpYWxpemUocmVhZGVyKTsNCiAgICAgICAgICAgIEFzc2VydC5Ob3ROdWxsKGRlcml2ZWRDbGFzc0luc3RhbmNlLlByb3ApOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKDEsIGRlcml2ZWRDbGFzc0luc3RhbmNlLlByb3AuQ291bnQ8RGF0ZVRpbWU+KCkpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKGRhdGVUaW1lLCBkZXJpdmVkQ2xhc3NJbnN0YW5jZS5Qcm9wLkVsZW1lbnRBdCgwKSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX1NlcmlhbGl6ZUNsYXNzTmVzdGVkSW5TdGF0aWNDbGFzc1Rlc3QoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IE91dGVyLlBlcnNvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIEZpcnN0TmFtZSA9ICJIYXJyeSIsDQogICAgICAgICAgICBNaWRkbGVOYW1lID0gIkphbWVzIiwNCiAgICAgICAgICAgIExhc3ROYW1lID0gIlBvdHRlciINCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUodmFsdWUsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8UGVyc29uIHhtbG5zOnhzZD0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiIgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIj4NCiAgPEZpcnN0TmFtZT5IYXJyeTwvRmlyc3ROYW1lPg0KICA8TWlkZGxlTmFtZT5KYW1lczwvTWlkZGxlTmFtZT4NCiAgPExhc3ROYW1lPlBvdHRlcjwvTGFzdE5hbWU+DQo8L1BlcnNvbj4iKTsNCg0KICAgICAgICBBc3NlcnQuTm90TnVsbChhY3R1YWwpOw0KICAgICAgICBBc3NlcnQuRXF1YWwodmFsdWUuRmlyc3ROYW1lLCBhY3R1YWwuRmlyc3ROYW1lKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLk1pZGRsZU5hbWUsIGFjdHVhbC5NaWRkbGVOYW1lKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkxhc3ROYW1lLCBhY3R1YWwuTGFzdE5hbWUpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfWFNDb3ZlclRlc3QoKQ0KICAgIHsNCiAgICAgICAgdmFyIGJhbmQgPSBuZXcgT3JjaGVzdHJhKCk7DQogICAgICAgIHZhciBicmFzcyA9IG5ldyBCcmFzcygpDQogICAgICAgIHsNCiAgICAgICAgICAgIE5hbWUgPSAiVHJ1bXBldCIsDQogICAgICAgICAgICBJc1ZhbHZlZCA9IHRydWUNCiAgICAgICAgfTsNCiAgICAgICAgSW5zdHJ1bWVudFtdIG15SW5zdHJ1bWVudHMgPSB7IGJyYXNzIH07DQogICAgICAgIGJhbmQuSW5zdHJ1bWVudHMgPSBteUluc3RydW1lbnRzOw0KDQogICAgICAgIHZhciBhdHRycyA9IG5ldyBYbWxBdHRyaWJ1dGVzKCk7DQogICAgICAgIHZhciBhdHRyID0gbmV3IFhtbEVsZW1lbnRBdHRyaWJ1dGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBFbGVtZW50TmFtZSA9ICJCcmFzcyIsDQogICAgICAgICAgICBUeXBlID0gdHlwZW9mKEJyYXNzKQ0KICAgICAgICB9Ow0KDQogICAgICAgIGF0dHJzLlhtbEVsZW1lbnRzLkFkZChhdHRyKTsNCiAgICAgICAgdmFyIGF0dHJPdmVycmlkZXMgPSBuZXcgWG1sQXR0cmlidXRlT3ZlcnJpZGVzKCk7DQogICAgICAgIGF0dHJPdmVycmlkZXMuQWRkKHR5cGVvZihPcmNoZXN0cmEpLCAiSW5zdHJ1bWVudHMiLCBhdHRycyk7DQoNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKGJhbmQsDQpAIjxPcmNoZXN0cmEgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICAgIDxCcmFzcz4NCiAgICAgIDxOYW1lPlRydW1wZXQ8L05hbWU+DQogICAgICA8SXNWYWx2ZWQ+dHJ1ZTwvSXNWYWx2ZWQ+DQogICAgPC9CcmFzcz4NCjwvT3JjaGVzdHJhPiIsICgpID0+IHsgcmV0dXJuIG5ldyBYbWxTZXJpYWxpemVyKHR5cGVvZihPcmNoZXN0cmEpLCBhdHRyT3ZlcnJpZGVzKTsgfSk7DQoNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGJhbmQuSW5zdHJ1bWVudHMuTGVuZ3RoLCBhY3R1YWwuSW5zdHJ1bWVudHMuTGVuZ3RoKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYW5kLkluc3RydW1lbnRzLkxlbmd0aDsgaSsrKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoKChCcmFzcyliYW5kLkluc3RydW1lbnRzLkVsZW1lbnRBdChpKSkuTmFtZSwgKChCcmFzcylhY3R1YWwuSW5zdHJ1bWVudHNbaV0pLk5hbWUpOw0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCgoQnJhc3MpYmFuZC5JbnN0cnVtZW50cy5FbGVtZW50QXQoaSkpLklzVmFsdmVkLCAoKEJyYXNzKWFjdHVhbC5JbnN0cnVtZW50c1tpXSkuSXNWYWx2ZWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgYmFuZCA9IG5ldyBPcmNoZXN0cmEoKTsNCiAgICAgICAgYmFuZC5JbnN0cnVtZW50cyA9IG5ldyBJbnN0cnVtZW50WzFdIHsgbmV3IEluc3RydW1lbnQgeyBOYW1lID0gIkluc3RydW1lbnQxIiB9IH07DQogICAgICAgIGF0dHJzID0gbmV3IFhtbEF0dHJpYnV0ZXMoKTsNCiAgICAgICAgdmFyIHhBcnJheSA9IG5ldyBYbWxBcnJheUF0dHJpYnV0ZSgiQ29tbW9uSW5zdHJ1bWVudHMiKTsNCiAgICAgICAgeEFycmF5Lk5hbWVzcGFjZSA9ICJodHRwOi8vd3d3LmNvbnRvc28uY29tIjsNCiAgICAgICAgYXR0cnMuWG1sQXJyYXkgPSB4QXJyYXk7DQogICAgICAgIGF0dHJPdmVycmlkZXMgPSBuZXcgWG1sQXR0cmlidXRlT3ZlcnJpZGVzKCk7DQogICAgICAgIGF0dHJPdmVycmlkZXMuQWRkKHR5cGVvZihPcmNoZXN0cmEpLCAiSW5zdHJ1bWVudHMiLCBhdHRycyk7DQogICAgICAgIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKGJhbmQsDQpAIjw/eG1sIHZlcnNpb249IiIxLjAiIj8+DQo8T3JjaGVzdHJhIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPENvbW1vbkluc3RydW1lbnRzIHhtbG5zPSIiaHR0cDovL3d3dy5jb250b3NvLmNvbSIiPg0KICAgIDxJbnN0cnVtZW50Pg0KICAgICAgPE5hbWU+SW5zdHJ1bWVudDE8L05hbWU+DQogICAgPC9JbnN0cnVtZW50Pg0KICA8L0NvbW1vbkluc3RydW1lbnRzPg0KPC9PcmNoZXN0cmE+IiwgKCkgPT4geyByZXR1cm4gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKE9yY2hlc3RyYSksIGF0dHJPdmVycmlkZXMpOyB9KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGJhbmQuSW5zdHJ1bWVudHMuTGVuZ3RoLCBhY3R1YWwuSW5zdHJ1bWVudHMuTGVuZ3RoKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYW5kLkluc3RydW1lbnRzLkxlbmd0aDsgaSsrKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoKGJhbmQuSW5zdHJ1bWVudHMuRWxlbWVudEF0KGkpKS5OYW1lLCAoYWN0dWFsLkluc3RydW1lbnRzW2ldKS5OYW1lKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJhbmQgPSBuZXcgT3JjaGVzdHJhKCk7DQogICAgICAgIHZhciB0cnVtcGV0ID0gbmV3IFRydW1wZXQoKSB7IE5hbWUgPSAiVHJ1bXBldEtleUMiLCBJc1ZhbHZlZCA9IGZhbHNlLCBNb2R1bGF0aW9uID0gJ0MnIH07DQogICAgICAgIGJhbmQuSW5zdHJ1bWVudHMgPSBuZXcgSW5zdHJ1bWVudFsyXSB7IGJyYXNzLCB0cnVtcGV0IH07DQoNCiAgICAgICAgYXR0cnMgPSBuZXcgWG1sQXR0cmlidXRlcygpOw0KICAgICAgICB2YXIgeEFycmF5SXRlbSA9IG5ldyBYbWxBcnJheUl0ZW1BdHRyaWJ1dGUodHlwZW9mKEJyYXNzKSk7DQogICAgICAgIHhBcnJheUl0ZW0uTmFtZXNwYWNlID0gImh0dHA6Ly93d3cuY29udG9zby5jb20iOw0KICAgICAgICBhdHRycy5YbWxBcnJheUl0ZW1zLkFkZCh4QXJyYXlJdGVtKTsNCiAgICAgICAgdmFyIHhBcnJheUl0ZW0yID0gbmV3IFhtbEFycmF5SXRlbUF0dHJpYnV0ZSh0eXBlb2YoVHJ1bXBldCkpOw0KICAgICAgICB4QXJyYXlJdGVtMi5OYW1lc3BhY2UgPSAiaHR0cDovL3d3dy5jb250b3NvLmNvbSI7DQogICAgICAgIGF0dHJzLlhtbEFycmF5SXRlbXMuQWRkKHhBcnJheUl0ZW0yKTsNCiAgICAgICAgYXR0ck92ZXJyaWRlcyA9IG5ldyBYbWxBdHRyaWJ1dGVPdmVycmlkZXMoKTsNCiAgICAgICAgYXR0ck92ZXJyaWRlcy5BZGQodHlwZW9mKE9yY2hlc3RyYSksICJJbnN0cnVtZW50cyIsIGF0dHJzKTsNCiAgICAgICAgYWN0dWFsID0gU2VyaWFsaXplQW5kRGVzZXJpYWxpemUoYmFuZCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxPcmNoZXN0cmEgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiPg0KICA8SW5zdHJ1bWVudHM+DQogICAgPEJyYXNzIHhtbG5zPSIiaHR0cDovL3d3dy5jb250b3NvLmNvbSIiPg0KICAgICAgPE5hbWU+VHJ1bXBldDwvTmFtZT4NCiAgICAgIDxJc1ZhbHZlZD50cnVlPC9Jc1ZhbHZlZD4NCiAgICA8L0JyYXNzPg0KICAgIDxUcnVtcGV0IHhtbG5zPSIiaHR0cDovL3d3dy5jb250b3NvLmNvbSIiPg0KICAgICAgPE5hbWU+VHJ1bXBldEtleUM8L05hbWU+DQogICAgICA8SXNWYWx2ZWQ+ZmFsc2U8L0lzVmFsdmVkPg0KICAgICAgPE1vZHVsYXRpb24+Njc8L01vZHVsYXRpb24+DQogICAgPC9UcnVtcGV0Pg0KICA8L0luc3RydW1lbnRzPg0KPC9PcmNoZXN0cmE+IiwgKCkgPT4geyByZXR1cm4gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKE9yY2hlc3RyYSksIGF0dHJPdmVycmlkZXMpOyB9KTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKGJhbmQuSW5zdHJ1bWVudHMuTGVuZ3RoLCBhY3R1YWwuSW5zdHJ1bWVudHMuTGVuZ3RoKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYW5kLkluc3RydW1lbnRzLkxlbmd0aDsgaSsrKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuRXF1YWwoKGJhbmQuSW5zdHJ1bWVudHMuRWxlbWVudEF0KGkpKS5OYW1lLCAoYWN0dWFsLkluc3RydW1lbnRzW2ldKS5OYW1lKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGF0dHJPdmVycmlkZXMgPSBuZXcgWG1sQXR0cmlidXRlT3ZlcnJpZGVzKCk7DQogICAgICAgIGF0dHJzID0gbmV3IFhtbEF0dHJpYnV0ZXMoKTsNCiAgICAgICAgT2JqZWN0IGRlZmF1bHRBbmltYWwgPSAiQ2F0IjsNCiAgICAgICAgYXR0cnMuWG1sRGVmYXVsdFZhbHVlID0gZGVmYXVsdEFuaW1hbDsNCiAgICAgICAgYXR0ck92ZXJyaWRlcy5BZGQodHlwZW9mKFBldCksICJBbmltYWwiLCBhdHRycyk7DQogICAgICAgIGF0dHJzID0gbmV3IFhtbEF0dHJpYnV0ZXMoKTsNCiAgICAgICAgYXR0cnMuWG1sSWdub3JlID0gZmFsc2U7DQogICAgICAgIGF0dHJPdmVycmlkZXMuQWRkKHR5cGVvZihQZXQpLCAiQ29tbWVudCIsIGF0dHJzKTsNCiAgICAgICAgYXR0cnMgPSBuZXcgWG1sQXR0cmlidXRlcygpOw0KICAgICAgICB2YXIgeFR5cGUgPSBuZXcgWG1sVHlwZUF0dHJpYnV0ZSgpOw0KICAgICAgICB4VHlwZS5UeXBlTmFtZSA9ICJDdXRlRmlzaGVzIjsNCiAgICAgICAgeFR5cGUuSW5jbHVkZUluU2NoZW1hID0gdHJ1ZTsNCiAgICAgICAgYXR0cnMuWG1sVHlwZSA9IHhUeXBlOw0KICAgICAgICBhdHRyT3ZlcnJpZGVzLkFkZCh0eXBlb2YoUGV0KSwgYXR0cnMpOw0KDQogICAgICAgIHZhciBteVBldCA9IG5ldyBQZXQoKTsNCiAgICAgICAgbXlQZXQuQW5pbWFsID0gImZpc2giOw0KICAgICAgICBteVBldC5Db21tZW50ID0gIldoYXQgYSBjdXRlIGZpc2ghIjsNCiAgICAgICAgbXlQZXQuQ29tbWVudDIgPSAiSSB0aGluayBpdCBpcyBjb29sISI7DQoNCiAgICAgICAgdmFyIGFjdHVhbDIgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZShteVBldCwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxDdXRlRmlzaGVzIHhtbG5zOnhzaT0iImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiIgeG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIj4NCiAgPEFuaW1hbD5maXNoPC9BbmltYWw+DQogIDxDb21tZW50PldoYXQgYSBjdXRlIGZpc2ghPC9Db21tZW50Pg0KICA8Q29tbWVudDI+SSB0aGluayBpdCBpcyBjb29sITwvQ29tbWVudDI+DQo8L0N1dGVGaXNoZXM+DQoiLCAoKSA9PiB7IHJldHVybiBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoUGV0KSwgYXR0ck92ZXJyaWRlcyk7IH0pOw0KICAgICAgICBBc3NlcnQuRXF1YWwobXlQZXQuQW5pbWFsLCBhY3R1YWwyLkFuaW1hbCk7DQogICAgICAgIEFzc2VydC5FcXVhbChteVBldC5Db21tZW50LCBhY3R1YWwyLkNvbW1lbnQpOw0KICAgICAgICBBc3NlcnQuRXF1YWwobXlQZXQuQ29tbWVudDIsIGFjdHVhbDIuQ29tbWVudDIpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhNeUNvbGxlY3Rpb25GaWVsZCgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgVHlwZVdpdGhNeUNvbGxlY3Rpb25GaWVsZCgpOw0KICAgICAgICB2YWx1ZS5Db2xsZWN0aW9uID0gbmV3IE15Q29sbGVjdGlvbjxzdHJpbmc+KCkgeyAiczEiLCAiczIiIH07DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZVdpdGhXcmFwcGVyKHZhbHVlLCBuZXcgWG1sU2VyaWFsaXplcih0eXBlb2YoVHlwZVdpdGhNeUNvbGxlY3Rpb25GaWVsZCkpLCAiPHJvb3Q+PFR5cGVXaXRoTXlDb2xsZWN0aW9uRmllbGQgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiB4bWxuczp4c2Q9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYVwiPjxDb2xsZWN0aW9uPjxzdHJpbmc+czE8L3N0cmluZz48c3RyaW5nPnMyPC9zdHJpbmc+PC9Db2xsZWN0aW9uPjwvVHlwZVdpdGhNeUNvbGxlY3Rpb25GaWVsZD48L3Jvb3Q+Iik7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbCk7DQogICAgICAgIEFzc2VydC5Ob3ROdWxsKGFjdHVhbC5Db2xsZWN0aW9uKTsNCiAgICAgICAgQXNzZXJ0LlRydWUodmFsdWUuQ29sbGVjdGlvbi5TZXF1ZW5jZUVxdWFsKGFjdHVhbC5Db2xsZWN0aW9uKSk7DQogICAgfQ0KDQogICAgW0ZhY3RdDQogICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJkb3RuZXQvY29yZWZ4ICMxODk2NCIpXQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfU29hcF9UeXBlV2l0aE15Q29sbGVjdGlvbkZpZWxkKCkNCiAgICB7DQogICAgICAgIFhtbFR5cGVNYXBwaW5nIG15VHlwZU1hcHBpbmcgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcigpLkltcG9ydFR5cGVNYXBwaW5nKHR5cGVvZihUeXBlV2l0aE15Q29sbGVjdGlvbkZpZWxkKSk7DQogICAgICAgIHZhciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIobXlUeXBlTWFwcGluZyk7DQogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBUeXBlV2l0aE15Q29sbGVjdGlvbkZpZWxkKCk7DQogICAgICAgIHZhbHVlLkNvbGxlY3Rpb24gPSBuZXcgTXlDb2xsZWN0aW9uPHN0cmluZz4oKSB7ICJzMSIsICJzMiIgfTsNCiAgICAgICAgdmFyIGFjdHVhbCA9IFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplV2l0aFdyYXBwZXIodmFsdWUsIHNlcmlhbGl6ZXIsICI8cm9vdD48VHlwZVdpdGhNeUNvbGxlY3Rpb25GaWVsZCB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgaWQ9XCJpZDFcIj48Q29sbGVjdGlvbiBocmVmPVwiI2lkMlwiIC8+PC9UeXBlV2l0aE15Q29sbGVjdGlvbkZpZWxkPjxxMTpBcnJheSBpZD1cImlkMlwiIHhtbG5zOnEyPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiBxMTphcnJheVR5cGU9XCJxMjpzdHJpbmdbXVwiIHhtbG5zOnExPVwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbmNvZGluZy9cIj48SXRlbT5zMTwvSXRlbT48SXRlbT5zMjwvSXRlbT48L3ExOkFycmF5Pjwvcm9vdD4iKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsLkNvbGxlY3Rpb24pOw0KICAgICAgICBBc3NlcnQuVHJ1ZSh2YWx1ZS5Db2xsZWN0aW9uLlNlcXVlbmNlRXF1YWwoYWN0dWFsLkNvbGxlY3Rpb24pKTsNCiAgICB9DQoNCiAgICBbRmFjdF0NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgWG1sX0RlZmF1bHRWYWx1ZUF0dHJpYnV0ZVNldFRvTmFOVGVzdCgpDQogICAgew0KICAgICAgICB2YXIgdmFsdWUgPSBuZXcgRGVmYXVsdFZhbHVlc1NldFRvTmFOKCk7DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz4NCjxEZWZhdWx0VmFsdWVzU2V0VG9OYU4geG1sbnM6eHNkPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIiB4bWxuczp4c2k9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIiPg0KICA8RG91YmxlRmllbGQ+MDwvRG91YmxlRmllbGQ+DQogIDxTaW5nbGVGaWVsZD4wPC9TaW5nbGVGaWVsZD4NCiAgPERvdWJsZVByb3A+MDwvRG91YmxlUHJvcD4NCiAgPEZsb2F0UHJvcD4wPC9GbG9hdFByb3A+DQo8L0RlZmF1bHRWYWx1ZXNTZXRUb05hTj4iKTsNCiAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLCBhY3R1YWwpOw0KICAgIH0NCg0KICAgIFtGYWN0XQ0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBYbWxfVHlwZVdpdGhNaXNtYXRjaEJldHdlZW5BdHRyaWJ1dGVBbmRQcm9wZXJ0eVR5cGUoKQ0KICAgIHsNCiAgICAgICAgdmFyIHZhbHVlID0gbmV3IFR5cGVXaXRoTWlzbWF0Y2hCZXR3ZWVuQXR0cmlidXRlQW5kUHJvcGVydHlUeXBlKCk7DQogICAgICAgIHZhciBhY3R1YWwgPSBTZXJpYWxpemVBbmREZXNlcmlhbGl6ZSh2YWx1ZSwNCkAiPD94bWwgdmVyc2lvbj0iIjEuMCIiPz48Um9vdEVsZW1lbnQgeG1sbnM6eHNpPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIiB4bWxuczp4c2Q9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIiIEludFZhbHVlPSIiMTIwIiIgLz4iKTsNCiAgICAgICAgQXNzZXJ0LlN0cmljdEVxdWFsKHZhbHVlLkludFZhbHVlLCBhY3R1YWwuSW50VmFsdWUpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IHN0cmluZyBzX2RlZmF1bHROcyA9ICJodHRwOi8vdGVtcHVyaS5vcmcvIjsNCiAgICBwcml2YXRlIHN0YXRpYyBUIFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZzxUPihvYmplY3QgcmVxdWVzdEJvZHlWYWx1ZSwgc3RyaW5nIG1lbWJlck5hbWUsIHN0cmluZyBiYXNlbGluZSwgYm9vbCBza2lwU3RyaW5nQ29tcGFyZSA9IGZhbHNlLCBzdHJpbmcgd3JhcHBlck5hbWUgPSBudWxsKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIG5zID0gc19kZWZhdWx0TnM7DQogICAgICAgIG9iamVjdFtdIHZhbHVlID0gbmV3IG9iamVjdFtdIHsgcmVxdWVzdEJvZHlWYWx1ZSB9Ow0KICAgICAgICBYbWxSZWZsZWN0aW9uTWVtYmVyIG1lbWJlciA9IEdldFJlZmxlY3Rpb25NZW1iZXI8VD4obWVtYmVyTmFtZSwgbnMpOw0KICAgICAgICB2YXIgbWVtYmVycyA9IG5ldyBYbWxSZWZsZWN0aW9uTWVtYmVyW10geyBtZW1iZXIgfTsNCiAgICAgICAgb2JqZWN0W10gYWN0dWFsID0gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nKHZhbHVlLCBiYXNlbGluZSwgc2tpcFN0cmluZ0NvbXBhcmUsIG1lbWJlcnM6IG1lbWJlcnMsIHdyYXBwZXJOYW1lOiB3cmFwcGVyTmFtZSk7DQogICAgICAgIEFzc2VydC5FcXVhbCh2YWx1ZS5MZW5ndGgsIGFjdHVhbC5MZW5ndGgpOw0KICAgICAgICByZXR1cm4gKFQpYWN0dWFsWzBdOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIG9iamVjdFtdIFJvdW5kVHJpcFdpdGhYbWxNZW1iZXJzTWFwcGluZyhvYmplY3RbXSB2YWx1ZSwgc3RyaW5nIGJhc2VsaW5lLCBib29sIHNraXBTdHJpbmdDb21wYXJlLCBYbWxSZWZsZWN0aW9uTWVtYmVyW10gbWVtYmVycywgc3RyaW5nIG5zID0gbnVsbCwgc3RyaW5nIHdyYXBwZXJOYW1lID0gbnVsbCwgYm9vbCBycGMgPSBmYWxzZSkNCiAgICB7DQogICAgICAgIG5zID0gbnMgPz8gc19kZWZhdWx0TnM7DQogICAgICAgIHZhciBpbXBvcnRlciA9IG5ldyBYbWxSZWZsZWN0aW9uSW1wb3J0ZXIobnVsbCwgbnMpOw0KICAgICAgICB2YXIgbWVtYmVyc01hcHBpbmcgPSBpbXBvcnRlci5JbXBvcnRNZW1iZXJzTWFwcGluZyh3cmFwcGVyTmFtZSwgbnMsIG1lbWJlcnMsIHdyYXBwZXJOYW1lICE9IG51bGwsIHJwYzogcnBjKTsNCiAgICAgICAgdmFyIHNlcmlhbGl6ZXIgPSBYbWxTZXJpYWxpemVyLkZyb21NYXBwaW5ncyhuZXcgWG1sTWFwcGluZ1tdIHsgbWVtYmVyc01hcHBpbmcgfSlbMF07DQogICAgICAgIHVzaW5nICh2YXIgbXMgPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgc2VyaWFsaXplci5TZXJpYWxpemUobXMsIHZhbHVlKTsNCiAgICAgICAgICAgIG1zLkZsdXNoKCk7DQogICAgICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQogICAgICAgICAgICBzdHJpbmcgYWN0dWFsT3V0cHV0ID0gbmV3IFN0cmVhbVJlYWRlcihtcykuUmVhZFRvRW5kKCk7DQogICAgICAgICAgICBpZiAoIXNraXBTdHJpbmdDb21wYXJlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFV0aWxzLkNvbXBhcmVSZXN1bHQgcmVzdWx0ID0gVXRpbHMuQ29tcGFyZShiYXNlbGluZSwgYWN0dWFsT3V0cHV0KTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShyZXN1bHQuRXF1YWwsIHN0cmluZy5Gb3JtYXQoInsxfXswfVRlc3QgZmFpbGVkIGZvciBpbnB1dDogezJ9ezB9RXhwZWN0ZWQ6IHszfXswfUFjdHVhbDogezR9IiwNCiAgICAgICAgICAgICAgICAgICAgRW52aXJvbm1lbnQuTmV3TGluZSwgcmVzdWx0LkVycm9yTWVzc2FnZSwgdmFsdWUsIGJhc2VsaW5lLCBhY3R1YWxPdXRwdXQpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbXMuUG9zaXRpb24gPSAwOw0KICAgICAgICAgICAgdmFyIGFjdHVhbCA9IHNlcmlhbGl6ZXIuRGVzZXJpYWxpemUobXMpIGFzIG9iamVjdFtdOw0KICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGFjdHVhbDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIFQgUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nU29hcDxUPihvYmplY3QgaXRlbSwgc3RyaW5nIG1lbWJlck5hbWUsIHN0cmluZyBiYXNlbGluZSwgYm9vbCBza2lwU3RyaW5nQ29tcGFyZSA9IGZhbHNlLCBzdHJpbmcgd3JhcHBlck5hbWUgPSBudWxsLCBib29sIHZhbGlkYXRlID0gZmFsc2UpDQogICAgew0KICAgICAgICBzdHJpbmcgbnMgPSBzX2RlZmF1bHROczsNCiAgICAgICAgb2JqZWN0W10gdmFsdWUgPSBuZXcgb2JqZWN0W10geyBpdGVtIH07DQogICAgICAgIFhtbFJlZmxlY3Rpb25NZW1iZXIgbWVtYmVyID0gR2V0UmVmbGVjdGlvbk1lbWJlcjxUPihtZW1iZXJOYW1lLCBucyk7DQogICAgICAgIHZhciBtZW1iZXJzID0gbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXJbXSB7IG1lbWJlciB9Ow0KICAgICAgICBvYmplY3RbXSBhY3R1YWwgPSBSb3VuZFRyaXBXaXRoWG1sTWVtYmVyc01hcHBpbmdTb2FwKHZhbHVlLCBiYXNlbGluZSwgc2tpcFN0cmluZ0NvbXBhcmUsIG1lbWJlcnM6IG1lbWJlcnMsIHdyYXBwZXJOYW1lOiB3cmFwcGVyTmFtZSwgdmFsaWRhdGU6IHZhbGlkYXRlKTsNCiAgICAgICAgQXNzZXJ0LkVxdWFsKHZhbHVlLkxlbmd0aCwgYWN0dWFsLkxlbmd0aCk7DQogICAgICAgIHJldHVybiAoVClhY3R1YWxbMF07DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgb2JqZWN0W10gUm91bmRUcmlwV2l0aFhtbE1lbWJlcnNNYXBwaW5nU29hcChvYmplY3RbXSB2YWx1ZSwgc3RyaW5nIGJhc2VsaW5lLCBib29sIHNraXBTdHJpbmdDb21wYXJlLCBYbWxSZWZsZWN0aW9uTWVtYmVyW10gbWVtYmVycywgc3RyaW5nIG5zID0gbnVsbCwgc3RyaW5nIHdyYXBwZXJOYW1lID0gbnVsbCwgYm9vbCB3cml0ZUFjY2Vzc29ycyA9IGZhbHNlLCBib29sIHZhbGlkYXRlID0gZmFsc2UpDQogICAgew0KICAgICAgICBucyA9IG5zID8/IHNfZGVmYXVsdE5zOw0KICAgICAgICB2YXIgaW1wb3J0ZXIgPSBuZXcgU29hcFJlZmxlY3Rpb25JbXBvcnRlcihudWxsLCBucyk7DQogICAgICAgIHZhciBtZW1iZXJzTWFwcGluZyA9IGltcG9ydGVyLkltcG9ydE1lbWJlcnNNYXBwaW5nKHdyYXBwZXJOYW1lLCBucywgbWVtYmVycywgaGFzV3JhcHBlckVsZW1lbnQ6IHdyYXBwZXJOYW1lICE9IG51bGwsIHdyaXRlQWNjZXNzb3JzOiB3cml0ZUFjY2Vzc29ycywgdmFsaWRhdGU6IHZhbGlkYXRlKTsNCiAgICAgICAgdmFyIHNlcmlhbGl6ZXIgPSBYbWxTZXJpYWxpemVyLkZyb21NYXBwaW5ncyhuZXcgWG1sTWFwcGluZ1tdIHsgbWVtYmVyc01hcHBpbmcgfSlbMF07DQogICAgICAgIHVzaW5nICh2YXIgbXMgPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgc2VyaWFsaXplci5TZXJpYWxpemUobXMsIHZhbHVlKTsNCiAgICAgICAgICAgIG1zLkZsdXNoKCk7DQogICAgICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQogICAgICAgICAgICBzdHJpbmcgYWN0dWFsT3V0cHV0ID0gbmV3IFN0cmVhbVJlYWRlcihtcykuUmVhZFRvRW5kKCk7DQogICAgICAgICAgICBpZiAoIXNraXBTdHJpbmdDb21wYXJlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFV0aWxzLkNvbXBhcmVSZXN1bHQgcmVzdWx0ID0gVXRpbHMuQ29tcGFyZShiYXNlbGluZSwgYWN0dWFsT3V0cHV0KTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShyZXN1bHQuRXF1YWwsIHN0cmluZy5Gb3JtYXQoInsxfXswfVRlc3QgZmFpbGVkIGZvciBpbnB1dDogezJ9ezB9RXhwZWN0ZWQ6IHszfXswfUFjdHVhbDogezR9IiwNCiAgICAgICAgICAgICAgICAgICAgRW52aXJvbm1lbnQuTmV3TGluZSwgcmVzdWx0LkVycm9yTWVzc2FnZSwgdmFsdWUsIGJhc2VsaW5lLCBhY3R1YWxPdXRwdXQpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbXMuUG9zaXRpb24gPSAwOw0KICAgICAgICAgICAgdmFyIGFjdHVhbCA9IHNlcmlhbGl6ZXIuRGVzZXJpYWxpemUobXMpIGFzIG9iamVjdFtdOw0KICAgICAgICAgICAgQXNzZXJ0Lk5vdE51bGwoYWN0dWFsKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGFjdHVhbDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIFhtbFJlZmxlY3Rpb25NZW1iZXIgR2V0UmVmbGVjdGlvbk1lbWJlcjxUPihzdHJpbmcgbWVtYmVyTmFtZSkNCiAgICB7DQogICAgICAgIHJldHVybiBHZXRSZWZsZWN0aW9uTWVtYmVyPFQ+KG1lbWJlck5hbWUsIHNfZGVmYXVsdE5zKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBYbWxSZWZsZWN0aW9uTWVtYmVyIEdldFJlZmxlY3Rpb25NZW1iZXI8VD4oc3RyaW5nIG1lbWJlck5hbWUsIHN0cmluZyBucykNCiAgICB7DQogICAgICAgIHZhciBtZW1iZXIgPSBuZXcgWG1sUmVmbGVjdGlvbk1lbWJlcigpOw0KICAgICAgICBtZW1iZXIuTWVtYmVyTmFtZSA9IG1lbWJlck5hbWU7DQogICAgICAgIG1lbWJlci5NZW1iZXJUeXBlID0gdHlwZW9mKFQpOw0KICAgICAgICBtZW1iZXIuWG1sQXR0cmlidXRlcyA9IG5ldyBYbWxBdHRyaWJ1dGVzKCk7DQogICAgICAgIHZhciBlbGVtZW50QXR0cmlidXRlID0gbmV3IFhtbEVsZW1lbnRBdHRyaWJ1dGUoKTsNCiAgICAgICAgZWxlbWVudEF0dHJpYnV0ZS5FbGVtZW50TmFtZSA9IG1lbWJlck5hbWU7DQogICAgICAgIGVsZW1lbnRBdHRyaWJ1dGUuTmFtZXNwYWNlID0gbnM7DQogICAgICAgIG1lbWJlci5YbWxBdHRyaWJ1dGVzLlhtbEVsZW1lbnRzLkFkZChlbGVtZW50QXR0cmlidXRlKTsNCiAgICAgICAgcmV0dXJuIG1lbWJlcjsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBYbWxSZWZsZWN0aW9uTWVtYmVyIEdldFJlZmxlY3Rpb25NZW1iZXJOb1htbEVsZW1lbnQ8VD4oc3RyaW5nIG1lbWJlck5hbWUsIHN0cmluZyBucyA9IG51bGwpDQogICAgew0KICAgICAgICBucyA9IG5zID8/IHNfZGVmYXVsdE5zOw0KICAgICAgICB2YXIgbWVtYmVyID0gbmV3IFhtbFJlZmxlY3Rpb25NZW1iZXIoKTsNCiAgICAgICAgbWVtYmVyLk1lbWJlck5hbWUgPSBtZW1iZXJOYW1lOw0KICAgICAgICBtZW1iZXIuTWVtYmVyVHlwZSA9IHR5cGVvZihUKTsNCiAgICAgICAgbWVtYmVyLlhtbEF0dHJpYnV0ZXMgPSBuZXcgWG1sQXR0cmlidXRlcygpOw0KICAgICAgICByZXR1cm4gbWVtYmVyOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIFN0cmVhbSBHZW5lcmF0ZVN0cmVhbUZyb21TdHJpbmcoc3RyaW5nIHMpDQogICAgew0KICAgICAgICB2YXIgc3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpOw0KICAgICAgICB2YXIgd3JpdGVyID0gbmV3IFN0cmVhbVdyaXRlcihzdHJlYW0pOw0KICAgICAgICB3cml0ZXIuV3JpdGUocyk7DQogICAgICAgIHdyaXRlci5GbHVzaCgpOw0KICAgICAgICBzdHJlYW0uUG9zaXRpb24gPSAwOw0KICAgICAgICByZXR1cm4gc3RyZWFtOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIFQgU2VyaWFsaXplQW5kRGVzZXJpYWxpemU8VD4oVCB2YWx1ZSwgc3RyaW5nIGJhc2VsaW5lLCBGdW5jPFhtbFNlcmlhbGl6ZXI+IHNlcmlhbGl6ZXJGYWN0b3J5ID0gbnVsbCwNCiAgICAgICAgYm9vbCBza2lwU3RyaW5nQ29tcGFyZSA9IGZhbHNlLCBYbWxTZXJpYWxpemVyTmFtZXNwYWNlcyB4bnMgPSBudWxsKQ0KICAgIHsNCiAgICAgICAgWG1sU2VyaWFsaXplciBzZXJpYWxpemVyID0gbmV3IFhtbFNlcmlhbGl6ZXIodHlwZW9mKFQpKTsNCiAgICAgICAgaWYgKHNlcmlhbGl6ZXJGYWN0b3J5ICE9IG51bGwpDQogICAgICAgIHsNCiAgICAgICAgICAgIHNlcmlhbGl6ZXIgPSBzZXJpYWxpemVyRmFjdG9yeSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgdXNpbmcgKE1lbW9yeVN0cmVhbSBtcyA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHhucyA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXIuU2VyaWFsaXplKG1zLCB2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2VyaWFsaXplci5TZXJpYWxpemUobXMsIHZhbHVlLCB4bnMpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBtcy5Qb3NpdGlvbiA9IDA7DQoNCiAgICAgICAgICAgIHN0cmluZyBhY3R1YWxPdXRwdXQgPSBuZXcgU3RyZWFtUmVhZGVyKG1zKS5SZWFkVG9FbmQoKTsNCg0KICAgICAgICAgICAgaWYgKCFza2lwU3RyaW5nQ29tcGFyZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVdGlscy5Db21wYXJlUmVzdWx0IHJlc3VsdCA9IFV0aWxzLkNvbXBhcmUoYmFzZWxpbmUsIGFjdHVhbE91dHB1dCk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUocmVzdWx0LkVxdWFsLCBzdHJpbmcuRm9ybWF0KCJ7MX17MH1UZXN0IGZhaWxlZCBmb3IgaW5wdXQ6IHsyfXswfUV4cGVjdGVkOiB7M317MH1BY3R1YWw6IHs0fSIsDQogICAgICAgICAgICAgICAgICAgIEVudmlyb25tZW50Lk5ld0xpbmUsIHJlc3VsdC5FcnJvck1lc3NhZ2UsIHZhbHVlLCBiYXNlbGluZSwgYWN0dWFsT3V0cHV0KSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIG1zLlBvc2l0aW9uID0gMDsNCiAgICAgICAgICAgIFQgZGVzZXJpYWxpemVkID0gKFQpc2VyaWFsaXplci5EZXNlcmlhbGl6ZShtcyk7DQoNCiAgICAgICAgICAgIHJldHVybiBkZXNlcmlhbGl6ZWQ7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBUIFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplV2l0aFdyYXBwZXI8VD4oVCB2YWx1ZSwgWG1sU2VyaWFsaXplciBzZXJpYWxpemVyLCBzdHJpbmcgYmFzZWxpbmUpDQogICAgew0KICAgICAgICBUIGFjdHVhbDsNCiAgICAgICAgdXNpbmcgKHZhciBtcyA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHdyaXRlciA9IG5ldyBYbWxUZXh0V3JpdGVyKG1zLCBFbmNvZGluZy5VVEY4KTsNCiAgICAgICAgICAgIHdyaXRlci5Xcml0ZVN0YXJ0RWxlbWVudCgicm9vdCIpOw0KICAgICAgICAgICAgc2VyaWFsaXplci5TZXJpYWxpemUod3JpdGVyLCB2YWx1ZSk7DQogICAgICAgICAgICB3cml0ZXIuV3JpdGVFbmRFbGVtZW50KCk7DQogICAgICAgICAgICB3cml0ZXIuRmx1c2goKTsNCg0KICAgICAgICAgICAgbXMuUG9zaXRpb24gPSAwOw0KICAgICAgICAgICAgc3RyaW5nIGFjdHVhbE91dHB1dCA9IG5ldyBTdHJlYW1SZWFkZXIobXMpLlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgVXRpbHMuQ29tcGFyZVJlc3VsdCByZXN1bHQgPSBVdGlscy5Db21wYXJlKGJhc2VsaW5lLCBhY3R1YWxPdXRwdXQpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUocmVzdWx0LkVxdWFsLCBzdHJpbmcuRm9ybWF0KCJ7MX17MH1UZXN0IGZhaWxlZCBmb3IgaW5wdXQ6IHsyfXswfUV4cGVjdGVkOiB7M317MH1BY3R1YWw6IHs0fSIsDQogICAgICAgICAgICAgICAgRW52aXJvbm1lbnQuTmV3TGluZSwgcmVzdWx0LkVycm9yTWVzc2FnZSwgdmFsdWUsIGJhc2VsaW5lLCBhY3R1YWxPdXRwdXQpKTsNCg0KICAgICAgICAgICAgbXMuUG9zaXRpb24gPSAwOw0KICAgICAgICAgICAgdXNpbmcgKHZhciByZWFkZXIgPSBuZXcgWG1sVGV4dFJlYWRlcihtcykpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVhZGVyLlJlYWRTdGFydEVsZW1lbnQoInJvb3QiKTsNCiAgICAgICAgICAgICAgICBhY3R1YWwgPSAoVClzZXJpYWxpemVyLkRlc2VyaWFsaXplKHJlYWRlcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gYWN0dWFsOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgQXNzZXJ0U2VyaWFsaXphdGlvbkZhaWx1cmU8VCwgRXhjZXB0aW9uVHlwZT4oKSB3aGVyZSBUIDogbmV3KCkgd2hlcmUgRXhjZXB0aW9uVHlwZSA6IEV4Y2VwdGlvbg0KICAgIHsNCiAgICAgICAgdHJ5DQogICAgICAgIHsNCiAgICAgICAgICAgIFNlcmlhbGl6ZUFuZERlc2VyaWFsaXplKG5ldyBUKCksIHN0cmluZy5FbXB0eSwgc2tpcFN0cmluZ0NvbXBhcmU6IHRydWUpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UsICQiQXNzZXJ0LlRydWUgZmFpbGVkIGZvciB7dHlwZW9mKFQpfS4gVGhlIGFib3ZlIG9wZXJhdGlvbiBzaG91bGQgaGF2ZSB0aHJvd24sIGJ1dCBpdCBkaWRuJ3QuIik7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShlIGlzIEV4Y2VwdGlvblR5cGUsICQiQXNzZXJ0LlRydWUgZmFpbGVkIGZvciB7dHlwZW9mKFQpfS4gRXhwZWN0ZWQ6IHt0eXBlb2YoRXhjZXB0aW9uVHlwZSl9OyBBY3R1YWw6IHtlLkdldFR5cGUoKX0iKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/TempFiles.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlhtbC5Yc2w7DQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzDQp7DQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJUZW1wb3JhcnlGaWxlcyIsIERlc2MgPSAiVGhpcyB0ZXN0Y2FzZSB0ZXN0cyB0aGUgVGVtcG9yYXJ5IEZpbGVzIHByb3BlcnR5IG9uIFhzbENvbXBpbGVkVHJhbnNmb3JtIildDQogICAgcHVibGljIGNsYXNzIFRlbXBGaWxlcyA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UyDQogICAgew0KICAgICAgICBwcml2YXRlIFhzbENvbXBpbGVkVHJhbnNmb3JtIF94c2wgPSBudWxsOw0KDQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIFRlbXBGaWxlcyhJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oRGVzYyA9ICJMb2FkIEZpbGUgZnJvbSBhIGRyaXZlIGM6IiwgUHJpID0gMildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRlbXBGaWxlczEoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgY2hpbGRGaWxlID0gUGF0aC5Db21iaW5lKERpcmVjdG9yeS5HZXRDdXJyZW50RGlyZWN0b3J5KCksICJjaGlsZC54c2wiKTsNCg0KICAgICAgICAgICAgc3RyaW5nIHBhcmVudFN0cmluZyA9ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PiINCiAgICAgICAgICAgICAgICArICI8eHNsOnN0eWxlc2hlZXQgeG1sbnM6eHNsPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS9YU0wvVHJhbnNmb3JtXCIgdmVyc2lvbj1cIjEuMFwiPiINCiAgICAgICAgICAgICAgICArICI8eHNsOmltcG9ydCBocmVmPVwiIiArIGNoaWxkRmlsZSArICJcIi8+Ig0KICAgICAgICAgICAgICAgICsgIjx4c2w6b3V0cHV0IG1ldGhvZD1cInhtbFwiIG9taXQteG1sLWRlY2xhcmF0aW9uPVwieWVzXCIgaW5kZW50PVwieWVzXCIvPiINCiAgICAgICAgICAgICAgICArICI8eHNsOnRlbXBsYXRlIG1hdGNoPVwiYm9va1tAc3R5bGU9J2F1dG9iaW9ncmFwaHknXVwiPiINCiAgICAgICAgICAgICAgICArICI8U1BBTiBzdHlsZT1cImNvbG9yPWJsdWVcIj5Gcm9tIEI8eHNsOnZhbHVlLW9mIHNlbGVjdD1cIm5hbWUoKVwiLz4gOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD1cInRpdGxlXCIvPiINCiAgICAgICAgICAgICAgICArICI8L1NQQU4+PGJyLz4iDQogICAgICAgICAgICAgICAgKyAiPHhzbDphcHBseS10ZW1wbGF0ZXMgLz4iDQogICAgICAgICAgICAgICAgKyAiPC94c2w6dGVtcGxhdGU+Ig0KICAgICAgICAgICAgICAgICsgIjx4c2w6dGVtcGxhdGUgbWF0Y2g9XCJ0ZXh0KClcIiA+Ig0KICAgICAgICAgICAgICAgICsgIjwveHNsOnRlbXBsYXRlPiINCiAgICAgICAgICAgICAgICArICI8L3hzbDpzdHlsZXNoZWV0PiI7DQoNCiAgICAgICAgICAgIHN0cmluZyBjaGlsZFN0cmluZyA9ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCI/PiINCiAgICAgICAgICAgICAgICArICI8eHNsOnN0eWxlc2hlZXQgeG1sbnM6eHNsPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS9YU0wvVHJhbnNmb3JtXCIgdmVyc2lvbj1cIjEuMFwiPiINCiAgICAgICAgICAgICAgICArICI8eHNsOm91dHB1dCBtZXRob2Q9XCJ4bWxcIiBvbWl0LXhtbC1kZWNsYXJhdGlvbj1cInllc1wiIGluZGVudD1cInllc1wiLz4iDQogICAgICAgICAgICAgICAgKyAiPHhzbDp0ZW1wbGF0ZSBtYXRjaD1cImJvb2tbQHN0eWxlPSdhdXRvYmlvZ3JhcGh5J11cIj4iDQogICAgICAgICAgICAgICAgKyAiPFNQQU4gc3R5bGU9XCJjb2xvcj1ibHVlXCI+RnJvbSBCPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9XCJuYW1lKClcIi8+IDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9XCJ0aXRsZVwiLz4iDQogICAgICAgICAgICAgICAgKyAiPC9TUEFOPjxici8+Ig0KICAgICAgICAgICAgICAgICsgIjx4c2w6YXBwbHktdGVtcGxhdGVzIC8+Ig0KICAgICAgICAgICAgICAgICsgIjwveHNsOnRlbXBsYXRlPiINCiAgICAgICAgICAgICAgICArICI8eHNsOnRlbXBsYXRlIG1hdGNoPVwidGV4dCgpXCIgPiINCiAgICAgICAgICAgICAgICArICI8L3hzbDp0ZW1wbGF0ZT4iDQogICAgICAgICAgICAgICAgKyAiPC94c2w6c3R5bGVzaGVldD4iOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSB4c2wgZmlsZSBpbiBjdXJyZW50IGRpcmVjdG9yeSBvbiBzb21lIGRyaXZlLCB0aGlzIGlzIGluY2x1ZGVkIGluIFhTTCBhYm92ZQ0KICAgICAgICAgICAgICAgIFN0cmVhbVdyaXRlciBmaWxlID0gbmV3IFN0cmVhbVdyaXRlcihuZXcgRmlsZVN0cmVhbShjaGlsZEZpbGUsIEZpbGVNb2RlLkNyZWF0ZSwgRmlsZUFjY2Vzcy5Xcml0ZSkpOw0KICAgICAgICAgICAgICAgIGZpbGUuV3JpdGVMaW5lKGNoaWxkU3RyaW5nKTsNCiAgICAgICAgICAgICAgICBmaWxlLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICBTdHJlYW1Xcml0ZXIgcGFyZW50RmlsZSA9IG5ldyBTdHJlYW1Xcml0ZXIobmV3IEZpbGVTdHJlYW0oInBhcmVudC54c2wiLCBGaWxlTW9kZS5DcmVhdGUsIEZpbGVBY2Nlc3MuV3JpdGUpKTsNCiAgICAgICAgICAgICAgICBwYXJlbnRGaWxlLldyaXRlTGluZShwYXJlbnRTdHJpbmcpOw0KICAgICAgICAgICAgICAgIHBhcmVudEZpbGUuRGlzcG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplIFhzbENvbXBpbGVkVHJhbnNmb3JtIGluc3RhbmNlDQogICAgICAgICAgICAgICAgX3hzbCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KICAgIA0KICAgICAgICAgICAgICAgIC8vIE5vdyBsZXQncyBsb2FkIHRoZSBwYXJlbnQgeHNsIGZpbGUNCiAgICAgICAgICAgICAgICBfeHNsLkxvYWQoInBhcmVudC54c2wiLCBuZXcgWHNsdFNldHRpbmdzKGZhbHNlLCB0cnVlKSwgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhzbHRFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihEZXNjID0gIkJ1ZyA0Njk3NzUgLSBYU0xUIFYyIDogRXhjZXB0aW9uIHRocm93biBpZiB4c2w6cHJlc2VydmUtc3BhY2UveHNsOnN0cmlwLXNwYWNlIGlzIHVzZWQgYW5kIGlucHV0IGRvY3VtZW50IGNvbnRhaW5zIGVudGl0aWVzIiwgUHJpID0gMildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRlbXBGaWxlczIoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybSB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICAgICAgeHNsdC5Mb2FkKEZ1bGxGaWxlUGF0aCgiYnVnNDY5Nzc1LnhzbCIpKTsNCiAgICAgICAgICAgICAgICBTdHJlYW0gcmVzID0gbmV3IE1lbW9yeVN0cmVhbSgpOw0KICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKG5ldyBYbWxUZXh0UmVhZGVyKEZ1bGxGaWxlUGF0aCgiYnVnNDY5Nzc1LnhtbCIpKSwgKFhzbHRBcmd1bWVudExpc3QpbnVsbCwgcmVzKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShyZXMuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLlhtbC5YbWxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAiQnVnIDQ2OTc3MCAtIFhzbENvbXBpbGVkVHJhbnNmb3JtIGZhaWxlZCB0byBsb2FkIGVtYmVkZGVkIHN0eWxlc2hlZXRzIHdoZW4gcHJlZml4ZXMgYXJlIGRlZmluZWQgb3V0c2lkZSBvZiB4c2w6c3R5bGVzaGVldCBlbGVtZW50IiwgUHJpID0gMildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRlbXBGaWxlczMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgeHNsID0gIjxyb290IHhtbG5zOm5zPVwidGVzdGluZ1wiPiINCiAgICAgICAgICAgICAgICAgICAgKyAiPHhzbDpzdHlsZXNoZWV0IHZlcnNpb249XCIxLjBcIiB4bWxuczp4c2w9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm1cIj4iDQogICAgICAgICAgICAgICAgICAgICsgIjx4c2w6dGVtcGxhdGUgbWF0Y2g9XCIvXCI+Ig0KICAgICAgICAgICAgICAgICAgICArICI8eHNsOnZhbHVlLW9mIHNlbGVjdD1cIm5zOnRlc3RcIiAvPiINCiAgICAgICAgICAgICAgICAgICAgKyAiPC94c2w6dGVtcGxhdGU+Ig0KICAgICAgICAgICAgICAgICAgICArICI8L3hzbDpzdHlsZXNoZWV0PiINCiAgICAgICAgICAgICAgICAgICAgKyAiPC9yb290PiI7DQoNCiAgICAgICAgICAgICAgICBYbWxSZWFkZXIgciA9IFhtbFJlYWRlci5DcmVhdGUobmV3IFN0cmluZ1JlYWRlcih4c2wpKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAoci5Ob2RlVHlwZSAhPSBYbWxOb2RlVHlwZS5FbGVtZW50IHx8IHIuTG9jYWxOYW1lICE9ICJzdHlsZXNoZWV0IikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICghci5SZWFkKCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJUaGVyZSBpcyBubyAnc3R5bGVzaGVldCcgZWxlbWVudCBpbiB0aGUgZmlsZSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgWHNsQ29tcGlsZWRUcmFuc2Zvcm0gdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KICAgICAgICAgICAgICAgIHQuTG9hZChyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYc2x0RXhjZXB0aW9uIGV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiVGhlIGZvbGxvd2luZyBleGNlcHRpb24gc2hvdWxkIG5vdCBoYXZlIGJlZW4gdGhyb3duIik7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZXhjZXB0aW9uLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKERlc2MgPSAiQnVnIDQ4Mjk3MSAtIFhzbENvbXBpbGVkVHJhbnNmb3JtIGNhbm5vdCBvdXRwdXQgbnVtZXJpYyBjaGFyYWN0ZXIgcmVmZXJlbmNlIGFmdGVyIGxvbmcgb3V0cHV0IiwgUHJpID0gMildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRlbXBGaWxlczQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybSB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICAgICAgeHNsdC5Mb2FkKEZ1bGxGaWxlUGF0aCgiYnVnNDgyOTcxLnhzbCIpKTsNCiAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybShGdWxsRmlsZVBhdGgoImJ1ZzQ4Mjk3MS54bWwiKSwgIm91dC50eHQiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJObyBleGNlcHRpb24gc2hvdWxkIG5vdCBoYXZlIGJlZW4gdGhyb3duIik7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZXhjZXB0aW9uLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgIH0NCn0="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XslCompiledTransform.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zOw0KdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247DQp1c2luZyBTeXN0ZW0uUmVmbGVjdGlvbi5FbWl0Ow0KdXNpbmcgU3lzdGVtLlJ1bnRpbWUuTG9hZGVyOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uWG1sLlhQYXRoOw0KdXNpbmcgU3lzdGVtLlhtbC5Yc2w7DQp1c2luZyBYbWxDb3JlVGVzdC5Db21tb247DQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzDQp7DQogICAgcHVibGljIGNsYXNzIFJlZmxlY3Rpb25UZXN0Q2FzZUJhc2UgOiBYc2x0QXBpVGVzdENhc2VCYXNlMg0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgUmVmbGVjdGlvblRlc3RDYXNlQmFzZShJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIE1ldGhvZEluZm8gR2V0SW5zdGFuY2VNZXRob2QoVHlwZSB0eXBlLCBzdHJpbmcgbWV0aE5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIE1ldGhvZEluZm8gbWV0aEluZm8gPSB0eXBlLkdldE1ldGhvZChtZXRoTmFtZSwgQmluZGluZ0ZsYWdzLlB1YmxpYyB8IEJpbmRpbmdGbGFncy5Ob25QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuSW5zdGFuY2UpOw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KG1ldGhJbmZvICE9IG51bGwsICJJbnN0YW5jZSBtZXRob2QgIiArIHR5cGUuTmFtZSArICIuIiArIG1ldGhOYW1lICsgIiBub3QgZm91bmQiKTsNCiAgICAgICAgICAgIHJldHVybiBtZXRoSW5mbzsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgTWV0aG9kSW5mbyBHZXRTdGF0aWNNZXRob2QoVHlwZSB0eXBlLCBzdHJpbmcgbWV0aE5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIE1ldGhvZEluZm8gbWV0aEluZm8gPSB0eXBlLkdldE1ldGhvZChtZXRoTmFtZSwgQmluZGluZ0ZsYWdzLlB1YmxpYyB8IEJpbmRpbmdGbGFncy5Ob25QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuU3RhdGljKTsNCiAgICAgICAgICAgIERlYnVnLkFzc2VydChtZXRoSW5mbyAhPSBudWxsLCAiU3RhdGljIG1ldGhvZCAiICsgdHlwZS5OYW1lICsgIi4iICsgbWV0aE5hbWUgKyAiIG5vdCBmb3VuZCIpOw0KICAgICAgICAgICAgcmV0dXJuIG1ldGhJbmZvOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJvdGVjdGVkIFN0cmluZyBzY3JpcHRUZXN0UGF0aCA9IG51bGw7DQoNCiAgICAgICAgcHJvdGVjdGVkIFN0cmluZyBTY3JpcHRUZXN0UGF0aA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoc2NyaXB0VGVzdFBhdGggPT0gbnVsbCkgLy9ub3QgdGhyZWFkIHNhZmUNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHNjcmlwdFRlc3RQYXRoID0gX3N0YW5kYXJkVGVzdHM7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFzY3JpcHRUZXN0UGF0aC5FbmRzV2l0aChQYXRoLkRpcmVjdG9yeVNlcGFyYXRvckNoYXIuVG9TdHJpbmcoKSkpDQogICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRUZXN0UGF0aCArPSBQYXRoLkRpcmVjdG9yeVNlcGFyYXRvckNoYXI7DQoNCiAgICAgICAgICAgICAgICAgICAgc2NyaXB0VGVzdFBhdGggKz0gIlNjcmlwdGluZyIgKyBQYXRoLkRpcmVjdG9yeVNlcGFyYXRvckNoYXI7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHNjcmlwdFRlc3RQYXRoOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJvdGVjdGVkIE1ldGhvZEluZm8gQU1ldGhvZEluZm8NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgU3RyaW5nIGFzbVBhdGggPSBQYXRoLkNvbWJpbmUoUGF0aC5Db21iaW5lKCJUZXN0RmlsZXMiLCBGaWxlUGF0aFV0aWwuR2V0VGVzdERhdGFQYXRoKCksICJ4c2x0YyIsICJwcmVjb21waWxlZCIpLCAiYmZ0QmFzZUxpbmUuZGxsIik7DQogICAgICAgICAgICAgICAgU3RyaW5nIHR5cGUgPSAiYmZ0QmFzZUxpbmUiOw0KDQogICAgICAgICAgICAgICAgQXNzZW1ibHkgYXNtID0gQXNzZW1ibHlMb2FkQ29udGV4dC5EZWZhdWx0LkxvYWRGcm9tQXNzZW1ibHlQYXRoKGFzbVBhdGgpOw0KICAgICAgICAgICAgICAgIFR5cGUgdCA9IGFzbS5HZXRUeXBlKHR5cGUpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuIEdldFN0YXRpY01ldGhvZCh0LCAiRXhlY3V0ZSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgV0xvYWQoWHNsQ29tcGlsZWRUcmFuc2Zvcm0gaW5zdGFuY2UsIE1ldGhvZEluZm8gbWV0aCwgQnl0ZVtdIGJ5dGVzLCBUeXBlW10gdHlwZXMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGluc3RhbmNlLkxvYWQobWV0aCwgYnl0ZXMsIHR5cGVzKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiTG9hZChNZXRob2RJbmZvLCBCeXRlQXJyYXksIFR5cGVBcnJheSkgdGVzdHMiLCBEZXNjID0gIlRoaXMgdGVzdGNhc2UgdGVzdHMgcHJpdmF0ZSBMb2FkIG1ldGhvZCB2aWEgUmVmbGVjdGlvbi4gVGhpcyBtZXRob2QgaXMgdXNlZCBieSBzaGFyZXBvaW50IildDQogICAgcHVibGljIGNsYXNzIENMb2FkTWV0aEluZm9UZXN0IDogUmVmbGVjdGlvblRlc3RDYXNlQmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ0xvYWRNZXRoSW5mb1Rlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkKE1ldGhvZEluZm8gPSBudWxsLCBCeXRlQXJyYXksIFR5cGVBcnJheSkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyMSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdMb2FkKHhzbHQsIChNZXRob2RJbmZvKW51bGwsIG5ldyBCeXRlWzVdLCBuZXcgVHlwZVs1XSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCg0KICAgICAgICAgICAgICAgIGlmIChlIGlzIEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiB8fCBlLklubmVyRXhjZXB0aW9uIGlzIEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQoTWV0aG9kSW5mbywgQnl0ZUFycmF5ID0gbnVsbCwgVHlwZUFycmF5KSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgWHNsQ29tcGlsZWRUcmFuc2Zvcm0geHNsdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgV0xvYWQoeHNsdCwgQU1ldGhvZEluZm8sIG51bGwsIG5ldyBUeXBlWzVdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KDQogICAgICAgICAgICAgICAgaWYgKGUgaXMgQXJndW1lbnRFeGNlcHRpb24gfHwgZS5Jbm5lckV4Y2VwdGlvbiBpcyBBcmd1bWVudEV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIk51bGwgYXJndW1lbnQgdGVzdHMiLCBEZXNjID0gIlRoaXMgdGVzdGNhc2UgcGFzc2VzIE5VTEwgYXJndW1lbnRzIHRvIGFsbCBYc2xDb21waWxlZFRyYW5zZm9ybSBtZXRob2RzIildDQogICAgcHVibGljIGNsYXNzIENOdWxsQXJndW1lbnRUZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZTINCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENOdWxsQXJndW1lbnRUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZChzdHJpbmcgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIwKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCkuTG9hZCgoc3RyaW5nKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZChJWFBhdGhOYXZpZ2FibGUgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIxKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCkuTG9hZCgoSVhQYXRoTmF2aWdhYmxlKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZChYbWxSZWFkZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCkuTG9hZCgoWG1sUmVhZGVyKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZChJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYbWxSZXNvbHZlciA9IG51bGwpIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFZhcjMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKS5Mb2FkKChJWFBhdGhOYXZpZ2FibGUpbnVsbCwgWHNsdFNldHRpbmdzLlRydXN0ZWRYc2x0LCAoWG1sUmVzb2x2ZXIpbnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXJndW1lbnROdWxsRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJEaWQgbm90IHRocm93IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkKFhtbFJlYWRlciA9IG51bGwsIFhtbFJlc29sdmVyID0gbnVsbCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyNCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpLkxvYWQoKFhtbFJlYWRlciludWxsLCBYc2x0U2V0dGluZ3MuVHJ1c3RlZFhzbHQsIChYbWxSZXNvbHZlciludWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQoSVhQYXRoTmF2aWdhYmxlID0gbnVsbCwgWG1sUmVzb2x2ZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXI1KCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCkuTG9hZCgoSVhQYXRoTmF2aWdhYmxlKW51bGwsIFhzbHRTZXR0aW5ncy5UcnVzdGVkWHNsdCwgKFhtbFJlc29sdmVyKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZChYbWxSZWFkZXIgPSBudWxsLCBYbWxSZXNvbHZlciA9IG51bGwpIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFZhcjYoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKS5Mb2FkKChYbWxSZWFkZXIpbnVsbCwgWHNsdFNldHRpbmdzLlRydXN0ZWRYc2x0LCAoWG1sUmVzb2x2ZXIpbnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXJndW1lbnROdWxsRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJEaWQgbm90IHRocm93IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJUcmFuc2Zvcm0oSVhQYXRoTmF2aWdhYmxlID0gbnVsbCwgWHNsdEFyZ3VtZW50TGlzdCA9IG51bGwpIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFZhcjcoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybSB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICAgICAgeHNsdC5Mb2FkKEZ1bGxGaWxlUGF0aCgiaWRlbnRpdHkueHNsIikpOw0KICAgICAgICAgICAgICAgIFN0cmluZ1dyaXRlciBzdyA9IG5ldyBTdHJpbmdXcml0ZXIoKTsNCiAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSgoSVhQYXRoTmF2aWdhYmxlKW51bGwsIChYc2x0QXJndW1lbnRMaXN0KW51bGwsIHN3KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyOCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoRnVsbEZpbGVQYXRoKCJpZGVudGl0eS54c2wiKSk7DQogICAgICAgICAgICAgICAgU3RyaW5nV3JpdGVyIHN3ID0gbmV3IFN0cmluZ1dyaXRlcigpOw0KICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKChJWFBhdGhOYXZpZ2FibGUpbnVsbCwgKFhzbHRBcmd1bWVudExpc3QpbnVsbCwgc3cpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiVHJhbnNmb3JtKElYUGF0aE5hdmlnYWJsZSA9IG51bGwsIFhzbHRBcmd1bWVudExpc3QgPSBudWxsLCBUZXh0V3JpdGVyID0gbnVsbCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyOSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoRnVsbEZpbGVQYXRoKCJpZGVudGl0eS54c2wiKSk7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWHNsdEFyZ3VtZW50TGlzdCludWxsLCAoVGV4dFdyaXRlciludWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCwgVGV4dFdyaXRlciA9IG51bGwpIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFZhcjEwKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWHNsQ29tcGlsZWRUcmFuc2Zvcm0geHNsdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KICAgICAgICAgICAgICAgIHhzbHQuTG9hZChGdWxsRmlsZVBhdGgoImlkZW50aXR5LnhzbCIpKTsNCiAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSgoSVhQYXRoTmF2aWdhYmxlKW51bGwsIChYc2x0QXJndW1lbnRMaXN0KW51bGwsIChUZXh0V3JpdGVyKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiVHJhbnNmb3JtKElYUGF0aE5hdmlnYWJsZSA9IG51bGwsIFhzbHRBcmd1bWVudExpc3QgPSBudWxsLCBTdHJlYW0gPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIxMSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoRnVsbEZpbGVQYXRoKCJpZGVudGl0eS54c2wiKSk7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWHNsdEFyZ3VtZW50TGlzdCludWxsLCAoU3RyZWFtKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiVHJhbnNmb3JtKElYUGF0aE5hdmlnYWJsZSA9IG51bGwsIFhzbHRBcmd1bWVudExpc3QgPSBudWxsLCBTdHJlYW0gPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIxMigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoRnVsbEZpbGVQYXRoKCJpZGVudGl0eS54c2wiKSk7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWHNsdEFyZ3VtZW50TGlzdCludWxsLCAoU3RyZWFtKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiVHJhbnNmb3JtKElYUGF0aE5hdmlnYWJsZSA9IG51bGwsIFhzbHRBcmd1bWVudExpc3QgPSBudWxsLCBYbWxXcml0ZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIxMygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoRnVsbEZpbGVQYXRoKCJpZGVudGl0eS54c2wiKSk7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWHNsdEFyZ3VtZW50TGlzdCludWxsLCAoWG1sV3JpdGVyKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiVHJhbnNmb3JtKElYUGF0aE5hdmlnYWJsZSA9IG51bGwsIFhzbHRBcmd1bWVudExpc3QgPSBudWxsLCBYbWxXcml0ZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIxNCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoRnVsbEZpbGVQYXRoKCJpZGVudGl0eS54c2wiKSk7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWHNsdEFyZ3VtZW50TGlzdCludWxsLCAoWG1sV3JpdGVyKW51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAvKiAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybS5SZXNvbHZlciAtIEludGVncml0eSAgICAgICAgICAgICAgKi8NCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlhtbFJlc29sdmVyIDogUmVhZGVyLCBSZWFkZXIiLCBEZXNjID0gIlJFQURFUixSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlhtbFJlc29sdmVyIDogUmVhZGVyLCBTdHJlYW0iLCBEZXNjID0gIlJFQURFUixTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlhtbFJlc29sdmVyIDogUmVhZGVyLCBXcml0ZXIiLCBEZXNjID0gIlJFQURFUixXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlhtbFJlc29sdmVyIDogUmVhZGVyLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJSRUFERVIsVEVYVFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uWG1sUmVzb2x2ZXIgOiBVUkksIFJlYWRlciIsIERlc2MgPSAiVVJJLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uWG1sUmVzb2x2ZXIgOiBVUkksIFN0cmVhbSIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uWG1sUmVzb2x2ZXIgOiBVUkksIFdyaXRlciIsIERlc2MgPSAiVVJJLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uWG1sUmVzb2x2ZXIgOiBVUkksIFRleHRXcml0ZXIiLCBEZXNjID0gIlVSSSxURVhUV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5YbWxSZXNvbHZlciA6IE5hdmlnYXRvciwgUmVhZGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5YbWxSZXNvbHZlciA6IE5hdmlnYXRvciwgU3RyZWFtIiwgRGVzYyA9ICJOQVZJR0FUT1IsU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5YbWxSZXNvbHZlciA6IE5hdmlnYXRvciwgV3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5YbWxSZXNvbHZlciA6IE5hdmlnYXRvciwgVGV4dFdyaXRlciIsIERlc2MgPSAiTkFWSUdBVE9SLFRFWFRXUklURVIiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ1htbFJlc29sdmVyVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UyDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDWG1sUmVzb2x2ZXJUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KICAgICAgICAvL1tWYXJpYXRpb24oaWQgPSAxLCBEZXNjID0gIlNldCBYbWxSZXNvbHZlciBwcm9wZXJ0eSB0byBudWxsLCBsb2FkIHN0eWxlIHNoZWV0IHdpdGggaW1wb3J0L2luY2x1ZGUsIHNob3VsZCBub3QgYWZmZWN0IHRyYW5zZm9ybSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBYbWxSZXNvbHZlcjEoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJYbWxSZXNvbHZlcl9NYWluLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSwgbnVsbCk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhzbHRFeGNlcHRpb24gZTEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZTEuTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBlMikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlMi5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBpZiAoeHNsSW5wdXRUeXBlID09IFhzbElucHV0VHlwZS5VUkkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiQXJndW1lbnROdWxsRXhjZXB0aW9uIGlzIG5vdCBzdXBwb3NlZCB0byBiZSB0aHJvd24gZm9yIHRoZSBpbnB1dCB0eXBlICciICsgeHNsSW5wdXRUeXBlICsgIiciKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihpZCA9IDIsIERlc2MgPSAiU2V0IFhtbFJlc29sdmVyIHByb3BlcnR5IHRvIG51bGwsIGxvYWQgc3R5bGUgc2hlZXQgd2l0aCBkb2N1bWVudCBmdW5jdGlvbiwgc2hvdWxkIG5vdCByZXNvbHZlIGR1cmluZyBsb2FkIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFhtbFJlc29sdmVyMihYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woIlhtbFJlc29sdmVyX01haW4ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlLCBudWxsKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTm8gZXhjZXB0aW9uIHdhcyB0aHJvd24iKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWHNsdEV4Y2VwdGlvbiBlMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlMS5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXJndW1lbnROdWxsRXhjZXB0aW9uIGUyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUyLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIGlmICh4c2xJbnB1dFR5cGUgPT0gWHNsSW5wdXRUeXBlLlVSSSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJBcmd1bWVudE51bGxFeGNlcHRpb24gaXMgbm90IHN1cHBvc2VkIHRvIGJlIHRocm93biBmb3IgdGhlIGlucHV0IHR5cGUgJyIgKyB4c2xJbnB1dFR5cGUgKyAiJyIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKGlkID0gMywgRGVzYyA9ICJEZWZhdWx0IFhtbFJlc29sdmVyLCBsb2FkIHN0eWxlIHNoZWV0IHdpdGggZG9jdW1lbnQgZnVuY3Rpb24sIHNob3VsZCByZXNvbHZlIGR1cmluZyB0cmFuc2Zvcm0iLCBQcmkgPSAxLCBQYXJhbSA9ICJEZWZhdWx0UmVzb2x2ZXIudHh0IildDQogICAgICAgIFtJbmxpbmVEYXRhKCJEZWZhdWx0UmVzb2x2ZXIudHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIkRlZmF1bHRSZXNvbHZlci50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiRGVmYXVsdFJlc29sdmVyLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiRGVmYXVsdFJlc29sdmVyLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJEZWZhdWx0UmVzb2x2ZXIudHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIkRlZmF1bHRSZXNvbHZlci50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIkRlZmF1bHRSZXNvbHZlci50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiRGVmYXVsdFJlc29sdmVyLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJEZWZhdWx0UmVzb2x2ZXIudHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFhtbFJlc29sdmVyMyhvYmplY3QgcGFyYW0sIFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIEFwcENvbnRleHQuU2V0U3dpdGNoKCJTd2l0Y2guU3lzdGVtLlhtbC5BbGxvd0RlZmF1bHRSZXNvbHZlciIsIHRydWUpOw0KDQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKFRyYW5zZm9ybSgoc3RyaW5nKSAiZnJ1aXRzLnhtbCIsIChPdXRwdXRUeXBlKSBvdXRwdXRUeXBlLCBuYXZUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlByb2JsZW0gbG9hZGluZyBzdHlsZXNoZWV0IHdpdGggZG9jdW1lbnQgZnVuY3Rpb24gYW5kIGRlZmF1bHQgcmVzb2x2ZXIhIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKGlkID0gNywgRGVzYyA9ICJkb2N1bWVudCgpIGhhcyBhYnNvbHV0ZSBVUkkiLCBQcmkgPSAwKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgWG1sUmVzb2x2ZXI3KFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIEFwcENvbnRleHQuU2V0U3dpdGNoKCJTd2l0Y2guU3lzdGVtLlhtbC5BbGxvd0RlZmF1bHRSZXNvbHZlciIsIHRydWUpOw0KDQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+MTIzPC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgLy8gY29weSBmaWxlIG9uIHRoZSBsb2NhbCBtYWNoaW5lDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgdGVtcFBhdGggPSBQYXRoLkdldFRlbXBQYXRoKCk7DQogICAgICAgICAgICAgICAgc3RyaW5nIHRlc3RGaWxlID0gUGF0aC5Db21iaW5lKHRlbXBQYXRoLCAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueG1sIik7DQogICAgICAgICAgICAgICAgaWYgKEZpbGUuRXhpc3RzKHRlc3RGaWxlKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEZpbGUuU2V0QXR0cmlidXRlcyh0ZXN0RmlsZSwgRmlsZUF0dHJpYnV0ZXMuTm9ybWFsKTsNCiAgICAgICAgICAgICAgICAgICAgRmlsZS5EZWxldGUodGVzdEZpbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzdHJpbmcgeG1sRmlsZSA9IEZ1bGxGaWxlUGF0aCgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueG1sIik7DQogICAgICAgICAgICAgICAgRmlsZS5Db3B5KHhtbEZpbGUsIHRlc3RGaWxlLCB0cnVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJDb3VsZCBub3QgY29weSBmaWxlIHRvIGxvY2FsLiBTb21lIG90aGVyIGlzc3VlcyBwcmV2ZW50ZWQgdGhpcyB0ZXN0IGZyb20gcnVubmluZyIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsgLy9URVNUX1NLSVBQRUQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIGNvcHkgZmlsZSBvbiB0aGUgbG9jYWwgbWFjaGluZSAodGhpcyBpcyBub3cgZG9uZSB3aXRoIGNyZWF0ZUFQSXRlc3RmaWxlcy5qcywgc2VlIE9hc3lzIHNjZW5hcmlvLikNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbl9hYnNvbHV0ZV91cmkueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkZhaWxlZCB0byByZXNvbHZlIGRvY3VtZW50IGZ1bmN0aW9uIHdpdGggYWJzb2x1dGUgVVJJLiIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gbG9hZCBzdHlsZSBzaGVldCEiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQogICAgLyogICAgICAgICAgWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZCAtIEludGVncml0eSAgICAgICAgICAgICAgICAgICovDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBSZWFkZXIsIFJlYWRlciIsIERlc2MgPSAiUkVBREVSLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZCgpIC0gSW50ZWdyaXR5IDogUmVhZGVyLCBTdHJlYW0iLCBEZXNjID0gIlJFQURFUixTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoKSAtIEludGVncml0eSA6IFJlYWRlciwgV3JpdGVyIiwgRGVzYyA9ICJSRUFERVIsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBSZWFkZXIsIFRleHRXcml0ZXIiLCBEZXNjID0gIlJFQURFUixURVhUV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBVUkksIFJlYWRlciIsIERlc2MgPSAiVVJJLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZCgpIC0gSW50ZWdyaXR5IDogVVJJLCBTdHJlYW0iLCBEZXNjID0gIlVSSSxTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoKSAtIEludGVncml0eSA6IFVSSSwgV3JpdGVyIiwgRGVzYyA9ICJVUkksV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBVUkksIFRleHRXcml0ZXIiLCBEZXNjID0gIlVSSSxURVhUV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBOYXZpZ2F0b3IsIFJlYWRlciIsIERlc2MgPSAiTkFWSUdBVE9SLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZCgpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBTdHJlYW0iLCBEZXNjID0gIk5BVklHQVRPUixTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoKSAtIEludGVncml0eSA6IE5hdmlnYXRvciwgV3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBOYXZpZ2F0b3IsIFRleHRXcml0ZXIiLCBEZXNjID0gIk5BVklHQVRPUixURVhUV1JJVEVSIildDQogICAgcHVibGljIGNsYXNzIENMb2FkVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UyDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDTG9hZFRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKGlkID0gMSwgRGVzYyA9ICJDYWxsIExvYWQgd2l0aCBudWxsIHZhbHVlIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljMShYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0wobnVsbCwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBudWxsIHBhcmFtZXRlciBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oaWQgPSAyLCBEZXNjID0gIkxvYWQgd2l0aCB2YWxpZCwgdGhlbiBpbnZhbGlkLCB0aGVuIHZhbGlkIGFnYWluIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljMihYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIExvYWRYU0woIklEb250RXhpc3QueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5JTy5GaWxlTm90Rm91bmRFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZSwgIlN5c3RlbS54bWwiLCAiWHNsdF9Ob1N0eWxlc2hlZXRMb2FkZWQiLCBuZXcgc3RyaW5nW10geyAiIiB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRmFpbGVkIHRvIGxvYWQgc3R5bGUgc2hlZXQhIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKGlkID0gMywgRGVzYyA9ICJMb2FkIGFuIGludmFsaWQsIHRoZW4gYSB2YWxpZCBhbmQgdHJhbnNmb3JtIiwgUGFyYW0gPSAic2hvd1BhcmFtLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzMob2JqZWN0IHBhcmFtLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJJRG9udEV4aXN0LnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLklPLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoKExvYWRYU0woInNob3dQYXJhbS54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpICYmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3Igbm9uLWV4aXN0ZW50IGZpbGUgbmFtZSIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKGlkID0gNCwgRGVzYyA9ICJDYWxsIHNldmVyYWwgb3ZlcmxvYWRlZCBmdW5jdGlvbnMiLCBQYXJhbSA9ICJzaG93UGFyYW0udHh0IildDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljNChvYmplY3QgcGFyYW0sIFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBCYXNlbGluZSA9IFBhdGguQ29tYmluZSgiYmFzZWxpbmUiLCAoc3RyaW5nKXBhcmFtKTsNCiAgICAgICAgICAgIGlmICh4c2xJbnB1dFR5cGUgIT0gWHNsSW5wdXRUeXBlLlJlYWRlcikNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJzaG93UGFyYW1Mb25nTmFtZS54c2wiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCByZWFkZXJUeXBlLCBuZXcgWG1sVXJsUmVzb2x2ZXIoKSk7DQogICAgICAgICAgICBpZiAoeHNsSW5wdXRUeXBlICE9IFhzbElucHV0VHlwZS5VUkkpDQogICAgICAgICAgICAgICAgTG9hZFhTTCgic2hvd1BhcmFtTG9uZ05hbWUueHNsIiwgWHNsSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSwgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KICAgICAgICAgICAgaWYgKHhzbElucHV0VHlwZSAhPSBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yKQ0KICAgICAgICAgICAgICAgIExvYWRYU0woInNob3dQYXJhbUxvbmdOYW1lLnhzbCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIHJlYWRlclR5cGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCg0KICAgICAgICAgICAgaWYgKChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAwKSB8fCAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDApKQ0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCg0KICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQoNCiAgICAgICAgICAgIGlmICh4c2xJbnB1dFR5cGUgIT0gWHNsSW5wdXRUeXBlLk5hdmlnYXRvcikNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJzaG93UGFyYW1Mb25nTmFtZS54c2wiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCByZWFkZXJUeXBlLCBuZXcgWG1sVXJsUmVzb2x2ZXIoKSk7DQogICAgICAgICAgICBpZiAoeHNsSW5wdXRUeXBlICE9IFhzbElucHV0VHlwZS5VUkkpDQogICAgICAgICAgICAgICAgTG9hZFhTTCgic2hvd1BhcmFtTG9uZ05hbWUueHNsIiwgWHNsSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSwgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KICAgICAgICAgICAgaWYgKHhzbElucHV0VHlwZSAhPSBYc2xJbnB1dFR5cGUuUmVhZGVyKQ0KICAgICAgICAgICAgICAgIExvYWRYU0woInNob3dQYXJhbUxvbmdOYW1lLnhzbCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIHJlYWRlclR5cGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCg0KICAgICAgICAgICAgaWYgKChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChCYXNlbGluZSwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKGlkID0gNSwgRGVzYyA9ICJDYWxsIHNhbWUgb3ZlcmxvYWRlZCBMb2FkKCkgbWFueSB0aW1lcyB0aGVuIHRyYW5zZm9ybSIsIFBhcmFtID0gInNob3dQYXJhbS50eHQiKV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWM1KG9iamVjdCBwYXJhbSwgWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIEJhc2VsaW5lID0gUGF0aC5Db21iaW5lKCJiYXNlbGluZSIsIChzdHJpbmcpcGFyYW0pOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgIT0gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gbG9hZCBzdHlsZXNoZWV0IHNob3dQYXJhbS54c2wgb24gdGhlIHswfSBhdHRlbXB0IiwgaSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoKExvYWRYU0woInNob3dQYXJhbS54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpICYmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oaWQgPSA2LCBEZXNjID0gIkNhbGwgbG9hZCB3aXRoIG5vbi1leGlzdGluZyBzdHlsZXNoZWV0IildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljNihYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woIklEb250RXhpc3QueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uSU8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3Igbm9uLWV4aXN0ZW50IGZpbGUgcGFyYW1ldGVyIG5hbWUiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbihpZCA9IDcsIERlc2MgPSAiVmVyaWZ5IHRoYXQgc3R5bGUgc2hlZXQgaXMgY2xvc2VkIHByb3Blcmx5IGFmdGVyIExvYWQgLSBTaGFyZWQgUmVhZCBBY2Nlc3MiKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWM3KFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIEZpbGVTdHJlYW0gczI7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+PGZydWl0PkFwcGxlPC9mcnVpdD48ZnJ1aXQ+b3JhbmdlPC9mcnVpdD48L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICAvLyBjaGVjayBpbW1lZGlhdGVseSBhZnRlciBsb2FkIGFuZCBhZnRlciB0cmFuc2Zvcm0NCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJYbWxSZXNvbHZlcl9NYWluLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzMiA9IG5ldyBGaWxlU3RyZWFtKEZ1bGxGaWxlUGF0aCgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiKSwgRmlsZU1vZGUuT3BlbiwgRmlsZUFjY2Vzcy5SZWFkLCBGaWxlU2hhcmUuUmVhZCk7DQogICAgICAgICAgICAgICAgczIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgICAgIHMyID0gbmV3IEZpbGVTdHJlYW0oRnVsbEZpbGVQYXRoKCJYbWxSZXNvbHZlcl9NYWluLnhzbCIpLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQsIEZpbGVTaGFyZS5SZWFkKTsNCiAgICAgICAgICAgICAgICAgICAgczIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKGlkID0gOSwgRGVzYyA9ICJWZXJpZnkgdGhhdCBpbmNsdWRlZCBmaWxlcyBhcmUgY2xvc2VkIHByb3Blcmx5IGFmdGVyIExvYWQgLSBSZWFkIEFjY2VzcyIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzkoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgRmlsZVN0cmVhbSBzMjsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD48ZnJ1aXQ+QXBwbGU8L2ZydWl0PjxmcnVpdD5vcmFuZ2U8L2ZydWl0PjwvcmVzdWx0PiI7DQoNCiAgICAgICAgICAgIC8vIGNoZWNrIGltbWVkaWF0ZWx5IGFmdGVyIGxvYWQgYW5kIGFmdGVyIHRyYW5zZm9ybQ0KICAgICAgICAgICAgaWYgKExvYWRYU0woIlhtbFJlc29sdmVyX01haW4ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHMyID0gbmV3IEZpbGVTdHJlYW0oRnVsbEZpbGVQYXRoKCJYbWxSZXNvbHZlcl9TdWIueHNsIiksIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCk7DQogICAgICAgICAgICAgICAgczIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgICAgIHMyID0gbmV3IEZpbGVTdHJlYW0oRnVsbEZpbGVQYXRoKCJYbWxSZXNvbHZlcl9JbmNsdWRlLnhzbCIpLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQsIEZpbGVTaGFyZS5SZWFkKTsNCiAgICAgICAgICAgICAgICAgICAgczIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkFwcGVhcmVkIHRvIG5vdCBjbG9zZSBmaWxlIHByb3Blcmx5IGFmdGVyIGxvYWRpbmcuIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oaWQgPSAxMSwgRGVzYyA9ICJMb2FkIHN0eWxlc2hlZXQgd2l0aCBlbnRpdHkgcmVmZXJlbmNlOiBCdWcgIzY4NDUwICIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzExKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChuYXZUeXBlLlRvU3RyaW5nKCkgPT0gIkRhdGFEb2N1bWVudCIpDQogICAgICAgICAgICAgICAgLy8gU2tpcCB0aGUgdGVzdCBmb3IgRGF0YURvY3VtZW50DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PEJvb2s+DQoJCQlOYW1lDQoJCTwvQm9vaz4iOw0KDQogICAgICAgICAgICAgICAgaWYgKExvYWRYU0woImJvb2tzX2VudGl0eV9yZWYueHNsIiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgcmVhZGVyVHlwZSwgbmV3IFhtbFVybFJlc29sdmVyKCkpICE9IDEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRmFpbGVkIHRvIGxvYWQgc3R5bGVzaGVldCBib29rc19lbnRpdHlfcmVmLnhzbCIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgoTG9hZFhTTCgiYm9va3NfZW50aXR5X3JlZi54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpICYmIChUcmFuc2Zvcm0oKHN0cmluZykgImJvb2tzX2VudGl0eV9yZWYueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oaWQgPSAxMiwgRGVzYyA9ICJMb2FkIHdpdGggaW52YWxpZCBzdHlsZXNoZWV0IGFuZCB2ZXJpZnkgdGhhdCBmaWxlIGlzIGNsb3NlZCBwcm9wZXJseSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzEyKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyZWFtIHN0cm1UZW1wOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbnQgaSA9IExvYWRYU0woInhzbHRfZXJyb3IueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYc2x0RXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFRyeSB0byBvcGVuIHRoZSB4c2wgZmlsZQ0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RybVRlbXAgPSBuZXcgRmlsZVN0cmVhbShGdWxsRmlsZVBhdGgoInhzbHRfZXJyb3IueHNsIiksIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCBjbG9zZSBzdHlsZXNoZWV0IHByb3Blcmx5IGFmdGVyIGxvYWQiKTsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZXguTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgY29tcGlsZSBleGNlcHRpb24gZm9yIHN0eWxlc2hlZXQiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAvKiAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKFhtbFJlc29sdmVyKSAtIEludGVncml0eSAgICovDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKFhtbFJlc29sdmVyKSAtIEludGVncml0eSA6IFJlYWRlciwgUmVhZGVyIiwgRGVzYyA9ICJSRUFERVIsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKFhtbFJlc29sdmVyKSAtIEludGVncml0eSA6IFJlYWRlciwgU3RyZWFtIiwgRGVzYyA9ICJSRUFERVIsU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKFhtbFJlc29sdmVyKSAtIEludGVncml0eSA6IFJlYWRlciwgV3JpdGVyIiwgRGVzYyA9ICJSRUFERVIsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKFhtbFJlc29sdmVyKSAtIEludGVncml0eSA6IFJlYWRlciwgVGV4dFdyaXRlciIsIERlc2MgPSAiUkVBREVSLFRFWFRXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoWG1sUmVzb2x2ZXIpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBSZWFkZXIiLCBEZXNjID0gIk5BVklHQVRPUixSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoWG1sUmVzb2x2ZXIpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBTdHJlYW0iLCBEZXNjID0gIk5BVklHQVRPUixTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoWG1sUmVzb2x2ZXIpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBXcml0ZXIiLCBEZXNjID0gIk5BVklHQVRPUixXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoWG1sUmVzb2x2ZXIpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsVEVYVFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZChYbWxSZXNvbHZlcikgLSBJbnRlZ3JpdHkgOiBVUkksIFJlYWRlciIsIERlc2MgPSAiVVJJLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZChYbWxSZXNvbHZlcikgLSBJbnRlZ3JpdHkgOiBVUkksIFN0cmVhbSIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZChYbWxSZXNvbHZlcikgLSBJbnRlZ3JpdHkgOiBVUkksIFdyaXRlciIsIERlc2MgPSAiVVJJLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZChYbWxSZXNvbHZlcikgLSBJbnRlZ3JpdHkgOiBVUkksIFRleHRXcml0ZXIiLCBEZXNjID0gIlVSSSxURVhUV1JJVEVSIildDQogICAgcHVibGljIGNsYXNzIENMb2FkWG1sUmVzb2x2ZXJUZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZTINCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENMb2FkWG1sUmVzb2x2ZXJUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCBMb2FkIHdpdGggbnVsbCBzb3VyY2UgdmFsdWUgYW5kIG51bGwgcmVzb2x2ZXIiKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWMxKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTF9SZXNvbHZlcihudWxsLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUsIG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5Bcmd1bWVudE51bGxFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJQYXNzaW5nIG51bGwgYXJndW1lbnQgc2hvdWxkIGhhdmUgdGhyb3duIEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBudWxsIHNvdXJjZSB2YWx1ZSBhbmQgdmFsaWQgcmVzb2x2ZXIiKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWMyKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTF9SZXNvbHZlcihudWxsLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnROdWxsRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiUGFzc2luZyBudWxsIHN0eWxlc2hlZXQgc2hvdWxkIGhhdmUgdGhyb3duIEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBudWxsIFhtbFJlc29sdmVyLCBzdHlsZSBzaGVldCBkb2VzIG5vdCBoYXZlIGluY2x1ZGUvaW1wb3J0LCBVUkkgc2hvdWxkIHRocm93IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBhbmQgdGhlIHJlc3Qgc2hvdWxkbid0IGVycm9yIiwgUGFyYW0gPSAic2hvd1BhcmFtLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzMob2JqZWN0IHBhcmFtLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMX1Jlc29sdmVyKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlLCBudWxsKTsNCiAgICAgICAgICAgICAgICBUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSk7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgaWYgKHhzbElucHV0VHlwZSA9PSBYc2xJbnB1dFR5cGUuVVJJKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgdGhyb3duIGZvciB0aGUgaW5wdXQgdHlwZSAnIiArIHhzbElucHV0VHlwZSArICInIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNhbGwgTG9hZCB3aXRoIG51bGwgWG1sUmVzb2x2ZXIgYW5kIHN0eWxlc2hlZXQgaGFzIGltcG9ydC9pbmNsdWRlLCBVUkkgc2hvdWxkIHRocm93IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiwgcmVzdCB0aHJvdyBYc2x0RXhjZXB0aW9uIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljNChYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0xfUmVzb2x2ZXIoIlhtbFJlc29sdmVyX01haW4ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlLCBudWxsKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTm8gZXhjZXB0aW9uIHdhcyB0aHJvd24gd2hlbiBhIG51bGwgcmVzb2x2ZXIgaXMgcGFzc2VkIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhzbHRFeGNlcHRpb24gZTEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZTEuTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBlMikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlMi5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBpZiAoeHNsSW5wdXRUeXBlID09IFhzbElucHV0VHlwZS5VUkkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiQXJndW1lbnROdWxsRXhjZXB0aW9uIGlzIG5vdCBzdXBwb3NlZCB0byBiZSB0aHJvd24gZm9yIHRoZSBpbnB1dCB0eXBlICciICsgeHNsSW5wdXRUeXBlICsgIiciKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCBMb2FkIHdpdGggbnVsbCBjdXN0b20gcmVzb2x2ZXIgYW5kIHN0eWxlIHNoZWV0IGhhcyBpbXBvcnQvaW5jbHVkZSwgc2hvdWxkIHRocm93IEV4Y2VwdGlvbiIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzUoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBDdXN0b21OdWxsUmVzb2x2ZXIgbXlSZXNvbHZlciA9IG5ldyBDdXN0b21OdWxsUmVzb2x2ZXIoX291dHB1dCk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0xfUmVzb2x2ZXIoIlhtbFJlc29sdmVyX01haW4ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlLCBteVJlc29sdmVyKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTm8gZXhjZXB0aW9uIGlzIHRocm93biIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYc2x0RXhjZXB0aW9uIGUxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUxLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24gZTIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZTIuTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgaWYgKHhzbElucHV0VHlwZSA9PSBYc2xJbnB1dFR5cGUuVVJJKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgdGhyb3duIGZvciB0aGUgaW5wdXQgdHlwZSAnIiArIHhzbElucHV0VHlwZSArICInIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWG1sRXhjZXB0aW9uIGUzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUzLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIGlmICh4c2xJbnB1dFR5cGUgPT0gWHNsSW5wdXRUeXBlLlVSSSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJYbWxFeGNlcHRpb24gaXMgbm90IHN1cHBvc2VkIHRvIGJlIHRocm93biBmb3IgdGhlIGlucHV0IHR5cGUgJyIgKyB4c2xJbnB1dFR5cGUgKyAiJyIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBudWxsIGN1c3RvbSByZXNvbHZlciBhbmQgc3R5bGUgc2hlZXQgaGFzIG5vIGltcG9ydC9pbmNsdWRlLCBzaG91bGQgZXJyb3IgZm9yIFVSSSBvbmx5IiwgUGFyYW0gPSAiU2hvd1BhcmFtLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzYob2JqZWN0IHBhcmFtLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICBDdXN0b21OdWxsUmVzb2x2ZXIgbXlSZXNvbHZlciA9IG5ldyBDdXN0b21OdWxsUmVzb2x2ZXIoX291dHB1dCk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMX1Jlc29sdmVyKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlLCBteVJlc29sdmVyKTsNCiAgICAgICAgICAgICAgICBUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSk7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgaWYgKHhzbElucHV0VHlwZSA9PSBYc2xJbnB1dFR5cGUuVVJJKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgdGhyb3duIGZvciB0aGUgaW5wdXQgdHlwZSAnIiArIHhzbElucHV0VHlwZSArICInIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWHNsdEV4Y2VwdGlvbiBlMykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlMy5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBpZiAoeHNsSW5wdXRUeXBlID09IFhzbElucHV0VHlwZS5VUkkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiWG1sRXhjZXB0aW9uIGlzIG5vdCBzdXBwb3NlZCB0byBiZSB0aHJvd24gZm9yIHRoZSBpbnB1dCB0eXBlICciICsgeHNsSW5wdXRUeXBlICsgIiciKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiU3R5bGUgc2hlZXQgaGFzIGltcG9ydC9pbmNsdWRlLCBjYWxsIExvYWQgZmlyc3Qgd2l0aCBjdXN0b20gbnVsbCByZXNvbHZlciBhbmQgdGhlbiBkZWZhdWx0IHJlc29sdmVyLCBzaG91bGQgbm90IGZhaWwiLCBQYXJhbSA9ICJYbWxSZXNvbHZlclRlc3RNYWluLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiWG1sUmVzb2x2ZXJUZXN0TWFpbi50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiWG1sUmVzb2x2ZXJUZXN0TWFpbi50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiWG1sUmVzb2x2ZXJUZXN0TWFpbi50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJYbWxSZXNvbHZlclRlc3RNYWluLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJYbWxSZXNvbHZlclRlc3RNYWluLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJYbWxSZXNvbHZlclRlc3RNYWluLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzcob2JqZWN0IHBhcmFtLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+PGZydWl0PkFwcGxlPC9mcnVpdD48ZnJ1aXQ+b3JhbmdlPC9mcnVpdD48L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICBDdXN0b21OdWxsUmVzb2x2ZXIgbXlSZXNvbHZlciA9IG5ldyBDdXN0b21OdWxsUmVzb2x2ZXIoX291dHB1dCk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0xfUmVzb2x2ZXIoIlhtbFJlc29sdmVyX01haW4ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlLCBteVJlc29sdmVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vRm9yIGlucHV0IHR5cGVzICE9IFVSSQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5YbWwuWHNsLlhzbHRFeGNlcHRpb24gZTEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVGhlIGxvdmVseSB0aGluZyBhYm91dCB0aGlzIHRlc3QgaXMgdGhhdCB0aGUgc3R5bGVzaGVldCwgWG1sUmVzb2x2ZXJfTWFpbi54c2wsIGhhcyBhbiBpbmNsdWRlLiBHZXRFbnRpdHkgaXMgdGhlcmVmb3JlIGNhbGxlZCB0d2ljZS4gV2UgbmVlZCB0byBoYXZlIGJvdGggdGhlc2UNCiAgICAgICAgICAgICAgICAvLyBjaGVja3MgaGVyZSB0byBlbnN1cmUgdGhhdCBib3RoIHRoZSBYbWxSZXNvbHZlcl9NYWluLnhzbCBhbmQgWG1sUmVzb2x2ZXJfSW5jbHVkZS54c2wgR2V0RW50aXR5KCkgY2FsbHMgYXJlIGhhbmRsZWQuDQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZTEsICJTeXN0ZW0uWG1sIiwgIlhzbHRfQ2Fubm90TG9hZFN0eWxlc2hlZXQiLCBuZXcgc3RyaW5nW10geyBuZXcgVXJpKFVyaS5VcmlTY2hlbWVGaWxlICsgVXJpLlNjaGVtZURlbGltaXRlciArIFBhdGguR2V0RnVsbFBhdGgoRnVsbEZpbGVQYXRoKCJYbWxSZXNvbHZlcl9JbmNsdWRlLnhzbCIpKSkuVG9TdHJpbmcoKSwgIm51bGwiIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoWHVuaXQuU2RrLlRydWVFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZTEsICJTeXN0ZW0uWG1sIiwgIlhzbHRfQ2Fubm90TG9hZFN0eWxlc2hlZXQiLCBuZXcgc3RyaW5nW10geyBuZXcgVXJpKFVyaS5VcmlTY2hlbWVGaWxlICsgVXJpLlNjaGVtZURlbGltaXRlciArIFBhdGguR2V0RnVsbFBhdGgoRnVsbEZpbGVQYXRoKCJYbWxSZXNvbHZlcl9NYWluLnhzbCIpKSkuVG9TdHJpbmcoKSwgIm51bGwiIH0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChMb2FkWFNMKCJYbWxSZXNvbHZlcl9NYWluLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gbG9hZCBzdHlsZXNoZWV0IHVzaW5nIGRlZmF1bHQgcmVzb2x2ZXIiKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy9Gb3IgVVJJDQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBlMikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENoZWNrRXhwZWN0ZWRFcnJvcihlMiwgIlN5c3RlbS5YbWwiLCAiWHNsdF9DYW5ub3RMb2FkU3R5bGVzaGVldCIsIG5ldyBzdHJpbmdbXSB7IG5ldyBVcmkoVXJpLlVyaVNjaGVtZUZpbGUgKyBVcmkuU2NoZW1lRGVsaW1pdGVyICsgUGF0aC5HZXRGdWxsUGF0aChGdWxsRmlsZVBhdGgoIlhtbFJlc29sdmVyX0luY2x1ZGUueHNsIikpKS5Ub1N0cmluZygpLCAibnVsbCIgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChYdW5pdC5TZGsuVHJ1ZUV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENoZWNrRXhwZWN0ZWRFcnJvcihlMiwgIlN5c3RlbS5YbWwiLCAiWHNsdF9DYW5ub3RMb2FkU3R5bGVzaGVldCIsIG5ldyBzdHJpbmdbXSB7IG5ldyBVcmkoVXJpLlVyaVNjaGVtZUZpbGUgKyBVcmkuU2NoZW1lRGVsaW1pdGVyICsgUGF0aC5HZXRGdWxsUGF0aChGdWxsRmlsZVBhdGgoIlhtbFJlc29sdmVyX01haW4ueHNsIikpKS5Ub1N0cmluZygpLCAibnVsbCIgfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKExvYWRYU0woIlhtbFJlc29sdmVyX01haW4ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKFRyYW5zZm9ybSgoc3RyaW5nKSAiZnJ1aXRzLnhtbCIsIChPdXRwdXRUeXBlKSBvdXRwdXRUeXBlLCBuYXZUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gbG9hZCBzdHlsZXNoZWV0IHVzaW5nIGRlZmF1bHQgcmVzb2x2ZXIiKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChYbWxFeGNlcHRpb24gZTMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZTMuTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgaWYgKHhzbElucHV0VHlwZSA9PSBYc2xJbnB1dFR5cGUuVVJJKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlhtbEV4Y2VwdGlvbiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgdGhyb3duIGZvciB0aGUgaW5wdXQgdHlwZSAnIiArIHhzbElucHV0VHlwZSArICInIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiU3R5bGUgc2hlZXQgaGFzIGltcG9ydC9pbmNsdWRlLCBjYWxsIExvYWQgZmlyc3Qgd2l0aCBkZWZhdWx0IHJlc29sdmVyIGFuZCB0aGVuIHdpdGggY3VzdG9tIG51bGwgcmVzb2x2ZXIsIHNob3VsZCBmYWlsIiwgUGFyYW0gPSAiWG1sUmVzb2x2ZXJUZXN0TWFpbi50eHQiKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWM4KG9iamVjdCBwYXJhbSwgWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICBDdXN0b21OdWxsUmVzb2x2ZXIgbXlSZXNvbHZlciA9IG5ldyBDdXN0b21OdWxsUmVzb2x2ZXIoX291dHB1dCk7DQoNCiAgICAgICAgICAgIGlmICgoTG9hZFhTTCgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgTG9hZFhTTF9SZXNvbHZlcigiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUsIG15UmVzb2x2ZXIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLlhtbC5Yc2wuWHNsdEV4Y2VwdGlvbiBlMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBsb3ZlbHkgdGhpbmcgYWJvdXQgdGhpcyB0ZXN0IGlzIHRoYXQgdGhlIHN0eWxlc2hlZXQsIFhtbFJlc29sdmVyX01haW4ueHNsLCBoYXMgYW4gaW5jbHVkZS4gR2V0RW50aXR5IGlzIHRoZXJlZm9yZSBjYWxsZWQgdHdpY2UuIFdlIG5lZWQgdG8gaGF2ZSBib3RoIHRoZXNlDQogICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrcyBoZXJlIHRvIGVuc3VyZSB0aGF0IGJvdGggdGhlIFhtbFJlc29sdmVyX01haW4ueHNsIGFuZCBYbWxSZXNvbHZlcl9JbmNsdWRlLnhzbCBHZXRFbnRpdHkoKSBjYWxscyBhcmUgaGFuZGxlZC4NCiAgICAgICAgICAgICAgICAgICAgLy8gWWVzLCB0aGlzIGlzIGVmZmV0aXZlbHkgdGhlIHNhbWUgdGVzdCBhcyBMb2FkR2VuZXJpYzcsIGluIHRoYXQgd2UgdXNlIHRoZSBOdWxsUmVzb2x2ZXIgdG8gcmV0dXJuIG51bGwgZnJvbSBhIEdldEVudGl0eSBjYWxsLg0KICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tFeHBlY3RlZEVycm9yKGUxLCAiU3lzdGVtLlhtbCIsICJYc2x0X0Nhbm5vdExvYWRTdHlsZXNoZWV0IiwgbmV3IHN0cmluZ1tdIHsgbmV3IFVyaShVcmkuVXJpU2NoZW1lRmlsZSArIFVyaS5TY2hlbWVEZWxpbWl0ZXIgKyBQYXRoLkdldEZ1bGxQYXRoKEZ1bGxGaWxlUGF0aCgiWG1sUmVzb2x2ZXJfSW5jbHVkZS54c2wiKSkpLlRvU3RyaW5nKCksICJudWxsIiB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoWHVuaXQuU2RrLlRydWVFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIENoZWNrRXhwZWN0ZWRFcnJvcihlMSwgIlN5c3RlbS5YbWwiLCAiWHNsdF9DYW5ub3RMb2FkU3R5bGVzaGVldCIsIG5ldyBzdHJpbmdbXSB7IG5ldyBVcmkoVXJpLlVyaVNjaGVtZUZpbGUgKyBVcmkuU2NoZW1lRGVsaW1pdGVyICsgUGF0aC5HZXRGdWxsUGF0aChGdWxsRmlsZVBhdGgoIlhtbFJlc29sdmVyX01haW4ueHNsIikpKS5Ub1N0cmluZygpLCAibnVsbCIgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBlMikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUyLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoeHNsSW5wdXRUeXBlID09IFhzbElucHV0VHlwZS5VUkkpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgdGhyb3duIGZvciB0aGUgaW5wdXQgdHlwZSAnIiArIHhzbElucHV0VHlwZSArICInIik7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFhtbEV4Y2VwdGlvbiBlMykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUzLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoeHNsSW5wdXRUeXBlID09IFhzbElucHV0VHlwZS5VUkkpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlhtbEV4Y2VwdGlvbiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgdGhyb3duIGZvciB0aGUgaW5wdXQgdHlwZSAnIiArIHhzbElucHV0VHlwZSArICInIik7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIk5vIGV4Y2VwdGlvbiBnZW5lcmF0ZWQgd2hlbiBsb2FkaW5nIHdpdGggYW4gaW52YWxpZCByZXNvbHZlciBhZnRlciBsb2FkaW5nIHdpdGggdmFsaWQgcmVzb2x2ZXIiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiQ291bGQgbm90IGxvYWQgc3R5bGUgc2hlZXQgd2l0aCBkZWZhdWx0IHJlc29sdmVyIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgd2l0aCByZXNvbHZlciB3aXRoIGNyZWRlbnRpYWxzLCB0aGVuIGxvYWQgWFNMIHRoYXQgZG9lcyBub3QgbmVlZCBjcmVkLiIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzkoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0PjxmcnVpdD5BcHBsZTwvZnJ1aXQ+PGZydWl0Pm9yYW5nZTwvZnJ1aXQ+PC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgaWYgKChMb2FkWFNMX1Jlc29sdmVyKCJYbWxSZXNvbHZlcl9NYWluLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSwgR2V0RGVmYXVsdENyZWRSZXNvbHZlcigpKSA9PSAxKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoKExvYWRYU0woIlhtbFJlc29sdmVyX01haW4ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRmFpbGVkIHRvIGxvYWQhIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBudWxsIFJlc29sdmVyLCBmaWxlIGRvZXMgbm90IGV4aXN0IildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljMTEoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMX1Jlc29sdmVyKCJJRG9udEV4aXN0LnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSwgbnVsbCk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIk5vIGV4Y2VwdGlvbiB3YXMgdGhyb3duIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEZpbGVOb3RGb3VuZEV4Y2VwdGlvbiBlMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlMS5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXJndW1lbnROdWxsRXhjZXB0aW9uIGUyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUyLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIGlmICh4c2xJbnB1dFR5cGUgPT0gWHNsSW5wdXRUeXBlLlVSSSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJBcmd1bWVudE51bGxFeGNlcHRpb24gaXMgbm90IHN1cHBvc2VkIHRvIGJlIHRocm93biBmb3IgdGhlIGlucHV0IHR5cGUgJyIgKyB4c2xJbnB1dFR5cGUgKyAiJyIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoVXJsLCBSZXNvbHZlcikgICAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZChVcmwsIFJlc29sdmVyKSA6IFVSSSwgUmVhZGVyIiwgRGVzYyA9ICJVUkksUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKFVybCwgUmVzb2x2ZXIpIDogVVJJLCBTdHJlYW0iLCBEZXNjID0gIlVSSSxTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoVXJsLCBSZXNvbHZlcikgOiBVUkksIFdyaXRlciIsIERlc2MgPSAiVVJJLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZChVcmwsIFJlc29sdmVyKSA6IFVSSSwgVGV4dFdyaXRlciIsIERlc2MgPSAiVVJJLFRFWFRXUklURVIiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ0xvYWRVcmxSZXNvbHZlclRlc3QgOiBYc2x0QXBpVGVzdENhc2VCYXNlMg0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ0xvYWRVcmxSZXNvbHZlclRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCYXNpYyBjaGVjayBmb3IgdXNhZ2Ugb2YgY3JlZGVudGlhbHMgb24gcmVzb2x2ZXIsIGxvYWQgWFNMIHRoYXQgbmVlZHMgY3JlZC4gd2l0aCBjb3JyZWN0IHJlc29sdmVyIiwgUGFyYW0gPSAiWG1sUmVzb2x2ZXJUZXN0TWFpbi50eHQiKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRVcmxSZXNvbHZlcjEob2JqZWN0IHBhcmFtLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBYc2x0UmVzb2x2ZXJUZXN0TWFpbi54c2wgaXMgcGxhY2VkIGluIElJUyB2aXJ0dWFsIGRpcmVjdG9yeQ0KICAgICAgICAgICAgLy8gd2hpY2ggcmVxdWlyZXMgaW50ZWdyYXRlZCBXaW5kb3dzIE5UIGF1dGhlbnRpY2F0aW9uDQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICBpZiAoKExvYWRYU0xfUmVzb2x2ZXIoUGF0aC5Db21iaW5lKCJYbWxSZXNvbHZlciIsICJYbWxSZXNvbHZlclRlc3RNYWluLnhzbCIpLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUsIEdldERlZmF1bHRDcmVkUmVzb2x2ZXIoKSkgPT0gMSkgJiYNCiAgICAgICAgICAgICAgICAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChCYXNlbGluZSwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIFhTTCB0aGF0IG5lZWRzIGNyZWQuIHdpdGggbnVsbCByZXNvbHZlciwgc2hvdWxkIGZhaWwiLCBQYXJhbSA9ICJYbWxSZXNvbHZlclRlc3RNYWluLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkVXJsUmVzb2x2ZXIyKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTF9SZXNvbHZlcihQYXRoLkNvbWJpbmUoIlhtbFJlc29sdmVyIiwgIlhtbFJlc29sdmVyVGVzdE1haW4ueHNsIiksIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSwgbnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWHNsdEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlBhc3NpbmcgbnVsbCByZXNvbHZlciBzaG91bGQgaGF2ZSB0aHJvd24gWHNsdEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBudWxsIHNvdXJjZSB2YWx1ZSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkVXJsUmVzb2x2ZXIzKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTF9SZXNvbHZlcihudWxsLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJQYXNzaW5nIG51bGwgc3R5bGVzaGVldCBwYXJhbWV0ZXIgc2hvdWxkIGhhdmUgdGhyb3duIEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoVXJsKSAgICAgICAgICAgICAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uTG9hZChVcmwpIEludGVncml0eSA6IFVSSSwgU3RyZWFtIiwgRGVzYyA9ICJVUkksU1RSRUFNIildDQogICAgcHVibGljIGNsYXNzIENMb2FkU3RyaW5nVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UyDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDTG9hZFN0cmluZ1Rlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBhbiBpbnZhbGlkIHVyaSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkVXJsMShYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woIklEb250RXhpc3QueHNsIiwgWHNsSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSwgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJObyBleGNlcHRpb24gd2FzIHRocm93biIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChGaWxlTm90Rm91bmRFeGNlcHRpb24gZTEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZTEuTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgaWYgKHhzbElucHV0VHlwZSA9PSBYc2xJbnB1dFR5cGUuVVJJKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkZpbGVOb3RGb3VuZEV4Y2VwdGlvbiBpcyBzdXBwb3NlZCB0byBiZSB0aHJvd24iKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24gZTIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZTIuTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgaWYgKHhzbElucHV0VHlwZSA9PSBYc2xJbnB1dFR5cGUuVVJJKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgdGhyb3duIGZvciB0aGUgaW5wdXQgdHlwZSAnIiArIHhzbElucHV0VHlwZSArICInIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgZmlsZSB3aXRoIGVtcHR5IHN0cmluZyIpXQ0KICAgICAgICBbSW5saW5lRGF0YShSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkVXJsMihSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woc3pFbXB0eSwgWHNsSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSwgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5Bcmd1bWVudEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIGFuIGVtcHR5IHN0cmluZyBmaWxlbmFtZSIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIHdpdGggXCIuXCIiKV0NCiAgICAgICAgW0lubGluZURhdGEoUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZFVybDMoUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCIuIiwgWHNsSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSwgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5VbmF1dGhvcml6ZWRBY2Nlc3NFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBub24tZXhpc3RlbnQgZmlsZSBwYXJhbWV0ZXIgbmFtZSIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIHdpdGggXCIuLlwiIildDQogICAgICAgIFtJbmxpbmVEYXRhKFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRVcmwoUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCIuLiIsIFhzbElucHV0VHlwZS5VUkksIHJlYWRlclR5cGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uVW5hdXRob3JpemVkQWNjZXNzRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3Igbm9uLWV4aXN0ZW50IGZpbGUgcGFyYW1ldGVyIG5hbWUiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZCB3aXRoIFwiXFxcXFwiIildDQogICAgICAgIFtQbGF0Zm9ybVNwZWNpZmljKFRlc3RQbGF0Zm9ybXMuV2luZG93cyldIC8vTm90IGFuIGludmFsaWQgcGF0aCBvbiBVbml4DQogICAgICAgIFtJbmxpbmVEYXRhKFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRVcmw1KFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTCgiICAgICIsIFhzbElucHV0VHlwZS5VUkksIHJlYWRlclR5cGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBub24tZXhpc3RlbnQgZmlsZSBwYXJhbWV0ZXIgbmFtZSIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoSVhQYXRoTmF2aWdhYmxlKSAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0gLkxvYWQoSVhQYXRoTmF2aWdhYmxlKSA6IE5hdmlnYXRvciwgVGV4dFdyaXRlciIsIERlc2MgPSAiTkFWSUdBVE9SLFRFWFRXUklURVIiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ0xvYWRYUGF0aE5hdmlnYWJsZVRlc3QgOiBYc2x0QXBpVGVzdENhc2VCYXNlMg0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ0xvYWRYUGF0aE5hdmlnYWJsZVRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCYXNpYyBWZXJpZmljYXRpb24gVGVzdCIsIFBhcmFtID0gInNob3dQYXJhbS50eHQiKV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWROYXZpZ2F0b3IxKG9iamVjdCBwYXJhbSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBCYXNlbGluZSA9IFBhdGguQ29tYmluZSgiYmFzZWxpbmUiLCAoc3RyaW5nKXBhcmFtKTsNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgIFN0cmluZyBfc3RyWHNsRmlsZSA9ICJzaG93UGFyYW0ueHNsIjsNCg0KICAgICAgICAgICAgX3N0clhzbEZpbGUgPSBGdWxsRmlsZVBhdGgoX3N0clhzbEZpbGUpOw0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkNvbXBpbGluZyB7MH0iLCBfc3RyWHNsRmlsZSk7DQoNCiAgICAgICAgICAgIFhtbFJlYWRlciB4ckxvYWQgPSBYbWxSZWFkZXIuQ3JlYXRlKF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgIFhQYXRoRG9jdW1lbnQgeGRUZW1wID0gbmV3IFhQYXRoRG9jdW1lbnQoeHJMb2FkLCBYbWxTcGFjZS5QcmVzZXJ2ZSk7DQogICAgICAgICAgICB4ckxvYWQuRGlzcG9zZSgpOw0KICAgICAgICAgICAgeHNsdC5Mb2FkKHhkVGVtcCk7DQoNCiAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNyZWF0ZSBOYXZpZ2F0b3IgYW5kIG5hdmlnYXRlIGF3YXkgZnJvbSByb290IiwgUGFyYW0gPSAic2hvd1BhcmFtLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZE5hdmlnYXRvcjIob2JqZWN0IHBhcmFtLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIEJhc2VsaW5lID0gUGF0aC5Db21iaW5lKCJiYXNlbGluZSIsIChzdHJpbmcpcGFyYW0pOw0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KICAgICAgICAgICAgWG1sUmVhZGVyIHhyTG9hZCA9IFhtbFJlYWRlci5DcmVhdGUoRnVsbEZpbGVQYXRoKCJzaG93UGFyYW0ueHNsIikpOw0KICAgICAgICAgICAgWFBhdGhEb2N1bWVudCB4ZFRlbXAgPSBuZXcgWFBhdGhEb2N1bWVudCh4ckxvYWQsIFhtbFNwYWNlLlByZXNlcnZlKTsNCiAgICAgICAgICAgIHhyTG9hZC5EaXNwb3NlKCk7DQogICAgICAgICAgICBYUGF0aE5hdmlnYXRvciB4UCA9ICgoSVhQYXRoTmF2aWdhYmxlKXhkVGVtcCkuQ3JlYXRlTmF2aWdhdG9yKCk7DQoNCiAgICAgICAgICAgIHhQLk1vdmVUb05leHQoKTsNCiAgICAgICAgICAgIHhzbHQuTG9hZCh4UCk7DQoNCiAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJhc2ljIGNoZWNrIGZvciB1c2FnZSBvZiBjcmVkZW50aWFscyBvbiByZXNvbHZlciwgbG9hZCBYU0wgdGhhdCBuZWVkcyBjcmVkLiB3aXRoIGNvcnJlY3QgcmVzb2x2ZXIiLCBQYXJhbSA9ICJYbWxSZXNvbHZlclRlc3RNYWluLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiWG1sUmVzb2x2ZXJUZXN0TWFpbi50eHQiLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWROYXZpZ2F0b3IzKG9iamVjdCBwYXJhbSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgIHN0cmluZyBCYXNlbGluZSA9IFBhdGguQ29tYmluZSgiYmFzZWxpbmUiLCAoc3RyaW5nKXBhcmFtKTsNCiAgICAgICAgICAgIFhtbFJlYWRlciB4ckxvYWQgPSBYbWxSZWFkZXIuQ3JlYXRlKEZ1bGxGaWxlUGF0aChQYXRoLkNvbWJpbmUoIlhtbFJlc29sdmVyIiwgIlhtbFJlc29sdmVyVGVzdE1haW4ueHNsIikpKTsNCg0KICAgICAgICAgICAgWFBhdGhEb2N1bWVudCB4ZFRlbXAgPSBuZXcgWFBhdGhEb2N1bWVudCh4ckxvYWQsIFhtbFNwYWNlLlByZXNlcnZlKTsNCiAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIHhQID0gKChJWFBhdGhOYXZpZ2FibGUpeGRUZW1wKS5DcmVhdGVOYXZpZ2F0b3IoKTsNCg0KICAgICAgICAgICAgeHNsdC5Mb2FkKHhQLCBYc2x0U2V0dGluZ3MuVHJ1c3RlZFhzbHQsIEdldERlZmF1bHRDcmVkUmVzb2x2ZXIoKSk7DQogICAgICAgICAgICBpZiAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJSZWdyZXNzaW9uIGNhc2UgZm9yIGJ1ZyA4MDc2OCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkTmF2aWdhdG9yNCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBlID0gQXNzZXJ0LlRocm93c0FueTxYc2x0RXhjZXB0aW9uPigoKSA9Pg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PG91dD5Zb3UgYXJlIHNhZmU8L291dD4iOw0KDQogICAgICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KICAgICAgICAgICAgICAgIFhtbFJlYWRlciB4ckxvYWQgPSBYbWxSZWFkZXIuQ3JlYXRlKEZ1bGxGaWxlUGF0aCgiQnVnODA3NjgueHNsIikpOw0KICAgICAgICAgICAgICAgIFhQYXRoRG9jdW1lbnQgeGQgPSBuZXcgWFBhdGhEb2N1bWVudCh4ckxvYWQsIFhtbFNwYWNlLlByZXNlcnZlKTsNCg0KICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh4ZCwgWHNsdFNldHRpbmdzLlRydXN0ZWRYc2x0LCBuZXcgWG1sVXJsUmVzb2x2ZXIoKSk7DQoNCiAgICAgICAgICAgICAgICBGaWxlU3RyZWFtIGZzID0gbmV3IEZpbGVTdHJlYW0oX3N0ck91dEZpbGUsIEZpbGVNb2RlLkNyZWF0ZSwgRmlsZUFjY2Vzcy5SZWFkV3JpdGUpOw0KICAgICAgICAgICAgICAgIFhQYXRoTmF2aWdhdG9yIHhuID0gbmV3IE15TmF2aWdhdG9yKEZ1bGxGaWxlUGF0aCgiZm9vLnhtbCIpKTsNCiAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4biwgbnVsbCwgZnMpOw0KICAgICAgICAgICAgICAgIGZzLkRpc3Bvc2UoKTsNCg0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgQXNzZXJ0LkVxdWFsKCJDb21waWxpbmcgSlNjcmlwdC9DU2hhcnAgc2NyaXB0cyBpcyBub3Qgc3VwcG9ydGVkIiwgZS5Jbm5lckV4Y2VwdGlvbi5NZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAvKiAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKFJlYWRlcikgICAgICAgICAgICAgICAgICAgICAgKi8NCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoUmVhZGVyKSA6IFJlYWRlciwgU3RyZWFtIiwgRGVzYyA9ICJSRUFERVIsU1RSRUFNIildDQogICAgcHVibGljIGNsYXNzIENMb2FkUmVhZGVyVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UyDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDTG9hZFJlYWRlclRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCYXNpYyBWZXJpZmljYXRpb24gVGVzdCIsIFBhcmFtID0gInNob3dQYXJhbS50eHQiKV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZFhtbFJlYWRlcjEob2JqZWN0IHBhcmFtLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIEJhc2VsaW5lID0gUGF0aC5Db21iaW5lKCJiYXNlbGluZSIsIChzdHJpbmcpcGFyYW0pOw0KICAgICAgICAgICAgQm9vbGVhbiBmVEVTVF9GQUlMID0gZmFsc2U7DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQoNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHhycyA9IG5ldyBYbWxSZWFkZXJTZXR0aW5ncygpOw0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgeHJzLlByb2hpYml0RHRkID0gZmFsc2U7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICBYbWxSZWFkZXIgeHJUZW1wID0gWG1sUmVhZGVyLkNyZWF0ZShGdWxsRmlsZVBhdGgoInNob3dQYXJhbS54c2wiKSk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh4clRlbXApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmVEVTVF9GQUlMID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhyVGVtcC5EaXNwb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZlRFU1RfRkFJTCkNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICBpZiAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsaW5nIHdpdGggYSBjbG9zZWQgcmVhZGVyLCBzaG91bGQgdGhyb3cgZXhjZXB0aW9uIildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRYbWxSZWFkZXIyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KDQogICAgICAgICAgICBYbWxSZWFkZXJTZXR0aW5ncyB4cnMgPSBuZXcgWG1sUmVhZGVyU2V0dGluZ3MoKTsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIHhycy5Qcm9oaWJpdER0ZCA9IGZhbHNlOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgWG1sUmVhZGVyIHhyVGVtcCA9IFhtbFJlYWRlci5DcmVhdGUoRnVsbEZpbGVQYXRoKCJzaG93UGFyYW0ueHNsIiksIHhycyk7DQogICAgICAgICAgICB4clRlbXAuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoeHJUZW1wKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uWG1sLlhzbC5Yc2x0RXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ2hlY2tFeHBlY3RlZEVycm9yKGUsICJzeXN0ZW0ueG1sIiwgIlhzbHRfV3JvbmdTdHlsZXNoZWV0RWxlbWVudCIsIG5ldyBzdHJpbmdbXSB7ICIiIH0pOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJObyBleGNlcHRpb24gdGhyb3duIGZvciBhIGxvYWRpbmcgYSBjbG9zZWQgcmVhZGVyISIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJWZXJpZnkgUmVhZGVyIGlzbid0IGNsb3NlZCBhZnRlciBMb2FkIildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRYbWxSZWFkZXIzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgQm9vbGVhbiBmVEVTVF9GQUlMID0gZmFsc2U7DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQoNCiAgICAgICAgICAgIFhtbFJlYWRlclNldHRpbmdzIHhycyA9IG5ldyBYbWxSZWFkZXJTZXR0aW5ncygpOw0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgeHJzLlByb2hpYml0RHRkID0gZmFsc2U7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICBYbWxSZWFkZXIgeHJUZW1wID0gWG1sUmVhZGVyLkNyZWF0ZShGdWxsRmlsZVBhdGgoInNob3dQYXJhbS54c2wiKSwgeHJzKTsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNsdC5Mb2FkKHhyVGVtcCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZURVNUX0ZBSUwgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHRocm93IChleCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFmVEVTVF9GQUlMIHx8ICh4clRlbXAuUmVhZFN0YXRlICE9IFJlYWRTdGF0ZS5DbG9zZWQpKQ0KICAgICAgICAgICAgICAgICAgICBmVEVTVF9GQUlMID0gZmFsc2U7DQogICAgICAgICAgICAgICAgeHJUZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChmVEVTVF9GQUlMKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJBcHBlYXIgdG8gaGF2ZSBhY2NpZGVudGFsbHkgY2xvc2VkIHRoZSBSZWFkZXIiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlZlcmlmeSBwb3NpdGlvbiBvZiBub2RlIGluIFJlYWRlciBpcyBhdCBFT0YgYWZ0ZXIgTG9hZCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkWG1sUmVhZGVyNCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEJvb2xlYW4gZlRFU1RfRkFJTCA9IGZhbHNlOw0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KDQogICAgICAgICAgICBYbWxSZWFkZXJTZXR0aW5ncyB4cnMgPSBuZXcgWG1sUmVhZGVyU2V0dGluZ3MoKTsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIHhycy5Qcm9oaWJpdER0ZCA9IGZhbHNlOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgWG1sUmVhZGVyIHhyVGVtcCA9IFhtbFJlYWRlci5DcmVhdGUoRnVsbEZpbGVQYXRoKCJzaG93UGFyYW0ueHNsIiksIHhycyk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoeHJUZW1wKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZlRFU1RfRkFJTCA9IHRydWU7DQogICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIWZURVNUX0ZBSUwgJiYgKCF4clRlbXAuRU9GKSkNCiAgICAgICAgICAgICAgICAgICAgZlRFU1RfRkFJTCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHhyVGVtcC5EaXNwb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZlRFU1RfRkFJTCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiUmVhZGVyIGRvZXMgbm90IGFwcGVhciB0byBiZSBhdCB0aGUgZW5kIG9mIGZpbGUuIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIHdpdGggcmVhZGVyIHBvc2l0aW9uIGF0IEVPRiwgc2hvdWxkIHRocm93IGV4Y2VwdGlvbiIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkWG1sUmVhZGVyNSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIEJvb2xlYW4gZlRFU1RfRkFJTCA9IGZhbHNlOw0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KDQogICAgICAgICAgICBYbWxSZWFkZXJTZXR0aW5ncyB4cnMgPSBuZXcgWG1sUmVhZGVyU2V0dGluZ3MoKTsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIHhycy5Qcm9oaWJpdER0ZCA9IGZhbHNlOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgWG1sUmVhZGVyIHhyVGVtcCA9IFhtbFJlYWRlci5DcmVhdGUoRnVsbEZpbGVQYXRoKCJzaG93UGFyYW0ueHNsIiksIHhycyk7DQogICAgICAgICAgICB4c2x0LkxvYWQoeHJUZW1wKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh4clRlbXApOyAgLy8gc2hvdWxkIG5vdyBiZSBhdCBlbmQgYW5kIHNob3VsZCBnaXZlIGV4Y2VwdGlvbg0KICAgICAgICAgICAgICAgIGZURVNUX0ZBSUwgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5YbWwuWHNsLlhzbHRFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZSwgInN5c3RlbS54bWwiLCAiWHNsdF9Xcm9uZ1N0eWxlc2hlZXRFbGVtZW50IiwgbmV3IHN0cmluZ1tdIHsgIiIgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHJUZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChmVEVTVF9GQUlMKQ0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZCB3aXRoIE5VTEwgcmVhZGVyLCBzaG91bGQgdGhyb3cgU3lzdGVtLkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkWG1sUmVhZGVyNigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCg0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciB4clRlbXAgPSBudWxsOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoeHJUZW1wKTsgIC8vIHNob3VsZCBub3cgYmUgYXQgZW5kIGFuZCBzaG91bGQgZ2l2ZSBleGNlcHRpb24NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnROdWxsRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gdGhyb3cgU3lzdGVtLkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBmb3IgTlVMTCByZWFkZXIgaW5wdXQiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQmFzaWMgY2hlY2sgZm9yIHVzYWdlIG9mIGNyZWRlbnRpYWxzIG9uIHJlc29sdmVyLCBsb2FkIFhTTCB0aGF0IG5lZWRzIGNyZWQuIHdpdGggY29ycmVjdCByZXNvbHZlciIsIFBhcmFtID0gIlhtbFJlc29sdmVyVGVzdE1haW4udHh0IildDQogICAgICAgIFtJbmxpbmVEYXRhKCJYbWxSZXNvbHZlclRlc3RNYWluLnR4dCIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkWG1sUmVhZGVyNyhvYmplY3QgcGFyYW0sIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICBYbWxSZWFkZXIgeHJMb2FkID0gWG1sUmVhZGVyLkNyZWF0ZShGdWxsRmlsZVBhdGgoUGF0aC5Db21iaW5lKCJYbWxSZXNvbHZlciIsICJYbWxSZXNvbHZlclRlc3RNYWluLnhzbCIpKSk7DQoNCiAgICAgICAgICAgIHhzbHQuTG9hZCh4ckxvYWQsIFhzbHRTZXR0aW5ncy5UcnVzdGVkWHNsdCwgR2V0RGVmYXVsdENyZWRSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIHhyTG9hZC5EaXNwb3NlKCk7DQoNCiAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oKHN0cmluZykgImZydWl0cy54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oImJ1ZyAzODAxMzggTlJFIGR1cmluZyBYU0xUIGNvbXBpbGF0aW9uIildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIEJ1ZzM4MDEzOCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyB4c2wgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/Pg0KICAgIDx4c2w6c3R5bGVzaGVldCB2ZXJzaW9uPScxLjAnIHhtbG5zOnhzbD0naHR0cDovL3d3dy53My5vcmcvMTk5OS9YU0wvVHJhbnNmb3JtJw0KICAgICAgICB4bWxuczptcz0ndXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTp4c2x0JyBleGNsdWRlLXJlc3VsdC1wcmVmaXhlcz0nbXMnPg0KICAgICAgPHhzbDp0ZW1wbGF0ZSBtYXRjaD0nYXNmJz48eHNsOnZhbHVlLW9mIHNlbGVjdD0iIm1zOm5hbWVzcGFjZS11cmkoJ21zOmInKSIiLz48L3hzbDp0ZW1wbGF0ZT4NCiAgICA8L3hzbDpzdHlsZXNoZWV0PiI7DQogICAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybSB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKHhzbCkpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChOdWxsUmVmZXJlbmNlRXhjZXB0aW9uIG5yZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShucmUuTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgY2xhc3MgU2ltcGxlV3JhcHBlck5hdmlnYXRvciA6IFhQYXRoTmF2aWdhdG9yDQogICAgew0KICAgICAgICBwcml2YXRlIFhQYXRoTmF2aWdhdG9yIF9pbm5lck5hdmlnYXRvcjsNCiAgICAgICAgcHJpdmF0ZSBYbWxOYW1lVGFibGUgX250Ow0KDQogICAgICAgIHB1YmxpYyBTaW1wbGVXcmFwcGVyTmF2aWdhdG9yKFhQYXRoTmF2aWdhdG9yIG5hdikNCiAgICAgICAgew0KICAgICAgICAgICAgX2lubmVyTmF2aWdhdG9yID0gbmF2Ow0KICAgICAgICAgICAgX250ID0gbmV3IE5hbWVUYWJsZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIFNpbXBsZVdyYXBwZXJOYXZpZ2F0b3IoWFBhdGhOYXZpZ2F0b3IgbmF2LCBYbWxOYW1lVGFibGUgbnQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9pbm5lck5hdmlnYXRvciA9IG5hdjsNCiAgICAgICAgICAgIF9udCA9IG50Ow0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBCYXNlVVJJDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfaW5uZXJOYXZpZ2F0b3IuQmFzZVVSSTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFhQYXRoTmF2aWdhdG9yIENsb25lKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBTaW1wbGVXcmFwcGVyTmF2aWdhdG9yKF9pbm5lck5hdmlnYXRvci5DbG9uZSgpLCBfbnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgSXNFbXB0eUVsZW1lbnQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9pbm5lck5hdmlnYXRvci5Jc0VtcHR5RWxlbWVudDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgSXNTYW1lUG9zaXRpb24oWFBhdGhOYXZpZ2F0b3Igb3RoZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChvdGhlciBpcyBTaW1wbGVXcmFwcGVyTmF2aWdhdG9yKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfaW5uZXJOYXZpZ2F0b3IuSXNTYW1lUG9zaXRpb24oKG90aGVyIGFzIFNpbXBsZVdyYXBwZXJOYXZpZ2F0b3IpLl9pbm5lck5hdmlnYXRvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9pbm5lck5hdmlnYXRvci5Jc1NhbWVQb3NpdGlvbihvdGhlcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgc3RyaW5nIExvY2FsTmFtZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX250LkFkZChfaW5uZXJOYXZpZ2F0b3IuTG9jYWxOYW1lKTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgTW92ZVRvKFhQYXRoTmF2aWdhdG9yIG90aGVyKQ0KICAgICAgICB7DQogICAgICAgICAgICBTaW1wbGVXcmFwcGVyTmF2aWdhdG9yIG5hdiA9IG90aGVyIGFzIFNpbXBsZVdyYXBwZXJOYXZpZ2F0b3I7DQogICAgICAgICAgICBpZiAobmF2ICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9pbm5lck5hdmlnYXRvci5Nb3ZlVG8obmF2Ll9pbm5lck5hdmlnYXRvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBNb3ZlVG9GaXJzdEF0dHJpYnV0ZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBfaW5uZXJOYXZpZ2F0b3IuTW92ZVRvRmlyc3RBdHRyaWJ1dGUoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIE1vdmVUb0ZpcnN0Q2hpbGQoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gX2lubmVyTmF2aWdhdG9yLk1vdmVUb0ZpcnN0Q2hpbGQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIE1vdmVUb0ZpcnN0TmFtZXNwYWNlKFhQYXRoTmFtZXNwYWNlU2NvcGUgbmFtZXNwYWNlU2NvcGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBfaW5uZXJOYXZpZ2F0b3IuTW92ZVRvRmlyc3ROYW1lc3BhY2UobmFtZXNwYWNlU2NvcGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgTW92ZVRvSWQoc3RyaW5nIGlkKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gX2lubmVyTmF2aWdhdG9yLk1vdmVUb0lkKGlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIE1vdmVUb05leHQoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gX2lubmVyTmF2aWdhdG9yLk1vdmVUb05leHQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIE1vdmVUb05leHRBdHRyaWJ1dGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gX2lubmVyTmF2aWdhdG9yLk1vdmVUb05leHRBdHRyaWJ1dGUoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIE1vdmVUb05leHROYW1lc3BhY2UoWFBhdGhOYW1lc3BhY2VTY29wZSBuYW1lc3BhY2VTY29wZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIF9pbm5lck5hdmlnYXRvci5Nb3ZlVG9OZXh0TmFtZXNwYWNlKG5hbWVzcGFjZVNjb3BlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIE1vdmVUb1BhcmVudCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBfaW5uZXJOYXZpZ2F0b3IuTW92ZVRvUGFyZW50KCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBNb3ZlVG9QcmV2aW91cygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBfaW5uZXJOYXZpZ2F0b3IuTW92ZVRvUHJldmlvdXMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgTmFtZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2lubmVyTmF2aWdhdG9yLk5hbWU7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBYbWxOYW1lVGFibGUgTmFtZVRhYmxlDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfbnQ7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgTmFtZXNwYWNlVVJJDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldCB7IHJldHVybiBfbnQuQWRkKF9pbm5lck5hdmlnYXRvci5OYW1lc3BhY2VVUkkpOyB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgWFBhdGhOb2RlVHlwZSBOb2RlVHlwZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2lubmVyTmF2aWdhdG9yLk5vZGVUeXBlOyB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgc3RyaW5nIFByZWZpeA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX250LkFkZChfaW5uZXJOYXZpZ2F0b3IuUHJlZml4KTsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBWYWx1ZQ0KICAgICAgICB7DQogICAgICAgICAgICBnZXQgeyByZXR1cm4gX2lubmVyTmF2aWdhdG9yLlZhbHVlOyB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQogICAgLyogICAgICAgICAgWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtIC0gSW50ZWdyaXR5ICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKCkgSW50ZWdyaXR5IDogUmVhZGVyICwgUmVhZGVyIiwgRGVzYyA9ICJSRUFERVIsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oKSBJbnRlZ3JpdHkgOiBSZWFkZXIsIFN0cmVhbSIsIERlc2MgPSAiUkVBREVSLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKCkgSW50ZWdyaXR5IDogUmVhZGVyLCBXcml0ZXIiLCBEZXNjID0gIlJFQURFUixXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IFJlYWRlciwgVGV4dFdyaXRlciIsIERlc2MgPSAiUkVBREVSLFRFWFRXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IFVSSSwgUmVhZGVyIiwgRGVzYyA9ICJVUkksUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oKSBJbnRlZ3JpdHkgOiBVUkksIFN0cmVhbSIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKCkgSW50ZWdyaXR5IDogVVJJLCBXcml0ZXIiLCBEZXNjID0gIlVSSSxXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IFVSSSwgVGV4dFdyaXRlciIsIERlc2MgPSAiVVJJLFRFWFRXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IE5hdmlnYXRvciwgUmVhZGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oKSBJbnRlZ3JpdHkgOiBOYXZpZ2F0b3IsIFN0cmVhbSIsIERlc2MgPSAiTkFWSUdBVE9SLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKCkgSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBXcml0ZXIiLCBEZXNjID0gIk5BVklHQVRPUixXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IE5hdmlnYXRvciwgVGV4dFdyaXRlciIsIERlc2MgPSAiTkFWSUdBVE9SLFRFWFRXUklURVIiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ1RyYW5zZm9ybVRlc3RHZW5lcmljIDogWHNsdEFwaVRlc3RDYXNlQmFzZTINCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENUcmFuc2Zvcm1UZXN0R2VuZXJpYyhJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJhc2ljIFZlcmlmaWNhdGlvbiBUZXN0IiwgUGFyYW0gPSAic2hvd1BhcmFtLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1HZW5lcmljMShvYmplY3QgcGFyYW0sIFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBCYXNlbGluZSA9IFBhdGguQ29tYmluZSgiYmFzZWxpbmUiLCAoc3RyaW5nKXBhcmFtKTsNCiAgICAgICAgICAgIGlmICgoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkgJiYgKFRyYW5zZm9ybSgoc3RyaW5nKSAiZnJ1aXRzLnhtbCIsIChPdXRwdXRUeXBlKSBvdXRwdXRUeXBlLCBuYXZUeXBlKSA9PSAxKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIGFuZCBUcmFuc2Zvcm0gbXVsdGlwbGUgdGltZXMiLCBQYXJhbSA9ICJzaG93UGFyYW0udHh0IildDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybUdlbmVyaWMyKG9iamVjdCBwYXJhbSwgWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIEJhc2VsaW5lID0gUGF0aC5Db21iaW5lKCJiYXNlbGluZSIsIChzdHJpbmcpcGFyYW0pOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCA1OyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSAhPSAxKSB8fCAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpICE9IDEpKQ0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQoNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZCBvbmNlLCBUcmFuc2Zvcm0gbWFueSB0aW1lcyIsIFBhcmFtID0gInNob3dQYXJhbS50eHQiKV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtR2VuZXJpYzMob2JqZWN0IHBhcmFtLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKFRyYW5zZm9ybSgoc3RyaW5nKSAiZnJ1aXRzLnhtbCIsIChPdXRwdXRUeXBlKSBvdXRwdXRUeXBlLCBuYXZUeXBlKSAhPSAxKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiVGVzdCBmYWlsZWQgdG8gdHJhbnNmb3JtIGFmdGVyIHswfSBpdGVyYXRpb25zIiwgaSk7DQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCBUcmFuc2Zvcm0gd2l0aG91dCBsb2FkaW5nIildDQogICAgICAgIFtJbmxpbmVEYXRhKE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1HZW5lcmljNChPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xDb21waWxlZFRyYW5zZm9ybSgpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5JbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ2hlY2tFeHBlY3RlZEVycm9yKGUsICJzeXN0ZW0ueG1sIiwgIlhzbHRfTm9TdHlsZXNoZWV0TG9hZGVkIiwgbmV3IHN0cmluZ1tdIHsgIiIgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2l2ZW4gZm9yIGEgdHJhbnNmb3JtIHRoYXQgZGlkbid0IGhhdmUgYSBMb2FkIG1ldGhvZCBpbnN0YW50aWF0ZWQiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2xvc2luZyBYU0wgYW5kIFhNTCBmaWxlcyB1c2VkIGluIHRyYW5zZm9ybSwgUmVhZCBhY2Nlc3MiKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtR2VuZXJpYzUoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgRmlsZVN0cmVhbSBzMjsNCg0KICAgICAgICAgICAgaWYgKChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHMyID0gbmV3IEZpbGVTdHJlYW0oRnVsbEZpbGVQYXRoKCJzaG93UGFyYW0ueHNsIiksIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCk7DQogICAgICAgICAgICAgICAgczIuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICAgICAgczIgPSBuZXcgRmlsZVN0cmVhbShGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKSwgRmlsZU1vZGUuT3BlbiwgRmlsZUFjY2Vzcy5SZWFkKTsNCiAgICAgICAgICAgICAgICBzMi5EaXNwb3NlKCk7DQoNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRW5jb3VudGVyZWQgZXJyb3JzIHBlcmZvcm1pbmcgdHJhbnNmb3JtIGFuZCBjb3VsZCBub3QgdmVyaWZ5IGlmIGZpbGVzIHdlcmUgY2xvc2VkIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJ1ZzIwMDAzNzA3IC0gSW52YWxpZFByb2dyYW1FeGNlcHRpb24gZm9yIDIuMCBzdHlsZXNoZWV0cyBpbiBmb3J3YXJkcy1jb21wYXRpYmxlIG1vZGUiKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtR2VuZXJpYzcoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTCgiRm9yd2FyZENvbXAueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgICAgICBUcmFuc2Zvcm0oKHN0cmluZykgImRhdGEueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhzbHRFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZSwgInN5c3RlbS54bWwiLCAiWFBhdGhfU2NpZW50aWZpY05vdGF0aW9uIiwgbmV3IHN0cmluZ1tdIHsgIiIgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlhzbHRFeGNlcHRpb24gKFhQYXRoX1NjaWVudGlmaWNOb3RhdGlvbikgd2FzIGV4cGVjdGVkIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJ1ZzM4MjUwNiAtIExvYWRpbmcgc3R5bGVzaGVldCBmcm9tIGN1c3RvbSBuYXZpZ2F0b3Igd2l0aCBlbmFibGVEZWJ1ZyA9IHRydWUgY2F1c2VzIEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbiIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1HZW5lcmljOCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgIHhzbHQuTG9hZChuZXcgU2ltcGxlV3JhcHBlck5hdmlnYXRvcihuZXcgWFBhdGhEb2N1bWVudChGdWxsRmlsZVBhdGgoIkN1c3RvbU5hdi54c2wiKSkuQ3JlYXRlTmF2aWdhdG9yKCkpKTsNCg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCdWczNzgyOTMgLSBJbmNvcnJlY3QgZXJyb3IgbWVzc2FnZSB3aGVuIGFuIGF0dHJpYnV0ZSBpcyBhZGRlZCB0byBhIHJvb3Qgbm9kZSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1HZW5lcmljOShYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJSb290Tm9kZUF0dC54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgICAgIFRyYW5zZm9ybSgoc3RyaW5nKSAiZGF0YS54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWHNsdEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENoZWNrRXhwZWN0ZWRFcnJvcihlLCAic3lzdGVtLnhtbCIsICJYbWxJbF9CYWRYbWxTdGF0ZSIsIG5ldyBzdHJpbmdbXSB7ICJBdHRyaWJ1dGUiLCAiUm9vdCIgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlhzbFRyYW5zZm9ybUV4Y2VwdGlvbiAoWG1sSWxfQmFkWG1sU3RhdGUpIHdhcyBleHBlY3RlZCIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCdWczNDk3NTcgLSBkb2N1bWVudCgpIGZ1bmN0aW9uIGRvZXMgbm90IHdvcmsgd2hlbiBzdHlsZXNoZWV0IHdhcyBsb2FkZWQgZnJvbSBhIHN0cmVhbSBvciByZWFkZXIgb3IgY29uc3RydWN0ZWQgRE9NIildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybUdlbmVyaWMxMCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgIFhtbERvY3VtZW50IGRvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICAgICAgZG9jLkxvYWRYbWwoIjxkb2MgeHNsOnZlcnNpb249JzEuMCcgeG1sbnM6eHNsPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0nPiIgKyAiPHhzbDpjb3B5LW9mIHNlbGVjdD0nZG9jdW1lbnQoXCJ0ZXN0LnhtbFwiKScvPiIgKyAiPC9kb2M+Iik7DQoNCiAgICAgICAgICAgIHhzbHQuTG9hZChkb2MsIFhzbHRTZXR0aW5ncy5UcnVzdGVkWHNsdCwgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCdWczNjk0NjMgLSBJbnZhbGlkIFhQYXRoIGV4Y2VwdGlvbiBpbiBmb3J3YXJkIGNvbXBhdGliaWxpdHkgbW9kZSBzaG91bGQgcmVuZGVyIGxpbmVOdW1iZXIgbGluZVBvc2l0aW9uIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybUdlbmVyaWMxMShYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJCdWczNjk0NjMueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgICAgICBUcmFuc2Zvcm0oKHN0cmluZykgImRhdGEueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhzbHRFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZSwgInN5c3RlbS54bWwiLCAiWFBhdGhfVW5leHBlY3RlZFRva2VuIiwgbmV3IHN0cmluZ1tdIHsgIisiIH0pOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJYc2xFeGNlcHRpb24gKFhQYXRoX1VuZXhwZWN0ZWRUb2tlbikgd2FzIGV4cGVjdGVkIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAvKiAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybShSZXNvbHZlcikgLSBJbnRlZ3JpdHkgICAgICAgKi8NCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKFhtbFJlc29sdmVyKSA6IFJlYWRlciwgUmVhZGVyIiwgRGVzYyA9ICJSRUFERVIsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oWG1sUmVzb2x2ZXIpIDogUmVhZGVyLCBTdHJlYW0iLCBEZXNjID0gIlJFQURFUixTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybShYbWxSZXNvbHZlcikgOiBSZWFkZXIsIFdyaXRlciIsIERlc2MgPSAiUkVBREVSLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKFhtbFJlc29sdmVyKSA6IFJlYWRlciwgVGV4dFdyaXRlciIsIERlc2MgPSAiUkVBREVSLFRFWFRXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybShYbWxSZXNvbHZlcikgOiBVUkksIFJlYWRlciIsIERlc2MgPSAiVVJJLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKFhtbFJlc29sdmVyKSA6IFVSSSwgU3RyZWFtIiwgRGVzYyA9ICJVUkksU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oWG1sUmVzb2x2ZXIpIDogVVJJLCBXcml0ZXIiLCBEZXNjID0gIlVSSSxXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybShYbWxSZXNvbHZlcikgOiBVUkksIFRleHRXcml0ZXIiLCBEZXNjID0gIlVSSSxURVhUV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oWG1sUmVzb2x2ZXIpIDogTmF2aWdhdG9yLCBSZWFkZXIiLCBEZXNjID0gIk5BVklHQVRPUixSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybShYbWxSZXNvbHZlcikgOiBOYXZpZ2F0b3IsIFN0cmVhbSIsIERlc2MgPSAiTkFWSUdBVE9SLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKFhtbFJlc29sdmVyKSA6IE5hdmlnYXRvciwgV3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oWG1sUmVzb2x2ZXIpIDogTmF2aWdhdG9yLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsVEVYVFdSSVRFUiIpXQ0KICAgIHB1YmxpYyBjbGFzcyBDVHJhbnNmb3JtUmVzb2x2ZXJUZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZTINCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENUcmFuc2Zvcm1SZXNvbHZlclRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJQYXNzIG51bGwgWG1sUmVzb2x2ZXIsIGxvYWQgc3R5bGUgc2hlZXQgd2l0aCBpbXBvcnQvaW5jbHVkZSwgc2hvdWxkIG5vdCBhZmZlY3QgdHJhbnNmb3JtIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFhtbFJlc29sdmVyMShYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlICwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0PjxmcnVpdD5BcHBsZTwvZnJ1aXQ+PGZydWl0Pm9yYW5nZTwvZnJ1aXQ+PC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKExvYWRYU0woIlhtbFJlc29sdmVyX01haW4ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKFRyYW5zZm9ybVJlc29sdmVyKCJmcnVpdHMueG1sIiwgb3V0cHV0VHlwZSwgbmF2VHlwZSwgbnVsbCkgPT0gMSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJQYXNzIG51bGwgWG1sUmVzb2x2ZXIsIGxvYWQgc3R5bGUgc2hlZXQgd2l0aCBkb2N1bWVudCBmdW5jdGlvbiwgc2hvdWxkIG5vdCByZXNvbHZlIGR1cmluZyB0cmFuc2Zvcm0iLCBQYXJhbSA9ICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi50eHQiKV0NCiAgICAgICAgW0lubGluZURhdGEoInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24udHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgWG1sUmVzb2x2ZXIyKG9iamVjdCBwYXJhbSwgWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXBwQ29udGV4dC5TZXRTd2l0Y2goIlN3aXRjaC5TeXN0ZW0uWG1sLkFsbG93RGVmYXVsdFJlc29sdmVyIiwgdHJ1ZSk7DQoNCiAgICAgICAgICAgIC8vICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiIGNvbnRhaW5zDQogICAgICAgICAgICAvLyA8eHNsOmZvci1lYWNoIHNlbGVjdD0iZG9jdW1lbnQoJ3htbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhtbCcpLy9lbGVtIj4NCiAgICAgICAgICAgIHN0cmluZyBCYXNlbGluZSA9IFBhdGguQ29tYmluZSgiYmFzZWxpbmUiLCAoc3RyaW5nKXBhcmFtKTsNCg0KICAgICAgICAgICAgaWYgKExvYWRYU0woInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoVHJhbnNmb3JtUmVzb2x2ZXIoImZydWl0cy54bWwiLCBvdXRwdXRUeXBlLCBuYXZUeXBlLCBudWxsKSA9PSAxKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlByb2JsZW0gbG9hZGluZyBzdHlsZXNoZWV0ISIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiRGVmYXVsdCBYbWxSZXNvbHZlciwgbG9hZCBzdHlsZSBzaGVldCB3aXRoIGRvY3VtZW50IGZ1bmN0aW9uLCBzaG91bGQgcmVzb2x2ZSBkdXJpbmcgdHJhbnNmb3JtIiwgUGFyYW0gPSAiRGVmYXVsdFJlc29sdmVyLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiRGVmYXVsdFJlc29sdmVyLnR4dCIsIFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJEZWZhdWx0UmVzb2x2ZXIudHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIkRlZmF1bHRSZXNvbHZlci50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIkRlZmF1bHRSZXNvbHZlci50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiRGVmYXVsdFJlc29sdmVyLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJEZWZhdWx0UmVzb2x2ZXIudHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKCJEZWZhdWx0UmVzb2x2ZXIudHh0IiwgWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoIkRlZmF1bHRSZXNvbHZlci50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiRGVmYXVsdFJlc29sdmVyLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBYbWxSZXNvbHZlcjMob2JqZWN0IHBhcmFtLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBBcHBDb250ZXh0LlNldFN3aXRjaCgiU3dpdGNoLlN5c3RlbS5YbWwuQWxsb3dEZWZhdWx0UmVzb2x2ZXIiLCB0cnVlKTsNCg0KICAgICAgICAgICAgLy8gInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIgY29udGFpbnMNCiAgICAgICAgICAgIC8vIDx4c2w6Zm9yLWVhY2ggc2VsZWN0PSJkb2N1bWVudCgneG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueG1sJykvL2VsZW0iPg0KICAgICAgICAgICAgc3RyaW5nIEJhc2VsaW5lID0gUGF0aC5Db21iaW5lKCJiYXNlbGluZSIsIChzdHJpbmcpcGFyYW0pOw0KICAgICAgICAgICAgaWYgKExvYWRYU0woInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoVHJhbnNmb3JtKChzdHJpbmcpICJmcnVpdHMueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiUHJvYmxlbSBsb2FkaW5nIHN0eWxlc2hlZXQgd2l0aCBkb2N1bWVudCBmdW5jdGlvbiBhbmQgZGVmYXVsdCByZXNvbHZlciEiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oImRvY3VtZW50KCkgaGFzIGFic29sdXRlIFVSSSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBYbWxSZXNvbHZlcjUoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXBwQ29udGV4dC5TZXRTd2l0Y2goIlN3aXRjaC5TeXN0ZW0uWG1sLkFsbG93RGVmYXVsdFJlc29sdmVyIiwgdHJ1ZSk7DQoNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD4xMjM8L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICAvLyBjb3B5IGZpbGUgb24gdGhlIGxvY2FsIG1hY2hpbmUNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyB0ZW1wUGF0aCA9IFBhdGguR2V0VGVtcFBhdGgoKTsNCiAgICAgICAgICAgICAgICBzdHJpbmcgdGVzdEZpbGUgPSBQYXRoLkNvbWJpbmUodGVtcFBhdGgsICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54bWwiKTsNCiAgICAgICAgICAgICAgICBpZiAoRmlsZS5FeGlzdHModGVzdEZpbGUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgRmlsZS5TZXRBdHRyaWJ1dGVzKHRlc3RGaWxlLCBGaWxlQXR0cmlidXRlcy5Ob3JtYWwpOw0KICAgICAgICAgICAgICAgICAgICBGaWxlLkRlbGV0ZSh0ZXN0RmlsZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0cmluZyB4bWxGaWxlID0gRnVsbEZpbGVQYXRoKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54bWwiKTsNCiAgICAgICAgICAgICAgICBGaWxlLkNvcHkoeG1sRmlsZSwgdGVzdEZpbGUsIHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkNvdWxkIG5vdCBjb3B5IGZpbGUgdG8gbG9jYWwuIFNvbWUgb3RoZXIgaXNzdWVzIHByZXZlbnRlZCB0aGlzIHRlc3QgZnJvbSBydW5uaW5nIik7DQogICAgICAgICAgICAgICAgcmV0dXJuOyAvL1RFU1RfU0tJUFBFRDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKExvYWRYU0woInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uX2Fic29sdXRlX3VyaS54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKFRyYW5zZm9ybVJlc29sdmVyKCJmcnVpdHMueG1sIiwgb3V0cHV0VHlwZSwgbmF2VHlwZSwgbmV3IFhtbFVybFJlc29sdmVyKCkpID09IDEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gcmVzb2x2ZSBkb2N1bWVudCBmdW5jdGlvbiB3aXRoIGFic29sdXRlIFVSSS4iKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRmFpbGVkIHRvIGxvYWQgc3R5bGUgc2hlZXQhIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJQYXNzIG51bGwgcmVzb2x2ZXIgYnV0IHN0eWxlc2hlZXQgZG9lc24ndCBoYXZlIGFueSBpbmNsdWRlL2ltcG9ydHMiKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLldyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5TdHJlYW0sIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5Xcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuU3RyZWFtLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuV3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgWG1sUmVzb2x2ZXI3KFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIExvYWRYU0woIkJ1ZzM4MjE5OC54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgLy8gUGFzcyBudWxsDQogICAgICAgICAgICBUcmFuc2Zvcm1SZXNvbHZlcigiZnJ1aXRzLnhtbCIsIG91dHB1dFR5cGUsIG5hdlR5cGUsIG51bGwpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybSAtIChTdHJpbmcsIFN0cmluZykgICAgICAgICAgICAgICAgICAgICovDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oU3RyaW5nLCBTdHJpbmcpIDogUmVhZGVyICwgU3RyaW5nIiwgRGVzYyA9ICJSRUFERVIsU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oU3RyaW5nLCBTdHJpbmcpIDogVVJJLCBTdHJpbmciLCBEZXNjID0gIlVSSSxTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybShTdHJpbmcsIFN0cmluZykgOiBOYXZpZ2F0b3IsIFN0cmluZyIsIERlc2MgPSAiTkFWSUdBVE9SLFNUUkVBTSIpXQ0KICAgIHB1YmxpYyBjbGFzcyBDVHJhbnNmb3JtU3RyU3RyVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UyDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDVHJhbnNmb3JtU3RyU3RyVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJhc2ljIFZlcmlmaWNhdGlvbiBUZXN0IiwgUGFyYW0gPSAic2hvd1BhcmFtLnR4dCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1TdHJTdHIxKG9iamVjdCBwYXJhbSwgWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQogICAgICAgICAgICBTdHJpbmcgc3pGdWxsRmlsZW5hbWUgPSBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKTsNCg0KICAgICAgICAgICAgaWYgKExvYWRYU0woInNob3dQYXJhbS54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oc3pGdWxsRmlsZW5hbWUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIklucHV0IGlzIG51bGwiKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyMihYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0obnVsbCwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkFyZ3VtZW50RXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsgcmV0dXJuOyB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIG51bGwgaW5wdXQgZmlsZW5hbWUiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiT3V0cHV0IGZpbGUgaXMgbnVsbCIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1TdHJTdHIzKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyaW5nIHN6RnVsbEZpbGVuYW1lID0gRnVsbEZpbGVQYXRoKCJmcnVpdHMueG1sIik7DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oc3pGdWxsRmlsZW5hbWUsIChzdHJpbmcpbnVsbCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBudWxsIG91dHB1dCBmaWxlbmFtZSIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJJbnB1dCBpcyBub25leGlzdGluZyBmaWxlIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjQoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKCJJRG9udEV4aXN0LnhzbCIsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5JTy5GaWxlTm90Rm91bmRFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBpbnZhbGlkIGlucHV0IGZpbGUiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiT3V0cHV0IGZpbGUgaXMgaW52YWxpZCIpXQ0KICAgICAgICBbUGxhdGZvcm1TcGVjaWZpYyhUZXN0UGxhdGZvcm1zLldpbmRvd3MpXSAvL091dHB1dCBmaWxlIG5hbWUgaXMgdmFsaWQgb24gVW5peA0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1TdHJTdHI1KFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyaW5nIHN6RnVsbEZpbGVuYW1lID0gRnVsbEZpbGVQYXRoKCJmcnVpdHMueG1sIik7DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oc3pGdWxsRmlsZW5hbWUsIHN6SW52YWxpZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBpbnZhbGlkIG91dHB1dCBkZXN0aW5hdGlvbiIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJJbnB1dCBpcyBlbXB0eSBzdHJpbmciKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyNihYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oc3pFbXB0eSwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkFyZ3VtZW50RXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3IgZW1wdHkgc3RyaW5nIGlucHV0IGZpbGUiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiT3V0cHV0IGZpbGUgaXMgZW1wdHkgc3RyaW5nIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjcoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBTdHJpbmcgc3pGdWxsRmlsZW5hbWUgPSBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKTsNCg0KICAgICAgICAgICAgaWYgKExvYWRYU0woInNob3dQYXJhbS54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybShzekZ1bGxGaWxlbmFtZSwgc3pFbXB0eSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBlbXB0eSBvdXRwdXQgZmlsZSBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNhbGwgVHJhbnNmb3JtIG1hbnkgdGltZXMiLCBQYXJhbSA9ICJzaG93UGFyYW0udHh0IildDQogICAgICAgIFtJbmxpbmVEYXRhKCJzaG93UGFyYW0udHh0IiwgWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoInNob3dQYXJhbS50eHQiLCBYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgic2hvd1BhcmFtLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjgob2JqZWN0IHBhcmFtLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBCYXNlbGluZSA9IFBhdGguQ29tYmluZSgiYmFzZWxpbmUiLCAoc3RyaW5nKXBhcmFtKTsNCiAgICAgICAgICAgIFN0cmluZyBzekZ1bGxGaWxlbmFtZSA9IEZ1bGxGaWxlUGF0aCgiZnJ1aXRzLnhtbCIpOw0KDQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDUwOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKExvYWRYU0woInNob3dQYXJhbS54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybShzekZ1bGxGaWxlbmFtZSwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoQmFzZWxpbmUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgLy9fb3V0cHV0LldyaXRlTGluZSgiRmFpbGVkIHRvIHByb2Nlc3MgTG9hZCBhZnRlciBjYWxsaW5nIHswfSB0aW1lcyIsIGkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCB3aXRob3V0IGxvYWRpbmciKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyOSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgIFNldEV4cGVjdGVkRXJyb3IoIlhzbHRfTm9TdHlsZXNoZWV0TG9hZGVkIik7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybShGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKSwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5JbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ2hlY2tFeHBlY3RlZEVycm9yKGUsICJTeXN0ZW0ueG1sIiwgIlhzbHRfTm9TdHlsZXNoZWV0TG9hZGVkIiwgbmV3IHN0cmluZ1tdIHsgIiIgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBhdHRlbXB0aW5nIGEgdHJhbnNmb3JtIHdpdGhvdXQgbG9hZGluZyBhbiBYU0wgZmlsZSIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJPdXRwdXQgdG8gdW5yZWFjaGFibGUgZGVzdGluYXRpb24iKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyMTAoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgImh0dHA6Ly93d3cuSWRvbnRFeGlzdC5jb20vaW5kZXgueG1sIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uRXhjZXB0aW9uIGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBpbnZhbGlkIG91dHB1dCBkZXN0aW5hdGlvbiIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJJbnB1dCBmaWxlbmFtZSBpcyBcJy5cJywgXCcuLlwnLCBhbmQgXCdcXFxcXCciKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyMTEoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpbnQgaUNvdW50ID0gMDsNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNldEV4cGVjdGVkRXJyb3IoIlhtbF9SZXNvbHZlVXJsIik7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSgiLi4iLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaUNvdW50Kys7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSgiLiIsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5FeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpQ291bnQrKzsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKCJcXFxcIiwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlDb3VudCsrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGlDb3VudC5FcXVhbHMoMykpDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIGludmFsaWQgaW5wdXQgc291cmNlcyIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJPdXRwdXQgZmlsZW5hbWUgaXMgXCcuXCcgYW5kIFwnLi5cJyIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1TdHJTdHIxMihYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFN0cmluZyBzekZ1bGxGaWxlbmFtZSA9IEZ1bGxGaWxlUGF0aCgiZnJ1aXRzLnhtbCIpOw0KICAgICAgICAgICAgaW50IGlDb3VudCA9IDA7DQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKHN6RnVsbEZpbGVuYW1lLCAiLi4iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5FeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpQ291bnQrKzsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKHN6RnVsbEZpbGVuYW1lLCAiLiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlDb3VudCsrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGlDb3VudC5FcXVhbHMoMikpDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBpbnZhbGlkIG91cHV0IGRlc3RpbmF0aW9ucyIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJPdXRwdXQgZmlsZW5hbWUgaXMgXCdcXFxcXCciKV0NCiAgICAgICAgW1BsYXRmb3JtU3BlY2lmaWMoVGVzdFBsYXRmb3Jtcy5XaW5kb3dzKV0gIC8vIEludmFsaWQgcGF0aCBzcGVjaWZpYyB0byBXaW5kb3dzDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjEyX3dpbihYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFN0cmluZyBzekZ1bGxGaWxlbmFtZSA9IEZ1bGxGaWxlUGF0aCgiZnJ1aXRzLnhtbCIpOw0KDQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRocm93czxTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24+KCgpID0+IHhzbHQuVHJhbnNmb3JtKHN6RnVsbEZpbGVuYW1lLCAiICAgICIpKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIGludmFsaWQgb3VwdXQgZGVzdGluYXRpb25zIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNsb3NpbmcgZmlsZXMgYWZ0ZXIgdHJhbnNmb3JtIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjEzKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyaW5nIHN6RnVsbEZpbGVuYW1lID0gRnVsbEZpbGVQYXRoKCJmcnVpdHMueG1sIik7DQogICAgICAgICAgICBTdHJlYW0gc3RybVRlbXA7DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKHN6RnVsbEZpbGVuYW1lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgU3RyZWFtUmVhZGVyIGZzID0gbnVsbDsNCg0KICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIEkgY2FuIG9wZW4gYW5kIGNsb3NlIHRoZSB4bWwgZmlsZQ0KICAgICAgICAgICAgICAgIGZzID0gbmV3IFN0cmVhbVJlYWRlcihuZXcgRmlsZVN0cmVhbShzekZ1bGxGaWxlbmFtZSwgRmlsZU1vZGUuT3BlbiwgRmlsZUFjY2Vzcy5SZWFkKSk7DQogICAgICAgICAgICAgICAgZnMuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICAgICAgc3RybVRlbXAgPSBuZXcgRmlsZVN0cmVhbShzekZ1bGxGaWxlbmFtZSwgRmlsZU1vZGUuT3BlbiwgRmlsZUFjY2Vzcy5SZWFkKTsNCiAgICAgICAgICAgICAgICBzdHJtVGVtcC5EaXNwb3NlKCk7DQoNCiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBJIGNhbiBvcGVuIGFuZCBjbG9zZSB0aGUgb3V0cHV0IGZpbGUNCiAgICAgICAgICAgICAgICBmcyA9IG5ldyBTdHJlYW1SZWFkZXIobmV3IEZpbGVTdHJlYW0oX3N0ck91dEZpbGUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpOw0KICAgICAgICAgICAgICAgIGZzLkRpc3Bvc2UoKTsNCg0KICAgICAgICAgICAgICAgIHN0cm1UZW1wID0gbmV3IEZpbGVTdHJlYW0oX3N0ck91dEZpbGUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCk7DQogICAgICAgICAgICAgICAgc3RybVRlbXAuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbENvbXBpbGVkVHJhbnNmb3JtLlRyYW5zZm9ybSAtIChTdHJpbmcsIFN0cmluZywgUmVzb2x2ZXIpICAgICAgICAgICovDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oU3RyaW5nLCBTdHJpbmcsIFJlc29sdmVyKSA6IFJlYWRlciAsIFN0cmluZyIsIERlc2MgPSAiUkVBREVSLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKFN0cmluZywgU3RyaW5nLCBSZXNvbHZlcikgOiBVUkksIFN0cmluZyIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKFN0cmluZywgU3RyaW5nLCBSZXNvbHZlcikgOiBOYXZpZ2F0b3IsIFN0cmluZyIsIERlc2MgPSAiTkFWSUdBVE9SLFNUUkVBTSIpXQ0KICAgIHB1YmxpYyBjbGFzcyBDVHJhbnNmb3JtU3RyU3RyUmVzb2x2ZXJUZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZTINCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENUcmFuc2Zvcm1TdHJTdHJSZXNvbHZlclRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJQYXNzIG51bGwgWG1sUmVzb2x2ZXIgdG8gVHJhbnNmb3JtLCBsb2FkIHN0eWxlIHNoZWV0IHdpdGggaW1wb3J0L2luY2x1ZGUsIHNob3VsZCBub3QgYWZmZWN0IHRyYW5zZm9ybSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1TdHJTdHJSZXNvbHZlcjEoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBTdHJpbmcgc3pGdWxsRmlsZW5hbWUgPSBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKTsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPHJlc3VsdD4NCiAgPGZydWl0PkFwcGxlPC9mcnVpdD4NCiAgPGZydWl0Pm9yYW5nZTwvZnJ1aXQ+DQo8L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICBpZiAoTG9hZFhTTCgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgeHIgPSBuZXcgWG1sVGV4dFJlYWRlcihzekZ1bGxGaWxlbmFtZSk7DQogICAgICAgICAgICAgICAgWG1sVGV4dFdyaXRlciB4dyA9IG5ldyBYbWxUZXh0V3JpdGVyKCJvdXQueG1sIiwgRW5jb2RpbmcuVW5pY29kZSk7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeHIsIG51bGwsIHh3LCBudWxsKTsNCiAgICAgICAgICAgICAgICB4ci5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgeHcuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJQYXNzIG51bGwgWG1sUmVzb2x2ZXIsIGxvYWQgc3R5bGUgc2hlZXQgd2l0aCBkb2N1bWVudCBmdW5jdGlvbiwgc2hvdWxkIG5vdCByZXNvbHZlIGR1cmluZyB0cmFuc2Zvcm0iKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyUmVzb2x2ZXIyKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXBwQ29udGV4dC5TZXRTd2l0Y2goIlN3aXRjaC5TeXN0ZW0uWG1sLkFsbG93RGVmYXVsdFJlc29sdmVyIiwgdHJ1ZSk7DQoNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD48ZWxlbT4xPC9lbGVtPjxlbGVtPjI8L2VsZW0+PGVsZW0+MzwvZWxlbT48L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICAvLyAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueHNsIiBjb250YWlucw0KICAgICAgICAgICAgLy8gPHhzbDpmb3ItZWFjaCBzZWxlY3Q9ImRvY3VtZW50KCd4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54bWwnKS8vZWxlbSI+DQoNCiAgICAgICAgICAgIFN0cmluZyBzekZ1bGxGaWxlbmFtZSA9IEZ1bGxGaWxlUGF0aCgiZnJ1aXRzLnhtbCIpOw0KDQogICAgICAgICAgICBpZiAoTG9hZFhTTCgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKHN6RnVsbEZpbGVuYW1lLCAib3V0LnhtbCIpOw0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlByb2JsZW0gbG9hZGluZyBzdHlsZXNoZWV0ISIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiUGFzcyBYbWxVcmxSZXNvbHZlciwgbG9hZCBzdHlsZSBzaGVldCB3aXRoIGRvY3VtZW50IGZ1bmN0aW9uLCBzaG91bGQgcmVzb2x2ZSBkdXJpbmcgdHJhbnNmb3JtIiwgUGFyYW0gPSAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24udHh0IildDQogICAgICAgIFtJbmxpbmVEYXRhKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi50eHQiLCBYc2xJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24udHh0IiwgWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnR4dCIsIFhzbElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0clJlc29sdmVyMyhvYmplY3QgcGFyYW0sIFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXBwQ29udGV4dC5TZXRTd2l0Y2goIlN3aXRjaC5TeXN0ZW0uWG1sLkFsbG93RGVmYXVsdFJlc29sdmVyIiwgdHJ1ZSk7DQoNCiAgICAgICAgICAgIC8vICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiIGNvbnRhaW5zDQogICAgICAgICAgICAvLyA8eHNsOmZvci1lYWNoIHNlbGVjdD0iZG9jdW1lbnQoJ3htbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhtbCcpLy9lbGVtIj4NCg0KICAgICAgICAgICAgU3RyaW5nIHN6RnVsbEZpbGVuYW1lID0gRnVsbEZpbGVQYXRoKCJmcnVpdHMueG1sIik7DQogICAgICAgICAgICBzdHJpbmcgQmFzZWxpbmUgPSBQYXRoLkNvbWJpbmUoImJhc2VsaW5lIiwgKHN0cmluZylwYXJhbSk7DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oc3pGdWxsRmlsZW5hbWUsICJvdXQueG1sIik7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEJhc2VsaW5lLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJQcm9ibGVtIGxvYWRpbmcgc3R5bGVzaGVldCB3aXRoIGRvY3VtZW50IGZ1bmN0aW9uIGFuZCBkZWZhdWx0IHJlc29sdmVyISIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsQ29tcGlsZWRUcmFuc2Zvcm0uVHJhbnNmb3JtKElYUGF0aE5hdmlnYWJsZSwgWHNsdEFyZ3VtZW50TGlzdCwgWG1sV3JpdGVyLCBYbWxSZXNvbHZlcikiLCBEZXNjID0gIkNvbnN0cnVjdG9yIFRlc3RzIiwgUGFyYW0gPSAiSVhQYXRoTmF2aWdhYmxlIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybS5UcmFuc2Zvcm0oWG1sUmVhZGVyLCBYc2x0QXJndW1lbnRMaXN0LCBYbWxXcml0ZXIsIFhtbFJlc29sdmVyKSIsIERlc2MgPSAiQ29uc3RydWN0b3IgVGVzdHMiLCBQYXJhbSA9ICJYbWxSZWFkZXIiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ1RyYW5zZm9ybUNvbnN0cnVjdG9yV2lodEZvdXJQYXJhbWV0ZXJzVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UyDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDVHJhbnNmb3JtQ29uc3RydWN0b3JXaWh0Rm91clBhcmFtZXRlcnNUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIGludGVybmFsIGNsYXNzIEN1c3RvbVhtbFJlc29sdmVyIDogWG1sVXJsUmVzb2x2ZXINCiAgICAgICAgew0KICAgICAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX2Jhc2VVcmk7DQoNCiAgICAgICAgICAgIHB1YmxpYyBDdXN0b21YbWxSZXNvbHZlcihzdHJpbmcgYmFzZVVyaSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfYmFzZVVyaSA9IGJhc2VVcmk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBvdmVycmlkZSBVcmkgUmVzb2x2ZVVyaShVcmkgYmFzZVVyaSwgc3RyaW5nIHJlbGF0aXZlVXJpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChiYXNlVXJpID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBiYXNlLlJlc29sdmVVcmkobmV3IFVyaShVcmkuVXJpU2NoZW1lRmlsZSArIFVyaS5TY2hlbWVEZWxpbWl0ZXIgKyBfYmFzZVVyaSksIHJlbGF0aXZlVXJpKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZS5SZXNvbHZlVXJpKGJhc2VVcmksIHJlbGF0aXZlVXJpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiSW1wb3J0L0luY2x1ZGUsIEN1c3RvbVhtbFJlc29sdmVyIiwgUHJpID0gMCwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgIlhtbFJlc29sdmVyX01haW4ueHNsIiwgImZydWl0cy54bWwiLCAieG1sUmVzb2x2ZXJfbWFpbi50eHQiLCAiQ3VzdG9tWG1sUmVzb2x2ZXIiLCB0cnVlIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCAiZnJ1aXRzLnhtbCIsICJ4bWxSZXNvbHZlcl9tYWluLnR4dCIsICJDdXN0b21YbWxSZXNvbHZlciIsIHRydWUsICJJWFBhdGhOYXZpZ2FibGUiKV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyX01haW4ueHNsIiwgImZydWl0cy54bWwiLCAieG1sUmVzb2x2ZXJfbWFpbi50eHQiLCAiQ3VzdG9tWG1sUmVzb2x2ZXIiLCB0cnVlLCAiWG1sUmVhZGVyIildDQogICAgICAgIC8vW1ZhcmlhdGlvbigiSW1wb3J0L0luY2x1ZGUsIE51bGxSZXNvbHZlciIsIFByaSA9IDAsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJYbWxSZXNvbHZlcl9NYWluLnhzbCIsICJmcnVpdHMueG1sIiwgInhtbFJlc29sdmVyX21haW4udHh0IiwgIk51bGxSZXNvbHZlciIsIGZhbHNlIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCAiZnJ1aXRzLnhtbCIsICJ4bWxSZXNvbHZlcl9tYWluLnR4dCIsICJOdWxsUmVzb2x2ZXIiLCBmYWxzZSwgIklYUGF0aE5hdmlnYWJsZSIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCAiZnJ1aXRzLnhtbCIsICJ4bWxSZXNvbHZlcl9tYWluLnR4dCIsICJOdWxsUmVzb2x2ZXIiLCBmYWxzZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYWxpZENhc2VzX0V4dGVybmFsVVJJKG9iamVjdCBwYXJhbTAsIG9iamVjdCBwYXJhbTEsIG9iamVjdCBwYXJhbTIsIG9iamVjdCBwYXJhbTMsIG9iamVjdCBwYXJhbTQsIG9iamVjdCBwYXJhbTUpDQogICAgICAgIHsNCiAgICAgICAgICAgIEFwcENvbnRleHQuU2V0U3dpdGNoKCJTd2l0Y2guU3lzdGVtLlhtbC5BbGxvd0RlZmF1bHRSZXNvbHZlciIsIHRydWUpOw0KDQogICAgICAgICAgICBWYWxpZENhc2VzKHBhcmFtMCwgcGFyYW0xLCBwYXJhbTIsIHBhcmFtMywgcGFyYW00LCBwYXJhbTUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJEb2N1bWVudCBmdW5jdGlvbiAxLCBDdXN0b21YbWxSZXNvbHZlciIsIFByaSA9IDAsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiLCAiZnJ1aXRzLnhtbCIsICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi50eHQiLCAiQ3VzdG9tWG1sUmVzb2x2ZXIiLCB0cnVlIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueHNsIiwgImZydWl0cy54bWwiLCAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24udHh0IiwgIkN1c3RvbVhtbFJlc29sdmVyIiwgdHJ1ZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueHNsIiwgImZydWl0cy54bWwiLCAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24udHh0IiwgIkN1c3RvbVhtbFJlc29sdmVyIiwgdHJ1ZSwgIklYUGF0aE5hdmlnYWJsZSIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oIkRvY3VtZW50IGZ1bmN0aW9uIDEsIFhtbFVybFJlc29sdmVyIiwgUHJpID0gMCwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsICJmcnVpdHMueG1sIiwgInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnR4dCIsICJYbWxVcmxSZXNvbHZlciIsIHRydWUgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiLCAiZnJ1aXRzLnhtbCIsICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi50eHQiLCAiWG1sVXJsUmVzb2x2ZXIiLCB0cnVlLCAiSVhQYXRoTmF2aWdhYmxlIildDQogICAgICAgIFtJbmxpbmVEYXRhKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiLCAiZnJ1aXRzLnhtbCIsICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi50eHQiLCAiWG1sVXJsUmVzb2x2ZXIiLCB0cnVlLCAiWG1sUmVhZGVyIildDQogICAgICAgIC8vW1ZhcmlhdGlvbigiRG9jdW1lbnQgZnVuY3Rpb24gMSwgTnVsbFJlc29sdmVyIiwgUHJpID0gMCwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsICJmcnVpdHMueG1sIiwgInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnR4dCIsICJOdWxsUmVzb2x2ZXIiLCBmYWxzZSB9KV0NCiAgICAgICAvLyBbSW5saW5lRGF0YSgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueHNsIiwgImZydWl0cy54bWwiLCAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24udHh0IiwgIk51bGxSZXNvbHZlciIsIGZhbHNlLCAiSVhQYXRoTmF2aWdhYmxlIildDQogICAgICAgLy8gW0lubGluZURhdGEoInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsICJmcnVpdHMueG1sIiwgInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnR4dCIsICJOdWxsUmVzb2x2ZXIiLCBmYWxzZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oIk5vIEltcG9ydC9JbmNsdWRlLCBDdXN0b21YbWxSZXNvbHZlciIsIFByaSA9IDAsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJCdWczODIxOTgueHNsIiwgImZydWl0cy54bWwiLCAiYnVnMzgyMTk4LnR4dCIsICJDdXN0b21YbWxSZXNvbHZlciIsIHRydWUgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJCdWczODIxOTgueHNsIiwgImZydWl0cy54bWwiLCAiYnVnMzgyMTk4LnR4dCIsICJDdXN0b21YbWxSZXNvbHZlciIsIHRydWUsICJJWFBhdGhOYXZpZ2FibGUiKV0NCiAgICAgICAgW0lubGluZURhdGEoIkJ1ZzM4MjE5OC54c2wiLCAiZnJ1aXRzLnhtbCIsICJidWczODIxOTgudHh0IiwgIkN1c3RvbVhtbFJlc29sdmVyIiwgdHJ1ZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oIkltcG9ydC9JbmNsdWRlLCBYbWxVcmxSZXNvbHZlciIsIFByaSA9IDAsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJYbWxSZXNvbHZlcl9NYWluLnhzbCIsICJmcnVpdHMueG1sIiwgInhtbFJlc29sdmVyX21haW4udHh0IiwgIlhtbFVybFJlc29sdmVyIiwgdHJ1ZSB9KV0NCiAgICAgICAgW0lubGluZURhdGEoIlhtbFJlc29sdmVyX01haW4ueHNsIiwgImZydWl0cy54bWwiLCAieG1sUmVzb2x2ZXJfbWFpbi50eHQiLCAiWG1sVXJsUmVzb2x2ZXIiLCB0cnVlLCAiSVhQYXRoTmF2aWdhYmxlIildDQogICAgICAgIFtJbmxpbmVEYXRhKCJYbWxSZXNvbHZlcl9NYWluLnhzbCIsICJmcnVpdHMueG1sIiwgInhtbFJlc29sdmVyX21haW4udHh0IiwgIlhtbFVybFJlc29sdmVyIiwgdHJ1ZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oIk5vIEltcG9ydC9JbmNsdWRlLCBYbWxVcmxSZXNvbHZlciIsIFByaSA9IDAsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7ICJCdWczODIxOTgueHNsIiwgImZydWl0cy54bWwiLCAiYnVnMzgyMTk4LnR4dCIsICJYbWxVcmxSZXNvbHZlciIsIHRydWUgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKCJCdWczODIxOTgueHNsIiwgImZydWl0cy54bWwiLCAiYnVnMzgyMTk4LnR4dCIsICJYbWxVcmxSZXNvbHZlciIsIHRydWUsICJJWFBhdGhOYXZpZ2FibGUiKV0NCiAgICAgICAgW0lubGluZURhdGEoIkJ1ZzM4MjE5OC54c2wiLCAiZnJ1aXRzLnhtbCIsICJidWczODIxOTgudHh0IiwgIlhtbFVybFJlc29sdmVyIiwgdHJ1ZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oIk5vIEltcG9ydC9JbmNsdWRlLCBOdWxsUmVzb2x2ZXIiLCBQcmkgPSAwLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAiQnVnMzgyMTk4LnhzbCIsICJmcnVpdHMueG1sIiwgImJ1ZzM4MjE5OC50eHQiLCAiTnVsbFJlc29sdmVyIiwgdHJ1ZSB9KV0NCiAgICAgICAgW0lubGluZURhdGEoIkJ1ZzM4MjE5OC54c2wiLCAiZnJ1aXRzLnhtbCIsICJidWczODIxOTgudHh0IiwgIk51bGxSZXNvbHZlciIsIHRydWUsICJJWFBhdGhOYXZpZ2FibGUiKV0NCiAgICAgICAgW0lubGluZURhdGEoIkJ1ZzM4MjE5OC54c2wiLCAiZnJ1aXRzLnhtbCIsICJidWczODIxOTgudHh0IiwgIk51bGxSZXNvbHZlciIsIHRydWUsICJYbWxSZWFkZXIiKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFsaWRDYXNlcyhvYmplY3QgcGFyYW0wLCBvYmplY3QgcGFyYW0xLCBvYmplY3QgcGFyYW0yLCBvYmplY3QgcGFyYW0zLCBvYmplY3QgcGFyYW00LCBvYmplY3QgcGFyYW01KQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgeHNsRmlsZSA9IEZ1bGxGaWxlUGF0aChwYXJhbTAgYXMgc3RyaW5nKTsNCiAgICAgICAgICAgIHN0cmluZyB4bWxGaWxlID0gRnVsbEZpbGVQYXRoKHBhcmFtMSBhcyBzdHJpbmcpOw0KICAgICAgICAgICAgc3RyaW5nIGJhc2VMaW5lRmlsZSA9IFBhdGguQ29tYmluZSgiYmFzZWxpbmUiLCBwYXJhbTIgYXMgc3RyaW5nKTsNCiAgICAgICAgICAgIGJvb2wgZXhwZWN0ZWRSZXN1bHQgPSAoYm9vbClwYXJhbTQ7DQogICAgICAgICAgICBib29sIGFjdHVhbFJlc3VsdCA9IGZhbHNlOw0KDQogICAgICAgICAgICBYbWxSZWFkZXIgeG1sUmVhZGVyID0gWG1sUmVhZGVyLkNyZWF0ZSh4bWxGaWxlKTsNCiAgICAgICAgICAgIC8vTGV0J3Mgc2VsZWN0IHJhbmRvbWx5IGhvdyB0byBjcmVhdGUgbmF2aWdhdG9yDQogICAgICAgICAgICBJWFBhdGhOYXZpZ2FibGUgbmF2aWdhdG9yID0gbnVsbDsNCiAgICAgICAgICAgIFJhbmRvbSByYW5kR2VuZXJhdG9yID0gbmV3IFJhbmRvbSh1bmNoZWNrZWQoKGludClEYXRlVGltZS5Ob3cuVGlja3MpKTsNCiAgICAgICAgICAgIHN3aXRjaCAocmFuZEdlbmVyYXRvci5OZXh0KDIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlVzaW5nIFhtbERvY3VtZW50LkNyZWF0ZU5hdmlnYXRvcigpIik7DQogICAgICAgICAgICAgICAgICAgIFhtbERvY3VtZW50IHhtbERvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgICAgICB4bWxEb2MuTG9hZCh4bWxGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdG9yID0geG1sRG9jLkNyZWF0ZU5hdmlnYXRvcigpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlVzaW5nIFhQYXRoRG9jdW1lbnQuQ3JlYXRlTmF2aWdhdG9yKCkiKTsNCiAgICAgICAgICAgICAgICAgICAgWFBhdGhEb2N1bWVudCB4cGF0aERvYzsNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKFhtbFJlYWRlciByZWFkZXIgPSBYbWxSZWFkZXIuQ3JlYXRlKHhtbEZpbGUpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB4cGF0aERvYyA9IG5ldyBYUGF0aERvY3VtZW50KHJlYWRlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IgPSB4cGF0aERvYy5DcmVhdGVOYXZpZ2F0b3IoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBYbWxSZXNvbHZlciByZXNvbHZlciA9IG51bGw7DQogICAgICAgICAgICBzd2l0Y2ggKHBhcmFtMyBhcyBzdHJpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSAiTnVsbFJlc29sdmVyIjoNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBjYXNlICJYbWxVcmxSZXNvbHZlciI6DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSAiQ3VzdG9tWG1sUmVzb2x2ZXIiOg0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IG5ldyBDdXN0b21YbWxSZXNvbHZlcihQYXRoLkdldEZ1bGxQYXRoKFBhdGguQ29tYmluZShGaWxlUGF0aFV0aWwuR2V0VGVzdERhdGFQYXRoKCksIEAiWHNsdEFwaVYyIikpKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWHNsQ29tcGlsZWRUcmFuc2Zvcm0gbG9jYWxYc2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICAgICAgWHNsdFNldHRpbmdzIHNldHRpbmdzID0gbmV3IFhzbHRTZXR0aW5ncyh0cnVlLCB0cnVlKTsNCiAgICAgICAgICAgICAgICB1c2luZyAoWG1sUmVhZGVyIHhzbFJlYWRlciA9IFhtbFJlYWRlci5DcmVhdGUoeHNsRmlsZSkpDQogICAgICAgICAgICAgICAgICAgIGxvY2FsWHNsdC5Mb2FkKHhzbFJlYWRlciwgc2V0dGluZ3MsIHJlc29sdmVyKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChYbWxXcml0ZXIgd3JpdGVyID0gWG1sV3JpdGVyLkNyZWF0ZSgib3V0cHV0RmlsZS50eHQiKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbTUgYXMgc3RyaW5nID09ICJYbWxSZWFkZXIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxYc2x0LlRyYW5zZm9ybSh4bWxSZWFkZXIsIG51bGwsIHdyaXRlciwgcmVzb2x2ZXIpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFhzbHQuVHJhbnNmb3JtKG5hdmlnYXRvciwgbnVsbCwgd3JpdGVyLCByZXNvbHZlcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChiYXNlTGluZUZpbGUsICJvdXRwdXRGaWxlLnR4dCIpOw0KICAgICAgICAgICAgICAgIGFjdHVhbFJlc3VsdCA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGV4Lk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIGFjdHVhbFJlc3VsdCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoYWN0dWFsUmVzdWx0ICE9IGV4cGVjdGVkUmVzdWx0KQ0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJJbnZhbGlkIEFyZ3VtZW50czogbnVsbCwgdmFsaWQsIHZhbGlkLCB2YWxpZCIsIFByaSA9IDAsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7IDEsIGZhbHNlIH0pXQ0KICAgICAgICBbSW5saW5lRGF0YSgxLCBmYWxzZSwgIklYUGF0aE5hdmlnYWJsZSIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgxLCBmYWxzZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICAvL1tWYXJpYXRpb24oIkludmFsaWQgQXJndW1lbnRzOiB2YWxpZCwgbnVsbCwgdmFsaWQsIHZhbGlkIiwgUHJpID0gMCwgUGFyYW1zID0gbmV3IG9iamVjdFtdIHsgMiwgdHJ1ZSB9KV0NCiAgICAgICAgW0lubGluZURhdGEoMiwgdHJ1ZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgyLCB0cnVlLCAiSVhQYXRoTmF2aWdhYmxlIildDQogICAgICAgIC8vW1ZhcmlhdGlvbigiSW52YWxpZCBBcmd1bWVudHM6IHZhbGlkLCB2YWxpZCwgbnVsbCwgdmFsaWQiLCBQcmkgPSAwLCBQYXJhbXMgPSBuZXcgb2JqZWN0W10geyAzLCBmYWxzZSB9KV0NCiAgICAgICAgW0lubGluZURhdGEoMywgZmFsc2UsICJJWFBhdGhOYXZpZ2FibGUiKV0NCiAgICAgICAgW0lubGluZURhdGEoMywgZmFsc2UsICJYbWxSZWFkZXIiKV0NCiAgICAgICAgLy9bVmFyaWF0aW9uKCJJbnZhbGlkIEFyZ3VtZW50czogdmFsaWQsIHZhbGlkLCB2YWxpZCwgbnVsbCIsIFByaSA9IDAsIFBhcmFtcyA9IG5ldyBvYmplY3RbXSB7IDQsIHRydWUgfSldDQogICAgICAgIFtJbmxpbmVEYXRhKDQsIHRydWUsICJJWFBhdGhOYXZpZ2FibGUiKV0NCiAgICAgICAgW0lubGluZURhdGEoNCwgdHJ1ZSwgIlhtbFJlYWRlciIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBJblZhbGlkQ2FzZXMob2JqZWN0IHBhcmFtMCwgb2JqZWN0IHBhcmFtMSwgb2JqZWN0IHBhcmFtMikNCiAgICAgICAgew0KICAgICAgICAgICAgaW50IGFyZ3VtZW50TnVtYmVyID0gKGludClwYXJhbTA7DQogICAgICAgICAgICBib29sIGV4cGVjdGVkUmVzdWx0ID0gKGJvb2wpcGFyYW0xOw0KICAgICAgICAgICAgYm9vbCBhY3R1YWxSZXN1bHQgPSBmYWxzZTsNCg0KICAgICAgICAgICAgWHNsQ29tcGlsZWRUcmFuc2Zvcm0gbG9jYWxYc2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICBzdHJpbmcgc3R5bGVzaGVldCA9IEAiPHhzbDpzdHlsZXNoZWV0IHZlcnNpb249IiIxLjAiIiB4bWxuczp4c2w9IiJodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0iIiAvPiI7DQogICAgICAgICAgICB1c2luZyAoWG1sUmVhZGVyIHhzbFJlYWRlciA9IFhtbFJlYWRlci5DcmVhdGUobmV3IFN0cmluZ1JlYWRlcihzdHlsZXNoZWV0KSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbG9jYWxYc2x0LkxvYWQoeHNsUmVhZGVyKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc3RyaW5nIHhtbFN0cmluZyA9ICI8cm9vdCAvPiI7DQogICAgICAgICAgICBYbWxEb2N1bWVudCB4bWxEb2MgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIHhtbERvYy5Mb2FkWG1sKHhtbFN0cmluZyk7DQogICAgICAgICAgICBYbWxSZWFkZXIgeG1sUmVhZGVyID0gWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKHhtbFN0cmluZykpOw0KICAgICAgICAgICAgWFBhdGhOYXZpZ2F0b3IgbmF2ID0geG1sRG9jLkNyZWF0ZU5hdmlnYXRvcigpOw0KICAgICAgICAgICAgb2JqZWN0W10gdGVzdElucHV0ID0gbmV3IG9iamVjdFtdIHsgeG1sUmVhZGVyLCBuYXYsIG5ldyBYc2x0QXJndW1lbnRMaXN0KCksIFhtbFdyaXRlci5DcmVhdGUoU3RyZWFtLk51bGwpLCBuZXcgWG1sVXJsUmVzb2x2ZXIoKSB9Ow0KICAgICAgICAgICAgaWYgKGFyZ3VtZW50TnVtYmVyID09IDEpDQogICAgICAgICAgICAgICAgdGVzdElucHV0WzBdID0gbnVsbDsNCiAgICAgICAgICAgIHRlc3RJbnB1dFthcmd1bWVudE51bWJlcl0gPSBudWxsOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAocGFyYW0yIGFzIHN0cmluZyA9PSAiWG1sUmVhZGVyIikNCiAgICAgICAgICAgICAgICAgICAgbG9jYWxYc2x0LlRyYW5zZm9ybSh0ZXN0SW5wdXRbMF0gYXMgWG1sUmVhZGVyLCB0ZXN0SW5wdXRbMl0gYXMgWHNsdEFyZ3VtZW50TGlzdCwgdGVzdElucHV0WzNdIGFzIFhtbFdyaXRlciwgdGVzdElucHV0WzRdIGFzIFhtbFJlc29sdmVyKTsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIGxvY2FsWHNsdC5UcmFuc2Zvcm0odGVzdElucHV0WzFdIGFzIElYUGF0aE5hdmlnYWJsZSwgdGVzdElucHV0WzJdIGFzIFhzbHRBcmd1bWVudExpc3QsIHRlc3RJbnB1dFszXSBhcyBYbWxXcml0ZXIsIHRlc3RJbnB1dFs0XSBhcyBYbWxSZXNvbHZlcik7DQogICAgICAgICAgICAgICAgYWN0dWFsUmVzdWx0ID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24gZXgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZXguTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgYWN0dWFsUmVzdWx0ID0gZmFsc2U7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChhY3R1YWxSZXN1bHQgIT0gZXhwZWN0ZWRSZXN1bHQpDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBUaGlzIHRlc3RjYXNlIGlzIGZvciBidWdzIDEwOTQyOSwgMTExMDc1IGFuZCAxMDk2NDQgZml4ZWQgaW4gRXZlcmV0dCBTUDENCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIk5EUDFfMVNQMSBCdWdzIChVUkksU1RSRUFNKSIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiTkRQMV8xU1AxIEJ1Z3MgKE5BVklHQVRPUixURVhUV1JJVEVSKSIsIERlc2MgPSAiTkFWSUdBVE9SLFRFWFRXUklURVIiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ05EUDFfMVNQMVRlc3QgOiBYc2x0QXBpVGVzdENhc2VCYXNlMg0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ05EUDFfMVNQMVRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2NhbCBwYXJhbWV0ZXIgZ2V0cyBvdmVyd3JpdHRlbiB3aXRoIGdsb2JhbCBwYXJhbSB2YWx1ZSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YShYc2xJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIE91dHB1dFR5cGUuVGV4dFdyaXRlciwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgdmFyMShYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxvdXQ+DQpwYXJhbTEgKGNvcnJlY3QgYW5zd2VyIGlzICdsb2NhbC1wYXJhbTEtYXJnJyk6IGxvY2FsLXBhcmFtMS1hcmcNCnBhcmFtMiAoY29ycmVjdCBhbnN3ZXIgaXMgJ2xvY2FsLXBhcmFtMi1hcmcnKTogbG9jYWwtcGFyYW0yLWFyZw0KPC9vdXQ+IjsNCiAgICAgICAgICAgIG1feHNsdEFyZyA9IG5ldyBYc2x0QXJndW1lbnRMaXN0KCk7DQogICAgICAgICAgICBtX3hzbHRBcmcuQWRkUGFyYW0oInBhcmFtMSIsIHN0cmluZy5FbXB0eSwgImdsb2JhbC1wYXJhbTEtYXJnIik7DQoNCiAgICAgICAgICAgIGlmICgoTG9hZFhTTCgicGFyYW1TY29wZS54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpICYmIChUcmFuc2Zvcm1fQXJnTGlzdCgiZnJ1aXRzLnhtbCIsIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9jYWwgcGFyYW1ldGVyIGdldHMgb3ZlcndyaXR0ZW4gd2l0aCBnbG9iYWwgdmFyaWFibGUgdmFsdWUiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHZhcjIoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48b3V0Pg0KcGFyYW0xIChjb3JyZWN0IGFuc3dlciBpcyAnbG9jYWwtcGFyYW0xLWFyZycpOiBsb2NhbC1wYXJhbTEtYXJnDQpwYXJhbTIgKGNvcnJlY3QgYW5zd2VyIGlzICdsb2NhbC1wYXJhbTItYXJnJyk6IGxvY2FsLXBhcmFtMi1hcmcNCjwvb3V0PiI7DQogICAgICAgICAgICBtX3hzbHRBcmcgPSBuZXcgWHNsdEFyZ3VtZW50TGlzdCgpOw0KICAgICAgICAgICAgbV94c2x0QXJnLkFkZFBhcmFtKCJwYXJhbTEiLCBzdHJpbmcuRW1wdHksICJnbG9iYWwtcGFyYW0xLWFyZyIpOw0KDQogICAgICAgICAgICBpZiAoKExvYWRYU0woInZhclNjb3BlLnhzbCIsIHhzbElucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkgJiYgKFRyYW5zZm9ybV9BcmdMaXN0KCJmcnVpdHMueG1sIiwgb3V0cHV0VHlwZSwgbmF2VHlwZSkgPT0gMSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJTdWJjbGFzc2VkIFhQYXRoTm9kZUl0ZXJhdG9yIHJldHVybmVkIGZyb20gYW4gZXh0ZW5zaW9uIG9iamVjdCBvciBYc2x0RnVuY3Rpb24gaXMgbm90IGFjY2VwdGVkIGJ5IFhQYXRoIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgT3V0cHV0VHlwZS5UZXh0V3JpdGVyLCBOYXZUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2YXIzKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PGRpc3RpbmN0LWNvdW50cmllcz5GcmFuY2UsIFNwYWluLCBBdXN0cmlhLCBHZXJtYW55PC9kaXN0aW5jdC1jb3VudHJpZXM+IjsNCg0KICAgICAgICAgICAgbV94c2x0QXJnID0gbmV3IFhzbHRBcmd1bWVudExpc3QoKTsNCiAgICAgICAgICAgIG1feHNsdEFyZy5BZGRFeHRlbnNpb25PYmplY3QoImh0dHA6Ly9mb28uY29tIiwgbmV3IE15WHNsdEV4dGVuc2lvbigpKTsNCg0KICAgICAgICAgICAgaWYgKChMb2FkWFNMKCJCdWcxMTEwNzUueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtX0FyZ0xpc3QoIkJ1ZzExMTA3NS54bWwiLCBvdXRwdXRUeXBlLCBuYXZUeXBlKSA9PSAxKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkl0ZXJhdG9yIHVzaW5nIGZvci1lYWNoIG92ZXIgYSB2YXJpYWJsZSBpcyBub3QgcmVzZXQgY29ycmVjdGx5IHdoaWxlIHVzaW5nIG1zeHNsOm5vZGUtc2V0KCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlRleHRXcml0ZXIsIE5hdlR5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIHZhcjQoWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBPdXRwdXRUeXBlIG91dHB1dFR5cGUsIE5hdlR5cGUgbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz4NCgkJTm9kZSBDb3VudDogezN9DQoNCgkJDQoJCUNvcnJlY3QgT3V0cHV0OiAoMSkoMikoMykNCgkJSW5jb3JyZWN0IE91dHB1dDogWzFdWzJdWzNdIjsNCg0KICAgICAgICAgICAgaWYgKChMb2FkWFNMKCJCdWcxMDk2NDQueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtKChzdHJpbmcpICJmb28ueG1sIiwgKE91dHB1dFR5cGUpIG91dHB1dFR5cGUsIG5hdlR5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChleHBlY3RlZCwgRmlsZS5SZWFkQWxsVGV4dCgib3V0LnhtbCIpLCBpZ25vcmVMaW5lRW5kaW5nRGlmZmVyZW5jZXM6dHJ1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2xDb21waWxlZFRyYW5zZm9ybSBSZWdyZXNzaW9uIFRlc3RzIGZvciBBUEkiLCBEZXNjID0gIlhzbENvbXBpbGVkVHJhbnNmb3JtIFJlZ3Jlc3Npb24gVGVzdHMiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ1RyYW5zZm9ybVJlZ3Jlc3Npb25UZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZTINCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENUcmFuc2Zvcm1SZWdyZXNzaW9uVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJ1ZzM5ODk2OCAtIEdsb2JhbGl6YXRpb24gaXMgYnJva2VuIGZvciBkb2N1bWVudCgpIGZ1bmN0aW9uIildDQogICAgICAgIFtQbGF0Zm9ybVNwZWNpZmljKFRlc3RQbGF0Zm9ybXMuV2luZG93cyldIC8vW0FjdGl2ZUlzc3VlKDE0NzUwKV0NCiAgICAgICAgW0lubGluZURhdGEoWHNsSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBPdXRwdXRUeXBlLlN0cmVhbSwgTmF2VHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgUmVncmVzc2lvblRlc3QxKFhzbElucHV0VHlwZSB4c2xJbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIDxTUUwgQlUgRGVmZWN0IFRyYWNraW5nIDQxMDA2MD4NCiAgICAgICAgICAgIC8vIDwvU1FMIEJVIERlZmVjdCBUcmFja2luZyA0MTAwNjA+DQoNCiAgICAgICAgICAgIHN0cmluZyB0ZXN0RmlsZSA9IFBhdGguQ29tYmluZSgiVGVzdEZpbGVzIiwgRmlsZVBhdGhVdGlsLkdldFRlc3REYXRhUGF0aCgpLCAiWHNsdEFwaVYyIiwgIlN0cmFcdTAwREZlLnhtbCIpOw0KDQogICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGZpbGUuDQogICAgICAgICAgICB1c2luZyAoRmlsZVN0cmVhbSBmcyA9IEZpbGUuT3Blbih0ZXN0RmlsZSwgRmlsZU1vZGUuT3BlbikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQnl0ZVtdIGluZm8gPSBuZXcgVVRGOEVuY29kaW5nKHRydWUpLkdldEJ5dGVzKCI8UEFTU0VEICAvPiIpOw0KICAgICAgICAgICAgICAgIGZzLldyaXRlKGluZm8sIDAsIGluZm8uTGVuZ3RoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgTG9hZFhTTCgiMzk4OTY4cmVwcm8ueHNsIiwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIFRyYW5zZm9ybSgoc3RyaW5nKSAiZGF0YS54bWwiLCAoT3V0cHV0VHlwZSkgb3V0cHV0VHlwZSwgbmF2VHlwZSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJ1ZzQxMjcwMyAtIE9mZi1ieS1vbmUgZXJyb3JzIGZvciBYU0xUIGxvYWRpbmcgZXJyb3IgY29sdW1uIildDQogICAgICAgIFtJbmxpbmVEYXRhKFhzbElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFJlZ3Jlc3Npb25UZXN0MyhYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woImJ1ZzM3MDg2OC54c2wiLCB4c2xJbnB1dFR5cGUsIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5YbWwuWHNsLlhzbHRFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBTaG91bGQgYmUgMywyDQogICAgICAgICAgICAgICAgaWYgKGUuTGluZU51bWJlciA9PSAzICYmIGUuTGluZVBvc2l0aW9uID09IDIpDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCI0MTI3MDM6IExpbmVOdW1iZXIgYW5kIHBvc2l0aW9uIHdlcmUgaW5jb3JyZWN0LiBFeHBlY3RlZCB7MH0sIHsxfS4gQWN0dWFsIHsyfSwgezN9IiwgMywgMiwgZS5MaW5lTnVtYmVyLCBlLkxpbmVQb3NpdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJ1ZzQyMzY0MSAtIFhzbENvbXBpbGVkVHJhbnNmb3JtLkxvYWQoKSBbcmV0YWlsXSB0aHJvd3MgYSBOdWxsUmVmZXJlbmNlRXhjZXB0aW9uIHdoZW4gc2NyaXB0cyBhcmUgcHJvaGliaXRlZCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBSZWdyZXNzaW9uVGVzdDQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybSB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICAvLyBTaG91bGQgbm90IHRocm93DQogICAgICAgICAgICB4c2x0LkxvYWQoRnVsbEZpbGVQYXRoKCJYU0xURmlsZXdpdGhzY3JpcHQueHNsdCIpLCBYc2x0U2V0dGluZ3MuRGVmYXVsdCwgbmV3IFhtbFVybFJlc29sdmVyKCkpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCdWc0MjM2NDEgLSBYc2xDb21waWxlZFRyYW5zZm9ybS5Mb2FkKCkgW2RlYnVnXSB0aHJvd3MgYSBOdWxsUmVmZXJlbmNlRXhjZXB0aW9uIHdoZW4gc2NyaXB0cyBhcmUgcHJvaGliaXRlZCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBSZWdyZXNzaW9uVGVzdDUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYc2xDb21waWxlZFRyYW5zZm9ybSB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKHRydWUpOw0KICAgICAgICAgICAgLy8gU2hvdWxkIG5vdCB0aHJvdw0KICAgICAgICAgICAgeHNsdC5Mb2FkKEZ1bGxGaWxlUGF0aCgiWFNMVEZpbGV3aXRoc2NyaXB0LnhzbHQiKSwgWHNsdFNldHRpbmdzLkRlZmF1bHQsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQnVnNDY5NzgxIC0gUmVwbGFjZSBzaG91bGRuJ3QgcmVsYXggb3JpZ2luYWwgdHlwZSAnYXNzZXJ0aW9uIGZhaWx1cmUnIildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFJlZ3Jlc3Npb25UZXN0NygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyB4c2xTdHJpbmcgPSAiPHhzbDpzdHlsZXNoZWV0IHZlcnNpb249XCIxLjBcIiB4bWxuczp4c2w9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm1cIiB4bWxuczp1c2VyPVwidXJuOnVzZXJcIj4iDQogICAgICAgICAgICAgICAgKyAiPHhzbDp0ZW1wbGF0ZSBtYXRjaD1cIi9cIj4iDQogICAgICAgICAgICAgICAgKyAiPHhzbDp2YXJpYWJsZSBuYW1lPVwiZm9vXCIvPiINCiAgICAgICAgICAgICAgICArICI8eHNsOmZvci1lYWNoIHNlbGVjdD1cInVzZXI6ZnVuYygpXCI+Ig0KICAgICAgICAgICAgICAgICsgIjx4c2w6dmFyaWFibGUgbmFtZT1cImJhclwiLz4iDQogICAgICAgICAgICAgICAgKyAiPHhzbDppZiB0ZXN0PVwic2VsZjo6bm9kZSgpWzBdXCIvPiINCiAgICAgICAgICAgICAgICArICI8L3hzbDpmb3ItZWFjaD4iDQogICAgICAgICAgICAgICAgKyAiPC94c2w6dGVtcGxhdGU+Ig0KICAgICAgICAgICAgICAgICsgIjwveHNsOnN0eWxlc2hlZXQ+IjsNCg0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sUmVhZGVyIHIgPSBYbWxSZWFkZXIuQ3JlYXRlKG5ldyBTdHJpbmdSZWFkZXIoeHNsU3RyaW5nKSk7DQogICAgICAgICAgICAgICAgWHNsQ29tcGlsZWRUcmFuc2Zvcm0gdHJhbnMgPSBuZXcgWHNsQ29tcGlsZWRUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgICAgICB0cmFucy5Mb2FkKHIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFhzbHRFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQnVnNzM3ODE2IC0gRHluYW1pYyBtZXRob2Qgd2lsbCBoYXZlIGRlY2xhcmluZyB0eXBlID09IG51bGwiKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgUmVncmVzc2lvblRlc3Q4KCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgRHluYW1pY01ldGhvZCBoZWxsbyA9IG5ldyBEeW5hbWljTWV0aG9kKCJIZWxsbyIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZihpbnQpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVHlwZVtdIHsgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mKHN0cmluZykuTW9kdWxlKTsNCg0KICAgICAgICAgICAgICAgIElMR2VuZXJhdG9yIGlsID0gaGVsbG8uR2V0SUxHZW5lcmF0b3IoMjU2KTsNCiAgICAgICAgICAgICAgICBpbC5FbWl0KE9wQ29kZXMuUmV0KTsNCg0KICAgICAgICAgICAgICAgIC8vIExvYWQgaW50byBYc2xDb21waWxlZFRyYW5zZm9ybQ0KICAgICAgICAgICAgICAgIHZhciB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICAgICAgeHNsdC5Mb2FkKGhlbGxvLCBuZXcgYnl0ZVtdIHsgfSwgbmV3IFR5cGVbXSB7IH0pOw0KDQogICAgICAgICAgICAgICAgLy8gUnVuIHRoZSB0cmFuc2Zvcm1hdGlvbg0KICAgICAgICAgICAgICAgIFN0cmVhbSByZXMgPSBuZXcgTWVtb3J5U3RyZWFtKCk7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oWG1sUmVhZGVyLkNyZWF0ZShuZXcgU3RyaW5nUmVhZGVyKCI8Um9vdD48UHJpY2U+OS41MDwvUHJpY2U+PC9Sb290PiIpKSwgKFhzbHRBcmd1bWVudExpc3QpbnVsbCwgcmVzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgaW50ZXJuYWwgY2xhc3MgTXlBcnJheUl0ZXJhdG9yIDogWFBhdGhOb2RlSXRlcmF0b3INCiAgICB7DQogICAgICAgIHByb3RlY3RlZCBBcnJheUxpc3QgYXJyYXk7DQogICAgICAgIHByb3RlY3RlZCBpbnQgaW5kZXg7DQoNCiAgICAgICAgcHVibGljIE15QXJyYXlJdGVyYXRvcihBcnJheUxpc3QgYXJyYXkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRoaXMuYXJyYXkgPSBhcnJheTsNCiAgICAgICAgICAgIHRoaXMuaW5kZXggPSAwOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIE15QXJyYXlJdGVyYXRvcihNeUFycmF5SXRlcmF0b3IgaXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRoaXMuYXJyYXkgPSBpdC5hcnJheTsNCiAgICAgICAgICAgIHRoaXMuaW5kZXggPSBpdC5pbmRleDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBYUGF0aE5vZGVJdGVyYXRvciBDbG9uZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTXlBcnJheUl0ZXJhdG9yKHRoaXMpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgTW92ZU5leHQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoaW5kZXggPCBhcnJheS5Db3VudCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbmRleCsrOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFhQYXRoTmF2aWdhdG9yIEN1cnJlbnQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIChpbmRleCA+IDApID8gKFhQYXRoTmF2aWdhdG9yKWFycmF5W2luZGV4IC0gMV0gOiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGludCBDdXJyZW50UG9zaXRpb24NCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGludCBDb3VudA0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXkuQ291bnQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdm9pZCBSZXNldCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGluZGV4ID0gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEJVR0JVRzogRENSIDEwNDc2MA0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgSUVudW1lcmF0b3IgR2V0RW51bWVyYXRvcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIE15QXJyYXlJdGVyYXRvciBpdCA9IChNeUFycmF5SXRlcmF0b3IpdGhpcy5DbG9uZSgpOw0KICAgICAgICAgICAgaXQuUmVzZXQoKTsNCiAgICAgICAgICAgIHJldHVybiBpdC5hcnJheS5HZXRFbnVtZXJhdG9yKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpbnRlcm5hbCBjbGFzcyBNeVhzbHRFeHRlbnNpb24NCiAgICB7DQogICAgICAgIHB1YmxpYyBYUGF0aE5vZGVJdGVyYXRvciBkaXN0aW5jdChYUGF0aE5vZGVJdGVyYXRvciBub2Rlc2V0KQ0KICAgICAgICB7DQogICAgICAgICAgICBIYXNodGFibGUgbm9kZWxpc3QgPSBuZXcgSGFzaHRhYmxlKCk7DQogICAgICAgICAgICB3aGlsZSAobm9kZXNldC5Nb3ZlTmV4dCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICghbm9kZWxpc3QuQ29udGFpbnMobm9kZXNldC5DdXJyZW50LlZhbHVlKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIG5vZGVsaXN0LkFkZChub2Rlc2V0LkN1cnJlbnQuVmFsdWUsIG5vZGVzZXQuQ3VycmVudCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG5ldyBNeUFycmF5SXRlcmF0b3IobmV3IEFycmF5TGlzdChub2RlbGlzdC5WYWx1ZXMpKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XsltApiV2.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uWG1sLlhtbERpZmY7DQp1c2luZyBTeXN0ZW0uWG1sLlhQYXRoOw0KdXNpbmcgU3lzdGVtLlhtbC5Yc2w7DQp1c2luZyBYbWxDb3JlVGVzdC5Db21tb247DQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzDQp7DQogICAgcHVibGljIGVudW0gT3V0cHV0VHlwZQ0KICAgIHsNCiAgICAgICAgVVJJLCBTdHJlYW0sIFdyaXRlciwgVGV4dFdyaXRlcg0KICAgIH0NCg0KICAgIHB1YmxpYyBlbnVtIFhzbElucHV0VHlwZQ0KICAgIHsNCiAgICAgICAgUmVhZGVyLCBVUkksIE5hdmlnYXRvcg0KICAgIH0NCg0KICAgIHB1YmxpYyBlbnVtIFhtbElucHV0VHlwZQ0KICAgIHsNCiAgICAgICAgUmVhZGVyLCBVUkksIE5hdmlnYXRvcg0KICAgIH0NCg0KICAgIHB1YmxpYyBlbnVtIE5hdlR5cGUNCiAgICB7DQogICAgICAgIFhtbERvY3VtZW50LCBEYXRhRG9jdW1lbnQsIFhQYXRoRG9jdW1lbnQsIFVua25vd24NCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgLy8gQmFzZSBjbGFzcyBmb3IgdGVzdCBjYXNlcw0KICAgIC8vDQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KICAgIHB1YmxpYyBjbGFzcyBYc2x0QXBpVGVzdENhc2VCYXNlMg0KICAgIHsNCiAgICAgICAgLy8gR2VuZXJpYyBkYXRhIGZvciBhbGwgZGVyaXZlZCB0ZXN0IGNhc2VzDQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pYc2xOUyA9ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0iOw0KDQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pEZWZhdWx0TlMgPSAidXJuOm15LW9iamVjdCI7DQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pFbXB0eSA9ICIiOw0KICAgICAgICBwdWJsaWMgU3RyaW5nIHN6SW52YWxpZCA9ICIqPyUoKXt9XDBbXSYhQCMkIjsNCiAgICAgICAgcHVibGljIFN0cmluZyBzekxvbmdTdHJpbmcgPSAiVGhpc0lzQVZlcnlMb25nU3RyaW5nVG9CZVN0b3JlZEFzQVZhcmlhYmxlVG9EZXRlcm1pbmVIb3dMYXJnZVRoaXNCdWZmZXJGb3JBVmFyaWFibGVOYW1lQ2FuQmVBbmRTdGlsbEZ1bmN0aW9uQXNFeHBlY3RlZCI7DQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pMb25nTlMgPSAiaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3RoaXMvaXMvYS92ZXJ5L2xvbmcvbmFtZXNwYWNlL3VyaS90by9kby90aGUvYXBpL3Rlc3RpbmcvZm9yL3hzbHQvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvIjsNCiAgICAgICAgcHVibGljIFN0cmluZ1tdIHN6V2hpdGVTcGFjZSA9IHsgIiAgIiwgIlxuIiwgIlx0IiwgIlxyIiwgIlx0XG4gIFxyXHQiIH07DQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pTaW1wbGUgPSAibXlBcmciOw0KDQogICAgICAgIC8vIFZhcmlhYmxlcyBmcm9tIGluaXQgc3RyaW5nDQogICAgICAgIHByaXZhdGUgc3RyaW5nIF9zdHJQYXRoOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBhdGggb2YgdGhlIGRhdGEgZmlsZXMNCg0KICAgICAgICBwcml2YXRlIHN0cmluZyBfaHR0cFBhdGg7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIdHRwIFBhdGggb2YgdGhlIGRhdGEgZmlsZXMNCg0KICAgICAgICAvLyBPdGhlciBnbG9iYWwgdmFyaWFibGVzDQogICAgICAgIHByb3RlY3RlZCBzdHJpbmcgX3N0ck91dEZpbGUgPSAib3V0LnhtbCI7ICAgICAgICAvLyBGaWxlIHRvIGNyZWF0ZSB3aGVuIHVzaW5nIHdyaXRlIHRyYW5zZm9ybXMNCg0KICAgICAgICBwcm90ZWN0ZWQgWHNsQ29tcGlsZWRUcmFuc2Zvcm0geHNsdDsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNYWluIFhzbENvbXBpbGVkVHJhbnNmb3JtIGluc3RhbmNlDQogICAgICAgIHByb3RlY3RlZCBYbWxSZWFkZXIgeHJYU0xUOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3IgUkVBREVSIHRyYW5zZm9ybXMNCiAgICAgICAgcHJvdGVjdGVkIFhzbHRBcmd1bWVudExpc3QgbV94c2x0QXJnOyAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgWHNsdEFyZ3VtZW50TGlzdCB0ZXN0cw0KICAgICAgICBwdWJsaWMgb2JqZWN0IHJldE9iajsNCg0KICAgICAgICBwcm90ZWN0ZWQgc3RyaW5nIF9zdGFuZGFyZFRlc3RzOw0KDQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIFhzbHRBcGlUZXN0Q2FzZUJhc2UyKElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgQXBwQ29udGV4dC5TZXRTd2l0Y2goIlRlc3RTd2l0Y2guTG9jYWxBcHBDb250ZXh0LkRpc2FibGVDYWNoaW5nIiwgdHJ1ZSk7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICAgICAgdGhpcy5Jbml0KG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgc3RhdGljIFhzbHRBcGlUZXN0Q2FzZUJhc2UyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gUmVwbGFjZSBhYnNvbHV0ZSBVUkkgaW4geG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueG1sIGJhc2VkIG9uIHRoZSBlbnZpcm9ubWVudA0KICAgICAgICAgICAgc3RyaW5nIHRhcmdldEZpbGUgPSBQYXRoLkNvbWJpbmUoUGF0aC5HZXRUZW1wUGF0aCgpLCAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueG1sIik7DQogICAgICAgICAgICBzdHJpbmcgeHNsRmlsZSA9IFBhdGguQ29tYmluZSgiVGVzdEZpbGVzIiwgRmlsZVBhdGhVdGlsLkdldFRlc3REYXRhUGF0aCgpLCAiWHNsdEFwaVYyIiwgInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uX2Fic29sdXRlX3VyaS54c2wiKTsNCiAgICAgICAgICAgIFhtbERvY3VtZW50IGRvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICAgICAgZG9jLkxvYWQoeHNsRmlsZSk7DQogICAgICAgICAgICBzdHJpbmcgeHNsU3RyaW5nID0gZG9jLk91dGVyWG1sLlJlcGxhY2UoIkFCU09MVVRFX1VSSSIsIHRhcmdldEZpbGUpOw0KICAgICAgICAgICAgZG9jLkxvYWRYbWwoeHNsU3RyaW5nKTsNCiAgICAgICAgICAgIGRvYy5TYXZlKHhzbEZpbGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIE91dHB1dFR5cGUgR2V0T3V0cHV0VHlwZShTdHJpbmcgcykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHMuRW5kc1dpdGgoIixVUkkiKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gT3V0cHV0VHlwZS5VUkk7DQogICAgICAgICAgICBlbHNlIGlmIChzLkVuZHNXaXRoKCIsU1RSRUFNIikpDQogICAgICAgICAgICAgICAgcmV0dXJuIE91dHB1dFR5cGUuU3RyZWFtOw0KICAgICAgICAgICAgZWxzZSBpZiAocy5FbmRzV2l0aCgiLFdSSVRFUiIpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBPdXRwdXRUeXBlLldyaXRlcjsNCiAgICAgICAgICAgIGVsc2UgaWYgKHMuRW5kc1dpdGgoIixURVhUV1JJVEVSIikpDQogICAgICAgICAgICAgICAgcmV0dXJuIE91dHB1dFR5cGUuVGV4dFdyaXRlcjsNCiAgICAgICAgICAgIGVsc2UgcmV0dXJuIE91dHB1dFR5cGUuU3RyZWFtOyAvL2RlZmF1bHQNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBYbWxVcmxSZXNvbHZlciBHZXREZWZhdWx0Q3JlZFJlc29sdmVyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgWG1sVXJsUmVzb2x2ZXIgbXlEZWZhdWx0Q3JlZFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQoNCiAgICAgICAgICAgIHJldHVybiBteURlZmF1bHRDcmVkUmVzb2x2ZXI7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgWHNsSW5wdXRUeXBlIEdldFhzbElucHV0VHlwZShTdHJpbmcgcykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHMuU3RhcnRzV2l0aCgiUkVBREVSLCIpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBYc2xJbnB1dFR5cGUuUmVhZGVyOw0KICAgICAgICAgICAgZWxzZSBpZiAocy5TdGFydHNXaXRoKCJVUkksIikpDQogICAgICAgICAgICAgICAgcmV0dXJuIFhzbElucHV0VHlwZS5VUkk7DQogICAgICAgICAgICBlbHNlIGlmIChzLlN0YXJ0c1dpdGgoIk5BVklHQVRPUiwiKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gWHNsSW5wdXRUeXBlLk5hdmlnYXRvcjsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICByZXR1cm4gWHNsSW5wdXRUeXBlLlVSSTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBOYXZUeXBlIEdldERvY1R5cGUoU3RyaW5nIHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN3aXRjaCAocy5Ub1VwcGVyKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSAiWFBBVEhET0NVTUVOVCI6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOYXZUeXBlLlhQYXRoRG9jdW1lbnQ7DQoNCiAgICAgICAgICAgICAgICBjYXNlICJYTUxET0NVTUVOVCI6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOYXZUeXBlLlhtbERvY3VtZW50Ow0KDQogICAgICAgICAgICAgICAgY2FzZSAiREFUQURPQ1VNRU5UIjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5hdlR5cGUuRGF0YURvY3VtZW50Ow0KDQogICAgICAgICAgICAgICAgZGVmYXVsdDogLy8gTmF2VHlwZSBUeXBlIG5vdCBpbXBvcnRhbnQsIHVzaW5nIGRlZmF1bHQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5hdlR5cGUuWFBhdGhEb2N1bWVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBSZWFkZXJUeXBlIEdldFJlYWRlclR5cGUoU3RyaW5nIHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vWG1sVGV4dFJlYWRlciwgWG1sTm9kZVJlYWRlciwgWG1sVmFsaWRhdGluZ1JlYWRlciwgWHNsdFJlYWRlcg0KDQogICAgICAgICAgICBzd2l0Y2ggKHMuVG9VcHBlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgIlhNTFRFWFRSRUFERVIiOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVhZGVyVHlwZS5YbWxUZXh0UmVhZGVyOw0KDQogICAgICAgICAgICAgICAgY2FzZSAiWE1MTk9ERVJFQURFUiI6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWFkZXJUeXBlLlhtbE5vZGVSZWFkZXI7DQoNCiAgICAgICAgICAgICAgICBjYXNlICJYTUxWQUxJREFUSU5HUkVBREVSIjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcjsNCg0KICAgICAgICAgICAgICAgIGNhc2UgIlhTTFRSRUFERVIiOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVhZGVyVHlwZS5Yc2x0UmVhZGVyOw0KDQogICAgICAgICAgICAgICAgZGVmYXVsdDogLy8gUmVhZGVyVHlwZSBUeXBlIG5vdCBpbXBvcnRhbnQsIHVzaW5nIGRlZmF1bHQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2b2lkIEluaXQob2JqZWN0IG9ialBhcmFtKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL1RoaXMgaXMgYSB0ZW1wb3JhcnkgZml4IHRvIHJlc3RvcmUgdGhlIGJhc2VsaW5lcy4gUmVmZXIgdG8gVGVzdCBidWcgIw0KICAgICAgICAgICAgX3N0clBhdGggPSBQYXRoLkNvbWJpbmUoIlRlc3RGaWxlcyIsIEZpbGVQYXRoVXRpbC5HZXRUZXN0RGF0YVBhdGgoKSwgIlhzbHRBcGlWMiIpOw0KICAgICAgICAgICAgX2h0dHBQYXRoID0gUGF0aC5Db21iaW5lKEZpbGVQYXRoVXRpbC5HZXRIdHRwVGVzdERhdGFQYXRoKCksICJYc2x0QXBpVjIiKTsNCiAgICAgICAgICAgIF9zdGFuZGFyZFRlc3RzID0gUGF0aC5Db21iaW5lKCJUZXN0RmlsZXMiLCBGaWxlUGF0aFV0aWwuR2V0SHR0cFN0YW5kYXJkUGF0aCgpLCAieHNsdDEwIiwiQ3VycmVudCIpOw0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgU3RyaW5nIEZ1bGxGaWxlUGF0aChTdHJpbmcgc3pGaWxlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoc3pGaWxlID09IG51bGwgfHwgc3pGaWxlID09IFN0cmluZy5FbXB0eSkNCiAgICAgICAgICAgICAgICByZXR1cm4gc3pGaWxlOw0KICAgICAgICAgICAgaWYgKHN6RmlsZS5MZW5ndGggPiA1KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChzekZpbGUuU3Vic3RyaW5nKDAsIDUpICE9ICJodHRwOiIpDQogICAgICAgICAgICAgICAgICAgIHN6RmlsZSA9IFBhdGguQ29tYmluZShfc3RyUGF0aCwgc3pGaWxlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBzekZpbGU7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgU3RyaW5nIEZ1bGxIdHRwUGF0aChTdHJpbmcgc3pGaWxlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoc3pGaWxlID09IG51bGwgfHwgc3pGaWxlID09IFN0cmluZy5FbXB0eSkNCiAgICAgICAgICAgICAgICByZXR1cm4gc3pGaWxlOw0KICAgICAgICAgICAgc3pGaWxlID0gUGF0aC5Db21iaW5lKF9odHRwUGF0aCwgc3pGaWxlKTsNCiAgICAgICAgICAgIHJldHVybiBzekZpbGU7DQogICAgICAgIH0NCg0KICAgICAgICBwcm90ZWN0ZWQgc3RyaW5nIF9leHBlY3RlZEVycm9yQ29kZTsNCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgU2V0RXhwZWN0ZWRFcnJvcg0KICAgICAgICAvLyAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgdm9pZCBTZXRFeHBlY3RlZEVycm9yKHN0cmluZyBlcnJvckNvZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9leHBlY3RlZEVycm9yQ29kZSA9IGVycm9yQ29kZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vICBDaGVja0V4cGVjdGVkRXJyb3INCiAgICAgICAgLy8gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHZvaWQgQ2hlY2tFeHBlY3RlZEVycm9yKEV4Y2VwdGlvbiBleCwgc3RyaW5nIGFzc2VtYmx5KQ0KICAgICAgICB7DQogICAgICAgICAgICBDRXhjZXB0aW9uSGFuZGxlciBoYW5kbGVyID0gbmV3IENFeGNlcHRpb25IYW5kbGVyKFBhdGguQ29tYmluZShfc3RyUGF0aCwgIkV4Y2VwdGlvbnMueG1sIiksIGFzc2VtYmx5LCBfb3V0cHV0KTsNCiAgICAgICAgICAgIGJvb2wgcmVzdWx0ID0gaGFuZGxlci5WZXJpZnlFeGNlcHRpb24oZXgpOw0KICAgICAgICAgICAgaWYgKGhhbmRsZXIucmVzICE9IF9leHBlY3RlZEVycm9yQ29kZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhwZWN0ZWQgRXhjZXB0aW9uIDogezB9IiwgX2V4cGVjdGVkRXJyb3JDb2RlKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiQWN0dWFsIEV4Y2VwdGlvbiA6IHswfSIsIGhhbmRsZXIucmVzKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIXJlc3VsdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgQ2hlY2tFeHBlY3RlZEVycm9yDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyB2b2lkIENoZWNrRXhwZWN0ZWRFcnJvcihFeGNlcHRpb24gZXgsIHN0cmluZyBhc3NlbWJseSwgc3RyaW5nIHJlcywgc3RyaW5nW10gc3RyUGFyYW1zKQ0KICAgICAgICB7DQogICAgICAgICAgICBDRXhjZXB0aW9uSGFuZGxlciBoYW5kbGVyID0gbmV3IENFeGNlcHRpb25IYW5kbGVyKFBhdGguQ29tYmluZShfc3RyUGF0aCwgIkV4Y2VwdGlvbnMueG1sIiksIGFzc2VtYmx5LCBfb3V0cHV0KTsNCiAgICAgICAgICAgIGlmICghaGFuZGxlci5WZXJpZnlFeGNlcHRpb24oZXgsIHJlcywgc3RyUGFyYW1zKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgTG9hZFhNTA0KICAgICAgICAvLyAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgSVhQYXRoTmF2aWdhYmxlIExvYWRYTUwoU3RyaW5nIHN0ckZpbGVMb2NhdGlvbiwgTmF2VHlwZSBfbmF2VHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3dpdGNoIChfbmF2VHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIE5hdlR5cGUuWG1sRG9jdW1lbnQ6DQogICAgICAgICAgICAgICAgICAgIFhtbERvY3VtZW50IHhtbERvY3VtZW50ID0gbmV3IFhtbERvY3VtZW50KCk7DQogICAgICAgICAgICAgICAgICAgIHhtbERvY3VtZW50LkxvYWQoc3RyRmlsZUxvY2F0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChJWFBhdGhOYXZpZ2FibGUpeG1sRG9jdW1lbnQ7DQoNCiAgICAgICAgICAgICAgICBjYXNlIE5hdlR5cGUuWFBhdGhEb2N1bWVudDoNCiAgICAgICAgICAgICAgICAgICAgWFBhdGhEb2N1bWVudCB4UGF0aERvY3VtZW50ID0gbmV3IFhQYXRoRG9jdW1lbnQoc3RyRmlsZUxvY2F0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChJWFBhdGhOYXZpZ2FibGUpeFBhdGhEb2N1bWVudDsNCg0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gIExvYWRYU0wNCiAgICAgICAgLy8gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGludCBMb2FkWFNMKHN0cmluZyBfc3RyWHNsRmlsZSwgWHNsSW5wdXRUeXBlIHhzbElucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gTG9hZFhTTChfc3RyWHNsRmlsZSwgeHNsSW5wdXRUeXBlLCByZWFkZXJUeXBlLCBuZXcgWG1sVXJsUmVzb2x2ZXIoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgaW50IExvYWRYU0woc3RyaW5nIF9zdHJYc2xGaWxlLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFhtbFJlc29sdmVyIHhyKQ0KICAgICAgICB7DQogICAgICAgICAgICBfc3RyWHNsRmlsZSA9IEZ1bGxGaWxlUGF0aChfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICBYbWxSZWFkZXJTZXR0aW5ncyB4cnMgPSBudWxsOw0KDQogICAgICAgICAgICBzd2l0Y2ggKHhzbElucHV0VHlwZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFhzbElucHV0VHlwZS5VUkk6DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJMb2FkaW5nIHN0eWxlIHNoZWV0IGFzIFVSSSB7MH0iLCBfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgIHhycyA9IG5ldyBYbWxSZWFkZXJTZXR0aW5ncygpIHsgRHRkUHJvY2Vzc2luZyA9IER0ZFByb2Nlc3NpbmcuUGFyc2V9Ow0KICAgICAgICAgICAgICAgICAgICB4c2x0LkxvYWQoWG1sUmVhZGVyLkNyZWF0ZShfc3RyWHNsRmlsZSwgeHJzKSwgWHNsdFNldHRpbmdzLlRydXN0ZWRYc2x0LCB4cik7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYc2xJbnB1dFR5cGUuUmVhZGVyOg0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlYWRlclR5cGUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUmVhZGVyVHlwZS5YbWxUZXh0UmVhZGVyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgdHJUZW1wID0gbmV3IFhtbFRleHRSZWFkZXIoX3N0clhzbEZpbGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgc3R5bGUgc2hlZXQgYXMgWG1sVGV4dFJlYWRlciAiICsgX3N0clhzbEZpbGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2x0LkxvYWQodHJUZW1wLCBYc2x0U2V0dGluZ3MuVHJ1c3RlZFhzbHQsIHhyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyVGVtcCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJUZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUmVhZGVyVHlwZS5YbWxOb2RlUmVhZGVyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbERvY3VtZW50IGRvY1RlbXAgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2NUZW1wLkxvYWQoX3N0clhzbEZpbGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbE5vZGVSZWFkZXIgbnJUZW1wID0gbmV3IFhtbE5vZGVSZWFkZXIoZG9jVGVtcCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBYbWxOb2RlUmVhZGVyICIgKyBfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzbHQuTG9hZChuclRlbXApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnJUZW1wICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuclRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXI6DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhycyA9IG5ldyBYbWxSZWFkZXJTZXR0aW5ncygpOw0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhycy5Qcm9oaWJpdER0ZCA9IGZhbHNlOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFJlYWRlciB4dnIgPSBYbWxSZWFkZXIuQ3JlYXRlKF9zdHJYc2xGaWxlLCB4cnMpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBYbWxWYWxpZGF0aW5nUmVhZGVyICIgKyBfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh4dnIsIFhzbHRTZXR0aW5ncy5UcnVzdGVkWHNsdCwgeHIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeHZyICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dnIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWHNsSW5wdXRUeXBlLk5hdmlnYXRvcjoNCiAgICAgICAgICAgICAgICAgICAgeHJzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQogICAgICAgICAgICAgICAgICAgIHhycy5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLk5vbmU7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgICAgIHhycy5Qcm9oaWJpdER0ZCA9IGZhbHNlOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgICAgICAgICBYbWxSZWFkZXIgeHJMb2FkID0gWG1sUmVhZGVyLkNyZWF0ZShfc3RyWHNsRmlsZSwgeHJzKTsNCg0KICAgICAgICAgICAgICAgICAgICBYUGF0aERvY3VtZW50IHhkVGVtcCA9IG5ldyBYUGF0aERvY3VtZW50KHhyTG9hZCwgWG1sU3BhY2UuUHJlc2VydmUpOw0KICAgICAgICAgICAgICAgICAgICB4ckxvYWQuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBOYXZpZ2F0b3IgIiArIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKHhkVGVtcCwgWHNsdFNldHRpbmdzLlRydXN0ZWRYc2x0LCB4cik7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgTG9hZFhTTF9SZXNvbHZlcg0KICAgICAgICAvLyAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgaW50IExvYWRYU0xfUmVzb2x2ZXIoc3RyaW5nIF9zdHJYc2xGaWxlLCBYc2xJbnB1dFR5cGUgeHNsSW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFhtbFJlc29sdmVyIHhyKQ0KICAgICAgICB7DQogICAgICAgICAgICBfc3RyWHNsRmlsZSA9IEZ1bGxGaWxlUGF0aChfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbENvbXBpbGVkVHJhbnNmb3JtKCk7DQogICAgICAgICAgICBYbWxSZWFkZXJTZXR0aW5ncyB4cnMgPSBudWxsOw0KICAgICAgICAgICAgc3dpdGNoICh4c2xJbnB1dFR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYc2xJbnB1dFR5cGUuVVJJOg0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBVUkkgIiArIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKF9zdHJYc2xGaWxlLCBYc2x0U2V0dGluZ3MuVHJ1c3RlZFhzbHQsIHhyKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhzbElucHV0VHlwZS5SZWFkZXI6DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocmVhZGVyVHlwZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBSZWFkZXJUeXBlLlhtbFRleHRSZWFkZXI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sVGV4dFJlYWRlciB0clRlbXAgPSBuZXcgWG1sVGV4dFJlYWRlcihfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBYbWxUZXh0UmVhZGVyICIgKyBfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh0clRlbXAsIFhzbHRTZXR0aW5ncy5UcnVzdGVkWHNsdCwgeHIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJUZW1wICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0clRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBSZWFkZXJUeXBlLlhtbE5vZGVSZWFkZXI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sRG9jdW1lbnQgZG9jVGVtcCA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY1RlbXAuTG9hZChfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sTm9kZVJlYWRlciBuclRlbXAgPSBuZXcgWG1sTm9kZVJlYWRlcihkb2NUZW1wKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJMb2FkaW5nIHN0eWxlIHNoZWV0IGFzIFhtbE5vZGVSZWFkZXIgIiArIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKG5yVGVtcCwgWHNsdFNldHRpbmdzLlRydXN0ZWRYc2x0LCB4cik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuclRlbXAgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5yVGVtcC5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHJzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHJzLlByb2hpYml0RHRkID0gZmFsc2U7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sUmVhZGVyIHZyVGVtcCA9IFhtbFJlYWRlci5DcmVhdGUoX3N0clhzbEZpbGUsIHhycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBYbWxWYWxpZGF0aW5nUmVhZGVyICIgKyBfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh2clRlbXAsIFhzbHRTZXR0aW5ncy5UcnVzdGVkWHNsdCwgeHIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodnJUZW1wICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2clRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWHNsSW5wdXRUeXBlLk5hdmlnYXRvcjoNCiAgICAgICAgICAgICAgICAgICAgeHJzID0gbmV3IFhtbFJlYWRlclNldHRpbmdzKCk7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgICAgIHhycy5Qcm9oaWJpdER0ZCA9IGZhbHNlOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgICAgICAgICBYbWxSZWFkZXIgeHJMb2FkID0gWG1sUmVhZGVyLkNyZWF0ZShfc3RyWHNsRmlsZSwgeHJzKTsNCg0KICAgICAgICAgICAgICAgICAgICBYUGF0aERvY3VtZW50IHhkVGVtcCA9IG5ldyBYUGF0aERvY3VtZW50KHhyTG9hZCwgWG1sU3BhY2UuUHJlc2VydmUpOw0KICAgICAgICAgICAgICAgICAgICB4ckxvYWQuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBOYXZpZ2F0b3IgIiArIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKHhkVGVtcCwgWHNsdFNldHRpbmdzLlRydXN0ZWRYc2x0LCB4cik7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCg0KICAgICAgICAvL1ZlcmlmeVJlc3VsdA0KICAgICAgICBwdWJsaWMgdm9pZCBWZXJpZnlSZXN1bHQoc3RyaW5nIGV4cGVjdGVkVmFsdWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbERpZmYuWG1sRGlmZiB4bWxkaWZmID0gbmV3IFhtbERpZmYuWG1sRGlmZigpOw0KICAgICAgICAgICAgeG1sZGlmZi5PcHRpb24gPSBYbWxEaWZmT3B0aW9uLkluZm9zZXRDb21wYXJpc29uIHwgWG1sRGlmZk9wdGlvbi5JZ25vcmVFbXB0eUVsZW1lbnQgfCBYbWxEaWZmT3B0aW9uLk5vcm1hbGl6ZU5ld2xpbmU7DQoNCiAgICAgICAgICAgIFN0cmVhbVJlYWRlciBzciA9IG5ldyBTdHJlYW1SZWFkZXIobmV3IEZpbGVTdHJlYW0oIm91dC54bWwiLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQpKTsNCiAgICAgICAgICAgIHN0cmluZyBhY3R1YWxWYWx1ZSA9IHNyLlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgc3IuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICAvL091dHB1dCB0aGUgZXhwZWN0ZWQgYW5kIGFjdHVhbCB2YWx1ZXMNCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeHBlY3RlZCA6ICIgKyBleHBlY3RlZFZhbHVlKTsNCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJBY3R1YWwgOiAiICsgYWN0dWFsVmFsdWUpOw0KDQogICAgICAgICAgICAvL0xvYWQgaW50byBYbWxUZXh0UmVhZGVycw0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciB0cjEgPSBuZXcgWG1sVGV4dFJlYWRlcigib3V0LnhtbCIpOw0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciB0cjIgPSBuZXcgWG1sVGV4dFJlYWRlcihuZXcgU3RyaW5nUmVhZGVyKGV4cGVjdGVkVmFsdWUpKTsNCg0KICAgICAgICAgICAgYm9vbCByZXN1bHQgPSB4bWxkaWZmLkNvbXBhcmUodHIxLCB0cjIpOw0KDQogICAgICAgICAgICAvL0Nsb3NlIHRoZSByZWFkZXJzDQogICAgICAgICAgICB0cjEuRGlzcG9zZSgpOw0KICAgICAgICAgICAgdHIyLkRpc3Bvc2UoKTsNCg0KICAgICAgICAgICAgIEFzc2VydC5UcnVlKHJlc3VsdCk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1ZlcmlmeVJlc3VsdCB3aGljaCBjb21wYXJlcyAyIGFyZ3VtZW50cyB1c2luZyBYbWxEaWZmLg0KICAgICAgICBwdWJsaWMgdm9pZCBWZXJpZnlSZXN1bHQoc3RyaW5nIGJhc2VsaW5lLCBzdHJpbmcgb3V0cHV0RmlsZSkNCiAgICAgICAgew0KICAgICAgICAgICAgYm9vbCByZXN1bHQgPSBmYWxzZTsNCiAgICAgICAgICAgIEZpbGVTdHJlYW0gZnNFeHBlY3RlZDsNCg0KICAgICAgICAgICAgYmFzZWxpbmUgPSBGdWxsRmlsZVBhdGgoYmFzZWxpbmUpOw0KDQogICAgICAgICAgICBYbWxEaWZmLlhtbERpZmYgZGlmZiA9IG5ldyBYbWxEaWZmLlhtbERpZmYoKTsNCiAgICAgICAgICAgIGRpZmYuT3B0aW9uID0gWG1sRGlmZk9wdGlvbi5JZ25vcmVFbXB0eUVsZW1lbnQgfCBYbWxEaWZmT3B0aW9uLklnbm9yZUF0dHJpYnV0ZU9yZGVyIHwgWG1sRGlmZk9wdGlvbi5JbmZvc2V0Q29tcGFyaXNvbiB8IFhtbERpZmZPcHRpb24uSWdub3JlV2hpdGVzcGFjZSB8IFhtbERpZmZPcHRpb24uTm9ybWFsaXplTmV3bGluZTsNCiAgICAgICAgICAgIFhtbFBhcnNlckNvbnRleHQgY29udGV4dCA9IG5ldyBYbWxQYXJzZXJDb250ZXh0KG5ldyBOYW1lVGFibGUoKSwgbnVsbCwgIiIsIFhtbFNwYWNlLk5vbmUpOw0KDQogICAgICAgICAgICBmc0V4cGVjdGVkID0gbmV3IEZpbGVTdHJlYW0oYmFzZWxpbmUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCwgRmlsZVNoYXJlLlJlYWQpOw0KICAgICAgICAgICAgRmlsZVN0cmVhbSBmc0FjdHVhbCA9IG5ldyBGaWxlU3RyZWFtKG91dHB1dEZpbGUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCwgRmlsZVNoYXJlLlJlYWQpOw0KDQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiVmVyaWZ5aW5nIG8vcCB3aXRoIGJhc2VsaW5lIHJlc3VsdCB7MH0uLi4iLCBiYXNlbGluZSk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBkaWZmLkNvbXBhcmUobmV3IFhtbFRleHRSZWFkZXIoZnNBY3R1YWwsIFhtbE5vZGVUeXBlLkVsZW1lbnQsIGNvbnRleHQpLCBuZXcgWG1sVGV4dFJlYWRlcihmc0V4cGVjdGVkLCBYbWxOb2RlVHlwZS5FbGVtZW50LCBjb250ZXh0KSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVE8gRE86IFdyaXRlIGV4Y2VwdGlvbiBtc2dzIGluIGlnbm9yZSB0YWdzDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmc0V4cGVjdGVkLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICBmc0FjdHVhbC5EaXNwb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIXJlc3VsdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBXcml0ZSBvdXQgdGhlIGFjdHVhbCBhbmQgZXhwZWN0ZWQgby9wDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4cGVjdGVkIG8vcDogIik7DQogICAgICAgICAgICAgICAgdXNpbmcgKFN0cmVhbVJlYWRlciBzciA9IG5ldyBTdHJlYW1SZWFkZXIobmV3IEZpbGVTdHJlYW0oYmFzZWxpbmUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGJhc2VMaW5lID0gc3IuUmVhZFRvRW5kKCk7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGJhc2VMaW5lKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkFjdHVhbCBvL3A6ICIpOw0KICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW1SZWFkZXIgc3IgPSBuZXcgU3RyZWFtUmVhZGVyKG5ldyBGaWxlU3RyZWFtKG91dHB1dEZpbGUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG91dHB1dCA9IHNyLlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShvdXRwdXQpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW1Xcml0ZXIgc3cgPSBuZXcgU3RyZWFtV3JpdGVyKG5ldyBGaWxlU3RyZWFtKCJkaWZmLnhtbCIsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3cuV3JpdGVMaW5lKCI8P3htbC1zdHlsZXNoZWV0IGhyZWY9J2RpZmYueHNsJyB0eXBlPSd0ZXh0L3hzbCc/PiIpOw0KICAgICAgICAgICAgICAgICAgICBzdy5Xcml0ZUxpbmUoZGlmZi5Ub1htbCgpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKHJlc3VsdCwgIioqKiogQmFzZWxpbmUgbWlzLW1hdGNoZWQgKioqKiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gIFRyYW5zZm9ybQ0KICAgICAgICAvLyAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQogICAgICAgIHB1YmxpYyBpbnQgVHJhbnNmb3JtKHN0cmluZyBzelhtbEZpbGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBEZWZhdWx0IHZhbHVlIG9mIGVycm9yQ2FzZSBpcyBmYWxzZQ0KICAgICAgICAgICAgcmV0dXJuIChUcmFuc2Zvcm0oc3pYbWxGaWxlLCBvdXRwdXRUeXBlLCBuYXZUeXBlLCBmYWxzZSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBUcmFuc2Zvcm0oU3RyaW5nIHN6WG1sRmlsZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUsIGJvb2wgZXJyb3JDYXNlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzelhtbEZpbGUgPSBGdWxsRmlsZVBhdGgoc3pYbWxGaWxlKTsNCg0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgWE1MICIgKyBzelhtbEZpbGUpOw0KICAgICAgICAgICAgSVhQYXRoTmF2aWdhYmxlIHhkID0gTG9hZFhNTChzelhtbEZpbGUsIG5hdlR5cGUpOw0KDQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhlY3V0aW5nIHRyYW5zZm9ybSIpOw0KICAgICAgICAgICAgeHJYU0xUID0gbnVsbDsNCiAgICAgICAgICAgIFN0cmVhbSBzdHJtVGVtcCA9IG51bGw7DQogICAgICAgICAgICBzd2l0Y2ggKG91dHB1dFR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBPdXRwdXRUeXBlLlN0cmVhbToNCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm1UZW1wID0gbmV3IEZpbGVTdHJlYW0oX3N0ck91dEZpbGUsIEZpbGVNb2RlLkNyZWF0ZSwgRmlsZUFjY2Vzcy5SZWFkV3JpdGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeGQsIG51bGwsIHN0cm1UZW1wKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJtVGVtcCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm1UZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgT3V0cHV0VHlwZS5Xcml0ZXI6DQogICAgICAgICAgICAgICAgICAgIFhtbFdyaXRlclNldHRpbmdzIHh3cyA9IG5ldyBYbWxXcml0ZXJTZXR0aW5ncygpOw0KICAgICAgICAgICAgICAgICAgICB4d3MuRW5jb2RpbmcgPSBFbmNvZGluZy5VVEY4Ow0KICAgICAgICAgICAgICAgICAgICBYbWxXcml0ZXIgeHcgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgeHcgPSBYbWxXcml0ZXIuQ3JlYXRlKF9zdHJPdXRGaWxlLCB4d3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgeHcuV3JpdGVTdGFydERvY3VtZW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbnVsbCwgeHcpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHh3ICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHcuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBPdXRwdXRUeXBlLlRleHRXcml0ZXI6DQogICAgICAgICAgICAgICAgICAgIFRleHRXcml0ZXIgdHcgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdHcgPSBuZXcgU3RyZWFtV3JpdGVyKG5ldyBGaWxlU3RyZWFtKF9zdHJPdXRGaWxlLCBGaWxlTW9kZS5DcmVhdGUsIEZpbGVBY2Nlc3MuV3JpdGUpLCBFbmNvZGluZy5VVEY4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKHhkLCBudWxsLCB0dyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHcgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dy5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vICBUcmFuc2Zvcm1fQXJnTGlzdA0KICAgICAgICAvLyAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQogICAgICAgIHB1YmxpYyBpbnQgVHJhbnNmb3JtX0FyZ0xpc3Qoc3RyaW5nIHN6WG1sRmlsZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIERlZmF1bHQgdmFsdWUgb2YgZXJyb3JDYXNlIGlzIGZhbHNlDQogICAgICAgICAgICByZXR1cm4gKFRyYW5zZm9ybV9BcmdMaXN0KHN6WG1sRmlsZSwgb3V0cHV0VHlwZSwgbmF2VHlwZSwgZmFsc2UpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBpbnQgVHJhbnNmb3JtX0FyZ0xpc3Qoc3RyaW5nIHN6WG1sRmlsZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUsIGJvb2wgZXJyb3JDYXNlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzelhtbEZpbGUgPSBGdWxsRmlsZVBhdGgoc3pYbWxGaWxlKTsNCg0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgWE1MICIgKyBzelhtbEZpbGUpOw0KICAgICAgICAgICAgSVhQYXRoTmF2aWdhYmxlIHhkID0gTG9hZFhNTChzelhtbEZpbGUsIG5hdlR5cGUpOw0KDQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhlY3V0aW5nIHRyYW5zZm9ybSIpOw0KICAgICAgICAgICAgeHJYU0xUID0gbnVsbDsNCiAgICAgICAgICAgIFN0cmVhbSBzdHJtVGVtcCA9IG51bGw7DQogICAgICAgICAgICBzd2l0Y2ggKG91dHB1dFR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBPdXRwdXRUeXBlLlN0cmVhbToNCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm1UZW1wID0gbmV3IEZpbGVTdHJlYW0oX3N0ck91dEZpbGUsIEZpbGVNb2RlLkNyZWF0ZSwgRmlsZUFjY2Vzcy5SZWFkV3JpdGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeGQsIG1feHNsdEFyZywgc3RybVRlbXApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cm1UZW1wICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RybVRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBPdXRwdXRUeXBlLldyaXRlcjoNCiAgICAgICAgICAgICAgICAgICAgWG1sV3JpdGVyIHh3ID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHh3ID0gbmV3IFhtbFRleHRXcml0ZXIoX3N0ck91dEZpbGUsIEVuY29kaW5nLlVURjgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgeHcuV3JpdGVTdGFydERvY3VtZW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbV94c2x0QXJnLCB4dyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeHcgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dy5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBjYXNlIE91dHB1dFR5cGUuVGV4dFdyaXRlcjoNCiAgICAgICAgICAgICAgICAgICAgVGV4dFdyaXRlciB0dyA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB0dyA9IG5ldyBTdHJlYW1Xcml0ZXIobmV3IEZpbGVTdHJlYW0oX3N0ck91dEZpbGUsIEZpbGVNb2RlLkNyZWF0ZSwgRmlsZUFjY2Vzcy5Xcml0ZSksIEVuY29kaW5nLlVURjgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeGQsIG1feHNsdEFyZywgdHcpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR3ICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHcuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgVHJhbnNmb3JtUmVzb2x2ZXINCiAgICAgICAgLy8gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgICAgICBwdWJsaWMgaW50IFRyYW5zZm9ybVJlc29sdmVyKHN0cmluZyBzelhtbEZpbGUsIE91dHB1dFR5cGUgb3V0cHV0VHlwZSwgTmF2VHlwZSBuYXZUeXBlLCBYbWxSZXNvbHZlciB4cikNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gRGVmYXVsdCB2YWx1ZSBvZiBlcnJvckNhc2UgaXMgZmFsc2UNCiAgICAgICAgICAgIHJldHVybiAoVHJhbnNmb3JtUmVzb2x2ZXIoc3pYbWxGaWxlLCBvdXRwdXRUeXBlLCBuYXZUeXBlLCB4ciwgZmFsc2UpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBpbnQgVHJhbnNmb3JtUmVzb2x2ZXIoc3RyaW5nIHN6WG1sRmlsZSwgT3V0cHV0VHlwZSBvdXRwdXRUeXBlLCBOYXZUeXBlIG5hdlR5cGUsIFhtbFJlc29sdmVyIHhyLCBib29sIGVycm9yQ2FzZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3pYbWxGaWxlID0gRnVsbEZpbGVQYXRoKHN6WG1sRmlsZSk7DQoNCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJMb2FkaW5nIFhNTCAiICsgc3pYbWxGaWxlKTsNCiAgICAgICAgICAgIElYUGF0aE5hdmlnYWJsZSB4ZCA9IExvYWRYTUwoc3pYbWxGaWxlLCBuYXZUeXBlKTsNCg0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4ZWN1dGluZyB0cmFuc2Zvcm0iKTsNCiAgICAgICAgICAgIHhyWFNMVCA9IG51bGw7DQogICAgICAgICAgICBTdHJlYW0gc3RybVRlbXAgPSBudWxsOw0KDQogICAgICAgICAgICBzd2l0Y2ggKG91dHB1dFR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBPdXRwdXRUeXBlLlN0cmVhbToNCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm1UZW1wID0gbmV3IEZpbGVTdHJlYW0oX3N0ck91dEZpbGUsIEZpbGVNb2RlLkNyZWF0ZSwgRmlsZUFjY2Vzcy5SZWFkV3JpdGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeGQsIG51bGwsIHN0cm1UZW1wKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJtVGVtcCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm1UZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgT3V0cHV0VHlwZS5Xcml0ZXI6DQogICAgICAgICAgICAgICAgICAgIFhtbFdyaXRlciB4dyA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB4dyA9IG5ldyBYbWxUZXh0V3JpdGVyKF9zdHJPdXRGaWxlLCBFbmNvZGluZy5VVEY4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHh3LldyaXRlU3RhcnREb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeGQsIG51bGwsIHh3KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4dyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHh3LkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgT3V0cHV0VHlwZS5UZXh0V3JpdGVyOg0KICAgICAgICAgICAgICAgICAgICBUZXh0V3JpdGVyIHR3ID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ID0gbmV3IFN0cmVhbVdyaXRlcihuZXcgRmlsZVN0cmVhbShfc3RyT3V0RmlsZSwgRmlsZU1vZGUuQ3JlYXRlLCBGaWxlQWNjZXNzLldyaXRlKSwgRW5jb2RpbmcuVVRGOCk7DQogICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbnVsbCwgdHcpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR3ICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHcuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpbnRlcm5hbCBjbGFzcyBDRXhjZXB0aW9uSGFuZGxlcg0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBYUGF0aERvY3VtZW50IF9kb2M7DQogICAgICAgIHByaXZhdGUgWFBhdGhOYXZpZ2F0b3IgX25hdjsNCiAgICAgICAgcHVibGljIHN0cmluZyBtc2c7DQogICAgICAgIHB1YmxpYyBzdHJpbmcgcmVzOw0KICAgICAgICBwcml2YXRlIEV4Y2VwdGlvblZlcmlmaWVyIF9leFZlcjsNCg0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQoNCiAgICAgICAgcHVibGljIENFeGNlcHRpb25IYW5kbGVyKHN0cmluZyBzdHJYbWxGaWxlLCBzdHJpbmcgbnMsIElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX2V4VmVyID0gbmV3IEV4Y2VwdGlvblZlcmlmaWVyKG5zLCBFeGNlcHRpb25WZXJpZmljYXRpb25GbGFncy5JZ25vcmVNdWx0aXBsZURvdHMsIG91dHB1dCk7DQoNCiAgICAgICAgICAgIF9kb2MgPSBuZXcgWFBhdGhEb2N1bWVudChzdHJYbWxGaWxlKTsNCiAgICAgICAgICAgIF9uYXYgPSAoKElYUGF0aE5hdmlnYWJsZSlfZG9jKS5DcmVhdGVOYXZpZ2F0b3IoKTsNCg0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vICBWZXJpZnlFeGNlcHRpb24NCiAgICAgICAgLy8gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGJvb2wgVmVyaWZ5RXhjZXB0aW9uKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgew0KICAgICAgICAgICAgVHlwZSBfdHlwZSA9IGV4LkdldFR5cGUoKTsNCiAgICAgICAgICAgIHJlcyA9IFN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgIG1zZyA9IChzdHJpbmcpX25hdi5FdmFsdWF0ZSgic3RyaW5nKC9leGNlcHRpb25zL2V4Y2VwdGlvbiBbQHJlcyA9ICciICsgcmVzICsgIiddL0BtZXNzYWdlKSIpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2V4VmVyLklzRXhjZXB0aW9uT2soZXgsIHJlcyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4cCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShleHAuTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGJvb2wgVmVyaWZ5RXhjZXB0aW9uKEV4Y2VwdGlvbiBleCwgc3RyaW5nIHJlcywgc3RyaW5nW10gc3RyUGFyYW1zKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZXhWZXIuSXNFeGNlcHRpb25PayhleCwgcmVzLCBzdHJQYXJhbXMpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleHApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZXhwLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXmlCache.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0LkFic3RyYWN0aW9uczsNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlhtbDsNCnVzaW5nIFN5c3RlbS5YbWwuU2NoZW1hOw0KDQpwdWJsaWMgZW51bSBOb2RlRmxhZ3MNCnsNCiAgICBOb25lID0gMCwNCiAgICBFbXB0eUVsZW1lbnQgPSAxLA0KICAgIEhhc1ZhbHVlID0gMiwNCiAgICBTaW5nbGVRdW90ZSA9IDQsDQogICAgRGVmYXVsdEF0dHJpYnV0ZSA9IDgsDQogICAgVW5wYXJzZWRFbnRpdGllcyA9IDE2LA0KICAgIElzV2hpdGVzcGFjZSA9IDMyLA0KICAgIERvY3VtZW50Um9vdCA9IDY0LA0KICAgIEF0dHJpYnV0ZVRleHROb2RlID0gMTI4LA0KICAgIE1peGVkQ29udGVudCA9IDI1NiwNCiAgICBJbmRlbnQgPSA1MTINCn0NCg0KYWJzdHJhY3QgcHVibGljIGNsYXNzIENYbWxCYXNlDQp7DQogICAgcHJvdGVjdGVkIFhtbE5vZGVUeXBlIF9uVHlwZTsNCiAgICBwcm90ZWN0ZWQgc3RyaW5nIF9zdHJOYW1lOw0KICAgIHByb3RlY3RlZCBzdHJpbmcgX3N0ckxvY2FsTmFtZTsNCiAgICBwcm90ZWN0ZWQgc3RyaW5nIF9zdHJQcmVmaXg7DQogICAgcHJvdGVjdGVkIHN0cmluZyBfc3RyTmFtZXNwYWNlOw0KICAgIGludGVybmFsIGludCBfbkRlcHRoOw0KICAgIGludGVybmFsIE5vZGVGbGFncyBfZUZsYWdzID0gTm9kZUZsYWdzLk5vbmU7DQogICAgaW50ZXJuYWwgQ1htbEJhc2UgX3JOZXh0Tm9kZSA9IG51bGw7DQogICAgaW50ZXJuYWwgQ1htbEJhc2UgX3JQYXJlbnROb2RlID0gbnVsbDsNCiAgICBpbnRlcm5hbCBDWG1sQmFzZSBfckZpcnN0Q2hpbGROb2RlID0gbnVsbDsNCiAgICBpbnRlcm5hbCBDWG1sQmFzZSBfckxhc3RDaGlsZE5vZGUgPSBudWxsOw0KICAgIGludGVybmFsIGludCBfbkNoaWxkTm9kZXMgPSAwOw0KDQogICAgLy8NCiAgICAvLyBDb25zdHJ1Y3RvcnMNCiAgICAvLw0KICAgIHB1YmxpYyBDWG1sQmFzZShzdHJpbmcgc3RyUHJlZml4LCBzdHJpbmcgc3RyTmFtZSwgc3RyaW5nIHN0ckxvY2FsTmFtZSwgWG1sTm9kZVR5cGUgTm9kZVR5cGUsIHN0cmluZyBzdHJOYW1lc3BhY2UpDQogICAgew0KICAgICAgICBfc3RyUHJlZml4ID0gc3RyUHJlZml4Ow0KICAgICAgICBfc3RyTmFtZSA9IHN0ck5hbWU7DQogICAgICAgIF9zdHJMb2NhbE5hbWUgPSBzdHJMb2NhbE5hbWU7DQogICAgICAgIF9uVHlwZSA9IE5vZGVUeXBlOw0KICAgICAgICBfc3RyTmFtZXNwYWNlID0gc3RyTmFtZXNwYWNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBDWG1sQmFzZShzdHJpbmcgc3RyUHJlZml4LCBzdHJpbmcgc3RyTmFtZSwgWG1sTm9kZVR5cGUgTm9kZVR5cGUsIHN0cmluZyBzdHJOYW1lc3BhY2UpDQogICAgICAgIDogdGhpcyhzdHJQcmVmaXgsIHN0ck5hbWUsIHN0ck5hbWUsIE5vZGVUeXBlLCBzdHJOYW1lc3BhY2UpDQogICAgeyB9DQoNCiAgICBwdWJsaWMgQ1htbEJhc2Uoc3RyaW5nIHN0clByZWZpeCwgc3RyaW5nIHN0ck5hbWUsIFhtbE5vZGVUeXBlIE5vZGVUeXBlKQ0KICAgICAgICA6IHRoaXMoc3RyUHJlZml4LCBzdHJOYW1lLCBzdHJOYW1lLCBOb2RlVHlwZSwgIiIpDQogICAgeyB9DQoNCiAgICBwdWJsaWMgQ1htbEJhc2Uoc3RyaW5nIHN0ck5hbWUsIFhtbE5vZGVUeXBlIE5vZGVUeXBlKQ0KICAgICAgICA6IHRoaXMoIiIsIHN0ck5hbWUsIHN0ck5hbWUsIE5vZGVUeXBlLCAiIikNCiAgICB7IH0NCg0KICAgIC8vDQogICAgLy8gVmlydHVhbCBNZXRob2RzIGFuZCBQcm9wZXJ0aWVzDQogICAgLy8NCiAgICBhYnN0cmFjdCBwdWJsaWMgdm9pZCBXcml0ZShYbWxXcml0ZXIgclhtbFdyaXRlcik7DQoNCiAgICBhYnN0cmFjdCBwdWJsaWMgdm9pZCBXcml0ZVhtbChUZXh0V3JpdGVyIHJUVyk7DQoNCiAgICBhYnN0cmFjdCBwdWJsaWMgc3RyaW5nIFZhbHVlDQogICAgeyBnZXQ7IH0NCg0KICAgIC8vDQogICAgLy8gUHVibGljIE1ldGhvZHMgYW5kIFByb3BlcnRpZXMNCiAgICAvLw0KICAgIHB1YmxpYyBzdHJpbmcgTmFtZQ0KICAgIHsNCiAgICAgICAgZ2V0IHsgcmV0dXJuIF9zdHJOYW1lOyB9DQogICAgfQ0KDQogICAgcHVibGljIHN0cmluZyBMb2NhbE5hbWUNCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBfc3RyTG9jYWxOYW1lOyB9DQogICAgfQ0KDQogICAgcHVibGljIHN0cmluZyBQcmVmaXgNCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBfc3RyUHJlZml4OyB9DQogICAgfQ0KDQogICAgcHVibGljIHN0cmluZyBOYW1lc3BhY2UNCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBfc3RyTmFtZXNwYWNlOyB9DQogICAgfQ0KDQogICAgcHVibGljIGludCBEZXB0aA0KICAgIHsNCiAgICAgICAgZ2V0IHsgcmV0dXJuIF9uRGVwdGg7IH0NCiAgICB9DQoNCiAgICBwdWJsaWMgWG1sTm9kZVR5cGUgTm9kZVR5cGUNCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBfblR5cGU7IH0NCiAgICB9DQoNCiAgICBwdWJsaWMgTm9kZUZsYWdzIEZsYWdzDQogICAgew0KICAgICAgICBnZXQgeyByZXR1cm4gX2VGbGFnczsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgQ2hpbGROb2RlQ291bnQNCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBfbkNoaWxkTm9kZXM7IH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBJbnNlcnROb2RlKENYbWxCYXNlIHJOb2RlKQ0KICAgIHsNCiAgICAgICAgaWYgKF9yRmlyc3RDaGlsZE5vZGUgPT0gbnVsbCkNCiAgICAgICAgew0KICAgICAgICAgICAgX3JGaXJzdENoaWxkTm9kZSA9IF9yTGFzdENoaWxkTm9kZSA9IHJOb2RlOw0KICAgICAgICB9DQogICAgICAgIGVsc2UNCiAgICAgICAgew0KICAgICAgICAgICAgX3JMYXN0Q2hpbGROb2RlLl9yTmV4dE5vZGUgPSByTm9kZTsNCiAgICAgICAgICAgIF9yTGFzdENoaWxkTm9kZSA9IHJOb2RlOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCh0aGlzLl9lRmxhZ3MgJiBOb2RlRmxhZ3MuSXNXaGl0ZXNwYWNlKSA9PSAwKQ0KICAgICAgICAgICAgX25DaGlsZE5vZGVzKys7DQoNCiAgICAgICAgck5vZGUuX3JQYXJlbnROb2RlID0gdGhpczsNCiAgICB9DQoNCiAgICAvLw0KICAgIC8vIEludGVybmFsIE1ldGhvZHMgYW5kIFByb3BlcnRpZXMNCiAgICAvLw0KICAgIGludGVybmFsIENYbWxCYXNlIF9DaGlsZChpbnQgbikNCiAgICB7DQogICAgICAgIGludCBpOw0KICAgICAgICBpbnQgajsNCiAgICAgICAgQ1htbEJhc2UgckNoaWxkID0gX3JGaXJzdENoaWxkTm9kZTsNCg0KICAgICAgICBmb3IgKGkgPSAwLCBqID0gMDsgckNoaWxkICE9IG51bGw7IGkrKywgckNoaWxkID0gckNoaWxkLl9yTmV4dE5vZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICgockNoaWxkLl9lRmxhZ3MgJiBOb2RlRmxhZ3MuSXNXaGl0ZXNwYWNlKSA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChqKysgPT0gbikgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gckNoaWxkOw0KICAgIH0NCg0KICAgIGludGVybmFsIENYbWxCYXNlIF9DaGlsZChzdHJpbmcgc3RyKQ0KICAgIHsNCiAgICAgICAgQ1htbEJhc2UgckNoaWxkOw0KDQogICAgICAgIGZvciAockNoaWxkID0gX3JGaXJzdENoaWxkTm9kZTsgckNoaWxkICE9IG51bGw7IHJDaGlsZCA9IHJDaGlsZC5fck5leHROb2RlKQ0KICAgICAgICAgICAgaWYgKHJDaGlsZC5OYW1lID09IHN0cikgYnJlYWs7DQoNCiAgICAgICAgcmV0dXJuIHJDaGlsZDsNCiAgICB9DQp9DQoNCnB1YmxpYyBjbGFzcyBDWG1sQXR0cmlidXRlIDogQ1htbEJhc2UNCnsNCiAgICAvLw0KICAgIC8vIENvbnN0cnVjdG9yDQogICAgLy8NCiAgICBwdWJsaWMgQ1htbEF0dHJpYnV0ZShYbWxSZWFkZXIgclhtbFJlYWRlcikNCiAgICAgICAgOiBiYXNlKHJYbWxSZWFkZXIuUHJlZml4LCByWG1sUmVhZGVyLk5hbWUsIHJYbWxSZWFkZXIuTG9jYWxOYW1lLCByWG1sUmVhZGVyLk5vZGVUeXBlLCByWG1sUmVhZGVyLk5hbWVzcGFjZVVSSSkNCiAgICB7DQogICAgICAgIGlmIChyWG1sUmVhZGVyLklzRGVmYXVsdCkNCiAgICAgICAgICAgIF9lRmxhZ3MgfD0gTm9kZUZsYWdzLkRlZmF1bHRBdHRyaWJ1dGU7DQoNCiAgICAgICAgaWYgKHJYbWxSZWFkZXIuUXVvdGVDaGFyID09ICdcJycpDQogICAgICAgICAgICBfZUZsYWdzIHw9IE5vZGVGbGFncy5TaW5nbGVRdW90ZTsNCiAgICB9DQoNCiAgICAvLw0KICAgIC8vIFB1YmxpYyBNZXRob2RzIGFuZCBQcm9wZXJ0aWVzIChPdmVycmlkZSkNCiAgICAvLw0KICAgIG92ZXJyaWRlIHB1YmxpYyB2b2lkIFdyaXRlKFhtbFdyaXRlciByWG1sV3JpdGVyKQ0KICAgIHsNCiAgICAgICAgQ1htbEJhc2Ugck5vZGU7DQoNCiAgICAgICAgaWYgKCh0aGlzLl9lRmxhZ3MgJiBOb2RlRmxhZ3MuRGVmYXVsdEF0dHJpYnV0ZSkgPT0gMCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHJYbWxXcml0ZXIgaXMgWG1sVGV4dFdyaXRlcikNCiAgICAgICAgICAgICAgICAoKFhtbFRleHRXcml0ZXIpclhtbFdyaXRlcikuUXVvdGVDaGFyID0gdGhpcy5RdW90ZTsNCg0KICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZVN0YXJ0QXR0cmlidXRlKHRoaXMuUHJlZml4LCB0aGlzLkxvY2FsTmFtZSwgdGhpcy5OYW1lc3BhY2UpOw0KDQogICAgICAgICAgICBmb3IgKHJOb2RlID0gdGhpcy5fckZpcnN0Q2hpbGROb2RlOyByTm9kZSAhPSBudWxsOyByTm9kZSA9IHJOb2RlLl9yTmV4dE5vZGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgck5vZGUuV3JpdGUoclhtbFdyaXRlcik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJYbWxXcml0ZXIuV3JpdGVFbmRBdHRyaWJ1dGUoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIG92ZXJyaWRlIHB1YmxpYyB2b2lkIFdyaXRlWG1sKFRleHRXcml0ZXIgclRXKQ0KICAgIHsNCiAgICAgICAgaWYgKCh0aGlzLl9lRmxhZ3MgJiBOb2RlRmxhZ3MuRGVmYXVsdEF0dHJpYnV0ZSkgPT0gMCkNCiAgICAgICAgew0KICAgICAgICAgICAgQ1htbEJhc2Ugck5vZGU7DQoNCiAgICAgICAgICAgIHJUVy5Xcml0ZSgnICcgKyB0aGlzLk5hbWUgKyAnPScgKyB0aGlzLlF1b3RlKTsNCiAgICAgICAgICAgIGZvciAock5vZGUgPSB0aGlzLl9yRmlyc3RDaGlsZE5vZGU7IHJOb2RlICE9IG51bGw7IHJOb2RlID0gck5vZGUuX3JOZXh0Tm9kZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByTm9kZS5Xcml0ZVhtbChyVFcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgclRXLldyaXRlKHRoaXMuUXVvdGUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8NCiAgICAvLyBQdWJsaWMgTWV0aG9kcyBhbmQgUHJvcGVydGllcw0KICAgIC8vDQogICAgb3ZlcnJpZGUgcHVibGljIHN0cmluZyBWYWx1ZQ0KICAgIHsNCiAgICAgICAgZ2V0DQogICAgICAgIHsNCiAgICAgICAgICAgIENYbWxOb2RlIHJOb2RlOw0KICAgICAgICAgICAgc3RyaW5nIHN0clZhbHVlID0gc3RyaW5nLkVtcHR5Ow0KDQogICAgICAgICAgICBmb3IgKHJOb2RlID0gKENYbWxOb2RlKXRoaXMuX3JGaXJzdENoaWxkTm9kZTsgck5vZGUgIT0gbnVsbDsgck5vZGUgPSByTm9kZS5OZXh0Tm9kZSkNCiAgICAgICAgICAgICAgICBzdHJWYWx1ZSArPSByTm9kZS5WYWx1ZTsNCg0KICAgICAgICAgICAgcmV0dXJuIHN0clZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIENYbWxBdHRyaWJ1dGUgTmV4dEF0dHJpYnV0ZQ0KICAgIHsNCiAgICAgICAgZ2V0IHsgcmV0dXJuIChDWG1sQXR0cmlidXRlKXRoaXMuX3JOZXh0Tm9kZTsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBjaGFyIFF1b3RlDQogICAgew0KICAgICAgICBnZXQgeyByZXR1cm4gKChiYXNlLl9lRmxhZ3MgJiBOb2RlRmxhZ3MuU2luZ2xlUXVvdGUpICE9IDAgPyAnXCcnIDogJyInKTsgfQ0KICAgICAgICBzZXQgeyBpZiAodmFsdWUgPT0gJ1wnJykgYmFzZS5fZUZsYWdzIHw9IE5vZGVGbGFncy5TaW5nbGVRdW90ZTsgZWxzZSBiYXNlLl9lRmxhZ3MgJj0gfk5vZGVGbGFncy5TaW5nbGVRdW90ZTsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBDWG1sTm9kZSBGaXJzdENoaWxkDQogICAgew0KICAgICAgICBnZXQgeyByZXR1cm4gKENYbWxOb2RlKWJhc2UuX3JGaXJzdENoaWxkTm9kZTsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBDWG1sTm9kZSBDaGlsZChpbnQgbikNCiAgICB7DQogICAgICAgIHJldHVybiAoQ1htbE5vZGUpYmFzZS5fQ2hpbGQobik7DQogICAgfQ0KDQogICAgcHVibGljIENYbWxOb2RlIENoaWxkKHN0cmluZyBzdHIpDQogICAgew0KICAgICAgICByZXR1cm4gKENYbWxOb2RlKWJhc2UuX0NoaWxkKHN0cik7DQogICAgfQ0KfQ0KDQpwdWJsaWMgY2xhc3MgQ1htbE5vZGUgOiBDWG1sQmFzZQ0Kew0KICAgIGludGVybmFsIHN0cmluZyBfc3RyVmFsdWUgPSBudWxsOw0KICAgIHByaXZhdGUgQ1htbEF0dHJpYnV0ZSBfckZpcnN0QXR0cmlidXRlID0gbnVsbDsNCiAgICBwcml2YXRlIENYbWxBdHRyaWJ1dGUgX3JMYXN0QXR0cmlidXRlID0gbnVsbDsNCiAgICBwcml2YXRlIGludCBfbkF0dHJpYnV0ZUNvdW50ID0gMDsNCg0KICAgIC8vDQogICAgLy8gQ29uc3RydWN0b3JzDQogICAgLy8NCiAgICBwdWJsaWMgQ1htbE5vZGUoc3RyaW5nIHN0clByZWZpeCwgc3RyaW5nIHN0ck5hbWUsIFhtbE5vZGVUeXBlIE5vZGVUeXBlKQ0KICAgICAgICA6IGJhc2Uoc3RyUHJlZml4LCBzdHJOYW1lLCBOb2RlVHlwZSkNCiAgICB7IH0NCg0KICAgIHB1YmxpYyBDWG1sTm9kZShYbWxSZWFkZXIgclhtbFJlYWRlcikNCiAgICAgICAgOiBiYXNlKHJYbWxSZWFkZXIuUHJlZml4LCByWG1sUmVhZGVyLk5hbWUsIHJYbWxSZWFkZXIuTG9jYWxOYW1lLCByWG1sUmVhZGVyLk5vZGVUeXBlLCByWG1sUmVhZGVyLk5hbWVzcGFjZVVSSSkNCiAgICB7DQogICAgICAgIF9lRmxhZ3MgfD0gQ1htbENhY2hlLl9lRGVmYXVsdEZsYWdzOw0KDQogICAgICAgIGlmIChOb2RlVHlwZSA9PSBYbWxOb2RlVHlwZS5XaGl0ZXNwYWNlIHx8DQogICAgICAgICAgICBOb2RlVHlwZSA9PSBYbWxOb2RlVHlwZS5TaWduaWZpY2FudFdoaXRlc3BhY2UpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9lRmxhZ3MgfD0gTm9kZUZsYWdzLklzV2hpdGVzcGFjZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChyWG1sUmVhZGVyLklzRW1wdHlFbGVtZW50KQ0KICAgICAgICB7DQogICAgICAgICAgICBfZUZsYWdzIHw9IE5vZGVGbGFncy5FbXB0eUVsZW1lbnQ7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoclhtbFJlYWRlci5IYXNWYWx1ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgX2VGbGFncyB8PSBOb2RlRmxhZ3MuSGFzVmFsdWU7DQogICAgICAgICAgICBfc3RyVmFsdWUgPSByWG1sUmVhZGVyLlZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8NCiAgICAvLyBQdWJsaWMgTWV0aG9kcyBhbmQgUHJvcGVydGllcyAoT3ZlcnJpZGUpDQogICAgLy8NCiAgICBvdmVycmlkZSBwdWJsaWMgdm9pZCBXcml0ZShYbWxXcml0ZXIgclhtbFdyaXRlcikNCiAgICB7DQogICAgICAgIENYbWxCYXNlIHJOb2RlOw0KICAgICAgICBDWG1sQXR0cmlidXRlIHJBdHRyaWJ1dGU7DQogICAgICAgIHN0cmluZyBEb2NUeXBlUHVibGljID0gbnVsbDsNCiAgICAgICAgc3RyaW5nIERvY1R5cGVTeXN0ZW0gPSBudWxsOw0KDQogICAgICAgIHN3aXRjaCAodGhpcy5Ob2RlVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5DREFUQToNCiAgICAgICAgICAgICAgICByWG1sV3JpdGVyLldyaXRlQ0RhdGEodGhpcy5fc3RyVmFsdWUpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNvbW1lbnQ6DQogICAgICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZUNvbW1lbnQodGhpcy5fc3RyVmFsdWUpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkRvY3VtZW50VHlwZToNCiAgICAgICAgICAgICAgICBmb3IgKHJBdHRyaWJ1dGUgPSBfckZpcnN0QXR0cmlidXRlOyByQXR0cmlidXRlICE9IG51bGw7IHJBdHRyaWJ1dGUgPSByQXR0cmlidXRlLk5leHRBdHRyaWJ1dGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAockF0dHJpYnV0ZS5OYW1lID09ICJQVUJMSUMiKQ0KICAgICAgICAgICAgICAgICAgICB7IERvY1R5cGVQdWJsaWMgPSByQXR0cmlidXRlLlZhbHVlOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChyQXR0cmlidXRlLk5hbWUgPT0gIlNZU1RFTSIpDQogICAgICAgICAgICAgICAgICAgIHsgRG9jVHlwZVN5c3RlbSA9IHJBdHRyaWJ1dGUuVmFsdWU7IH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZURvY1R5cGUodGhpcy5OYW1lLCBEb2NUeXBlUHVibGljLCBEb2NUeXBlU3lzdGVtLCB0aGlzLl9zdHJWYWx1ZSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRW50aXR5UmVmZXJlbmNlOg0KICAgICAgICAgICAgICAgIHJYbWxXcml0ZXIuV3JpdGVFbnRpdHlSZWYodGhpcy5OYW1lKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Qcm9jZXNzaW5nSW5zdHJ1Y3Rpb246DQogICAgICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZVByb2Nlc3NpbmdJbnN0cnVjdGlvbih0aGlzLk5hbWUsIHRoaXMuX3N0clZhbHVlKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5UZXh0Og0KICAgICAgICAgICAgICAgIGlmICh0aGlzLk5hbWUgPT0gc3RyaW5nLkVtcHR5KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCh0aGlzLkZsYWdzICYgTm9kZUZsYWdzLlVucGFyc2VkRW50aXRpZXMpID09IDApDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJYbWxXcml0ZXIuV3JpdGVTdHJpbmcodGhpcy5fc3RyVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZVJhdyh0aGlzLl9zdHJWYWx1ZS5Ub0NoYXJBcnJheSgpLCAwLCB0aGlzLl9zdHJWYWx1ZS5MZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdHJOYW1lWzBdID09ICcjJykNCiAgICAgICAgICAgICAgICAgICAgICAgIHJYbWxXcml0ZXIuV3JpdGVDaGFyRW50aXR5KHRoaXMuX3N0clZhbHVlWzBdKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZUVudGl0eVJlZih0aGlzLk5hbWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5XaGl0ZXNwYWNlOg0KICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5TaWduaWZpY2FudFdoaXRlc3BhY2U6DQogICAgICAgICAgICAgICAgaWYgKCh0aGlzLl9yUGFyZW50Tm9kZS5fZUZsYWdzICYgTm9kZUZsYWdzLkRvY3VtZW50Um9vdCkgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZVJhdyh0aGlzLl9zdHJWYWx1ZS5Ub0NoYXJBcnJheSgpLCAwLCB0aGlzLl9zdHJWYWx1ZS5MZW5ndGgpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZVN0cmluZyh0aGlzLl9zdHJWYWx1ZSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRWxlbWVudDoNCiAgICAgICAgICAgICAgICByWG1sV3JpdGVyLldyaXRlU3RhcnRFbGVtZW50KHRoaXMuUHJlZml4LCB0aGlzLkxvY2FsTmFtZSwgbnVsbCk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKHJBdHRyaWJ1dGUgPSBfckZpcnN0QXR0cmlidXRlOyByQXR0cmlidXRlICE9IG51bGw7IHJBdHRyaWJ1dGUgPSByQXR0cmlidXRlLk5leHRBdHRyaWJ1dGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByQXR0cmlidXRlLldyaXRlKHJYbWxXcml0ZXIpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICgodGhpcy5GbGFncyAmIE5vZGVGbGFncy5FbXB0eUVsZW1lbnQpID09IDApDQogICAgICAgICAgICAgICAgICAgIHJYbWxXcml0ZXIuV3JpdGVTdHJpbmcoc3RyaW5nLkVtcHR5KTsNCg0KICAgICAgICAgICAgICAgIGZvciAock5vZGUgPSBiYXNlLl9yRmlyc3RDaGlsZE5vZGU7IHJOb2RlICE9IG51bGw7IHJOb2RlID0gck5vZGUuX3JOZXh0Tm9kZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJOb2RlLldyaXRlKHJYbWxXcml0ZXIpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIFNob3VsZCBvbmx5IHByb2R1Y2UgZW1wdHkgdGFnIGlmIHRoZSBvcmlnaW5hbCBkb2N1bWVudCB1c2VkIGVtcHR5IHRhZw0KICAgICAgICAgICAgICAgIGlmICgodGhpcy5GbGFncyAmIE5vZGVGbGFncy5FbXB0eUVsZW1lbnQpID09IDApDQogICAgICAgICAgICAgICAgICAgIHJYbWxXcml0ZXIuV3JpdGVGdWxsRW5kRWxlbWVudCgpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgclhtbFdyaXRlci5Xcml0ZUVuZEVsZW1lbnQoKTsNCg0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlhtbERlY2xhcmF0aW9uOg0KICAgICAgICAgICAgICAgIHJYbWxXcml0ZXIuV3JpdGVSYXcoIjw/eG1sICIgKyB0aGlzLl9zdHJWYWx1ZSArICI/PiIpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIHRocm93IChuZXcgRXhjZXB0aW9uKCJOb2RlLldyaXRlOiBVbmhhbmRsZWQgbm9kZSB0eXBlICIgKyB0aGlzLk5vZGVUeXBlLlRvU3RyaW5nKCkpKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIG92ZXJyaWRlIHB1YmxpYyB2b2lkIFdyaXRlWG1sKFRleHRXcml0ZXIgclRXKQ0KICAgIHsNCiAgICAgICAgU3RyaW5nIHN0clhtbDsNCiAgICAgICAgQ1htbEF0dHJpYnV0ZSByQXR0cmlidXRlOw0KICAgICAgICBDWG1sQmFzZSByTm9kZTsNCg0KICAgICAgICBzd2l0Y2ggKHRoaXMuX25UeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlRleHQ6DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0ck5hbWUgPT0gIiIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByVFcuV3JpdGUodGhpcy5fc3RyVmFsdWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3RyTmFtZS5TdGFydHNXaXRoKCIjIikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJUVy5Xcml0ZSgiJiIgKyBDb252ZXJ0LlRvU3RyaW5nKENvbnZlcnQuVG9JbnQzMih0aGlzLl9zdHJWYWx1ZVswXSkpICsgIjsiKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJUVy5Xcml0ZSgiJiIgKyB0aGlzLk5hbWUgKyAiOyIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLldoaXRlc3BhY2U6DQogICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZToNCiAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRG9jdW1lbnRUeXBlOg0KICAgICAgICAgICAgICAgIHJUVy5Xcml0ZSh0aGlzLl9zdHJWYWx1ZSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRWxlbWVudDoNCiAgICAgICAgICAgICAgICBzdHJYbWwgPSB0aGlzLk5hbWU7DQogICAgICAgICAgICAgICAgclRXLldyaXRlKCc8JyArIHN0clhtbCk7DQoNCiAgICAgICAgICAgICAgICAvL1B1dCBpbiBhbGwgdGhlIEF0dHJpYnV0ZXMNCiAgICAgICAgICAgICAgICBmb3IgKHJBdHRyaWJ1dGUgPSBfckZpcnN0QXR0cmlidXRlOyByQXR0cmlidXRlICE9IG51bGw7IHJBdHRyaWJ1dGUgPSByQXR0cmlidXRlLk5leHRBdHRyaWJ1dGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByQXR0cmlidXRlLldyaXRlWG1sKHJUVyk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy9JZiB0aGVyZSBpcyBjaGlsZHJlbiwgcHV0IHRob3NlIGluLCBvdGhlcndpc2UgY2xvc2UgdGhlIHRhZy4NCiAgICAgICAgICAgICAgICBpZiAoKGJhc2UuX2VGbGFncyAmIE5vZGVGbGFncy5FbXB0eUVsZW1lbnQpID09IDApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByVFcuV3JpdGUoJz4nKTsNCg0KICAgICAgICAgICAgICAgICAgICBmb3IgKHJOb2RlID0gYmFzZS5fckZpcnN0Q2hpbGROb2RlOyByTm9kZSAhPSBudWxsOyByTm9kZSA9IHJOb2RlLl9yTmV4dE5vZGUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJOb2RlLldyaXRlWG1sKHJUVyk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICByVFcuV3JpdGUoIjwvIiArIHN0clhtbCArICI+Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJUVy5Xcml0ZSgiIC8+Iik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRW50aXR5UmVmZXJlbmNlOg0KICAgICAgICAgICAgICAgIHJUVy5Xcml0ZSgiJiIgKyB0aGlzLl9zdHJOYW1lICsgIjsiKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Ob3RhdGlvbjoNCiAgICAgICAgICAgICAgICByVFcuV3JpdGUoIjwhTk9UQVRJT04gIiArIHRoaXMuX3N0clZhbHVlICsgIj4iKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5DREFUQToNCiAgICAgICAgICAgICAgICByVFcuV3JpdGUoIjwhW0NEQVRBWyIgKyB0aGlzLl9zdHJWYWx1ZSArICJdXT4iKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5YbWxEZWNsYXJhdGlvbjoNCiAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuUHJvY2Vzc2luZ0luc3RydWN0aW9uOg0KICAgICAgICAgICAgICAgIHJUVy5Xcml0ZSgiPD8iICsgdGhpcy5fc3RyTmFtZSArICIgIiArIHRoaXMuX3N0clZhbHVlICsgIj8+Iik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuQ29tbWVudDoNCiAgICAgICAgICAgICAgICByVFcuV3JpdGUoIjwhLS0iICsgdGhpcy5fc3RyVmFsdWUgKyAiLS0+Iik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgdGhyb3cgKG5ldyBFeGNlcHRpb24oIlVuaGFuZGxlZCBOb2RlVHlwZSAiICsgdGhpcy5fblR5cGUuVG9TdHJpbmcoKSkpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8NCiAgICAvLyBQdWJsaWMgTWV0aG9kcyBhbmQgUHJvcGVydGllcw0KICAgIC8vDQogICAgcHVibGljIHN0cmluZyBOb2RlVmFsdWUNCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBfc3RyVmFsdWU7IH0NCiAgICB9DQoNCiAgICBvdmVycmlkZSBwdWJsaWMgc3RyaW5nIFZhbHVlDQogICAgew0KICAgICAgICBnZXQNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHN0clZhbHVlID0gIiI7DQogICAgICAgICAgICBDWG1sTm9kZSByQ2hpbGQ7DQoNCiAgICAgICAgICAgIGlmICgodGhpcy5fZUZsYWdzICYgTm9kZUZsYWdzLkhhc1ZhbHVlKSAhPSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNoYXIgY2hFbnQ7DQogICAgICAgICAgICAgICAgaW50IG5JbmRleEFtcCA9IDA7DQogICAgICAgICAgICAgICAgaW50IG5JbmRleFNlbSA9IDA7DQoNCiAgICAgICAgICAgICAgICBpZiAoKHRoaXMuX2VGbGFncyAmIE5vZGVGbGFncy5VbnBhcnNlZEVudGl0aWVzKSA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RyVmFsdWU7DQoNCiAgICAgICAgICAgICAgICBzdHJWYWx1ZSA9IHRoaXMuX3N0clZhbHVlOw0KDQogICAgICAgICAgICAgICAgd2hpbGUgKChuSW5kZXhBbXAgPSBzdHJWYWx1ZS5JbmRleE9mKCcmJywgbkluZGV4QW1wKSkgIT0gLTEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBuSW5kZXhTZW0gPSBzdHJWYWx1ZS5JbmRleE9mKCc7JywgbkluZGV4QW1wKTsNCiAgICAgICAgICAgICAgICAgICAgY2hFbnQgPSBSZXNvbHZlQ2hhckVudGl0eShzdHJWYWx1ZS5TdWJzdHJpbmcobkluZGV4QW1wICsgMSwgbkluZGV4U2VtIC0gbkluZGV4QW1wIC0gMSkpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hFbnQgIT0gY2hhci5NaW5WYWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyVmFsdWUgPSBzdHJWYWx1ZS5TdWJzdHJpbmcoMCwgbkluZGV4QW1wKSArIGNoRW50ICsgc3RyVmFsdWUuU3Vic3RyaW5nKG5JbmRleFNlbSArIDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgbkluZGV4QW1wKys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgbkluZGV4QW1wID0gbkluZGV4U2VtOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyVmFsdWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZvciAockNoaWxkID0gKENYbWxOb2RlKXRoaXMuX3JGaXJzdENoaWxkTm9kZTsgckNoaWxkICE9IG51bGw7IHJDaGlsZCA9IChDWG1sTm9kZSlyQ2hpbGQuX3JOZXh0Tm9kZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJWYWx1ZSA9IHN0clZhbHVlICsgckNoaWxkLlZhbHVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gc3RyVmFsdWU7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgQ1htbE5vZGUgTmV4dE5vZGUNCiAgICB7DQogICAgICAgIGdldA0KICAgICAgICB7DQogICAgICAgICAgICBDWG1sQmFzZSByTm9kZSA9IHRoaXMuX3JOZXh0Tm9kZTsNCg0KICAgICAgICAgICAgd2hpbGUgKHJOb2RlICE9IG51bGwgJiYNCiAgICAgICAgICAgICAgICAgICAock5vZGUuRmxhZ3MgJiBOb2RlRmxhZ3MuSXNXaGl0ZXNwYWNlKSAhPSAwKQ0KICAgICAgICAgICAgICAgIHJOb2RlID0gck5vZGUuX3JOZXh0Tm9kZTsNCiAgICAgICAgICAgIHJldHVybiAoQ1htbE5vZGUpck5vZGU7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgQ1htbE5vZGUgRmlyc3RDaGlsZA0KICAgIHsNCiAgICAgICAgZ2V0DQogICAgICAgIHsNCiAgICAgICAgICAgIENYbWxCYXNlIHJOb2RlID0gdGhpcy5fckZpcnN0Q2hpbGROb2RlOw0KDQogICAgICAgICAgICB3aGlsZSAock5vZGUgIT0gbnVsbCAmJg0KICAgICAgICAgICAgICAgICAgIChyTm9kZS5GbGFncyAmIE5vZGVGbGFncy5Jc1doaXRlc3BhY2UpICE9IDApDQogICAgICAgICAgICAgICAgck5vZGUgPSByTm9kZS5fck5leHROb2RlOw0KICAgICAgICAgICAgcmV0dXJuIChDWG1sTm9kZSlyTm9kZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBDWG1sTm9kZSBDaGlsZChpbnQgbikNCiAgICB7DQogICAgICAgIGludCBpOw0KICAgICAgICBDWG1sTm9kZSByQ2hpbGQ7DQoNCiAgICAgICAgaSA9IDA7DQogICAgICAgIGZvciAockNoaWxkID0gRmlyc3RDaGlsZDsgckNoaWxkICE9IG51bGw7IHJDaGlsZCA9IHJDaGlsZC5OZXh0Tm9kZSkNCiAgICAgICAgICAgIGlmIChpKysgPT0gbikgYnJlYWs7DQoNCiAgICAgICAgcmV0dXJuIHJDaGlsZDsNCiAgICB9DQoNCiAgICBwdWJsaWMgQ1htbE5vZGUgQ2hpbGQoc3RyaW5nIHN0cikNCiAgICB7DQogICAgICAgIHJldHVybiAoQ1htbE5vZGUpYmFzZS5fQ2hpbGQoc3RyKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IFR5cGUNCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBDb252ZXJ0LlRvSW50MzIoYmFzZS5fblR5cGUpOyB9DQogICAgfQ0KDQogICAgcHVibGljIENYbWxBdHRyaWJ1dGUgRmlyc3RBdHRyaWJ1dGUNCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBfckZpcnN0QXR0cmlidXRlOyB9DQogICAgfQ0KDQogICAgcHVibGljIGludCBBdHRyaWJ1dGVDb3VudA0KICAgIHsNCiAgICAgICAgZ2V0IHsgcmV0dXJuIF9uQXR0cmlidXRlQ291bnQ7IH0NCiAgICB9DQoNCiAgICBwdWJsaWMgQ1htbEF0dHJpYnV0ZSBBdHRyaWJ1dGUoaW50IG4pDQogICAgew0KICAgICAgICBpbnQgaTsNCiAgICAgICAgQ1htbEF0dHJpYnV0ZSByQXR0cmlidXRlOw0KDQogICAgICAgIGkgPSAwOw0KICAgICAgICBmb3IgKHJBdHRyaWJ1dGUgPSBfckZpcnN0QXR0cmlidXRlOyByQXR0cmlidXRlICE9IG51bGw7IHJBdHRyaWJ1dGUgPSByQXR0cmlidXRlLk5leHRBdHRyaWJ1dGUpDQogICAgICAgICAgICBpZiAoaSsrID09IG4pIGJyZWFrOw0KICAgICAgICByZXR1cm4gckF0dHJpYnV0ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQ1htbEF0dHJpYnV0ZSBBdHRyaWJ1dGUoc3RyaW5nIHN0cikNCiAgICB7DQogICAgICAgIENYbWxBdHRyaWJ1dGUgckF0dHJpYnV0ZTsNCg0KICAgICAgICBmb3IgKHJBdHRyaWJ1dGUgPSBfckZpcnN0QXR0cmlidXRlOyByQXR0cmlidXRlICE9IG51bGw7IHJBdHRyaWJ1dGUgPSByQXR0cmlidXRlLk5leHRBdHRyaWJ1dGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChyQXR0cmlidXRlLk5hbWUgPT0gc3RyKSBicmVhazsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByQXR0cmlidXRlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIEFkZEF0dHJpYnV0ZShDWG1sQXR0cmlidXRlIHJBdHRyaWJ1dGUpDQogICAgew0KICAgICAgICBpZiAoX3JGaXJzdEF0dHJpYnV0ZSA9PSBudWxsKQ0KICAgICAgICB7DQogICAgICAgICAgICBfckZpcnN0QXR0cmlidXRlID0gckF0dHJpYnV0ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlDQogICAgICAgIHsNCiAgICAgICAgICAgIF9yTGFzdEF0dHJpYnV0ZS5fck5leHROb2RlID0gckF0dHJpYnV0ZTsNCiAgICAgICAgfQ0KICAgICAgICBfckxhc3RBdHRyaWJ1dGUgPSByQXR0cmlidXRlOw0KICAgICAgICBfbkF0dHJpYnV0ZUNvdW50Kys7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBjaGFyIFJlc29sdmVDaGFyRW50aXR5KHN0cmluZyBzdHJOYW1lKQ0KICAgIHsNCiAgICAgICAgaWYgKHN0ck5hbWVbMF0gPT0gJyMnKQ0KICAgICAgICAgICAgaWYgKHN0ck5hbWVbMV0gPT0gJ3gnKQ0KICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQ2hhcihDb252ZXJ0LlRvSW50MzIoc3RyTmFtZS5TdWJzdHJpbmcoMiksIDE2KSk7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9DaGFyKENvbnZlcnQuVG9JbnQzMihzdHJOYW1lLlN1YnN0cmluZygxKSkpOw0KICAgICAgICBpZiAoc3RyTmFtZSA9PSAibHQiKQ0KICAgICAgICAgICAgcmV0dXJuICc8JzsNCiAgICAgICAgaWYgKHN0ck5hbWUgPT0gImd0IikNCiAgICAgICAgICAgIHJldHVybiAnPic7DQogICAgICAgIGlmIChzdHJOYW1lID09ICJhbXAiKQ0KICAgICAgICAgICAgcmV0dXJuICcmJzsNCiAgICAgICAgaWYgKHN0ck5hbWUgPT0gImFwb3MiKQ0KICAgICAgICAgICAgcmV0dXJuICdcJyc7DQogICAgICAgIGlmIChzdHJOYW1lID09ICJxdW90IikNCiAgICAgICAgICAgIHJldHVybiAnIic7DQoNCiAgICAgICAgcmV0dXJuIGNoYXIuTWluVmFsdWU7DQogICAgfQ0KfQ0KDQpwdWJsaWMgY2xhc3MgQ1htbENhY2hlDQp7DQogICAgLy9DWG1sQ2FjaGUgUHJvcGVydGllcw0KICAgIHByaXZhdGUgYm9vbCBfZlRyYWNlID0gZmFsc2U7DQoNCiAgICBwcml2YXRlIGJvb2wgX2ZUaHJvdyA9IHRydWU7DQogICAgcHJpdmF0ZSBib29sIF9mUmVhZE5vZGUgPSB0cnVlOw0KICAgIHByaXZhdGUgaW50IF9ociA9IDA7DQogICAgcHJpdmF0ZSBFbmNvZGluZyBfZUVuY29kaW5nID0gU3lzdGVtLlRleHQuRW5jb2RpbmcuVVRGODsNCiAgICBwcml2YXRlIHN0cmluZyBfc3RyUGFyc2VFcnJvciA9ICIiOw0KDQogICAgLy9YbWxSZWFkZXIgUHJvcGVydGllcw0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgIHByaXZhdGUgVmFsaWRhdGlvblR5cGUgX2VWYWxpZGF0aW9uTW9kZSA9IFZhbGlkYXRpb25UeXBlLkF1dG87DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQoNCiAgICBwcml2YXRlIFdoaXRlc3BhY2VIYW5kbGluZyBfZVdoaXRlc3BhY2VNb2RlID0gV2hpdGVzcGFjZUhhbmRsaW5nLk5vbmU7DQogICAgcHJpdmF0ZSBFbnRpdHlIYW5kbGluZyBfZUVudGl0eU1vZGUgPSBFbnRpdHlIYW5kbGluZy5FeHBhbmRFbnRpdGllczsNCiAgICBwcml2YXRlIGJvb2wgX2ZOYW1lc3BhY2VzID0gdHJ1ZTsNCg0KICAgIHByaXZhdGUgYm9vbCBfZlZhbGlkYXRpb25DYWxsYmFjayA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9vbCBfZkV4cGFuZEF0dHJpYnV0ZVZhbHVlcyA9IGZhbHNlOw0KDQogICAgLy9JbnRlcm5hbCBzdHVmZg0KICAgIHByb3RlY3RlZCBYbWxSZWFkZXIgX3JYbWxSZWFkZXIgPSBudWxsOw0KDQogICAgcHJvdGVjdGVkIENYbWxOb2RlIF9yRG9jdW1lbnRSb290Tm9kZTsNCiAgICBwcm90ZWN0ZWQgQ1htbE5vZGUgX3JSb290Tm9kZSA9IG51bGw7DQogICAgaW50ZXJuYWwgc3RhdGljIE5vZGVGbGFncyBfZURlZmF1bHRGbGFncyA9IE5vZGVGbGFncy5Ob25lOw0KDQogICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgIHB1YmxpYyBDWG1sQ2FjaGUoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KQ0KICAgIHsNCiAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICB9DQoNCiAgICAvLw0KICAgIC8vIENvbnN0cnVjdG9yDQogICAgLy8NCiAgICBwdWJsaWMgQ1htbENhY2hlKCkNCiAgICB7DQogICAgfQ0KDQogICAgLy8NCiAgICAvLyBQdWJsaWMgTWV0aG9kcyBhbmQgUHJvcGVydGllcw0KICAgIC8vDQogICAgcHVibGljIHZpcnR1YWwgYm9vbCBMb2FkKFhtbFJlYWRlciByWG1sUmVhZGVyKQ0KICAgIHsNCiAgICAgICAgLy9Ib29rIHVwIHlvdXIgcmVhZGVyIGFzIG15IHJlYWRlcg0KICAgICAgICBfclhtbFJlYWRlciA9IHJYbWxSZWFkZXI7DQoNCiAgICAgICAgaWYgKHJYbWxSZWFkZXIgaXMgWG1sVGV4dFJlYWRlcikNCiAgICAgICAgew0KICAgICAgICAgICAgX2VXaGl0ZXNwYWNlTW9kZSA9ICgoWG1sVGV4dFJlYWRlcilyWG1sUmVhZGVyKS5XaGl0ZXNwYWNlSGFuZGxpbmc7DQogICAgICAgICAgICBfZk5hbWVzcGFjZXMgPSAoKFhtbFRleHRSZWFkZXIpclhtbFJlYWRlcikuTmFtZXNwYWNlczsNCiAgICAgICAgICAgIF9lVmFsaWRhdGlvbk1vZGUgPSBWYWxpZGF0aW9uVHlwZS5Ob25lOw0KICAgICAgICB9DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgIGlmIChyWG1sUmVhZGVyIGlzIFhtbFZhbGlkYXRpbmdSZWFkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICgoKFhtbFZhbGlkYXRpbmdSZWFkZXIpclhtbFJlYWRlcikuUmVhZGVyIGlzIFhtbFRleHRSZWFkZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2VXaGl0ZXNwYWNlTW9kZSA9ICgoWG1sVGV4dFJlYWRlcikoKFhtbFZhbGlkYXRpbmdSZWFkZXIpclhtbFJlYWRlcikuUmVhZGVyKS5XaGl0ZXNwYWNlSGFuZGxpbmc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2VXaGl0ZXNwYWNlTW9kZSA9IFdoaXRlc3BhY2VIYW5kbGluZy5Ob25lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX2ZOYW1lc3BhY2VzID0gKChYbWxWYWxpZGF0aW5nUmVhZGVyKXJYbWxSZWFkZXIpLk5hbWVzcGFjZXM7DQogICAgICAgICAgICBfZVZhbGlkYXRpb25Nb2RlID0gKChYbWxWYWxpZGF0aW5nUmVhZGVyKXJYbWxSZWFkZXIpLlZhbGlkYXRpb25UeXBlOw0KICAgICAgICAgICAgX2VFbnRpdHlNb2RlID0gKChYbWxWYWxpZGF0aW5nUmVhZGVyKXJYbWxSZWFkZXIpLkVudGl0eUhhbmRsaW5nOw0KICAgICAgICB9DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQoNCiAgICAgICAgRGVidWdUcmFjZSgiU2V0dGluZyBWYWxpZGF0aW9uTW9kZT0iICsgX2VWYWxpZGF0aW9uTW9kZS5Ub1N0cmluZygpKTsNCiAgICAgICAgRGVidWdUcmFjZSgiU2V0dGluZyBFbnRpdHlNb2RlPSIgKyBfZUVudGl0eU1vZGUuVG9TdHJpbmcoKSk7DQogICAgICAgIERlYnVnVHJhY2UoIlNldHRpbmcgV2hpdGVzcGFjZU1vZGU9IiArIF9lV2hpdGVzcGFjZU1vZGUuVG9TdHJpbmcoKSk7DQoNCiAgICAgICAgLy9Qcm9jZXNzIHRoZSBEb2N1bWVudA0KICAgICAgICB0cnkNCiAgICAgICAgew0KICAgICAgICAgICAgX3JEb2N1bWVudFJvb3ROb2RlID0gbmV3IENYbWxOb2RlKCIiLCAiIiwgWG1sTm9kZVR5cGUuRWxlbWVudCk7DQogICAgICAgICAgICBfckRvY3VtZW50Um9vdE5vZGUuX2VGbGFncyA9IE5vZGVGbGFncy5Eb2N1bWVudFJvb3QgfCBOb2RlRmxhZ3MuSW5kZW50Ow0KICAgICAgICAgICAgUHJvY2VzcyhfckRvY3VtZW50Um9vdE5vZGUpOw0KICAgICAgICAgICAgZm9yIChfclJvb3ROb2RlID0gX3JEb2N1bWVudFJvb3ROb2RlLkZpcnN0Q2hpbGQ7IF9yUm9vdE5vZGUgIT0gbnVsbCAmJiBfclJvb3ROb2RlLk5vZGVUeXBlICE9IFhtbE5vZGVUeXBlLkVsZW1lbnQ7IF9yUm9vdE5vZGUgPSBfclJvb3ROb2RlLk5leHROb2RlKSA7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL1VuaG9vayB5b3VyIHJlYWRlcg0KICAgICAgICAgICAgX3JYbWxSZWFkZXIgPSBudWxsOw0KDQogICAgICAgICAgICBfc3RyUGFyc2VFcnJvciA9IGUuVG9TdHJpbmcoKTsNCg0KICAgICAgICAgICAgaWYgKF9mVGhyb3cpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhyb3cgKGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoX2hyID09IDApDQogICAgICAgICAgICAgICAgX2hyID0gLTE7DQoNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vVW5ob29rIHlvdXIgcmVhZGVyDQogICAgICAgIF9yWG1sUmVhZGVyID0gbnVsbDsNCg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbCBMb2FkKHN0cmluZyBzdHJGaWxlTmFtZSkNCiAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgIFhtbFRleHRSZWFkZXIgclhtbFRleHRSZWFkZXI7DQogICAgICAgIFhtbFZhbGlkYXRpbmdSZWFkZXIgclhtbFZhbGlkYXRpbmdSZWFkZXI7DQogICAgICAgIGJvb2wgZlJldDsNCg0KICAgICAgICByWG1sVGV4dFJlYWRlciA9IG5ldyBYbWxUZXh0UmVhZGVyKHN0ckZpbGVOYW1lKTsNCiAgICAgICAgclhtbFRleHRSZWFkZXIuV2hpdGVzcGFjZUhhbmRsaW5nID0gX2VXaGl0ZXNwYWNlTW9kZTsNCiAgICAgICAgclhtbFRleHRSZWFkZXIuTmFtZXNwYWNlcyA9IF9mTmFtZXNwYWNlczsNCg0KICAgICAgICBfZUVuY29kaW5nID0gclhtbFRleHRSZWFkZXIuRW5jb2Rpbmc7DQoNCiAgICAgICAgclhtbFZhbGlkYXRpbmdSZWFkZXIgPSBuZXcgWG1sVmFsaWRhdGluZ1JlYWRlcihyWG1sVGV4dFJlYWRlcik7DQogICAgICAgIHJYbWxWYWxpZGF0aW5nUmVhZGVyLlZhbGlkYXRpb25UeXBlID0gX2VWYWxpZGF0aW9uTW9kZTsNCiAgICAgICAgclhtbFZhbGlkYXRpbmdSZWFkZXIuRW50aXR5SGFuZGxpbmcgPSBfZUVudGl0eU1vZGU7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQoNCiAgICAgICAgaWYgKF9mVmFsaWRhdGlvbkNhbGxiYWNrKQ0KICAgICAgICAgICAgclhtbFZhbGlkYXRpbmdSZWFkZXIuVmFsaWRhdGlvbkV2ZW50SGFuZGxlciArPSBuZXcgVmFsaWRhdGlvbkV2ZW50SGFuZGxlcih0aGlzLlZhbGlkYXRpb25DYWxsYmFjayk7DQoNCiAgICAgICAgdHJ5DQogICAgICAgIHsNCiAgICAgICAgICAgIGZSZXQgPSBMb2FkKChYbWxSZWFkZXIpclhtbFZhbGlkYXRpbmdSZWFkZXIpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgew0KICAgICAgICAgICAgZlJldCA9IGZhbHNlOw0KICAgICAgICAgICAgclhtbFZhbGlkYXRpbmdSZWFkZXIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgclhtbFRleHRSZWFkZXIuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICBpZiAoX3N0clBhcnNlRXJyb3IgPT0gc3RyaW5nLkVtcHR5KQ0KICAgICAgICAgICAgICAgIF9zdHJQYXJzZUVycm9yID0gZS5Ub1N0cmluZygpOw0KDQogICAgICAgICAgICBpZiAoX2ZUaHJvdykNCiAgICAgICAgICAgICAgICB0aHJvdyAoZSk7DQogICAgICAgIH0NCg0KICAgICAgICByWG1sVmFsaWRhdGluZ1JlYWRlci5EaXNwb3NlKCk7DQogICAgICAgIHJYbWxUZXh0UmVhZGVyLkRpc3Bvc2UoKTsNCiAgICAgICAgcmV0dXJuIGZSZXQ7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgU2F2ZShzdHJpbmcgc3RyTmFtZSkNCiAgICB7DQogICAgICAgIFNhdmUoc3RyTmFtZSwgZmFsc2UsIF9lRW5jb2RpbmcpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIFNhdmUoc3RyaW5nIHN0ck5hbWUsIGJvb2wgZk92ZXJXcml0ZSkNCiAgICB7DQogICAgICAgIFNhdmUoc3RyTmFtZSwgZk92ZXJXcml0ZSwgX2VFbmNvZGluZyk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgU2F2ZShzdHJpbmcgc3RyTmFtZSwgYm9vbCBmT3ZlcldyaXRlLCBTeXN0ZW0uVGV4dC5FbmNvZGluZyBFbmNvZGluZykNCiAgICB7DQogICAgICAgIENYbWxCYXNlIHJOb2RlOw0KICAgICAgICBYbWxUZXh0V3JpdGVyIHJYbWxUZXh0V3JpdGVyID0gbnVsbDsNCg0KICAgICAgICB0cnkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGZPdmVyV3JpdGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgRmlsZS5EZWxldGUoc3RyTmFtZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJYbWxUZXh0V3JpdGVyID0gbmV3IFhtbFRleHRXcml0ZXIoc3RyTmFtZSwgRW5jb2RpbmcpOw0KICAgICAgICAgICAgclhtbFRleHRXcml0ZXIuTmFtZXNwYWNlcyA9IF9mTmFtZXNwYWNlczsNCg0KICAgICAgICAgICAgZm9yIChyTm9kZSA9IF9yRG9jdW1lbnRSb290Tm9kZS5fckZpcnN0Q2hpbGROb2RlOyByTm9kZSAhPSBudWxsOyByTm9kZSA9IHJOb2RlLl9yTmV4dE5vZGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgck5vZGUuV3JpdGUoclhtbFRleHRXcml0ZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgclhtbFRleHRXcml0ZXIuRGlzcG9zZSgpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgew0KICAgICAgICAgICAgRGVidWdUcmFjZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgaWYgKHJYbWxUZXh0V3JpdGVyICE9IG51bGwpDQogICAgICAgICAgICAgICAgclhtbFRleHRXcml0ZXIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgdGhyb3cgKGUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgV3JpdGVYbWwoVGV4dFdyaXRlciByVFcpDQogICAgew0KICAgICAgICBDWG1sQmFzZSByTm9kZTsNCg0KICAgICAgICAvL1NwaXQgb3V0IHRoZSBkb2N1bWVudA0KICAgICAgICBmb3IgKHJOb2RlID0gX3JEb2N1bWVudFJvb3ROb2RlLl9yRmlyc3RDaGlsZE5vZGU7IHJOb2RlICE9IG51bGw7IHJOb2RlID0gck5vZGUuX3JOZXh0Tm9kZSkNCiAgICAgICAgICAgIHJOb2RlLldyaXRlWG1sKHJUVyk7DQogICAgfQ0KDQogICAgcHVibGljIENYbWxOb2RlIFJvb3ROb2RlDQogICAgew0KICAgICAgICBnZXQgeyByZXR1cm4gX3JSb290Tm9kZTsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdHJpbmcgUGFyc2VFcnJvcg0KICAgIHsNCiAgICAgICAgZ2V0IHsgcmV0dXJuIF9zdHJQYXJzZUVycm9yOyB9DQogICAgfQ0KDQogICAgcHVibGljIGludCBQYXJzZUVycm9yQ29kZQ0KICAgIHsNCiAgICAgICAgZ2V0IHsgcmV0dXJuIF9ocjsgfQ0KICAgIH0NCg0KICAgIC8vDQogICAgLy8gWG1sUmVhZGVyIFByb3BlcnRpZXMNCiAgICAvLw0KICAgIHB1YmxpYyBzdHJpbmcgRW50aXR5TW9kZQ0KICAgIHsNCiAgICAgICAgc2V0DQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSAiRXhwYW5kRW50aXRpZXMiKQ0KICAgICAgICAgICAgICAgIF9lRW50aXR5TW9kZSA9IEVudGl0eUhhbmRsaW5nLkV4cGFuZEVudGl0aWVzOw0KICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT0gIkV4cGFuZENoYXJFbnRpdGllcyIpDQogICAgICAgICAgICAgICAgX2VFbnRpdHlNb2RlID0gRW50aXR5SGFuZGxpbmcuRXhwYW5kQ2hhckVudGl0aWVzOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHRocm93IChuZXcgRXhjZXB0aW9uKCJJbnZhbGlkIEVudGl0eSBtb2RlLiIpKTsNCiAgICAgICAgfQ0KICAgICAgICBnZXQgeyByZXR1cm4gX2VFbnRpdHlNb2RlLlRvU3RyaW5nKCk7IH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RyaW5nIFZhbGlkYXRpb25Nb2RlDQogICAgew0KICAgICAgICBzZXQNCiAgICAgICAgew0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgaWYgKHZhbHVlID09ICJOb25lIikNCiAgICAgICAgICAgICAgICBfZVZhbGlkYXRpb25Nb2RlID0gVmFsaWRhdGlvblR5cGUuTm9uZTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID09ICJEVEQiKQ0KICAgICAgICAgICAgICAgIF9lVmFsaWRhdGlvbk1vZGUgPSBWYWxpZGF0aW9uVHlwZS5EVEQ7DQogICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA9PSAiWERSIikNCiAgICAgICAgICAgICAgICBfZVZhbGlkYXRpb25Nb2RlID0gVmFsaWRhdGlvblR5cGUuWERSOw0KICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT0gIlNjaGVtYSIpDQogICAgICAgICAgICAgICAgX2VWYWxpZGF0aW9uTW9kZSA9IFZhbGlkYXRpb25UeXBlLlNjaGVtYTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID09ICJBdXRvIikNCiAgICAgICAgICAgICAgICBfZVZhbGlkYXRpb25Nb2RlID0gVmFsaWRhdGlvblR5cGUuQXV0bzsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB0aHJvdyAobmV3IEV4Y2VwdGlvbigiSW52YWxpZCBWYWxpZGF0aW9uIG1vZGUuIikpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICB9DQogICAgICAgIGdldCB7IHJldHVybiBfZVZhbGlkYXRpb25Nb2RlLlRvU3RyaW5nKCk7IH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RyaW5nIFdoaXRlc3BhY2VNb2RlDQogICAgew0KICAgICAgICBzZXQNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHZhbHVlID09ICJBbGwiKQ0KICAgICAgICAgICAgICAgIF9lV2hpdGVzcGFjZU1vZGUgPSBXaGl0ZXNwYWNlSGFuZGxpbmcuQWxsOw0KICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT0gIlNpZ25pZmljYW50IikNCiAgICAgICAgICAgICAgICBfZVdoaXRlc3BhY2VNb2RlID0gV2hpdGVzcGFjZUhhbmRsaW5nLlNpZ25pZmljYW50Ow0KICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT0gIk5vbmUiKQ0KICAgICAgICAgICAgICAgIF9lV2hpdGVzcGFjZU1vZGUgPSBXaGl0ZXNwYWNlSGFuZGxpbmcuTm9uZTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB0aHJvdyAobmV3IEV4Y2VwdGlvbigiSW52YWxpZCBXaGl0ZXNwYWNlIG1vZGUuIikpOw0KICAgICAgICB9DQogICAgICAgIGdldCB7IHJldHVybiBfZVdoaXRlc3BhY2VNb2RlLlRvU3RyaW5nKCk7IH0NCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbCBOYW1lc3BhY2VzDQogICAgew0KICAgICAgICBzZXQgeyBfZk5hbWVzcGFjZXMgPSB2YWx1ZTsgfQ0KICAgICAgICBnZXQgeyByZXR1cm4gX2ZOYW1lc3BhY2VzOyB9DQogICAgfQ0KDQogICAgcHVibGljIGJvb2wgVXNlVmFsaWRhdGlvbkNhbGxiYWNrDQogICAgew0KICAgICAgICBzZXQgeyBfZlZhbGlkYXRpb25DYWxsYmFjayA9IHZhbHVlOyB9DQogICAgICAgIGdldCB7IHJldHVybiBfZlZhbGlkYXRpb25DYWxsYmFjazsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBib29sIEV4cGFuZEF0dHJpYnV0ZVZhbHVlcw0KICAgIHsNCiAgICAgICAgc2V0IHsgX2ZFeHBhbmRBdHRyaWJ1dGVWYWx1ZXMgPSB2YWx1ZTsgfQ0KICAgICAgICBnZXQgeyByZXR1cm4gX2ZFeHBhbmRBdHRyaWJ1dGVWYWx1ZXM7IH0NCiAgICB9DQoNCiAgICAvLw0KICAgIC8vIEludGVybmFsIFByb3BlcnRpZXMNCiAgICAvLw0KICAgIHB1YmxpYyBib29sIFRocm93DQogICAgew0KICAgICAgICBnZXQgeyByZXR1cm4gX2ZUaHJvdzsgfQ0KICAgICAgICBzZXQgeyBfZlRocm93ID0gdmFsdWU7IH0NCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbCBUcmFjZQ0KICAgIHsNCiAgICAgICAgc2V0IHsgX2ZUcmFjZSA9IHZhbHVlOyB9DQogICAgICAgIGdldCB7IHJldHVybiBfZlRyYWNlOyB9DQogICAgfQ0KDQogICAgLy8NCiAgICAvL1ByaXZhdGUgTWV0aG9kcw0KICAgIC8vDQogICAgcHJpdmF0ZSB2b2lkIERlYnVnVHJhY2Uoc3RyaW5nIHN0cikNCiAgICB7DQogICAgICAgIERlYnVnVHJhY2Uoc3RyLCAwKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHZvaWQgRGVidWdUcmFjZShzdHJpbmcgc3RyLCBpbnQgbkRlcHRoKQ0KICAgIHsNCiAgICAgICAgaWYgKF9mVHJhY2UpDQogICAgICAgIHsNCiAgICAgICAgICAgIGludCBpOw0KDQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbkRlcHRoOyBpKyspDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIiAiKTsNCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKHN0cik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwcml2YXRlIHZvaWQgRGVidWdUcmFjZShYbWxSZWFkZXIgclhtbFJlYWRlcikNCiAgICB7DQogICAgICAgIGlmIChfZlRyYWNlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgc3RyOw0KDQogICAgICAgICAgICBzdHIgPSByWG1sUmVhZGVyLk5vZGVUeXBlLlRvU3RyaW5nKCkgKyAiLCBEZXB0aD0iICsgclhtbFJlYWRlci5EZXB0aCArICIgTmFtZT0iOw0KICAgICAgICAgICAgaWYgKHJYbWxSZWFkZXIuUHJlZml4ICE9ICIiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0ciArPSByWG1sUmVhZGVyLlByZWZpeCArICI6IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHN0ciArPSByWG1sUmVhZGVyLkxvY2FsTmFtZTsNCg0KICAgICAgICAgICAgaWYgKHJYbWxSZWFkZXIuSGFzVmFsdWUpDQogICAgICAgICAgICAgICAgc3RyICs9ICIgVmFsdWU9IiArIHJYbWxSZWFkZXIuVmFsdWU7DQoNCiAgICAgICAgICAgIGlmIChyWG1sUmVhZGVyLk5vZGVUeXBlID09IFhtbE5vZGVUeXBlLkF0dHJpYnV0ZSkNCiAgICAgICAgICAgICAgICBzdHIgKz0gIiBRdW90ZUNoYXI9IiArIHJYbWxSZWFkZXIuUXVvdGVDaGFyOw0KDQogICAgICAgICAgICBEZWJ1Z1RyYWNlKHN0ciwgclhtbFJlYWRlci5EZXB0aCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgdm9pZCBQcm9jZXNzKENYbWxCYXNlIHJQYXJlbnROb2RlKQ0KICAgIHsNCiAgICAgICAgQ1htbE5vZGUgck5ld05vZGU7DQoNCiAgICAgICAgd2hpbGUgKHRydWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vV2Ugd2FudCB0byBwb3AgaWYgUmVhZCgpIHJldHVybnMgZmFsc2UsIGFrYSBFT0YNCiAgICAgICAgICAgIGlmIChfZlJlYWROb2RlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICghX3JYbWxSZWFkZXIuUmVhZCgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgRGVidWdUcmFjZSgiUmVhZCgpID09IGZhbHNlIik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFfclhtbFJlYWRlci5SZWFkQXR0cmlidXRlVmFsdWUoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIERlYnVnVHJhY2UoIlJlYWRBdHRyaWJ1dGVWYWx1ZSgpID09IGZhbHNlIik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIERlYnVnVHJhY2UoX3JYbWxSZWFkZXIpOw0KDQogICAgICAgICAgICAvL1dlIGFsc28gd2FudCB0byBwb3AgaWYgd2UgZ2V0IGFuIEVuZEVsZW1lbnQgb3IgRW5kRW50aXR5DQogICAgICAgICAgICBpZiAoX3JYbWxSZWFkZXIuTm9kZVR5cGUgPT0gWG1sTm9kZVR5cGUuRW5kRWxlbWVudCB8fA0KICAgICAgICAgICAgICAgICBfclhtbFJlYWRlci5Ob2RlVHlwZSA9PSBYbWxOb2RlVHlwZS5FbmRFbnRpdHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgRGVidWdUcmFjZSgiTm9kZVR5cGUgPT0gRW5kRWxlbWVudCBvciBFbmRFbnRpdHkiKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJOZXdOb2RlID0gR2V0TmV3Tm9kZShfclhtbFJlYWRlcik7DQogICAgICAgICAgICByTmV3Tm9kZS5fbkRlcHRoID0gX3JYbWxSZWFkZXIuRGVwdGg7DQoNCiAgICAgICAgICAgIC8vIFRlc3QgZm9yIE1peGVkQ29udGVudCBhbmQgc2V0IEluZGVudCBpZiBuZWNlc3NhcnkNCiAgICAgICAgICAgIGlmICgoclBhcmVudE5vZGUuRmxhZ3MgJiBOb2RlRmxhZ3MuTWl4ZWRDb250ZW50KSAhPSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJOZXdOb2RlLl9lRmxhZ3MgfD0gTm9kZUZsYWdzLk1peGVkQ29udGVudDsNCiAgICAgICAgICAgICAgICAvLyBJbmRlbnQgaXMgb2ZmIGZvciBhbGwgbmV3IG5vZGVzDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgck5ld05vZGUuX2VGbGFncyB8PSBOb2RlRmxhZ3MuSW5kZW50OwkJLy8gVHVybiBvbiBJbmRlbnQgZm9yIGN1cnJlbnQgTm9kZQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBTZXQgYWxsIERlcHRoIDAgbm9kZXMgdG8gTm8gTWl4ZWQgQ29udGVudCBhbmQgSW5kZW50IFRydWUNCiAgICAgICAgICAgIGlmIChfclhtbFJlYWRlci5EZXB0aCA9PSAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJOZXdOb2RlLl9lRmxhZ3MgfD0gTm9kZUZsYWdzLkluZGVudDsJCQkvLyBUdXJuIG9uIEluZGVudA0KICAgICAgICAgICAgICAgIHJOZXdOb2RlLl9lRmxhZ3MgJj0gfk5vZGVGbGFncy5NaXhlZENvbnRlbnQ7CS8vIFR1cm4gb2ZmIE1peGVkQ29udGVudA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByUGFyZW50Tm9kZS5JbnNlcnROb2RlKHJOZXdOb2RlKTsNCg0KICAgICAgICAgICAgLy9EbyBzb21lIHNwZWNpYWwgc3R1ZmYgYmFzZWQgb24gTm9kZVR5cGUNCiAgICAgICAgICAgIHN3aXRjaCAoX3JYbWxSZWFkZXIuTm9kZVR5cGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5FbnRpdHlSZWZlcmVuY2U6DQogICAgICAgICAgICAgICAgICAgIGlmIChfZVZhbGlkYXRpb25Nb2RlID09IFZhbGlkYXRpb25UeXBlLkRURCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgX3JYbWxSZWFkZXIuUmVzb2x2ZUVudGl0eSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgUHJvY2VzcyhyTmV3Tm9kZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkVsZW1lbnQ6DQogICAgICAgICAgICAgICAgICAgIGlmIChfclhtbFJlYWRlci5Nb3ZlVG9GaXJzdEF0dHJpYnV0ZSgpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENYbWxBdHRyaWJ1dGUgck5ld0F0dHJpYnV0ZSA9IG5ldyBDWG1sQXR0cmlidXRlKF9yWG1sUmVhZGVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByTmV3Tm9kZS5BZGRBdHRyaWJ1dGUock5ld0F0dHJpYnV0ZSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2ZFeHBhbmRBdHRyaWJ1dGVWYWx1ZXMpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Z1RyYWNlKCJBdHRyaWJ1dGU6ICIgKyBfclhtbFJlYWRlci5OYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2ZSZWFkTm9kZSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNzKHJOZXdBdHRyaWJ1dGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZlJlYWROb2RlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1htbE5vZGUgclZhbHVlTm9kZSA9IG5ldyBDWG1sTm9kZSgiIiwgIiIsIFhtbE5vZGVUeXBlLlRleHQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByVmFsdWVOb2RlLl9lRmxhZ3MgPSBfZURlZmF1bHRGbGFncyB8IE5vZGVGbGFncy5IYXNWYWx1ZTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByVmFsdWVOb2RlLl9zdHJWYWx1ZSA9IF9yWG1sUmVhZGVyLlZhbHVlOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnVHJhY2UoIiAgVmFsdWU9IiArIHJWYWx1ZU5vZGUuVmFsdWUsIF9yWG1sUmVhZGVyLkRlcHRoICsgMSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgck5ld0F0dHJpYnV0ZS5JbnNlcnROb2RlKHJWYWx1ZU5vZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKF9yWG1sUmVhZGVyLk1vdmVUb05leHRBdHRyaWJ1dGUoKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBpZiAoKHJOZXdOb2RlLkZsYWdzICYgTm9kZUZsYWdzLkVtcHR5RWxlbWVudCkgPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIFByb2Nlc3Mock5ld05vZGUpOw0KDQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5YbWxEZWNsYXJhdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9yWG1sUmVhZGVyIGlzIFhtbFRleHRSZWFkZXIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9lRW5jb2RpbmcgPSAoKFhtbFRleHRSZWFkZXIpX3JYbWxSZWFkZXIpLkVuY29kaW5nOw0KICAgICAgICAgICAgICAgICAgICB9DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9yWG1sUmVhZGVyIGlzIFhtbFZhbGlkYXRpbmdSZWFkZXIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9lRW5jb2RpbmcgPSAoKFhtbFZhbGlkYXRpbmdSZWFkZXIpX3JYbWxSZWFkZXIpLkVuY29kaW5nOw0KICAgICAgICAgICAgICAgICAgICB9DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHN0clZhbHVlID0gck5ld05vZGUuTm9kZVZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW50IG5Qb3MgPSBzdHJWYWx1ZS5JbmRleE9mKCJlbmNvZGluZyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5Qb3MgIT0gLTEpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IG5FbmQ7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuUG9zID0gc3RyVmFsdWUuSW5kZXhPZigiPSIsIG5Qb3MpOwkJCS8vRmluZCB0aGUgPSBzaWduDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbkVuZCA9IHN0clZhbHVlLkluZGV4T2YoIlwiIiwgblBvcykgKyAxOwkvL0ZpbmQgdGhlIG5leHQgIiBjaGFyYWN0ZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuUG9zID0gc3RyVmFsdWUuSW5kZXhPZigiJyIsIG5Qb3MpICsgMTsJCS8vRmluZCB0aGUgbmV4dCAnIGNoYXJhY3Rlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuRW5kID09IDAgfHwgKG5Qb3MgPCBuRW5kICYmIG5Qb3MgPiAwKSkJLy9QaWNrIHRoZSBvbmUgdGhhdCdzIGNsb3NlciB0byB0aGUgPSBzaWduDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuRW5kID0gc3RyVmFsdWUuSW5kZXhPZigiJyIsIG5Qb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuUG9zID0gbkVuZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbkVuZCA9IHN0clZhbHVlLkluZGV4T2YoIlwiIiwgblBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBzRW5jb2RlTmFtZSA9IHN0clZhbHVlLlN1YnN0cmluZyhuUG9zLCBuRW5kIC0gblBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVidWdUcmFjZSgiWE1MRGVjbCBjb250YWlucyBlbmNvZGluZyAiICsgc0VuY29kZU5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzRW5jb2RlTmFtZS5Ub1VwcGVyKCkgPT0gIlVDUy0yIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNFbmNvZGVOYW1lID0gInVuaWNvZGUiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZUVuY29kaW5nID0gU3lzdGVtLlRleHQuRW5jb2RpbmcuR2V0RW5jb2Rpbmcoc0VuY29kZU5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5Qcm9jZXNzaW5nSW5zdHJ1Y3Rpb246DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBYbWxOb2RlVHlwZS5UZXh0Og0KICAgICAgICAgICAgICAgICAgICBpZiAoIV9mUmVhZE5vZGUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJOZXdOb2RlLl9lRmxhZ3MgPSBfZURlZmF1bHRGbGFncyB8IE5vZGVGbGFncy5BdHRyaWJ1dGVUZXh0Tm9kZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByTmV3Tm9kZS5fZUZsYWdzIHw9IE5vZGVGbGFncy5NaXhlZENvbnRlbnQ7CQkvLyB0dXJuIG9uIE1peGVkIENvbnRlbnQgZm9yIGN1cnJlbnQgbm9kZQ0KICAgICAgICAgICAgICAgICAgICByTmV3Tm9kZS5fZUZsYWdzICY9IH5Ob2RlRmxhZ3MuSW5kZW50OwkJCS8vIHR1cm4gb2ZmIEluZGVudCBmb3IgY3VycmVudCBub2RlDQogICAgICAgICAgICAgICAgICAgIHJQYXJlbnROb2RlLl9lRmxhZ3MgfD0gTm9kZUZsYWdzLk1peGVkQ29udGVudDsJLy8gdHVybiBvbiBNaXhlZCBDb250ZW50IGZvciBQYXJlbnQgTm9kZQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuV2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLlNpZ25pZmljYW50V2hpdGVzcGFjZToNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLkNEQVRBOg0KICAgICAgICAgICAgICAgICAgICByTmV3Tm9kZS5fZUZsYWdzIHw9IE5vZGVGbGFncy5NaXhlZENvbnRlbnQ7CQkvLyB0dXJuIG9uIE1peGVkIENvbnRlbnQgZm9yIGN1cnJlbnQgbm9kZQ0KICAgICAgICAgICAgICAgICAgICByTmV3Tm9kZS5fZUZsYWdzICY9IH5Ob2RlRmxhZ3MuSW5kZW50OwkJCS8vIHR1cm4gb2ZmIEluZGVudCBmb3IgY3VycmVudCBub2RlDQogICAgICAgICAgICAgICAgICAgIHJQYXJlbnROb2RlLl9lRmxhZ3MgfD0gTm9kZUZsYWdzLk1peGVkQ29udGVudDsJLy8gdHVybiBvbiBNaXhlZCBDb250ZW50IGZvciBQYXJlbnQgTm9kZQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuQ29tbWVudDoNCiAgICAgICAgICAgICAgICBjYXNlIFhtbE5vZGVUeXBlLk5vdGF0aW9uOg0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgWG1sTm9kZVR5cGUuRG9jdW1lbnRUeXBlOg0KICAgICAgICAgICAgICAgICAgICBpZiAoX3JYbWxSZWFkZXIuTW92ZVRvRmlyc3RBdHRyaWJ1dGUoKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDWG1sQXR0cmlidXRlIHJOZXdBdHRyaWJ1dGUgPSBuZXcgQ1htbEF0dHJpYnV0ZShfclhtbFJlYWRlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgck5ld05vZGUuQWRkQXR0cmlidXRlKHJOZXdBdHRyaWJ1dGUpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1htbE5vZGUgclZhbHVlTm9kZSA9IG5ldyBDWG1sTm9kZShfclhtbFJlYWRlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgclZhbHVlTm9kZS5fc3RyVmFsdWUgPSBfclhtbFJlYWRlci5WYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByTmV3QXR0cmlidXRlLkluc2VydE5vZGUoclZhbHVlTm9kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChfclhtbFJlYWRlci5Nb3ZlVG9OZXh0QXR0cmlidXRlKCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiVU5IQU5ETEVEIFRZUEUsICIgKyBfclhtbFJlYWRlci5Ob2RlVHlwZS5Ub1N0cmluZygpICsgIiBJTiBQcm9jZXNzKCkhIik7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIHZpcnR1YWwgQ1htbE5vZGUgR2V0TmV3Tm9kZShYbWxSZWFkZXIgclhtbFJlYWRlcikNCiAgICB7DQogICAgICAgIHJldHVybiBuZXcgQ1htbE5vZGUoclhtbFJlYWRlcik7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIFZhbGlkYXRpb25DYWxsYmFjayhvYmplY3Qgc2VuZGVyLCBWYWxpZGF0aW9uRXZlbnRBcmdzIGFyZ3MpDQogICAgew0KICAgICAgICAvLyAgY29tbWVudGVkIGJ5IFJPQ0hPQSAtLSBkb24ndCBrbm93IHdoZXJlIFZhbGlkYXRpb25FdmVudEFyZ3MgY29tZXMgZnJvbQ0KICAgICAgICAvLwlfaHIgPSBDb252ZXJ0LlRvSW50MTYoYXJncy5FcnJvckNvZGUpOw0KICAgICAgICB0aHJvdyAobmV3IEV4Y2VwdGlvbigiWyIgKyBDb252ZXJ0LlRvU3RyaW5nKF9ocikgKyAiXSAiICsgYXJncy5NZXNzYWdlKSk7DQogICAgfQ0KfQ0KDQpwdWJsaWMgY2xhc3MgQ2hlY2tzdW1Xcml0ZXIgOiBUZXh0V3JpdGVyDQp7DQogICAgcHJpdmF0ZSBpbnQgX25Qb3NpdGlvbiA9IDA7DQogICAgcHJpdmF0ZSBEZWNpbWFsIF9kUmVzdWx0ID0gMDsNCiAgICBwcml2YXRlIEVuY29kaW5nIF9lbmNvZGluZzsNCg0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgLy8gICAgQ29uc3RydWN0b3INCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgIHB1YmxpYyBDaGVja3N1bVdyaXRlcigpDQogICAgew0KICAgICAgICBfZW5jb2RpbmcgPSBFbmNvZGluZy5VVEY4Ow0KICAgIH0NCg0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgLy8gICAgUHJvcGVydGllcw0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgcHVibGljIERlY2ltYWwgQ2hlY2tTdW0NCiAgICB7DQogICAgICAgIGdldCB7IHJldHVybiBfZFJlc3VsdDsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBvdmVycmlkZSBFbmNvZGluZyBFbmNvZGluZw0KICAgIHsNCiAgICAgICAgZ2V0IHsgcmV0dXJuIF9lbmNvZGluZzsgfQ0KICAgIH0NCg0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgLy8gICAgUHVibGljIG1ldGhvZHMNCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgIG92ZXJyaWRlIHB1YmxpYyB2b2lkIFdyaXRlKFN0cmluZyBzdHIpDQogICAgew0KICAgICAgICBpbnQgaTsNCiAgICAgICAgaW50IG07DQoNCiAgICAgICAgbSA9IHN0ci5MZW5ndGg7DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBtOyBpKyspDQogICAgICAgIHsNCiAgICAgICAgICAgIFdyaXRlKHN0cltpXSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBvdmVycmlkZSBwdWJsaWMgdm9pZCBXcml0ZShDaGFyW10gcmdjaCkNCiAgICB7DQogICAgICAgIGludCBpOw0KICAgICAgICBpbnQgbTsNCg0KICAgICAgICBtID0gcmdjaC5MZW5ndGg7DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBtOyBpKyspDQogICAgICAgIHsNCiAgICAgICAgICAgIFdyaXRlKHJnY2hbaV0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgb3ZlcnJpZGUgcHVibGljIHZvaWQgV3JpdGUoQ2hhcltdIHJnY2gsIEludDMyIGlPZmZzZXQsIEludDMyIGlDb3VudCkNCiAgICB7DQogICAgICAgIGludCBpOw0KICAgICAgICBpbnQgbTsNCg0KICAgICAgICBtID0gaU9mZnNldCArIGlDb3VudDsNCiAgICAgICAgZm9yIChpID0gaU9mZnNldDsgaSA8IG07IGkrKykNCiAgICAgICAgew0KICAgICAgICAgICAgV3JpdGUocmdjaFtpXSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBvdmVycmlkZSBwdWJsaWMgdm9pZCBXcml0ZShDaGFyIGNoKQ0KICAgIHsNCiAgICAgICAgX2RSZXN1bHQgKz0gTWF0aC5Sb3VuZCgoRGVjaW1hbCkoY2ggLyAoX25Qb3NpdGlvbiArIDEuMCkpLCAxMCk7DQogICAgICAgIF9uUG9zaXRpb24rKzsNCiAgICB9DQoNCiAgICBvdmVycmlkZSBwdWJsaWMgdm9pZCBDbG9zZSgpDQogICAgew0KICAgICAgICBfblBvc2l0aW9uID0gMDsNCiAgICAgICAgX2RSZXN1bHQgPSAwOw0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXslTransform.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlhtbC5YUGF0aDsNCnVzaW5nIFN5c3RlbS5YbWwuWHNsOw0KDQpuYW1lc3BhY2UgU3lzdGVtLlhtbC5UZXN0cw0Kew0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiTnVsbCBhcmd1bWVudCB0ZXN0cyIsIERlc2MgPSAiVGhpcyB0ZXN0Y2FzZSBwYXNzZXMgTlVMTCBhcmd1bWVudHMgdG8gYWxsIFhzbFRyYW5zZm9ybSBtZXRob2RzIildDQogICAgcHVibGljIGNsYXNzIENOdWxsQXJndW1lbnRUZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ051bGxBcmd1bWVudFRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkKElYUGF0aE5hdmlnYWJsZSA9IG51bGwpIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFZhcjEoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgICAgICBuZXcgWHNsVHJhbnNmb3JtKCkuTG9hZCgoSVhQYXRoTmF2aWdhYmxlKW51bGwpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZChYbWxSZWFkZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIyKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgbmV3IFhzbFRyYW5zZm9ybSgpLkxvYWQoKFhtbFJlYWRlciludWxsKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQoSVhQYXRoTmF2aWdhYmxlID0gbnVsbCwgWG1sUmVzb2x2ZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgbmV3IFhzbFRyYW5zZm9ybSgpLkxvYWQoKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWG1sUmVzb2x2ZXIpbnVsbCk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXJndW1lbnROdWxsRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJEaWQgbm90IHRocm93IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkKFhtbFJlYWRlciA9IG51bGwsIFhtbFJlc29sdmVyID0gbnVsbCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyNCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgICAgIG5ldyBYc2xUcmFuc2Zvcm0oKS5Mb2FkKChYbWxSZWFkZXIpbnVsbCwgKFhtbFJlc29sdmVyKW51bGwpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZChJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYbWxSZXNvbHZlciA9IG51bGwsIEV2aWRlbmNlID0gbnVsbCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyNSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8qdHJ5DQogICAgICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgbmV3IFhzbFRyYW5zZm9ybSgpLkxvYWQoKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWG1sUmVzb2x2ZXIpbnVsbCwgKEV2aWRlbmNlKW51bGwpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEFyZ3VtZW50TnVsbEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBBcmd1bWVudE51bGxFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsqLw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkKFhtbFJlYWRlciA9IG51bGwsIFhtbFJlc29sdmVyID0gbnVsbCwgRXZpZGVuY2UgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXI2KCkNCiAgICAgICAgew0KICAgICAgICAgICAgLyp0cnkNCiAgICAgICAgICAgIHsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgICAgICBuZXcgWHNsVHJhbnNmb3JtKCkuTG9hZCgoWG1sUmVhZGVyKW51bGwsIChYbWxSZXNvbHZlciludWxsLCAoRXZpZGVuY2UpbnVsbCk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXJndW1lbnROdWxsRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJEaWQgbm90IHRocm93IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOyovDQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyNygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgICAgIG5ldyBYc2xUcmFuc2Zvcm0oKS5UcmFuc2Zvcm0oKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWHNsdEFyZ3VtZW50TGlzdCludWxsKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCwgWG1sUmVzb2x2ZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXI4KCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgbmV3IFhzbFRyYW5zZm9ybSgpLlRyYW5zZm9ybSgoSVhQYXRoTmF2aWdhYmxlKW51bGwsIChYc2x0QXJndW1lbnRMaXN0KW51bGwsIChYbWxSZXNvbHZlciludWxsKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCwgVGV4dFdyaXRlciA9IG51bGwpIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFZhcjkoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgICAgICBuZXcgWHNsVHJhbnNmb3JtKCkuVHJhbnNmb3JtKChJWFBhdGhOYXZpZ2FibGUpbnVsbCwgKFhzbHRBcmd1bWVudExpc3QpbnVsbCwgKFRleHRXcml0ZXIpbnVsbCk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXJndW1lbnROdWxsRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZShlLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJEaWQgbm90IHRocm93IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJUcmFuc2Zvcm0oSVhQYXRoTmF2aWdhYmxlID0gbnVsbCwgWHNsdEFyZ3VtZW50TGlzdCA9IG51bGwsIFRleHRXcml0ZXIgPSBudWxsLCBYbWxSZXNvbHZlciA9IG51bGwpIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFZhcjEwKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgbmV3IFhzbFRyYW5zZm9ybSgpLlRyYW5zZm9ybSgoSVhQYXRoTmF2aWdhYmxlKW51bGwsIChYc2x0QXJndW1lbnRMaXN0KW51bGwsIChUZXh0V3JpdGVyKW51bGwsIChYbWxSZXNvbHZlciludWxsKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCwgU3RyZWFtID0gbnVsbCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyMTEoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgICAgICBuZXcgWHNsVHJhbnNmb3JtKCkuVHJhbnNmb3JtKChJWFBhdGhOYXZpZ2FibGUpbnVsbCwgKFhzbHRBcmd1bWVudExpc3QpbnVsbCwgKFN0cmVhbSludWxsKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCwgU3RyZWFtID0gbnVsbCwgWG1sUmVzb2x2ZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIxMigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgICAgIG5ldyBYc2xUcmFuc2Zvcm0oKS5UcmFuc2Zvcm0oKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWHNsdEFyZ3VtZW50TGlzdCludWxsLCAoU3RyZWFtKW51bGwsIChYbWxSZXNvbHZlciludWxsKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCwgWG1sV3JpdGVyID0gbnVsbCkiLCBQcmkgPSAxKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVmFyMTMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgICAgICBuZXcgWHNsVHJhbnNmb3JtKCkuVHJhbnNmb3JtKChJWFBhdGhOYXZpZ2FibGUpbnVsbCwgKFhzbHRBcmd1bWVudExpc3QpbnVsbCwgKFhtbFdyaXRlciludWxsKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlRyYW5zZm9ybShJWFBhdGhOYXZpZ2FibGUgPSBudWxsLCBYc2x0QXJndW1lbnRMaXN0ID0gbnVsbCwgWG1sV3JpdGVyID0gbnVsbCwgWG1sUmVzb2x2ZXIgPSBudWxsKSIsIFByaSA9IDEpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBWYXIxNCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgICAgIG5ldyBYc2xUcmFuc2Zvcm0oKS5UcmFuc2Zvcm0oKElYUGF0aE5hdmlnYWJsZSludWxsLCAoWHNsdEFyZ3VtZW50TGlzdCludWxsLCAoWG1sV3JpdGVyKW51bGwsIChYbWxSZXNvbHZlciludWxsKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChBcmd1bWVudE51bGxFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgQXJndW1lbnROdWxsRXhjZXB0aW9uIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQogICAgLyogICAgICAgICAgWHNsVHJhbnNmb3JtLlJlc29sdmVyIC0gSW50ZWdyaXR5ICAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5YbWxSZXNvbHZlciA6IFJlYWRlciwgUmVhZGVyIiwgRGVzYyA9ICJSRUFERVIsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlhtbFJlc29sdmVyIDogUmVhZGVyLCBTdHJlYW0iLCBEZXNjID0gIlJFQURFUixTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uWG1sUmVzb2x2ZXIgOiBSZWFkZXIsIFdyaXRlciIsIERlc2MgPSAiUkVBREVSLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5YbWxSZXNvbHZlciA6IFJlYWRlciwgVGV4dFdyaXRlciIsIERlc2MgPSAiUkVBREVSLFRFWFRXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uWG1sUmVzb2x2ZXIgOiBVUkksIFJlYWRlciIsIERlc2MgPSAiVVJJLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5YbWxSZXNvbHZlciA6IFVSSSwgU3RyZWFtIiwgRGVzYyA9ICJVUkksU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlhtbFJlc29sdmVyIDogVVJJLCBXcml0ZXIiLCBEZXNjID0gIlVSSSxXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uWG1sUmVzb2x2ZXIgOiBVUkksIFRleHRXcml0ZXIiLCBEZXNjID0gIlVSSSxURVhUV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlhtbFJlc29sdmVyIDogTmF2aWdhdG9yLCBSZWFkZXIiLCBEZXNjID0gIk5BVklHQVRPUixSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uWG1sUmVzb2x2ZXIgOiBOYXZpZ2F0b3IsIFN0cmVhbSIsIERlc2MgPSAiTkFWSUdBVE9SLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5YbWxSZXNvbHZlciA6IE5hdmlnYXRvciwgV3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlhtbFJlc29sdmVyIDogTmF2aWdhdG9yLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsVEVYVFdSSVRFUiIpXQ0KICAgIHB1YmxpYyBjbGFzcyBDWG1sUmVzb2x2ZXJUZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ1htbFJlc29sdmVyVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlNldCBYbWxSZXNvbHZlciBwcm9wZXJ0eSB0byBudWxsLCBsb2FkIHN0eWxlIHNoZWV0IHdpdGggaW1wb3J0L2luY2x1ZGUsIHNob3VsZCBub3QgYWZmZWN0IHRyYW5zZm9ybSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBYbWxSZXNvbHZlcjEoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKG5ldyBBbGxvd0RlZmF1bHRSZXNvbHZlckNvbnRleHQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+PGZydWl0PkFwcGxlPC9mcnVpdD48ZnJ1aXQ+b3JhbmdlPC9mcnVpdD48L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoTG9hZFhTTCgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHhzbHQuWG1sUmVzb2x2ZXIgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRyYW5zZm9ybSgiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpID09IDEpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJTaG91bGQgbm90IHRocm93IGVycm9yIGxvYWRpbmcgc3R5bGVzaGVldCB3aXRoIGluY2x1ZGUvaW1wb3J0IHdoZW4gcmVzb2x2ZXIgcHJvcGVydHkgaXMgc2V0IHRvIE5VTEwhIik7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJTZXQgWG1sUmVzb2x2ZXIgcHJvcGVydHkgdG8gbnVsbCwgbG9hZCBzdHlsZSBzaGVldCB3aXRoIGRvY3VtZW50IGZ1bmN0aW9uLCBzaG91bGQgbm90IHJlc29sdmUgZHVyaW5nIHRyYW5zZm9ybSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBYbWxSZXNvbHZlcjIoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0PjwvcmVzdWx0PiI7DQoNCiAgICAgICAgICAgIC8vICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiIGNvbnRhaW5zDQogICAgICAgICAgICAvLyA8eHNsOmZvci1lYWNoIHNlbGVjdD0iZG9jdW1lbnQoJ3htbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhtbCcpLy9lbGVtIj4NCg0KICAgICAgICAgICAgaWYgKExvYWRYU0woInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LlhtbFJlc29sdmVyID0gbnVsbDsNCiAgICAgICAgICAgICAgICBpZiAoVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSkgPT0gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlByb2JsZW0gbG9hZGluZyBzdHlsZXNoZWV0IHdpdGggZG9jdW1lbnQgZnVuY3Rpb24gYW5kIHJlc29sdmVyIHNldCB0byBOVUxMISIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiRGVmYXVsdCBYbWxSZXNvbHZlciwgbG9hZCBzdHlsZSBzaGVldCB3aXRoIGRvY3VtZW50IGZ1bmN0aW9uLCBzaG91bGQgcmVzb2x2ZSBkdXJpbmcgdHJhbnNmb3JtIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRDX1hzbHRfRG9jdW1lbnRfRnVuY3Rpb25fVXNlX1htbFVybFJlc29sdmVyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiIGNvbnRhaW5zDQogICAgICAgICAgICAvLyA8eHNsOmZvci1lYWNoIHNlbGVjdD0iZG9jdW1lbnQoJ3htbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhtbCcpLy9lbGVtIj4NCiAgICAgICAgICAgIC8vIHdpdGggWG1sVXJsUmVzb2x2ZXIgaXQgc2hvdWxkIGJlIGFibGUgdG8gb3BlbiByZWZlcmVuY2VkIGZpbGUNCiAgICAgICAgICAgIExvYWRYU0woInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB4c2x0LlhtbFJlc29sdmVyID0gbmV3IFhtbFVybFJlc29sdmVyKCk7DQogICAgICAgICAgICBUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKTsNCiAgICAgICAgICAgIFZlcmlmeVJlc3VsdChAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+MTIzPC9yZXN1bHQ+Iik7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oImRvY3VtZW50KCkgaGFzIGFic29sdXRlIFVSSSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCwgIkFic29sdXRlIHBhdGggYWNjZXNzIGlzIGRlbmllZCBpbiB1YXAiKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVENfQWJzb2x1dGVQYXRoX1RyYW5zZm9ybShJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBUZXN0VXNpbmdUZW1wb3JhcnlDb3B5T2ZSZXNvbHZlckRvY3VtZW50KCgpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTCgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb25fYWJzb2x1dGVfdXJpLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICAgICAgeHNsdC5YbWxSZXNvbHZlciA9IG5ldyBYbWxVcmxSZXNvbHZlcigpOw0KICAgICAgICAgICAgICAgIFRyYW5zZm9ybSgiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpOw0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+MTIzPC9yZXN1bHQ+Iik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAvKiAgICAgICAgICBYc2xUcmFuc2Zvcm0uTG9hZCAtIEludGVncml0eSAgICAgICAgICAgICAgICAgICovDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoKSAtIEludGVncml0eSA6IFJlYWRlciwgUmVhZGVyIiwgRGVzYyA9ICJSRUFERVIsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoKSAtIEludGVncml0eSA6IFJlYWRlciwgU3RyZWFtIiwgRGVzYyA9ICJSRUFERVIsU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoKSAtIEludGVncml0eSA6IFJlYWRlciwgV3JpdGVyIiwgRGVzYyA9ICJSRUFERVIsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoKSAtIEludGVncml0eSA6IFJlYWRlciwgVGV4dFdyaXRlciIsIERlc2MgPSAiUkVBREVSLFRFWFRXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZCgpIC0gSW50ZWdyaXR5IDogVVJJLCBSZWFkZXIiLCBEZXNjID0gIlVSSSxSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZCgpIC0gSW50ZWdyaXR5IDogVVJJLCBTdHJlYW0iLCBEZXNjID0gIlVSSSxTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZCgpIC0gSW50ZWdyaXR5IDogVVJJLCBXcml0ZXIiLCBEZXNjID0gIlVSSSxXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZCgpIC0gSW50ZWdyaXR5IDogVVJJLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJVUkksVEVYVFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBOYXZpZ2F0b3IsIFJlYWRlciIsIERlc2MgPSAiTkFWSUdBVE9SLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBOYXZpZ2F0b3IsIFN0cmVhbSIsIERlc2MgPSAiTkFWSUdBVE9SLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBOYXZpZ2F0b3IsIFdyaXRlciIsIERlc2MgPSAiTkFWSUdBVE9SLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKCkgLSBJbnRlZ3JpdHkgOiBOYXZpZ2F0b3IsIFRleHRXcml0ZXIiLCBEZXNjID0gIk5BVklHQVRPUixURVhUV1JJVEVSIildDQogICAgcHVibGljIGNsYXNzIENMb2FkVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENMb2FkVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNhbGwgTG9hZCB3aXRoIG51bGwgdmFsdWUiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWMxKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTChudWxsLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5Bcmd1bWVudEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBTeXN0ZW0uWG1sLlhtbFVybFJlc29sdmVyLlJlc29sdmVVcmkoVXJpIGJhc2VVcmksIFN0cmluZyByZWxhdGl2ZVVyaSkgdGhyb3dzIFN5c3RlbS5Bcmd1bWVudEV4Y2VwdGlvbiBoZXJlIGZvciBudWxsDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBudWxsIHBhcmFtZXRlciBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgd2l0aCB2YWxpZCwgdGhlbiBpbnZhbGlkLCB0aGVuIHZhbGlkIGFnYWluIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljMihJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIExvYWRYU0woIklEb250RXhpc3QueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5JTy5GaWxlTm90Rm91bmRFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5JbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uIGUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIENoZWNrRXhwZWN0ZWRFcnJvcihlLCAiU3lzdGVtLlhtbCIsICJYc2x0X05vU3R5bGVzaGVldExvYWRlZCIsIG5ldyBzdHJpbmdbXSB7ICIiIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gbG9hZCBzdHlsZSBzaGVldCEiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgYW4gaW52YWxpZCwgdGhlbiBhIHZhbGlkIGFuZCB0cmFuc2Zvcm0iKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWMzKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD4NCgkJMS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMi5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMy5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNC5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNi5ObyBWYWx1ZSBTcGVjaWZpZWQ8L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJJRG9udEV4aXN0LnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLklPLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoKExvYWRYU0woInNob3dQYXJhbS54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpICYmIChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIG5vbi1leGlzdGVudCBmaWxlIG5hbWUiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCBzZXZlcmFsIG92ZXJsb2FkZWQgZnVuY3Rpb25zIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljNChJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+DQoJCTEuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTIuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTMuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTQuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTUuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTYuTm8gVmFsdWUgU3BlY2lmaWVkPC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgaWYgKGlucHV0VHlwZSAhPSBJbnB1dFR5cGUuUmVhZGVyKQ0KICAgICAgICAgICAgICAgIExvYWRYU0woInNob3dQYXJhbUxvbmdOYW1lLnhzbCIsIElucHV0VHlwZS5SZWFkZXIsIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgaWYgKGlucHV0VHlwZSAhPSBJbnB1dFR5cGUuVVJJKQ0KICAgICAgICAgICAgICAgIExvYWRYU0woInNob3dQYXJhbUxvbmdOYW1lLnhzbCIsIElucHV0VHlwZS5VUkksIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgaWYgKGlucHV0VHlwZSAhPSBJbnB1dFR5cGUuTmF2aWdhdG9yKQ0KICAgICAgICAgICAgICAgIExvYWRYU0woInNob3dQYXJhbUxvbmdOYW1lLnhzbCIsIElucHV0VHlwZS5OYXZpZ2F0b3IsIHJlYWRlclR5cGUpOw0KDQogICAgICAgICAgICBpZiAoKExvYWRYU0woInNob3dQYXJhbS54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDApIHx8IChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAwKSkNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQoNCiAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQoNCiAgICAgICAgICAgIGlmIChpbnB1dFR5cGUgIT0gSW5wdXRUeXBlLk5hdmlnYXRvcikNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJzaG93UGFyYW1Mb25nTmFtZS54c2wiLCBJbnB1dFR5cGUuTmF2aWdhdG9yLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIGlmIChpbnB1dFR5cGUgIT0gSW5wdXRUeXBlLlVSSSkNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJzaG93UGFyYW1Mb25nTmFtZS54c2wiLCBJbnB1dFR5cGUuVVJJLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIGlmIChpbnB1dFR5cGUgIT0gSW5wdXRUeXBlLlJlYWRlcikNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJzaG93UGFyYW1Mb25nTmFtZS54c2wiLCBJbnB1dFR5cGUuUmVhZGVyLCByZWFkZXJUeXBlKTsNCg0KICAgICAgICAgICAgaWYgKChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSkgPT0gMSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCBzYW1lIG92ZXJsb2FkZWQgTG9hZCgpIG1hbnkgdGltZXMgdGhlbiB0cmFuc2Zvcm0iKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWM1KElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD4NCgkJMS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMi5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMy5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNC5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNi5ObyBWYWx1ZSBTcGVjaWZpZWQ8L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSAhPSAxKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkZhaWxlZCB0byBsb2FkIHN0eWxlc2hlZXQgc2hvd1BhcmFtLnhzbCBvbiB0aGUgezB9IGF0dGVtcHQiLCBpKTsNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkgJiYgKFRyYW5zZm9ybSgiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIGxvYWQgd2l0aCBub24tZXhpc3Rpbmcgc3R5bGVzaGVldCIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzYoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJJRG9udEV4aXN0LnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLklPLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIG5vbi1leGlzdGVudCBmaWxlIHBhcmFtZXRlciBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlZlcmlmeSB0aGF0IHN0eWxlIHNoZWV0IGlzIGNsb3NlZCBwcm9wZXJseSBhZnRlciBMb2FkIC0gU2hhcmVkIFJlYWQgQWNjZXNzIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljNyhJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAobmV3IEFsbG93RGVmYXVsdFJlc29sdmVyQ29udGV4dCgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD48ZnJ1aXQ+QXBwbGU8L2ZydWl0PjxmcnVpdD5vcmFuZ2U8L2ZydWl0PjwvcmVzdWx0PiI7DQoNCiAgICAgICAgICAgICAgICBGaWxlU3RyZWFtIHMyOw0KDQogICAgICAgICAgICAgICAgLy8gY2hlY2sgaW1tZWRpYXRlbHkgYWZ0ZXIgbG9hZCBhbmQgYWZ0ZXIgdHJhbnNmb3JtDQogICAgICAgICAgICAgICAgaWYgKExvYWRYU0woIlhtbFJlc29sdmVyX01haW4ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgczIgPSBuZXcgRmlsZVN0cmVhbShGdWxsRmlsZVBhdGgoIlhtbFJlc29sdmVyX01haW4ueHNsIiksIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCwgRmlsZVNoYXJlLlJlYWQpOw0KICAgICAgICAgICAgICAgICAgICBzMi5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgczIgPSBuZXcgRmlsZVN0cmVhbShGdWxsRmlsZVBhdGgoIlhtbFJlc29sdmVyX01haW4ueHNsIiksIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCwgRmlsZVNoYXJlLlJlYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgczIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiVmVyaWZ5IHRoYXQgaW5jbHVkZWQgZmlsZXMgYXJlIGNsb3NlZCBwcm9wZXJseSBhZnRlciBMb2FkIC0gUmVhZCBBY2Nlc3MiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWM5KElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChuZXcgQWxsb3dEZWZhdWx0UmVzb2x2ZXJDb250ZXh0KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0PjxmcnVpdD5BcHBsZTwvZnJ1aXQ+PGZydWl0Pm9yYW5nZTwvZnJ1aXQ+PC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgICAgIEZpbGVTdHJlYW0gczI7DQoNCiAgICAgICAgICAgICAgICAvLyBjaGVjayBpbW1lZGlhdGVseSBhZnRlciBsb2FkIGFuZCBhZnRlciB0cmFuc2Zvcm0NCiAgICAgICAgICAgICAgICBpZiAoTG9hZFhTTCgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzMiA9IG5ldyBGaWxlU3RyZWFtKEZ1bGxGaWxlUGF0aCgiWG1sUmVzb2x2ZXJfU3ViLnhzbCIpLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQpOw0KICAgICAgICAgICAgICAgICAgICBzMi5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgczIgPSBuZXcgRmlsZVN0cmVhbShGdWxsRmlsZVBhdGgoIlhtbFJlc29sdmVyX0luY2x1ZGUueHNsIiksIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCwgRmlsZVNoYXJlLlJlYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgczIuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJBcHBlYXJlZCB0byBub3QgY2xvc2UgZmlsZSBwcm9wZXJseSBhZnRlciBsb2FkaW5nLiIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZCBzdHlsZXNoZWV0IHdpdGggZW50aXR5IHJlZmVyZW5jZTogQnVnICM2ODQ1MCAiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWMxMShJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxCb29rPg0KCQkJTmFtZQ0KCQk8L0Jvb2s+IjsNCg0KICAgICAgICAgICAgaWYgKGRvY1R5cGUuVG9TdHJpbmcoKSA9PSAiRGF0YURvY3VtZW50IikNCiAgICAgICAgICAgICAgICAvLyBTa2lwIHRoZSB0ZXN0IGZvciBEYXRhRG9jdW1lbnQNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKExvYWRYU0woImJvb2tzX2VudGl0eV9yZWYueHNsIiwgSW5wdXRUeXBlLlJlYWRlciwgcmVhZGVyVHlwZSkgIT0gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gbG9hZCBzdHlsZXNoZWV0IGJvb2tzX2VudGl0eV9yZWYueHNsIik7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKChMb2FkWFNMKCJib29rc19lbnRpdHlfcmVmLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkgJiYgKFRyYW5zZm9ybSgiYm9va3NfZW50aXR5X3JlZi54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIHdpdGggaW52YWxpZCBzdHlsZXNoZWV0IGFuZCB2ZXJpZnkgdGhhdCBmaWxlIGlzIGNsb3NlZCBwcm9wZXJseSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzEyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyZWFtIHN0cm1UZW1wOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbnQgaSA9IExvYWRYU0woInhzbHRfZXJyb3IueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uWG1sLlhzbC5Yc2x0Q29tcGlsZUV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gb3BlbiB0aGUgeHNsIGZpbGUNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0cm1UZW1wID0gbmV3IEZpbGVTdHJlYW0oRnVsbEZpbGVQYXRoKCJ4c2x0X2Vycm9yLnhzbCIpLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgY2xvc2Ugc3R5bGVzaGVldCBwcm9wZXJseSBhZnRlciBsb2FkIik7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGV4Lk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJEaWQgbm90IHRocm93IGNvbXBpbGUgZXhjZXB0aW9uIGZvciBzdHlsZXNoZWV0Iik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQogICAgLyogICAgICAgICAgWHNsVHJhbnNmb3JtLkxvYWQoLFhtbFJlc29sdmVyKSAtIEludGVncml0eSAgICovDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoLFhtbFJlc29sdmVyKSAtIEludGVncml0eSA6IFJlYWRlciwgUmVhZGVyIiwgRGVzYyA9ICJSRUFERVIsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoLFhtbFJlc29sdmVyKSAtIEludGVncml0eSA6IFJlYWRlciwgU3RyZWFtIiwgRGVzYyA9ICJSRUFERVIsU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoLFhtbFJlc29sdmVyKSAtIEludGVncml0eSA6IFJlYWRlciwgV3JpdGVyIiwgRGVzYyA9ICJSRUFERVIsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoLFhtbFJlc29sdmVyKSAtIEludGVncml0eSA6IFJlYWRlciwgVGV4dFdyaXRlciIsIERlc2MgPSAiUkVBREVSLFRFWFRXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZCgsWG1sUmVzb2x2ZXIpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBSZWFkZXIiLCBEZXNjID0gIk5BVklHQVRPUixSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZCgsWG1sUmVzb2x2ZXIpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBTdHJlYW0iLCBEZXNjID0gIk5BVklHQVRPUixTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZCgsWG1sUmVzb2x2ZXIpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBXcml0ZXIiLCBEZXNjID0gIk5BVklHQVRPUixXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZCgsWG1sUmVzb2x2ZXIpIC0gSW50ZWdyaXR5IDogTmF2aWdhdG9yLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsVEVYVFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKCxYbWxSZXNvbHZlcikgLSBJbnRlZ3JpdHkgOiBVUkksIFJlYWRlciIsIERlc2MgPSAiVVJJLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKCxYbWxSZXNvbHZlcikgLSBJbnRlZ3JpdHkgOiBVUkksIFN0cmVhbSIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKCxYbWxSZXNvbHZlcikgLSBJbnRlZ3JpdHkgOiBVUkksIFdyaXRlciIsIERlc2MgPSAiVVJJLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKCxYbWxSZXNvbHZlcikgLSBJbnRlZ3JpdHkgOiBVUkksIFRleHRXcml0ZXIiLCBEZXNjID0gIlVSSSxURVhUV1JJVEVSIildDQogICAgcHVibGljIGNsYXNzIENMb2FkWG1sUmVzb2x2ZXJUZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ0xvYWRYbWxSZXNvbHZlclRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBudWxsIHNvdXJjZSB2YWx1ZSBhbmQgbnVsbCByZXNvbHZlciIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzEoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMX1Jlc29sdmVyKG51bGwsIG51bGwsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkFyZ3VtZW50RXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFN5c3RlbS5YbWwuWG1sVXJsUmVzb2x2ZXIuUmVzb2x2ZVVyaShVcmkgYmFzZVVyaSwgU3RyaW5nIHJlbGF0aXZlVXJpKSB0aHJvd3MgQXJndW1lbnRFeGNlcHRpb24NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRGlkIG5vdCB0aHJvdyBhbiBleGNlcHRpb24gZm9yIG51bGwgYXJndW1lbnQhIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNhbGwgTG9hZCB3aXRoIG51bGwgc291cmNlIHZhbHVlIGFuZCB2YWxpZCByZXNvbHZlciIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkR2VuZXJpYzIoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMX1Jlc29sdmVyKG51bGwsIG5ldyBYbWxVcmxSZXNvbHZlcigpLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5Bcmd1bWVudEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBTeXN0ZW0uWG1sLlhtbFVybFJlc29sdmVyLlJlc29sdmVVcmkoVXJpIGJhc2VVcmksIFN0cmluZyByZWxhdGl2ZVVyaSkgdGhyb3dzIEFyZ3VtZW50RXhjZXB0aW9uDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkRpZCBub3QgdGhyb3cgYW4gZXhjZXB0aW9uIGZvciBudWxsIGFyZ3VtZW50ISIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBudWxsIFhtbFJlc29sdmVyLCBzdHlsZSBzaGVldCBkb2VzIG5vdCBoYXZlIGluY2x1ZGUvaW1wb3J0LCBzaG91bGQgbm90IGVycm9yIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljMyhJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+DQoJCTEuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTIuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTMuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTQuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTUuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTYuTm8gVmFsdWUgU3BlY2lmaWVkPC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgaWYgKExvYWRYU0xfUmVzb2x2ZXIoInNob3dQYXJhbS54c2wiLCBudWxsLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKFRyYW5zZm9ybSgiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpID09IDEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gbG9hZCBzdHlsZSBzaGVldCEiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNhbGwgTG9hZCB3aXRoIG51bGwgWG1sUmVzb2x2ZXIgYW5kIHN0eWxlIHNoZWV0IGhhcyBpbXBvcnQvaW5jbHVkZSwgc2hvdWxkIGZhaWwiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWM0KElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTF9SZXNvbHZlcigiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCBudWxsLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5YbWwuWHNsLlhzbHRDb21waWxlRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ2hlY2tFeHBlY3RlZEVycm9yKGUuSW5uZXJFeGNlcHRpb24sICJTeXN0ZW0uWG1sIiwgIlhtbF9OdWxsUmVzb2x2ZXIiLCBuZXcgc3RyaW5nW10geyAiIiB9KTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCB0aHJvd24gZm9yIG51bGwgcmVzb2x2ZXIiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCBMb2FkIHdpdGggbnVsbCBjdXN0b20gcmVzb2x2ZXIgYW5kIHN0eWxlIHNoZWV0IGhhcyBubyBpbXBvcnQvaW5jbHVkZSwgc2hvdWxkIG5vdCBlcnJvciIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUQ19SZXNvbHZlcl9OdWxsX1Nob3VsZF9Ob3RfQnJlYWtfVHJhbnNmb3JtKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD4NCgkJMS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMi5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMy5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNC5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNi5ObyBWYWx1ZSBTcGVjaWZpZWQ8L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICBMb2FkWFNMX1Jlc29sdmVyKCJzaG93UGFyYW0ueHNsIiwgbnVsbCwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIFRyYW5zZm9ybSgiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpOw0KICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiU3R5bGUgc2hlZXQgaGFzIGltcG9ydC9pbmNsdWRlLCBjYWxsIExvYWQgZmlyc3Qgd2l0aCBjdXN0b20gbnVsbCByZXNvbHZlciBhbmQgdGhlbiBkZWZhdWx0IHJlc29sdmVyLCBzaG91bGQgbm90IGZhaWwiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVENfQ3VzdG9tTnVsbFJlc292ZXJfVGhlbl9YbWxVcmxSZXNvbHZlcihJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBDdXN0b21OdWxsUmVzb2x2ZXIgbXlSZXNvbHZlciA9IG5ldyBDdXN0b21OdWxsUmVzb2x2ZXIoX291dHB1dCk7DQogICAgICAgICAgICBpZiAoaW5wdXRUeXBlID09IElucHV0VHlwZS5VUkkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIGUgPSBBc3NlcnQuVGhyb3dzPFhtbEV4Y2VwdGlvbj4oKCkgPT4gTG9hZFhTTF9SZXNvbHZlcigiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCBteVJlc29sdmVyLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpKTsNCiAgICAgICAgICAgICAgICB2YXIgYWJzb2x1dGVVcmkgPSBuZXcgVXJpKFBhdGguQ29tYmluZShFbnZpcm9ubWVudC5DdXJyZW50RGlyZWN0b3J5LCBGdWxsRmlsZVBhdGgoIlhtbFJlc29sdmVyX01haW4ueHNsIikpKS5BYnNvbHV0ZVVyaTsNCiAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZSwgIlN5c3RlbS5YbWwiLCAiWG1sX0Nhbm5vdFJlc29sdmVVcmwiLCBuZXdbXSB7IGFic29sdXRlVXJpIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBlID0gQXNzZXJ0LlRocm93czxYc2x0Q29tcGlsZUV4Y2VwdGlvbj4oKCkgPT4gTG9hZFhTTF9SZXNvbHZlcigiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCBteVJlc29sdmVyLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpKTsNCiAgICAgICAgICAgICAgICB2YXIgeHNsdEV4Y2VwdGlvbiA9IEFzc2VydC5Jc1R5cGU8WHNsdEV4Y2VwdGlvbj4oZS5Jbm5lckV4Y2VwdGlvbik7DQogICAgICAgICAgICAgICAgdmFyIGFic29sdXRlVXJpID0gbmV3IFVyaShQYXRoLkNvbWJpbmUoRW52aXJvbm1lbnQuQ3VycmVudERpcmVjdG9yeSwgRnVsbEZpbGVQYXRoKCJYbWxSZXNvbHZlcl9JbmNsdWRlLnhzbCIpKSkuQWJzb2x1dGVVcmk7DQogICAgICAgICAgICAgICAgdmFyIGV4Y2VwdGlvblNvdXJjZUFzc2VtYmx5ID0gUGxhdGZvcm1EZXRlY3Rpb24uSXNGdWxsRnJhbWV3b3JrID8gIlN5c3RlbS5EYXRhLlNxbFhtbCIgOiAiU3lzdGVtLlhtbCI7DQogICAgICAgICAgICAgICAgQ2hlY2tFeHBlY3RlZEVycm9yKHhzbHRFeGNlcHRpb24sIGV4Y2VwdGlvblNvdXJjZUFzc2VtYmx5LCAiWHNsdF9DYW50UmVzb2x2ZSIsIG5ld1tdIHsgYWJzb2x1dGVVcmkgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIExvYWRYU0xfUmVzb2x2ZXIoIlhtbFJlc29sdmVyX01haW4ueHNsIiwgbmV3IFhtbFVybFJlc29sdmVyKCksIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICBUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKTsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD48ZnJ1aXQ+QXBwbGU8L2ZydWl0PjxmcnVpdD5vcmFuZ2U8L2ZydWl0PjwvcmVzdWx0PiI7DQogICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJTdHlsZSBzaGVldCBoYXMgaW1wb3J0L2luY2x1ZGUsIGNhbGwgTG9hZCBmaXJzdCB3aXRoIGRlZmF1bHQgcmVzb2x2ZXIgYW5kIHRoZW4gd2l0aCBjdXN0b20gbnVsbCByZXNvbHZlciwgc2hvdWxkIGZhaWwiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1NraXBPblRhcmdldEZyYW1ld29yayhUYXJnZXRGcmFtZXdvcmtNb25pa2Vycy5OZXRGcmFtZXdvcmssICJPbmx5IGZ1bGwgZnJhbWV3b3JrIGltcGxpY2l0IHJlc29sdmVyIHdvcmtzIildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRDX05vX0V4cGxpY2l0X1Jlc29sdmVyX1Byb2hpYml0c19FeHRlcm5hbF9VcmwoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgQXBwQ29udGV4dC5UcnlHZXRTd2l0Y2goIlN3aXRjaC5TeXN0ZW0uWG1sLkFsbG93RGVmYXVsdFJlc29sdmVyIiwgb3V0IGJvb2wgaXNFbmFibGVkKTsNCiAgICAgICAgICAgIEFzc2VydC5GYWxzZShpc0VuYWJsZWQpOw0KICAgICAgICAgICAgdmFyIGUgPSBBc3NlcnQuVGhyb3dzPFhzbHRDb21waWxlRXhjZXB0aW9uPigoKSA9PiBMb2FkWFNMKCJYbWxSZXNvbHZlcl9NYWluLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkpOw0KICAgICAgICAgICAgdmFyIHhtbEV4Y2VwdGlvbiA9IEFzc2VydC5Jc1R5cGU8WG1sRXhjZXB0aW9uPihlLklubmVyRXhjZXB0aW9uKTsNCiAgICAgICAgICAgIENoZWNrRXhwZWN0ZWRFcnJvcih4bWxFeGNlcHRpb24sICJTeXN0ZW0uWG1sIiwgIlhtbF9OdWxsUmVzb2x2ZXIiLCBBcnJheS5FbXB0eTxzdHJpbmc+KCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIHdpdGggcmVzb2x2ZXIgd2l0aCBjcmVkZW50aWFscywgdGhlbiBsb2FkIFhTTCB0aGF0IGRvZXMgbm90IG5lZWQgY3JlZC4iKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWM5KElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChuZXcgQWxsb3dEZWZhdWx0UmVzb2x2ZXJDb250ZXh0KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0PjxmcnVpdD5BcHBsZTwvZnJ1aXQ+PGZydWl0Pm9yYW5nZTwvZnJ1aXQ+PC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgICAgIGlmICgoTG9hZFhTTF9SZXNvbHZlcigiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCBHZXREZWZhdWx0Q3JlZFJlc29sdmVyKCksIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoKExvYWRYU0woIlhtbFJlc29sdmVyX01haW4ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSkgPT0gMSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkZhaWxlZCB0byBsb2FkISIpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCBMb2FkKCkgbWFueSB0aW1lcyB3aXRoIG51bGwgcmVzb2x2ZXIgdGhlbiBwZXJmb3JtIGEgdHJhbnNmb3JtIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRHZW5lcmljMTAoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0Pg0KCQkxLk5vIFZhbHVlIFNwZWNpZmllZA0KCQkyLk5vIFZhbHVlIFNwZWNpZmllZA0KCQkzLk5vIFZhbHVlIFNwZWNpZmllZA0KCQk0Lk5vIFZhbHVlIFNwZWNpZmllZA0KCQk1Lk5vIFZhbHVlIFNwZWNpZmllZA0KCQk2Lk5vIFZhbHVlIFNwZWNpZmllZDwvcmVzdWx0PiI7DQoNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKExvYWRYU0xfUmVzb2x2ZXIoInNob3dQYXJhbS54c2wiLCBudWxsLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpICE9IDEpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRmFpbGVkIHRvIGxvYWQgc3R5bGVzaGVldCBzaG93UGFyYW0ueHNsIG9uIHRoZSB7MH0gYXR0ZW1wdCIsIGkpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKChMb2FkWFNMX1Jlc29sdmVyKCJzaG93UGFyYW0ueHNsIiwgbnVsbCwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSkgPT0gMSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNhbGwgTG9hZCB3aXRoIG51bGwgUmVzb2x2ZXIsIGZpbGUgZG9lcyBub3QgZXhpc3QiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWMxMShJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0xfUmVzb2x2ZXIoIklEb250RXhpc3QueHNsIiwgbnVsbCwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uSU8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3Igbm9uLWV4aXN0ZW50IGZpbGUgcGFyYW1ldGVyIG5hbWUiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZCBub24gZXhpc3Rpbmcgc3R5bGVzaGVldCB3aXRoIG51bGwgcmVzb2x2ZXIgYW5kIHRyeSB0byB0cmFuc2Zvcm0iKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZEdlbmVyaWMxMihJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTG9hZFhTTF9SZXNvbHZlcigic2hvd1BhcmFtLnhzbCIsIG51bGwsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIExvYWRYU0xfUmVzb2x2ZXIoIklEb250RXhpc3QueHNsIiwgbnVsbCwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5JTy5GaWxlTm90Rm91bmRFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvL25vIHN0eWxlc2hlZXQgbG9hZGVkLCBzaG91bGQgdGhyb3cgZXJyb3INCiAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zZm9ybSgiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbiBlMikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tFeHBlY3RlZEVycm9yKGUyLCAic3lzdGVtLnhtbCIsICJYc2x0X05vU3R5bGVzaGVldExvYWRlZCIsIG5ldyBzdHJpbmdbXSB7ICJJRG9udEV4aXN0LnhzbCIgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBub24tZXhpc3RlbnQgZmlsZSBwYXJhbWV0ZXIgbmFtZSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFcnJvcnMgbG9hZGluZyBpbml0aWFsIGZpbGUiKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQogICAgLyogICAgICAgICAgWHNsVHJhbnNmb3JtLkxvYWQoVXJsLCBSZXNvbHZlcikgICAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKFVybCwgUmVzb2x2ZXIpIDogVVJJLCBSZWFkZXIiLCBEZXNjID0gIlVSSSxSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZChVcmwsIFJlc29sdmVyKSA6IFVSSSwgU3RyZWFtIiwgRGVzYyA9ICJVUkksU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoVXJsLCBSZXNvbHZlcikgOiBVUkksIFdyaXRlciIsIERlc2MgPSAiVVJJLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5Mb2FkKFVybCwgUmVzb2x2ZXIpIDogVVJJLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJVUkksVEVYVFdSSVRFUiIpXQ0KICAgIHB1YmxpYyBjbGFzcyBDTG9hZFVybFJlc29sdmVyVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENMb2FkVXJsUmVzb2x2ZXJUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQmFzaWMgY2hlY2sgZm9yIHVzYWdlIG9mIGNyZWRlbnRpYWxzIG9uIHJlc29sdmVyLCBsb2FkIFhTTCB0aGF0IG5lZWRzIGNyZWQuIHdpdGggY29ycmVjdCByZXNvbHZlciIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZFVybFJlc29sdmVyMShJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxvdXQ+UmVkNTBPcmFuZ2UyNTwvb3V0PiI7DQoNCiAgICAgICAgICAgIC8vIFhzbHRSZXNvbHZlclRlc3RNYWluLnhzbCBpcyBwbGFjZWQgaW4gSUlTIHZpcnR1YWwgZGlyZWN0b3J5DQogICAgICAgICAgICAvLyB3aGljaCByZXF1aXJlcyBpbnRlZ3JhdGVkIFdpbmRvd3MgTlQgYXV0aGVudGljYXRpb24NCiAgICAgICAgICAgIGlmICgoTG9hZFhTTF9SZXNvbHZlcigoIlhtbFJlc29sdmVyL1hzbHRSZXNvbHZlclRlc3RNYWluLnhzbCIpLCBHZXREZWZhdWx0Q3JlZFJlc29sdmVyKCksIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkgJiYNCiAgICAgICAgICAgICAgICAoVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSkgPT0gMSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZCBYU0wgdGhhdCBuZWVkcyBjcmVkLiB3aXRoIG51bGwgcmVzb2x2ZXIsIHNob3VsZCBmYWlsIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRVcmxSZXNvbHZlcjIoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMX1Jlc29sdmVyKCgiWG1sUmVzb2x2ZXIvWHNsdFJlc29sdmVyVGVzdE1haW4ueHNsIiksIG51bGwsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLlhtbC5Yc2wuWHNsdEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvL3JldHVybiBDaGVja0V4cGVjdGVkRXJyb3IoZSwgInN5c3RlbS54bWwiLCAiWG1sX051bGxSZXNvbHZlciIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJTaG91bGQgbm90IGhhdmUgYmVlbiBhYmxlIHRvIHJldHJpZXZlIGFuZCByZXNvbHZlIHN0eWxlIHNoZWV0IHdpdGggbnVsbCByZXNvbHZlciIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBudWxsIHNvdXJjZSB2YWx1ZSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkVXJsUmVzb2x2ZXIzKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTF9SZXNvbHZlcihudWxsLCBuZXcgWG1sVXJsUmVzb2x2ZXIoKSwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gU3lzdGVtLlhtbC5YbWxVcmxSZXNvbHZlci5SZXNvbHZlVXJpKFVyaSBiYXNlVXJpLCBTdHJpbmcgcmVsYXRpdmVVcmkpIHRocm93cyBBcmd1bWVudEV4Y2VwdGlvbg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJEaWQgbm90IHRocm93IGFuIGV4Y2VwdGlvbiBmb3IgbnVsbCBhcmd1bWVudCEiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAvKiAgICAgICAgICBYc2xUcmFuc2Zvcm0uTG9hZChVcmwpICAgICAgICAgICAgICAgICAgICAgICAgICovDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLkxvYWQoVXJsKSBJbnRlZ3JpdHkgOiBVUkksIFN0cmVhbSIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIHB1YmxpYyBjbGFzcyBDTG9hZFN0cmluZ1Rlc3QgOiBYc2x0QXBpVGVzdENhc2VCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDTG9hZFN0cmluZ1Rlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDYWxsIExvYWQgd2l0aCBhbiBpbnZhbGlkIHVyaSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkVXJsMShSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woIklEb250RXhpc3QueHNsIiwgSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLklPLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIG5vbi1leGlzdGVudCBmaWxlIHBhcmFtZXRlciBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgZmlsZSB3aXRoIGVtcHR5IHN0cmluZyIpXQ0KICAgICAgICBbSW5saW5lRGF0YShSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkVXJsMihSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woc3pFbXB0eSwgSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkFyZ3VtZW50RXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFN5c3RlbS5YbWwuWG1sVXJsUmVzb2x2ZXIuUmVzb2x2ZVVyaShVcmkgYmFzZVVyaSwgU3RyaW5nIHJlbGF0aXZlVXJpKSB0aHJvd3MgQXJndW1lbnRFeGNlcHRpb24NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIGFuIGVtcHR5IHN0cmluZyBmaWxlbmFtZSIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIHdpdGggXCIuXCIiKV0NCiAgICAgICAgW0lubGluZURhdGEoUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZFVybDMoUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCIuIiwgSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLlVuYXV0aG9yaXplZEFjY2Vzc0V4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIG5vbi1leGlzdGVudCBmaWxlIHBhcmFtZXRlciBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgd2l0aCBcIi4uXCIiKV0NCiAgICAgICAgW0lubGluZURhdGEoUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZFVybChSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woIi4uIiwgSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLlVuYXV0aG9yaXplZEFjY2Vzc0V4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIG5vbi1leGlzdGVudCBmaWxlIHBhcmFtZXRlciBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgd2l0aCBcIlxcXFxcIiIpXQ0KICAgICAgICBbUGxhdGZvcm1TcGVjaWZpYyhUZXN0UGxhdGZvcm1zLldpbmRvd3MpXSAvL05vdCBhIHZhbGlkIHBhdGggb24gVW5peA0KICAgICAgICBbSW5saW5lRGF0YShSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkVXJsNShSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExvYWRYU0woIiAgICAgIiwgSW5wdXRUeXBlLlVSSSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkFyZ3VtZW50RXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFN5c3RlbS5YbWwuWG1sVXJsUmVzb2x2ZXIuUmVzb2x2ZVVyaShVcmkgYmFzZVVyaSwgU3RyaW5nIHJlbGF0aXZlVXJpKSB0aHJvd3MgQXJndW1lbnRFeGNlcHRpb24NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIG5vbi1leGlzdGVudCBmaWxlIHBhcmFtZXRlciBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQogICAgLyogICAgICAgICAgWHNsVHJhbnNmb3JtLkxvYWQoSVhQYXRoTmF2aWdhYmxlKSAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybSAuTG9hZChJWFBhdGhOYXZpZ2FibGUpIDogTmF2aWdhdG9yLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsVEVYVFdSSVRFUiIpXQ0KICAgIHB1YmxpYyBjbGFzcyBDTG9hZFhQYXRoTmF2aWdhYmxlVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENMb2FkWFBhdGhOYXZpZ2FibGVUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQmFzaWMgVmVyaWZpY2F0aW9uIFRlc3QiKV0NCiAgICAgICAgW0lubGluZURhdGEoVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWROYXZpZ2F0b3IxKFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+DQoJCTEuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTIuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTMuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTQuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTUuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTYuTm8gVmFsdWUgU3BlY2lmaWVkPC9yZXN1bHQ+IjsNCg0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xUcmFuc2Zvcm0oKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIFN0cmluZyBfc3RyWHNsRmlsZSA9ICJzaG93UGFyYW0ueHNsIjsNCg0KICAgICAgICAgICAgX3N0clhzbEZpbGUgPSBGdWxsRmlsZVBhdGgoX3N0clhzbEZpbGUpOw0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkNvbXBpbGluZyB7MH0iLCBfc3RyWHNsRmlsZSk7DQoNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIFhtbFZhbGlkYXRpbmdSZWFkZXIgeHJMb2FkID0gbmV3IFhtbFZhbGlkYXRpbmdSZWFkZXIobmV3IFhtbFRleHRSZWFkZXIoX3N0clhzbEZpbGUpKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIFhQYXRoRG9jdW1lbnQgeGRUZW1wID0gbmV3IFhQYXRoRG9jdW1lbnQoeHJMb2FkLCBYbWxTcGFjZS5QcmVzZXJ2ZSk7DQogICAgICAgICAgICB4ckxvYWQuRGlzcG9zZSgpOw0KICAgICAgICAgICAgeHNsdC5Mb2FkKHhkVGVtcCk7DQoNCiAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDcmVhdGUgTmF2aWdhdG9yIGFuZCBuYXZpZ2F0ZSBhd2F5IGZyb20gcm9vdCIpXQ0KICAgICAgICBbSW5saW5lRGF0YShUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZE5hdmlnYXRvcjIoVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD4NCgkJMS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMi5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMy5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNC5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNi5ObyBWYWx1ZSBTcGVjaWZpZWQ8L3Jlc3VsdD4iOw0KDQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbFRyYW5zZm9ybSgpOw0KICAgICAgICAgICAgWG1sVmFsaWRhdGluZ1JlYWRlciB4ckxvYWQgPSBuZXcgWG1sVmFsaWRhdGluZ1JlYWRlcihuZXcgWG1sVGV4dFJlYWRlcihGdWxsRmlsZVBhdGgoInNob3dQYXJhbS54c2wiKSkpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgWFBhdGhEb2N1bWVudCB4ZFRlbXAgPSBuZXcgWFBhdGhEb2N1bWVudCh4ckxvYWQsIFhtbFNwYWNlLlByZXNlcnZlKTsNCiAgICAgICAgICAgIHhyTG9hZC5EaXNwb3NlKCk7DQogICAgICAgICAgICBYUGF0aE5hdmlnYXRvciB4UCA9ICgoSVhQYXRoTmF2aWdhYmxlKXhkVGVtcCkuQ3JlYXRlTmF2aWdhdG9yKCk7DQoNCiAgICAgICAgICAgIHhQLk1vdmVUb05leHQoKTsNCiAgICAgICAgICAgIHhzbHQuTG9hZCh4UCk7DQoNCiAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCYXNpYyBjaGVjayBmb3IgdXNhZ2Ugb2YgY3JlZGVudGlhbHMgb24gcmVzb2x2ZXIsIGxvYWQgWFNMIHRoYXQgbmVlZHMgY3JlZC4gd2l0aCBjb3JyZWN0IHJlc29sdmVyIildDQogICAgICAgIFtJbmxpbmVEYXRhKFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkTmF2aWdhdG9yMyhUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48b3V0PlJlZDUwT3JhbmdlMjU8L291dD4iOw0KDQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbFRyYW5zZm9ybSgpOw0KICAgICAgICAgICAgWG1sVmFsaWRhdGluZ1JlYWRlciB4ckxvYWQgPSBuZXcgWG1sVmFsaWRhdGluZ1JlYWRlcihuZXcgWG1sVGV4dFJlYWRlcihGdWxsRmlsZVBhdGgoIlhtbFJlc29sdmVyL1hzbHRSZXNvbHZlclRlc3RNYWluLnhzbCIpKSk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB4ckxvYWQuWG1sUmVzb2x2ZXIgPSBHZXREZWZhdWx0Q3JlZFJlc29sdmVyKCk7DQoNCiAgICAgICAgICAgIFhQYXRoRG9jdW1lbnQgeGRUZW1wID0gbmV3IFhQYXRoRG9jdW1lbnQoeHJMb2FkLCBYbWxTcGFjZS5QcmVzZXJ2ZSk7DQogICAgICAgICAgICBYUGF0aE5hdmlnYXRvciB4UCA9ICgoSVhQYXRoTmF2aWdhYmxlKXhkVGVtcCkuQ3JlYXRlTmF2aWdhdG9yKCk7DQoNCiAgICAgICAgICAgIHhzbHQuTG9hZCh4UCwgR2V0RGVmYXVsdENyZWRSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIlJlZ3Jlc3Npb24gY2FzZSBmb3IgYnVnIDgwNzY4IildDQogICAgICAgIFtTa2lwT25UYXJnZXRGcmFtZXdvcmsoVGFyZ2V0RnJhbWV3b3JrTW9uaWtlcnMuTmV0RnJhbWV3b3JrLCAiRnVsbCBmcmFtZXdvcmsgc3VwcG9ydHMgPG1zeG1sOnNjcmlwdD4iKV0NCiAgICAgICAgW0ZhY3RdDQogICAgICAgIHB1YmxpYyB2b2lkIFRDX0Vuc3VyZV9TY3JpcHRfTm90X0FsbG93ZWQoKQ0KICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbFRyYW5zZm9ybSgpOw0KDQogICAgICAgICAgICB2YXIgeHJMb2FkID0gbmV3IFhtbFZhbGlkYXRpbmdSZWFkZXIobmV3IFhtbFRleHRSZWFkZXIoRnVsbEZpbGVQYXRoKCJCdWc4MDc2OC54c2wiKSkpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgdmFyIHhkID0gbmV3IFhQYXRoRG9jdW1lbnQoeHJMb2FkLCBYbWxTcGFjZS5QcmVzZXJ2ZSk7DQogICAgICAgICAgICB2YXIgZSA9IEFzc2VydC5UaHJvd3M8WHNsdENvbXBpbGVFeGNlcHRpb24+KCgpID0+IHhzbHQuTG9hZCh4ZCwgbmV3IFhtbFVybFJlc29sdmVyKCkpKTsNCiAgICAgICAgICAgIEFzc2VydC5Jc1R5cGU8UGxhdGZvcm1Ob3RTdXBwb3J0ZWRFeGNlcHRpb24+KGUuSW5uZXJFeGNlcHRpb24pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbFRyYW5zZm9ybS5Mb2FkKFJlYWRlcikgICAgICAgICAgICAgICAgICAgICAgKi8NCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uTG9hZChSZWFkZXIpIDogUmVhZGVyLCBTdHJlYW0iLCBEZXNjID0gIlJFQURFUixTVFJFQU0iKV0NCiAgICBwdWJsaWMgY2xhc3MgQ0xvYWRSZWFkZXJUZXN0IDogWHNsdEFwaVRlc3RDYXNlQmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ0xvYWRSZWFkZXJUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQmFzaWMgVmVyaWZpY2F0aW9uIFRlc3QiKV0NCiAgICAgICAgW0lubGluZURhdGEoVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRYbWxSZWFkZXIxKFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+DQoJCTEuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTIuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTMuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTQuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTUuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTYuTm8gVmFsdWUgU3BlY2lmaWVkPC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgQm9vbGVhbiBmVEVTVF9GQUlMID0gZmFsc2U7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbFRyYW5zZm9ybSgpOw0KDQogICAgICAgICAgICBYbWxWYWxpZGF0aW5nUmVhZGVyIHhyVGVtcCA9IG5ldyBYbWxWYWxpZGF0aW5nUmVhZGVyKG5ldyBYbWxUZXh0UmVhZGVyKEZ1bGxGaWxlUGF0aCgic2hvd1BhcmFtLnhzbCIpKSk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB4clRlbXAuVmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5Ob25lOw0KICAgICAgICAgICAgeHJUZW1wLkVudGl0eUhhbmRsaW5nID0gRW50aXR5SGFuZGxpbmcuRXhwYW5kRW50aXRpZXM7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoeHJUZW1wKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZlRFU1RfRkFJTCA9IHRydWU7DQogICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4clRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGZURVNUX0ZBSUwpDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgaWYgKFRyYW5zZm9ybSgiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNhbGxpbmcgd2l0aCBhIGNsb3NlZCByZWFkZXIsIHNob3VsZCB0aHJvdyBleGNlcHRpb24iKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZFhtbFJlYWRlcjIoKQ0KICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbFRyYW5zZm9ybSgpOw0KDQogICAgICAgICAgICBYbWxWYWxpZGF0aW5nUmVhZGVyIHhyVGVtcCA9IG5ldyBYbWxWYWxpZGF0aW5nUmVhZGVyKG5ldyBYbWxUZXh0UmVhZGVyKEZ1bGxGaWxlUGF0aCgic2hvd1BhcmFtLnhzbCIpKSk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB4clRlbXAuVmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5Ob25lOw0KICAgICAgICAgICAgeHJUZW1wLkVudGl0eUhhbmRsaW5nID0gRW50aXR5SGFuZGxpbmcuRXhwYW5kRW50aXRpZXM7DQogICAgICAgICAgICB4clRlbXAuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoeHJUZW1wKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uWG1sLlhzbC5Yc2x0Q29tcGlsZUV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChQbGF0Zm9ybURldGVjdGlvbi5Jc0Z1bGxGcmFtZXdvcmspDQogICAgICAgICAgICAgICAgICAgIENoZWNrRXhwZWN0ZWRFcnJvcihlLklubmVyRXhjZXB0aW9uLCAic3lzdGVtLmRhdGEuc3FseG1sIiwgIlhzbHRfV3JvbmdTdHlsZXNoZWV0RWxlbWVudCIsIG5ldyBzdHJpbmdbXSB7ICIiIH0pOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgQ2hlY2tFeHBlY3RlZEVycm9yKGUuSW5uZXJFeGNlcHRpb24sICJzeXN0ZW0ueG1sIiwgIlhzbHRfV3JvbmdTdHlsZXNoZWV0RWxlbWVudCIsIG5ldyBzdHJpbmdbXSB7ICIiIH0pOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJObyBleGNlcHRpb24gdGhyb3duIGZvciBhIGxvYWRpbmcgYSBjbG9zZWQgcmVhZGVyISIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJWZXJpZnkgUmVhZGVyIGlzbiIidCBjbG9zZWQgYWZ0ZXIgTG9hZCIpXQ0KICAgICAgICBbSW5saW5lRGF0YSgpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBMb2FkWG1sUmVhZGVyMygpDQogICAgICAgIHsNCiAgICAgICAgICAgIEJvb2xlYW4gZlRFU1RfRkFJTCA9IGZhbHNlOw0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xUcmFuc2Zvcm0oKTsNCg0KICAgICAgICAgICAgWG1sVmFsaWRhdGluZ1JlYWRlciB4clRlbXAgPSBuZXcgWG1sVmFsaWRhdGluZ1JlYWRlcihuZXcgWG1sVGV4dFJlYWRlcihGdWxsRmlsZVBhdGgoInNob3dQYXJhbS54c2wiKSkpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgeHJUZW1wLlZhbGlkYXRpb25UeXBlID0gVmFsaWRhdGlvblR5cGUuTm9uZTsNCiAgICAgICAgICAgIHhyVGVtcC5FbnRpdHlIYW5kbGluZyA9IEVudGl0eUhhbmRsaW5nLkV4cGFuZEVudGl0aWVzOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNsdC5Mb2FkKHhyVGVtcCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZURVNUX0ZBSUwgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHRocm93IChleCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCFmVEVTVF9GQUlMIHx8ICh4clRlbXAuUmVhZFN0YXRlICE9IFJlYWRTdGF0ZS5DbG9zZWQpKQ0KICAgICAgICAgICAgICAgICAgICBmVEVTVF9GQUlMID0gZmFsc2U7DQogICAgICAgICAgICAgICAgeHJUZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChmVEVTVF9GQUlMKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJBcHBlYXIgdG8gaGF2ZSBhY2NpZGVudGx5IGNsb3NlZCB0aGUgUmVhZGVyIik7DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJWZXJpZnkgcG9zaXRpb24gb2Ygbm9kZSBpbiBSZWFkZXIgaXMgYXQgRU9GIGFmdGVyIExvYWQiKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZFhtbFJlYWRlcjQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBCb29sZWFuIGZURVNUX0ZBSUwgPSBmYWxzZTsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsVHJhbnNmb3JtKCk7DQoNCiAgICAgICAgICAgIFhtbFZhbGlkYXRpbmdSZWFkZXIgeHJUZW1wID0gbmV3IFhtbFZhbGlkYXRpbmdSZWFkZXIobmV3IFhtbFRleHRSZWFkZXIoRnVsbEZpbGVQYXRoKCJzaG93UGFyYW0ueHNsIikpKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgIHhyVGVtcC5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLk5vbmU7DQogICAgICAgICAgICB4clRlbXAuRW50aXR5SGFuZGxpbmcgPSBFbnRpdHlIYW5kbGluZy5FeHBhbmRFbnRpdGllczsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh4clRlbXApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmVEVTVF9GQUlMID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICghZlRFU1RfRkFJTCAmJiAoIXhyVGVtcC5FT0YpKQ0KICAgICAgICAgICAgICAgICAgICBmVEVTVF9GQUlMID0gZmFsc2U7DQogICAgICAgICAgICAgICAgeHJUZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChmVEVTVF9GQUlMKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJSZWFkZXIgZG9lcyBub3QgYXBwZWFyIHRvIGJlIGF0IHRoZSBlbmQgb2YgZmlsZS4iKTsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgd2l0aCByZWFkZXIgcG9zaXRpb24gYXQgRU9GLCBzaG91bGQgdGhyb3cgZXhjZXB0aW9uIildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRYbWxSZWFkZXI1KCkNCiAgICAgICAgew0KICAgICAgICAgICAgQm9vbGVhbiBmVEVTVF9GQUlMID0gZmFsc2U7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbFRyYW5zZm9ybSgpOw0KDQogICAgICAgICAgICBYbWxWYWxpZGF0aW5nUmVhZGVyIHhyVGVtcCA9IG5ldyBYbWxWYWxpZGF0aW5nUmVhZGVyKG5ldyBYbWxUZXh0UmVhZGVyKEZ1bGxGaWxlUGF0aCgic2hvd1BhcmFtLnhzbCIpKSk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB4clRlbXAuVmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5Ob25lOw0KICAgICAgICAgICAgeHJUZW1wLkVudGl0eUhhbmRsaW5nID0gRW50aXR5SGFuZGxpbmcuRXhwYW5kRW50aXRpZXM7DQogICAgICAgICAgICB4c2x0LkxvYWQoeHJUZW1wKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh4clRlbXApOyAgLy8gc2hvdWxkIG5vdyBiZSBhdCBlbmQgYW5kIHNob3VsZCBnaXZlIGV4Y2VwdGlvbg0KICAgICAgICAgICAgICAgIGZURVNUX0ZBSUwgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5YbWwuWHNsLlhzbHRDb21waWxlRXhjZXB0aW9uIGUpDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBpZiAoUGxhdGZvcm1EZXRlY3Rpb24uSXNGdWxsRnJhbWV3b3JrKQ0KICAgICAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZS5Jbm5lckV4Y2VwdGlvbiwgInN5c3RlbS5kYXRhLnNxbHhtbCIsICJYc2x0X1dyb25nU3R5bGVzaGVldEVsZW1lbnQiLCBuZXcgc3RyaW5nW10geyAiIiB9KTsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIENoZWNrRXhwZWN0ZWRFcnJvcihlLklubmVyRXhjZXB0aW9uLCAic3lzdGVtLnhtbCIsICJYc2x0X1dyb25nU3R5bGVzaGVldEVsZW1lbnQiLCBuZXcgc3RyaW5nW10geyAiIiB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4clRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGZURVNUX0ZBSUwpDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJMb2FkIHdpdGggTlVMTCByZWFkZXIsIHNob3VsZCB0aHJvdyBTeXN0ZW0uQXJndW1lbnROdWxsRXhjZXB0aW9uIildDQogICAgICAgIFtJbmxpbmVEYXRhKCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIExvYWRYbWxSZWFkZXI2KCkNCiAgICAgICAgew0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xUcmFuc2Zvcm0oKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCg0KICAgICAgICAgICAgWG1sVGV4dFJlYWRlciB4clRlbXAgPSBudWxsOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LkxvYWQoeHJUZW1wKTsgIC8vIHNob3VsZCBub3cgYmUgYXQgZW5kIGFuZCBzaG91bGQgZ2l2ZSBleGNlcHRpb24NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnROdWxsRXhjZXB0aW9uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gdGhyb3cgU3lzdGVtLkFyZ3VtZW50TnVsbEV4Y2VwdGlvbiBmb3IgTlVMTCByZWFkZXIgaW5wdXQiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQmFzaWMgY2hlY2sgZm9yIHVzYWdlIG9mIGNyZWRlbnRpYWxzIG9uIHJlc29sdmVyLCBsb2FkIFhTTCB0aGF0IG5lZWRzIGNyZWQuIHdpdGggY29ycmVjdCByZXNvbHZlciIpXQ0KICAgICAgICBbSW5saW5lRGF0YShUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgTG9hZFhtbFJlYWRlcjcoVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PG91dD5SZWQ1ME9yYW5nZTI1PC9vdXQ+IjsNCg0KI3ByYWdtYSB3YXJuaW5nIGRpc2FibGUgMDYxOA0KICAgICAgICAgICAgeHNsdCA9IG5ldyBYc2xUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgIFhtbFZhbGlkYXRpbmdSZWFkZXIgeHJMb2FkID0gbmV3IFhtbFZhbGlkYXRpbmdSZWFkZXIobmV3IFhtbFRleHRSZWFkZXIoRnVsbEZpbGVQYXRoKCJYbWxSZXNvbHZlci9Yc2x0UmVzb2x2ZXJUZXN0TWFpbi54c2wiKSkpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgeHJMb2FkLlhtbFJlc29sdmVyID0gR2V0RGVmYXVsdENyZWRSZXNvbHZlcigpOw0KICAgICAgICAgICAgeHNsdC5Mb2FkKHhyTG9hZCwgR2V0RGVmYXVsdENyZWRSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIHhyTG9hZC5EaXNwb3NlKCk7DQoNCiAgICAgICAgICAgIGlmIChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQogICAgLyogICAgICAgICAgWHNsVHJhbnNmb3JtLlRyYW5zZm9ybSAtIEludGVncml0eSAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oKSBJbnRlZ3JpdHkgOiBSZWFkZXIgLCBSZWFkZXIiLCBEZXNjID0gIlJFQURFUixSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uVHJhbnNmb3JtKCkgSW50ZWdyaXR5IDogUmVhZGVyLCBTdHJlYW0iLCBEZXNjID0gIlJFQURFUixTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uVHJhbnNmb3JtKCkgSW50ZWdyaXR5IDogUmVhZGVyLCBXcml0ZXIiLCBEZXNjID0gIlJFQURFUixXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uVHJhbnNmb3JtKCkgSW50ZWdyaXR5IDogUmVhZGVyLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJSRUFERVIsVEVYVFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oKSBJbnRlZ3JpdHkgOiBVUkksIFJlYWRlciIsIERlc2MgPSAiVVJJLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oKSBJbnRlZ3JpdHkgOiBVUkksIFN0cmVhbSIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oKSBJbnRlZ3JpdHkgOiBVUkksIFdyaXRlciIsIERlc2MgPSAiVVJJLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oKSBJbnRlZ3JpdHkgOiBVUkksIFRleHRXcml0ZXIiLCBEZXNjID0gIlVSSSxURVhUV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IE5hdmlnYXRvciwgUmVhZGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IE5hdmlnYXRvciwgU3RyZWFtIiwgRGVzYyA9ICJOQVZJR0FUT1IsU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IE5hdmlnYXRvciwgV3JpdGVyIiwgRGVzYyA9ICJOQVZJR0FUT1IsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybSgpIEludGVncml0eSA6IE5hdmlnYXRvciwgVGV4dFdyaXRlciIsIERlc2MgPSAiTkFWSUdBVE9SLFRFWFRXUklURVIiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ1RyYW5zZm9ybVRlc3RHZW5lcmljIDogWHNsdEFwaVRlc3RDYXNlQmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KICAgICAgICBwdWJsaWMgQ1RyYW5zZm9ybVRlc3RHZW5lcmljKElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQmFzaWMgVmVyaWZpY2F0aW9uIFRlc3QiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtR2VuZXJpYzEoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0Pg0KCQkxLk5vIFZhbHVlIFNwZWNpZmllZA0KCQkyLk5vIFZhbHVlIFNwZWNpZmllZA0KCQkzLk5vIFZhbHVlIFNwZWNpZmllZA0KCQk0Lk5vIFZhbHVlIFNwZWNpZmllZA0KCQk1Lk5vIFZhbHVlIFNwZWNpZmllZA0KCQk2Lk5vIFZhbHVlIFNwZWNpZmllZDwvcmVzdWx0PiI7DQoNCiAgICAgICAgICAgIGlmICgoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkgJiYgKFRyYW5zZm9ybSgiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiTG9hZCBhbmQgVHJhbnNmb3JtIG11bHRpcGxlIHRpbWVzIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybUdlbmVyaWMyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD4NCgkJMS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMi5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMy5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNC5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNi5ObyBWYWx1ZSBTcGVjaWZpZWQ8L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDU7IGkrKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoKExvYWRYU0woInNob3dQYXJhbS54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpICE9IDEpIHx8IChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSAhPSAxKSkNCiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvYWQgb25jZSwgVHJhbnNmb3JtIG1hbnkgdGltZXMiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtR2VuZXJpYzMoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0Pg0KCQkxLk5vIFZhbHVlIFNwZWNpZmllZA0KCQkyLk5vIFZhbHVlIFNwZWNpZmllZA0KCQkzLk5vIFZhbHVlIFNwZWNpZmllZA0KCQk0Lk5vIFZhbHVlIFNwZWNpZmllZA0KCQk1Lk5vIFZhbHVlIFNwZWNpZmllZA0KCQk2Lk5vIFZhbHVlIFNwZWNpZmllZDwvcmVzdWx0PiI7DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyBpKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSkgIT0gMSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlRlc3QgZmFpbGVkIHRvIHRyYW5zZm9ybSBhZnRlciB7MH0gaXRlcmF0aW9ucyIsIGkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCBUcmFuc2Zvcm0gd2l0aG91dCBsb2FkaW5nIildDQogICAgICAgIFtJbmxpbmVEYXRhKFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybUdlbmVyaWM0KFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICB4c2x0ID0gbmV3IFhzbFRyYW5zZm9ybSgpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVHJhbnNmb3JtKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkludmFsaWRPcGVyYXRpb25FeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZSwgInN5c3RlbS54bWwiLCAiWHNsdF9Ob1N0eWxlc2hlZXRMb2FkZWQiLCBuZXcgc3RyaW5nW10geyAiIiB9KTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnaXZlbiBmb3IgYSB0cmFuc2Zvcm0gdGhhdCBkaWRuJ3QgaGF2ZSBhIExvYWQgbWV0aG9kIGluc3RhbnRpYXRlZCIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJDbG9zaW5nIFhTTCBhbmQgWE1MIGZpbGVzIHVzZWQgaW4gdHJhbnNmb3JtLCBSZWFkIGFjY2VzcyIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1HZW5lcmljNShJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBGaWxlU3RyZWFtIHMyOw0KDQogICAgICAgICAgICBpZiAoKExvYWRYU0woInNob3dQYXJhbS54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpICYmIChUcmFuc2Zvcm0oImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzMiA9IG5ldyBGaWxlU3RyZWFtKEZ1bGxGaWxlUGF0aCgic2hvd1BhcmFtLnhzbCIpLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQpOw0KICAgICAgICAgICAgICAgIHMyLkRpc3Bvc2UoKTsNCg0KICAgICAgICAgICAgICAgIHMyID0gbmV3IEZpbGVTdHJlYW0oRnVsbEZpbGVQYXRoKCJmcnVpdHMueG1sIiksIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCk7DQogICAgICAgICAgICAgICAgczIuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkVuY291bnRlcmVkIGVycm9ycyBwZXJmb3JtaW5nIHRyYW5zZm9ybSBhbmQgY291bGQgbm90IHZlcmlmeSBpZiBmaWxlcyB3ZXJlIGNsb3NlZCIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJCdWczNTgxMDMgLSBBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24gaW4gZm9yd2FyZHMtY29tcGF0aWJsZSBtb2RlIGZvciA8Zm9vIGJhcj0neysxfScvPiIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1HZW5lcmljNyhJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2FkWFNMKCJGb3J3YXJkQ29tcDIueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKTsNCiAgICAgICAgICAgICAgICBUcmFuc2Zvcm0oImRhdGEueG1sIiwgdHJ1ZSwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoWHNsdEV4Y2VwdGlvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvL0xpbmVJbmZvIGxJbmZvID0gbmV3IExpbmVJbmZvKGUuTGluZU51bWJlciwgZS5MaW5lUG9zaXRpb24sIG5ldyBVcmkoRnVsbEZpbGVQYXRoKCJmb3J3YXJkY29tcDIueHNsIiwgZmFsc2UpLCBVcmlLaW5kLlJlbGF0aXZlKS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAvL0NoZWNrRXhwZWN0ZWRFcnJvcihlLCAiU3lzdGVtLnhtbCIsICJYc2x0X0ludmFsaWRYUGF0aCIsIG5ldyBzdHJpbmdbXSB7ICJzdHJpbmcoKzEpIiB9LCBsSW5mbyk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlhzbHRFeGNlcHRpb24gKFhzbHRfSW52YWxpZFhQYXRoKSB3YXMgZXhwZWN0ZWQiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbFRyYW5zZm9ybSgsUmVzb2x2ZXIpIC0gSW50ZWdyaXR5ICAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybSgsWG1sUmVzb2x2ZXIpIDogUmVhZGVyLCBSZWFkZXIiLCBEZXNjID0gIlJFQURFUixSRUFERVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uVHJhbnNmb3JtKCxYbWxSZXNvbHZlcikgOiBSZWFkZXIsIFN0cmVhbSIsIERlc2MgPSAiUkVBREVSLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oLFhtbFJlc29sdmVyKSA6IFJlYWRlciwgV3JpdGVyIiwgRGVzYyA9ICJSRUFERVIsV1JJVEVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybSgsWG1sUmVzb2x2ZXIpIDogUmVhZGVyLCBUZXh0V3JpdGVyIiwgRGVzYyA9ICJSRUFERVIsVEVYVFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oLFhtbFJlc29sdmVyKSA6IFVSSSwgUmVhZGVyIiwgRGVzYyA9ICJVUkksUkVBREVSIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybSgsWG1sUmVzb2x2ZXIpIDogVVJJLCBTdHJlYW0iLCBEZXNjID0gIlVSSSxTVFJFQU0iKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uVHJhbnNmb3JtKCxYbWxSZXNvbHZlcikgOiBVUkksIFdyaXRlciIsIERlc2MgPSAiVVJJLFdSSVRFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oLFhtbFJlc29sdmVyKSA6IFVSSSwgVGV4dFdyaXRlciIsIERlc2MgPSAiVVJJLFRFWFRXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uVHJhbnNmb3JtKCxYbWxSZXNvbHZlcikgOiBOYXZpZ2F0b3IsIFJlYWRlciIsIERlc2MgPSAiTkFWSUdBVE9SLFJFQURFUiIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oLFhtbFJlc29sdmVyKSA6IE5hdmlnYXRvciwgU3RyZWFtIiwgRGVzYyA9ICJOQVZJR0FUT1IsU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybSgsWG1sUmVzb2x2ZXIpIDogTmF2aWdhdG9yLCBXcml0ZXIiLCBEZXNjID0gIk5BVklHQVRPUixXUklURVIiKV0NCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIlhzbHRUcmFuc2Zvcm0uVHJhbnNmb3JtKCxYbWxSZXNvbHZlcikgOiBOYXZpZ2F0b3IsIFRleHRXcml0ZXIiLCBEZXNjID0gIk5BVklHQVRPUixURVhUV1JJVEVSIildDQogICAgcHVibGljIGNsYXNzIENUcmFuc2Zvcm1SZXNvbHZlclRlc3QgOiBYc2x0QXBpVGVzdENhc2VCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDVHJhbnNmb3JtUmVzb2x2ZXJUZXN0KElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkgOiBiYXNlKG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiUGFzcyBudWxsIFhtbFJlc29sdmVyLCBsb2FkIHN0eWxlIHNoZWV0IHdpdGggaW1wb3J0L2luY2x1ZGUsIHNob3VsZCBub3QgYWZmZWN0IHRyYW5zZm9ybSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBYbWxSZXNvbHZlcjEoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKG5ldyBBbGxvd0RlZmF1bHRSZXNvbHZlckNvbnRleHQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+PGZydWl0PkFwcGxlPC9mcnVpdD48ZnJ1aXQ+b3JhbmdlPC9mcnVpdD48L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoTG9hZFhTTCgiWG1sUmVzb2x2ZXJfTWFpbi54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChUcmFuc2Zvcm1SZXNvbHZlcigiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUsIG51bGwpID09IDEpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJQYXNzIG51bGwgWG1sUmVzb2x2ZXIsIGxvYWQgc3R5bGUgc2hlZXQgd2l0aCBkb2N1bWVudCBmdW5jdGlvbiwgc2hvdWxkIG5vdCByZXNvbHZlIGR1cmluZyB0cmFuc2Zvcm0iKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgWG1sUmVzb2x2ZXIyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD48L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICAvLyAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueHNsIiBjb250YWlucw0KICAgICAgICAgICAgLy8gPHhzbDpmb3ItZWFjaCBzZWxlY3Q9ImRvY3VtZW50KCd4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54bWwnKS8vZWxlbSI+DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKFRyYW5zZm9ybVJlc29sdmVyKCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSwgbnVsbCkgPT0gMSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeVJlc3VsdChleHBlY3RlZCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlByb2JsZW0gbG9hZGluZyBzdHlsZXNoZWV0ISIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiRGVmYXVsdCBYbWxSZXNvbHZlciwgbG9hZCBzdHlsZSBzaGVldCB3aXRoIGRvY3VtZW50IGZ1bmN0aW9uLCBzaG91bGQgcmVzb2x2ZSBkdXJpbmcgdHJhbnNmb3JtIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRDX1hzbHRfRG9jdW1lbnRfRnVuY3Rpb25fVXNlX1htbFVybFJlc29sdmVyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vICJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiIGNvbnRhaW5zDQogICAgICAgICAgICAvLyA8eHNsOmZvci1lYWNoIHNlbGVjdD0iZG9jdW1lbnQoJ3htbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhtbCcpLy9lbGVtIj4NCiAgICAgICAgICAgIC8vIHdpdGggWG1sVXJsUmVzb2x2ZXIgaXQgc2hvdWxkIGJlIGFibGUgdG8gb3BlbiByZWZlcmVuY2VkIGZpbGUNCiAgICAgICAgICAgIExvYWRYU0woInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICBUcmFuc2Zvcm1SZXNvbHZlcigiZnJ1aXRzLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIFZlcmlmeVJlc3VsdChAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+MTIzPC9yZXN1bHQ+Iik7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oImRvY3VtZW50KCkgaGFzIGFic29sdXRlIFVSSSIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuUmVhZGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuV3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlJlYWRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLldyaXRlciwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSwgRG9jVHlwZS5YUGF0aERvY3VtZW50KV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5SZWFkZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5Xcml0ZXIsIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbU2tpcE9uVGFyZ2V0RnJhbWV3b3JrKFRhcmdldEZyYW1ld29ya01vbmlrZXJzLlVhcCwgIkFic29sdXRlIHBhdGggYWNjZXNzIGlzIGRlbmllZCBpbiB1YXAiKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVENfQWJzb2x1dGVQYXRoX1RyYW5zZm9ybShJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBUZXN0VXNpbmdUZW1wb3JhcnlDb3B5T2ZSZXNvbHZlckRvY3VtZW50KCgpID0+DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTG9hZFhTTCgieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb25fYWJzb2x1dGVfdXJpLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICAgICAgVHJhbnNmb3JtUmVzb2x2ZXIoImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlLCBuZXcgWG1sVXJsUmVzb2x2ZXIoKSk7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD4xMjM8L3Jlc3VsdD4iKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbFRyYW5zZm9ybS5UcmFuc2Zvcm0gLSAoU3RyaW5nLCBTdHJpbmcpICAgICAgICAgICAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oU3RyaW5nLCBTdHJpbmcpIDogUmVhZGVyICwgU3RyaW5nIiwgRGVzYyA9ICJSRUFERVIsU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybShTdHJpbmcsIFN0cmluZykgOiBVUkksIFN0cmluZyIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oU3RyaW5nLCBTdHJpbmcpIDogTmF2aWdhdG9yLCBTdHJpbmciLCBEZXNjID0gIk5BVklHQVRPUixTVFJFQU0iKV0NCiAgICBwdWJsaWMgY2xhc3MgQ1RyYW5zZm9ybVN0clN0clRlc3QgOiBYc2x0QXBpVGVzdENhc2VCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDVHJhbnNmb3JtU3RyU3RyVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkJhc2ljIFZlcmlmaWNhdGlvbiBUZXN0IildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjEoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+DQoJCTEuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTIuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTMuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTQuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTUuTm8gVmFsdWUgU3BlY2lmaWVkDQoJCTYuTm8gVmFsdWUgU3BlY2lmaWVkPC9yZXN1bHQ+IjsNCg0KICAgICAgICAgICAgU3RyaW5nIHN6RnVsbEZpbGVuYW1lID0gRnVsbEZpbGVQYXRoKCJmcnVpdHMueG1sIik7DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENhbGxUcmFuc2Zvcm0oeHNsdCwgc3pGdWxsRmlsZW5hbWUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiSW5wdXQgaXMgbnVsbCIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1TdHJTdHIyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKExvYWRYU0woInNob3dQYXJhbS54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBDYWxsVHJhbnNmb3JtKHhzbHQsIG51bGwsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5Bcmd1bWVudEV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7IHJldHVybjsgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBudWxsIGlucHV0IGZpbGVuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIk91dHB1dCBmaWxlIGlzIG51bGwiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyMyhJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFN0cmluZyBzekZ1bGxGaWxlbmFtZSA9IEZ1bGxGaWxlUGF0aCgiZnJ1aXRzLnhtbCIpOw0KDQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKHN6RnVsbEZpbGVuYW1lLCBudWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5Bcmd1bWVudEV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIG5vdCBnZW5lcmF0ZWQgZm9yIG51bGwgb3V0cHV0IGZpbGVuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIklucHV0IGlzIG5vbmV4aXN0aW5nIGZpbGUiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyNChJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQ2FsbFRyYW5zZm9ybSh4c2x0LCAiSURvbnRFeGlzdC54c2wiLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uSU8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3IgaW52YWxpZCBpbnB1dCBmaWxlIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIk91dHB1dCBmaWxlIGlzIGludmFsaWQiKV0NCiAgICAgICAgW1BsYXRmb3JtU3BlY2lmaWMoVGVzdFBsYXRmb3Jtcy5XaW5kb3dzKV0gLy9PdXRwdXQgZmlsZSBuYW1lIGlzIHZhbGlkIG9uIFVuaXgNCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyNShJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFN0cmluZyBzekZ1bGxGaWxlbmFtZSA9IEZ1bGxGaWxlUGF0aCgiZnJ1aXRzLnhtbCIpOw0KDQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHhzbHQuVHJhbnNmb3JtKHN6RnVsbEZpbGVuYW1lLCBzekludmFsaWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkFyZ3VtZW50RXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3IgaW52YWxpZCBvdXRwdXQgZGVzdGluYXRpb24iKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiSW5wdXQgaXMgZW1wdHkgc3RyaW5nIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjYoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENhbGxUcmFuc2Zvcm0oeHNsdCwgc3pFbXB0eSwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkFyZ3VtZW50RXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3IgZW1wdHkgc3RyaW5nIGlucHV0IGZpbGUiKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiT3V0cHV0IGZpbGUgaXMgZW1wdHkgc3RyaW5nIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjcoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBTdHJpbmcgc3pGdWxsRmlsZW5hbWUgPSBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKTsNCg0KICAgICAgICAgICAgaWYgKExvYWRYU0woInNob3dQYXJhbS54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybShzekZ1bGxGaWxlbmFtZSwgc3pFbXB0eSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBlbXB0eSBvdXRwdXQgZmlsZSBuYW1lIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNhbGwgVHJhbnNmb3JtIG1hbnkgdGltZXMiKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyOChJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PHJlc3VsdD4NCgkJMS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMi5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJMy5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNC5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNS5ObyBWYWx1ZSBTcGVjaWZpZWQNCgkJNi5ObyBWYWx1ZSBTcGVjaWZpZWQ8L3Jlc3VsdD4iOw0KDQogICAgICAgICAgICBTdHJpbmcgc3pGdWxsRmlsZW5hbWUgPSBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKTsNCg0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCA1MDsgaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQ2FsbFRyYW5zZm9ybSh4c2x0LCBzekZ1bGxGaWxlbmFtZSwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjYXRjaChFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJGYWlsZWQgdG8gcHJvY2VzcyBMb2FkIGFmdGVyIGNhbGxpbmcgezB9IHRpbWVzIiwgaSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiQ2FsbCB3aXRob3V0IGxvYWRpbmciKV0NCiAgICAgICAgW0lubGluZURhdGEoKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyOSgpDQogICAgICAgIHsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsVHJhbnNmb3JtKCk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDYWxsVHJhbnNmb3JtKHhzbHQsIEZ1bGxGaWxlUGF0aCgiZnJ1aXRzLnhtbCIpLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkludmFsaWRPcGVyYXRpb25FeGNlcHRpb24gZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDaGVja0V4cGVjdGVkRXJyb3IoZSwgIlN5c3RlbS54bWwiLCAiWHNsdF9Ob1N0eWxlc2hlZXRMb2FkZWQiLCBuZXcgc3RyaW5nW10geyAiIiB9KTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiRXhjZXB0aW9uIGF0dGVtcHRpbmcgYSB0cmFuc2Zvcm0gd2l0aG91dCBsb2FkaW5nIGFuIFhTTCBmaWxlIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIk91dHB1dCB0byB1bnJlYWNoYWJsZSBkZXN0aW5hdGlvbiIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuUmVhZGVyLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuTmF2aWdhdG9yLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUcmFuc2Zvcm1TdHJTdHIxMChJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oRnVsbEZpbGVQYXRoKCJmcnVpdHMueG1sIiksICJodHRwOi8vd3d3Lklkb250RXhpc3QuY29tL2luZGV4LnhtbCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3IgaW52YWxpZCBvdXRwdXQgZGVzdGluYXRpb24iKTsNCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiSW5wdXQgZmlsZW5hbWUgaXMgXCcuXCcsIFwnLi5cJywgYW5kIFwnXFxcXFwnIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjExKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaW50IGlDb3VudCA9IDA7DQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENhbGxUcmFuc2Zvcm0oeHNsdCwgIi4uIiwgX3N0ck91dEZpbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoU3lzdGVtLkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlDb3VudCsrOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQ2FsbFRyYW5zZm9ybSh4c2x0LCAiLiIsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5FeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpQ291bnQrKzsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIENhbGxUcmFuc2Zvcm0oeHNsdCwgIlxcXFwiLCBfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaUNvdW50Kys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoaUNvdW50LkVxdWFscygzKSkNCiAgICAgICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGNlcHRpb24gbm90IGdlbmVyYXRlZCBmb3IgaW52YWxpZCBpbnB1dCBzb3VyY2VzIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIk91dHB1dCBmaWxlbmFtZSBpcyBcJy5cJyBhbmQgXCcuLlwnKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyMTIoSW5wdXRUeXBlIGlucHV0VHlwZSwgUmVhZGVyVHlwZSByZWFkZXJUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBTdHJpbmcgc3pGdWxsRmlsZW5hbWUgPSBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKTsNCiAgICAgICAgICAgIGludCBpQ291bnQgPSAwOw0KICAgICAgICAgICAgaWYgKExvYWRYU0woInNob3dQYXJhbS54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpID09IDEpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybShzekZ1bGxGaWxlbmFtZSwgIi4uIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChTeXN0ZW0uRXhjZXB0aW9uKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaUNvdW50Kys7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybShzekZ1bGxGaWxlbmFtZSwgIi4iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFN5c3RlbS5FeGNlcHRpb24pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpQ291bnQrKzsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGlDb3VudC5FcXVhbHMoMikpDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBpbnZhbGlkIG91cHV0IGRlc3RpbmF0aW9ucyIpOw0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJPdXRwdXQgZmlsZW5hbWUgaXMgXCdcXFxcXCciKV0NCiAgICAgICAgW1BsYXRmb3JtU3BlY2lmaWMoVGVzdFBsYXRmb3Jtcy5XaW5kb3dzKV0gIC8vIEludmFsaWQgcGF0aCBzcGVjaWZpYyB0byBXaW5kb3dzDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjEyX3dpbihJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFN0cmluZyBzekZ1bGxGaWxlbmFtZSA9IEZ1bGxGaWxlUGF0aCgiZnJ1aXRzLnhtbCIpOw0KDQogICAgICAgICAgICBpZiAoTG9hZFhTTCgic2hvd1BhcmFtLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVGhyb3dzPFN5c3RlbS5Bcmd1bWVudEV4Y2VwdGlvbj4oKCkgPT4geHNsdC5UcmFuc2Zvcm0oc3pGdWxsRmlsZW5hbWUsICIgICAgIikpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBub3QgZ2VuZXJhdGVkIGZvciBpbnZhbGlkIG91cHV0IGRlc3RpbmF0aW9uIik7DQogICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkNsb3NpbmcgZmlsZXMgYWZ0ZXIgdHJhbnNmb3JtIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0cjEzKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyaW5nIHN6RnVsbEZpbGVuYW1lID0gRnVsbEZpbGVQYXRoKCJmcnVpdHMueG1sIik7DQogICAgICAgICAgICBTdHJlYW0gc3RybVRlbXA7DQoNCiAgICAgICAgICAgIGlmIChMb2FkWFNMKCJzaG93UGFyYW0ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENhbGxUcmFuc2Zvcm0oeHNsdCwgc3pGdWxsRmlsZW5hbWUsIF9zdHJPdXRGaWxlKTsNCg0KICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIEkgY2FuIG9wZW4gYW5kIGNsb3NlIHRoZSB4bWwgZmlsZQ0KICAgICAgICAgICAgICAgIEZpbGUuUmVhZEFsbFRleHQoc3pGdWxsRmlsZW5hbWUpOw0KDQogICAgICAgICAgICAgICAgc3RybVRlbXAgPSBuZXcgRmlsZVN0cmVhbShzekZ1bGxGaWxlbmFtZSwgRmlsZU1vZGUuT3BlbiwgRmlsZUFjY2Vzcy5SZWFkKTsNCiAgICAgICAgICAgICAgICBzdHJtVGVtcC5EaXNwb3NlKCk7DQoNCiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBJIGNhbiBvcGVuIGFuZCBjbG9zZSB0aGUgb3V0cHV0IGZpbGUNCiAgICAgICAgICAgICAgICBGaWxlLlJlYWRBbGxUZXh0KF9zdHJPdXRGaWxlKTsNCg0KICAgICAgICAgICAgICAgIHN0cm1UZW1wID0gbmV3IEZpbGVTdHJlYW0oX3N0ck91dEZpbGUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCk7DQogICAgICAgICAgICAgICAgc3RybVRlbXAuRGlzcG9zZSgpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIC8qICAgICAgICAgIFhzbFRyYW5zZm9ybS5UcmFuc2Zvcm0gLSAoU3RyaW5nLCBTdHJpbmcsIFJlc29sdmVyKSAgICAgICAgICAqLw0KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oU3RyaW5nLCBTdHJpbmcsIFJlc29sdmVyKSA6IFJlYWRlciAsIFN0cmluZyIsIERlc2MgPSAiUkVBREVSLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiWHNsdFRyYW5zZm9ybS5UcmFuc2Zvcm0oU3RyaW5nLCBTdHJpbmcsIFJlc29sdmVyKSA6IFVSSSwgU3RyaW5nIiwgRGVzYyA9ICJVUkksU1RSRUFNIildDQogICAgLy9bVGVzdENhc2UoTmFtZSA9ICJYc2x0VHJhbnNmb3JtLlRyYW5zZm9ybShTdHJpbmcsIFN0cmluZywgUmVzb2x2ZXIpIDogTmF2aWdhdG9yLCBTdHJpbmciLCBEZXNjID0gIk5BVklHQVRPUixTVFJFQU0iKV0NCiAgICBwdWJsaWMgY2xhc3MgQ1RyYW5zZm9ybVN0clN0clJlc29sdmVyVGVzdCA6IFhzbHRBcGlUZXN0Q2FzZUJhc2UNCiAgICB7DQogICAgICAgIHByaXZhdGUgSVRlc3RPdXRwdXRIZWxwZXIgX291dHB1dDsNCiAgICAgICAgcHVibGljIENUcmFuc2Zvcm1TdHJTdHJSZXNvbHZlclRlc3QoSVRlc3RPdXRwdXRIZWxwZXIgb3V0cHV0KSA6IGJhc2Uob3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBfb3V0cHV0ID0gb3V0cHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJQYXNzIG51bGwgWG1sUmVzb2x2ZXIsIGxvYWQgc3R5bGUgc2hlZXQgd2l0aCBpbXBvcnQvaW5jbHVkZSwgc2hvdWxkIG5vdCBhZmZlY3QgdHJhbnNmb3JtIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcildDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRyYW5zZm9ybVN0clN0clJlc29sdmVyMShJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChuZXcgQWxsb3dEZWZhdWx0UmVzb2x2ZXJDb250ZXh0KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0PjxmcnVpdD5BcHBsZTwvZnJ1aXQ+PGZydWl0Pm9yYW5nZTwvZnJ1aXQ+PC9yZXN1bHQ+IjsNCiAgICAgICAgICAgICAgICBzdHJpbmcgc3pGdWxsRmlsZW5hbWUgPSBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKTsNCg0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKExvYWRYU0woIlhtbFJlc29sdmVyX01haW4ueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBDYWxsVHJhbnNmb3JtKHhzbHQsIHN6RnVsbEZpbGVuYW1lLCBfc3RyT3V0RmlsZSwgbnVsbCk7DQogICAgICAgICAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGUuVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJQYXNzIG51bGwgWG1sUmVzb2x2ZXIsIGxvYWQgc3R5bGUgc2hlZXQgd2l0aCBkb2N1bWVudCBmdW5jdGlvbiwgc2hvdWxkIG5vdCByZXNvbHZlIGR1cmluZyB0cmFuc2Zvcm0iKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlJlYWRlciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLlVSSSwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyKV0NCiAgICAgICAgW1RoZW9yeV0NCiAgICAgICAgcHVibGljIHZvaWQgVHJhbnNmb3JtU3RyU3RyUmVzb2x2ZXIyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIgY29udGFpbnMNCiAgICAgICAgICAgIC8vIDx4c2w6Zm9yLWVhY2ggc2VsZWN0PSJkb2N1bWVudCgneG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueG1sJykvL2VsZW0iPg0KICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkID0gQCI8P3htbCB2ZXJzaW9uPSIiMS4wIiIgZW5jb2Rpbmc9IiJ1dGYtOCIiPz48cmVzdWx0PjwvcmVzdWx0PiI7DQogICAgICAgICAgICBTdHJpbmcgc3pGdWxsRmlsZW5hbWUgPSBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKTsNCg0KICAgICAgICAgICAgaWYgKExvYWRYU0woInhtbFJlc29sdmVyX2RvY3VtZW50X2Z1bmN0aW9uLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDYWxsVHJhbnNmb3JtKHhzbHQsIHN6RnVsbEZpbGVuYW1lLCBfc3RyT3V0RmlsZSwgbnVsbCk7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIlByb2JsZW0gbG9hZGluZyBzdHlsZXNoZWV0ISIpOw0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vW1ZhcmlhdGlvbigiUGFzcyBYbWxVcmxSZXNvbHZlciwgbG9hZCBzdHlsZSBzaGVldCB3aXRoIGRvY3VtZW50IGZ1bmN0aW9uLCBzaG91bGQgcmVzb2x2ZSBkdXJpbmcgdHJhbnNmb3JtIildDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5SZWFkZXIsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0pXQ0KICAgICAgICBbSW5saW5lRGF0YShJbnB1dFR5cGUuVVJJLCBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXIsIFRyYW5zZm9ybVR5cGUuU3RyZWFtKV0NCiAgICAgICAgW0lubGluZURhdGEoSW5wdXRUeXBlLk5hdmlnYXRvciwgUmVhZGVyVHlwZS5YbWxWYWxpZGF0aW5nUmVhZGVyLCBUcmFuc2Zvcm1UeXBlLlN0cmVhbSldDQogICAgICAgIFtUaGVvcnldDQogICAgICAgIHB1YmxpYyB2b2lkIFRDX1hzbHRfRG9jdW1lbnRfRnVuY3Rpb25fVXNlX1htbFVybFJlc29sdmVyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueHNsIiBjb250YWlucw0KICAgICAgICAgICAgLy8gPHhzbDpmb3ItZWFjaCBzZWxlY3Q9ImRvY3VtZW50KCd4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54bWwnKS8vZWxlbSI+DQogICAgICAgICAgICAvLyB3aXRoIFhtbFVybFJlc29sdmVyIGl0IHNob3VsZCBiZSBhYmxlIHRvIG9wZW4gcmVmZXJlbmNlZCBmaWxlDQogICAgICAgICAgICBMb2FkWFNMKCJ4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54c2wiLCBpbnB1dFR5cGUsIHJlYWRlclR5cGUpOw0KICAgICAgICAgICAgQ2FsbFRyYW5zZm9ybSh4c2x0LCBGdWxsRmlsZVBhdGgoImZydWl0cy54bWwiKSwgX3N0ck91dEZpbGUsIG5ldyBYbWxVcmxSZXNvbHZlcigpKTsNCiAgICAgICAgICAgIFZlcmlmeVJlc3VsdChAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxyZXN1bHQ+MTIzPC9yZXN1bHQ+Iik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBUaGlzIHRlc3RjYXNlIGlzIGZvciBidWdzIDEwOTQyOSwgMTExMDc1IGFuZCAxMDk2NDQgZml4ZWQgaW4gRXZlcmV0dCBTUDENCiAgICAvL1tUZXN0Q2FzZShOYW1lID0gIk5EUDFfMVNQMSBCdWdzIChVUkksU1RSRUFNKSIsIERlc2MgPSAiVVJJLFNUUkVBTSIpXQ0KICAgIC8vW1Rlc3RDYXNlKE5hbWUgPSAiTkRQMV8xU1AxIEJ1Z3MgKE5BVklHQVRPUixURVhUV1JJVEVSKSIsIERlc2MgPSAiTkFWSUdBVE9SLFRFWFRXUklURVIiKV0NCiAgICBwdWJsaWMgY2xhc3MgQ05EUDFfMVNQMVRlc3QgOiBYc2x0QXBpVGVzdENhc2VCYXNlDQogICAgew0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQogICAgICAgIHB1YmxpYyBDTkRQMV8xU1AxVGVzdChJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpIDogYmFzZShvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvY2FsIHBhcmFtZXRlciBnZXRzIG92ZXJ3cml0dGVuIHdpdGggZ2xvYmFsIHBhcmFtIHZhbHVlIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2YXIxKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PG91dD4NCnBhcmFtMSAoY29ycmVjdCBhbnN3ZXIgaXMgJ2xvY2FsLXBhcmFtMS1hcmcnKTogbG9jYWwtcGFyYW0xLWFyZw0KcGFyYW0yIChjb3JyZWN0IGFuc3dlciBpcyAnbG9jYWwtcGFyYW0yLWFyZycpOiBsb2NhbC1wYXJhbTItYXJnDQo8L291dD4iOw0KDQogICAgICAgICAgICBtX3hzbHRBcmcgPSBuZXcgWHNsdEFyZ3VtZW50TGlzdCgpOw0KICAgICAgICAgICAgbV94c2x0QXJnLkFkZFBhcmFtKCJwYXJhbTEiLCBzdHJpbmcuRW1wdHksICJnbG9iYWwtcGFyYW0xLWFyZyIpOw0KDQogICAgICAgICAgICBpZiAoKExvYWRYU0woInBhcmFtU2NvcGUueHNsIiwgaW5wdXRUeXBlLCByZWFkZXJUeXBlKSA9PSAxKSAmJiAoVHJhbnNmb3JtX0FyZ0xpc3QoImZydWl0cy54bWwiLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKSA9PSAxKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL1tWYXJpYXRpb24oIkxvY2FsIHBhcmFtZXRlciBnZXRzIG92ZXJ3cml0dGVuIHdpdGggZ2xvYmFsIHZhcmlhYmxlIHZhbHVlIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2YXIyKElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+PG91dD4NCnBhcmFtMSAoY29ycmVjdCBhbnN3ZXIgaXMgJ2xvY2FsLXBhcmFtMS1hcmcnKTogbG9jYWwtcGFyYW0xLWFyZw0KcGFyYW0yIChjb3JyZWN0IGFuc3dlciBpcyAnbG9jYWwtcGFyYW0yLWFyZycpOiBsb2NhbC1wYXJhbTItYXJnDQo8L291dD4iOw0KDQogICAgICAgICAgICBtX3hzbHRBcmcgPSBuZXcgWHNsdEFyZ3VtZW50TGlzdCgpOw0KICAgICAgICAgICAgbV94c2x0QXJnLkFkZFBhcmFtKCJwYXJhbTEiLCBzdHJpbmcuRW1wdHksICJnbG9iYWwtcGFyYW0xLWFyZyIpOw0KDQogICAgICAgICAgICBpZiAoKExvYWRYU0woInZhclNjb3BlLnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkgJiYgKFRyYW5zZm9ybV9BcmdMaXN0KCJmcnVpdHMueG1sIiwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSkgPT0gMSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVmVyaWZ5UmVzdWx0KGV4cGVjdGVkKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgQXNzZXJ0LlRydWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJTdWJjbGFzc2VkIFhQYXRoTm9kZUl0ZXJhdG9yIHJldHVybmVkIGZyb20gYW4gZXh0ZW5zaW9uIG9iamVjdCBvciBYc2x0RnVuY3Rpb24gaXMgbm90IGFjY2VwdGVkIGJ5IFhQYXRoIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCBUQ19YUGF0aE5vZGVJdGVyYXRvcl9Gcm9tX0V4dGVuc2lvbk9iamVjdChJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBtX3hzbHRBcmcgPSBuZXcgWHNsdEFyZ3VtZW50TGlzdCgpOw0KICAgICAgICAgICAgbV94c2x0QXJnLkFkZEV4dGVuc2lvbk9iamVjdCgiaHR0cDovL2Zvby5jb20iLCBuZXcgTXlYc2x0RXh0ZW5zaW9uKCkpOw0KICAgICAgICAgICAgTG9hZFhTTCgiQnVnMTExMDc1LnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSk7DQogICAgICAgICAgICBUcmFuc2Zvcm1fQXJnTGlzdCgiQnVnMTExMDc1LnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpOw0KDQogICAgICAgICAgICBzdHJpbmcgZXhwZWN0ZWQgPSBAIjw/eG1sIHZlcnNpb249IiIxLjAiIiBlbmNvZGluZz0iInV0Zi04IiI/PjxkaXN0aW5jdC1jb3VudHJpZXM+QXVzdHJpYSwgRnJhbmNlLCBHZXJtYW55LCBTcGFpbjwvZGlzdGluY3QtY291bnRyaWVzPiI7DQogICAgICAgICAgICBWZXJpZnlSZXN1bHQoZXhwZWN0ZWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9bVmFyaWF0aW9uKCJJdGVyYXRvciB1c2luZyBmb3ItZWFjaCBvdmVyIGEgdmFyaWFibGUgaXMgbm90IHJlc2V0IGNvcnJlY3RseSB3aGlsZSB1c2luZyBtc3hzbDpub2RlLXNldCgpIiwgUHJpID0gMSldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5VUkksIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5TdHJlYW0sIERvY1R5cGUuWFBhdGhEb2N1bWVudCldDQogICAgICAgIFtJbmxpbmVEYXRhKElucHV0VHlwZS5OYXZpZ2F0b3IsIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlciwgVHJhbnNmb3JtVHlwZS5UZXh0V3JpdGVyLCBEb2NUeXBlLlhQYXRoRG9jdW1lbnQpXQ0KICAgICAgICBbVGhlb3J5XQ0KICAgICAgICBwdWJsaWMgdm9pZCB2YXI0KElucHV0VHlwZSBpbnB1dFR5cGUsIFJlYWRlclR5cGUgcmVhZGVyVHlwZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBleHBlY3RlZCA9IEAiPD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+DQoJCU5vZGUgQ291bnQ6IHszfQ0KDQoJCQ0KCQlDb3JyZWN0IE91dHB1dDogKDEpKDIpKDMpDQoJCUluY29ycmVjdCBPdXRwdXQ6IFsxXVsyXVszXSI7DQoNCiAgICAgICAgICAgIGlmICgoTG9hZFhTTCgiQnVnMTA5NjQ0LnhzbCIsIGlucHV0VHlwZSwgcmVhZGVyVHlwZSkgPT0gMSkgJiYgKFRyYW5zZm9ybSgiZm9vLnhtbCIsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpID09IDEpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5FcXVhbChleHBlY3RlZCwgRmlsZS5SZWFkQWxsVGV4dChfc3RyT3V0RmlsZSkpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpbnRlcm5hbCBzZWFsZWQgY2xhc3MgQWxsb3dEZWZhdWx0UmVzb2x2ZXJDb250ZXh0IDogSURpc3Bvc2FibGUNCiAgICB7DQogICAgICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIFN3aXRjaE5hbWUgPSAiU3dpdGNoLlN5c3RlbS5YbWwuQWxsb3dEZWZhdWx0UmVzb2x2ZXIiOw0KICAgICAgICBwdWJsaWMgQWxsb3dEZWZhdWx0UmVzb2x2ZXJDb250ZXh0KCkgPT4gQXBwQ29udGV4dC5TZXRTd2l0Y2goU3dpdGNoTmFtZSwgaXNFbmFibGVkOiB0cnVlKTsNCiAgICAgICAgcHVibGljIHZvaWQgRGlzcG9zZSgpID0+IEFwcENvbnRleHQuU2V0U3dpdGNoKFN3aXRjaE5hbWUsIGlzRW5hYmxlZDogZmFsc2UpOw0KICAgIH0NCg0KICAgIGludGVybmFsIGNsYXNzIE15QXJyYXlJdGVyYXRvciA6IFhQYXRoTm9kZUl0ZXJhdG9yDQogICAgew0KICAgICAgICBwcm90ZWN0ZWQgQXJyYXlMaXN0IGFycmF5Ow0KICAgICAgICBwcm90ZWN0ZWQgaW50IGluZGV4Ow0KDQogICAgICAgIHB1YmxpYyBNeUFycmF5SXRlcmF0b3IoQXJyYXlMaXN0IGFycmF5KQ0KICAgICAgICB7DQogICAgICAgICAgICB0aGlzLmFycmF5ID0gYXJyYXk7DQogICAgICAgICAgICB0aGlzLmluZGV4ID0gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBNeUFycmF5SXRlcmF0b3IoTXlBcnJheUl0ZXJhdG9yIGl0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0aGlzLmFycmF5ID0gaXQuYXJyYXk7DQogICAgICAgICAgICB0aGlzLmluZGV4ID0gaXQuaW5kZXg7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgWFBhdGhOb2RlSXRlcmF0b3IgQ2xvbmUoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gbmV3IE15QXJyYXlJdGVyYXRvcih0aGlzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIE1vdmVOZXh0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGluZGV4IDwgYXJyYXkuQ291bnQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaW5kZXgrKzsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBYUGF0aE5hdmlnYXRvciBDdXJyZW50DQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiAoaW5kZXggPiAwKSA/IChYUGF0aE5hdmlnYXRvcilhcnJheVtpbmRleCAtIDFdIDogbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgQ3VycmVudFBvc2l0aW9uDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgQ291bnQNCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5LkNvdW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgUmVzZXQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpbmRleCA9IDA7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBCVUdCVUc6IERDUiAxMDQ3NjANCiAgICAgICAgcHVibGljIG92ZXJyaWRlIElFbnVtZXJhdG9yIEdldEVudW1lcmF0b3IoKQ0KICAgICAgICB7DQogICAgICAgICAgICBNeUFycmF5SXRlcmF0b3IgaXQgPSAoTXlBcnJheUl0ZXJhdG9yKXRoaXMuQ2xvbmUoKTsNCiAgICAgICAgICAgIGl0LlJlc2V0KCk7DQogICAgICAgICAgICByZXR1cm4gKElFbnVtZXJhdG9yKWl0Ow0KICAgICAgICB9DQogICAgfQ0KDQogICAgaW50ZXJuYWwgY2xhc3MgTXlYc2x0RXh0ZW5zaW9uDQogICAgew0KICAgICAgICBwdWJsaWMgWFBhdGhOb2RlSXRlcmF0b3IgZGlzdGluY3QoWFBhdGhOb2RlSXRlcmF0b3Igbm9kZXNldCkNCiAgICAgICAgew0KICAgICAgICAgICAgSGFzaHRhYmxlIG5vZGVsaXN0ID0gbmV3IEhhc2h0YWJsZSgpOw0KICAgICAgICAgICAgd2hpbGUgKG5vZGVzZXQuTW92ZU5leHQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIW5vZGVsaXN0LkNvbnRhaW5zKG5vZGVzZXQuQ3VycmVudC5WYWx1ZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBub2RlbGlzdC5BZGQobm9kZXNldC5DdXJyZW50LlZhbHVlLCBub2Rlc2V0LkN1cnJlbnQuQ2xvbmUoKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG5ldyBNeUFycmF5SXRlcmF0b3IobmV3IEFycmF5TGlzdChub2RlbGlzdC5WYWx1ZXMpKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIFh1bml0Ow0KdXNpbmcgWHVuaXQuQWJzdHJhY3Rpb25zOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uWG1sLlhtbERpZmY7DQp1c2luZyBTeXN0ZW0uWG1sLlhQYXRoOw0KdXNpbmcgU3lzdGVtLlhtbC5Yc2w7DQp1c2luZyBYbWxDb3JlVGVzdC5Db21tb247DQoNCm5hbWVzcGFjZSBTeXN0ZW0uWG1sLlRlc3RzDQp7DQogICAgcHVibGljIGVudW0gVHJhbnNmb3JtVHlwZQ0KICAgIHsNCiAgICAgICAgUmVhZGVyLCBTdHJlYW0sIFdyaXRlciwgVGV4dFdyaXRlcg0KICAgIH0NCg0KICAgIHB1YmxpYyBlbnVtIElucHV0VHlwZQ0KICAgIHsNCiAgICAgICAgUmVhZGVyLCBVUkksIE5hdmlnYXRvcg0KICAgIH0NCg0KICAgIHB1YmxpYyBlbnVtIERvY1R5cGUNCiAgICB7DQogICAgICAgIFhtbERvY3VtZW50LCBYUGF0aERvY3VtZW50LCBVbmtub3duDQogICAgfQ0KDQogICAgcHVibGljIGVudW0gUmVhZGVyVHlwZQ0KICAgIHsNCiAgICAgICAgWG1sVGV4dFJlYWRlciwgWG1sTm9kZVJlYWRlciwgWG1sVmFsaWRhdGluZ1JlYWRlciwgWHNsdFJlYWRlciwgVW5rbm93bg0KICAgIH0NCg0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBNb2R1bGUgZGVjbGFyYXRpb24gZm9yIExUTSB1c2FnZQ0KICAgIC8vDQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KICAgIC8vW1Rlc3RNb2R1bGUoTmFtZSA9ICJYU0xUcmFuc2Zvcm0gQVBJIFRlc3RzIiwgRGVzYyA9ICJYU0xUcmFuc2Zvcm0gQVBJIFRlc3RzIiwgUHJpID0gMSldDQogICAgcHVibGljIGNsYXNzIFhTTFRyYW5zZm9ybU1vZHVsZQ0KICAgIHsNCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgLy8gQmFzZSBjbGFzcyBmb3IgdGVzdCBjYXNlcw0KICAgIC8vDQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KICAgIHB1YmxpYyBjbGFzcyBYc2x0QXBpVGVzdENhc2VCYXNlIDogRmlsZUNsZWFudXBUZXN0QmFzZQ0KICAgIHsNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBzdHJpbmcgWG1sUmVzb2x2ZXJEb2N1bWVudE5hbWUgPSAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb24ueG1sIjsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgc3RyaW5nIHNfdGVtcG9yYXJ5UmVzb2x2ZXJEb2N1bWVudEZ1bGxOYW1lID0gUGF0aC5Db21iaW5lKFBhdGguR2V0VGVtcFBhdGgoKSwgIlhzbFRyYW5zZm9ybUFwaSIsIFhtbFJlc29sdmVyRG9jdW1lbnROYW1lKTsNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgb2JqZWN0IHNfdGVtcG9yYXJ5UmVzb2x2ZXJEb2N1bWVudExvY2sgPSBuZXcgb2JqZWN0KCk7DQoNCiAgICAgICAgLy8gR2VuZXJpYyBkYXRhIGZvciBhbGwgZGVyaXZlZCB0ZXN0IGNhc2VzDQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pYc2xOUyA9ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0iOw0KDQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pEZWZhdWx0TlMgPSAidXJuOm15LW9iamVjdCI7DQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pFbXB0eSA9ICIiOw0KICAgICAgICBwdWJsaWMgU3RyaW5nIHN6SW52YWxpZCA9ICIqPyUoKVwwe31bXSYhQCMkIjsNCiAgICAgICAgcHVibGljIFN0cmluZyBzekxvbmdTdHJpbmcgPSAiVGhpc0lzQVZlcnlMb25nU3RyaW5nVG9CZVN0b3JlZEFzQVZhcmlhYmxlVG9EZXRlcm1pbmVIb3dMYXJnZVRoaXNCdWZmZXJGb3JBVmFyaWFibGVOYW1lQ2FuQmVBbmRTdGlsbEZ1bmN0aW9uQXNFeHBlY3RlZCI7DQogICAgICAgIHB1YmxpYyBTdHJpbmcgc3pMb25nTlMgPSAiaHR0cDovL3d3dy5taW9jcm9zb2Z0LmNvbS90aGlzL2lzL2EvdmVyeS9sb25nL25hbWVzcGFjZS91cmkvdG8vZG8vdGhlL2FwaS90ZXN0aW5nL2Zvci94c2x0LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LzAxMjM0NTY3ODkvMDEyMzQ1Njc4OS8wMTIzNDU2Nzg5LyI7DQogICAgICAgIHB1YmxpYyBTdHJpbmdbXSBzeldoaXRlU3BhY2UgPSB7ICIgICIsICJcbiIsICJcdCIsICJcciIsICJcdFxuICBcclx0IiB9Ow0KICAgICAgICBwdWJsaWMgU3RyaW5nIHN6U2ltcGxlID0gIm15QXJnIjsNCg0KICAgICAgICAvLyBWYXJpYWJsZXMgZnJvbSBpbml0IHN0cmluZw0KICAgICAgICBwcml2YXRlIHN0cmluZyBfc3RyUGF0aDsgICAgICAgICAgIC8vIFBhdGggb2YgdGhlIGRhdGEgZmlsZXMNCg0KICAgICAgICBwcml2YXRlIHN0cmluZyBfaHR0cFBhdGg7ICAgICAgICAgIC8vIEhUVFAgUGF0aCBvZiB0aGUgZGF0YSBmaWxlcw0KDQogICAgICAgIC8vIE90aGVyIGdsb2JhbCB2YXJpYWJsZXMNCiAgICAgICAgcHJvdGVjdGVkIHN0cmluZyBfc3RyT3V0RmlsZTsgICAgICAgIC8vIEZpbGUgdG8gY3JlYXRlIHdoZW4gdXNpbmcgd3JpdGUgdHJhbnNmb3Jtcw0KDQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgIHByb3RlY3RlZCBYc2xUcmFuc2Zvcm0geHNsdDsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNYWluIFhzbFRyYW5zZm9ybSBpbnN0YW5jZQ0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICBwcm90ZWN0ZWQgWG1sUmVhZGVyIHhyWFNMVDsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZm9yIFJFQURFUiB0cmFuc2Zvcm1zDQogICAgICAgIHByb3RlY3RlZCBYc2x0QXJndW1lbnRMaXN0IG1feHNsdEFyZzsgICAgICAgICAgICAgICAgICAgLy8gRm9yIFhzbHRBcmd1bWVudExpc3QgdGVzdHMNCiAgICAgICAgcHVibGljIG9iamVjdCByZXRPYmo7DQoNCiAgICAgICAgcHJvdGVjdGVkIGJvb2wgX2lzSW5Qcm9jOyAgICAgICAgICAvLyBJcyB0aGUgY3VycmVudCB0ZXN0IHJ1biBpbiBwcm9jIG9yIC9Ib3N0IE5vbmU/DQoNCiAgICAgICAgcHJpdmF0ZSBJVGVzdE91dHB1dEhlbHBlciBfb3V0cHV0Ow0KDQogICAgICAgIHN0YXRpYyBYc2x0QXBpVGVzdENhc2VCYXNlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gT24gdWFwIGFjY2VzcyBpcyBkZW5pZWQgdG8gZnVsbCBwYXRoIGFuZCB0aGUgY29kZSBiZWxvdyBhbmQgcmVsYXRlZCB0ZXN0cyBjYW5ub3QgcnVuDQogICAgICAgICAgICBpZiAoIVBsYXRmb3JtRGV0ZWN0aW9uLklzVWFwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIERpcmVjdG9yeS5DcmVhdGVEaXJlY3RvcnkoUGF0aC5HZXREaXJlY3RvcnlOYW1lKHNfdGVtcG9yYXJ5UmVzb2x2ZXJEb2N1bWVudEZ1bGxOYW1lKSk7DQoNCiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGFic29sdXRlIFVSSSBpbiB4bWxSZXNvbHZlcl9kb2N1bWVudF9mdW5jdGlvbi54bWwgYmFzZWQgb24gdGhlIGVudmlyb25tZW50DQogICAgICAgICAgICAgICAgc3RyaW5nIHhzbEZpbGUgPSBQYXRoLkNvbWJpbmUoIlRlc3RGaWxlcyIsIEZpbGVQYXRoVXRpbC5HZXRUZXN0RGF0YVBhdGgoKSwgIlhzbHRBcGkiLCAieG1sUmVzb2x2ZXJfZG9jdW1lbnRfZnVuY3Rpb25fYWJzb2x1dGVfdXJpLnhzbCIpOw0KICAgICAgICAgICAgICAgIFhtbERvY3VtZW50IGRvYyA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgIGRvYy5Mb2FkKHhzbEZpbGUpOw0KICAgICAgICAgICAgICAgIHN0cmluZyB4c2xTdHJpbmcgPSBkb2MuT3V0ZXJYbWwuUmVwbGFjZSgiQUJTT0xVVEVfVVJJIiwgc190ZW1wb3JhcnlSZXNvbHZlckRvY3VtZW50RnVsbE5hbWUpOw0KICAgICAgICAgICAgICAgIGRvYy5Mb2FkWG1sKHhzbFN0cmluZyk7DQogICAgICAgICAgICAgICAgZG9jLlNhdmUoeHNsRmlsZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgWHNsdEFwaVRlc3RDYXNlQmFzZShJVGVzdE91dHB1dEhlbHBlciBvdXRwdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHdlIGRvbid0IGNhY2hlIHRoZSB2YWx1ZSBvZiB0aGUgc3dpdGNoIHRvIGVuYWJsZSB0ZXN0aW5nDQogICAgICAgICAgICBBcHBDb250ZXh0LlNldFN3aXRjaCgiVGVzdFN3aXRjaC5Mb2NhbEFwcENvbnRleHQuRGlzYWJsZUNhY2hpbmciLCB0cnVlKTsNCiAgICAgICAgICAgIF9vdXRwdXQgPSBvdXRwdXQ7DQogICAgICAgICAgICBfc3RyT3V0RmlsZSA9IEdldFRlc3RGaWxlUGF0aCgpOw0KICAgICAgICAgICAgdGhpcy5Jbml0KG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgVGVzdFVzaW5nVGVtcG9yYXJ5Q29weU9mUmVzb2x2ZXJEb2N1bWVudChBY3Rpb24gdGVzdEFjdGlvbikNCiAgICAgICAgew0KICAgICAgICAgICAgbG9jayAoc190ZW1wb3JhcnlSZXNvbHZlckRvY3VtZW50TG9jaykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEZpbGUuQ29weShGdWxsRmlsZVBhdGgoWG1sUmVzb2x2ZXJEb2N1bWVudE5hbWUpLCBzX3RlbXBvcmFyeVJlc29sdmVyRG9jdW1lbnRGdWxsTmFtZSwgb3ZlcndyaXRlOiB0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgdGVzdEFjdGlvbigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoRmlsZS5FeGlzdHMoc190ZW1wb3JhcnlSZXNvbHZlckRvY3VtZW50RnVsbE5hbWUpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgRmlsZS5EZWxldGUoc190ZW1wb3JhcnlSZXNvbHZlckRvY3VtZW50RnVsbE5hbWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBUcmFuc2Zvcm1UeXBlIEdldFRyYW5zZm9ybVR5cGUoU3RyaW5nIHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChzLkVuZHNXaXRoKCIsUkVBREVSIikpDQogICAgICAgICAgICAgICAgcmV0dXJuIFRyYW5zZm9ybVR5cGUuUmVhZGVyOw0KDQogICAgICAgICAgICBpZiAocy5FbmRzV2l0aCgiLFNUUkVBTSIpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBUcmFuc2Zvcm1UeXBlLlN0cmVhbTsNCg0KICAgICAgICAgICAgaWYgKHMuRW5kc1dpdGgoIixXUklURVIiKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJhbnNmb3JtVHlwZS5Xcml0ZXI7DQoNCiAgICAgICAgICAgIGlmIChzLkVuZHNXaXRoKCIsVEVYVFdSSVRFUiIpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXI7DQoNCiAgICAgICAgICAgIC8vIFRyYW5zZm9ybVR5cGUgbm90IG5lY2Vzc2FyeSwgdXNpbmcgZGVmYXVsdA0KICAgICAgICAgICAgcmV0dXJuIFRyYW5zZm9ybVR5cGUuU3RyZWFtOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIFhtbFVybFJlc29sdmVyIEdldERlZmF1bHRDcmVkUmVzb2x2ZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBYbWxVcmxSZXNvbHZlciBteURlZmF1bHRDcmVkUmVzb2x2ZXIgPSBuZXcgWG1sVXJsUmVzb2x2ZXIoKTsNCg0KICAgICAgICAgICAgcmV0dXJuIG15RGVmYXVsdENyZWRSZXNvbHZlcjsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBJbnB1dFR5cGUgR2V0SW5wdXRUeXBlKFN0cmluZyBzKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAocy5TdGFydHNXaXRoKCJSRUFERVIsIikpDQogICAgICAgICAgICAgICAgcmV0dXJuIElucHV0VHlwZS5SZWFkZXI7DQogICAgICAgICAgICBpZiAocy5TdGFydHNXaXRoKCJVUkksIikpDQogICAgICAgICAgICAgICAgcmV0dXJuIElucHV0VHlwZS5VUkk7DQogICAgICAgICAgICBpZiAocy5TdGFydHNXaXRoKCJOQVZJR0FUT1IsIikpDQogICAgICAgICAgICAgICAgcmV0dXJuIElucHV0VHlwZS5OYXZpZ2F0b3I7DQoNCiAgICAgICAgICAgIC8vIElucHV0IFR5cGUgbm90IG5lY2Vzc2FyeSwgdXNpbmcgZGVmYXVsdA0KICAgICAgICAgICAgcmV0dXJuIElucHV0VHlwZS5VUkk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgRG9jVHlwZSBHZXREb2NUeXBlKFN0cmluZyBzKQ0KICAgICAgICB7DQogICAgICAgICAgICBzd2l0Y2ggKHMuVG9VcHBlcigpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgIlhQQVRIRE9DVU1FTlQiOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRG9jVHlwZS5YUGF0aERvY3VtZW50Ow0KDQogICAgICAgICAgICAgICAgY2FzZSAiWE1MRE9DVU1FTlQiOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRG9jVHlwZS5YbWxEb2N1bWVudDsNCg0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6IC8vIERvY1R5cGUgVHlwZSBub3QgaW1wb3J0YW50LCB1c2luZyBkZWZhdWx0DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBEb2NUeXBlLlhQYXRoRG9jdW1lbnQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgUmVhZGVyVHlwZSBHZXRSZWFkZXJUeXBlKFN0cmluZyBzKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL1htbFRleHRSZWFkZXIsIFhtbE5vZGVSZWFkZXIsIFhtbFZhbGlkYXRpbmdSZWFkZXIsIFhzbHRSZWFkZXINCg0KICAgICAgICAgICAgc3dpdGNoIChzLlRvVXBwZXIoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlICJYTUxURVhUUkVBREVSIjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWRlclR5cGUuWG1sVGV4dFJlYWRlcjsNCg0KICAgICAgICAgICAgICAgIGNhc2UgIlhNTE5PREVSRUFERVIiOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVhZGVyVHlwZS5YbWxOb2RlUmVhZGVyOw0KDQogICAgICAgICAgICAgICAgY2FzZSAiWE1MVkFMSURBVElOR1JFQURFUiI6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXI7DQoNCiAgICAgICAgICAgICAgICBjYXNlICJYU0xUUkVBREVSIjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWRlclR5cGUuWHNsdFJlYWRlcjsNCg0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6IC8vIFJlYWRlclR5cGUgVHlwZSBub3QgaW1wb3J0YW50LCB1c2luZyBkZWZhdWx0DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWFkZXJUeXBlLlhtbFZhbGlkYXRpbmdSZWFkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdm9pZCBJbml0KG9iamVjdCBvYmpQYXJhbSkNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gRnVsbEZpbGVQYXRoIGFuZCBGdWxsSHR0cFBhdGggYXR0ZW1wdCB0byBub3JtYWxpemUgZmlsZSBwYXRocywgaG93ZXZlcg0KICAgICAgICAgICAgLy8gYXMgYW4gZXh0cmEgc3RlcCB3ZSBjYW4gbm9ybWFsaXplIHRoZW0gaGVyZSwgd2hlbiB0aGV5IGFyZSBmaXJzdCByZWFkDQogICAgICAgICAgICAvLyBmcm9tIHRoZSBMVE0gZmlsZS4NCiAgICAgICAgICAgIF9zdHJQYXRoID0gUGF0aC5Db21iaW5lKCJUZXN0RmlsZXMiLCBGaWxlUGF0aFV0aWwuR2V0VGVzdERhdGFQYXRoKCksICJYc2x0QXBpIik7DQogICAgICAgICAgICBfaHR0cFBhdGggPSBGaWxlUGF0aFV0aWwuR2V0SHR0cFRlc3REYXRhUGF0aCgpICsgQCIvWHNsdEFwaS8iOw0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXR1cm5zIHRoZSBmdWxsIHBhdGggb2YgYSBmaWxlLCBiYXNlZCBvbiBMVE0gcGFyYW1ldGVycw0KICAgICAgICBwdWJsaWMgU3RyaW5nIEZ1bGxGaWxlUGF0aChTdHJpbmcgc3pGaWxlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gRnVsbEZpbGVQYXRoKHN6RmlsZSwgZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmV0dXJucyB0aGUgZnVsbCwgbG93ZXItY2FzZWQgcGF0aCBvZiBhIGZpbGUsIGJhc2VkIG9uIExUTSBwYXJhbWV0ZXJzDQogICAgICAgIHB1YmxpYyBTdHJpbmcgRnVsbEZpbGVQYXRoKFN0cmluZyBzekZpbGUsIGJvb2wgbm9ybWFsaXplVG9Mb3dlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHN6RmlsZSA9PSBudWxsIHx8IHN6RmlsZSA9PSBTdHJpbmcuRW1wdHkpDQogICAgICAgICAgICAgICAgcmV0dXJuIHN6RmlsZTsNCiAgICAgICAgICAgIC8vIHdoeSBpcyB0aGlzIGNoZWNrIGhlcmU/DQogICAgICAgICAgICBpZiAoc3pGaWxlLkxlbmd0aCA+IDUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHN6RmlsZS5TdWJzdHJpbmcoMCwgNSkgIT0gImh0dHA6IikNCiAgICAgICAgICAgICAgICAgICAgc3pGaWxlID0gUGF0aC5Db21iaW5lKF9zdHJQYXRoLCBzekZpbGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZVRvTG93ZXIpDQogICAgICAgICAgICAgICAgcmV0dXJuIHN6RmlsZS5Ub0xvd2VyKCk7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIHN6RmlsZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFJldHVybnMgdGhlIGZ1bGwsIGxvd2VyLWNhc2VkIGh0dHAgcGF0aCBvZiBhIGZpbGUsIGJhc2VkIG9uIExUTSBwYXJhbWV0ZXJzDQogICAgICAgIHB1YmxpYyBTdHJpbmcgRnVsbEh0dHBQYXRoKFN0cmluZyBzekZpbGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChzekZpbGUgPT0gbnVsbCB8fCBzekZpbGUgPT0gU3RyaW5nLkVtcHR5KQ0KICAgICAgICAgICAgICAgIHJldHVybiBzekZpbGU7DQoNCiAgICAgICAgICAgIHN6RmlsZSA9IF9odHRwUGF0aCArIHN6RmlsZTsNCg0KICAgICAgICAgICAgcmV0dXJuIHN6RmlsZS5Ub0xvd2VyKCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgQ2hlY2tFeHBlY3RlZEVycm9yDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyB2b2lkIENoZWNrRXhwZWN0ZWRFcnJvcihFeGNlcHRpb24gZXgsIHN0cmluZyBhc3NlbWJseSwgc3RyaW5nIHJlcywgc3RyaW5nW10gc3RyUGFyYW1zKQ0KICAgICAgICB7DQogICAgICAgICAgICBDRXhjZXB0aW9uSGFuZGxlciBoYW5kbGVyID0gbmV3IENFeGNlcHRpb25IYW5kbGVyKFBhdGguQ29tYmluZShfc3RyUGF0aCwgIkV4Y2VwdGlvbnMueG1sIiksIGFzc2VtYmx5LCBfb3V0cHV0KTsNCiAgICAgICAgICAgIGlmICghaGFuZGxlci5WZXJpZnlFeGNlcHRpb24oZXgsIHJlcywgc3RyUGFyYW1zKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBc3NlcnQuVHJ1ZShmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgQ2hlY2tFeHBlY3RlZEVycm9yDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyB2b2lkIENoZWNrRXhwZWN0ZWRFcnJvcihFeGNlcHRpb24gZXgsIHN0cmluZyBhc3NlbWJseSwgc3RyaW5nIHJlcywgc3RyaW5nW10gc3RyUGFyYW1zLCBMaW5lSW5mbyBsSW5mbykNCiAgICAgICAgew0KICAgICAgICAgICAgQ0V4Y2VwdGlvbkhhbmRsZXIgaGFuZGxlciA9IG5ldyBDRXhjZXB0aW9uSGFuZGxlcihQYXRoLkNvbWJpbmUoX3N0clBhdGgsICJFeGNlcHRpb25zLnhtbCIpLCBhc3NlbWJseSwgX291dHB1dCk7DQogICAgICAgICAgICBpZiAoIWhhbmRsZXIuVmVyaWZ5RXhjZXB0aW9uKGV4LCByZXMsIHN0clBhcmFtcywgbEluZm8pKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vICBMb2FkWE1MDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBJWFBhdGhOYXZpZ2FibGUgTG9hZFhNTChTdHJpbmcgc3RyRmlsZUxvY2F0aW9uLCBEb2NUeXBlIF9kb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBzd2l0Y2ggKF9kb2NUeXBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgRG9jVHlwZS5YbWxEb2N1bWVudDoNCiAgICAgICAgICAgICAgICAgICAgWG1sRG9jdW1lbnQgeG1sRG9jdW1lbnQgPSBuZXcgWG1sRG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgeG1sRG9jdW1lbnQuTG9hZChzdHJGaWxlTG9jYXRpb24pOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gKElYUGF0aE5hdmlnYWJsZSl4bWxEb2N1bWVudDsNCg0KICAgICAgICAgICAgICAgIGNhc2UgRG9jVHlwZS5YUGF0aERvY3VtZW50Og0KICAgICAgICAgICAgICAgICAgICBYUGF0aERvY3VtZW50IHhQYXRoRG9jdW1lbnQgPSBuZXcgWFBhdGhEb2N1bWVudChzdHJGaWxlTG9jYXRpb24pOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gKElYUGF0aE5hdmlnYWJsZSl4UGF0aERvY3VtZW50Ow0KDQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgTG9hZFhTTA0KICAgICAgICAvLyAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgaW50IExvYWRYU0woc3RyaW5nIF9zdHJYc2xGaWxlLCBJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9zdHJYc2xGaWxlID0gRnVsbEZpbGVQYXRoKF9zdHJYc2xGaWxlKTsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsVHJhbnNmb3JtKCk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQoNCiAgICAgICAgICAgIHN3aXRjaCAoaW5wdXRUeXBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgSW5wdXRUeXBlLlVSSToNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgc3R5bGUgc2hlZXQgYXMgVVJJIHswfSIsIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBjYXNlIElucHV0VHlwZS5SZWFkZXI6DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocmVhZGVyVHlwZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBSZWFkZXJUeXBlLlhtbFRleHRSZWFkZXI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sVGV4dFJlYWRlciB0clRlbXAgPSBuZXcgWG1sVGV4dFJlYWRlcihfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBYbWxUZXh0UmVhZGVyIHswfSIsIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKHRyVGVtcCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJUZW1wICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0clRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBSZWFkZXJUeXBlLlhtbE5vZGVSZWFkZXI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sRG9jdW1lbnQgZG9jVGVtcCA9IG5ldyBYbWxEb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY1RlbXAuTG9hZChfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sTm9kZVJlYWRlciBuclRlbXAgPSBuZXcgWG1sTm9kZVJlYWRlcihkb2NUZW1wKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJMb2FkaW5nIHN0eWxlIHNoZWV0IGFzIFhtbE5vZGVSZWFkZXIgezB9IiwgX3N0clhzbEZpbGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2x0LkxvYWQobnJUZW1wKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IChleCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuclRlbXAgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5yVGVtcC5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sVmFsaWRhdGluZ1JlYWRlciB2clRlbXAgPSBuZXcgWG1sVmFsaWRhdGluZ1JlYWRlcihuZXcgWG1sVGV4dFJlYWRlcihfc3RyWHNsRmlsZSkpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyVGVtcC5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLk5vbmU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJUZW1wLkVudGl0eUhhbmRsaW5nID0gRW50aXR5SGFuZGxpbmcuRXhwYW5kRW50aXRpZXM7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBYbWxWYWxpZGF0aW5nUmVhZGVyIHswfSIsIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKHZyVGVtcCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodnJUZW1wICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2clRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIGNhc2UgSW5wdXRUeXBlLk5hdmlnYXRvcjoNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgICAgICAgICAgWG1sVmFsaWRhdGluZ1JlYWRlciB4ckxvYWQgPSBuZXcgWG1sVmFsaWRhdGluZ1JlYWRlcihuZXcgWG1sVGV4dFJlYWRlcihfc3RyWHNsRmlsZSkpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgICAgICAgICB4ckxvYWQuVmFsaWRhdGlvblR5cGUgPSBWYWxpZGF0aW9uVHlwZS5Ob25lOw0KICAgICAgICAgICAgICAgICAgICBYUGF0aERvY3VtZW50IHhkVGVtcCA9IG5ldyBYUGF0aERvY3VtZW50KHhyTG9hZCwgWG1sU3BhY2UuUHJlc2VydmUpOw0KICAgICAgICAgICAgICAgICAgICB4ckxvYWQuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBOYXZpZ2F0b3IgezB9IiwgX3N0clhzbEZpbGUpOw0KICAgICAgICAgICAgICAgICAgICB4c2x0LkxvYWQoeGRUZW1wKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vICBMb2FkWFNMX1Jlc29sdmVyDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBpbnQgTG9hZFhTTF9SZXNvbHZlcihzdHJpbmcgX3N0clhzbEZpbGUsIFhtbFJlc29sdmVyIHhyLCBJbnB1dFR5cGUgaW5wdXRUeXBlLCBSZWFkZXJUeXBlIHJlYWRlclR5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIF9zdHJYc2xGaWxlID0gRnVsbEZpbGVQYXRoKF9zdHJYc2xGaWxlKTsNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgICAgIHhzbHQgPSBuZXcgWHNsVHJhbnNmb3JtKCk7DQojcHJhZ21hIHdhcm5pbmcgcmVzdG9yZSAwNjE4DQoNCiAgICAgICAgICAgIHN3aXRjaCAoaW5wdXRUeXBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgSW5wdXRUeXBlLlVSSToNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgc3R5bGUgc2hlZXQgYXMgVVJJIHswfSIsIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKF9zdHJYc2xGaWxlLCB4cik7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgY2FzZSBJbnB1dFR5cGUuUmVhZGVyOg0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlYWRlclR5cGUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUmVhZGVyVHlwZS5YbWxUZXh0UmVhZGVyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhtbFRleHRSZWFkZXIgdHJUZW1wID0gbmV3IFhtbFRleHRSZWFkZXIoX3N0clhzbEZpbGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgc3R5bGUgc2hlZXQgYXMgWG1sVGV4dFJlYWRlciB7MH0iLCBfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzbHQuTG9hZCh0clRlbXAsIHhyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IChleCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0clRlbXAgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyVGVtcC5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJlYWRlclR5cGUuWG1sTm9kZVJlYWRlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxEb2N1bWVudCBkb2NUZW1wID0gbmV3IFhtbERvY3VtZW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jVGVtcC5Mb2FkKF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBYbWxOb2RlUmVhZGVyIG5yVGVtcCA9IG5ldyBYbWxOb2RlUmVhZGVyKGRvY1RlbXApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgc3R5bGUgc2hlZXQgYXMgWG1sTm9kZVJlYWRlciB7MH0iLCBfc3RyWHNsRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzbHQuTG9hZChuclRlbXAsIHhyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IChleCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuclRlbXAgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5yVGVtcC5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJlYWRlclR5cGUuWG1sVmFsaWRhdGluZ1JlYWRlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWG1sVmFsaWRhdGluZ1JlYWRlciB2clRlbXAgPSBuZXcgWG1sVmFsaWRhdGluZ1JlYWRlcihuZXcgWG1sVGV4dFJlYWRlcihfc3RyWHNsRmlsZSkpOw0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyVGVtcC5WYWxpZGF0aW9uVHlwZSA9IFZhbGlkYXRpb25UeXBlLk5vbmU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJUZW1wLkVudGl0eUhhbmRsaW5nID0gRW50aXR5SGFuZGxpbmcuRXhwYW5kRW50aXRpZXM7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb3V0cHV0LldyaXRlTGluZSgiTG9hZGluZyBzdHlsZSBzaGVldCBhcyBYbWxWYWxpZGF0aW5nUmVhZGVyIHswfSIsIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKHZyVGVtcCwgeHIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZyVGVtcCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJUZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICBjYXNlIElucHV0VHlwZS5OYXZpZ2F0b3I6DQojcHJhZ21hIHdhcm5pbmcgZGlzYWJsZSAwNjE4DQogICAgICAgICAgICAgICAgICAgIFhtbFZhbGlkYXRpbmdSZWFkZXIgeHJMb2FkID0gbmV3IFhtbFZhbGlkYXRpbmdSZWFkZXIobmV3IFhtbFRleHRSZWFkZXIoX3N0clhzbEZpbGUpKTsNCiNwcmFnbWEgd2FybmluZyByZXN0b3JlIDA2MTgNCiAgICAgICAgICAgICAgICAgICAgWFBhdGhEb2N1bWVudCB4ZFRlbXAgPSBuZXcgWFBhdGhEb2N1bWVudCh4ckxvYWQsIFhtbFNwYWNlLlByZXNlcnZlKTsNCiAgICAgICAgICAgICAgICAgICAgeHJMb2FkLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgc3R5bGUgc2hlZXQgYXMgTmF2aWdhdG9yIHswfSIsIF9zdHJYc2xGaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgeHNsdC5Mb2FkKHhkVGVtcCwgeHIpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9WZXJpZnlSZXN1bHQNCiAgICAgICAgcHVibGljIHZvaWQgVmVyaWZ5UmVzdWx0KHN0cmluZyBleHBlY3RlZFZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICBsb2NrKHNfb3V0RmlsZU1lbW9yeUxvY2spDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgWG1sRGlmZi5YbWxEaWZmIHhtbGRpZmYgPSBuZXcgWG1sRGlmZi5YbWxEaWZmKCk7DQogICAgICAgICAgICAgICAgeG1sZGlmZi5PcHRpb24gPSBYbWxEaWZmT3B0aW9uLkluZm9zZXRDb21wYXJpc29uIHwgWG1sRGlmZk9wdGlvbi5JZ25vcmVFbXB0eUVsZW1lbnQgfCBYbWxEaWZmT3B0aW9uLk5vcm1hbGl6ZU5ld2xpbmU7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgc3RyaW5nIGFjdHVhbFZhbHVlID0gRmlsZS5SZWFkQWxsVGV4dChfc3RyT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy9PdXRwdXQgdGhlIGV4cGVjdGVkIGFuZCBhY3R1YWwgdmFsdWVzDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4cGVjdGVkIDogIiArIGV4cGVjdGVkVmFsdWUpOw0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJBY3R1YWwgOiAiICsgYWN0dWFsVmFsdWUpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGJvb2wgcmVzdWx0Ow0KDQogICAgICAgICAgICAgICAgLy9Mb2FkIGludG8gWG1sVGV4dFJlYWRlcnMNCiAgICAgICAgICAgICAgICB1c2luZyAoWG1sVGV4dFJlYWRlciB0cjEgPSBuZXcgWG1sVGV4dFJlYWRlcihfc3RyT3V0RmlsZSkpDQogICAgICAgICAgICAgICAgdXNpbmcgKFhtbFRleHRSZWFkZXIgdHIyID0gbmV3IFhtbFRleHRSZWFkZXIobmV3IFN0cmluZ1JlYWRlcihleHBlY3RlZFZhbHVlKSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB4bWxkaWZmLkNvbXBhcmUodHIxLCB0cjIpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIEFzc2VydC5UcnVlKHJlc3VsdCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgVHJhbnNmb3JtDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgb2JqZWN0IHNfb3V0RmlsZU1lbW9yeUxvY2sgPSBuZXcgb2JqZWN0KCk7DQoNCiNwcmFnbWEgd2FybmluZyBkaXNhYmxlIDA2MTgNCiAgICAgICAgcHVibGljIHZvaWQgQ2FsbFRyYW5zZm9ybShYc2xUcmFuc2Zvcm0geHNsdCwgU3RyaW5nIHN6RnVsbEZpbGVuYW1lLCBTdHJpbmcgX3N0ck91dEZpbGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIGxvY2sgKHNfb3V0RmlsZU1lbW9yeUxvY2spDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oc3pGdWxsRmlsZW5hbWUsIF9zdHJPdXRGaWxlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2b2lkIENhbGxUcmFuc2Zvcm0oWHNsVHJhbnNmb3JtIHhzbHQsIFN0cmluZyBzekZ1bGxGaWxlbmFtZSwgU3RyaW5nIF9zdHJPdXRGaWxlLCBYbWxSZXNvbHZlciByZXNvbHZlcikNCiAgICAgICAgew0KICAgICAgICAgICAgbG9jayAoc19vdXRGaWxlTWVtb3J5TG9jaykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybShzekZ1bGxGaWxlbmFtZSwgX3N0ck91dEZpbGUsIHJlc29sdmVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KI3ByYWdtYSB3YXJuaW5nIHJlc3RvcmUgMDYxOA0KDQogICAgICAgIHB1YmxpYyBpbnQgVHJhbnNmb3JtKHN0cmluZyBzelhtbEZpbGUsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBEZWZhdWx0IHZhbHVlIG9mIGVycm9yQ2FzZSBpcyBmYWxzZQ0KICAgICAgICAgICAgcmV0dXJuIFRyYW5zZm9ybShzelhtbEZpbGUsIGZhbHNlLCB0cmFuc2Zvcm1UeXBlLCBkb2NUeXBlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBpbnQgVHJhbnNmb3JtKHN0cmluZyBzelhtbEZpbGUsIGJvb2wgZXJyb3JDYXNlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgbG9jayAoc19vdXRGaWxlTWVtb3J5TG9jaykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzelhtbEZpbGUgPSBGdWxsRmlsZVBhdGgoc3pYbWxGaWxlKTsNCg0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJMb2FkaW5nIFhNTCB7MH0iLCBzelhtbEZpbGUpOw0KICAgICAgICAgICAgICAgIElYUGF0aE5hdmlnYWJsZSB4ZCA9IExvYWRYTUwoc3pYbWxGaWxlLCBkb2NUeXBlKTsNCg0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGVjdXRpbmcgdHJhbnNmb3JtIik7DQogICAgICAgICAgICAgICAgeHJYU0xUID0gbnVsbDsNCiAgICAgICAgICAgICAgICBTdHJlYW0gc3RybVRlbXAgPSBudWxsOw0KICAgICAgICAgICAgICAgIHN3aXRjaCAodHJhbnNmb3JtVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgVHJhbnNmb3JtVHlwZS5SZWFkZXI6DQogICAgICAgICAgICAgICAgICAgICAgICB4clhTTFQgPSB4c2x0LlRyYW5zZm9ybSh4ZCwgbnVsbCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nIChGaWxlU3RyZWFtIG91dEZpbGUgPSBuZXcgRmlsZVN0cmVhbShfc3RyT3V0RmlsZSwgRmlsZU1vZGUuQ3JlYXRlLCBGaWxlQWNjZXNzLlJlYWRXcml0ZSkpDQogICAgICAgICAgICAgICAgICAgICAgICB1c2luZyAoWG1sV3JpdGVyIHdyaXRlciA9IFhtbFdyaXRlci5DcmVhdGUob3V0RmlsZSkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlTm9kZSh4clhTTFQsIHRydWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JDYXNlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHhyWFNMVC5SZWFkKCkpIHsgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhyWFNMVCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHJYU0xULkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFRyYW5zZm9ybVR5cGUuU3RyZWFtOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RybVRlbXAgPSBuZXcgRmlsZVN0cmVhbShfc3RyT3V0RmlsZSwgRmlsZU1vZGUuQ3JlYXRlLCBGaWxlQWNjZXNzLlJlYWRXcml0ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeGQsIG51bGwsIHN0cm1UZW1wKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RybVRlbXAgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RybVRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBUcmFuc2Zvcm1UeXBlLldyaXRlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFdyaXRlciB4dyA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dyA9IG5ldyBYbWxUZXh0V3JpdGVyKF9zdHJPdXRGaWxlLCBFbmNvZGluZy5VVEY4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dy5Xcml0ZVN0YXJ0RG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbnVsbCwgeHcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4dyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dy5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRXcml0ZXIgdHcgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEZpbGVTdHJlYW0gb3V0RmlsZSA9IG5ldyBGaWxlU3RyZWFtKF9zdHJPdXRGaWxlLCBGaWxlTW9kZS5DcmVhdGUsIEZpbGVBY2Nlc3MuV3JpdGUpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHcgPSBuZXcgU3RyZWFtV3JpdGVyKG91dEZpbGUsIEVuY29kaW5nLlVURjgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbnVsbCwgdHcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vICBUcmFuc2Zvcm1fQXJnTGlzdA0KICAgICAgICAvLyAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQogICAgICAgIHB1YmxpYyBpbnQgVHJhbnNmb3JtX0FyZ0xpc3Qoc3RyaW5nIHN6WG1sRmlsZSwgVHJhbnNmb3JtVHlwZSB0cmFuc2Zvcm1UeXBlLCBEb2NUeXBlIGRvY1R5cGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIERlZmF1bHQgdmFsdWUgb2YgZXJyb3JDYXNlIGlzIGZhbHNlDQogICAgICAgICAgICByZXR1cm4gVHJhbnNmb3JtX0FyZ0xpc3Qoc3pYbWxGaWxlLCBmYWxzZSwgdHJhbnNmb3JtVHlwZSwgZG9jVHlwZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgaW50IFRyYW5zZm9ybV9BcmdMaXN0KHN0cmluZyBzelhtbEZpbGUsIGJvb2wgZXJyb3JDYXNlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSkNCiAgICAgICAgew0KICAgICAgICAgICAgbG9jayAoc19vdXRGaWxlTWVtb3J5TG9jaykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzelhtbEZpbGUgPSBGdWxsRmlsZVBhdGgoc3pYbWxGaWxlKTsNCg0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJMb2FkaW5nIFhNTCB7MH0iLCBzelhtbEZpbGUpOw0KICAgICAgICAgICAgICAgIElYUGF0aE5hdmlnYWJsZSB4ZCA9IExvYWRYTUwoc3pYbWxGaWxlLCBkb2NUeXBlKTsNCg0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKCJFeGVjdXRpbmcgdHJhbnNmb3JtIik7DQogICAgICAgICAgICAgICAgeHJYU0xUID0gbnVsbDsNCiAgICAgICAgICAgICAgICBTdHJlYW0gc3RybVRlbXAgPSBudWxsOw0KICAgICAgICAgICAgICAgIHN3aXRjaCAodHJhbnNmb3JtVHlwZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgVHJhbnNmb3JtVHlwZS5SZWFkZXI6DQogICAgICAgICAgICAgICAgICAgICAgICB4clhTTFQgPSB4c2x0LlRyYW5zZm9ybSh4ZCwgbV94c2x0QXJnKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEZpbGVTdHJlYW0gb3V0RmlsZSA9IG5ldyBGaWxlU3RyZWFtKF9zdHJPdXRGaWxlLCBGaWxlTW9kZS5DcmVhdGUsIEZpbGVBY2Nlc3MuUmVhZFdyaXRlKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nIChYbWxXcml0ZXIgd3JpdGVyID0gWG1sV3JpdGVyLkNyZWF0ZShvdXRGaWxlKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVOb2RlKHhyWFNMVCwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckNhc2UpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoeHJYU0xULlJlYWQoKSkgeyB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeHJYU0xUICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4clhTTFQuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIGNhc2UgVHJhbnNmb3JtVHlwZS5TdHJlYW06DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJtVGVtcCA9IG5ldyBGaWxlU3RyZWFtKF9zdHJPdXRGaWxlLCBGaWxlTW9kZS5DcmVhdGUsIEZpbGVBY2Nlc3MuUmVhZFdyaXRlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbV94c2x0QXJnLCBzdHJtVGVtcCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IChleCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cm1UZW1wICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm1UZW1wLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIGNhc2UgVHJhbnNmb3JtVHlwZS5Xcml0ZXI6DQogICAgICAgICAgICAgICAgICAgICAgICBYbWxXcml0ZXIgeHcgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHcgPSBuZXcgWG1sVGV4dFdyaXRlcihfc3RyT3V0RmlsZSwgRW5jb2RpbmcuVVRGOCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHcuV3JpdGVTdGFydERvY3VtZW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeGQsIG1feHNsdEFyZywgeHcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4dyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dy5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICBjYXNlIFRyYW5zZm9ybVR5cGUuVGV4dFdyaXRlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRXcml0ZXIgdHcgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEZpbGVTdHJlYW0gb3V0RmlsZSA9IG5ldyBGaWxlU3RyZWFtKF9zdHJPdXRGaWxlLCBGaWxlTW9kZS5DcmVhdGUsIEZpbGVBY2Nlc3MuV3JpdGUpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHcgPSBuZXcgU3RyZWFtV3JpdGVyKG91dEZpbGUsIEVuY29kaW5nLlVURjgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbV94c2x0QXJnLCB0dyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gIFRyYW5zZm9ybVJlc29sdmVyDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCiAgICAgICAgcHVibGljIGludCBUcmFuc2Zvcm1SZXNvbHZlcihzdHJpbmcgc3pYbWxGaWxlLCBUcmFuc2Zvcm1UeXBlIHRyYW5zZm9ybVR5cGUsIERvY1R5cGUgZG9jVHlwZSwgWG1sUmVzb2x2ZXIgeHIpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIERlZmF1bHQgdmFsdWUgb2YgZXJyb3JDYXNlIGlzIGZhbHNlDQogICAgICAgICAgICByZXR1cm4gVHJhbnNmb3JtUmVzb2x2ZXIoc3pYbWxGaWxlLCB4ciwgZmFsc2UsIHRyYW5zZm9ybVR5cGUsIGRvY1R5cGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBUcmFuc2Zvcm1SZXNvbHZlcihzdHJpbmcgc3pYbWxGaWxlLCBYbWxSZXNvbHZlciB4ciwgYm9vbCBlcnJvckNhc2UsIFRyYW5zZm9ybVR5cGUgdHJhbnNmb3JtVHlwZSwgRG9jVHlwZSBkb2NUeXBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBsb2NrIChzX291dEZpbGVNZW1vcnlMb2NrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN6WG1sRmlsZSA9IEZ1bGxGaWxlUGF0aChzelhtbEZpbGUpOw0KDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkxvYWRpbmcgWE1MIHswfSIsIHN6WG1sRmlsZSk7DQogICAgICAgICAgICAgICAgSVhQYXRoTmF2aWdhYmxlIHhkID0gTG9hZFhNTChzelhtbEZpbGUsIGRvY1R5cGUpOw0KDQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoIkV4ZWN1dGluZyB0cmFuc2Zvcm0iKTsNCiAgICAgICAgICAgICAgICB4clhTTFQgPSBudWxsOw0KICAgICAgICAgICAgICAgIFN0cmVhbSBzdHJtVGVtcCA9IG51bGw7DQoNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRyYW5zZm9ybVR5cGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIFRyYW5zZm9ybVR5cGUuUmVhZGVyOg0KICAgICAgICAgICAgICAgICAgICAgICAgeHJYU0xUID0geHNsdC5UcmFuc2Zvcm0oeGQsIG51bGwsIHhyKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmcgKEZpbGVTdHJlYW0gb3V0RmlsZSA9IG5ldyBGaWxlU3RyZWFtKF9zdHJPdXRGaWxlLCBGaWxlTW9kZS5DcmVhdGUsIEZpbGVBY2Nlc3MuUmVhZFdyaXRlKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nIChYbWxXcml0ZXIgd3JpdGVyID0gWG1sV3JpdGVyLkNyZWF0ZShvdXRGaWxlKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGVOb2RlKHhyWFNMVCwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckNhc2UpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoeHJYU0xULlJlYWQoKSkgeyB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeHJYU0xUICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4clhTTFQuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIGNhc2UgVHJhbnNmb3JtVHlwZS5TdHJlYW06DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJtVGVtcCA9IG5ldyBGaWxlU3RyZWFtKF9zdHJPdXRGaWxlLCBGaWxlTW9kZS5DcmVhdGUsIEZpbGVBY2Nlc3MuUmVhZFdyaXRlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbnVsbCwgc3RybVRlbXAsIHhyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RybVRlbXAgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RybVRlbXAuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBUcmFuc2Zvcm1UeXBlLldyaXRlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgIFhtbFdyaXRlciB4dyA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dyA9IG5ldyBYbWxUZXh0V3JpdGVyKF9zdHJPdXRGaWxlLCBFbmNvZGluZy5VVEY4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dy5Xcml0ZVN0YXJ0RG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c2x0LlRyYW5zZm9ybSh4ZCwgbnVsbCwgeHcsIHhyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeHcgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHcuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBUcmFuc2Zvcm1UeXBlLlRleHRXcml0ZXI6DQogICAgICAgICAgICAgICAgICAgICAgICBUZXh0V3JpdGVyIHR3ID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nIChGaWxlU3RyZWFtIG91dEZpbGUgPSBuZXcgRmlsZVN0cmVhbShfc3RyT3V0RmlsZSwgRmlsZU1vZGUuQ3JlYXRlLCBGaWxlQWNjZXNzLldyaXRlKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ID0gbmV3IFN0cmVhbVdyaXRlcihvdXRGaWxlLCBFbmNvZGluZy5VVEY4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNsdC5UcmFuc2Zvcm0oeGQsIG51bGwsIHR3LCB4cik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgKGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGludGVybmFsIGNsYXNzIENFeGNlcHRpb25IYW5kbGVyDQogICAgew0KICAgICAgICBwcml2YXRlIFhQYXRoRG9jdW1lbnQgX2RvYzsNCiAgICAgICAgcHJpdmF0ZSBYUGF0aE5hdmlnYXRvciBfbmF2Ow0KICAgICAgICBwcml2YXRlIEV4Y2VwdGlvblZlcmlmaWVyIF9leFZlcjsNCg0KICAgICAgICBwcml2YXRlIElUZXN0T3V0cHV0SGVscGVyIF9vdXRwdXQ7DQoNCiAgICAgICAgcHVibGljIENFeGNlcHRpb25IYW5kbGVyKHN0cmluZyBzdHJYbWxGaWxlLCBzdHJpbmcgbnMsIElUZXN0T3V0cHV0SGVscGVyIG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgX291dHB1dCA9IG91dHB1dDsNCg0KICAgICAgICAgICAgX2V4VmVyID0gbmV3IEV4Y2VwdGlvblZlcmlmaWVyKG5zLCBFeGNlcHRpb25WZXJpZmljYXRpb25GbGFncy5JZ25vcmVNdWx0aXBsZURvdHMsIF9vdXRwdXQpOw0KDQogICAgICAgICAgICBfZG9jID0gbmV3IFhQYXRoRG9jdW1lbnQoc3RyWG1sRmlsZSk7DQogICAgICAgICAgICBfbmF2ID0gKChJWFBhdGhOYXZpZ2FibGUpX2RvYykuQ3JlYXRlTmF2aWdhdG9yKCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgVmVyaWZ5RXhjZXB0aW9uDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBib29sIFZlcmlmeUV4Y2VwdGlvbihFeGNlcHRpb24gZXgsIHN0cmluZyByZXMsIHN0cmluZ1tdIHN0clBhcmFtcykNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX2V4VmVyLklzRXhjZXB0aW9uT2soZXgsIHJlcywgc3RyUGFyYW1zKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXhwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9vdXRwdXQuV3JpdGVMaW5lKGV4cC5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyAgVmVyaWZ5RXhjZXB0aW9uDQogICAgICAgIC8vICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBib29sIFZlcmlmeUV4Y2VwdGlvbihFeGNlcHRpb24gZXgsIHN0cmluZyByZXMsIHN0cmluZ1tdIHN0clBhcmFtcywgTGluZUluZm8gbEluZm8pDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF9leFZlci5Jc0V4Y2VwdGlvbk9rKGV4LCByZXMsIHN0clBhcmFtcywgbEluZm8pOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleHApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgX291dHB1dC5Xcml0ZUxpbmUoZXhwLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="
        },
        "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XsltCompiler/XsltCommon.cs": {
          "mimeType": "text/x-csharp",
          "contents": "Ly8gTGljZW5zZWQgdG8gdGhlIC5ORVQgRm91bmRhdGlvbiB1bmRlciBvbmUgb3IgbW9yZSBhZ3JlZW1lbnRzLg0KLy8gVGhlIC5ORVQgRm91bmRhdGlvbiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCi8vIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb24uDQoNCnVzaW5nIE9MRURCLlRlc3QuTW9kdWxlQ29yZTsNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9uczsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KdXNpbmcgU3lzdGVtLkdsb2JhbGl6YXRpb247DQp1c2luZyBTeXN0ZW0uSU87DQp1c2luZyBTeXN0ZW0uTGlucTsNCnVzaW5nIFN5c3RlbS5YbWw7DQp1c2luZyBTeXN0ZW0uWG1sLlhtbERpZmY7DQoNCm5hbWVzcGFjZSBYbWxDb3JlVGVzdC5Db21tb24NCnsNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIGF1dGhvciBhbGV4a3INCiAgICBkYXRlICAgMTIvMTQvMjAwNQ0KDQogICAgVGhpcyBjbGFzcyBjb250YWlucyBjb21tb24gc3RhdGljIG1ldGhvZHMgdXNlZCB0byB2ZXJpZnkgdGhlIHJlc3VsdHMgb2YgYW4gWFNMVCBkYXRhLWRyaXZlbiB0ZXN0Lg0KICAgIEl0IGNvbnRhaW5zIHRoZSBmb2xsb3dpbmcgbWV0aG9kczoNCiAgICAgICAgQ29tcGFyZVhtbCAgICAgICAgIC0gdXNlZCB0byBjb21wYXJlIHR3byBYTUwgb3V0cHV0cywgY2FwdHVyZWQgYXMgZmlsZXMsIHVzaW5nIFhtbERpZmYuDQogICAgICAgIENvbXBhcmVDaGVja3N1bSAgICAtIHVzZWQgdG8gY29tcGFyZSB0d28gbm9uLVhNTCBvdXRwdXRzLCBjYXB0dXJlZCBhcyBmaWxlcywgdXNpbmcgYSBDaGVja3N1bSBjYWxjdWxhdGlvbi4NCiAgICAgICAgQ29tcGFyZUV4Y2VwdGlvbiAgIC0gdXNlZCB0byBjb21wYXJlIHR3byBFeGNlcHRpb25zLCBvciB0aGUgbWV0YS1kYXRhIG9mIHR3byBFeGNlcHRpb25zLCB1c2luZyBhbiBFeGNlcHRpb24gd3JhcHBlciBjbGFzcy4NCg0KICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIHB1YmxpYyBjbGFzcyBYc2x0VmVyaWZpY2F0aW9uTGlicmFyeQ0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgd2luU0RLUGF0aCA9IHN0cmluZy5FbXB0eTsNCg0KICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgICAgICBYTUxEaWZmIGNvbXBhcmUgZm9yIFhTTFRWMiBkYXRhIGRyaXZlbiB0ZXN0cy4NCiAgICAgICAgSXQgc3VwcG9ydHMgY3VzdG9tIGRhdGEtZHJpdmVuIHhtbGRpZmYgb3B0aW9ucyBwYXNzZWQgZnJvbSB0aGUgY29tbWFuZCBsaW5lLA0KICAgICAgICBJdCBtaWdodCBzdXBwb3J0IGFuIG9wdGlvbmFsIGhlbHBlck9iamVjdCB0aGF0IGNhbiBwZXJmb3JtIGRlbGF5ZWQgbG9nZ2luZywgYnV0IGRvZXMgbm90IHlldC4NCiAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDb21wYXJlWG1sKHN0cmluZyBiYXNlbGluZUZpbGUsIHN0cmluZyBhY3R1YWxGaWxlLCBzdHJpbmcgeG1sZGlmZm9wdGlvbnZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gQ29tcGFyZVhtbChiYXNlbGluZUZpbGUsIGFjdHVhbEZpbGUsIHhtbGRpZmZvcHRpb252YWx1ZSwgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ29tcGFyZVhtbChzdHJpbmcgYmFzZWxpbmVGaWxlLCBzdHJpbmcgYWN0dWFsRmlsZSwgc3RyaW5nIHhtbGRpZmZvcHRpb252YWx1ZSwgRGVsYXllZFdyaXRlTG9nZ2VyIGxvZ2dlcikNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciBmc0FjdHVhbCA9IG5ldyBGaWxlU3RyZWFtKGFjdHVhbEZpbGUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpDQogICAgICAgICAgICB1c2luZyAodmFyIGZzRXhwZWN0ZWQgPSBuZXcgRmlsZVN0cmVhbShiYXNlbGluZUZpbGUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIENvbXBhcmVYbWwoZnNBY3R1YWwsIGZzRXhwZWN0ZWQsIHhtbGRpZmZvcHRpb252YWx1ZSwgbG9nZ2VyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDb21wYXJlWG1sKHN0cmluZyBiYXNlbGluZUZpbGUsIFN0cmVhbSBhY3R1YWxTdHJlYW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIGFjdHVhbFN0cmVhbS5TZWVrKDAsIFNlZWtPcmlnaW4uQmVnaW4pOw0KDQogICAgICAgICAgICB1c2luZyAodmFyIGV4cGVjdGVkU3RyZWFtID0gbmV3IEZpbGVTdHJlYW0oYmFzZWxpbmVGaWxlLCBGaWxlTW9kZS5PcGVuLCBGaWxlQWNjZXNzLlJlYWQpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBDb21wYXJlWG1sKGV4cGVjdGVkU3RyZWFtLCBhY3R1YWxTdHJlYW0sIFN0cmluZy5FbXB0eSwgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ29tcGFyZVhtbChTdHJlYW0gZXhwZWN0ZWRTdHJlYW0sIFN0cmVhbSBhY3R1YWxTdHJlYW0sIHN0cmluZyB4bWxkaWZmb3B0aW9udmFsdWUsIERlbGF5ZWRXcml0ZUxvZ2dlciBsb2dnZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJvb2wgYlJlc3VsdCA9IGZhbHNlOw0KDQogICAgICAgICAgICAvLyBEZWZhdWx0IERpZmYgb3B0aW9ucyB1c2VkIGJ5IFhTTFQgVjIgZHJpdmVyLg0KICAgICAgICAgICAgaW50IGRlZmF1bHRYbWxEaWZmT3B0aW9ucyA9IChpbnQpKFhtbERpZmZPcHRpb24uSW5mb3NldENvbXBhcmlzb24gfCBYbWxEaWZmT3B0aW9uLklnbm9yZUVtcHR5RWxlbWVudCB8IFhtbERpZmZPcHRpb24uSWdub3JlQXR0cmlidXRlT3JkZXIpOw0KICAgICAgICAgICAgWG1sRGlmZiBkaWZmID0gbmV3IFhtbERpZmYoKTsNCg0KICAgICAgICAgICAgaWYgKHhtbGRpZmZvcHRpb252YWx1ZSA9PSBudWxsIHx8IHhtbGRpZmZvcHRpb252YWx1ZS5FcXVhbHMoc3RyaW5nLkVtcHR5KSkNCiAgICAgICAgICAgICAgICBkaWZmLk9wdGlvbiA9IChYbWxEaWZmT3B0aW9uKWRlZmF1bHRYbWxEaWZmT3B0aW9uczsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobG9nZ2VyICE9IG51bGwpIGxvZ2dlci5Mb2dNZXNzYWdlKCJDdXN0b20gWG1sRGlmZk9wdGlvbnMgdXNlZC4gVmFsdWUgcGFzc2VkIGlzICIgKyB4bWxkaWZmb3B0aW9udmFsdWUpOw0KICAgICAgICAgICAgICAgIGRpZmYuT3B0aW9uID0gKFhtbERpZmZPcHRpb24pSW50MzIuUGFyc2UoeG1sZGlmZm9wdGlvbnZhbHVlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgWG1sUGFyc2VyQ29udGV4dCBjb250ZXh0ID0gbmV3IFhtbFBhcnNlckNvbnRleHQobmV3IE5hbWVUYWJsZSgpLCBudWxsLCAiIiwgWG1sU3BhY2UuTm9uZSk7DQoNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJSZXN1bHQgPQ0KICAgICAgICAgICAgICAgICAgIGRpZmYuQ29tcGFyZShuZXcgWG1sVGV4dFJlYWRlcihhY3R1YWxTdHJlYW0sIFhtbE5vZGVUeXBlLkVsZW1lbnQsIGNvbnRleHQpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgWG1sVGV4dFJlYWRlcihleHBlY3RlZFN0cmVhbSwgWG1sTm9kZVR5cGUuRWxlbWVudCwgY29udGV4dCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJSZXN1bHQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBpZiAobG9nZ2VyICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuTG9nTWVzc2FnZSgiRXhjZXB0aW9uIHRocm93biBpbiBYbWxEaWZmIGNvbXBhcmUhIik7DQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5Mb2dYbWwoZS5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoYlJlc3VsdCkNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgaWYgKGxvZ2dlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxvZ2dlci5Mb2dNZXNzYWdlKCJNaXNtYXRjaCBpbiBYbWxEaWZmIik7DQogICAgICAgICAgICAgICAgbG9nZ2VyLkxvZ01lc3NhZ2UoIkFjdHVhbCByZXN1bHQ6ICIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgICAgICBDaGVja3N1bSBjYWxjdWxhdGlvbi4gTGVnYWN5Lg0KICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIENvbXBhcmVDaGVja3N1bShzdHJpbmcgQmFzZWxpbmUsIHN0cmluZyBPdXRGaWxlLCBpbnQgZHJpdmVyVmVyc2lvbikNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIENvbXBhcmVDaGVja3N1bShCYXNlbGluZSwgT3V0RmlsZSwgZHJpdmVyVmVyc2lvbiwgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ29tcGFyZUNoZWNrc3VtKHN0cmluZyBCYXNlbGluZSwgc3RyaW5nIE91dEZpbGUsIGludCBkcml2ZXJWZXJzaW9uLCBEZWxheWVkV3JpdGVMb2dnZXIgbG9nZ2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gQ29tcGFyZUNoZWNrc3VtKA0KICAgICAgICAgICAgICAgQmFzZWxpbmUsDQogICAgICAgICAgICAgICAxLCAgICAgICAgICAgICAgICAvL3N0YXJ0IGZyb20gdGhlIGZpcnN0IGxpbmUgaW4gdGhlIGJhc2VsaW5lIGZpbGUNCiAgICAgICAgICAgICAgIE91dEZpbGUsDQogICAgICAgICAgICAgICAxLCAgICAgICAgICAgICAgICAvL3N0YXJ0IGZyb20gdGhlIGZpcnN0IGxpbmUgaW4gdGhlIG91dHB1dCBmaWxlDQogICAgICAgICAgICAgICBkcml2ZXJWZXJzaW9uLA0KICAgICAgICAgICAgICAgbG9nZ2VyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8c3VtbWFyeT4NCiAgICAgICAgLy8vDQogICAgICAgIC8vLyA8L3N1bW1hcnk+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0iQmFzZWxpbmUiPjwvcGFyYW0+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0iYmFzZWxpbmVTdGFydExpbmUiPlRoZSBsaW5lIHRvIHN0YXJ0IGNvbXBhcmlzb24gaW4gdGhlIGJhc2VsaW5lIGZpbGU8L3BhcmFtPg0KICAgICAgICAvLy8gPHBhcmFtIG5hbWU9Ik91dEZpbGUiPjwvcGFyYW0+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0ib3V0RmlsZVN0YXJ0TGluZSI+VGhlIGxpbmUgdG8gc3RhcnQgY29tcGFyaXNvbiBpbiB0aGUgb3V0cHV0IGZpbGU8L3BhcmFtPg0KICAgICAgICAvLy8gPHBhcmFtIG5hbWU9ImRyaXZlclZlcnNpb24iPjwvcGFyYW0+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0ibG9nZ2VyIj48L3BhcmFtPg0KICAgICAgICAvLy8gPHJldHVybnM+PC9yZXR1cm5zPg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ29tcGFyZUNoZWNrc3VtKHN0cmluZyBCYXNlbGluZSwgaW50IGJhc2VsaW5lU3RhcnRMaW5lLCBzdHJpbmcgT3V0RmlsZSwgaW50IG91dEZpbGVTdGFydExpbmUsIGludCBkcml2ZXJWZXJzaW9uLCBEZWxheWVkV3JpdGVMb2dnZXIgbG9nZ2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBLZWVwIHBlb3BsZSBob25lc3QuDQogICAgICAgICAgICBpZiAoZHJpdmVyVmVyc2lvbiA9PSAyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChsb2dnZXIgIT0gbnVsbCkgbG9nZ2VyLkxvZ01lc3NhZ2UoIkNhbGN1bGF0aW5nIGNoZWNrc3VtIGZvciBiYXNlbGluZSBvdXRwdXQgezB9Li4uIiwgQmFzZWxpbmUpOw0KDQogICAgICAgICAgICAgICAgc3RyaW5nIGV4cGVjdGVkQ2hlY2tTdW0gPSBDYWxjQ2hlY2tzdW0oQmFzZWxpbmUsIGJhc2VsaW5lU3RhcnRMaW5lLCBsb2dnZXIpOw0KICAgICAgICAgICAgICAgIHN0cmluZyBhY3R1YWxDaGVja3N1bSA9IENhbGNDaGVja3N1bShPdXRGaWxlLCBvdXRGaWxlU3RhcnRMaW5lLCBsb2dnZXIpOw0KDQogICAgICAgICAgICAgICAgaWYgKGV4cGVjdGVkQ2hlY2tTdW0uRXF1YWxzKGFjdHVhbENoZWNrc3VtKSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuTG9nTWVzc2FnZSgiQWN0dWFsIGNoZWNrc3VtOiB7MH0sIEV4cGVjdGVkIGNoZWNrc3VtOiB7MX0iLCBhY3R1YWxDaGVja3N1bSwgZXhwZWN0ZWRDaGVja1N1bSk7DQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuTG9nTWVzc2FnZSgiQWN0dWFsIHJlc3VsdDogIik7DQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuV3JpdGVPdXRwdXRGaWxlVG9Mb2coT3V0RmlsZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgdGhyb3cgbmV3IE5vdFN1cHBvcnRlZEV4Y2VwdGlvbigiTm90IGEgc3VwcG9ydGVkIGRyaXZlciB2ZXJzaW9uIik7DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgQ2FsY0NoZWNrc3VtKHN0cmluZyBmaWxlTmFtZSwgRGVsYXllZFdyaXRlTG9nZ2VyIGxvZ2dlcikNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIENhbGNDaGVja3N1bShmaWxlTmFtZSwgMSwgbG9nZ2VyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyA8c3VtbWFyeT4NCiAgICAgICAgLy8vDQogICAgICAgIC8vLyA8L3N1bW1hcnk+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0iZmlsZU5hbWUiPjwvcGFyYW0+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0ic3RhcnRGcm9tTGluZSI+VGhlIGxpbmUgdG8gc3RhcnQgY2FsY3VsYXRpbmcgdGhlIGNoZWNrc3VtLiBBbnkgdGV4dCBiZWZvcmUgdGhpcyBsaW5lIGlzIGlnbm9yZWQuIEZpcnN0IGxpbmUgaXMgMS48L3BhcmFtPg0KICAgICAgICAvLy8gPHBhcmFtIG5hbWU9ImxvZ2dlciI+PC9wYXJhbT4NCiAgICAgICAgLy8vIDxyZXR1cm5zPjwvcmV0dXJucz4NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIENhbGNDaGVja3N1bShzdHJpbmcgZmlsZU5hbWUsIGludCBzdGFydEZyb21MaW5lLCBEZWxheWVkV3JpdGVMb2dnZXIgbG9nZ2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICBjb25zdCBpbnQgQlVGRkVSU0laRSA9IDQwOTY7DQogICAgICAgICAgICBEZWNpbWFsIGRSZXN1bHQgPSAwOyAgICAgICAgLy8gTnVtZXJpY2FsIHZhbHVlIG9mIHRoZSBjaGVja3N1bQ0KICAgICAgICAgICAgaW50IGkgPSAwOyAgICAgICAgICAgICAgICAgIC8vIEdlbmVyaWMgY291bnRlcg0KICAgICAgICAgICAgaW50IGNCeXRlc1JlYWQgPSAxOyAgICAgICAgLy8gIyBvZiBieXRlcyByZWFkIGF0IG9uZSB0aW1lDQogICAgICAgICAgICBpbnQgY1RvdGFsUmVhZCA9IDA7ICAgICAgICAgLy8gVG90YWwgIyBvZiBieXRlcyByZWFkIHNvIGZhcg0KICAgICAgICAgICAgRGVjaW1hbCBkRW5kQnVmZmVyID0gMDsgICAgIC8vIEJ1ZmZlciB0byByZW1vdmUgZnJvbSB0aGUgZW5kIChUaGlzIGlzIG5lY2Vzc2FyeSBiZWNhdXNlDQogICAgICAgICAgICAvLyBub3RlcGFkIGFkZHMgQ1IvTEYgb250byB0aGUgZW5kIG9mIGV2ZXJ5IGZpbGUpDQogICAgICAgICAgICBDaGFyW10gcmdCdWZmZXIgPSBuZXcgQ2hhcltCVUZGRVJTSVpFXTsNCg0KICAgICAgICAgICAgc3RyaW5nIHhtbCA9ICIiOw0KDQogICAgICAgICAgICBTdHJlYW1SZWFkZXIgZnMgPSBudWxsOw0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmcyA9IG5ldyBTdHJlYW1SZWFkZXIobmV3IEZpbGVTdHJlYW0oZmlsZU5hbWUsIEZpbGVNb2RlLk9wZW4sIEZpbGVBY2Nlc3MuUmVhZCkpOw0KDQogICAgICAgICAgICAgICAgLy9zd2l0Y2ggdG8gdGhlIGxpbmUgdG8gc3RhcnQgZnJvbSwgbGluZXMgc3RhcnQgZnJvbSAxDQogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDE7IGogPCBzdGFydEZyb21MaW5lOyBqKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBmcy5SZWFkTGluZSgpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGNCeXRlc1JlYWQgPSBmcy5SZWFkKHJnQnVmZmVyLCAwLCBCVUZGRVJTSVpFKTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlIChjQnl0ZXNSZWFkID4gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgWE1MIHByb3BlcnR5IHVwIHRvIGRhdGUNCiAgICAgICAgICAgICAgICAgICAgeG1sID0gU3RyaW5nLkNvbmNhdCh4bWwsIG5ldyBTdHJpbmcocmdCdWZmZXIsIDAsIGNCeXRlc1JlYWQpKTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGNoZWNrc3VtDQogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjQnl0ZXNSZWFkOyBpKyspDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRSZXN1bHQgKz0gTWF0aC5Sb3VuZCgoRGVjaW1hbCkocmdCdWZmZXJbaV0gLyAoY1RvdGFsUmVhZCArIGkgKyAxLjApKSwgMTApOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgY1RvdGFsUmVhZCArPSBjQnl0ZXNSZWFkOw0KICAgICAgICAgICAgICAgICAgICBkRW5kQnVmZmVyID0gMDsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIHJlYWRpbmcgKGluIGNhc2UgZmlsZSBpcyBiaWdnZXIgdGhhbiA0SykNCiAgICAgICAgICAgICAgICAgICAgY0J5dGVzUmVhZCA9IGZzLlJlYWQocmdCdWZmZXIsIDAsIEJVRkZFUlNJWkUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGxvZ2dlciAhPSBudWxsKSBsb2dnZXIuTG9nWG1sKGV4LlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIHJldHVybiAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoZnMgIT0gbnVsbCkgZnMuRGlzcG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9TdHJpbmcoZFJlc3VsdCAtIGRFbmRCdWZmZXIsIE51bWJlckZvcm1hdEluZm8uSW52YXJpYW50SW5mbyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBJcyB0aGlzIHJlYWxseSBhbGwgdGhlcmUgaXMgdG8gaXQ/DQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBEZXRlY3RFbWl0dGVkUERCKHN0cmluZyBmaWxlTmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKEZpbGUuRXhpc3RzKGZpbGVOYW1lKSkgcmV0dXJuIHRydWU7DQogICAgICAgICAgICBlbHNlIHJldHVybiBGaWxlLkV4aXN0cyhmaWxlTmFtZSArICIucGRiIik7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDYWxsIFBFVmVyaWZ5IG9uIHRoZSBBc3NlbWJseSBuYW1lLCBwYXJzZSB0aGUgb3V0cHV0LA0KICAgICAgICAvLyBhbmQgcmV0dXJuIHRydWUgaWYgdGhlIG91dHB1dCBpcyBQQVNTIGFuZCBmYWxzZSBpZiB0aGUgb3V0cHV0IGlzIEZBSUwuDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBWZXJpZnlBc3NlbWJseVVzaW5nUEVWZXJpZnkoc3RyaW5nIGFzbU5hbWUsIGJvb2wgaXNWYWxpZENhc2UsIERlbGF5ZWRXcml0ZUxvZ2dlciBsb2dnZXIsIHJlZiBzdHJpbmcgb3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQoYXNtTmFtZSAhPSBudWxsKTsNCiAgICAgICAgICAgIERlYnVnLkFzc2VydChhc21OYW1lICE9IFN0cmluZy5FbXB0eSk7DQoNCiAgICAgICAgICAgIGlmICghYXNtTmFtZS5Db250YWlucygiLmRsbCIpIHx8ICFhc21OYW1lLkNvbnRhaW5zKCIuRExMIikpDQogICAgICAgICAgICAgICAgYXNtTmFtZSA9IGFzbU5hbWUgKyAiLmRsbCI7DQoNCiAgICAgICAgICAgIGlmIChGaWxlLkV4aXN0cyhhc21OYW1lKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gVmVyaWZ5QXNzZW1ibHlVc2luZ1BFVmVyaWZ5KGFzbU5hbWUsIGxvZ2dlciwgcmVmIG91dHB1dCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGlzVmFsaWRDYXNlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG1lc3NhZ2UgPSAiUEVWZXJpZnkgY291bGQgbm90IGJlIHJ1biwgbm8gYXNzZW1ibHkgcHJlc2VudDogIiArIGFzbU5hbWU7DQogICAgICAgICAgICAgICAgICAgIGlmIChsb2dnZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5Mb2dNZXNzYWdlKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBtZXNzYWdlOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgVmVyaWZ5U2luZ2xlQXNzZW1ibHlVc2luZ1BFVmVyaWZ5KHN0cmluZyBhc21OYW1lLCBEZWxheWVkV3JpdGVMb2dnZXIgbG9nZ2VyLCByZWYgc3RyaW5nIG91dHB1dCkNCiAgICAgICAgew0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KGFzbU5hbWUgIT0gbnVsbCk7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQoYXNtTmFtZSAhPSBTdHJpbmcuRW1wdHkpOw0KDQogICAgICAgICAgICBib29sIHJlc3VsdCA9IGZhbHNlOw0KDQogICAgICAgICAgICBpZiAoRmlsZS5FeGlzdHMoYXNtTmFtZSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy9hZGQgZG91YmxlIHF1b3RlcyBmb3IgbmFtZXMgd2l0aCB3aGl0ZXNwYWNlIGluIHRoZW0NCiAgICAgICAgICAgICAgICBzdHJpbmcgcHJvY2Vzc0FyZ3VtZW50cyA9ICIgL3F1aWV0ICIgKyAiXCIiICsgYXNtTmFtZSArICJcIiI7DQoNCiAgICAgICAgICAgICAgICAvLyBDYWxsIFBFVmVyaWZ5IHRvIHZlcmlmeSBwZXJzaXN0YW50IGFzc2VtYmx5Lg0KICAgICAgICAgICAgICAgIFByb2Nlc3MgcGVWZXJpZnlQcm9jZXNzID0gbmV3IFByb2Nlc3MoKTsNCiAgICAgICAgICAgICAgICBwZVZlcmlmeVByb2Nlc3MuU3RhcnRJbmZvLkZpbGVOYW1lID0gU2VhcmNoUGF0aCgicGV2ZXJpZnkuZXhlIik7DQogICAgICAgICAgICAgICAgcGVWZXJpZnlQcm9jZXNzLlN0YXJ0SW5mby5Bcmd1bWVudHMgPSAiICIgKyBwcm9jZXNzQXJndW1lbnRzOw0KICAgICAgICAgICAgICAgIC8vcGVWZXJpZnlQcm9jZXNzLlN0YXJ0SW5mby5XaW5kb3dTdHlsZSA9IFByb2Nlc3NXaW5kb3dTdHlsZS5IaWRkZW47DQogICAgICAgICAgICAgICAgcGVWZXJpZnlQcm9jZXNzLlN0YXJ0SW5mby5DcmVhdGVOb1dpbmRvdyA9IHRydWU7DQogICAgICAgICAgICAgICAgcGVWZXJpZnlQcm9jZXNzLlN0YXJ0SW5mby5Vc2VTaGVsbEV4ZWN1dGUgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBwZVZlcmlmeVByb2Nlc3MuU3RhcnRJbmZvLlJlZGlyZWN0U3RhbmRhcmRPdXRwdXQgPSB0cnVlOw0KDQogICAgICAgICAgICAgICAgcGVWZXJpZnlQcm9jZXNzLlN0YXJ0KCk7DQogICAgICAgICAgICAgICAgb3V0cHV0ID0gcGVWZXJpZnlQcm9jZXNzLlN0YW5kYXJkT3V0cHV0LlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgICAgIHBlVmVyaWZ5UHJvY2Vzcy5XYWl0Rm9yRXhpdCgpOw0KDQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIG91dHB1dCBmb3IgdGhlIEFzc2VtYmx5IG5hbWUsIGFuZCB0aGUgd29yZCAiUEFTUyINCiAgICAgICAgICAgICAgICAvLyBGb3IgZXhhbXBsZToNCiAgICAgICAgICAgICAgICAvLyBDOj5wZXZlcmlmeSAvcXVpZXQgNEFDOEJEMjlGM0NCODg4RkFENzZGN0MwOEZENTdBRDMuZGxsDQogICAgICAgICAgICAgICAgLy8gNEFDOEJEMjlGM0NCODg4RkFENzZGN0MwOEZENTdBRDMuZGxsIFBBU1MNCiAgICAgICAgICAgICAgICBpZiAocGVWZXJpZnlQcm9jZXNzLkV4aXRDb2RlID09IDAgJiYgb3V0cHV0LkNvbnRhaW5zKGFzbU5hbWUpICYmIG91dHB1dC5Db250YWlucygiUEFTUyIpKQ0KICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChsb2dnZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5Mb2dNZXNzYWdlKCJQRVZlcmlmeSBjb3VsZCBub3QgYmUgcnVuIG9yIEZBSUxFRCA6IHswfSIsIGFzbU5hbWUgKyAiICIgKyBvdXRwdXQpOw0KICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGxvZ2dlciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuTG9nTWVzc2FnZSgiQXNzZW1ibHkgZmlsZSBjb3VsZCBub3QgYmUgZm91bmQgOiB7MH0iLCBhc21OYW1lKTsNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBWZXJpZnlBc3NlbWJseVVzaW5nUEVWZXJpZnkoc3RyaW5nIGFzbU5hbWUsIERlbGF5ZWRXcml0ZUxvZ2dlciBsb2dnZXIsIHJlZiBzdHJpbmcgb3V0cHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICBTdHJpbmcgc2NyaXB0QXNtTmFtZUZvcm1hdCA9IFBhdGguQ2hhbmdlRXh0ZW5zaW9uKGFzbU5hbWUsIG51bGwpICsgIl9TY3JpcHR7MH0uZGxsIjsNCiAgICAgICAgICAgIGludCBzY3JpcHRDb3VudGVyID0gMDsNCiAgICAgICAgICAgIFN0cmluZyB0ZXN0QXNtID0gYXNtTmFtZTsNCiAgICAgICAgICAgIGJvb2wgcmVzdWx0ID0gZmFsc2U7DQoNCiAgICAgICAgICAgIGRvDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gVmVyaWZ5U2luZ2xlQXNzZW1ibHlVc2luZ1BFVmVyaWZ5KHRlc3RBc20sIGxvZ2dlciwgcmVmIG91dHB1dCk7DQogICAgICAgICAgICAgICAgdGVzdEFzbSA9IFN0cmluZy5Gb3JtYXQoc2NyaXB0QXNtTmFtZUZvcm1hdCwgKytzY3JpcHRDb3VudGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHdoaWxlIChyZXN1bHQgJiYgRmlsZS5FeGlzdHModGVzdEFzbSkpOw0KDQogICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgU2VhcmNoUGF0aChTdHJpbmcgZmlsZU5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBsb2NhdGlvbnMgPSBuZXcgSGFzaFNldDxzdHJpbmc+KFN0cmluZ0NvbXBhcmVyLk9yZGluYWxJZ25vcmVDYXNlKTsNCg0KICAgICAgICAgICAgLy8gMzIgYml0IGlmIG9uIDY0IGJpdCBXaW5kb3dzDQogICAgICAgICAgICBsb2NhdGlvbnMuQWRkKFBhdGguQ29tYmluZShFbnZpcm9ubWVudC5HZXRGb2xkZXJQYXRoKEVudmlyb25tZW50LlNwZWNpYWxGb2xkZXIuUHJvZ3JhbUZpbGVzWDg2KSwgQCJNaWNyb3NvZnQgU0RLc1xXaW5kb3dzIikpOw0KICAgICAgICAgICAgLy8gMzIgYml0IGlmIG9uIDMyIGJpdCBXaW5kb3dzLCBvdGhlcndpc2UgNjQgYml0DQogICAgICAgICAgICBsb2NhdGlvbnMuQWRkKFBhdGguQ29tYmluZShFbnZpcm9ubWVudC5HZXRGb2xkZXJQYXRoKEVudmlyb25tZW50LlNwZWNpYWxGb2xkZXIuUHJvZ3JhbUZpbGVzKSwgQCJNaWNyb3NvZnQgU0RLc1xXaW5kb3dzIikpOw0KICAgICAgICAgICAgLy8gNjQgYml0IGlmIGluIDMyIGJpdCBwcm9jZXNzIG9uIDY0IGJpdCBXaW5kb3dzDQogICAgICAgICAgICBsb2NhdGlvbnMuQWRkKFBhdGguQ29tYmluZShFbnZpcm9ubWVudC5HZXRFbnZpcm9ubWVudFZhcmlhYmxlKCJQcm9ncmFtVzY0MzIiKSwgQCJNaWNyb3NvZnQgU0RLc1xXaW5kb3dzIikpOw0KDQogICAgICAgICAgICB2YXIgZmlsZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQoNCiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBsb2NhdGlvbiBpbiBsb2NhdGlvbnMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKERpcmVjdG9yeS5FeGlzdHMobG9jYXRpb24pKQ0KICAgICAgICAgICAgICAgICAgICBmaWxlcy5BZGRSYW5nZShEaXJlY3RvcnkuR2V0RmlsZXMobG9jYXRpb24sIGZpbGVOYW1lLCBTZWFyY2hPcHRpb24uQWxsRGlyZWN0b3JpZXMpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGZpbGVzLkNvdW50ID09IDApDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZpbGVOb3RGb3VuZEV4Y2VwdGlvbihmaWxlTmFtZSk7DQoNCiAgICAgICAgICAgIC8vIENydWRlbHkgcHJlZmVyIG5ld2VyIHZlcnNpb25zLCBlZyA0LjYuMiBvdmVyIDQuNi4xLA0KICAgICAgICAgICAgLy8gYnV0IGl0IGN1cnJlbnRseSBpcyBub3QgaW1wb3J0YW50DQogICAgICAgICAgICBmaWxlcy5Tb3J0KFN0cmluZ0NvbXBhcmVyLk9yZGluYWxJZ25vcmVDYXNlKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGZpbGVzW2ZpbGVzLkNvdW50IC0gMV07DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIFRoaXMgY2xhc3MgaXMgYSBkZWxheWVkLXdyaXRlIG1lc3NhZ2UgbG9nZ2VyLCBzaW1pbGFyIHRvIENFcnJvci5Xcml0ZUxpbmUgZXRjLiBJdCBpcw0KICAgIGluc3RhbnRpYXRlZCBieSB5b3VyIFhzbHREcml2ZXIgYW5kIHVzZWQgdG8gcmVjb3JkIG1lc3NhZ2VzIHRoYXQgeW91IHdvdWxkIG5vcm1hbGx5IHdyaXRlDQogICAgd2l0aCBDRXJyb3IuV3JpdGVMaW5lLCBDRXJyb3IuV3JpdGVMaW5lSWdub3JlLCBvciBDRXJyb3IuV3JpdGVYbWwsIGluIGEgYnVmZmVyZWQgbWFubmVyLg0KICAgIFRoZSBtZXNzYWdlcyBjYW4gYmUgd3JpdHRlbiB0byB0aGUgZmluYWwgbG9nIGZpbGUgdXNpbmcgV3JpdGVPdXRwdXRGaWxlVG9Mb2coKSBieSB5b3VyIGRyaXZlciBjb2RlDQogICAgaWYgdGhlcmUgaXMgYSB2YXJpYXRpb24gZmFpbHVyZSwgb3IganVzdCBkaXNjYXJkZWQgd2hlbiBhIHRlc3QgcGFzc2VzIHRvIGtlZXAgcmVzdWx0cy5sb2cgZmlsZXMNCiAgICB3aXRoaW4gYSBtYW5hZ2FibGUgc2l6ZSBvbiBkaXNrLg0KDQogICAgQXMgYW4gZXhhbXBsZSwgdXNpbmcgdGhpcyBtZXRob2QgcmVkdWNlZCB0aGUgc2l6ZSBvZiB0aGUgWFNMVCBWMiBsb2cgZmlsZSBmcm9tIDNNQiBwZXIgcnVuIHRvIGFyb3VuZCAzMDBrLg0KICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIHB1YmxpYyBjbGFzcyBEZWxheWVkV3JpdGVMb2dnZXINCiAgICB7DQogICAgICAgIHByaXZhdGUgQXJyYXlMaXN0IF9tZXNzYWdlTG9nOw0KDQogICAgICAgIHB1YmxpYyBEZWxheWVkV3JpdGVMb2dnZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBfbWVzc2FnZUxvZyA9IG5ldyBBcnJheUxpc3QoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFdyaXRlcyB0aGUgYnVmZmVyIG9mIG1lc3NhZ2VzIHRvIHRoZSByZXN1bHRzLmxvZyBmaWxlLg0KICAgICAgICBwdWJsaWMgdm9pZCBXcml0ZU91dHB1dEZpbGVUb0xvZyhzdHJpbmcgZmlsZU5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIFN0cmVhbVJlYWRlciBmcyA9IG51bGw7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDaGFyW10gcmdCdWZmZXIgPSBuZXcgQ2hhcls0MDk2XTsNCg0KICAgICAgICAgICAgICAgIGZzID0gbmV3IFN0cmVhbVJlYWRlcihuZXcgRmlsZVN0cmVhbShmaWxlTmFtZSwgRmlsZU1vZGUuT3BlbiwgRmlsZUFjY2Vzcy5SZWFkKSk7DQoNCiAgICAgICAgICAgICAgICBpbnQgY0J5dGVzUmVhZCA9IGZzLlJlYWQocmdCdWZmZXIsIDAsIDQwOTYpOw0KICAgICAgICAgICAgICAgIHdoaWxlIChjQnl0ZXNSZWFkID4gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuTG9nKG5ldyBzdHJpbmcocmdCdWZmZXIsIDAsIGNCeXRlc1JlYWQpKTsNCiAgICAgICAgICAgICAgICAgICAgY0J5dGVzUmVhZCA9IGZzLlJlYWQocmdCdWZmZXIsIDAsIDQwOTYpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmFsbHkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoZnMgIT0gbnVsbCkgZnMuRGlzcG9zZSgpOw0KICAgICAgICAgICAgICAgIHRoaXMuTG9nTWVzc2FnZShTdHJpbmcuRW1wdHkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgTG9nKHN0cmluZyBtc2cpDQogICAgICAgIHsNCiAgICAgICAgICAgIExvZ01lc3NhZ2UoTWVzc2FnZVR5cGUuV3JpdGUsIG1zZywgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdm9pZCBMb2dNZXNzYWdlKHN0cmluZyBtc2cpDQogICAgICAgIHsNCiAgICAgICAgICAgIExvZ01lc3NhZ2UoTWVzc2FnZVR5cGUuV3JpdGVMaW5lLCBtc2csIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgTG9nTWVzc2FnZShzdHJpbmcgbXNnLCBwYXJhbXMgb2JqZWN0W10gYXJncykNCiAgICAgICAgew0KICAgICAgICAgICAgTG9nTWVzc2FnZShNZXNzYWdlVHlwZS5Xcml0ZUxpbmVQYXJhbXMsIG1zZywgYXJncyk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdm9pZCBMb2dNZXNzYWdlSWdub3JlKHN0cmluZyBtc2cpDQogICAgICAgIHsNCiAgICAgICAgICAgIExvZ01lc3NhZ2UoTWVzc2FnZVR5cGUuV3JpdGVMaW5lSWdub3JlLCBtc2csIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgTG9nWG1sKHN0cmluZyBtc2cpDQogICAgICAgIHsNCiAgICAgICAgICAgIExvZ01lc3NhZ2UoTWVzc2FnZVR5cGUuWG1sLCBtc2csIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSB2b2lkIExvZ01lc3NhZ2UoTWVzc2FnZVR5cGUgbXNndHlwZSwgc3RyaW5nIG1zZywgcGFyYW1zIG9iamVjdFtdIGFyZ3MpDQogICAgICAgIHsNCiAgICAgICAgICAgIExvZ01lc3NhZ2UgbWVzc2FnZSA9IG5ldyBMb2dNZXNzYWdlKG1zZ3R5cGUsIG1zZywgYXJncyk7DQogICAgICAgICAgICBfbWVzc2FnZUxvZy5BZGQobWVzc2FnZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdm9pZCBXcml0ZUxvZ2dlZE1lc3NhZ2VzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaCAoTG9nTWVzc2FnZSBtZyBpbiBfbWVzc2FnZUxvZykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKG1nLnR5cGUpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIE1lc3NhZ2VUeXBlLldyaXRlOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ0Vycm9yLldyaXRlKG1nLm1zZyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICBjYXNlIE1lc3NhZ2VUeXBlLldyaXRlTGluZToNCiAgICAgICAgICAgICAgICAgICAgICAgIENFcnJvci5Xcml0ZUxpbmUobWcubXNnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIGNhc2UgTWVzc2FnZVR5cGUuV3JpdGVMaW5lSWdub3JlOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ0Vycm9yLldyaXRlTGluZUlnbm9yZShtZy5tc2cpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBNZXNzYWdlVHlwZS5Xcml0ZUxpbmVQYXJhbXM6DQogICAgICAgICAgICAgICAgICAgICAgICBDRXJyb3IuV3JpdGVMaW5lKG1nLm1zZywgbWcuYXJncyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICBjYXNlIE1lc3NhZ2VUeXBlLlhtbDoNCiAgICAgICAgICAgICAgICAgICAgICAgIENFcnJvci5Xcml0ZVhtbChtZy5tc2cpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gdXNlZCBieSBEZWxheWVkV3JpdGVMb2dnZXINCiAgICBpbnRlcm5hbCBlbnVtIE1lc3NhZ2VUeXBlDQogICAgew0KICAgICAgICBXcml0ZSwNCiAgICAgICAgV3JpdGVMaW5lLA0KICAgICAgICBXcml0ZUxpbmVQYXJhbXMsDQogICAgICAgIFdyaXRlTGluZUlnbm9yZSwNCiAgICAgICAgWG1sDQogICAgfQ0KDQogICAgLy8gdXNlZCBieSBEZWxheWVkV3JpdGVMb2dnZXINCiAgICBpbnRlcm5hbCBjbGFzcyBMb2dNZXNzYWdlDQogICAgew0KICAgICAgICBwdWJsaWMgTG9nTWVzc2FnZShNZXNzYWdlVHlwZSB0LCBzdHJpbmcgbSwgb2JqZWN0W10gbykNCiAgICAgICAgew0KICAgICAgICAgICAgdHlwZSA9IHQ7DQogICAgICAgICAgICBtc2cgPSBtOw0KICAgICAgICAgICAgYXJncyA9IG87DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBNZXNzYWdlVHlwZSB0eXBlOw0KICAgICAgICBwdWJsaWMgc3RyaW5nIG1zZzsNCiAgICAgICAgcHVibGljIG9iamVjdFtdIGFyZ3M7DQogICAgfQ0KDQogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICBhdXRob3IgYWxleGtyDQogICAgZGF0ZSAgIDEyLzEyLzIwMDUNCg0KICAgIFRoaXMgY2xhc3MgaXMgdXNlZCB0byBjb21wYXJlIGV4cGVjdGVkIGV4Y2VwdGlvbnMgd2l0aCBhY3R1YWwgZXhjZXB0aW9ucyBpbiB0aGUgQ29tcGFyZUV4Y2VwdGlvbg0KICAgIG1ldGhvZCwgdXNlZCBieSB0aGUgWFNMVCBWMiBkYXRhIGRyaXZlbiBkcml2ZXIuDQoNCiAgICBJdHMgdXNlIGlzIHNvbWV3aGF0IHN1YnRsZSwgc28gcGxlYXNlIHJlYWQgYWxsIGNvbW1lbnRzLCB1bmRlcnN0YW5kIHRoZSBFcXVhbHMgbWV0aG9kLCBhbmQgYXNrIGZvcg0KICAgIGludHJvZHVjdGlvbiBiZWZvcmUgeW91IHVzZSBpdCBpbiBhbnkgbmV3IGNvZGUsIG9yIG1vZGlmeSBleGlzdGluZyBjb2RlLiBXaHk/IFRoZXJlIGFyZSBtYW55DQogICAgYXNzdW1wdGlvbnMgbWFkZSB3aGVuIHVzaW5nIHRoaXMgY2xhc3MuIEhlcmUgYXJlIHNvbWUuLi4NCg0KICAgICAgIE5vbi1YbWwgRXhjZXB0aW9ucyBhcmUgYWx3YXlzIGNvbXBhcmVkIGJ5IHR5cGUsIGFuZCBtdXN0IG5ldmVyIGhhdmUgRXhjZXB0aW9uUmVzb3VyY2VJZCBvciBFeGNlcHRpb25NZXNzYWdlIGF0dHJpYnV0ZXMgaW4gYSBjb250cm9sIGZpbGUuDQogICAgICAgWG1sIEV4Y2VwdGlvbnMgY2FuIGJlIGVpdGhlciBFeGNlcHRpb25JZCBvbmx5LCBFeGNlcHRpb25JZCBhbmQgRXhjZXB0aW9uTWVzc2FnZSBmb3IgYWxsIFhtbF9Vc2VyRXhjZXB0aW9uIGV4Y2VwdGlvbnMsIG9yIEV4Y2VwdGlvbklkIGFuZCBFeGNlcHRpb25SZXNvdXJjZUlkIGZvciBhbGwgbm9uLVhtbF9Vc2VyRXhjZXB0aW9ucw0KICAgICAgIE5ldmVyIGhhdmUgYm90aCBFeGNlcHRpb25SZXNvdXJjZUlkIEFORCBFeGNlcHRpb25NZXNzYWdlIGF0dHJpYnV0ZXMgc2V0IGZvciB0aGUgc2FtZSBFeGNlcHRpb24gbWV0YS1kYXRhLiBUaGUgYmVoYXZpb3IgaXMgdW5kZWZpbmVkLg0KICAgICAgIFhtbCBFeGNlcHRpb25zIHRoYXQgYXJlIFhtbF9Vc2VyRXhjZXB0aW9ucyBhbmQgaW5jbHVkZSBhIE1lc3NhZ2VGcmFnbWVudCB3aWxsIG9ubHkgYmUgY29tcGFyZWQgaW4gRU5VIHJ1bnMuIEdsb2JhbGl6ZWQgcnVucyByZXNvcnQgdG8gVHlwZSBjb21wYXJpc29uIChFeGNlcHRpb25JZCkgb25seS4NCiAgICAgICBYbWwgRXhjZXB0aW9ucyB0aGF0IGFyZSBub24tWG1sX1VzZXJFeGNlcHRpb25zIGFuZCBpbmNsdWRlIGFuIEV4Y2VwdGlvblJlc291cmNlSWQgd2lsbCBiZSBjb21wYXJlZCBmb3IgYWxsIHJ1bnMuDQoNCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgIHB1YmxpYyBjbGFzcyBYc2x0UnVudGltZUV4Y2VwdGlvbg0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgWE1MVVNFUkVYID0gIlhtbF9Vc2VyRXhjZXB0aW9uIjsNCg0KICAgICAgICBwcml2YXRlIFhzbHRSdW50aW1lRXhjZXB0aW9uKCkNCiAgICAgICAgew0KICAgICAgICB9IC8vIG5vIG9wLCBkbyBub3QgY2FsbA0KDQogICAgICAgIHB1YmxpYyBYc2x0UnVudGltZUV4Y2VwdGlvbihzdHJpbmcgYSwgYm9vbCBkKQ0KICAgICAgICAgICAgOiB0aGlzKGEsIFhNTFVTRVJFWCwgU3RyaW5nLkVtcHR5LCBkKQ0KICAgICAgICB7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgWHNsdFJ1bnRpbWVFeGNlcHRpb24oc3RyaW5nIGEsIHN0cmluZyBiLCBzdHJpbmcgYywgYm9vbCBkKQ0KICAgICAgICB7DQogICAgICAgICAgICBFeGNlcHRpb25JZCA9IGE7DQogICAgICAgICAgICBSZXNvdXJjZUlkID0gYjsNCiAgICAgICAgICAgIE1lc3NhZ2VGcmFnbWVudCA9IGM7DQogICAgICAgICAgICBfZXhhbWluZU1lc3NhZ2VzID0gZDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdHJpbmcgRXhjZXB0aW9uSWQ7DQogICAgICAgIHB1YmxpYyBzdHJpbmcgUmVzb3VyY2VJZDsNCiAgICAgICAgcHVibGljIHN0cmluZyBNZXNzYWdlRnJhZ21lbnQ7DQogICAgICAgIHByaXZhdGUgYm9vbCBfZXhhbWluZU1lc3NhZ2VzOw0KDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgVG9TdHJpbmcoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gRXhjZXB0aW9uSWQgKyAiXG4iICsgUmVzb3VyY2VJZCArICJcbiIgKyBNZXNzYWdlRnJhZ21lbnQ7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgaW50IEdldEhhc2hDb2RlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIGJhc2UuR2V0SGFzaENvZGUoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFRoZSBFcXVhbHMgbWV0aG9kIG11c3QgYWx3YXlzIGJlIHVzZWQgdGhpcyB3YXkNCiAgICAgICAgLy8gRXhwZWN0ZWRFeGNlcHRpb24uRXF1YWxzKCBBY3R1YWxFeGNlcHRpb24gKT8NCiAgICAgICAgLy8gUGxlYXNlIG5vdGUgdGhhdCBpZiBFeGFtaW5lTWVzc2FnZXMgaXMgdHJ1ZSwgd2UgYXJlIGluIGEgbm9uLWxvY2FsaXplZCBidWlsZCBhbmQgd2UgY2FuIHNhZmVseSBleGFtaW5lIGV4Y2VwdGlvbiBtZXNzYWdlcy4gSWYgZmFsc2UsIHdlIGZhbGwgYmFjayB0byB0eXBlIGNvbXBhcmlzb24gZXhjbHVzaXZlbHkuDQogICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIEVxdWFscyhvYmplY3QgbykNCiAgICAgICAgew0KICAgICAgICAgICAgWHNsdFJ1bnRpbWVFeGNlcHRpb24gb2JqZWN0VG9Db21wYXJlVG8gPSBvIGFzIFhzbHRSdW50aW1lRXhjZXB0aW9uOw0KDQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQob2JqZWN0VG9Db21wYXJlVG8gIT0gbnVsbCk7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQob2JqZWN0VG9Db21wYXJlVG8uRXhjZXB0aW9uSWQgIT0gbnVsbCwgIkV4Y2VwdGlvbklkIG11c3QgYmUgaW5pdGlhbGl6ZWQgdG8gYSB2YWxpZCBmdWxseSBxdWFsaWZpZWQgdHlwZSBuYW1lIik7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQob2JqZWN0VG9Db21wYXJlVG8uUmVzb3VyY2VJZCAhPSBudWxsLCAiUmVzb3VyY2VJZCBtdXN0IGJlIGluaXRpYWxpemVkIHRvIFN0cmluZy5FbXB0eSwgaW4gd2hpY2ggY2FzZSBNZXNzYWdlRnJhZ21lbnQgaXMgdXNlZCwgb3IgYSBsZWdhbCByZXNvdXJjZSBJZCIpOw0KICAgICAgICAgICAgRGVidWcuQXNzZXJ0KG9iamVjdFRvQ29tcGFyZVRvLk1lc3NhZ2VGcmFnbWVudCAhPSBudWxsLCAiTWVzc2FnZUZyYWdtZW50IG11c3QgYmUgaW5pdGlhbGl6ZWQgdG8gU3RyaW5nLkVtcHR5LCBpbiB3aGljaCBjYXNlIFJlc291cmNlSWQgaXMgdXNlZCwgb3IgYSBzdHJpbmcgdGhhdCByZXByZXNlbnRzIGEgc3BlY2lmaWMgZXhjZXB0aW9uIG1lc3NhZ2UuIik7DQogICAgICAgICAgICBEZWJ1Zy5Bc3NlcnQodGhpcy5FeGNlcHRpb25JZCAhPSBudWxsLCAiRXhjZXB0aW9uSWQgbXVzdCBiZSBpbml0aWFsaXplZCB0byBhIHZhbGlkIGZ1bGx5IHF1YWxpZmllZCB0eXBlIG5hbWUiKTsNCiAgICAgICAgICAgIERlYnVnLkFzc2VydCh0aGlzLlJlc291cmNlSWQgIT0gbnVsbCwgIlJlc291cmNlSWQgbXVzdCBiZSBpbml0aWFsaXplZCB0byBTdHJpbmcuRW1wdHksIGluIHdoaWNoIGNhc2UgTWVzc2FnZUZyYWdtZW50IGlzIHVzZWQsIG9yIGEgbGVnYWwgcmVzb3VyY2UgSWQiKTsNCiAgICAgICAgICAgIERlYnVnLkFzc2VydCh0aGlzLk1lc3NhZ2VGcmFnbWVudCAhPSBudWxsLCAiTWVzc2FnZUZyYWdtZW50IG11c3QgYmUgaW5pdGlhbGl6ZWQgdG8gU3RyaW5nLkVtcHR5LCBpbiB3aGljaCBjYXNlIFJlc291cmNlSWQgaXMgdXNlZCwgb3IgYSBzdHJpbmcgdGhhdCByZXByZXNlbnRzIGEgc3BlY2lmaWMgZXhjZXB0aW9uIG1lc3NhZ2UuIik7DQoNCiAgICAgICAgICAgIC8vIEluc2lkZSB0aGlzIGJsb2NrLCB3ZSBoYXZlIHR3byBwcm9wZXJseSBpbml0aWFsaXplZCBYc2x0UnVudGltZUV4Y2VwdGlvbnMgdG8gY29tcGFyZS4NCg0KICAgICAgICAgICAgLy8vLy8NCiAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBzZXZlcmFsIGJhc2ljIGNvbXBhcmlzb25zLCBlYWNoIHdpdGggaXRzIG93biBkZWdyZWUgb2YgY2VydGFpbnR5Lg0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIC8vIFRoZSBmaXJzdCBjb21wYXJpc29uIGlzIHRoZSBvcmlnaW5hbCB1c2VkIGJ5IHRoZSBkcml2ZXIsIHdoaWNoIHdlIG5vIGxvbmdlciB1c2U6IGlmIHRoZXJlIGlzIGFueQ0KICAgICAgICAgICAgLy8gICAgIGV4Y2VwdGlvbiBhdCBhbGwgZm9yIGFuIGV4cGVjdGVkICJJbnZhbGlkIiBjYXNlLCB3ZSBtYXRjaC4NCiAgICAgICAgICAgIC8vDQogICAgICAgICAgICAvLyBUaGUgc2Vjb25kIGNvbXBhcmlzb24gaXMgdGhlIGluaXRpYWwgcmV2aXNpb24gdG8gdGhlIGRyaXZlcjogYW4gRXhjZXB0aW9uIHR5cGUgY29tcGFyaXNvbi4gVGhpcyBpcyB0aGUgbGVhc3QgY2VydGFpbi4NCiAgICAgICAgICAgIC8vICAgICB0eXBlIG1hdGNoZXMgc2hvdWxkIG5vIGxvbmdlciBleGlzdCBvbmNlIHRoaXMgZXhjZXB0aW9uIHdvcmsgaXMgY29tcGxldGUuIFRoZXNlIHdpbGwgYmUgZmxhZ2dlZCBieSBmYWlsaW5nIHRoZSB0ZXN0Lg0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIC8vIFRoZSB0aGlyZCBjb21wYXJpc29uIGlzIGZvciBYbWxfVXNlckV4Y2VwdGlvbnMuIEluIHRoaXMgY2FzZSB3ZSB0cnkgdG8gY29tcGFyZSB0aGUgRXhjZXB0aW9uIFR5cGUgYW5kIEV4Y2VwdGlvbiBNZXNzYWdlLg0KICAgICAgICAgICAgLy8gICAgIElmIHRoZSBFeGNlcHRpb24gdHlwZSBkb2VzIG5vdCBtYXRjaCwgYnV0IHRoZSBtZXNzYWdlIGRvZXMsIHdlIGNvdW50IHRoYXQgYXMgYSBtYXRjaC4gTm90ZSB0aGF0IHRoaXMgbWF0Y2ggaXMgTk9UDQogICAgICAgICAgICAvLyAgICAgaW1tdWUgdG8gdGhlIGVmZmVjdHMgb2YgZ2xvYmFsaXplZCByZXNvdXJjZSBzdHJpbmdzLCBhbmQgaGVuY2UgaXMgbGVzcyBjZXJ0YWluLg0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIC8vIFRoZSBmb3VydGggY29tcGFyaXNvbiBpcyBmb3IgTk9OIFhtbF9Vc2VyRXhjZXB0aW9ucy4gSW4gdGhpcyBjYXNlIHdlIHRyeSB0byBjb21wYXJlIHRoZSBFeGNlcHRpb24gVHlwZSBhbmQgUmVzb3VyY2VJZC4NCiAgICAgICAgICAgIC8vICAgICBJZiB0aGUgRXhjZXB0aW9uIHR5cGUgZG9lcyBub3QgbWF0Y2gsIGJ1dCB0aGUgcmVzb3VyY2UgaWQgZG9lcywgd2UgY291bnQgdGhhdCBhIG1hdGNoLiBOb3RlIHRoYXQgdGhpcyBtYXRjaCBpcw0KICAgICAgICAgICAgLy8gICAgIGltbXVuZSB0byB0aGUgZWZmZWN0cyBvZiBnbG9iYWxpemVkIHJlc291cmNlIHN0cmluZ3MuIEl0IGlzIHRoZSBtb3N0IGNlcnRhaW4gbWF0Y2ggd2UgY2FuIG1ha2UuDQogICAgICAgICAgICAvLw0KICAgICAgICAgICAgLy8vLy8NCiAgICAgICAgICAgIGlmICghSXNYbWxFeGNlcHRpb24odGhpcy5FeGNlcHRpb25JZCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gQXllLCBoZXJlJ3MgdGhlIGRpbGxlbWEuIElmIGl0cyBub3QgYW4gWE1MIGV4Y2VwdGlvbiB3ZSBjYW4ndCBsb29rIHVwIGl0cyByZXNvdXJjZSBJRC4NCiAgICAgICAgICAgICAgICAvLyBTbyBpbiB0aGVzZSBjYXNlcyAodmVyeSByYXJlIGFueXdheSkgd2UgcmV2ZXJ0IHRvIHRoZSBvbGQgc2ltcGxlIGRheXMgb2YgY29tcGFyaW5nIHR5cGUgdG8gdHlwZS4NCiAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0VG9Db21wYXJlVG8uRXhjZXB0aW9uSWQuRXF1YWxzKHRoaXMuRXhjZXB0aW9uSWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICghb2JqZWN0VG9Db21wYXJlVG8uUmVzb3VyY2VJZC5FcXVhbHMoU3RyaW5nLkVtcHR5KSAmJiAhb2JqZWN0VG9Db21wYXJlVG8uUmVzb3VyY2VJZC5FcXVhbHMoWE1MVVNFUkVYKSAmJg0KICAgICAgICAgICAgICAgICAgICBvYmplY3RUb0NvbXBhcmVUby5SZXNvdXJjZUlkLkVxdWFscyh0aGlzLlJlc291cmNlSWQpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8qKioqIFRoZSBoaWdoZXN0IGRlZ3JlZSBvZiBjZXJ0YWludHkgd2UgaGF2ZS4gKioqKi8vDQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdFRvQ29tcGFyZVRvLkV4Y2VwdGlvbklkLkVxdWFscyh0aGlzLkV4Y2VwdGlvbklkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAvLyBSZXNvdXJjZUlkcyBtYXRjaCwgYnV0IEV4Y2VwdGlvbiB0eXBlcyBkb250Lg0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIENFcnJvci5Xcml0ZUxpbmUoIm1hdGNoP1xuIHswfSBcbmNvbXBhcmUgdG8gXG4gezF9IFxuIHBscyBpbnZlc3RpZ2F0ZSB3aHkgdGhpcyByZXNvdXJjZSBpZCBpcyBiZWluZyB0aHJvd24gaW4gMiBkaWZmZXJldCBleGNlcHRpb25zIiwgb2JqZWN0VG9Db21wYXJlVG8uVG9TdHJpbmcoKSwgdGhpcy5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIFJlc291cmNlSWQgaXMgRW1wdHkgb3IgWG1sX1VzZXJFeGNlcHRpb24sIG9yIHRoZXkgZG9udCBtYXRjaA0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLk1lc3NhZ2VGcmFnbWVudC5FcXVhbHMoU3RyaW5nLkVtcHR5KSAmJiBfZXhhbWluZU1lc3NhZ2VzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdFRvQ29tcGFyZVRvLlJlc291cmNlSWQuRXF1YWxzKHRoaXMuUmVzb3VyY2VJZCkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdFRvQ29tcGFyZVRvLk1lc3NhZ2VGcmFnbWVudC5Db250YWlucyh0aGlzLk1lc3NhZ2VGcmFnbWVudCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vKioqKiBWZXJ5IGhpZ2ggY2VydGFpbnR5IGVxdWl2YWxlbmNlICoqKiovLw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0VG9Db21wYXJlVG8uRXhjZXB0aW9uSWQuRXF1YWxzKHRoaXMuRXhjZXB0aW9uSWQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBNZXNzYWdlcyBtYXRjaCwgYnV0IEV4Y2VwdGlvbiB0eXBlcyBkb250Lg0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENFcnJvci5Xcml0ZUxpbmUoIm1hdGNoPyhtZXNzYWdlIG1hdGNoZXMgYnV0IGV4YWN0IHR5cGVuYW1lIGRvZXNuJ3QpXG4gezB9IFxuY29tcGFyZSB0byBcbiB7MX0gIiwgb2JqZWN0VG9Db21wYXJlVG8uVG9TdHJpbmcoKSwgdGhpcy5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIGZvciBub3cuDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gUmVzb3VyY2VJZCBpcyBFbXB0eSBvciBYbWxfVXNlckV4Y2VwdGlvbiBvciB0aGV5IGRvbnQgbWF0Y2gsIE1lc3NhZ2UgaXMgRW1wdHkgb3IgdGhleSBkb250IG1hdGNoDQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8qKioqIExvd2VyIGRlZ3JlZSBvZiBjZXJ0YWludHkgKioqKi8vDQogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYW4gZXhjZXB0aW9uIHRoYXQgaGFzIG5vdCB5ZXQgYmVlbiB1cGRhdGVkIGluIHRoZSBjb250cm9sIGZpbGUgd2l0aCBjb21wbGV0ZSBpbmZvcm1hdGlvbi4NCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBvbGRlciwgbGVzcyBmbGV4aWJsZSBjb21wYXJpc29uIGxvZ2ljLg0KICAgICAgICAgICAgICAgICAgICBDRXJyb3IuV3JpdGVMaW5lKCJvbGQgY29tcGFyaXNvbjp7MH0gXG5jb21wYXJlIHRvIFxuIHsxfSAiLCBvYmplY3RUb0NvbXBhcmVUby5Ub1N0cmluZygpLCB0aGlzLlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0VG9Db21wYXJlVG8uRXhjZXB0aW9uSWQuRXF1YWxzKHRoaXMuRXhjZXB0aW9uSWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgQXJyYXlMaXN0IFhtbEV4Y2VwdGlvbkxpc3QgPSBuZXcgQXJyYXlMaXN0KDUpOw0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgc2V0WG1sRXhjZXB0aW9uTGlzdCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIFhtbEV4Y2VwdGlvbkxpc3QuQWRkKCJTeXN0ZW0uWG1sLlhzbC5YUGF0aC5YUGF0aENvbXBpbGVFeGNlcHRpb24iKTsNCiAgICAgICAgICAgIFhtbEV4Y2VwdGlvbkxpc3QuQWRkKCJTeXN0ZW0uWG1sLlhzbC5Yc2xMb2FkRXhjZXB0aW9uIik7DQogICAgICAgICAgICBYbWxFeGNlcHRpb25MaXN0LkFkZCgiU3lzdGVtLlhtbC5Yc2wuWHNsVHJhbnNmb3JtRXhjZXB0aW9uIik7DQogICAgICAgICAgICBYbWxFeGNlcHRpb25MaXN0LkFkZCgiU3lzdGVtLlhtbC5Yc2wuWHNsdEV4Y2VwdGlvbiIpOw0KICAgICAgICAgICAgWG1sRXhjZXB0aW9uTGlzdC5BZGQoIlN5c3RlbS5YbWwuWG1sRXhjZXB0aW9uIik7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgSXNYbWxFeGNlcHRpb24oc3RyaW5nIHR5cGVOYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICBzZXRYbWxFeGNlcHRpb25MaXN0KCk7DQogICAgICAgICAgICByZXR1cm4gWG1sRXhjZXB0aW9uTGlzdC5Db250YWlucyh0eXBlTmFtZSk7DQogICAgICAgIH0NCiAgICB9DQp9DQo="
        }
      },
      "results": [
        {
          "ruleId": "cs/unsynchronized-static-access",
          "level": "warning",
          "message": "Unsynchronized access to [s_primitiveTypes] in non-static context from [XmlSerializer].",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Serialization/Types.cs",
                "region": {
                  "startLine": 705,
                  "startColumn": 30,
                  "length": 22
                }
              }
            }
          ],
          "relatedLocations": [
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Serialization/Types.cs",
                "region": {
                  "startLine": 472,
                  "startColumn": 25,
                  "length": 16
                }
              },
              "message": "s_primitiveTypes"
            },
            {
              "physicalLocation": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Serialization/XmlSerializer.cs",
                "region": {
                  "startLine": 252,
                  "startColumn": 7,
                  "length": 13
                }
              },
              "message": "XmlSerializer"
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Core/XmlValidatingReaderImpl.cs",
                "region": {
                  "startLine": 163,
                  "startColumn": 7,
                  "length": 49
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Core/XmlValidatingReaderImpl.cs",
                "region": {
                  "startLine": 181,
                  "startColumn": 7,
                  "length": 49
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Dom/XmlDocument.cs",
                "region": {
                  "startLine": 1209,
                  "startColumn": 35,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Dom/XmlDocument.cs",
                "region": {
                  "startLine": 1222,
                  "startColumn": 35,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Dom/XmlDocument.cs",
                "region": {
                  "startLine": 1236,
                  "startColumn": 35,
                  "length": 39
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Dom/XmlDocument.cs",
                "region": {
                  "startLine": 1275,
                  "startColumn": 35,
                  "length": 51
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/SchemaCollectionpreProcessor.cs",
                "region": {
                  "startLine": 227,
                  "startColumn": 23,
                  "length": 53
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XdrBuilder.cs",
                "region": {
                  "startLine": 524,
                  "startColumn": 9,
                  "length": 51
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XdrValidator.cs",
                "region": {
                  "startLine": 336,
                  "startColumn": 9,
                  "length": 50
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XmlSchema.cs",
                "region": {
                  "startLine": 81,
                  "startColumn": 12,
                  "length": 25
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XmlSchema.cs",
                "region": {
                  "startLine": 90,
                  "startColumn": 12,
                  "length": 25
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XmlSchemaCollection.cs",
                "region": {
                  "startLine": 110,
                  "startColumn": 23,
                  "length": 34
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/Schema/XsdValidator.cs",
                "region": {
                  "startLine": 569,
                  "startColumn": 9,
                  "length": 50
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/src/System/Xml/XPath/XPathNavigator.cs",
                "region": {
                  "startLine": 2093,
                  "startColumn": 23,
                  "length": 52
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlReader/Tests/BaseUriTests.cs",
                "region": {
                  "startLine": 22,
                  "startColumn": 55,
                  "length": 20
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlReader/Tests/BaseUriTests.cs",
                "region": {
                  "startLine": 23,
                  "startColumn": 55,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlReader/Tests/BaseUriTests.cs",
                "region": {
                  "startLine": 24,
                  "startColumn": 55,
                  "length": 56
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 35,
                  "startColumn": 23,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 46,
                  "startColumn": 23,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 82,
                  "startColumn": 24,
                  "length": 36
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 83,
                  "startColumn": 24,
                  "length": 36
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 96,
                  "startColumn": 24,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 97,
                  "startColumn": 24,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 59,
                  "startColumn": 23,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 73,
                  "startColumn": 23,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 113,
                  "startColumn": 24,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Reader.cs",
                "region": {
                  "startLine": 124,
                  "startColumn": 23,
                  "length": 37
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs",
                "region": {
                  "startLine": 213,
                  "startColumn": 35,
                  "length": 24
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs",
                "region": {
                  "startLine": 214,
                  "startColumn": 35,
                  "length": 24
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs",
                "region": {
                  "startLine": 254,
                  "startColumn": 18,
                  "length": 72
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs",
                "region": {
                  "startLine": 258,
                  "startColumn": 19,
                  "length": 69
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs",
                "region": {
                  "startLine": 282,
                  "startColumn": 19,
                  "length": 69
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs",
                "region": {
                  "startLine": 324,
                  "startColumn": 18,
                  "length": 72
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs",
                "region": {
                  "startLine": 328,
                  "startColumn": 19,
                  "length": 69
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Add_Schema.cs",
                "region": {
                  "startLine": 358,
                  "startColumn": 19,
                  "length": 69
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Misc.cs",
                "region": {
                  "startLine": 69,
                  "startColumn": 27,
                  "length": 64
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Misc.cs",
                "region": {
                  "startLine": 421,
                  "startColumn": 13,
                  "length": 40
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Misc.cs",
                "region": {
                  "startLine": 439,
                  "startColumn": 13,
                  "length": 41
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Misc.cs",
                "region": {
                  "startLine": 441,
                  "startColumn": 13,
                  "length": 41
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_Misc.cs",
                "region": {
                  "startLine": 888,
                  "startColumn": 21,
                  "length": 64
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_ProhibitDTD.cs",
                "region": {
                  "startLine": 248,
                  "startColumn": 13,
                  "length": 66
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_ValidationEventHandler.cs",
                "region": {
                  "startLine": 94,
                  "startColumn": 22,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSchema/XmlSchemaSet/TC_SchemaSet_ValidationEventHandler.cs",
                "region": {
                  "startLine": 115,
                  "startColumn": 19,
                  "length": 38
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSerializer/XmlSerializerTests.RuntimeOnly.cs",
                "region": {
                  "startLine": 1786,
                  "startColumn": 20,
                  "length": 21
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSerializer/XmlSerializerTests.RuntimeOnly.cs",
                "region": {
                  "startLine": 1979,
                  "startColumn": 23,
                  "length": 21
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/XmlSerializer/XmlSerializerTests.cs",
                "region": {
                  "startLine": 1798,
                  "startColumn": 20,
                  "length": 21
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/TempFiles.cs",
                "region": {
                  "startLine": 97,
                  "startColumn": 15,
                  "length": 48
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XslCompiledTransform.cs",
                "region": {
                  "startLine": 2989,
                  "startColumn": 19,
                  "length": 33
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XsltApiV2.cs",
                "region": {
                  "startLine": 281,
                  "startColumn": 23,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XsltApiV2.cs",
                "region": {
                  "startLine": 368,
                  "startColumn": 23,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XsltApiV2.cs",
                "region": {
                  "startLine": 449,
                  "startColumn": 20,
                  "length": 28
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XsltApiV2.cs",
                "region": {
                  "startLine": 450,
                  "startColumn": 20,
                  "length": 50
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XsltApiV2.cs",
                "region": {
                  "startLine": 479,
                  "startColumn": 22,
                  "length": 57
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslCompiledTransformApi/XsltApiV2.cs",
                "region": {
                  "startLine": 479,
                  "startColumn": 81,
                  "length": 59
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXmlCache.cs",
                "region": {
                  "startLine": 774,
                  "startColumn": 17,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXslTransform.cs",
                "region": {
                  "startLine": 1463,
                  "startColumn": 53,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXslTransform.cs",
                "region": {
                  "startLine": 1492,
                  "startColumn": 53,
                  "length": 48
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXslTransform.cs",
                "region": {
                  "startLine": 1518,
                  "startColumn": 53,
                  "length": 71
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXslTransform.cs",
                "region": {
                  "startLine": 1543,
                  "startColumn": 37,
                  "length": 47
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXslTransform.cs",
                "region": {
                  "startLine": 1581,
                  "startColumn": 53,
                  "length": 48
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/CXslTransform.cs",
                "region": {
                  "startLine": 1778,
                  "startColumn": 53,
                  "length": 71
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs",
                "region": {
                  "startLine": 317,
                  "startColumn": 23,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs",
                "region": {
                  "startLine": 357,
                  "startColumn": 53,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs",
                "region": {
                  "startLine": 381,
                  "startColumn": 53,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs",
                "region": {
                  "startLine": 414,
                  "startColumn": 23,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs",
                "region": {
                  "startLine": 454,
                  "startColumn": 53,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs",
                "region": {
                  "startLine": 478,
                  "startColumn": 53,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs",
                "region": {
                  "startLine": 506,
                  "startColumn": 27,
                  "length": 30
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XslTransformApi/XSLTransform.cs",
                "region": {
                  "startLine": 507,
                  "startColumn": 27,
                  "length": 50
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XsltCompiler/XsltCommon.cs",
                "region": {
                  "startLine": 83,
                  "startColumn": 13,
                  "length": 61
                }
              }
            }
          ]
        },
        {
          "ruleId": "cs/insecure-xml-read",
          "level": "warning",
          "message": "Insecure XML processing: DTD processing is enabled by default, and resolver is insecure by default",
          "locations": [
            {
              "resultFile": {
                "uri": "file:///C:/corefx/src/System.Private.Xml/tests/Xslt/XsltCompiler/XsltCommon.cs",
                "region": {
                  "startLine": 84,
                  "startColumn": 1,
                  "length": 63
                }
              }
            }
          ]
        }
      ],
      "rules": {
        "cs/ldap-injection": {
          "id": "cs/ldap-injection",
          "name": "cs/ldap-injection",
          "shortDescription": "LDAP query built from user-controlled sources",
          "fullDescription": "Building an LDAP query from user-controlled sources is vulnerable to insertion of malicious LDAP code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-090"
],
            "kind": "problem",
            "precision": "medium",
            "name": "LDAP query built from user-controlled sources",
            "description": "Building an LDAP query from user-controlled sources is vulnerable to insertion of malicious LDAP code by the user.",
            "id": "cs/ldap-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-090/LDAPInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/xml/xpath-injection": {
          "id": "cs/xml/xpath-injection",
          "name": "cs/xml/xpath-injection",
          "shortDescription": "XPath injection",
          "fullDescription": "Building an XPath expression from user-controlled sources is vulnerable to insertion of malicious code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-643"
],
            "kind": "problem",
            "precision": "medium",
            "name": "XPath injection",
            "description": "Building an XPath expression from user-controlled sources is vulnerable to insertion of malicious code by the user.",
            "id": "cs/xml/xpath-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-643/XPathInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/command-line-injection": {
          "id": "cs/command-line-injection",
          "name": "cs/command-line-injection",
          "shortDescription": "Uncontrolled command line",
          "fullDescription": "Using externally controlled strings in a command line may allow a malicious user to change the meaning of the command.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "correctness",
  "security",
  "external/cwe/cwe-078",
  "external/cwe/cwe-088"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Uncontrolled command line",
            "description": "Using externally controlled strings in a command line may allow a malicious user to change the meaning of the command.",
            "id": "cs/command-line-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-078/CommandInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/directory-browse-enabled": {
          "id": "cs/web/directory-browse-enabled",
          "name": "cs/web/directory-browse-enabled",
          "shortDescription": "ASP.NET config file enables directory browsing",
          "fullDescription": "Directory browsing should not be enabled in production as it can leak sensitive information.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-548"
],
            "kind": "problem",
            "precision": "very-high",
            "name": "ASP.NET config file enables directory browsing",
            "description": "Directory browsing should not be enabled in production as it can leak sensitive information.",
            "id": "cs/web/directory-browse-enabled",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-548/ASPNetDirectoryListing.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/unvalidated-url-redirection": {
          "id": "cs/web/unvalidated-url-redirection",
          "name": "cs/web/unvalidated-url-redirection",
          "shortDescription": "URL redirection from remote source",
          "fullDescription": "URL redirection based on unvalidated user input may cause redirection to malicious web sites.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-601"
],
            "kind": "problem",
            "precision": "medium",
            "name": "URL redirection from remote source",
            "description": "URL redirection based on unvalidated user input may cause redirection to malicious web sites.",
            "id": "cs/web/unvalidated-url-redirection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-601/UrlRedirect.ql",
            "problem.severity": "error"
          }
        },
        "cs/path-injection": {
          "id": "cs/path-injection",
          "name": "cs/path-injection",
          "shortDescription": "Uncontrolled data used in path expression",
          "fullDescription": "Accessing paths influenced by users can allow an attacker to access unexpected resources.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-022",
  "external/cwe/cwe-023",
  "external/cwe/cwe-036",
  "external/cwe/cwe-073",
  "external/cwe/cwe-099"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Uncontrolled data used in path expression",
            "description": "Accessing paths influenced by users can allow an attacker to access unexpected resources.",
            "id": "cs/path-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-022/TaintedPath.ql",
            "problem.severity": "error"
          }
        },
        "cs/user-controlled-bypass": {
          "id": "cs/user-controlled-bypass",
          "name": "cs/user-controlled-bypass",
          "shortDescription": "User-controlled bypass of sensitive method",
          "fullDescription": "User-controlled bypassing of sensitive methods may allow attackers to avoid passing through authentication systems.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-807",
  "external/cwe/cwe-247",
  "external/cwe/cwe-350"
],
            "kind": "problem",
            "precision": "medium",
            "name": "User-controlled bypass of sensitive method",
            "description": "User-controlled bypassing of sensitive methods may allow attackers to avoid passing through authentication systems.",
            "id": "cs/user-controlled-bypass",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-807/ConditionalBypass.ql",
            "problem.severity": "error"
          }
        },
        "cs/sensitive-data-transmission": {
          "id": "cs/sensitive-data-transmission",
          "name": "cs/sensitive-data-transmission",
          "shortDescription": "Information exposure through transmitted data",
          "fullDescription": "Transmitting sensitive information to the user is a potential security risk.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-201"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Information exposure through transmitted data",
            "description": "Transmitting sensitive information to the user is a potential security risk.",
            "id": "cs/sensitive-data-transmission",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-201/ExposureInTransmittedData.ql",
            "problem.severity": "error"
          }
        },
        "cs/inappropriate-encoding": {
          "id": "cs/inappropriate-encoding",
          "name": "cs/inappropriate-encoding",
          "shortDescription": "Inappropriate encoding",
          "fullDescription": "Using an inappropriate encoding may give unintended results and may pose a security risk.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-838"
],
            "kind": "problem",
            "precision": "low",
            "name": "Inappropriate encoding",
            "description": "Using an inappropriate encoding may give unintended results and may pose a security risk.",
            "id": "cs/inappropriate-encoding",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-838/InappropriateEncoding.ql",
            "problem.severity": "error"
          }
        },
        "cs/hardcoded-credentials": {
          "id": "cs/hardcoded-credentials",
          "name": "cs/hardcoded-credentials",
          "shortDescription": "Hard-coded credentials",
          "fullDescription": "Credentials are hard coded in the source code of the application.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-259",
  "external/cwe/cwe-321",
  "external/cwe/cwe-798"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Hard-coded credentials",
            "description": "Credentials are hard coded in the source code of the application.",
            "id": "cs/hardcoded-credentials",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-798/HardcodedCredentials.ql",
            "problem.severity": "error"
          }
        },
        "cs/insecure-randomness": {
          "id": "cs/insecure-randomness",
          "name": "cs/insecure-randomness",
          "shortDescription": "Insecure randomness",
          "fullDescription": "Using a cryptographically weak pseudo-random number generator to generate a security sensitive value may allow an attacker to predict what sensitive value will be generated.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-338"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Insecure randomness",
            "description": "Using a cryptographically weak pseudo-random number generator to generate a security sensitive value may allow an attacker to predict what sensitive value will be generated.",
            "id": "cs/insecure-randomness",
            "query-path": "/semmlecode-csharp-queries/Security Features/InsecureRandomness.ql",
            "problem.severity": "warning"
          }
        },
        "cs/empty-password-in-configuration": {
          "id": "cs/empty-password-in-configuration",
          "name": "cs/empty-password-in-configuration",
          "shortDescription": "Empty password in configuration file",
          "fullDescription": "Finds empty passwords in configuration files.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-258",
  "external/cwe/cwe-862"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Empty password in configuration file",
            "description": "Finds empty passwords in configuration files.",
            "id": "cs/empty-password-in-configuration",
            "query-path": "/semmlecode-csharp-queries/Configuration/EmptyPasswordInConfigurationFile.ql",
            "problem.severity": "warning"
          }
        },
        "cs/information-exposure-through-exception": {
          "id": "cs/information-exposure-through-exception",
          "name": "cs/information-exposure-through-exception",
          "shortDescription": "Information exposure through an exception",
          "fullDescription": "Leaking information about an exception, such as messages and stack traces, to an external user can expose implementation details that are useful to an attacker for developing a subsequent exploit.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-209",
  "external/cwe/cwe-497"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Information exposure through an exception",
            "description": "Leaking information about an exception, such as messages and stack traces, to an external user can expose implementation details that are useful to an attacker for developing a subsequent exploit.",
            "id": "cs/information-exposure-through-exception",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-209/ExceptionInformationExposure.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/missing-token-validation": {
          "id": "cs/web/missing-token-validation",
          "name": "cs/web/missing-token-validation",
          "shortDescription": "Missing cross-site request forgery token validation",
          "fullDescription": "Handling a POST request without verifying that the request came from the user allows a malicious attacker to submit a request on behalf of the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-352"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Missing cross-site request forgery token validation",
            "description": "Handling a POST request without verifying that the request came from the user allows a malicious attacker to submit a request on behalf of the user.",
            "id": "cs/web/missing-token-validation",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-352/MissingAntiForgeryTokenValidation.ql",
            "problem.severity": "error"
          }
        },
        "cs/second-order-sql-injection": {
          "id": "cs/second-order-sql-injection",
          "name": "cs/second-order-sql-injection",
          "shortDescription": "SQL query built from stored user-controlled sources",
          "fullDescription": "Building a SQL query from stored user-controlled sources is vulnerable to insertion of malicious SQL code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-089"
],
            "kind": "problem",
            "precision": "medium",
            "name": "SQL query built from stored user-controlled sources",
            "description": "Building a SQL query from stored user-controlled sources is vulnerable to insertion of malicious SQL code by the user.",
            "id": "cs/second-order-sql-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-089/SecondOrderSqlInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/unsynchronized-static-access": {
          "id": "cs/unsynchronized-static-access",
          "name": "cs/unsynchronized-static-access",
          "shortDescription": "Unsynchronized access to static collection member in non-static context",
          "fullDescription": "If an unsynchronized access to a static collection member occurs during an addition or resizing operation, an infinite loop can occur.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "concurrency",
  "external/cwe/cwe-362",
  "external/cwe/cwe-567"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Unsynchronized access to static collection member in non-static context",
            "description": "If an unsynchronized access to a static collection member occurs during an addition or resizing operation, an infinite loop can occur.",
            "id": "cs/unsynchronized-static-access",
            "query-path": "/semmlecode-csharp-queries/Concurrency/UnsynchronizedStaticAccess.ql",
            "problem.severity": "error"
          }
        },
        "cs/insufficient-key-size": {
          "id": "cs/insufficient-key-size",
          "name": "cs/insufficient-key-size",
          "shortDescription": "Weak encryption: Insufficient key size",
          "fullDescription": "Finds uses of encryption algorithms with too small a key size",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-327"
],
            "kind": "problem",
            "precision": "high",
            "name": "Weak encryption: Insufficient key size",
            "description": "Finds uses of encryption algorithms with too small a key size",
            "id": "cs/insufficient-key-size",
            "query-path": "/semmlecode-csharp-queries/Security Features/InsufficientKeySize.ql",
            "problem.severity": "warning"
          }
        },
        "cs/stored-command-line-injection": {
          "id": "cs/stored-command-line-injection",
          "name": "cs/stored-command-line-injection",
          "shortDescription": "Uncontrolled command line from stored user input",
          "fullDescription": "Using externally controlled strings in a command line may allow a malicious user to change the meaning of the command.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "correctness",
  "security",
  "external/cwe/cwe-078",
  "external/cwe/cwe-088"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Uncontrolled command line from stored user input",
            "description": "Using externally controlled strings in a command line may allow a malicious user to change the meaning of the command.",
            "id": "cs/stored-command-line-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-078/StoredCommandInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/ecb-encryption": {
          "id": "cs/ecb-encryption",
          "name": "cs/ecb-encryption",
          "shortDescription": "Encryption using ECB",
          "fullDescription": "Highlights uses of the encryption mode 'CipherMode.ECB'. This mode should normally not be used because it is vulnerable to replay attacks.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-327"
],
            "kind": "problem",
            "precision": "high",
            "name": "Encryption using ECB",
            "description": "Highlights uses of the encryption mode \u0027CipherMode.ECB\u0027. This mode should normally not be used because it is vulnerable to replay attacks.",
            "id": "cs/ecb-encryption",
            "query-path": "/semmlecode-csharp-queries/Security Features/Encryption using ECB.ql",
            "problem.severity": "warning"
          }
        },
        "cs/inadequate-rsa-padding": {
          "id": "cs/inadequate-rsa-padding",
          "name": "cs/inadequate-rsa-padding",
          "shortDescription": "Weak encryption: inadequate RSA padding",
          "fullDescription": "Finds uses of RSA encryption with inadequate padding.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-327",
  "external/cwe/cwe-780"
],
            "kind": "problem",
            "precision": "high",
            "name": "Weak encryption: inadequate RSA padding",
            "description": "Finds uses of RSA encryption with inadequate padding.",
            "id": "cs/inadequate-rsa-padding",
            "query-path": "/semmlecode-csharp-queries/Security Features/InadequateRSAPadding.ql",
            "problem.severity": "warning"
          }
        },
        "cs/cleartext-storage-of-sensitive-information": {
          "id": "cs/cleartext-storage-of-sensitive-information",
          "name": "cs/cleartext-storage-of-sensitive-information",
          "shortDescription": "Clear text storage of sensitive information",
          "fullDescription": "Sensitive information stored without encryption or hashing can expose it to an attacker.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-312",
  "external/cwe/cwe-315",
  "external/cwe/cwe-359"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Clear text storage of sensitive information",
            "description": "Sensitive information stored without encryption or hashing can expose it to an attacker.",
            "id": "cs/cleartext-storage-of-sensitive-information",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-312/CleartextStorage.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/missing-global-error-handler": {
          "id": "cs/web/missing-global-error-handler",
          "name": "cs/web/missing-global-error-handler",
          "shortDescription": "Missing global error handler",
          "fullDescription": "ASP.NET applications should not set the 'customError' mode to \"off\" without providing a global error handler, otherwise they may leak exception information.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-12",
  "external/cwe/cwe-248"
],
            "kind": "problem",
            "precision": "high",
            "name": "Missing global error handler",
            "description": "ASP.NET applications should not set the \u0027customError\u0027 mode to \"off\" without providing a global error handler, otherwise they may leak exception information.",
            "id": "cs/web/missing-global-error-handler",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-248/MissingASPNETGlobalErrorHandler.ql",
            "problem.severity": "warning"
          }
        },
        "cs/session-reuse": {
          "id": "cs/session-reuse",
          "name": "cs/session-reuse",
          "shortDescription": "Failure to abandon session",
          "fullDescription": "Reusing an existing session as a different user could allow an attacker to access someone else's account by using their session.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-384"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Failure to abandon session",
            "description": "Reusing an existing session as a different user could allow an attacker to access someone else\u0027s account by using their session.",
            "id": "cs/session-reuse",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-384/AbandonSession.ql",
            "problem.severity": "error"
          }
        },
        "cs/password-in-configuration": {
          "id": "cs/password-in-configuration",
          "name": "cs/password-in-configuration",
          "shortDescription": "Password in configuration file",
          "fullDescription": "Finds passwords in configuration files.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-13",
  "external/cwe/cwe-256",
  "external/cwe/cwe-313"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Password in configuration file",
            "description": "Finds passwords in configuration files.",
            "id": "cs/password-in-configuration",
            "query-path": "/semmlecode-csharp-queries/Configuration/PasswordInConfigurationFile.ql",
            "problem.severity": "warning"
          }
        },
        "cs/xml/missing-validation": {
          "id": "cs/xml/missing-validation",
          "name": "cs/xml/missing-validation",
          "shortDescription": "Missing XML validation",
          "fullDescription": "User input should not be processed as XML without validating it against a known schema.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-112"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Missing XML validation",
            "description": "User input should not be processed as XML without validating it against a known schema.",
            "id": "cs/xml/missing-validation",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-112/MissingXMLValidation.ql",
            "problem.severity": "recommendation"
          }
        },
        "cs/web/broad-cookie-domain": {
          "id": "cs/web/broad-cookie-domain",
          "name": "cs/web/broad-cookie-domain",
          "shortDescription": "Cookie security: overly broad domain",
          "fullDescription": "Finds cookies with an overly broad domain.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-287"
],
            "kind": "problem",
            "precision": "high",
            "name": "Cookie security: overly broad domain",
            "description": "Finds cookies with an overly broad domain.",
            "id": "cs/web/broad-cookie-domain",
            "query-path": "/semmlecode-csharp-queries/Security Features/CookieWithOverlyBroadDomain.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/persistent-cookie": {
          "id": "cs/web/persistent-cookie",
          "name": "cs/web/persistent-cookie",
          "shortDescription": "Cookie security: persistent cookie",
          "fullDescription": "Persistent cookies are vulnerable to attacks.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-539"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Cookie security: persistent cookie",
            "description": "Persistent cookies are vulnerable to attacks.",
            "id": "cs/web/persistent-cookie",
            "query-path": "/semmlecode-csharp-queries/Security Features/PersistentCookie.ql",
            "problem.severity": "warning"
          }
        },
        "cs/insecure-xml-read": {
          "id": "cs/insecure-xml-read",
          "name": "cs/insecure-xml-read",
          "shortDescription": "XML is read insecurely",
          "fullDescription": "XML may include dangerous external references, which should be restricted using a secure resolver or disabling DTD processing.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-611",
  "external/cwe/cwe-827",
  "external/cwe/cwe-776"
],
            "kind": "problem",
            "precision": "medium",
            "name": "XML is read insecurely",
            "description": "XML may include dangerous external references, which should be restricted using a secure resolver or disabling DTD processing.",
            "id": "cs/insecure-xml-read",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-611/UseXmlSecureResolver.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/xss": {
          "id": "cs/web/xss",
          "name": "cs/web/xss",
          "shortDescription": "Cross-site scripting",
          "fullDescription": "Writing user input directly to a web page allows for a cross-site scripting vulnerability.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-079",
  "external/cwe/cwe-116"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Cross-site scripting",
            "description": "Writing user input directly to a web page allows for a cross-site scripting vulnerability.",
            "id": "cs/web/xss",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-079/XSS.ql",
            "problem.severity": "error"
          }
        },
        "cs/xml/stored-xpath-injection": {
          "id": "cs/xml/stored-xpath-injection",
          "name": "cs/xml/stored-xpath-injection",
          "shortDescription": "Stored XPath injection",
          "fullDescription": "Building an XPath expression from stored data which may have been provided by the user is vulnerable to insertion of malicious code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-643"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Stored XPath injection",
            "description": "Building an XPath expression from stored data which may have been provided by the user is vulnerable to insertion of malicious code by the user.",
            "id": "cs/xml/stored-xpath-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-643/StoredXPathInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/stored-xss": {
          "id": "cs/web/stored-xss",
          "name": "cs/web/stored-xss",
          "shortDescription": "Stored cross-site scripting",
          "fullDescription": "Writing input from the database directly to a web page indicates a cross-site scripting vulnerability if the data was originally user-provided.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-079",
  "external/cwe/cwe-116"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Stored cross-site scripting",
            "description": "Writing input from the database directly to a web page indicates a cross-site scripting vulnerability if the data was originally user-provided.",
            "id": "cs/web/stored-xss",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-079/StoredXSS.ql",
            "problem.severity": "error"
          }
        },
        "cs/resource-injection": {
          "id": "cs/resource-injection",
          "name": "cs/resource-injection",
          "shortDescription": "Resource injection",
          "fullDescription": "Building a resource descriptor from untrusted user input is vulnerable to a malicious user providing an unintended resource.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-099"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Resource injection",
            "description": "Building a resource descriptor from untrusted user input is vulnerable to a malicious user providing an unintended resource.",
            "id": "cs/resource-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-099/ResourceInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/debug-binary": {
          "id": "cs/web/debug-binary",
          "name": "cs/web/debug-binary",
          "shortDescription": "Creating an ASP.NET debug binary may reveal sensitive information",
          "fullDescription": "ASP.NET projects should not produce debug binaries when deploying to production as debug builds provide additional information useful to a malicious attacker.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "maintainability",
  "frameworks/asp.net",
  "external/cwe/cwe-11"
],
            "kind": "problem",
            "precision": "very-high",
            "name": "Creating an ASP.NET debug binary may reveal sensitive information",
            "description": "ASP.NET projects should not produce debug binaries when deploying to production as debug builds provide additional information useful to a malicious attacker.",
            "id": "cs/web/debug-binary",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-011/ASPNetDebug.ql",
            "problem.severity": "warning"
          }
        },
        "cs/stored-ldap-injection": {
          "id": "cs/stored-ldap-injection",
          "name": "cs/stored-ldap-injection",
          "shortDescription": "LDAP query built from stored user-controlled sources",
          "fullDescription": "Building an LDAP query from stored user-controlled sources is vulnerable to insertion of malicious LDAP code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-090"
],
            "kind": "problem",
            "precision": "medium",
            "name": "LDAP query built from stored user-controlled sources",
            "description": "Building an LDAP query from stored user-controlled sources is vulnerable to insertion of malicious LDAP code by the user.",
            "id": "cs/stored-ldap-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-090/StoredLDAPInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/code-injection": {
          "id": "cs/code-injection",
          "name": "cs/code-injection",
          "shortDescription": "Improper control of generation of code",
          "fullDescription": "Treating externally controlled strings as code can allow an attacker to execute malicious code.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-094",
  "external/cwe/cwe-095",
  "external/cwe/cwe-096"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Improper control of generation of code",
            "description": "Treating externally controlled strings as code can allow an attacker to execute malicious code.",
            "id": "cs/code-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-094/CodeInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/unvalidated-local-pointer-arithmetic": {
          "id": "cs/unvalidated-local-pointer-arithmetic",
          "name": "cs/unvalidated-local-pointer-arithmetic",
          "shortDescription": "Unvalidated local pointer arithmetic",
          "fullDescription": "Using the result of a virtual method call in pointer arithmetic without validation is dangerous because the method may be overridden by a subtype to return any value.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-119",
  "external/cwe/cwe-120",
  "external/cwe/cwe-122",
  "external/cwe/cwe-788"
],
            "kind": "problem",
            "precision": "high",
            "name": "Unvalidated local pointer arithmetic",
            "description": "Using the result of a virtual method call in pointer arithmetic without validation is dangerous because the method may be overridden by a subtype to return any value.",
            "id": "cs/unvalidated-local-pointer-arithmetic",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-119/LocalUnvalidatedArithmetic.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/missing-x-frame-options": {
          "id": "cs/web/missing-x-frame-options",
          "name": "cs/web/missing-x-frame-options",
          "shortDescription": "Missing X-Frame-Options HTTP header",
          "fullDescription": "If the 'X-Frame-Options' setting is not provided, a malicious user may be able to overlay their own UI on top of the site by using an iframe.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-451",
  "external/cwe/cwe-829"
],
            "kind": "problem",
            "precision": "high",
            "name": "Missing X-Frame-Options HTTP header",
            "description": "If the \u0027X-Frame-Options\u0027 setting is not provided, a malicious user may be able to overlay their own UI on top of the site by using an iframe.",
            "id": "cs/web/missing-x-frame-options",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-451/MissingXFrameOptions.ql",
            "problem.severity": "error"
          }
        },
        "cs/hardcoded-connection-string-credentials": {
          "id": "cs/hardcoded-connection-string-credentials",
          "name": "cs/hardcoded-connection-string-credentials",
          "shortDescription": "Hard-coded connection string with credentials",
          "fullDescription": "Credentials are hard-coded in a connection string in the source code of the application.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-259",
  "external/cwe/cwe-321",
  "external/cwe/cwe-798"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Hard-coded connection string with credentials",
            "description": "Credentials are hard-coded in a connection string in the source code of the application.",
            "id": "cs/hardcoded-connection-string-credentials",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-798/HardcodedConnectionString.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/broad-cookie-path": {
          "id": "cs/web/broad-cookie-path",
          "name": "cs/web/broad-cookie-path",
          "shortDescription": "Cookie security: overly broad path",
          "fullDescription": "Finds cookies with an overly broad path.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-287"
],
            "kind": "problem",
            "precision": "high",
            "name": "Cookie security: overly broad path",
            "description": "Finds cookies with an overly broad path.",
            "id": "cs/web/broad-cookie-path",
            "query-path": "/semmlecode-csharp-queries/Security Features/CookieWithOverlyBroadPath.ql",
            "problem.severity": "warning"
          }
        },
        "cs/weak-encryption": {
          "id": "cs/weak-encryption",
          "name": "cs/weak-encryption",
          "shortDescription": "Weak encryption",
          "fullDescription": "Finds uses of encryption algorithms that are weak and obsolete",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-327"
],
            "kind": "problem",
            "precision": "high",
            "name": "Weak encryption",
            "description": "Finds uses of encryption algorithms that are weak and obsolete",
            "id": "cs/weak-encryption",
            "query-path": "/semmlecode-csharp-queries/Security Features/WeakEncryption.ql",
            "problem.severity": "warning"
          }
        },
        "cs/web/disabled-header-checking": {
          "id": "cs/web/disabled-header-checking",
          "name": "cs/web/disabled-header-checking",
          "shortDescription": "Header checking disabled",
          "fullDescription": "Finds places where header checking is disabled.",
          "defaultLevel": "warning",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-113"
],
            "kind": "problem",
            "precision": "high",
            "name": "Header checking disabled",
            "description": "Finds places where header checking is disabled.",
            "id": "cs/web/disabled-header-checking",
            "query-path": "/semmlecode-csharp-queries/Security Features/HeaderCheckingDisabled.ql",
            "problem.severity": "warning"
          }
        },
        "cs/log-forging": {
          "id": "cs/log-forging",
          "name": "cs/log-forging",
          "shortDescription": "Log entries created from user input",
          "fullDescription": "Building log entries from user-controlled sources is vulnerable to insertion of forged log entries by a malicious user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-117"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Log entries created from user input",
            "description": "Building log entries from user-controlled sources is vulnerable to insertion of forged log entries by a malicious user.",
            "id": "cs/log-forging",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-117/LogForging.ql",
            "problem.severity": "error"
          }
        },
        "cs/web/requiressl-not-set": {
          "id": "cs/web/requiressl-not-set",
          "name": "cs/web/requiressl-not-set",
          "shortDescription": "'requireSSL' attribute is not set to true",
          "fullDescription": "Omitting the 'requireSSL' attribute allows data to be transmitted insecurely using HTTP. Always set 'requireSSL' to 'true' to ensure that HTTPS is used at all times.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-319",
  "external/cwe/cwe-614"
],
            "kind": "problem",
            "precision": "high",
            "name": "\u0027requireSSL\u0027 attribute is not set to true",
            "description": "Omitting the \u0027requireSSL\u0027 attribute allows data to be transmitted insecurely using HTTP. Always set \u0027requireSSL\u0027 to \u0027true\u0027 to ensure that HTTPS is used at all times.",
            "id": "cs/web/requiressl-not-set",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-614/RequireSSL.ql",
            "problem.severity": "error"
          }
        },
        "cs/regex-injection": {
          "id": "cs/regex-injection",
          "name": "cs/regex-injection",
          "shortDescription": "Regular expression injection",
          "fullDescription": "User input should not be used in regular expressions without first being escaped, otherwise a malicious user may be able to provide a regex that could require exponential time on certain inputs.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-730",
  "external/cwe/cwe-400"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Regular expression injection",
            "description": "User input should not be used in regular expressions without first being escaped, otherwise a malicious user may be able to provide a regex that could require exponential time on certain inputs.",
            "id": "cs/regex-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-730/RegexInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/xml/insecure-dtd-handling": {
          "id": "cs/xml/insecure-dtd-handling",
          "name": "cs/xml/insecure-dtd-handling",
          "shortDescription": "Untrusted XML is read insecurely",
          "fullDescription": "Untrusted XML is read with an insecure resolver and DTD processing enabled.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-611",
  "external/cwe/cwe-827",
  "external/cwe/cwe-776"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Untrusted XML is read insecurely",
            "description": "Untrusted XML is read with an insecure resolver and DTD processing enabled.",
            "id": "cs/xml/insecure-dtd-handling",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-611/UntrustedDataInsecureXml.ql",
            "problem.severity": "error"
          }
        },
        "cs/sql-injection": {
          "id": "cs/sql-injection",
          "name": "cs/sql-injection",
          "shortDescription": "SQL query built from user-controlled sources",
          "fullDescription": "Building a SQL query from user-controlled sources is vulnerable to insertion of malicious SQL code by the user.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-089"
],
            "kind": "problem",
            "precision": "medium",
            "name": "SQL query built from user-controlled sources",
            "description": "Building a SQL query from user-controlled sources is vulnerable to insertion of malicious SQL code by the user.",
            "id": "cs/sql-injection",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-089/SqlInjection.ql",
            "problem.severity": "error"
          }
        },
        "cs/redos": {
          "id": "cs/redos",
          "name": "cs/redos",
          "shortDescription": "Denial of Service from comparison of user input against expensive regex",
          "fullDescription": "User input should not be matched against a regular expression that could require exponential time on certain input.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-730",
  "external/cwe/cwe-400"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Denial of Service from comparison of user input against expensive regex",
            "description": "User input should not be matched against a regular expression that could require exponential time on certain input.",
            "id": "cs/redos",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-730/ReDoS.ql",
            "problem.severity": "error"
          }
        },
        "cs/exposure-of-sensitive-information": {
          "id": "cs/exposure-of-sensitive-information",
          "name": "cs/exposure-of-sensitive-information",
          "shortDescription": "Exposure of private information",
          "fullDescription": "If private information is written to an external location, it may be accessible by unauthorized persons.",
          "defaultLevel": "error",
          "properties": {
            "tags": [
  "security",
  "external/cwe/cwe-359"
],
            "kind": "problem",
            "precision": "medium",
            "name": "Exposure of private information",
            "description": "If private information is written to an external location, it may be accessible by unauthorized persons.",
            "id": "cs/exposure-of-sensitive-information",
            "query-path": "/semmlecode-csharp-queries/Security Features/CWE-359/ExposureOfPrivateInformation.ql",
            "problem.severity": "error"
          }
        }
      },
      "properties": {
        "originalUriBaseIds": {
  "%SRCROOT%": "file:///C:/corefx/src/System.Private.Xml/"
}
      }
    }
  ]
}