@ECHO OFF
SET BsoaEnlistment=C:\Code\bion\csharp\BSOA

PUSHD "%~dp0"

ECHO Installing BSOA Tools
ECHO =====================
dotnet tool install BSOA.Generator --version "0.6.0" --tool-path bin
dotnet tool install BSOA.FromJSchema --version "0.6.0" --tool-path bin

ECHO.
ECHO Regenerating SARIF SDK OM
ECHO =========================
bin\BSOA.FromJSchema.exe "..\src\Sarif\Schemata\sarif-2.1.0-rtm.5.json" "Schemas\Sarif-2.1.0-rtm.5.schema.json" "SarifLog" "Microsoft.CodeAnalysis.Sarif"
bin\BSOA.Generator.exe "Schemas\Sarif-2.1.0-rtm.5.schema.json" "..\src\Sarif\Autogenerated" "Templates\Sarif" "Schemas\Sarif.postReplacements.json"

POPD
PUSHD "%~dp0..\"

ECHO.
ECHO Rebuilding Sarif
ECHO ================
dotnet restore "src\Sarif\Sarif.csproj"  -f --no-cache
dotnet build "src\Sarif\Sarif.csproj" -c Release

POPD